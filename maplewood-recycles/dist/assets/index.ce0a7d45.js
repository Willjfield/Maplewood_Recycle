(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))g(b);new MutationObserver(b=>{for(const E of b)if(E.type==="childList")for(const P of E.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&g(P)}).observe(document,{childList:!0,subtree:!0});function d(b){const E={};return b.integrity&&(E.integrity=b.integrity),b.referrerpolicy&&(E.referrerPolicy=b.referrerpolicy),b.crossorigin==="use-credentials"?E.credentials="include":b.crossorigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function g(b){if(b.ep)return;b.ep=!0;const E=d(b);fetch(b.href,E)}})();function s1(e,l){const d=Object.create(null),g=e.split(",");for(let b=0;b<g.length;b++)d[g[b]]=!0;return l?b=>!!d[b.toLowerCase()]:b=>!!d[b]}const LA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",BA=s1(LA);function wT(e){return!!e||e===""}function a1(e){if(nr(e)){const l={};for(let d=0;d<e.length;d++){const g=e[d],b=Ms(g)?FA(g):a1(g);if(b)for(const E in b)l[E]=b[E]}return l}else{if(Ms(e))return e;if(Qo(e))return e}}const RA=/;(?![^(]*\))/g,OA=/:(.+)/;function FA(e){const l={};return e.split(RA).forEach(d=>{if(d){const g=d.split(OA);g.length>1&&(l[g[0].trim()]=g[1].trim())}}),l}function l1(e){let l="";if(Ms(e))l=e;else if(nr(e))for(let d=0;d<e.length;d++){const g=l1(e[d]);g&&(l+=g+" ")}else if(Qo(e))for(const d in e)e[d]&&(l+=d+" ");return l.trim()}const ap=e=>Ms(e)?e:e==null?"":nr(e)||Qo(e)&&(e.toString===CT||!yr(e.toString))?JSON.stringify(e,TT,2):String(e),TT=(e,l)=>l&&l.__v_isRef?TT(e,l.value):Cm(l)?{[`Map(${l.size})`]:[...l.entries()].reduce((d,[g,b])=>(d[`${g} =>`]=b,d),{})}:ET(l)?{[`Set(${l.size})`]:[...l.values()]}:Qo(l)&&!nr(l)&&!IT(l)?String(l):l,Oo={},Sm=[],ih=()=>{},VA=()=>!1,NA=/^on[^a-z]/,yv=e=>NA.test(e),c1=e=>e.startsWith("onUpdate:"),_a=Object.assign,u1=(e,l)=>{const d=e.indexOf(l);d>-1&&e.splice(d,1)},UA=Object.prototype.hasOwnProperty,Vr=(e,l)=>UA.call(e,l),nr=Array.isArray,Cm=e=>vv(e)==="[object Map]",ET=e=>vv(e)==="[object Set]",yr=e=>typeof e=="function",Ms=e=>typeof e=="string",h1=e=>typeof e=="symbol",Qo=e=>e!==null&&typeof e=="object",ST=e=>Qo(e)&&yr(e.then)&&yr(e.catch),CT=Object.prototype.toString,vv=e=>CT.call(e),$A=e=>vv(e).slice(8,-1),IT=e=>vv(e)==="[object Object]",d1=e=>Ms(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,$y=s1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),xv=e=>{const l=Object.create(null);return d=>l[d]||(l[d]=e(d))},jA=/-(\w)/g,_u=xv(e=>e.replace(jA,(l,d)=>d?d.toUpperCase():"")),GA=/\B([A-Z])/g,Rm=xv(e=>e.replace(GA,"-$1").toLowerCase()),zf=xv(e=>e.charAt(0).toUpperCase()+e.slice(1)),jy=xv(e=>e?`on${zf(e)}`:""),o_=(e,l)=>!Object.is(e,l),Gy=(e,l)=>{for(let d=0;d<e.length;d++)e[d](l)},ev=(e,l,d)=>{Object.defineProperty(e,l,{configurable:!0,enumerable:!1,value:d})},tv=e=>{const l=parseFloat(e);return isNaN(l)?e:l};let Mw;const qA=()=>Mw||(Mw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let cu;class AT{constructor(l=!1){this.detached=l,this.active=!0,this.effects=[],this.cleanups=[],this.parent=cu,!l&&cu&&(this.index=(cu.scopes||(cu.scopes=[])).push(this)-1)}run(l){if(this.active){const d=cu;try{return cu=this,l()}finally{cu=d}}}on(){cu=this}off(){cu=this.parent}stop(l){if(this.active){let d,g;for(d=0,g=this.effects.length;d<g;d++)this.effects[d].stop();for(d=0,g=this.cleanups.length;d<g;d++)this.cleanups[d]();if(this.scopes)for(d=0,g=this.scopes.length;d<g;d++)this.scopes[d].stop(!0);if(!this.detached&&this.parent&&!l){const b=this.parent.scopes.pop();b&&b!==this&&(this.parent.scopes[this.index]=b,b.index=this.index)}this.parent=void 0,this.active=!1}}}function b_(e){return new AT(e)}function ZA(e,l=cu){l&&l.active&&l.effects.push(e)}function Ap(e){cu&&cu.cleanups.push(e)}const f1=e=>{const l=new Set(e);return l.w=0,l.n=0,l},MT=e=>(e.w&Af)>0,kT=e=>(e.n&Af)>0,WA=({deps:e})=>{if(e.length)for(let l=0;l<e.length;l++)e[l].w|=Af},XA=e=>{const{deps:l}=e;if(l.length){let d=0;for(let g=0;g<l.length;g++){const b=l[g];MT(b)&&!kT(b)?b.delete(e):l[d++]=b,b.w&=~Af,b.n&=~Af}l.length=d}},yx=new WeakMap;let Kg=0,Af=1;const vx=30;let eh;const Tp=Symbol(""),xx=Symbol("");class p1{constructor(l,d=null,g){this.fn=l,this.scheduler=d,this.active=!0,this.deps=[],this.parent=void 0,ZA(this,g)}run(){if(!this.active)return this.fn();let l=eh,d=Cf;for(;l;){if(l===this)return;l=l.parent}try{return this.parent=eh,eh=this,Cf=!0,Af=1<<++Kg,Kg<=vx?WA(this):kw(this),this.fn()}finally{Kg<=vx&&XA(this),Af=1<<--Kg,eh=this.parent,Cf=d,this.parent=void 0,this.deferStop&&this.stop()}}stop(){eh===this?this.deferStop=!0:this.active&&(kw(this),this.onStop&&this.onStop(),this.active=!1)}}function kw(e){const{deps:l}=e;if(l.length){for(let d=0;d<l.length;d++)l[d].delete(e);l.length=0}}let Cf=!0;const PT=[];function Mp(){PT.push(Cf),Cf=!1}function kp(){const e=PT.pop();Cf=e===void 0?!0:e}function xc(e,l,d){if(Cf&&eh){let g=yx.get(e);g||yx.set(e,g=new Map);let b=g.get(d);b||g.set(d,b=f1()),zT(b)}}function zT(e,l){let d=!1;Kg<=vx?kT(e)||(e.n|=Af,d=!MT(e)):d=!e.has(eh),d&&(e.add(eh),eh.deps.push(e))}function Cd(e,l,d,g,b,E){const P=yx.get(e);if(!P)return;let i=[];if(l==="clear")i=[...P.values()];else if(d==="length"&&nr(e))P.forEach((F,j)=>{(j==="length"||j>=g)&&i.push(F)});else switch(d!==void 0&&i.push(P.get(d)),l){case"add":nr(e)?d1(d)&&i.push(P.get("length")):(i.push(P.get(Tp)),Cm(e)&&i.push(P.get(xx)));break;case"delete":nr(e)||(i.push(P.get(Tp)),Cm(e)&&i.push(P.get(xx)));break;case"set":Cm(e)&&i.push(P.get(Tp));break}if(i.length===1)i[0]&&bx(i[0]);else{const F=[];for(const j of i)j&&F.push(...j);bx(f1(F))}}function bx(e,l){const d=nr(e)?e:[...e];for(const g of d)g.computed&&Pw(g);for(const g of d)g.computed||Pw(g)}function Pw(e,l){(e!==eh||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const HA=s1("__proto__,__v_isRef,__isVue"),DT=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(h1)),KA=m1(),YA=m1(!1,!0),JA=m1(!0),zw=QA();function QA(){const e={};return["includes","indexOf","lastIndexOf"].forEach(l=>{e[l]=function(...d){const g=Nr(this);for(let E=0,P=this.length;E<P;E++)xc(g,"get",E+"");const b=g[l](...d);return b===-1||b===!1?g[l](...d.map(Nr)):b}}),["push","pop","shift","unshift","splice"].forEach(l=>{e[l]=function(...d){Mp();const g=Nr(this)[l].apply(this,d);return kp(),g}}),e}function m1(e=!1,l=!1){return function(g,b,E){if(b==="__v_isReactive")return!e;if(b==="__v_isReadonly")return e;if(b==="__v_isShallow")return l;if(b==="__v_raw"&&E===(e?l?mM:FT:l?OT:RT).get(g))return g;const P=nr(g);if(!e&&P&&Vr(zw,b))return Reflect.get(zw,b,E);const i=Reflect.get(g,b,E);return(h1(b)?DT.has(b):HA(b))||(e||xc(g,"get",b),l)?i:us(i)?P&&d1(b)?i:i.value:Qo(i)?e?w_(i):wl(i):i}}const eM=LT(),tM=LT(!0);function LT(e=!1){return function(d,g,b,E){let P=d[g];if(zm(P)&&us(P)&&!us(b))return!1;if(!e&&(!iv(b)&&!zm(b)&&(P=Nr(P),b=Nr(b)),!nr(d)&&us(P)&&!us(b)))return P.value=b,!0;const i=nr(d)&&d1(g)?Number(g)<d.length:Vr(d,g),F=Reflect.set(d,g,b,E);return d===Nr(E)&&(i?o_(b,P)&&Cd(d,"set",g,b):Cd(d,"add",g,b)),F}}function iM(e,l){const d=Vr(e,l);e[l];const g=Reflect.deleteProperty(e,l);return g&&d&&Cd(e,"delete",l,void 0),g}function nM(e,l){const d=Reflect.has(e,l);return(!h1(l)||!DT.has(l))&&xc(e,"has",l),d}function rM(e){return xc(e,"iterate",nr(e)?"length":Tp),Reflect.ownKeys(e)}const BT={get:KA,set:eM,deleteProperty:iM,has:nM,ownKeys:rM},oM={get:JA,set(e,l){return!0},deleteProperty(e,l){return!0}},sM=_a({},BT,{get:YA,set:tM}),g1=e=>e,bv=e=>Reflect.getPrototypeOf(e);function zy(e,l,d=!1,g=!1){e=e.__v_raw;const b=Nr(e),E=Nr(l);d||(l!==E&&xc(b,"get",l),xc(b,"get",E));const{has:P}=bv(b),i=g?g1:d?v1:s_;if(P.call(b,l))return i(e.get(l));if(P.call(b,E))return i(e.get(E));e!==b&&e.get(l)}function Dy(e,l=!1){const d=this.__v_raw,g=Nr(d),b=Nr(e);return l||(e!==b&&xc(g,"has",e),xc(g,"has",b)),e===b?d.has(e):d.has(e)||d.has(b)}function Ly(e,l=!1){return e=e.__v_raw,!l&&xc(Nr(e),"iterate",Tp),Reflect.get(e,"size",e)}function Dw(e){e=Nr(e);const l=Nr(this);return bv(l).has.call(l,e)||(l.add(e),Cd(l,"add",e,e)),this}function Lw(e,l){l=Nr(l);const d=Nr(this),{has:g,get:b}=bv(d);let E=g.call(d,e);E||(e=Nr(e),E=g.call(d,e));const P=b.call(d,e);return d.set(e,l),E?o_(l,P)&&Cd(d,"set",e,l):Cd(d,"add",e,l),this}function Bw(e){const l=Nr(this),{has:d,get:g}=bv(l);let b=d.call(l,e);b||(e=Nr(e),b=d.call(l,e)),g&&g.call(l,e);const E=l.delete(e);return b&&Cd(l,"delete",e,void 0),E}function Rw(){const e=Nr(this),l=e.size!==0,d=e.clear();return l&&Cd(e,"clear",void 0,void 0),d}function By(e,l){return function(g,b){const E=this,P=E.__v_raw,i=Nr(P),F=l?g1:e?v1:s_;return!e&&xc(i,"iterate",Tp),P.forEach((j,K)=>g.call(b,F(j),F(K),E))}}function Ry(e,l,d){return function(...g){const b=this.__v_raw,E=Nr(b),P=Cm(E),i=e==="entries"||e===Symbol.iterator&&P,F=e==="keys"&&P,j=b[e](...g),K=d?g1:l?v1:s_;return!l&&xc(E,"iterate",F?xx:Tp),{next(){const{value:Y,done:q}=j.next();return q?{value:Y,done:q}:{value:i?[K(Y[0]),K(Y[1])]:K(Y),done:q}},[Symbol.iterator](){return this}}}}function xf(e){return function(...l){return e==="delete"?!1:this}}function aM(){const e={get(E){return zy(this,E)},get size(){return Ly(this)},has:Dy,add:Dw,set:Lw,delete:Bw,clear:Rw,forEach:By(!1,!1)},l={get(E){return zy(this,E,!1,!0)},get size(){return Ly(this)},has:Dy,add:Dw,set:Lw,delete:Bw,clear:Rw,forEach:By(!1,!0)},d={get(E){return zy(this,E,!0)},get size(){return Ly(this,!0)},has(E){return Dy.call(this,E,!0)},add:xf("add"),set:xf("set"),delete:xf("delete"),clear:xf("clear"),forEach:By(!0,!1)},g={get(E){return zy(this,E,!0,!0)},get size(){return Ly(this,!0)},has(E){return Dy.call(this,E,!0)},add:xf("add"),set:xf("set"),delete:xf("delete"),clear:xf("clear"),forEach:By(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(E=>{e[E]=Ry(E,!1,!1),d[E]=Ry(E,!0,!1),l[E]=Ry(E,!1,!0),g[E]=Ry(E,!0,!0)}),[e,d,l,g]}const[lM,cM,uM,hM]=aM();function _1(e,l){const d=l?e?hM:uM:e?cM:lM;return(g,b,E)=>b==="__v_isReactive"?!e:b==="__v_isReadonly"?e:b==="__v_raw"?g:Reflect.get(Vr(d,b)&&b in g?d:g,b,E)}const dM={get:_1(!1,!1)},fM={get:_1(!1,!0)},pM={get:_1(!0,!1)},RT=new WeakMap,OT=new WeakMap,FT=new WeakMap,mM=new WeakMap;function gM(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function _M(e){return e.__v_skip||!Object.isExtensible(e)?0:gM($A(e))}function wl(e){return zm(e)?e:y1(e,!1,BT,dM,RT)}function VT(e){return y1(e,!1,sM,fM,OT)}function w_(e){return y1(e,!0,oM,pM,FT)}function y1(e,l,d,g,b){if(!Qo(e)||e.__v_raw&&!(l&&e.__v_isReactive))return e;const E=b.get(e);if(E)return E;const P=_M(e);if(P===0)return e;const i=new Proxy(e,P===2?g:d);return b.set(e,i),i}function Im(e){return zm(e)?Im(e.__v_raw):!!(e&&e.__v_isReactive)}function zm(e){return!!(e&&e.__v_isReadonly)}function iv(e){return!!(e&&e.__v_isShallow)}function NT(e){return Im(e)||zm(e)}function Nr(e){const l=e&&e.__v_raw;return l?Nr(l):e}function UT(e){return ev(e,"__v_skip",!0),e}const s_=e=>Qo(e)?wl(e):e,v1=e=>Qo(e)?w_(e):e;function $T(e){Cf&&eh&&(e=Nr(e),zT(e.dep||(e.dep=f1())))}function jT(e,l){e=Nr(e),e.dep&&bx(e.dep)}function us(e){return!!(e&&e.__v_isRef===!0)}function oi(e){return GT(e,!1)}function yM(e){return GT(e,!0)}function GT(e,l){return us(e)?e:new vM(e,l)}class vM{constructor(l,d){this.__v_isShallow=d,this.dep=void 0,this.__v_isRef=!0,this._rawValue=d?l:Nr(l),this._value=d?l:s_(l)}get value(){return $T(this),this._value}set value(l){const d=this.__v_isShallow||iv(l)||zm(l);l=d?l:Nr(l),o_(l,this._rawValue)&&(this._rawValue=l,this._value=d?l:s_(l),jT(this))}}function If(e){return us(e)?e.value:e}const xM={get:(e,l,d)=>If(Reflect.get(e,l,d)),set:(e,l,d,g)=>{const b=e[l];return us(b)&&!us(d)?(b.value=d,!0):Reflect.set(e,l,d,g)}};function qT(e){return Im(e)?e:new Proxy(e,xM)}function x1(e){const l=nr(e)?new Array(e.length):{};for(const d in e)l[d]=ki(e,d);return l}class bM{constructor(l,d,g){this._object=l,this._key=d,this._defaultValue=g,this.__v_isRef=!0}get value(){const l=this._object[this._key];return l===void 0?this._defaultValue:l}set value(l){this._object[this._key]=l}}function ki(e,l,d){const g=e[l];return us(g)?g:new bM(e,l,d)}var ZT;class wM{constructor(l,d,g,b){this._setter=d,this.dep=void 0,this.__v_isRef=!0,this[ZT]=!1,this._dirty=!0,this.effect=new p1(l,()=>{this._dirty||(this._dirty=!0,jT(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!b,this.__v_isReadonly=g}get value(){const l=Nr(this);return $T(l),(l._dirty||!l._cacheable)&&(l._dirty=!1,l._value=l.effect.run()),l._value}set value(l){this._setter(l)}}ZT="__v_isReadonly";function TM(e,l,d=!1){let g,b;const E=yr(e);return E?(g=e,b=ih):(g=e.get,b=e.set),new wM(g,b,E||!b,d)}const Qg=[];function EM(e,...l){Mp();const d=Qg.length?Qg[Qg.length-1].component:null,g=d&&d.appContext.config.warnHandler,b=SM();if(g)Td(g,d,11,[e+l.join(""),d&&d.proxy,b.map(({vnode:E})=>`at <${wE(d,E.type)}>`).join(`
`),b]);else{const E=[`[Vue warn]: ${e}`,...l];b.length&&E.push(`
`,...CM(b)),console.warn(...E)}kp()}function SM(){let e=Qg[Qg.length-1];if(!e)return[];const l=[];for(;e;){const d=l[0];d&&d.vnode===e?d.recurseCount++:l.push({vnode:e,recurseCount:0});const g=e.component&&e.component.parent;e=g&&g.vnode}return l}function CM(e){const l=[];return e.forEach((d,g)=>{l.push(...g===0?[]:[`
`],...IM(d))}),l}function IM({vnode:e,recurseCount:l}){const d=l>0?`... (${l} recursive calls)`:"",g=e.component?e.component.parent==null:!1,b=` at <${wE(e.component,e.type,g)}`,E=">"+d;return e.props?[b,...AM(e.props),E]:[b+E]}function AM(e){const l=[],d=Object.keys(e);return d.slice(0,3).forEach(g=>{l.push(...WT(g,e[g]))}),d.length>3&&l.push(" ..."),l}function WT(e,l,d){return Ms(l)?(l=JSON.stringify(l),d?l:[`${e}=${l}`]):typeof l=="number"||typeof l=="boolean"||l==null?d?l:[`${e}=${l}`]:us(l)?(l=WT(e,Nr(l.value),!0),d?l:[`${e}=Ref<`,l,">"]):yr(l)?[`${e}=fn${l.name?`<${l.name}>`:""}`]:(l=Nr(l),d?l:[`${e}=`,l])}function Td(e,l,d,g){let b;try{b=g?e(...g):e()}catch(E){wv(E,l,d)}return b}function pu(e,l,d,g){if(yr(e)){const E=Td(e,l,d,g);return E&&ST(E)&&E.catch(P=>{wv(P,l,d)}),E}const b=[];for(let E=0;E<e.length;E++)b.push(pu(e[E],l,d,g));return b}function wv(e,l,d,g=!0){const b=l?l.vnode:null;if(l){let E=l.parent;const P=l.proxy,i=d;for(;E;){const j=E.ec;if(j){for(let K=0;K<j.length;K++)if(j[K](e,P,i)===!1)return}E=E.parent}const F=l.appContext.config.errorHandler;if(F){Td(F,null,10,[e,P,i]);return}}MM(e,d,b,g)}function MM(e,l,d,g=!0){console.error(e)}let a_=!1,wx=!1;const Ha=[];let zh=0;const Am=[];let bd=null,mp=0;const XT=Promise.resolve();let b1=null;function ys(e){const l=b1||XT;return e?l.then(this?e.bind(this):e):l}function kM(e){let l=zh+1,d=Ha.length;for(;l<d;){const g=l+d>>>1;l_(Ha[g])<e?l=g+1:d=g}return l}function w1(e){(!Ha.length||!Ha.includes(e,a_&&e.allowRecurse?zh+1:zh))&&(e.id==null?Ha.push(e):Ha.splice(kM(e.id),0,e),HT())}function HT(){!a_&&!wx&&(wx=!0,b1=XT.then(YT))}function PM(e){const l=Ha.indexOf(e);l>zh&&Ha.splice(l,1)}function zM(e){nr(e)?Am.push(...e):(!bd||!bd.includes(e,e.allowRecurse?mp+1:mp))&&Am.push(e),HT()}function Ow(e,l=a_?zh+1:0){for(;l<Ha.length;l++){const d=Ha[l];d&&d.pre&&(Ha.splice(l,1),l--,d())}}function KT(e){if(Am.length){const l=[...new Set(Am)];if(Am.length=0,bd){bd.push(...l);return}for(bd=l,bd.sort((d,g)=>l_(d)-l_(g)),mp=0;mp<bd.length;mp++)bd[mp]();bd=null,mp=0}}const l_=e=>e.id==null?1/0:e.id,DM=(e,l)=>{const d=l_(e)-l_(l);if(d===0){if(e.pre&&!l.pre)return-1;if(l.pre&&!e.pre)return 1}return d};function YT(e){wx=!1,a_=!0,Ha.sort(DM);const l=ih;try{for(zh=0;zh<Ha.length;zh++){const d=Ha[zh];d&&d.active!==!1&&Td(d,null,14)}}finally{zh=0,Ha.length=0,KT(),a_=!1,b1=null,(Ha.length||Am.length)&&YT()}}function LM(e,l,...d){if(e.isUnmounted)return;const g=e.vnode.props||Oo;let b=d;const E=l.startsWith("update:"),P=E&&l.slice(7);if(P&&P in g){const K=`${P==="modelValue"?"model":P}Modifiers`,{number:Y,trim:q}=g[K]||Oo;q&&(b=d.map(re=>re.trim())),Y&&(b=d.map(tv))}let i,F=g[i=jy(l)]||g[i=jy(_u(l))];!F&&E&&(F=g[i=jy(Rm(l))]),F&&pu(F,e,6,b);const j=g[i+"Once"];if(j){if(!e.emitted)e.emitted={};else if(e.emitted[i])return;e.emitted[i]=!0,pu(j,e,6,b)}}function JT(e,l,d=!1){const g=l.emitsCache,b=g.get(e);if(b!==void 0)return b;const E=e.emits;let P={},i=!1;if(!yr(e)){const F=j=>{const K=JT(j,l,!0);K&&(i=!0,_a(P,K))};!d&&l.mixins.length&&l.mixins.forEach(F),e.extends&&F(e.extends),e.mixins&&e.mixins.forEach(F)}return!E&&!i?(Qo(e)&&g.set(e,null),null):(nr(E)?E.forEach(F=>P[F]=null):_a(P,E),Qo(e)&&g.set(e,P),P)}function Tv(e,l){return!e||!yv(l)?!1:(l=l.slice(2).replace(/Once$/,""),Vr(e,l[0].toLowerCase()+l.slice(1))||Vr(e,Rm(l))||Vr(e,l))}let hu=null,QT=null;function nv(e){const l=hu;return hu=e,QT=e&&e.type.__scopeId||null,l}function uu(e,l=hu,d){if(!l||e._n)return e;const g=(...b)=>{g._d&&Kw(-1);const E=nv(l);let P;try{P=e(...b)}finally{nv(E),g._d&&Kw(1)}return P};return g._n=!0,g._c=!0,g._d=!0,g}function W0(e){const{type:l,vnode:d,proxy:g,withProxy:b,props:E,propsOptions:[P],slots:i,attrs:F,emit:j,render:K,renderCache:Y,data:q,setupState:re,ctx:me,inheritAttrs:we}=e;let je,$e;const tt=nv(e);try{if(d.shapeFlag&4){const mt=b||g;je=Ph(K.call(mt,mt,Y,E,re,q,me)),$e=F}else{const mt=l;je=Ph(mt.length>1?mt(E,{attrs:F,slots:i,emit:j}):mt(E,null)),$e=l.props?F:BM(F)}}catch(mt){t_.length=0,wv(mt,e,1),je=ce(Ed)}let Ae=je;if($e&&we!==!1){const mt=Object.keys($e),{shapeFlag:Me}=Ae;mt.length&&Me&7&&(P&&mt.some(c1)&&($e=RM($e,P)),Ae=Id(Ae,$e))}return d.dirs&&(Ae=Id(Ae),Ae.dirs=Ae.dirs?Ae.dirs.concat(d.dirs):d.dirs),d.transition&&(Ae.transition=d.transition),je=Ae,nv(tt),je}const BM=e=>{let l;for(const d in e)(d==="class"||d==="style"||yv(d))&&((l||(l={}))[d]=e[d]);return l},RM=(e,l)=>{const d={};for(const g in e)(!c1(g)||!(g.slice(9)in l))&&(d[g]=e[g]);return d};function OM(e,l,d){const{props:g,children:b,component:E}=e,{props:P,children:i,patchFlag:F}=l,j=E.emitsOptions;if(l.dirs||l.transition)return!0;if(d&&F>=0){if(F&1024)return!0;if(F&16)return g?Fw(g,P,j):!!P;if(F&8){const K=l.dynamicProps;for(let Y=0;Y<K.length;Y++){const q=K[Y];if(P[q]!==g[q]&&!Tv(j,q))return!0}}}else return(b||i)&&(!i||!i.$stable)?!0:g===P?!1:g?P?Fw(g,P,j):!0:!!P;return!1}function Fw(e,l,d){const g=Object.keys(l);if(g.length!==Object.keys(e).length)return!0;for(let b=0;b<g.length;b++){const E=g[b];if(l[E]!==e[E]&&!Tv(d,E))return!0}return!1}function FM({vnode:e,parent:l},d){for(;l&&l.subTree===e;)(e=l.vnode).el=d,l=l.parent}const VM=e=>e.__isSuspense;function NM(e,l){l&&l.pendingBranch?nr(e)?l.effects.push(...e):l.effects.push(e):zM(e)}function ra(e,l){if(ga){let d=ga.provides;const g=ga.parent&&ga.parent.provides;g===d&&(d=ga.provides=Object.create(g)),d[e]=l}}function co(e,l,d=!1){const g=ga||hu;if(g){const b=g.parent==null?g.vnode.appContext&&g.vnode.appContext.provides:g.parent.provides;if(b&&e in b)return b[e];if(arguments.length>1)return d&&yr(l)?l.call(g.proxy):l}}function Oh(e,l){return T1(e,null,l)}const Vw={};function Mn(e,l,d){return T1(e,l,d)}function T1(e,l,{immediate:d,deep:g,flush:b,onTrack:E,onTrigger:P}=Oo){const i=ga;let F,j=!1,K=!1;if(us(e)?(F=()=>e.value,j=iv(e)):Im(e)?(F=()=>e,g=!0):nr(e)?(K=!0,j=e.some($e=>Im($e)||iv($e)),F=()=>e.map($e=>{if(us($e))return $e.value;if(Im($e))return yp($e);if(yr($e))return Td($e,i,2)})):yr(e)?l?F=()=>Td(e,i,2):F=()=>{if(!(i&&i.isUnmounted))return Y&&Y(),pu(e,i,3,[q])}:F=ih,l&&g){const $e=F;F=()=>yp($e())}let Y,q=$e=>{Y=je.onStop=()=>{Td($e,i,4)}};if(d_)return q=ih,l?d&&pu(l,i,3,[F(),K?[]:void 0,q]):F(),ih;let re=K?[]:Vw;const me=()=>{if(!!je.active)if(l){const $e=je.run();(g||j||(K?$e.some((tt,Ae)=>o_(tt,re[Ae])):o_($e,re)))&&(Y&&Y(),pu(l,i,3,[$e,re===Vw?void 0:re,q]),re=$e)}else je.run()};me.allowRecurse=!!l;let we;b==="sync"?we=me:b==="post"?we=()=>Gl(me,i&&i.suspense):(me.pre=!0,i&&(me.id=i.uid),we=()=>w1(me));const je=new p1(F,we);return l?d?me():re=je.run():b==="post"?Gl(je.run.bind(je),i&&i.suspense):je.run(),()=>{je.stop(),i&&i.scope&&u1(i.scope.effects,je)}}function UM(e,l,d){const g=this.proxy,b=Ms(e)?e.includes(".")?eE(g,e):()=>g[e]:e.bind(g,g);let E;yr(l)?E=l:(E=l.handler,d=l);const P=ga;Dm(this);const i=T1(b,E.bind(g),d);return P?Dm(P):Ep(),i}function eE(e,l){const d=l.split(".");return()=>{let g=e;for(let b=0;b<d.length&&g;b++)g=g[d[b]];return g}}function yp(e,l){if(!Qo(e)||e.__v_skip||(l=l||new Set,l.has(e)))return e;if(l.add(e),us(e))yp(e.value,l);else if(nr(e))for(let d=0;d<e.length;d++)yp(e[d],l);else if(ET(e)||Cm(e))e.forEach(d=>{yp(d,l)});else if(IT(e))for(const d in e)yp(e[d],l);return e}function tE(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Wl(()=>{e.isMounted=!0}),Xl(()=>{e.isUnmounting=!0}),e}const lu=[Function,Array],$M={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:lu,onEnter:lu,onAfterEnter:lu,onEnterCancelled:lu,onBeforeLeave:lu,onLeave:lu,onAfterLeave:lu,onLeaveCancelled:lu,onBeforeAppear:lu,onAppear:lu,onAfterAppear:lu,onAppearCancelled:lu},setup(e,{slots:l}){const d=Av(),g=tE();let b;return()=>{const E=l.default&&E1(l.default(),!0);if(!E||!E.length)return;let P=E[0];if(E.length>1){for(const we of E)if(we.type!==Ed){P=we;break}}const i=Nr(e),{mode:F}=i;if(g.isLeaving)return X0(P);const j=Nw(P);if(!j)return X0(P);const K=c_(j,i,g,d);u_(j,K);const Y=d.subTree,q=Y&&Nw(Y);let re=!1;const{getTransitionKey:me}=j.type;if(me){const we=me();b===void 0?b=we:we!==b&&(b=we,re=!0)}if(q&&q.type!==Ed&&(!gp(j,q)||re)){const we=c_(q,i,g,d);if(u_(q,we),F==="out-in")return g.isLeaving=!0,we.afterLeave=()=>{g.isLeaving=!1,d.update()},X0(P);F==="in-out"&&j.type!==Ed&&(we.delayLeave=(je,$e,tt)=>{const Ae=nE(g,q);Ae[String(q.key)]=q,je._leaveCb=()=>{$e(),je._leaveCb=void 0,delete K.delayedLeave},K.delayedLeave=tt})}return P}}},iE=$M;function nE(e,l){const{leavingVNodes:d}=e;let g=d.get(l.type);return g||(g=Object.create(null),d.set(l.type,g)),g}function c_(e,l,d,g){const{appear:b,mode:E,persisted:P=!1,onBeforeEnter:i,onEnter:F,onAfterEnter:j,onEnterCancelled:K,onBeforeLeave:Y,onLeave:q,onAfterLeave:re,onLeaveCancelled:me,onBeforeAppear:we,onAppear:je,onAfterAppear:$e,onAppearCancelled:tt}=l,Ae=String(e.key),mt=nE(d,e),Me=(rt,gt)=>{rt&&pu(rt,g,9,gt)},Ye=(rt,gt)=>{const vt=gt[1];Me(rt,gt),nr(rt)?rt.every(Ut=>Ut.length<=1)&&vt():rt.length<=1&&vt()},Ze={mode:E,persisted:P,beforeEnter(rt){let gt=i;if(!d.isMounted)if(b)gt=we||i;else return;rt._leaveCb&&rt._leaveCb(!0);const vt=mt[Ae];vt&&gp(e,vt)&&vt.el._leaveCb&&vt.el._leaveCb(),Me(gt,[rt])},enter(rt){let gt=F,vt=j,Ut=K;if(!d.isMounted)if(b)gt=je||F,vt=$e||j,Ut=tt||K;else return;let At=!1;const ti=rt._enterCb=Nt=>{At||(At=!0,Nt?Me(Ut,[rt]):Me(vt,[rt]),Ze.delayedLeave&&Ze.delayedLeave(),rt._enterCb=void 0)};gt?Ye(gt,[rt,ti]):ti()},leave(rt,gt){const vt=String(e.key);if(rt._enterCb&&rt._enterCb(!0),d.isUnmounting)return gt();Me(Y,[rt]);let Ut=!1;const At=rt._leaveCb=ti=>{Ut||(Ut=!0,gt(),ti?Me(me,[rt]):Me(re,[rt]),rt._leaveCb=void 0,mt[vt]===e&&delete mt[vt])};mt[vt]=e,q?Ye(q,[rt,At]):At()},clone(rt){return c_(rt,l,d,g)}};return Ze}function X0(e){if(Ev(e))return e=Id(e),e.children=null,e}function Nw(e){return Ev(e)?e.children?e.children[0]:void 0:e}function u_(e,l){e.shapeFlag&6&&e.component?u_(e.component.subTree,l):e.shapeFlag&128?(e.ssContent.transition=l.clone(e.ssContent),e.ssFallback.transition=l.clone(e.ssFallback)):e.transition=l}function E1(e,l=!1,d){let g=[],b=0;for(let E=0;E<e.length;E++){let P=e[E];const i=d==null?P.key:String(d)+String(P.key!=null?P.key:E);P.type===Tr?(P.patchFlag&128&&b++,g=g.concat(E1(P.children,l,i))):(l||P.type!==Ed)&&g.push(i!=null?Id(P,{key:i}):P)}if(b>1)for(let E=0;E<g.length;E++)g[E].patchFlag=-2;return g}function S1(e){return yr(e)?{setup:e,name:e.name}:e}const qy=e=>!!e.type.__asyncLoader,Ev=e=>e.type.__isKeepAlive;function rE(e,l){sE(e,"a",l)}function oE(e,l){sE(e,"da",l)}function sE(e,l,d=ga){const g=e.__wdc||(e.__wdc=()=>{let b=d;for(;b;){if(b.isDeactivated)return;b=b.parent}return e()});if(Sv(l,g,d),d){let b=d.parent;for(;b&&b.parent;)Ev(b.parent.vnode)&&jM(g,l,d,b),b=b.parent}}function jM(e,l,d,g){const b=Sv(l,e,g,!0);cE(()=>{u1(g[l],b)},d)}function Sv(e,l,d=ga,g=!1){if(d){const b=d[e]||(d[e]=[]),E=l.__weh||(l.__weh=(...P)=>{if(d.isUnmounted)return;Mp(),Dm(d);const i=pu(l,d,e,P);return Ep(),kp(),i});return g?b.unshift(E):b.push(E),E}}const kd=e=>(l,d=ga)=>(!d_||e==="sp")&&Sv(e,(...g)=>l(...g),d),Cv=kd("bm"),Wl=kd("m"),aE=kd("bu"),lE=kd("u"),Xl=kd("bum"),cE=kd("um"),GM=kd("sp"),qM=kd("rtg"),ZM=kd("rtc");function WM(e,l=ga){Sv("ec",e,l)}function io(e,l){const d=hu;if(d===null)return e;const g=Mv(d)||d.proxy,b=e.dirs||(e.dirs=[]);for(let E=0;E<l.length;E++){let[P,i,F,j=Oo]=l[E];yr(P)&&(P={mounted:P,updated:P}),P.deep&&yp(i),b.push({dir:P,instance:g,value:i,oldValue:void 0,arg:F,modifiers:j})}return e}function lp(e,l,d,g){const b=e.dirs,E=l&&l.dirs;for(let P=0;P<b.length;P++){const i=b[P];E&&(i.oldValue=E[P].value);let F=i.dir[g];F&&(Mp(),pu(F,d,8,[e.el,i,e,l]),kp())}}const C1="components",XM="directives";function Dh(e,l){return I1(C1,e,!0,l)||e}const uE=Symbol();function HM(e){return Ms(e)?I1(C1,e,!1)||e:e||uE}function bc(e){return I1(XM,e)}function I1(e,l,d=!0,g=!1){const b=hu||ga;if(b){const E=b.type;if(e===C1){const i=bE(E,!1);if(i&&(i===l||i===_u(l)||i===zf(_u(l))))return E}const P=Uw(b[e]||E[e],l)||Uw(b.appContext[e],l);return!P&&g?E:P}}function Uw(e,l){return e&&(e[l]||e[_u(l)]||e[zf(_u(l))])}function $w(e,l,d,g){let b;const E=d&&d[g];if(nr(e)||Ms(e)){b=new Array(e.length);for(let P=0,i=e.length;P<i;P++)b[P]=l(e[P],P,void 0,E&&E[P])}else if(typeof e=="number"){b=new Array(e);for(let P=0;P<e;P++)b[P]=l(P+1,P,void 0,E&&E[P])}else if(Qo(e))if(e[Symbol.iterator])b=Array.from(e,(P,i)=>l(P,i,void 0,E&&E[i]));else{const P=Object.keys(e);b=new Array(P.length);for(let i=0,F=P.length;i<F;i++){const j=P[i];b[i]=l(e[j],j,i,E&&E[i])}}else b=[];return d&&(d[g]=b),b}function H0(e,l){const d={};for(const g in e)d[l&&/[A-Z]/.test(g)?`on:${g}`:jy(g)]=e[g];return d}const Tx=e=>e?vE(e)?Mv(e)||e.proxy:Tx(e.parent):null,rv=_a(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Tx(e.parent),$root:e=>Tx(e.root),$emit:e=>e.emit,$options:e=>A1(e),$forceUpdate:e=>e.f||(e.f=()=>w1(e.update)),$nextTick:e=>e.n||(e.n=ys.bind(e.proxy)),$watch:e=>UM.bind(e)}),KM={get({_:e},l){const{ctx:d,setupState:g,data:b,props:E,accessCache:P,type:i,appContext:F}=e;let j;if(l[0]!=="$"){const re=P[l];if(re!==void 0)switch(re){case 1:return g[l];case 2:return b[l];case 4:return d[l];case 3:return E[l]}else{if(g!==Oo&&Vr(g,l))return P[l]=1,g[l];if(b!==Oo&&Vr(b,l))return P[l]=2,b[l];if((j=e.propsOptions[0])&&Vr(j,l))return P[l]=3,E[l];if(d!==Oo&&Vr(d,l))return P[l]=4,d[l];Ex&&(P[l]=0)}}const K=rv[l];let Y,q;if(K)return l==="$attrs"&&xc(e,"get",l),K(e);if((Y=i.__cssModules)&&(Y=Y[l]))return Y;if(d!==Oo&&Vr(d,l))return P[l]=4,d[l];if(q=F.config.globalProperties,Vr(q,l))return q[l]},set({_:e},l,d){const{data:g,setupState:b,ctx:E}=e;return b!==Oo&&Vr(b,l)?(b[l]=d,!0):g!==Oo&&Vr(g,l)?(g[l]=d,!0):Vr(e.props,l)||l[0]==="$"&&l.slice(1)in e?!1:(E[l]=d,!0)},has({_:{data:e,setupState:l,accessCache:d,ctx:g,appContext:b,propsOptions:E}},P){let i;return!!d[P]||e!==Oo&&Vr(e,P)||l!==Oo&&Vr(l,P)||(i=E[0])&&Vr(i,P)||Vr(g,P)||Vr(rv,P)||Vr(b.config.globalProperties,P)},defineProperty(e,l,d){return d.get!=null?e._.accessCache[l]=0:Vr(d,"value")&&this.set(e,l,d.value,null),Reflect.defineProperty(e,l,d)}};let Ex=!0;function YM(e){const l=A1(e),d=e.proxy,g=e.ctx;Ex=!1,l.beforeCreate&&jw(l.beforeCreate,e,"bc");const{data:b,computed:E,methods:P,watch:i,provide:F,inject:j,created:K,beforeMount:Y,mounted:q,beforeUpdate:re,updated:me,activated:we,deactivated:je,beforeDestroy:$e,beforeUnmount:tt,destroyed:Ae,unmounted:mt,render:Me,renderTracked:Ye,renderTriggered:Ze,errorCaptured:rt,serverPrefetch:gt,expose:vt,inheritAttrs:Ut,components:At,directives:ti,filters:Nt}=l;if(j&&JM(j,g,null,e.appContext.config.unwrapInjectedRef),P)for(const Yt in P){const vi=P[Yt];yr(vi)&&(g[Yt]=vi.bind(d))}if(b){const Yt=b.call(d,d);Qo(Yt)&&(e.data=wl(Yt))}if(Ex=!0,E)for(const Yt in E){const vi=E[Yt],cn=yr(vi)?vi.bind(d,d):yr(vi.get)?vi.get.bind(d,d):ih,di=!yr(vi)&&yr(vi.set)?vi.set.bind(d):ih,un=He({get:cn,set:di});Object.defineProperty(g,Yt,{enumerable:!0,configurable:!0,get:()=>un.value,set:mn=>un.value=mn})}if(i)for(const Yt in i)hE(i[Yt],g,d,Yt);if(F){const Yt=yr(F)?F.call(d):F;Reflect.ownKeys(Yt).forEach(vi=>{ra(vi,Yt[vi])})}K&&jw(K,e,"c");function zt(Yt,vi){nr(vi)?vi.forEach(cn=>Yt(cn.bind(d))):vi&&Yt(vi.bind(d))}if(zt(Cv,Y),zt(Wl,q),zt(aE,re),zt(lE,me),zt(rE,we),zt(oE,je),zt(WM,rt),zt(ZM,Ye),zt(qM,Ze),zt(Xl,tt),zt(cE,mt),zt(GM,gt),nr(vt))if(vt.length){const Yt=e.exposed||(e.exposed={});vt.forEach(vi=>{Object.defineProperty(Yt,vi,{get:()=>d[vi],set:cn=>d[vi]=cn})})}else e.exposed||(e.exposed={});Me&&e.render===ih&&(e.render=Me),Ut!=null&&(e.inheritAttrs=Ut),At&&(e.components=At),ti&&(e.directives=ti)}function JM(e,l,d=ih,g=!1){nr(e)&&(e=Sx(e));for(const b in e){const E=e[b];let P;Qo(E)?"default"in E?P=co(E.from||b,E.default,!0):P=co(E.from||b):P=co(E),us(P)&&g?Object.defineProperty(l,b,{enumerable:!0,configurable:!0,get:()=>P.value,set:i=>P.value=i}):l[b]=P}}function jw(e,l,d){pu(nr(e)?e.map(g=>g.bind(l.proxy)):e.bind(l.proxy),l,d)}function hE(e,l,d,g){const b=g.includes(".")?eE(d,g):()=>d[g];if(Ms(e)){const E=l[e];yr(E)&&Mn(b,E)}else if(yr(e))Mn(b,e.bind(d));else if(Qo(e))if(nr(e))e.forEach(E=>hE(E,l,d,g));else{const E=yr(e.handler)?e.handler.bind(d):l[e.handler];yr(E)&&Mn(b,E,e)}}function A1(e){const l=e.type,{mixins:d,extends:g}=l,{mixins:b,optionsCache:E,config:{optionMergeStrategies:P}}=e.appContext,i=E.get(l);let F;return i?F=i:!b.length&&!d&&!g?F=l:(F={},b.length&&b.forEach(j=>ov(F,j,P,!0)),ov(F,l,P)),Qo(l)&&E.set(l,F),F}function ov(e,l,d,g=!1){const{mixins:b,extends:E}=l;E&&ov(e,E,d,!0),b&&b.forEach(P=>ov(e,P,d,!0));for(const P in l)if(!(g&&P==="expose")){const i=QM[P]||d&&d[P];e[P]=i?i(e[P],l[P]):l[P]}return e}const QM={data:Gw,props:fp,emits:fp,methods:fp,computed:fp,beforeCreate:bl,created:bl,beforeMount:bl,mounted:bl,beforeUpdate:bl,updated:bl,beforeDestroy:bl,beforeUnmount:bl,destroyed:bl,unmounted:bl,activated:bl,deactivated:bl,errorCaptured:bl,serverPrefetch:bl,components:fp,directives:fp,watch:tk,provide:Gw,inject:ek};function Gw(e,l){return l?e?function(){return _a(yr(e)?e.call(this,this):e,yr(l)?l.call(this,this):l)}:l:e}function ek(e,l){return fp(Sx(e),Sx(l))}function Sx(e){if(nr(e)){const l={};for(let d=0;d<e.length;d++)l[e[d]]=e[d];return l}return e}function bl(e,l){return e?[...new Set([].concat(e,l))]:l}function fp(e,l){return e?_a(_a(Object.create(null),e),l):l}function tk(e,l){if(!e)return l;if(!l)return e;const d=_a(Object.create(null),e);for(const g in l)d[g]=bl(e[g],l[g]);return d}function ik(e,l,d,g=!1){const b={},E={};ev(E,Iv,1),e.propsDefaults=Object.create(null),dE(e,l,b,E);for(const P in e.propsOptions[0])P in b||(b[P]=void 0);d?e.props=g?b:VT(b):e.type.props?e.props=b:e.props=E,e.attrs=E}function nk(e,l,d,g){const{props:b,attrs:E,vnode:{patchFlag:P}}=e,i=Nr(b),[F]=e.propsOptions;let j=!1;if((g||P>0)&&!(P&16)){if(P&8){const K=e.vnode.dynamicProps;for(let Y=0;Y<K.length;Y++){let q=K[Y];if(Tv(e.emitsOptions,q))continue;const re=l[q];if(F)if(Vr(E,q))re!==E[q]&&(E[q]=re,j=!0);else{const me=_u(q);b[me]=Cx(F,i,me,re,e,!1)}else re!==E[q]&&(E[q]=re,j=!0)}}}else{dE(e,l,b,E)&&(j=!0);let K;for(const Y in i)(!l||!Vr(l,Y)&&((K=Rm(Y))===Y||!Vr(l,K)))&&(F?d&&(d[Y]!==void 0||d[K]!==void 0)&&(b[Y]=Cx(F,i,Y,void 0,e,!0)):delete b[Y]);if(E!==i)for(const Y in E)(!l||!Vr(l,Y)&&!0)&&(delete E[Y],j=!0)}j&&Cd(e,"set","$attrs")}function dE(e,l,d,g){const[b,E]=e.propsOptions;let P=!1,i;if(l)for(let F in l){if($y(F))continue;const j=l[F];let K;b&&Vr(b,K=_u(F))?!E||!E.includes(K)?d[K]=j:(i||(i={}))[K]=j:Tv(e.emitsOptions,F)||(!(F in g)||j!==g[F])&&(g[F]=j,P=!0)}if(E){const F=Nr(d),j=i||Oo;for(let K=0;K<E.length;K++){const Y=E[K];d[Y]=Cx(b,F,Y,j[Y],e,!Vr(j,Y))}}return P}function Cx(e,l,d,g,b,E){const P=e[d];if(P!=null){const i=Vr(P,"default");if(i&&g===void 0){const F=P.default;if(P.type!==Function&&yr(F)){const{propsDefaults:j}=b;d in j?g=j[d]:(Dm(b),g=j[d]=F.call(null,l),Ep())}else g=F}P[0]&&(E&&!i?g=!1:P[1]&&(g===""||g===Rm(d))&&(g=!0))}return g}function fE(e,l,d=!1){const g=l.propsCache,b=g.get(e);if(b)return b;const E=e.props,P={},i=[];let F=!1;if(!yr(e)){const K=Y=>{F=!0;const[q,re]=fE(Y,l,!0);_a(P,q),re&&i.push(...re)};!d&&l.mixins.length&&l.mixins.forEach(K),e.extends&&K(e.extends),e.mixins&&e.mixins.forEach(K)}if(!E&&!F)return Qo(e)&&g.set(e,Sm),Sm;if(nr(E))for(let K=0;K<E.length;K++){const Y=_u(E[K]);qw(Y)&&(P[Y]=Oo)}else if(E)for(const K in E){const Y=_u(K);if(qw(Y)){const q=E[K],re=P[Y]=nr(q)||yr(q)?{type:q}:q;if(re){const me=Xw(Boolean,re.type),we=Xw(String,re.type);re[0]=me>-1,re[1]=we<0||me<we,(me>-1||Vr(re,"default"))&&i.push(Y)}}}const j=[P,i];return Qo(e)&&g.set(e,j),j}function qw(e){return e[0]!=="$"}function Zw(e){const l=e&&e.toString().match(/^\s*function (\w+)/);return l?l[1]:e===null?"null":""}function Ww(e,l){return Zw(e)===Zw(l)}function Xw(e,l){return nr(l)?l.findIndex(d=>Ww(d,e)):yr(l)&&Ww(l,e)?0:-1}const pE=e=>e[0]==="_"||e==="$stable",M1=e=>nr(e)?e.map(Ph):[Ph(e)],rk=(e,l,d)=>{if(l._n)return l;const g=uu((...b)=>M1(l(...b)),d);return g._c=!1,g},mE=(e,l,d)=>{const g=e._ctx;for(const b in e){if(pE(b))continue;const E=e[b];if(yr(E))l[b]=rk(b,E,g);else if(E!=null){const P=M1(E);l[b]=()=>P}}},gE=(e,l)=>{const d=M1(l);e.slots.default=()=>d},ok=(e,l)=>{if(e.vnode.shapeFlag&32){const d=l._;d?(e.slots=Nr(l),ev(l,"_",d)):mE(l,e.slots={})}else e.slots={},l&&gE(e,l);ev(e.slots,Iv,1)},sk=(e,l,d)=>{const{vnode:g,slots:b}=e;let E=!0,P=Oo;if(g.shapeFlag&32){const i=l._;i?d&&i===1?E=!1:(_a(b,l),!d&&i===1&&delete b._):(E=!l.$stable,mE(l,b)),P=l}else l&&(gE(e,l),P={default:1});if(E)for(const i in b)!pE(i)&&!(i in P)&&delete b[i]};function _E(){return{app:null,config:{isNativeTag:VA,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ak=0;function lk(e,l){return function(g,b=null){yr(g)||(g=Object.assign({},g)),b!=null&&!Qo(b)&&(b=null);const E=_E(),P=new Set;let i=!1;const F=E.app={_uid:ak++,_component:g,_props:b,_container:null,_context:E,_instance:null,version:kk,get config(){return E.config},set config(j){},use(j,...K){return P.has(j)||(j&&yr(j.install)?(P.add(j),j.install(F,...K)):yr(j)&&(P.add(j),j(F,...K))),F},mixin(j){return E.mixins.includes(j)||E.mixins.push(j),F},component(j,K){return K?(E.components[j]=K,F):E.components[j]},directive(j,K){return K?(E.directives[j]=K,F):E.directives[j]},mount(j,K,Y){if(!i){const q=ce(g,b);return q.appContext=E,K&&l?l(q,j):e(q,j,Y),i=!0,F._container=j,j.__vue_app__=F,Mv(q.component)||q.component.proxy}},unmount(){i&&(e(null,F._container),delete F._container.__vue_app__)},provide(j,K){return E.provides[j]=K,F}};return F}}function Ix(e,l,d,g,b=!1){if(nr(e)){e.forEach((q,re)=>Ix(q,l&&(nr(l)?l[re]:l),d,g,b));return}if(qy(g)&&!b)return;const E=g.shapeFlag&4?Mv(g.component)||g.component.proxy:g.el,P=b?null:E,{i,r:F}=e,j=l&&l.r,K=i.refs===Oo?i.refs={}:i.refs,Y=i.setupState;if(j!=null&&j!==F&&(Ms(j)?(K[j]=null,Vr(Y,j)&&(Y[j]=null)):us(j)&&(j.value=null)),yr(F))Td(F,i,12,[P,K]);else{const q=Ms(F),re=us(F);if(q||re){const me=()=>{if(e.f){const we=q?Vr(Y,F)?Y[F]:K[F]:F.value;b?nr(we)&&u1(we,E):nr(we)?we.includes(E)||we.push(E):q?(K[F]=[E],Vr(Y,F)&&(Y[F]=K[F])):(F.value=[E],e.k&&(K[e.k]=F.value))}else q?(K[F]=P,Vr(Y,F)&&(Y[F]=P)):re&&(F.value=P,e.k&&(K[e.k]=P))};P?(me.id=-1,Gl(me,d)):me()}}}const Gl=NM;function ck(e){return uk(e)}function uk(e,l){const d=qA();d.__VUE__=!0;const{insert:g,remove:b,patchProp:E,createElement:P,createText:i,createComment:F,setText:j,setElementText:K,parentNode:Y,nextSibling:q,setScopeId:re=ih,insertStaticContent:me}=e,we=(at,bt,Ft,fi=null,gi=null,Mi=null,Ki=!1,ci=null,Pi=!!bt.dynamicChildren)=>{if(at===bt)return;at&&!gp(at,bt)&&(fi=vr(at),mn(at,gi,Mi,!0),at=null),bt.patchFlag===-2&&(Pi=!1,bt.dynamicChildren=null);const{type:Si,ref:tn,shapeFlag:on}=bt;switch(Si){case P1:je(at,bt,Ft,fi);break;case Ed:$e(at,bt,Ft,fi);break;case K0:at==null&&tt(bt,Ft,fi,Ki);break;case Tr:At(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi);break;default:on&1?Me(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi):on&6?ti(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi):(on&64||on&128)&&Si.process(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi,Xr)}tn!=null&&gi&&Ix(tn,at&&at.ref,Mi,bt||at,!bt)},je=(at,bt,Ft,fi)=>{if(at==null)g(bt.el=i(bt.children),Ft,fi);else{const gi=bt.el=at.el;bt.children!==at.children&&j(gi,bt.children)}},$e=(at,bt,Ft,fi)=>{at==null?g(bt.el=F(bt.children||""),Ft,fi):bt.el=at.el},tt=(at,bt,Ft,fi)=>{[at.el,at.anchor]=me(at.children,bt,Ft,fi,at.el,at.anchor)},Ae=({el:at,anchor:bt},Ft,fi)=>{let gi;for(;at&&at!==bt;)gi=q(at),g(at,Ft,fi),at=gi;g(bt,Ft,fi)},mt=({el:at,anchor:bt})=>{let Ft;for(;at&&at!==bt;)Ft=q(at),b(at),at=Ft;b(bt)},Me=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi)=>{Ki=Ki||bt.type==="svg",at==null?Ye(bt,Ft,fi,gi,Mi,Ki,ci,Pi):gt(at,bt,gi,Mi,Ki,ci,Pi)},Ye=(at,bt,Ft,fi,gi,Mi,Ki,ci)=>{let Pi,Si;const{type:tn,props:on,shapeFlag:hn,transition:Tn,dirs:On}=at;if(Pi=at.el=P(at.type,Mi,on&&on.is,on),hn&8?K(Pi,at.children):hn&16&&rt(at.children,Pi,null,fi,gi,Mi&&tn!=="foreignObject",Ki,ci),On&&lp(at,null,fi,"created"),on){for(const Ot in on)Ot!=="value"&&!$y(Ot)&&E(Pi,Ot,null,on[Ot],Mi,at.children,fi,gi,wn);"value"in on&&E(Pi,"value",null,on.value),(Si=on.onVnodeBeforeMount)&&kh(Si,fi,at)}Ze(Pi,at,at.scopeId,Ki,fi),On&&lp(at,null,fi,"beforeMount");const qn=(!gi||gi&&!gi.pendingBranch)&&Tn&&!Tn.persisted;qn&&Tn.beforeEnter(Pi),g(Pi,bt,Ft),((Si=on&&on.onVnodeMounted)||qn||On)&&Gl(()=>{Si&&kh(Si,fi,at),qn&&Tn.enter(Pi),On&&lp(at,null,fi,"mounted")},gi)},Ze=(at,bt,Ft,fi,gi)=>{if(Ft&&re(at,Ft),fi)for(let Mi=0;Mi<fi.length;Mi++)re(at,fi[Mi]);if(gi){let Mi=gi.subTree;if(bt===Mi){const Ki=gi.vnode;Ze(at,Ki,Ki.scopeId,Ki.slotScopeIds,gi.parent)}}},rt=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi=0)=>{for(let Si=Pi;Si<at.length;Si++){const tn=at[Si]=ci?Sf(at[Si]):Ph(at[Si]);we(null,tn,bt,Ft,fi,gi,Mi,Ki,ci)}},gt=(at,bt,Ft,fi,gi,Mi,Ki)=>{const ci=bt.el=at.el;let{patchFlag:Pi,dynamicChildren:Si,dirs:tn}=bt;Pi|=at.patchFlag&16;const on=at.props||Oo,hn=bt.props||Oo;let Tn;Ft&&cp(Ft,!1),(Tn=hn.onVnodeBeforeUpdate)&&kh(Tn,Ft,bt,at),tn&&lp(bt,at,Ft,"beforeUpdate"),Ft&&cp(Ft,!0);const On=gi&&bt.type!=="foreignObject";if(Si?vt(at.dynamicChildren,Si,ci,Ft,fi,On,Mi):Ki||vi(at,bt,ci,null,Ft,fi,On,Mi,!1),Pi>0){if(Pi&16)Ut(ci,bt,on,hn,Ft,fi,gi);else if(Pi&2&&on.class!==hn.class&&E(ci,"class",null,hn.class,gi),Pi&4&&E(ci,"style",on.style,hn.style,gi),Pi&8){const qn=bt.dynamicProps;for(let Ot=0;Ot<qn.length;Ot++){const yi=qn[Ot],Pr=on[yi],Eo=hn[yi];(Eo!==Pr||yi==="value")&&E(ci,yi,Pr,Eo,gi,at.children,Ft,fi,wn)}}Pi&1&&at.children!==bt.children&&K(ci,bt.children)}else!Ki&&Si==null&&Ut(ci,bt,on,hn,Ft,fi,gi);((Tn=hn.onVnodeUpdated)||tn)&&Gl(()=>{Tn&&kh(Tn,Ft,bt,at),tn&&lp(bt,at,Ft,"updated")},fi)},vt=(at,bt,Ft,fi,gi,Mi,Ki)=>{for(let ci=0;ci<bt.length;ci++){const Pi=at[ci],Si=bt[ci],tn=Pi.el&&(Pi.type===Tr||!gp(Pi,Si)||Pi.shapeFlag&70)?Y(Pi.el):Ft;we(Pi,Si,tn,null,fi,gi,Mi,Ki,!0)}},Ut=(at,bt,Ft,fi,gi,Mi,Ki)=>{if(Ft!==fi){if(Ft!==Oo)for(const ci in Ft)!$y(ci)&&!(ci in fi)&&E(at,ci,Ft[ci],null,Ki,bt.children,gi,Mi,wn);for(const ci in fi){if($y(ci))continue;const Pi=fi[ci],Si=Ft[ci];Pi!==Si&&ci!=="value"&&E(at,ci,Si,Pi,Ki,bt.children,gi,Mi,wn)}"value"in fi&&E(at,"value",Ft.value,fi.value)}},At=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi)=>{const Si=bt.el=at?at.el:i(""),tn=bt.anchor=at?at.anchor:i("");let{patchFlag:on,dynamicChildren:hn,slotScopeIds:Tn}=bt;Tn&&(ci=ci?ci.concat(Tn):Tn),at==null?(g(Si,Ft,fi),g(tn,Ft,fi),rt(bt.children,Ft,tn,gi,Mi,Ki,ci,Pi)):on>0&&on&64&&hn&&at.dynamicChildren?(vt(at.dynamicChildren,hn,Ft,gi,Mi,Ki,ci),(bt.key!=null||gi&&bt===gi.subTree)&&k1(at,bt,!0)):vi(at,bt,Ft,tn,gi,Mi,Ki,ci,Pi)},ti=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi)=>{bt.slotScopeIds=ci,at==null?bt.shapeFlag&512?gi.ctx.activate(bt,Ft,fi,Ki,Pi):Nt(bt,Ft,fi,gi,Mi,Ki,Pi):Wt(at,bt,Pi)},Nt=(at,bt,Ft,fi,gi,Mi,Ki)=>{const ci=at.component=wk(at,fi,gi);if(Ev(at)&&(ci.ctx.renderer=Xr),Tk(ci),ci.asyncDep){if(gi&&gi.registerDep(ci,zt),!at.el){const Pi=ci.subTree=ce(Ed);$e(null,Pi,bt,Ft)}return}zt(ci,at,bt,Ft,gi,Mi,Ki)},Wt=(at,bt,Ft)=>{const fi=bt.component=at.component;if(OM(at,bt,Ft))if(fi.asyncDep&&!fi.asyncResolved){Yt(fi,bt,Ft);return}else fi.next=bt,PM(fi.update),fi.update();else bt.el=at.el,fi.vnode=bt},zt=(at,bt,Ft,fi,gi,Mi,Ki)=>{const ci=()=>{if(at.isMounted){let{next:tn,bu:on,u:hn,parent:Tn,vnode:On}=at,qn=tn,Ot;cp(at,!1),tn?(tn.el=On.el,Yt(at,tn,Ki)):tn=On,on&&Gy(on),(Ot=tn.props&&tn.props.onVnodeBeforeUpdate)&&kh(Ot,Tn,tn,On),cp(at,!0);const yi=W0(at),Pr=at.subTree;at.subTree=yi,we(Pr,yi,Y(Pr.el),vr(Pr),at,gi,Mi),tn.el=yi.el,qn===null&&FM(at,yi.el),hn&&Gl(hn,gi),(Ot=tn.props&&tn.props.onVnodeUpdated)&&Gl(()=>kh(Ot,Tn,tn,On),gi)}else{let tn;const{el:on,props:hn}=bt,{bm:Tn,m:On,parent:qn}=at,Ot=qy(bt);if(cp(at,!1),Tn&&Gy(Tn),!Ot&&(tn=hn&&hn.onVnodeBeforeMount)&&kh(tn,qn,bt),cp(at,!0),on&&ks){const yi=()=>{at.subTree=W0(at),ks(on,at.subTree,at,gi,null)};Ot?bt.type.__asyncLoader().then(()=>!at.isUnmounted&&yi()):yi()}else{const yi=at.subTree=W0(at);we(null,yi,Ft,fi,at,gi,Mi),bt.el=yi.el}if(On&&Gl(On,gi),!Ot&&(tn=hn&&hn.onVnodeMounted)){const yi=bt;Gl(()=>kh(tn,qn,yi),gi)}(bt.shapeFlag&256||qn&&qy(qn.vnode)&&qn.vnode.shapeFlag&256)&&at.a&&Gl(at.a,gi),at.isMounted=!0,bt=Ft=fi=null}},Pi=at.effect=new p1(ci,()=>w1(Si),at.scope),Si=at.update=()=>Pi.run();Si.id=at.uid,cp(at,!0),Si()},Yt=(at,bt,Ft)=>{bt.component=at;const fi=at.vnode.props;at.vnode=bt,at.next=null,nk(at,bt.props,fi,Ft),sk(at,bt.children,Ft),Mp(),Ow(),kp()},vi=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi=!1)=>{const Si=at&&at.children,tn=at?at.shapeFlag:0,on=bt.children,{patchFlag:hn,shapeFlag:Tn}=bt;if(hn>0){if(hn&128){di(Si,on,Ft,fi,gi,Mi,Ki,ci,Pi);return}else if(hn&256){cn(Si,on,Ft,fi,gi,Mi,Ki,ci,Pi);return}}Tn&8?(tn&16&&wn(Si,gi,Mi),on!==Si&&K(Ft,on)):tn&16?Tn&16?di(Si,on,Ft,fi,gi,Mi,Ki,ci,Pi):wn(Si,gi,Mi,!0):(tn&8&&K(Ft,""),Tn&16&&rt(on,Ft,fi,gi,Mi,Ki,ci,Pi))},cn=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi)=>{at=at||Sm,bt=bt||Sm;const Si=at.length,tn=bt.length,on=Math.min(Si,tn);let hn;for(hn=0;hn<on;hn++){const Tn=bt[hn]=Pi?Sf(bt[hn]):Ph(bt[hn]);we(at[hn],Tn,Ft,null,gi,Mi,Ki,ci,Pi)}Si>tn?wn(at,gi,Mi,!0,!1,on):rt(bt,Ft,fi,gi,Mi,Ki,ci,Pi,on)},di=(at,bt,Ft,fi,gi,Mi,Ki,ci,Pi)=>{let Si=0;const tn=bt.length;let on=at.length-1,hn=tn-1;for(;Si<=on&&Si<=hn;){const Tn=at[Si],On=bt[Si]=Pi?Sf(bt[Si]):Ph(bt[Si]);if(gp(Tn,On))we(Tn,On,Ft,null,gi,Mi,Ki,ci,Pi);else break;Si++}for(;Si<=on&&Si<=hn;){const Tn=at[on],On=bt[hn]=Pi?Sf(bt[hn]):Ph(bt[hn]);if(gp(Tn,On))we(Tn,On,Ft,null,gi,Mi,Ki,ci,Pi);else break;on--,hn--}if(Si>on){if(Si<=hn){const Tn=hn+1,On=Tn<tn?bt[Tn].el:fi;for(;Si<=hn;)we(null,bt[Si]=Pi?Sf(bt[Si]):Ph(bt[Si]),Ft,On,gi,Mi,Ki,ci,Pi),Si++}}else if(Si>hn)for(;Si<=on;)mn(at[Si],gi,Mi,!0),Si++;else{const Tn=Si,On=Si,qn=new Map;for(Si=On;Si<=hn;Si++){const zr=bt[Si]=Pi?Sf(bt[Si]):Ph(bt[Si]);zr.key!=null&&qn.set(zr.key,Si)}let Ot,yi=0;const Pr=hn-On+1;let Eo=!1,jn=0;const ro=new Array(Pr);for(Si=0;Si<Pr;Si++)ro[Si]=0;for(Si=Tn;Si<=on;Si++){const zr=at[Si];if(yi>=Pr){mn(zr,gi,Mi,!0);continue}let So;if(zr.key!=null)So=qn.get(zr.key);else for(Ot=On;Ot<=hn;Ot++)if(ro[Ot-On]===0&&gp(zr,bt[Ot])){So=Ot;break}So===void 0?mn(zr,gi,Mi,!0):(ro[So-On]=Si+1,So>=jn?jn=So:Eo=!0,we(zr,bt[So],Ft,null,gi,Mi,Ki,ci,Pi),yi++)}const _o=Eo?hk(ro):Sm;for(Ot=_o.length-1,Si=Pr-1;Si>=0;Si--){const zr=On+Si,So=bt[zr],zi=zr+1<tn?bt[zr+1].el:fi;ro[Si]===0?we(null,So,Ft,zi,gi,Mi,Ki,ci,Pi):Eo&&(Ot<0||Si!==_o[Ot]?un(So,Ft,zi,2):Ot--)}}},un=(at,bt,Ft,fi,gi=null)=>{const{el:Mi,type:Ki,transition:ci,children:Pi,shapeFlag:Si}=at;if(Si&6){un(at.component.subTree,bt,Ft,fi);return}if(Si&128){at.suspense.move(bt,Ft,fi);return}if(Si&64){Ki.move(at,bt,Ft,Xr);return}if(Ki===Tr){g(Mi,bt,Ft);for(let on=0;on<Pi.length;on++)un(Pi[on],bt,Ft,fi);g(at.anchor,bt,Ft);return}if(Ki===K0){Ae(at,bt,Ft);return}if(fi!==2&&Si&1&&ci)if(fi===0)ci.beforeEnter(Mi),g(Mi,bt,Ft),Gl(()=>ci.enter(Mi),gi);else{const{leave:on,delayLeave:hn,afterLeave:Tn}=ci,On=()=>g(Mi,bt,Ft),qn=()=>{on(Mi,()=>{On(),Tn&&Tn()})};hn?hn(Mi,On,qn):qn()}else g(Mi,bt,Ft)},mn=(at,bt,Ft,fi=!1,gi=!1)=>{const{type:Mi,props:Ki,ref:ci,children:Pi,dynamicChildren:Si,shapeFlag:tn,patchFlag:on,dirs:hn}=at;if(ci!=null&&Ix(ci,null,Ft,at,!0),tn&256){bt.ctx.deactivate(at);return}const Tn=tn&1&&hn,On=!qy(at);let qn;if(On&&(qn=Ki&&Ki.onVnodeBeforeUnmount)&&kh(qn,bt,at),tn&6)En(at.component,Ft,fi);else{if(tn&128){at.suspense.unmount(Ft,fi);return}Tn&&lp(at,null,bt,"beforeUnmount"),tn&64?at.type.remove(at,bt,Ft,gi,Xr,fi):Si&&(Mi!==Tr||on>0&&on&64)?wn(Si,bt,Ft,!1,!0):(Mi===Tr&&on&384||!gi&&tn&16)&&wn(Pi,bt,Ft),fi&&Er(at)}(On&&(qn=Ki&&Ki.onVnodeUnmounted)||Tn)&&Gl(()=>{qn&&kh(qn,bt,at),Tn&&lp(at,null,bt,"unmounted")},Ft)},Er=at=>{const{type:bt,el:Ft,anchor:fi,transition:gi}=at;if(bt===Tr){Li(Ft,fi);return}if(bt===K0){mt(at);return}const Mi=()=>{b(Ft),gi&&!gi.persisted&&gi.afterLeave&&gi.afterLeave()};if(at.shapeFlag&1&&gi&&!gi.persisted){const{leave:Ki,delayLeave:ci}=gi,Pi=()=>Ki(Ft,Mi);ci?ci(at.el,Mi,Pi):Pi()}else Mi()},Li=(at,bt)=>{let Ft;for(;at!==bt;)Ft=q(at),b(at),at=Ft;b(bt)},En=(at,bt,Ft)=>{const{bum:fi,scope:gi,update:Mi,subTree:Ki,um:ci}=at;fi&&Gy(fi),gi.stop(),Mi&&(Mi.active=!1,mn(Ki,at,bt,Ft)),ci&&Gl(ci,bt),Gl(()=>{at.isUnmounted=!0},bt),bt&&bt.pendingBranch&&!bt.isUnmounted&&at.asyncDep&&!at.asyncResolved&&at.suspenseId===bt.pendingId&&(bt.deps--,bt.deps===0&&bt.resolve())},wn=(at,bt,Ft,fi=!1,gi=!1,Mi=0)=>{for(let Ki=Mi;Ki<at.length;Ki++)mn(at[Ki],bt,Ft,fi,gi)},vr=at=>at.shapeFlag&6?vr(at.component.subTree):at.shapeFlag&128?at.suspense.next():q(at.anchor||at.el),Fo=(at,bt,Ft)=>{at==null?bt._vnode&&mn(bt._vnode,null,null,!0):we(bt._vnode||null,at,bt,null,null,null,Ft),Ow(),KT(),bt._vnode=at},Xr={p:we,um:mn,m:un,r:Er,mt:Nt,mc:rt,pc:vi,pbc:vt,n:vr,o:e};let uo,ks;return l&&([uo,ks]=l(Xr)),{render:Fo,hydrate:uo,createApp:lk(Fo,uo)}}function cp({effect:e,update:l},d){e.allowRecurse=l.allowRecurse=d}function k1(e,l,d=!1){const g=e.children,b=l.children;if(nr(g)&&nr(b))for(let E=0;E<g.length;E++){const P=g[E];let i=b[E];i.shapeFlag&1&&!i.dynamicChildren&&((i.patchFlag<=0||i.patchFlag===32)&&(i=b[E]=Sf(b[E]),i.el=P.el),d||k1(P,i))}}function hk(e){const l=e.slice(),d=[0];let g,b,E,P,i;const F=e.length;for(g=0;g<F;g++){const j=e[g];if(j!==0){if(b=d[d.length-1],e[b]<j){l[g]=b,d.push(g);continue}for(E=0,P=d.length-1;E<P;)i=E+P>>1,e[d[i]]<j?E=i+1:P=i;j<e[d[E]]&&(E>0&&(l[g]=d[E-1]),d[E]=g)}}for(E=d.length,P=d[E-1];E-- >0;)d[E]=P,P=l[P];return d}const dk=e=>e.__isTeleport,e_=e=>e&&(e.disabled||e.disabled===""),Hw=e=>typeof SVGElement<"u"&&e instanceof SVGElement,Ax=(e,l)=>{const d=e&&e.to;return Ms(d)?l?l(d):null:d},fk={__isTeleport:!0,process(e,l,d,g,b,E,P,i,F,j){const{mc:K,pc:Y,pbc:q,o:{insert:re,querySelector:me,createText:we,createComment:je}}=j,$e=e_(l.props);let{shapeFlag:tt,children:Ae,dynamicChildren:mt}=l;if(e==null){const Me=l.el=we(""),Ye=l.anchor=we("");re(Me,d,g),re(Ye,d,g);const Ze=l.target=Ax(l.props,me),rt=l.targetAnchor=we("");Ze&&(re(rt,Ze),P=P||Hw(Ze));const gt=(vt,Ut)=>{tt&16&&K(Ae,vt,Ut,b,E,P,i,F)};$e?gt(d,Ye):Ze&&gt(Ze,rt)}else{l.el=e.el;const Me=l.anchor=e.anchor,Ye=l.target=e.target,Ze=l.targetAnchor=e.targetAnchor,rt=e_(e.props),gt=rt?d:Ye,vt=rt?Me:Ze;if(P=P||Hw(Ye),mt?(q(e.dynamicChildren,mt,gt,b,E,P,i),k1(e,l,!0)):F||Y(e,l,gt,vt,b,E,P,i,!1),$e)rt||Oy(l,d,Me,j,1);else if((l.props&&l.props.to)!==(e.props&&e.props.to)){const Ut=l.target=Ax(l.props,me);Ut&&Oy(l,Ut,null,j,0)}else rt&&Oy(l,Ye,Ze,j,1)}},remove(e,l,d,g,{um:b,o:{remove:E}},P){const{shapeFlag:i,children:F,anchor:j,targetAnchor:K,target:Y,props:q}=e;if(Y&&E(K),(P||!e_(q))&&(E(j),i&16))for(let re=0;re<F.length;re++){const me=F[re];b(me,l,d,!0,!!me.dynamicChildren)}},move:Oy,hydrate:pk};function Oy(e,l,d,{o:{insert:g},m:b},E=2){E===0&&g(e.targetAnchor,l,d);const{el:P,anchor:i,shapeFlag:F,children:j,props:K}=e,Y=E===2;if(Y&&g(P,l,d),(!Y||e_(K))&&F&16)for(let q=0;q<j.length;q++)b(j[q],l,d,2);Y&&g(i,l,d)}function pk(e,l,d,g,b,E,{o:{nextSibling:P,parentNode:i,querySelector:F}},j){const K=l.target=Ax(l.props,F);if(K){const Y=K._lpa||K.firstChild;if(l.shapeFlag&16)if(e_(l.props))l.anchor=j(P(e),l,i(e),d,g,b,E),l.targetAnchor=Y;else{l.anchor=P(e);let q=Y;for(;q;)if(q=P(q),q&&q.nodeType===8&&q.data==="teleport anchor"){l.targetAnchor=q,K._lpa=l.targetAnchor&&P(l.targetAnchor);break}j(Y,l,K,d,g,b,E)}}return l.anchor&&P(l.anchor)}const mk=fk,Tr=Symbol(void 0),P1=Symbol(void 0),Ed=Symbol(void 0),K0=Symbol(void 0),t_=[];let th=null;function bm(e=!1){t_.push(th=e?null:[])}function gk(){t_.pop(),th=t_[t_.length-1]||null}let h_=1;function Kw(e){h_+=e}function _k(e){return e.dynamicChildren=h_>0?th||Sm:null,gk(),h_>0&&th&&th.push(e),e}function wm(e,l,d,g,b,E){return _k(ir(e,l,d,g,b,E,!0))}function Mx(e){return e?e.__v_isVNode===!0:!1}function gp(e,l){return e.type===l.type&&e.key===l.key}const Iv="__vInternal",yE=({key:e})=>e!=null?e:null,Zy=({ref:e,ref_key:l,ref_for:d})=>e!=null?Ms(e)||us(e)||yr(e)?{i:hu,r:e,k:l,f:!!d}:e:null;function ir(e,l=null,d=null,g=0,b=null,E=e===Tr?0:1,P=!1,i=!1){const F={__v_isVNode:!0,__v_skip:!0,type:e,props:l,key:l&&yE(l),ref:l&&Zy(l),scopeId:QT,slotScopeIds:null,children:d,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:E,patchFlag:g,dynamicProps:b,dynamicChildren:null,appContext:null};return i?(z1(F,d),E&128&&e.normalize(F)):d&&(F.shapeFlag|=Ms(d)?8:16),h_>0&&!P&&th&&(F.patchFlag>0||E&6)&&F.patchFlag!==32&&th.push(F),F}const ce=yk;function yk(e,l=null,d=null,g=0,b=null,E=!1){if((!e||e===uE)&&(e=Ed),Mx(e)){const i=Id(e,l,!0);return d&&z1(i,d),h_>0&&!E&&th&&(i.shapeFlag&6?th[th.indexOf(e)]=i:th.push(i)),i.patchFlag|=-2,i}if(Mk(e)&&(e=e.__vccOpts),l){l=vk(l);let{class:i,style:F}=l;i&&!Ms(i)&&(l.class=l1(i)),Qo(F)&&(NT(F)&&!nr(F)&&(F=_a({},F)),l.style=a1(F))}const P=Ms(e)?1:VM(e)?128:dk(e)?64:Qo(e)?4:yr(e)?2:0;return ir(e,l,d,g,b,P,E,!0)}function vk(e){return e?NT(e)||Iv in e?_a({},e):e:null}function Id(e,l,d=!1){const{props:g,ref:b,patchFlag:E,children:P}=e,i=l?zn(g||{},l):g;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:i,key:i&&yE(i),ref:l&&l.ref?d&&b?nr(b)?b.concat(Zy(l)):[b,Zy(l)]:Zy(l):b,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:P,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:l&&e.type!==Tr?E===-1?16:E|16:E,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Id(e.ssContent),ssFallback:e.ssFallback&&Id(e.ssFallback),el:e.el,anchor:e.anchor}}function Yo(e=" ",l=0){return ce(P1,null,e,l)}function Ph(e){return e==null||typeof e=="boolean"?ce(Ed):nr(e)?ce(Tr,null,e.slice()):typeof e=="object"?Sf(e):ce(P1,null,String(e))}function Sf(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Id(e)}function z1(e,l){let d=0;const{shapeFlag:g}=e;if(l==null)l=null;else if(nr(l))d=16;else if(typeof l=="object")if(g&65){const b=l.default;b&&(b._c&&(b._d=!1),z1(e,b()),b._c&&(b._d=!0));return}else{d=32;const b=l._;!b&&!(Iv in l)?l._ctx=hu:b===3&&hu&&(hu.slots._===1?l._=1:(l._=2,e.patchFlag|=1024))}else yr(l)?(l={default:l,_ctx:hu},d=32):(l=String(l),g&64?(d=16,l=[Yo(l)]):d=8);e.children=l,e.shapeFlag|=d}function zn(...e){const l={};for(let d=0;d<e.length;d++){const g=e[d];for(const b in g)if(b==="class")l.class!==g.class&&(l.class=l1([l.class,g.class]));else if(b==="style")l.style=a1([l.style,g.style]);else if(yv(b)){const E=l[b],P=g[b];P&&E!==P&&!(nr(E)&&E.includes(P))&&(l[b]=E?[].concat(E,P):P)}else b!==""&&(l[b]=g[b])}return l}function kh(e,l,d,g=null){pu(e,l,7,[d,g])}const xk=_E();let bk=0;function wk(e,l,d){const g=e.type,b=(l?l.appContext:e.appContext)||xk,E={uid:bk++,vnode:e,type:g,parent:l,appContext:b,root:null,next:null,subTree:null,effect:null,update:null,scope:new AT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:l?l.provides:Object.create(b.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:fE(g,b),emitsOptions:JT(g,b),emit:null,emitted:null,propsDefaults:Oo,inheritAttrs:g.inheritAttrs,ctx:Oo,data:Oo,props:Oo,attrs:Oo,slots:Oo,refs:Oo,setupState:Oo,setupContext:null,suspense:d,suspenseId:d?d.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return E.ctx={_:E},E.root=l?l.root:E,E.emit=LM.bind(null,E),e.ce&&e.ce(E),E}let ga=null;const Av=()=>ga||hu,Dm=e=>{ga=e,e.scope.on()},Ep=()=>{ga&&ga.scope.off(),ga=null};function vE(e){return e.vnode.shapeFlag&4}let d_=!1;function Tk(e,l=!1){d_=l;const{props:d,children:g}=e.vnode,b=vE(e);ik(e,d,b,l),ok(e,g);const E=b?Ek(e,l):void 0;return d_=!1,E}function Ek(e,l){const d=e.type;e.accessCache=Object.create(null),e.proxy=UT(new Proxy(e.ctx,KM));const{setup:g}=d;if(g){const b=e.setupContext=g.length>1?Ck(e):null;Dm(e),Mp();const E=Td(g,e,0,[e.props,b]);if(kp(),Ep(),ST(E)){if(E.then(Ep,Ep),l)return E.then(P=>{Yw(e,P,l)}).catch(P=>{wv(P,e,0)});e.asyncDep=E}else Yw(e,E,l)}else xE(e,l)}function Yw(e,l,d){yr(l)?e.type.__ssrInlineRender?e.ssrRender=l:e.render=l:Qo(l)&&(e.setupState=qT(l)),xE(e,d)}let Jw;function xE(e,l,d){const g=e.type;if(!e.render){if(!l&&Jw&&!g.render){const b=g.template||A1(e).template;if(b){const{isCustomElement:E,compilerOptions:P}=e.appContext.config,{delimiters:i,compilerOptions:F}=g,j=_a(_a({isCustomElement:E,delimiters:i},P),F);g.render=Jw(b,j)}}e.render=g.render||ih}Dm(e),Mp(),YM(e),kp(),Ep()}function Sk(e){return new Proxy(e.attrs,{get(l,d){return xc(e,"get","$attrs"),l[d]}})}function Ck(e){const l=g=>{e.exposed=g||{}};let d;return{get attrs(){return d||(d=Sk(e))},slots:e.slots,emit:e.emit,expose:l}}function Mv(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(qT(UT(e.exposed)),{get(l,d){if(d in l)return l[d];if(d in rv)return rv[d](e)}}))}const Ik=/(?:^|[-_])(\w)/g,Ak=e=>e.replace(Ik,l=>l.toUpperCase()).replace(/[-_]/g,"");function bE(e,l=!0){return yr(e)?e.displayName||e.name:e.name||l&&e.__name}function wE(e,l,d=!1){let g=bE(l);if(!g&&l.__file){const b=l.__file.match(/([^/\\]+)\.\w+$/);b&&(g=b[1])}if(!g&&e&&e.parent){const b=E=>{for(const P in E)if(E[P]===l)return P};g=b(e.components||e.parent.type.components)||b(e.appContext.components)}return g?Ak(g):d?"App":"Anonymous"}function Mk(e){return yr(e)&&"__vccOpts"in e}const He=(e,l)=>TM(e,l,d_);function Df(e,l,d){const g=arguments.length;return g===2?Qo(l)&&!nr(l)?Mx(l)?ce(e,null,[l]):ce(e,l):ce(e,null,l):(g>3?d=Array.prototype.slice.call(arguments,2):g===3&&Mx(d)&&(d=[d]),ce(e,l,d))}const kk="3.2.41",Pk="http://www.w3.org/2000/svg",_p=typeof document<"u"?document:null,Qw=_p&&_p.createElement("template"),zk={insert:(e,l,d)=>{l.insertBefore(e,d||null)},remove:e=>{const l=e.parentNode;l&&l.removeChild(e)},createElement:(e,l,d,g)=>{const b=l?_p.createElementNS(Pk,e):_p.createElement(e,d?{is:d}:void 0);return e==="select"&&g&&g.multiple!=null&&b.setAttribute("multiple",g.multiple),b},createText:e=>_p.createTextNode(e),createComment:e=>_p.createComment(e),setText:(e,l)=>{e.nodeValue=l},setElementText:(e,l)=>{e.textContent=l},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>_p.querySelector(e),setScopeId(e,l){e.setAttribute(l,"")},insertStaticContent(e,l,d,g,b,E){const P=d?d.previousSibling:l.lastChild;if(b&&(b===E||b.nextSibling))for(;l.insertBefore(b.cloneNode(!0),d),!(b===E||!(b=b.nextSibling)););else{Qw.innerHTML=g?`<svg>${e}</svg>`:e;const i=Qw.content;if(g){const F=i.firstChild;for(;F.firstChild;)i.appendChild(F.firstChild);i.removeChild(F)}l.insertBefore(i,d)}return[P?P.nextSibling:l.firstChild,d?d.previousSibling:l.lastChild]}};function Dk(e,l,d){const g=e._vtc;g&&(l=(l?[l,...g]:[...g]).join(" ")),l==null?e.removeAttribute("class"):d?e.setAttribute("class",l):e.className=l}function Lk(e,l,d){const g=e.style,b=Ms(d);if(d&&!b){for(const E in d)kx(g,E,d[E]);if(l&&!Ms(l))for(const E in l)d[E]==null&&kx(g,E,"")}else{const E=g.display;b?l!==d&&(g.cssText=d):l&&e.removeAttribute("style"),"_vod"in e&&(g.display=E)}}const e2=/\s*!important$/;function kx(e,l,d){if(nr(d))d.forEach(g=>kx(e,l,g));else if(d==null&&(d=""),l.startsWith("--"))e.setProperty(l,d);else{const g=Bk(e,l);e2.test(d)?e.setProperty(Rm(g),d.replace(e2,""),"important"):e[g]=d}}const t2=["Webkit","Moz","ms"],Y0={};function Bk(e,l){const d=Y0[l];if(d)return d;let g=_u(l);if(g!=="filter"&&g in e)return Y0[l]=g;g=zf(g);for(let b=0;b<t2.length;b++){const E=t2[b]+g;if(E in e)return Y0[l]=E}return l}const i2="http://www.w3.org/1999/xlink";function Rk(e,l,d,g,b){if(g&&l.startsWith("xlink:"))d==null?e.removeAttributeNS(i2,l.slice(6,l.length)):e.setAttributeNS(i2,l,d);else{const E=BA(l);d==null||E&&!wT(d)?e.removeAttribute(l):e.setAttribute(l,E?"":d)}}function Ok(e,l,d,g,b,E,P){if(l==="innerHTML"||l==="textContent"){g&&P(g,b,E),e[l]=d==null?"":d;return}if(l==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=d;const F=d==null?"":d;(e.value!==F||e.tagName==="OPTION")&&(e.value=F),d==null&&e.removeAttribute(l);return}let i=!1;if(d===""||d==null){const F=typeof e[l];F==="boolean"?d=wT(d):d==null&&F==="string"?(d="",i=!0):F==="number"&&(d=0,i=!0)}try{e[l]=d}catch{}i&&e.removeAttribute(l)}function Tm(e,l,d,g){e.addEventListener(l,d,g)}function Fk(e,l,d,g){e.removeEventListener(l,d,g)}function Vk(e,l,d,g,b=null){const E=e._vei||(e._vei={}),P=E[l];if(g&&P)P.value=g;else{const[i,F]=Nk(l);if(g){const j=E[l]=jk(g,b);Tm(e,i,j,F)}else P&&(Fk(e,i,P,F),E[l]=void 0)}}const n2=/(?:Once|Passive|Capture)$/;function Nk(e){let l;if(n2.test(e)){l={};let g;for(;g=e.match(n2);)e=e.slice(0,e.length-g[0].length),l[g[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Rm(e.slice(2)),l]}let J0=0;const Uk=Promise.resolve(),$k=()=>J0||(Uk.then(()=>J0=0),J0=Date.now());function jk(e,l){const d=g=>{if(!g._vts)g._vts=Date.now();else if(g._vts<=d.attached)return;pu(Gk(g,d.value),l,5,[g])};return d.value=e,d.attached=$k(),d}function Gk(e,l){if(nr(l)){const d=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{d.call(e),e._stopped=!0},l.map(g=>b=>!b._stopped&&g&&g(b))}else return l}const r2=/^on[a-z]/,qk=(e,l,d,g,b=!1,E,P,i,F)=>{l==="class"?Dk(e,g,b):l==="style"?Lk(e,d,g):yv(l)?c1(l)||Vk(e,l,d,g,P):(l[0]==="."?(l=l.slice(1),!0):l[0]==="^"?(l=l.slice(1),!1):Zk(e,l,g,b))?Ok(e,l,g,E,P,i,F):(l==="true-value"?e._trueValue=g:l==="false-value"&&(e._falseValue=g),Rk(e,l,g,b))};function Zk(e,l,d,g){return g?!!(l==="innerHTML"||l==="textContent"||l in e&&r2.test(l)&&yr(d)):l==="spellcheck"||l==="draggable"||l==="translate"||l==="form"||l==="list"&&e.tagName==="INPUT"||l==="type"&&e.tagName==="TEXTAREA"||r2.test(l)&&Ms(d)?!1:l in e}const bf="transition",Gg="animation",Rh=(e,{slots:l})=>Df(iE,EE(e),l);Rh.displayName="Transition";const TE={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Wk=Rh.props=_a({},iE.props,TE),up=(e,l=[])=>{nr(e)?e.forEach(d=>d(...l)):e&&e(...l)},o2=e=>e?nr(e)?e.some(l=>l.length>1):e.length>1:!1;function EE(e){const l={};for(const At in e)At in TE||(l[At]=e[At]);if(e.css===!1)return l;const{name:d="v",type:g,duration:b,enterFromClass:E=`${d}-enter-from`,enterActiveClass:P=`${d}-enter-active`,enterToClass:i=`${d}-enter-to`,appearFromClass:F=E,appearActiveClass:j=P,appearToClass:K=i,leaveFromClass:Y=`${d}-leave-from`,leaveActiveClass:q=`${d}-leave-active`,leaveToClass:re=`${d}-leave-to`}=e,me=Xk(b),we=me&&me[0],je=me&&me[1],{onBeforeEnter:$e,onEnter:tt,onEnterCancelled:Ae,onLeave:mt,onLeaveCancelled:Me,onBeforeAppear:Ye=$e,onAppear:Ze=tt,onAppearCancelled:rt=Ae}=l,gt=(At,ti,Nt)=>{Ef(At,ti?K:i),Ef(At,ti?j:P),Nt&&Nt()},vt=(At,ti)=>{At._isLeaving=!1,Ef(At,Y),Ef(At,re),Ef(At,q),ti&&ti()},Ut=At=>(ti,Nt)=>{const Wt=At?Ze:tt,zt=()=>gt(ti,At,Nt);up(Wt,[ti,zt]),s2(()=>{Ef(ti,At?F:E),xd(ti,At?K:i),o2(Wt)||a2(ti,g,we,zt)})};return _a(l,{onBeforeEnter(At){up($e,[At]),xd(At,E),xd(At,P)},onBeforeAppear(At){up(Ye,[At]),xd(At,F),xd(At,j)},onEnter:Ut(!1),onAppear:Ut(!0),onLeave(At,ti){At._isLeaving=!0;const Nt=()=>vt(At,ti);xd(At,Y),CE(),xd(At,q),s2(()=>{!At._isLeaving||(Ef(At,Y),xd(At,re),o2(mt)||a2(At,g,je,Nt))}),up(mt,[At,Nt])},onEnterCancelled(At){gt(At,!1),up(Ae,[At])},onAppearCancelled(At){gt(At,!0),up(rt,[At])},onLeaveCancelled(At){vt(At),up(Me,[At])}})}function Xk(e){if(e==null)return null;if(Qo(e))return[Q0(e.enter),Q0(e.leave)];{const l=Q0(e);return[l,l]}}function Q0(e){return tv(e)}function xd(e,l){l.split(/\s+/).forEach(d=>d&&e.classList.add(d)),(e._vtc||(e._vtc=new Set)).add(l)}function Ef(e,l){l.split(/\s+/).forEach(g=>g&&e.classList.remove(g));const{_vtc:d}=e;d&&(d.delete(l),d.size||(e._vtc=void 0))}function s2(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Hk=0;function a2(e,l,d,g){const b=e._endId=++Hk,E=()=>{b===e._endId&&g()};if(d)return setTimeout(E,d);const{type:P,timeout:i,propCount:F}=SE(e,l);if(!P)return g();const j=P+"end";let K=0;const Y=()=>{e.removeEventListener(j,q),E()},q=re=>{re.target===e&&++K>=F&&Y()};setTimeout(()=>{K<F&&Y()},i+1),e.addEventListener(j,q)}function SE(e,l){const d=window.getComputedStyle(e),g=me=>(d[me]||"").split(", "),b=g(bf+"Delay"),E=g(bf+"Duration"),P=l2(b,E),i=g(Gg+"Delay"),F=g(Gg+"Duration"),j=l2(i,F);let K=null,Y=0,q=0;l===bf?P>0&&(K=bf,Y=P,q=E.length):l===Gg?j>0&&(K=Gg,Y=j,q=F.length):(Y=Math.max(P,j),K=Y>0?P>j?bf:Gg:null,q=K?K===bf?E.length:F.length:0);const re=K===bf&&/\b(transform|all)(,|$)/.test(d[bf+"Property"]);return{type:K,timeout:Y,propCount:q,hasTransform:re}}function l2(e,l){for(;e.length<l.length;)e=e.concat(e);return Math.max(...l.map((d,g)=>c2(d)+c2(e[g])))}function c2(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function CE(){return document.body.offsetHeight}const IE=new WeakMap,AE=new WeakMap,Kk={name:"TransitionGroup",props:_a({},Wk,{tag:String,moveClass:String}),setup(e,{slots:l}){const d=Av(),g=tE();let b,E;return lE(()=>{if(!b.length)return;const P=e.moveClass||`${e.name||"v"}-move`;if(!tP(b[0].el,d.vnode.el,P))return;b.forEach(Jk),b.forEach(Qk);const i=b.filter(eP);CE(),i.forEach(F=>{const j=F.el,K=j.style;xd(j,P),K.transform=K.webkitTransform=K.transitionDuration="";const Y=j._moveCb=q=>{q&&q.target!==j||(!q||/transform$/.test(q.propertyName))&&(j.removeEventListener("transitionend",Y),j._moveCb=null,Ef(j,P))};j.addEventListener("transitionend",Y)})}),()=>{const P=Nr(e),i=EE(P);let F=P.tag||Tr;b=E,E=l.default?E1(l.default()):[];for(let j=0;j<E.length;j++){const K=E[j];K.key!=null&&u_(K,c_(K,i,g,d))}if(b)for(let j=0;j<b.length;j++){const K=b[j];u_(K,c_(K,i,g,d)),IE.set(K,K.el.getBoundingClientRect())}return ce(F,null,E)}}},Yk=Kk;function Jk(e){const l=e.el;l._moveCb&&l._moveCb(),l._enterCb&&l._enterCb()}function Qk(e){AE.set(e,e.el.getBoundingClientRect())}function eP(e){const l=IE.get(e),d=AE.get(e),g=l.left-d.left,b=l.top-d.top;if(g||b){const E=e.el.style;return E.transform=E.webkitTransform=`translate(${g}px,${b}px)`,E.transitionDuration="0s",e}}function tP(e,l,d){const g=e.cloneNode();e._vtc&&e._vtc.forEach(P=>{P.split(/\s+/).forEach(i=>i&&g.classList.remove(i))}),d.split(/\s+/).forEach(P=>P&&g.classList.add(P)),g.style.display="none";const b=l.nodeType===1?l:l.parentNode;b.appendChild(g);const{hasTransform:E}=SE(g);return b.removeChild(g),E}const u2=e=>{const l=e.props["onUpdate:modelValue"]||!1;return nr(l)?d=>Gy(l,d):l};function iP(e){e.target.composing=!0}function h2(e){const l=e.target;l.composing&&(l.composing=!1,l.dispatchEvent(new Event("input")))}const nP={created(e,{modifiers:{lazy:l,trim:d,number:g}},b){e._assign=u2(b);const E=g||b.props&&b.props.type==="number";Tm(e,l?"change":"input",P=>{if(P.target.composing)return;let i=e.value;d&&(i=i.trim()),E&&(i=tv(i)),e._assign(i)}),d&&Tm(e,"change",()=>{e.value=e.value.trim()}),l||(Tm(e,"compositionstart",iP),Tm(e,"compositionend",h2),Tm(e,"change",h2))},mounted(e,{value:l}){e.value=l==null?"":l},beforeUpdate(e,{value:l,modifiers:{lazy:d,trim:g,number:b}},E){if(e._assign=u2(E),e.composing||document.activeElement===e&&e.type!=="range"&&(d||g&&e.value.trim()===l||(b||e.type==="number")&&tv(e.value)===l))return;const P=l==null?"":l;e.value!==P&&(e.value=P)}},na={beforeMount(e,{value:l},{transition:d}){e._vod=e.style.display==="none"?"":e.style.display,d&&l?d.beforeEnter(e):qg(e,l)},mounted(e,{value:l},{transition:d}){d&&l&&d.enter(e)},updated(e,{value:l,oldValue:d},{transition:g}){!l!=!d&&(g?l?(g.beforeEnter(e),qg(e,!0),g.enter(e)):g.leave(e,()=>{qg(e,!1)}):qg(e,l))},beforeUnmount(e,{value:l}){qg(e,l)}};function qg(e,l){e.style.display=l?e._vod:"none"}const rP=_a({patchProp:qk},zk);let d2;function oP(){return d2||(d2=ck(rP))}const sP=(...e)=>{const l=oP().createApp(...e),{mount:d}=l;return l.mount=g=>{const b=aP(g);if(!b)return;const E=l._component;!yr(E)&&!E.render&&!E.template&&(E.template=b.innerHTML),b.innerHTML="";const P=d(b,!1,b instanceof SVGElement);return b instanceof Element&&(b.removeAttribute("v-cloak"),b.setAttribute("data-v-app","")),P},l};function aP(e){return Ms(e)?document.querySelector(e):e}const Jo=typeof window<"u",D1=Jo&&"IntersectionObserver"in window,lP=Jo&&("ontouchstart"in window||window.navigator.maxTouchPoints>0),Px=Jo&&typeof CSS<"u"&&CSS.supports("selector(:focus-visible)");function Ip(e){const l=oi(),d=oi();if(Jo){const g=new ResizeObserver(b=>{e==null||e(b,g),b.length&&(d.value=b[0].contentRect)});Xl(()=>{g.disconnect()}),Mn(l,(b,E)=>{E&&(g.unobserve(E),d.value=void 0),b&&g.observe(b)},{flush:"post"})}return{resizeRef:l,contentRect:w_(d)}}function f2(e,l,d){cP(e,l),l.set(e,d)}function cP(e,l){if(l.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function uP(e,l,d){var g=ME(e,l,"set");return hP(e,g,d),d}function hP(e,l,d){if(l.set)l.set.call(e,d);else{if(!l.writable)throw new TypeError("attempted to set read only private field");l.value=d}}function hp(e,l){var d=ME(e,l,"get");return dP(e,d)}function ME(e,l,d){if(!l.has(e))throw new TypeError("attempted to "+d+" private field on non-instance");return l.get(e)}function dP(e,l){return l.get?l.get.call(e):l.value}function kE(e,l,d){const g=l.length-1;if(g<0)return e===void 0?d:e;for(let b=0;b<g;b++){if(e==null)return d;e=e[l[b]]}return e==null||e[l[g]]===void 0?d:e[l[g]]}function T_(e,l){if(e===l)return!0;if(e instanceof Date&&l instanceof Date&&e.getTime()!==l.getTime()||e!==Object(e)||l!==Object(l))return!1;const d=Object.keys(e);return d.length!==Object.keys(l).length?!1:d.every(g=>T_(e[g],l[g]))}function zx(e,l,d){return e==null||!l||typeof l!="string"?d:e[l]!==void 0?e[l]:(l=l.replace(/\[(\w+)\]/g,".$1"),l=l.replace(/^\./,""),kE(e,l.split("."),d))}function Lh(e,l,d){if(l==null)return e===void 0?d:e;if(e!==Object(e))return d;if(typeof l=="string")return zx(e,l,d);if(Array.isArray(l))return kE(e,l,d);if(typeof l!="function")return d;const g=l(e,d);return typeof g>"u"?d:g}function vp(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:e},(d,g)=>l+g)}function pn(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(!(e==null||e===""))return isNaN(+e)?String(e):isFinite(+e)?`${Number(e)}${l}`:void 0}function Dx(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function fP(e){return e==null?void 0:e.$el}const p2=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16}),Lx=Object.freeze({enter:"Enter",tab:"Tab",delete:"Delete",esc:"Escape",space:"Space",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",end:"End",home:"Home",del:"Delete",backspace:"Backspace",insert:"Insert",pageup:"PageUp",pagedown:"PageDown",shift:"Shift"});function PE(e){return Object.keys(e)}function nh(e,l){const d=Object.create(null),g=Object.create(null);for(const b in e)l.some(E=>E instanceof RegExp?E.test(b):E===b)?d[b]=e[b]:g[b]=e[b];return[d,g]}function Pp(e){return nh(e,["class","style","id",/^data-/])}function mu(e){return e==null?[]:Array.isArray(e)?e:[e]}function du(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(l,Math.min(d,e))}function ex(e,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return e+d.repeat(Math.max(0,l-e.length))}function pP(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const d=[];let g=0;for(;g<e.length;)d.push(e.substr(g,l)),g+=l;return d}function m2(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;if(e<l)return`${e} B`;const d=l===1024?["Ki","Mi","Gi"]:["k","M","G"];let g=-1;for(;Math.abs(e)>=l&&g<d.length-1;)e/=l,++g;return`${e.toFixed(1)} ${d[g]}B`}function Ad(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const g={};for(const b in e)g[b]=e[b];for(const b in l){const E=e[b],P=l[b];if(Dx(E)&&Dx(P)){g[b]=Ad(E,P,d);continue}if(Array.isArray(E)&&Array.isArray(P)&&d){g[b]=d(E,P);continue}g[b]=P}return g}function zE(e){return e.map(l=>l.type===Tr?zE(l.children):l).flat()}function L1(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase()}function i_(e,l){if(!l||typeof l!="object")return[];if(Array.isArray(l))return l.map(d=>i_(e,d)).flat(1);if(Array.isArray(l.children))return l.children.map(d=>i_(e,d)).flat(1);if(l.component){if(Object.getOwnPropertySymbols(l.component.provides).includes(e))return[l.component];if(l.component.subTree)return i_(e,l.component.subTree).flat(1)}return[]}var Fy=new WeakMap,_m=new WeakMap;class mP{constructor(l){f2(this,Fy,{writable:!0,value:[]}),f2(this,_m,{writable:!0,value:0}),this.size=l}push(l){hp(this,Fy)[hp(this,_m)]=l,uP(this,_m,(hp(this,_m)+1)%this.size)}values(){return hp(this,Fy).slice(hp(this,_m)).concat(hp(this,Fy).slice(0,hp(this,_m)))}}function gP(e){return"touches"in e?{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:{clientX:e.clientX,clientY:e.clientY}}function B1(e){const l=wl({}),d=He(e);return Oh(()=>{for(const g in d.value)l[g]=d.value[g]},{flush:"sync"}),x1(l)}function sv(e,l){return e.includes(l)}const _P=/^on[^a-z]/,DE=e=>_P.test(e),n_=[Function,Array];function av(e){for(var l=arguments.length,d=new Array(l>1?l-1:0),g=1;g<l;g++)d[g-1]=arguments[g];if(Array.isArray(e))for(const b of e)b(...d);else typeof e=="function"&&e(...d)}const LE=["top","bottom"],yP=["start","end","left","right"];function Bx(e,l){let[d,g]=e.split(" ");return g||(g=sv(LE,d)?"start":sv(yP,d)?"top":"center"),{side:Rx(d,l),align:Rx(g,l)}}function Rx(e,l){return e==="start"?l?"right":"left":e==="end"?l?"left":"right":e}function tx(e){return{side:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[e.side],align:e.align}}function ix(e){return{side:e.side,align:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[e.align]}}function g2(e){return{side:e.align,align:e.side}}function _2(e){return sv(LE,e.side)?"y":"x"}class Mm{constructor(l){let{x:d,y:g,width:b,height:E}=l;this.x=d,this.y=g,this.width=b,this.height=E}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}}function y2(e,l){return{x:{before:Math.max(0,l.left-e.left),after:Math.max(0,e.right-l.right)},y:{before:Math.max(0,l.top-e.top),after:Math.max(0,e.bottom-l.bottom)}}}function R1(e){const l=e.getBoundingClientRect(),d=getComputedStyle(e),g=d.transform;if(g){let b,E,P,i,F;if(g.startsWith("matrix3d("))b=g.slice(9,-1).split(/, /),E=+b[0],P=+b[5],i=+b[12],F=+b[13];else if(g.startsWith("matrix("))b=g.slice(7,-1).split(/, /),E=+b[0],P=+b[3],i=+b[4],F=+b[5];else return new Mm(l);const j=d.transformOrigin,K=l.x-i-(1-E)*parseFloat(j),Y=l.y-F-(1-P)*parseFloat(j.slice(j.indexOf(" ")+1)),q=E?l.width/E:e.offsetWidth+1,re=P?l.height/P:e.offsetHeight+1;return new Mm({x:K,y:Y,width:q,height:re})}else return new Mm(l)}function xp(e,l,d){if(typeof e.animate>"u")return{finished:Promise.resolve()};const g=e.animate(l,d);return typeof g.finished>"u"&&(g.finished=new Promise(b=>{g.onfinish=()=>{b(g)}})),g}function BE(e,l,d){if(d&&(l={_isVue:!0,$parent:d,$options:l}),l){if(l.$_alreadyWarned=l.$_alreadyWarned||[],l.$_alreadyWarned.includes(e))return;l.$_alreadyWarned.push(e)}return`[Vuetify] ${e}`+(l?bP(l):"")}function Sp(e,l,d){const g=BE(e,l,d);g!=null&&console.warn(g)}function Ox(e,l,d){const g=BE(e,l,d);g!=null&&console.error(g)}const vP=/(?:^|[-_])(\w)/g,xP=e=>e.replace(vP,l=>l.toUpperCase()).replace(/[-_]/g,"");function nx(e,l){if(e.$root===e)return"<Root>";const d=typeof e=="function"&&e.cid!=null?e.options:e._isVue?e.$options||e.constructor.options:e||{};let g=d.name||d._componentTag;const b=d.__file;if(!g&&b){const E=b.match(/([^/\\]+)\.vue$/);g=E==null?void 0:E[1]}return(g?`<${xP(g)}>`:"<Anonymous>")+(b&&l!==!1?` at ${b}`:"")}function bP(e){if(e._isVue&&e.$parent){const l=[];let d=0;for(;e;){if(l.length>0){const g=l[l.length-1];if(g.constructor===e.constructor){d++,e=e.$parent;continue}else d>0&&(l[l.length-1]=[g,d],d=0)}l.push(e),e=e.$parent}return`

found in

`+l.map((g,b)=>`${b===0?"---> ":" ".repeat(5+b*2)}${Array.isArray(g)?`${nx(g[0])}... (${g[1]} recursive calls)`:nx(g)}`).join(`
`)}else return`

(found in ${nx(e)})`}const wP=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],TP=e=>e<=.0031308?e*12.92:1.055*e**(1/2.4)-.055,EP=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],SP=e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4;function RE(e){const l=Array(3),d=TP,g=wP;for(let b=0;b<3;++b)l[b]=Math.round(du(d(g[b][0]*e[0]+g[b][1]*e[1]+g[b][2]*e[2]))*255);return(l[0]<<16)+(l[1]<<8)+(l[2]<<0)}function O1(e){const l=[0,0,0],d=SP,g=EP,b=d((e>>16&255)/255),E=d((e>>8&255)/255),P=d((e>>0&255)/255);for(let i=0;i<3;++i)l[i]=g[i][0]*b+g[i][1]*E+g[i][2]*P;return l}const lv=.20689655172413793,CP=e=>e>lv**3?Math.cbrt(e):e/(3*lv**2)+4/29,IP=e=>e>lv?e**3:3*lv**2*(e-4/29);function OE(e){const l=CP,d=l(e[1]);return[116*d-16,500*(l(e[0]/.95047)-d),200*(d-l(e[2]/1.08883))]}function FE(e){const l=IP,d=(e[0]+16)/116;return[l(d+e[1]/500)*.95047,l(d),l(d-e[2]/200)*1.08883]}function v2(e){return!!e&&/^(#|var\(--|(rgb|hsl)a?\()/.test(e)}function cv(e){let l;if(typeof e=="number")l=e;else if(typeof e=="string"){let d=e.startsWith("#")?e.substring(1):e;d.length===3&&(d=d.split("").map(g=>g+g).join("")),d.length!==6&&d.length!==8&&Sp(`'${e}' is not a valid rgb color`),l=parseInt(d,16)}else throw new TypeError(`Colors can only be numbers or strings, recieved ${e==null?e:e.constructor.name} instead`);return l<0?(Sp(`Colors cannot be negative: '${e}'`),l=0):(l>4294967295||isNaN(l))&&(Sp(`'${e}' is not a valid rgb color`),l=16777215),l}function AP(e){let l=e.toString(16);return l.length<6&&(l="0".repeat(6-l.length)+l),"#"+l}function kv(e){const{h:l,s:d,v:g,a:b}=e,E=i=>{const F=(i+l/60)%6;return g-g*d*Math.max(Math.min(F,4-F,1),0)},P=[E(5),E(3),E(1)].map(i=>Math.round(i*255));return{r:P[0],g:P[1],b:P[2],a:b}}function F1(e){if(!e)return{h:0,s:1,v:1,a:1};const l=e.r/255,d=e.g/255,g=e.b/255,b=Math.max(l,d,g),E=Math.min(l,d,g);let P=0;b!==E&&(b===l?P=60*(0+(d-g)/(b-E)):b===d?P=60*(2+(g-l)/(b-E)):b===g&&(P=60*(4+(l-d)/(b-E)))),P<0&&(P=P+360);const i=b===0?0:(b-E)/b,F=[P,i,b];return{h:F[0],s:F[1],v:F[2],a:e.a}}function VE(e){const{h:l,s:d,v:g,a:b}=e,E=g-g*d/2,P=E===1||E===0?0:(g-E)/Math.min(E,1-E);return{h:l,s:P,l:E,a:b}}function NE(e){const{h:l,s:d,l:g,a:b}=e,E=g+d*Math.min(g,1-g),P=E===0?0:2-2*g/E;return{h:l,s:P,v:E,a:b}}function MP(e){return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}function UE(e){return MP(kv(e))}function kP(e){const l=d=>{const g=Math.round(d).toString(16);return("00".substr(0,2-g.length)+g).toUpperCase()};return`#${[l(e.r),l(e.g),l(e.b),l(Math.round(e.a*255))].join("")}`}function PP(e){const l=pP(e.slice(1),2).map(d=>parseInt(d,16));return{r:l[0],g:l[1],b:l[2],a:Math.round(l[3]/255*100)/100}}function $E(e){const l=PP(e);return F1(l)}function jE(e){return kP(kv(e))}function zP(e){return e.startsWith("#")&&(e=e.slice(1)),e=e.replace(/([^0-9a-f])/gi,"F"),(e.length===3||e.length===4)&&(e=e.split("").map(l=>l+l).join("")),e.length===6?e=ex(e,8,"F"):e=ex(ex(e,6),8,"F"),`#${e}`.toUpperCase().substr(0,9)}function GE(e){const l=cv(e);return{r:(l&16711680)>>16,g:(l&65280)>>8,b:l&255}}function DP(e,l){const d=OE(O1(e));return d[0]=d[0]+l*10,RE(FE(d))}function LP(e,l){const d=OE(O1(e));return d[0]=d[0]-l*10,RE(FE(d))}function Fx(e){const l=cv(e);return O1(l)[1]}function BP(e,l){const d=Fx(e),g=Fx(l),b=Math.max(d,g),E=Math.min(d,g);return(b+.05)/(E+.05)}function za(e,l){const d=Av();if(!d)throw new Error(`[Vuetify] ${e} ${l||"must be called from inside a setup function"}`);return d}function Pd(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const l=za(e).type;return L1((l==null?void 0:l.aliasName)||(l==null?void 0:l.name))}let qE=0,Wy=new WeakMap;function Ya(){const e=za("getUid");if(Wy.has(e))return Wy.get(e);{const l=qE++;return Wy.set(e,l),l}}Ya.reset=()=>{qE=0,Wy=new WeakMap};function RP(e){const{provides:l}=za("injectSelf");if(l&&e in l)return l[e]}const f_=Symbol.for("vuetify:defaults");function OP(e){return oi(e!=null?e:{})}function ZE(){const e=co(f_);if(!e)throw new Error("[Vuetify] Could not find defaults instance");return e}function Vs(e,l){const d=ZE(),g=oi(e),b=He(()=>{const E=If(l==null?void 0:l.scoped),P=If(l==null?void 0:l.reset),i=If(l==null?void 0:l.root);let F=Ad(g.value,{prev:d.value});if(E)return F;if(P||i){const j=Number(P||1/0);for(let K=0;K<=j&&F.prev;K++)F=F.prev;return F}return Ad(F.prev,F)});return ra(f_,b),b}function mr(e,l){return d=>Object.keys(e).reduce((g,b)=>{const P=typeof e[b]=="object"&&e[b]!=null&&!Array.isArray(e[b])?e[b]:{type:e[b]};return d&&b in d?g[b]={...P,default:d[b]}:g[b]=P,l&&!g[b].source&&(g[b].source=l),g},{})}function FP(e,l){const d={...e};return l.forEach(g=>delete d[g]),d}function VP(e,l){var d,g;return((d=e.props)==null?void 0:d.hasOwnProperty(l))||((g=e.props)==null?void 0:g.hasOwnProperty(L1(l)))}const $i=function(l){var d,g;return l._setup=(d=l._setup)!=null?d:l.setup,l.name?(l._setup&&(l.props=(g=l.props)!=null?g:{},l.props=mr(l.props,l.name)(),l.props._as=String,l.setup=function(E,P){const i=Av(),F=ZE(),j=yM(),K=VT({...Nr(E)});Oh(()=>{var we,je,$e;const re=F.value.global,me=F.value[(we=E._as)!=null?we:l.name];if(me){const tt=Object.entries(me).filter(Ae=>{let[mt]=Ae;return mt.startsWith("V")});tt.length&&(j.value=Object.fromEntries(tt))}for(const tt of Object.keys(E)){let Ae=E[tt];VP(i.vnode,tt)||(Ae=($e=(je=me==null?void 0:me[tt])!=null?je:re==null?void 0:re[tt])!=null?$e:E[tt]),K[tt]!==Ae&&(K[tt]=Ae)}});const Y=l._setup(K,P);let q;return Mn(j,(re,me)=>{!re&&q?q.stop():re&&!me&&(q=b_(),q.run(()=>{var je;var we;Vs(Ad((je=(we=RP(f_))==null?void 0:we.value)!=null?je:{},re))}))},{immediate:!0}),Y}),l):(Sp("The component is missing an explicit name, unable to generate default prop value"),l)};function es(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return l=>(e?$i:S1)(l)}function yu(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",d=arguments.length>2?arguments[2]:void 0;return $i({name:d!=null?d:zf(_u(e.replace(/__/g,"-"))),props:{tag:{type:String,default:l}},setup(g,b){let{slots:E}=b;return()=>{var P;return Df(g.tag,{class:e},(P=E.default)==null?void 0:P.call(E))}}})}function WE(e){if(typeof e.getRootNode!="function"){for(;e.parentNode;)e=e.parentNode;return e!==document?null:document}const l=e.getRootNode();return l!==document&&l.getRootNode({composed:!0})!==document?null:l}const p_="cubic-bezier(0.4, 0, 0.2, 1)",NP="cubic-bezier(0.0, 0, 0.2, 1)",UP="cubic-bezier(0.4, 0, 1, 1)";function XE(e){for(;e;){if(V1(e))return e;e=e.parentElement}return document.scrollingElement}function uv(e,l){const d=[];if(l&&e&&!l.contains(e))return d;for(;e&&(V1(e)&&d.push(e),e!==l);)e=e.parentElement;return d}function V1(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const l=window.getComputedStyle(e);return l.overflowY==="scroll"||l.overflowY==="auto"&&e.scrollHeight>e.clientHeight}function $P(e){for(;e;){if(window.getComputedStyle(e).position==="fixed")return!0;e=e.offsetParent}return!1}function Ui(e){const l=za("useRender");l.render=e}const hv=Symbol.for("vuetify:layout"),HE=Symbol.for("vuetify:layout-item"),x2=1e3,KE=mr({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),Om=mr({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function jP(){const e=co(hv);if(!e)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:e.getLayoutItem,mainRect:e.mainRect,mainStyles:e.mainStyles}}function Fm(e){var i;const l=co(hv);if(!l)throw new Error("[Vuetify] Could not find injected layout");const d=(i=e.id)!=null?i:`layout-item-${Ya()}`,g=za("useLayoutItem");ra(HE,{id:d});const b=oi(!1);oE(()=>b.value=!0),rE(()=>b.value=!1);const{layoutItemStyles:E,layoutItemScrimStyles:P}=l.register(g,{...e,active:He(()=>b.value?!1:e.active.value),id:d});return Xl(()=>l.unregister(d)),{layoutItemStyles:E,layoutRect:l.layoutRect,layoutItemScrimStyles:P}}const GP=(e,l,d,g)=>{let b={top:0,left:0,right:0,bottom:0};const E=[{id:"",layer:{...b}}];for(const P of e){const i=l.get(P),F=d.get(P),j=g.get(P);if(!i||!F||!j)continue;const K={...b,[i.value]:parseInt(b[i.value],10)+(j.value?parseInt(F.value,10):0)};E.push({id:P,layer:K}),b=K}return E};function YE(e){const l=co(hv,null),d=He(()=>l?l.rootZIndex.value-100:x2),g=oi([]),b=wl(new Map),E=wl(new Map),P=wl(new Map),i=wl(new Map),F=wl(new Map),{resizeRef:j,contentRect:K}=Ip(),Y=He(()=>{var rt;const Ye=new Map,Ze=(rt=e.overlaps)!=null?rt:[];for(const gt of Ze.filter(vt=>vt.includes(":"))){const[vt,Ut]=gt.split(":");if(!g.value.includes(vt)||!g.value.includes(Ut))continue;const At=b.get(vt),ti=b.get(Ut),Nt=E.get(vt),Wt=E.get(Ut);!At||!ti||!Nt||!Wt||(Ye.set(Ut,{position:At.value,amount:parseInt(Nt.value,10)}),Ye.set(vt,{position:ti.value,amount:-parseInt(Wt.value,10)}))}return Ye}),q=He(()=>{const Ye=[...new Set([...P.values()].map(rt=>rt.value))].sort((rt,gt)=>rt-gt),Ze=[];for(const rt of Ye){const gt=g.value.filter(vt=>{var Ut;return((Ut=P.get(vt))==null?void 0:Ut.value)===rt});Ze.push(...gt)}return GP(Ze,b,E,i)}),re=He(()=>!Array.from(F.values()).some(Ye=>Ye.value)),me=He(()=>q.value[q.value.length-1].layer),we=He(()=>({"--v-layout-left":pn(me.value.left),"--v-layout-right":pn(me.value.right),"--v-layout-top":pn(me.value.top),"--v-layout-bottom":pn(me.value.bottom),...re.value?void 0:{transition:"none"}})),je=He(()=>q.value.slice(1).map((Ye,Ze)=>{let{id:rt}=Ye;const{layer:gt}=q.value[Ze],vt=E.get(rt),Ut=b.get(rt);return{id:rt,...gt,size:Number(vt.value),position:Ut.value}})),$e=Ye=>je.value.find(Ze=>Ze.id===Ye),tt=za("createLayout"),Ae=oi(!1);Wl(()=>{Ae.value=!0}),ra(hv,{register:(Ye,Ze)=>{let{id:rt,order:gt,position:vt,layoutSize:Ut,elementSize:At,active:ti,disableTransitions:Nt,absolute:Wt}=Ze;P.set(rt,gt),b.set(rt,vt),E.set(rt,Ut),i.set(rt,ti),Nt&&F.set(rt,Nt);const Yt=i_(HE,tt==null?void 0:tt.vnode).indexOf(Ye);Yt>-1?g.value.splice(Yt,0,rt):g.value.push(rt);const vi=He(()=>je.value.findIndex(mn=>mn.id===rt)),cn=He(()=>d.value+q.value.length*2-vi.value*2),di=He(()=>{const mn=vt.value==="left"||vt.value==="right",Er=vt.value==="right",Li=vt.value==="bottom",En={[vt.value]:0,zIndex:cn.value,transform:`translate${mn?"X":"Y"}(${(ti.value?0:-110)*(Er||Li?-1:1)}%)`,position:Wt.value||d.value!==x2?"absolute":"fixed",...re.value?void 0:{transition:"none"}};if(!Ae.value)return En;const wn=je.value[vi.value];if(!wn)throw new Error(`[Vuetify] Could not find layout item "${rt}"`);const vr=Y.value.get(rt);return vr&&(wn[vr.position]+=vr.amount),{...En,height:mn?`calc(100% - ${wn.top}px - ${wn.bottom}px)`:At.value?`${At.value}px`:void 0,left:Er?void 0:`${wn.left}px`,right:Er?`${wn.right}px`:void 0,top:vt.value!=="bottom"?`${wn.top}px`:void 0,bottom:vt.value!=="top"?`${wn.bottom}px`:void 0,width:mn?At.value?`${At.value}px`:void 0:`calc(100% - ${wn.left}px - ${wn.right}px)`}}),un=He(()=>({zIndex:cn.value-1}));return{layoutItemStyles:di,layoutItemScrimStyles:un,zIndex:cn}},unregister:Ye=>{P.delete(Ye),b.delete(Ye),E.delete(Ye),i.delete(Ye),F.delete(Ye),g.value=g.value.filter(Ze=>Ze!==Ye)},mainRect:me,mainStyles:we,getLayoutItem:$e,items:je,layoutRect:K,rootZIndex:d});const mt=He(()=>["v-layout",{"v-layout--full-height":e.fullHeight}]),Me=He(()=>({zIndex:d.value,position:l?"relative":void 0,overflow:l?"hidden":void 0}));return{layoutClasses:mt,layoutStyles:Me,getLayoutItem:$e,items:je,layoutRect:K,layoutRef:j}}const ym=2.4,b2=.2126729,w2=.7151522,T2=.072175,qP=.55,ZP=.58,WP=.57,XP=.62,Vy=.03,E2=1.45,HP=5e-4,KP=1.25,YP=1.25,S2=.078,C2=12.82051282051282,Ny=.06,I2=.001;function A2(e,l){const d=((e>>16&255)/255)**ym,g=((e>>8&255)/255)**ym,b=((e>>0&255)/255)**ym,E=((l>>16&255)/255)**ym,P=((l>>8&255)/255)**ym,i=((l>>0&255)/255)**ym;let F=d*b2+g*w2+b*T2,j=E*b2+P*w2+i*T2;if(F<=Vy&&(F+=(Vy-F)**E2),j<=Vy&&(j+=(Vy-j)**E2),Math.abs(j-F)<HP)return 0;let K;if(j>F){const Y=(j**qP-F**ZP)*KP;K=Y<I2?0:Y<S2?Y-Y*C2*Ny:Y-Ny}else{const Y=(j**XP-F**WP)*YP;K=Y>-I2?0:Y>-S2?Y-Y*C2*Ny:Y+Ny}return K*100}const m_=Symbol.for("vuetify:theme"),Ur=mr({theme:String},"theme"),Zg={defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#6200EE","primary-darken-1":"#3700B3",secondary:"#03DAC6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"kbd-background-color":"#212529","kbd-color":"#FFFFFF","code-background-color":"#C2C2C2"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-variant":"#BDBDBD","on-surface-variant":"#424242",primary:"#BB86FC","primary-darken-1":"#3700B3",secondary:"#03DAC5","secondary-darken-1":"#03DAC5",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"kbd-background-color":"#212529","kbd-color":"#FFFFFF","code-background-color":"#B7B7B7"}}}};function JP(){var b;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zg;if(!e)return{...Zg,isDisabled:!0};const l={};for(const[E,P]of Object.entries((b=e.themes)!=null?b:{})){var d,g;const i=P.dark||E==="dark"?(d=Zg.themes)==null?void 0:d.dark:(g=Zg.themes)==null?void 0:g.light;l[E]=Ad(i,P)}return Ad(Zg,{...e,themes:l})}function QP(e){const l=wl(JP(e)),d=oi(l.defaultTheme),g=oi(l.themes),b=He(()=>{const j={};for(const[K,Y]of Object.entries(g.value)){const q=j[K]={...Y,colors:{...Y.colors}};if(l.variations)for(const re of l.variations.colors){const me=q.colors[re];if(!!me)for(const we of["lighten","darken"]){const je=we==="lighten"?DP:LP;for(const $e of vp(l.variations[we],1))q.colors[`${re}-${we}-${$e}`]=AP(je(cv(me),$e))}}for(const re of Object.keys(q.colors)){if(/^on-[a-z]/.test(re)||q.colors[`on-${re}`])continue;const me=`on-${re}`,we=cv(q.colors[re]),je=Math.abs(A2(0,we)),$e=Math.abs(A2(16777215,we));q.colors[me]=$e>Math.min(je,50)?"#fff":"#000"}}return j}),E=He(()=>b.value[d.value]),P=He(()=>{const j=[];E.value.dark&&vm(j,":root",["color-scheme: dark"]);for(const[re,me]of Object.entries(b.value)){const{variables:we,dark:je}=me;vm(j,`.v-theme--${re}`,[`color-scheme: ${je?"dark":"normal"}`,...e4(me),...Object.keys(we).map($e=>{const tt=we[$e],Ae=typeof tt=="string"&&tt.startsWith("#")?GE(tt):void 0,mt=Ae?`${Ae.r}, ${Ae.g}, ${Ae.b}`:void 0;return`--v-${$e}: ${mt!=null?mt:tt}`})])}const K=[],Y=[],q=new Set(Object.values(b.value).flatMap(re=>Object.keys(re.colors)));for(const re of q)/^on-[a-z]/.test(re)?vm(Y,`.${re}`,[`color: rgb(var(--v-theme-${re})) !important`]):(vm(K,`.bg-${re}`,[`--v-theme-overlay-multiplier: var(--v-theme-${re}-overlay-multiplier)`,`background: rgb(var(--v-theme-${re})) !important`,`color: rgb(var(--v-theme-on-${re})) !important`]),vm(Y,`.text-${re}`,[`color: rgb(var(--v-theme-${re})) !important`]),vm(Y,`.border-${re}`,[`--v-border-color: var(--v-theme-${re})`]));return j.push(...K,...Y),j.map((re,me)=>me===0?re:`    ${re}`).join("")});function i(j){const K=j._context.provides.usehead;if(K)K.addHeadObjs(He(()=>{const q={children:P.value,type:"text/css",id:"vuetify-theme-stylesheet"};return l.cspNonce&&(q.nonce=l.cspNonce),{style:[q]}})),Jo&&Oh(()=>K.updateDOM());else{let re=function(){if(!l.isDisabled){if(typeof document<"u"&&!q){const me=document.createElement("style");me.type="text/css",me.id="vuetify-theme-stylesheet",l.cspNonce&&me.setAttribute("nonce",l.cspNonce),q=me,document.head.appendChild(q)}q&&(q.innerHTML=P.value)}};var Y=re;let q=Jo?document.getElementById("vuetify-theme-stylesheet"):null;Mn(P,re,{immediate:!0})}}const F=He(()=>l.isDisabled?void 0:`v-theme--${d.value}`);return{install:i,isDisabled:l.isDisabled,name:d,themes:g,current:E,computedThemes:b,themeClasses:F,styles:P,global:{name:d,current:E}}}function To(e){za("provideTheme");const l=co(m_,null);if(!l)throw new Error("Could not find Vuetify theme injection");const d=He(()=>{var E;return(E=e.theme)!=null?E:l==null?void 0:l.name.value}),g=He(()=>l.isDisabled?void 0:`v-theme--${d.value}`),b={...l,name:d,themeClasses:g};return ra(m_,b),b}function JE(){za("useTheme");const e=co(m_,null);if(!e)throw new Error("Could not find Vuetify theme injection");return e}function vm(e,l,d){e.push(`${l} {
`,...d.map(g=>`  ${g};
`),`}
`)}function e4(e){const l=e.dark?2:1,d=e.dark?1:2,g=[];for(const[b,E]of Object.entries(e.colors)){const P=GE(E);g.push(`--v-theme-${b}: ${P.r},${P.g},${P.b}`),b.startsWith("on-")||g.push(`--v-theme-${b}-overlay-multiplier: ${Fx(E)>.18?l:d}`)}return g}function N1(e,l){let d;Mn(e,g=>{if(g&&!d)d=b_(),d.run(l);else{var b;(b=d)==null||b.stop(),d=void 0}},{immediate:!0})}function ar(e,l,d){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Y=>Y,b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Y=>Y;const E=za("useProxiedModel"),P=oi(e[l]),i=L1(l),j=He(i!==l?()=>{var Y,q,re,me;return e[l],!!(((Y=E.vnode.props)!=null&&Y.hasOwnProperty(l)||(q=E.vnode.props)!=null&&q.hasOwnProperty(i))&&((re=E.vnode.props)!=null&&re.hasOwnProperty(`onUpdate:${l}`)||(me=E.vnode.props)!=null&&me.hasOwnProperty(`onUpdate:${i}`)))}:()=>{var Y,q;return e[l],!!((Y=E.vnode.props)!=null&&Y.hasOwnProperty(l)&&(q=E.vnode.props)!=null&&q.hasOwnProperty(`onUpdate:${l}`))});N1(()=>!j.value,()=>{Mn(()=>e[l],Y=>{P.value=Y})});const K=He({get(){return g(j.value?e[l]:P.value)},set(Y){const q=b(Y);(j.value?e[l]:P.value)===q||g(j.value?e[l]:P.value)===Y||(P.value=q,E==null||E.emit(`update:${l}`,q))}});return Object.defineProperty(K,"externalValue",{get:()=>j.value?e[l]:P.value}),K}const t4={badge:"Badge",close:"Close",dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},datePicker:{itemsSelected:"{0} selected",nextMonthAriaLabel:"Next month",nextYearAriaLabel:"Next year",prevMonthAriaLabel:"Previous month",prevYearAriaLabel:"Previous year"},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},timePicker:{am:"AM",pm:"PM"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Goto Page {0}",currentPage:"Page {0}, Current Page",first:"First page",last:"Last page"}},rating:{ariaLabel:{item:"Rating {0} of {1}"}}},M2="$vuetify.",k2=(e,l)=>e.replace(/\{(\d+)\}/g,(d,g)=>String(l[+g])),QE=(e,l,d)=>function(g){for(var b=arguments.length,E=new Array(b>1?b-1:0),P=1;P<b;P++)E[P-1]=arguments[P];if(!g.startsWith(M2))return k2(g,E);const i=g.replace(M2,""),F=e.value&&d.value[e.value],j=l.value&&d.value[l.value];let K=zx(F,i,null);return K||(Sp(`Translation key "${g}" not found in "${e.value}", trying fallback locale`),K=zx(j,i,null)),K||(Ox(`Translation key "${g}" not found in fallback`),K=g),typeof K!="string"&&(Ox(`Translation key "${g}" has a non-string value`),K=g),k2(K,E)};function eS(e,l){return(d,g)=>new Intl.NumberFormat([e.value,l.value],g).format(d)}function rx(e,l,d){var b,E;const g=ar(e,l,(b=e[l])!=null?b:d.value);return g.value=(E=e[l])!=null?E:d.value,Mn(d,P=>{e[l]==null&&(g.value=d.value)}),g}function tS(e){return l=>{const d=rx(l,"locale",e.current),g=rx(l,"fallback",e.fallback),b=rx(l,"messages",e.messages);return{name:"vuetify",current:d,fallback:g,messages:b,t:QE(d,g,b),n:eS(d,g),provide:tS({current:d,fallback:g,messages:b})}}}function i4(e){var b,E;const l=oi((b=e==null?void 0:e.locale)!=null?b:"en"),d=oi((E=e==null?void 0:e.fallback)!=null?E:"en"),g=oi({en:t4,...e==null?void 0:e.messages});return{name:"vuetify",current:l,fallback:d,messages:g,t:QE(l,d,g),n:eS(l,d),provide:tS({current:l,fallback:d,messages:g})}}const n4={af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!1,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1},Lm=Symbol.for("vuetify:locale");function r4(e){return e.name!=null}function o4(e){const l=e!=null&&e.adapter&&r4(e==null?void 0:e.adapter)?e==null?void 0:e.adapter:i4(e),d=a4(l,e);return{...l,...d}}function rh(){const e=co(Lm);if(!e)throw new Error("[Vuetify] Could not find injected locale instance");return e}function s4(e){const l=co(Lm);if(!l)throw new Error("[Vuetify] Could not find injected locale instance");const d=l.provide(e),g=l4(d,l.rtl,e),b={...d,...g};return ra(Lm,b),b}function a4(e,l){var b;const d=oi((b=l==null?void 0:l.rtl)!=null?b:n4),g=He(()=>{var E;return(E=d.value[e.current.value])!=null?E:!1});return{isRtl:g,rtl:d,rtlClasses:He(()=>`v-locale--is-${g.value?"rtl":"ltr"}`)}}function l4(e,l,d){const g=He(()=>{var b,E;return(E=(b=d.rtl)!=null?b:l.value[e.current.value])!=null?E:!1});return{isRtl:g,rtl:l,rtlClasses:He(()=>`v-locale--is-${g.value?"rtl":"ltr"}`)}}function zd(){const e=co(Lm);if(!e)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:e.isRtl,rtlClasses:e.rtlClasses}}const c4=$i({name:"VApp",props:{...KE({fullHeight:!0}),...Ur()},setup(e,l){let{slots:d}=l;const g=To(e),{layoutClasses:b,layoutStyles:E,getLayoutItem:P,items:i,layoutRef:F}=YE(e),{rtlClasses:j}=zd();return Ui(()=>{var K;return ce("div",{ref:F,class:["v-application",g.themeClasses.value,b.value,j.value],style:E.value},[ce("div",{class:"v-application__wrap"},[(K=d.default)==null?void 0:K.call(d)])])}),{getLayoutItem:P,items:i,theme:g}}});const Go=S1({name:"VDefaultsProvider",props:{defaults:Object,reset:[Number,String],root:Boolean,scoped:Boolean},setup(e,l){let{slots:d}=l;const{defaults:g,reset:b,root:E,scoped:P}=x1(e);return Vs(g,{reset:b,root:E,scoped:P}),()=>{var i;return(i=d.default)==null?void 0:i.call(d)}}});function wc(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top center 0",d=arguments.length>2?arguments[2]:void 0;return $i({name:e,props:{group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:{type:String,default:d},origin:{type:String,default:l}},setup(g,b){let{slots:E}=b;return()=>{const P=g.group?Yk:Rh;return Df(P,{name:e,mode:g.mode,onBeforeEnter(i){i.style.transformOrigin=g.origin},onLeave(i){if(g.leaveAbsolute){const{offsetTop:F,offsetLeft:j,offsetWidth:K,offsetHeight:Y}=i;i._transitionInitialStyles={position:i.style.position,top:i.style.top,left:i.style.left,width:i.style.width,height:i.style.height},i.style.position="absolute",i.style.top=`${F}px`,i.style.left=`${j}px`,i.style.width=`${K}px`,i.style.height=`${Y}px`}g.hideOnLeave&&i.style.setProperty("display","none","important")},onAfterLeave(i){if(g.leaveAbsolute&&i!=null&&i._transitionInitialStyles){const{position:F,top:j,left:K,width:Y,height:q}=i._transitionInitialStyles;delete i._transitionInitialStyles,i.style.position=F||"",i.style.top=j||"",i.style.left=K||"",i.style.width=Y||"",i.style.height=q||""}}},E.default)}}})}function iS(e,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return $i({name:e,props:{mode:{type:String,default:d}},setup(g,b){let{slots:E}=b;return()=>Df(Rh,{name:e,...l},E.default)}})}function nS(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const d=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",g=_u(`offset-${d}`);return{onBeforeEnter(P){P._parent=P.parentNode,P._initialStyle={transition:P.style.transition,overflow:P.style.overflow,[d]:P.style[d]}},onEnter(P){const i=P._initialStyle;P.style.setProperty("transition","none","important"),P.style.overflow="hidden";const F=`${P[g]}px`;P.style[d]="0",P.offsetHeight,P.style.transition=i.transition,e&&P._parent&&P._parent.classList.add(e),requestAnimationFrame(()=>{P.style[d]=F})},onAfterEnter:E,onEnterCancelled:E,onLeave(P){P._initialStyle={transition:"",overflow:P.style.overflow,[d]:P.style[d]},P.style.overflow="hidden",P.style[d]=`${P[g]}px`,P.offsetHeight,requestAnimationFrame(()=>P.style[d]="0")},onAfterLeave:b,onLeaveCancelled:b};function b(P){e&&P._parent&&P._parent.classList.remove(e),E(P)}function E(P){const i=P._initialStyle[d];P.style.overflow=P._initialStyle.overflow,i!=null&&(P.style[d]=i),delete P._initialStyle}}const Pv=$i({name:"VDialogTransition",props:{target:Object},setup(e,l){let{slots:d}=l;const g={onBeforeEnter(b){b.style.pointerEvents="none",b.style.visibility="hidden"},async onEnter(b,E){var P;await new Promise(re=>requestAnimationFrame(re)),await new Promise(re=>requestAnimationFrame(re)),b.style.visibility="";const{x:i,y:F,sx:j,sy:K,speed:Y}=z2(e.target,b),q=xp(b,[{transform:`translate(${i}px, ${F}px) scale(${j}, ${K})`,opacity:0},{transform:""}],{duration:225*Y,easing:NP});(P=P2(b))==null||P.forEach(re=>{xp(re,[{opacity:0},{opacity:0,offset:.33},{opacity:1}],{duration:225*2*Y,easing:p_})}),q.finished.then(()=>E())},onAfterEnter(b){b.style.removeProperty("pointer-events")},onBeforeLeave(b){b.style.pointerEvents="none"},async onLeave(b,E){var P;await new Promise(re=>requestAnimationFrame(re));const{x:i,y:F,sx:j,sy:K,speed:Y}=z2(e.target,b);xp(b,[{transform:""},{transform:`translate(${i}px, ${F}px) scale(${j}, ${K})`,opacity:0}],{duration:125*Y,easing:UP}).finished.then(()=>E()),(P=P2(b))==null||P.forEach(re=>{xp(re,[{},{opacity:0,offset:.2},{opacity:0}],{duration:125*2*Y,easing:p_})})},onAfterLeave(b){b.style.removeProperty("pointer-events")}};return()=>e.target?ce(Rh,zn({name:"dialog-transition"},g,{css:!1}),d):ce(Rh,{name:"dialog-transition"},d)}});function P2(e){var l;const d=(l=e.querySelector(":scope > .v-card, :scope > .v-sheet, :scope > .v-list"))==null?void 0:l.children;return d&&[...d]}function z2(e,l){const d=e.getBoundingClientRect(),g=R1(l),[b,E]=getComputedStyle(l).transformOrigin.split(" ").map($e=>parseFloat($e)),[P,i]=getComputedStyle(l).getPropertyValue("--v-overlay-anchor-origin").split(" ");let F=d.left+d.width/2;P==="left"||i==="left"?F-=d.width/2:(P==="right"||i==="right")&&(F+=d.width/2);let j=d.top+d.height/2;P==="top"||i==="top"?j-=d.height/2:(P==="bottom"||i==="bottom")&&(j+=d.height/2);const K=d.width/g.width,Y=d.height/g.height,q=Math.max(1,K,Y),re=K/q,me=Y/q,we=g.width*g.height/(window.innerWidth*window.innerHeight),je=we>.12?Math.min(1.5,(we-.12)*10+1):1;return{x:F-(b+g.left),y:j-(E+g.top),sx:re,sy:me,speed:je}}const u4=wc("fab-transition","center center","out-in"),h4=wc("dialog-bottom-transition"),d4=wc("dialog-top-transition"),Vx=wc("fade-transition"),rS=wc("scale-transition"),f4=wc("scroll-x-transition"),p4=wc("scroll-x-reverse-transition"),m4=wc("scroll-y-transition"),g4=wc("scroll-y-reverse-transition"),_4=wc("slide-x-transition"),y4=wc("slide-x-reverse-transition"),U1=wc("slide-y-transition"),v4=wc("slide-y-reverse-transition"),zv=iS("expand-transition",nS()),$1=iS("expand-x-transition",nS("",!0));const oh=mr({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function sh(e){return{dimensionStyles:He(()=>({height:pn(e.height),maxHeight:pn(e.maxHeight),maxWidth:pn(e.maxWidth),minHeight:pn(e.minHeight),minWidth:pn(e.minWidth),width:pn(e.width)}))}}function x4(e){return{aspectStyles:He(()=>{const l=Number(e.aspectRatio);return l?{paddingBottom:String(1/l*100)+"%"}:void 0})}}const oS=$i({name:"VResponsive",props:{aspectRatio:[String,Number],contentClass:String,...oh()},setup(e,l){let{slots:d}=l;const{aspectStyles:g}=x4(e),{dimensionStyles:b}=sh(e);return Ui(()=>{var E;return ce("div",{class:"v-responsive",style:b.value},[ce("div",{class:"v-responsive__sizer",style:g.value},null),(E=d.additional)==null?void 0:E.call(d),d.default&&ce("div",{class:["v-responsive__content",e.contentClass]},[d.default()])])}),{}}});function b4(e,l){if(!D1)return;const d=l.modifiers||{},g=l.value,{handler:b,options:E}=typeof g=="object"?g:{handler:g,options:{}},P=new IntersectionObserver(function(){var i;let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],j=arguments.length>1?arguments[1]:void 0;const K=(i=e._observe)==null?void 0:i[l.instance.$.uid];if(!K)return;const Y=F.some(q=>q.isIntersecting);b&&(!d.quiet||K.init)&&(!d.once||Y||K.init)&&b(Y,F,j),Y&&d.once?sS(e,l):K.init=!0},E);e._observe=Object(e._observe),e._observe[l.instance.$.uid]={init:!1,observer:P},P.observe(e)}function sS(e,l){var d;const g=(d=e._observe)==null?void 0:d[l.instance.$.uid];!g||(g.observer.unobserve(e),delete e._observe[l.instance.$.uid])}const w4={mounted:b4,unmounted:sS},Dv=w4,Tc=mr({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:e=>e!==!0}},"transition"),Bh=(e,l)=>{var d;let{slots:g}=l;const{transition:b,...E}=e;if(!b||typeof b=="boolean")return(d=g.default)==null?void 0:d.call(g);const{component:P=Rh,...i}=typeof b=="object"?b:{};return Df(P,zn(typeof b=="string"?{name:b}:i,E),g)},Vm=$i({name:"VImg",directives:{intersect:Dv},props:{aspectRatio:[String,Number],alt:String,cover:Boolean,eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},srcset:String,width:[String,Number],...Tc()},emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,l){let{emit:d,slots:g}=l;const b=oi(""),E=oi(),P=oi(e.eager?"loading":"idle"),i=oi(),F=oi(),j=He(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),K=He(()=>j.value.aspect||i.value/F.value||0);Mn(()=>e.src,()=>{Y(P.value!=="idle")}),Cv(()=>Y());function Y(Ze){if(!(e.eager&&Ze)&&!(D1&&!Ze&&!e.eager)){if(P.value="loading",j.value.lazySrc){const rt=new Image;rt.src=j.value.lazySrc,we(rt,null)}!j.value.src||ys(()=>{var rt,gt;if(d("loadstart",((rt=E.value)==null?void 0:rt.currentSrc)||j.value.src),(gt=E.value)!=null&&gt.complete){if(E.value.naturalWidth||re(),P.value==="error")return;K.value||we(E.value,null),q()}else K.value||we(E.value),me()})}}function q(){var Ze;me(),P.value="loaded",d("load",((Ze=E.value)==null?void 0:Ze.currentSrc)||j.value.src)}function re(){var Ze;P.value="error",d("error",((Ze=E.value)==null?void 0:Ze.currentSrc)||j.value.src)}function me(){const Ze=E.value;Ze&&(b.value=Ze.currentSrc||Ze.src)}function we(Ze){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const gt=()=>{const{naturalHeight:vt,naturalWidth:Ut}=Ze;vt||Ut?(i.value=Ut,F.value=vt):!Ze.complete&&P.value==="loading"&&rt!=null?setTimeout(gt,rt):(Ze.currentSrc.endsWith(".svg")||Ze.currentSrc.startsWith("data:image/svg+xml"))&&(i.value=1,F.value=1)};gt()}const je=He(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),$e=()=>{var Ze;if(!j.value.src||P.value==="idle")return null;const rt=ce("img",{class:["v-img__img",je.value],src:j.value.src,srcset:j.value.srcset,alt:"",sizes:e.sizes,ref:E,onLoad:q,onError:re},null),gt=(Ze=g.sources)==null?void 0:Ze.call(g);return ce(Bh,{transition:e.transition,appear:!0},{default:()=>[io(gt?ce("picture",{class:"v-img__picture"},[gt,rt]):rt,[[na,P.value==="loaded"]])]})},tt=()=>ce(Bh,{transition:e.transition},{default:()=>[j.value.lazySrc&&P.value!=="loaded"&&ce("img",{class:["v-img__img","v-img__img--preload",je.value],src:j.value.lazySrc,alt:""},null)]}),Ae=()=>g.placeholder?ce(Bh,{transition:e.transition,appear:!0},{default:()=>[(P.value==="loading"||P.value==="error"&&!g.error)&&ce("div",{class:"v-img__placeholder"},[g.placeholder()])]}):null,mt=()=>g.error?ce(Bh,{transition:e.transition,appear:!0},{default:()=>[P.value==="error"&&ce("div",{class:"v-img__error"},[g.error()])]}):null,Me=()=>e.gradient?ce("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,Ye=oi(!1);{const Ze=Mn(K,rt=>{rt&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ye.value=!0})}),Ze())})}return Ui(()=>io(ce(oS,{class:["v-img",{"v-img--booting":!Ye.value}],style:{width:pn(e.width==="auto"?i.value:e.width)},aspectRatio:K.value,"aria-label":e.alt,role:e.alt?"img":void 0},{additional:()=>ce(Tr,null,[ce($e,null,null),ce(tt,null,null),ce(Me,null,null),ce(Ae,null,null),ce(mt,null,null)]),default:g.default}),[[bc("intersect"),{handler:Y,options:e.options},null,{once:!0}]])),{currentSrc:b,image:E,state:P,naturalWidth:i,naturalHeight:F}}}),lr=mr({tag:{type:String,default:"div"}},"tag"),dv=es()({name:"VToolbarTitle",props:{text:String,...lr()},setup(e,l){let{slots:d}=l;return Ui(()=>{var g;const b=!!(d.default||d.text||e.text);return ce(e.tag,{class:"v-toolbar-title"},{default:()=>[b&&ce("div",{class:"v-toolbar-title__placeholder"},[d.text?d.text():e.text,(g=d.default)==null?void 0:g.call(d)])]})}),{}}}),Ec=mr({border:[Boolean,Number,String]},"border");function vu(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();return{borderClasses:He(()=>{const g=us(e)?e.value:e.border,b=[];if(g===!0||g==="")b.push(`${l}--border`);else if(typeof g=="string"||g===0)for(const E of String(g).split(" "))b.push(`border-${E}`);return b})}}const Ns=mr({elevation:{type:[Number,String],validator(e){const l=parseInt(e);return!isNaN(l)&&l>=0&&l<=24}}},"elevation");function Da(e){return{elevationClasses:He(()=>{const d=us(e)?e.value:e.elevation,g=[];return d==null||g.push(`elevation-${d}`),g})}}const ts=mr({rounded:{type:[Boolean,Number,String],default:void 0}},"rounded");function xs(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();return{roundedClasses:He(()=>{const g=us(e)?e.value:e.rounded,b=[];if(g===!0||g==="")b.push(`${l}--rounded`);else if(typeof g=="string"||g===0)for(const E of String(g).split(" "))b.push(`rounded-${E}`);return b})}}function j1(e){return B1(()=>{const l=[],d={};return e.value.background&&(v2(e.value.background)?d.backgroundColor=e.value.background:l.push(`bg-${e.value.background}`)),e.value.text&&(v2(e.value.text)?(d.color=e.value.text,d.caretColor=e.value.text):l.push(`text-${e.value.text}`)),{colorClasses:l,colorStyles:d}})}function Zl(e,l){const d=He(()=>({text:us(e)?e.value:l?e[l]:null})),{colorClasses:g,colorStyles:b}=j1(d);return{textColorClasses:g,textColorStyles:b}}function vs(e,l){const d=He(()=>({background:us(e)?e.value:l?e[l]:null})),{colorClasses:g,colorStyles:b}=j1(d);return{backgroundColorClasses:g,backgroundColorStyles:b}}const T4=[null,"prominent","default","comfortable","compact"],aS=mr({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>T4.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...Ec(),...Ns(),...ts(),...lr({tag:"header"}),...Ur()},"v-toolbar"),fv=es()({name:"VToolbar",props:aS(),setup(e,l){var d;let{slots:g}=l;const{backgroundColorClasses:b,backgroundColorStyles:E}=vs(ki(e,"color")),{borderClasses:P}=vu(e),{elevationClasses:i}=Da(e),{roundedClasses:F}=xs(e),{themeClasses:j}=To(e),K=oi(!!(e.extended||(d=g.extension)!=null&&d.call(g))),Y=He(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),q=He(()=>K.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return Vs({VBtn:{variant:"text"}}),Ui(()=>{var re,me,we,je,$e;const tt=!!(e.title||g.title),Ae=!!(g.image||e.image),mt=(re=g.extension)==null?void 0:re.call(g);return K.value=!!(e.extended||mt),ce(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},b.value,P.value,i.value,F.value,j.value],style:[E.value]},{default:()=>[Ae&&ce("div",{key:"image",class:"v-toolbar__image"},[ce(Go,{defaults:{VImg:{cover:!0,src:e.image}}},{default:()=>[g.image?(me=g.image)==null?void 0:me.call(g):ce(Vm,null,null)]})]),ce("div",{class:"v-toolbar__content",style:{height:pn(Y.value)}},[g.prepend&&ce("div",{class:"v-toolbar__prepend"},[(we=g.prepend)==null?void 0:we.call(g)]),tt&&ce(dv,{key:"title",text:e.title},{text:g.title}),(je=g.default)==null?void 0:je.call(g),g.append&&ce("div",{class:"v-toolbar__append"},[($e=g.append)==null?void 0:$e.call(g)])]),ce(zv,null,{default:()=>[K.value&&ce("div",{class:"v-toolbar__extension",style:{height:pn(q.value)}},[mt])]})]})}),{contentHeight:Y,extensionHeight:q}}});function E4(e){var l;return nh(e,Object.keys((l=fv==null?void 0:fv.props)!=null?l:{}))}const S4=$i({name:"VAppBar",props:{modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...aS(),...Om(),height:{type:[Number,String],default:64}},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=oi(),b=ar(e,"modelValue"),E=He(()=>{var Y,q;var i,F;const j=(Y=(i=g.value)==null?void 0:i.contentHeight)!=null?Y:0,K=(q=(F=g.value)==null?void 0:F.extensionHeight)!=null?q:0;return j+K}),{layoutItemStyles:P}=Fm({id:e.name,order:He(()=>parseInt(e.order,10)),position:ki(e,"location"),layoutSize:E,elementSize:E,active:b,absolute:ki(e,"absolute")});return Ui(()=>{const[i]=E4(e);return ce(fv,zn({ref:g,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"}],style:{...P.value,height:void 0}},i),d)}),{}}});const C4=[null,"default","comfortable","compact"],oa=mr({density:{type:String,default:"default",validator:e=>C4.includes(e)}},"density");function Ja(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();return{densityClasses:He(()=>`${l}--density-${e.density}`)}}const I4=["elevated","flat","tonal","outlined","text","plain"];function zp(e,l){return ce(Tr,null,[e&&ce("span",{key:"overlay",class:`${l}__overlay`},null),ce("span",{key:"underlay",class:`${l}__underlay`},null)])}const xu=mr({color:String,variant:{type:String,default:"elevated",validator:e=>I4.includes(e)}},"variant");function Dp(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();const d=He(()=>{const{variant:E}=If(e);return`${l}--variant-${E}`}),{colorClasses:g,colorStyles:b}=j1(He(()=>{const{variant:E,color:P}=If(e);return{[["elevated","flat"].includes(E)?"background":"text"]:P}}));return{colorClasses:g,colorStyles:b,variantClasses:d}}const lS=$i({name:"VBtnGroup",props:{divided:Boolean,...Ec(),...oa(),...Ns(),...ts(),...lr(),...Ur(),...xu()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{densityClasses:b}=Ja(e),{borderClasses:E}=vu(e),{elevationClasses:P}=Da(e),{roundedClasses:i}=xs(e);Vs({VBtn:{height:"auto",color:ki(e,"color"),density:ki(e,"density"),flat:!0,variant:ki(e,"variant")}}),Ui(()=>ce(e.tag,{class:["v-btn-group",{"v-btn-group--divided":e.divided},g.value,E.value,b.value,P.value,i.value]},d))}}),Nm=mr({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),Lp=mr({value:null,disabled:Boolean,selectedClass:String},"group-item");function Um(e,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const g=za("useGroupItem");if(!g)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const b=Ya();ra(Symbol.for(`${l.description}:id`),b);const E=co(l,null);if(!E){if(!d)return E;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${l.description}`)}const P=ki(e,"value"),i=He(()=>E.disabled.value||e.disabled);E.register({id:b,value:P,disabled:i},g),Xl(()=>{E.unregister(b)});const F=He(()=>E.isSelected(b)),j=He(()=>F.value&&[E.selectedClass.value,e.selectedClass]);return Mn(F,K=>{g.emit("group:selected",{value:K})}),{id:b,isSelected:F,toggle:()=>E.select(b,!F.value),select:K=>E.select(b,K),selectedClass:j,value:P,disabled:i,group:E}}function Bp(e,l){let d=!1;const g=wl([]),b=ar(e,"modelValue",[],q=>q==null?[]:cS(g,mu(q)),q=>{const re=M4(g,q);return e.multiple?re:re[0]}),E=za("useGroup");function P(q,re){const me=q,we=Symbol.for(`${l.description}:id`),$e=i_(we,E==null?void 0:E.vnode).indexOf(re);$e>-1?g.splice($e,0,me):g.push(me)}function i(q){if(d)return;F();const re=g.findIndex(me=>me.id===q);g.splice(re,1)}function F(){const q=g.find(re=>!re.disabled);q&&e.mandatory==="force"&&!b.value.length&&(b.value=[q.id])}Wl(()=>{F()}),Xl(()=>{d=!0});function j(q,re){const me=g.find(we=>we.id===q);if(!(re&&me!=null&&me.disabled))if(e.multiple){const we=b.value.slice(),je=we.findIndex(tt=>tt===q),$e=~je;if(re=re!=null?re:!$e,$e&&e.mandatory&&we.length<=1||!$e&&e.max!=null&&we.length+1>e.max)return;je<0&&re?we.push(q):je>=0&&!re&&we.splice(je,1),b.value=we}else{const we=b.value.includes(q);if(e.mandatory&&we)return;b.value=(re!=null?re:!we)?[q]:[]}}function K(q){if(e.multiple&&Sp('This method is not supported when using "multiple" prop'),b.value.length){const re=b.value[0],me=g.findIndex($e=>$e.id===re);let we=(me+q)%g.length,je=g[we];for(;je.disabled&&we!==me;)we=(we+q)%g.length,je=g[we];if(je.disabled)return;b.value=[g[we].id]}else{const re=g.find(me=>!me.disabled);re&&(b.value=[re.id])}}const Y={register:P,unregister:i,selected:b,select:j,disabled:ki(e,"disabled"),prev:()=>K(g.length-1),next:()=>K(1),isSelected:q=>b.value.includes(q),selectedClass:He(()=>e.selectedClass),items:He(()=>g),getItemIndex:q=>A4(g,q)};return ra(l,Y),Y}function A4(e,l){const d=cS(e,[l]);return d.length?e.findIndex(g=>g.id===d[0]):-1}function cS(e,l){const d=[];for(let g=0;g<e.length;g++){const b=e[g];b.value!=null?l.find(E=>T_(E,b.value))!=null&&d.push(b.id):l.includes(g)&&d.push(b.id)}return d}function M4(e,l){const d=[];for(let g=0;g<e.length;g++){const b=e[g];l.includes(b.id)&&d.push(b.value!=null?b.value:g)}return d}const G1=Symbol.for("vuetify:v-btn-toggle"),k4=es()({name:"VBtnToggle",props:Nm(),emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{isSelected:g,next:b,prev:E,select:P,selected:i}=Bp(e,G1);return Ui(()=>{var F;return ce(lS,{class:"v-btn-toggle"},{default:()=>[(F=d.default)==null?void 0:F.call(d,{isSelected:g,next:b,prev:E,select:P,selected:i})]})}),{next:b,prev:E,select:P}}});const P4={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sort:"mdi-arrow-up",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus"},z4={component:e=>Df(q1,{...e,class:"mdi"})},Yn=[String,Function,Object],Nx=Symbol.for("vuetify:icons"),Lv=mr({icon:{type:Yn,required:!0},tag:{type:String,required:!0}},"icon"),uS=$i({name:"VComponentIcon",props:Lv(),setup(e){return()=>ce(e.tag,null,{default:()=>[ce(e.icon,null,null)]})}}),hS=$i({name:"VSvgIcon",inheritAttrs:!1,props:Lv(),setup(e,l){let{attrs:d}=l;return()=>ce(e.tag,zn(d,{style:null}),{default:()=>[ce("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[ce("path",{d:e.icon},null)])]})}}),D4=$i({name:"VLigatureIcon",props:Lv(),setup(e){return()=>ce(e.tag,null,{default:()=>[e.icon]})}}),q1=$i({name:"VClassIcon",props:Lv(),setup(e){return()=>ce(e.tag,{class:e.icon},null)}}),L4={svg:{component:hS},class:{component:q1}};function B4(e){return Ad({defaultSet:"mdi",sets:{...L4,mdi:z4},aliases:P4},e)}const R4=e=>{const l=co(Nx);if(!l)throw new Error("Missing Vuetify Icons provide!");return{iconData:He(()=>{const g=us(e)?e.value:e.icon;if(!g)throw new Error("Icon value is undefined or null");let b=g;if(typeof g=="string"&&g.includes("$")){var E;b=(E=l.aliases)==null?void 0:E[g.slice(g.indexOf("$")+1)]}if(!b)throw new Error(`Could not find aliased icon "${g}"`);if(typeof b!="string")return{component:uS,icon:b};const P=Object.keys(l.sets).find(j=>typeof b=="string"&&b.startsWith(`${j}:`)),i=P?b.slice(P.length+1):b;return{component:l.sets[P!=null?P:l.defaultSet].component,icon:i}})}},O4=["x-small","small","default","large","x-large"],Dd=mr({size:{type:[String,Number],default:"default"}},"size");function $m(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();return B1(()=>{let d,g;return sv(O4,e.size)?d=`${l}--size-${e.size}`:e.size&&(g={width:pn(e.size),height:pn(e.size)}),{sizeClasses:d,sizeStyles:g}})}const F4=mr({color:String,start:Boolean,end:Boolean,icon:Yn,...Dd(),...lr({tag:"i"}),...Ur()},"v-icon"),As=$i({name:"VIcon",props:F4(),setup(e,l){let{attrs:d,slots:g}=l,b;g.default&&(b=He(()=>{var K,Y;const q=(K=g.default)==null?void 0:K.call(g);if(!!q)return(Y=zE(q).filter(re=>re.children&&typeof re.children=="string")[0])==null?void 0:Y.children}));const{themeClasses:E}=To(e),{iconData:P}=R4(b||e),{sizeClasses:i}=$m(e),{textColorClasses:F,textColorStyles:j}=Zl(ki(e,"color"));return Ui(()=>ce(P.value.component,{tag:e.tag,icon:P.value.icon,class:["v-icon","notranslate",E.value,i.value,F.value,{"v-icon--clickable":!!d.onClick,"v-icon--start":e.start,"v-icon--end":e.end}],style:[i.value?void 0:{fontSize:pn(e.size),height:pn(e.size),width:pn(e.size)},j.value],role:d.onClick?"button":void 0,"aria-hidden":!d.onClick},null)),{}}});function Z1(e){const l=oi(),d=oi(!1);if(D1){const g=new IntersectionObserver(b=>{e==null||e(b,g),d.value=!!b.find(E=>E.isIntersecting)});Xl(()=>{g.disconnect()}),Mn(l,(b,E)=>{E&&(g.unobserve(E),d.value=!1),b&&g.observe(b)},{flush:"post"})}return{intersectionRef:l,isIntersecting:d}}const W1=$i({name:"VProgressCircular",props:{bgColor:String,color:String,indeterminate:[Boolean,String],modelValue:{type:[Number,String],default:0},rotate:{type:[Number,String],default:0},width:{type:[Number,String],default:4},...Dd(),...lr({tag:"div"}),...Ur()},setup(e,l){let{slots:d}=l;const g=20,b=2*Math.PI*g,E=oi(),{themeClasses:P}=To(e),{sizeClasses:i,sizeStyles:F}=$m(e),{textColorClasses:j,textColorStyles:K}=Zl(ki(e,"color")),{textColorClasses:Y,textColorStyles:q}=Zl(ki(e,"bgColor")),{intersectionRef:re,isIntersecting:me}=Z1(),{resizeRef:we,contentRect:je}=Ip(),$e=He(()=>Math.max(0,Math.min(100,parseFloat(e.modelValue)))),tt=He(()=>Number(e.width)),Ae=He(()=>F.value?Number(e.size):je.value?je.value.width:Math.max(tt.value,32)),mt=He(()=>g/(1-tt.value/Ae.value)*2),Me=He(()=>tt.value/Ae.value*mt.value),Ye=He(()=>pn((100-$e.value)/100*b));return Oh(()=>{re.value=E.value,we.value=E.value}),Ui(()=>ce(e.tag,{ref:E,class:["v-progress-circular",{"v-progress-circular--indeterminate":!!e.indeterminate,"v-progress-circular--visible":me.value,"v-progress-circular--disable-shrink":e.indeterminate==="disable-shrink"},P.value,i.value,j.value],style:[F.value,K.value],role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":e.indeterminate?void 0:$e.value},{default:()=>[ce("svg",{style:{transform:`rotate(calc(-90deg + ${Number(e.rotate)}deg))`},xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${mt.value} ${mt.value}`},[ce("circle",{class:["v-progress-circular__underlay",Y.value],style:q.value,fill:"transparent",cx:"50%",cy:"50%",r:g,"stroke-width":Me.value,"stroke-dasharray":b,"stroke-dashoffset":0},null),ce("circle",{class:"v-progress-circular__overlay",fill:"transparent",cx:"50%",cy:"50%",r:g,"stroke-width":Me.value,"stroke-dasharray":b,"stroke-dashoffset":Ye.value},null)]),d.default&&ce("div",{class:"v-progress-circular__content"},[d.default({value:$e.value})])]})),{}}});const Ux=Symbol("rippleStop"),V4=80;function D2(e,l){e.style.transform=l,e.style.webkitTransform=l}function ox(e,l){e.style.opacity=`calc(${l} * var(--v-theme-overlay-multiplier))`}function $x(e){return e.constructor.name==="TouchEvent"}function dS(e){return e.constructor.name==="KeyboardEvent"}const N4=function(e,l){var d;let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},b=0,E=0;if(!dS(e)){const q=l.getBoundingClientRect(),re=$x(e)?e.touches[e.touches.length-1]:e;b=re.clientX-q.left,E=re.clientY-q.top}let P=0,i=.3;(d=l._ripple)!=null&&d.circle?(i=.15,P=l.clientWidth/2,P=g.center?P:P+Math.sqrt((b-P)**2+(E-P)**2)/4):P=Math.sqrt(l.clientWidth**2+l.clientHeight**2)/2;const F=`${(l.clientWidth-P*2)/2}px`,j=`${(l.clientHeight-P*2)/2}px`,K=g.center?F:`${b-P}px`,Y=g.center?j:`${E-P}px`;return{radius:P,scale:i,x:K,y:Y,centerX:F,centerY:j}},pv={show(e,l){var d;let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(l!=null&&(d=l._ripple)!=null&&d.enabled))return;const b=document.createElement("span"),E=document.createElement("span");b.appendChild(E),b.className="v-ripple__container",g.class&&(b.className+=` ${g.class}`);const{radius:P,scale:i,x:F,y:j,centerX:K,centerY:Y}=N4(e,l,g),q=`${P*2}px`;E.className="v-ripple__animation",E.style.width=q,E.style.height=q,l.appendChild(b);const re=window.getComputedStyle(l);re&&re.position==="static"&&(l.style.position="relative",l.dataset.previousPosition="static"),E.classList.add("v-ripple__animation--enter"),E.classList.add("v-ripple__animation--visible"),D2(E,`translate(${F}, ${j}) scale3d(${i},${i},${i})`),ox(E,0),E.dataset.activated=String(performance.now()),setTimeout(()=>{E.classList.remove("v-ripple__animation--enter"),E.classList.add("v-ripple__animation--in"),D2(E,`translate(${K}, ${Y}) scale3d(1,1,1)`),ox(E,.08)},0)},hide(e){var l;if(!(e!=null&&(l=e._ripple)!=null&&l.enabled))return;const d=e.getElementsByClassName("v-ripple__animation");if(d.length===0)return;const g=d[d.length-1];if(g.dataset.isHiding)return;g.dataset.isHiding="true";const b=performance.now()-Number(g.dataset.activated),E=Math.max(250-b,0);setTimeout(()=>{g.classList.remove("v-ripple__animation--in"),g.classList.add("v-ripple__animation--out"),ox(g,0),setTimeout(()=>{e.getElementsByClassName("v-ripple__animation").length===1&&e.dataset.previousPosition&&(e.style.position=e.dataset.previousPosition,delete e.dataset.previousPosition),g.parentNode&&e.removeChild(g.parentNode)},300)},E)}};function fS(e){return typeof e>"u"||!!e}function g_(e){const l={},d=e.currentTarget;if(!(!(d!=null&&d._ripple)||d._ripple.touched||e[Ux])){if(e[Ux]=!0,$x(e))d._ripple.touched=!0,d._ripple.isTouch=!0;else if(d._ripple.isTouch)return;if(l.center=d._ripple.centered||dS(e),d._ripple.class&&(l.class=d._ripple.class),$x(e)){if(d._ripple.showTimerCommit)return;d._ripple.showTimerCommit=()=>{pv.show(e,d,l)},d._ripple.showTimer=window.setTimeout(()=>{var g;d!=null&&(g=d._ripple)!=null&&g.showTimerCommit&&(d._ripple.showTimerCommit(),d._ripple.showTimerCommit=null)},V4)}else pv.show(e,d,l)}}function L2(e){e[Ux]=!0}function vc(e){const l=e.currentTarget;if(!(!l||!l._ripple)){if(window.clearTimeout(l._ripple.showTimer),e.type==="touchend"&&l._ripple.showTimerCommit){l._ripple.showTimerCommit(),l._ripple.showTimerCommit=null,l._ripple.showTimer=window.setTimeout(()=>{vc(e)});return}window.setTimeout(()=>{l._ripple&&(l._ripple.touched=!1)}),pv.hide(l)}}function pS(e){const l=e.currentTarget;!l||!l._ripple||(l._ripple.showTimerCommit&&(l._ripple.showTimerCommit=null),window.clearTimeout(l._ripple.showTimer))}let __=!1;function mS(e){!__&&(e.keyCode===p2.enter||e.keyCode===p2.space)&&(__=!0,g_(e))}function gS(e){__=!1,vc(e)}function _S(e){__&&(__=!1,vc(e))}function yS(e,l,d){var P;const{value:g,modifiers:b}=l,E=fS(g);if(E||pv.hide(e),e._ripple=(P=e._ripple)!=null?P:{},e._ripple.enabled=E,e._ripple.centered=b.center,e._ripple.circle=b.circle,Dx(g)&&g.class&&(e._ripple.class=g.class),E&&!d){if(b.stop){e.addEventListener("touchstart",L2,{passive:!0}),e.addEventListener("mousedown",L2);return}e.addEventListener("touchstart",g_,{passive:!0}),e.addEventListener("touchend",vc,{passive:!0}),e.addEventListener("touchmove",pS,{passive:!0}),e.addEventListener("touchcancel",vc),e.addEventListener("mousedown",g_),e.addEventListener("mouseup",vc),e.addEventListener("mouseleave",vc),e.addEventListener("keydown",mS),e.addEventListener("keyup",gS),e.addEventListener("blur",_S),e.addEventListener("dragstart",vc,{passive:!0})}else!E&&d&&vS(e)}function vS(e){e.removeEventListener("mousedown",g_),e.removeEventListener("touchstart",g_),e.removeEventListener("touchend",vc),e.removeEventListener("touchmove",pS),e.removeEventListener("touchcancel",vc),e.removeEventListener("mouseup",vc),e.removeEventListener("mouseleave",vc),e.removeEventListener("keydown",mS),e.removeEventListener("keyup",gS),e.removeEventListener("dragstart",vc),e.removeEventListener("blur",_S)}function U4(e,l){yS(e,l,!1)}function $4(e){delete e._ripple,vS(e)}function j4(e,l){if(l.value===l.oldValue)return;const d=fS(l.oldValue);yS(e,l,d)}const Rp={mounted:U4,unmounted:$4,updated:j4};const X1=$i({name:"VProgressLinear",props:{active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...ts(),...lr(),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),{isRtl:b}=zd(),{themeClasses:E}=To(e),{textColorClasses:P,textColorStyles:i}=Zl(e,"color"),{backgroundColorClasses:F,backgroundColorStyles:j}=vs(He(()=>e.bgColor||e.color)),{backgroundColorClasses:K,backgroundColorStyles:Y}=vs(e,"color"),{roundedClasses:q}=xs(e),{intersectionRef:re,isIntersecting:me}=Z1(),we=He(()=>parseInt(e.max,10)),je=He(()=>parseInt(e.height,10)),$e=He(()=>parseFloat(e.bufferValue)/we.value*100),tt=He(()=>parseFloat(g.value)/we.value*100),Ae=He(()=>b.value!==e.reverse),mt=He(()=>e.indeterminate?"fade-transition":"slide-x-transition"),Me=He(()=>e.bgOpacity==null?e.bgOpacity:parseFloat(e.bgOpacity));function Ye(Ze){if(!re.value)return;const{left:rt,right:gt,width:vt}=re.value.getBoundingClientRect(),Ut=Ae.value?vt-Ze.clientX+(gt-vt):Ze.clientX-rt;g.value=Math.round(Ut/vt*we.value)}return Ui(()=>ce(e.tag,{ref:re,class:["v-progress-linear",{"v-progress-linear--active":e.active&&me.value,"v-progress-linear--reverse":Ae.value,"v-progress-linear--rounded":e.rounded,"v-progress-linear--rounded-bar":e.roundedBar,"v-progress-linear--striped":e.striped},q.value,E.value],style:{height:e.active?pn(je.value):0,"--v-progress-linear-height":pn(je.value)},role:"progressbar","aria-valuemin":"0","aria-valuemax":e.max,"aria-valuenow":e.indeterminate?void 0:tt.value,onClick:e.clickable&&Ye},{default:()=>[e.stream&&ce("div",{key:"stream",class:["v-progress-linear__stream",P.value],style:{...i.value,[Ae.value?"left":"right"]:pn(-je.value),borderTop:`${pn(je.value/2)} dotted`,opacity:Me.value,top:`calc(50% - ${pn(je.value/4)})`,width:pn(100-$e.value,"%"),"--v-progress-linear-stream-to":pn(je.value*(Ae.value?1:-1))}},null),ce("div",{class:["v-progress-linear__background",F.value],style:[j.value,{opacity:Me.value,width:pn(e.stream?$e.value:100,"%")}]},null),ce(Rh,{name:mt.value},{default:()=>[e.indeterminate?ce("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(Ze=>ce("div",{key:Ze,class:["v-progress-linear__indeterminate",Ze,K.value],style:Y.value},null))]):ce("div",{class:["v-progress-linear__determinate",K.value],style:[Y.value,{width:pn(tt.value,"%")}]},null)]}),d.default&&ce("div",{class:"v-progress-linear__content"},[d.default({value:tt.value,buffer:$e.value})])]})),{}}}),H1=mr({loading:Boolean},"loader");function Bv(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();return{loaderClasses:He(()=>({[`${l}--loading`]:e.loading}))}}function K1(e,l){var d;let{slots:g}=l;return ce("div",{class:`${e.name}__loader`},[((d=g.default)==null?void 0:d.call(g,{color:e.color,isActive:e.active}))||ce(X1,{active:e.active,color:e.color,height:"2",indeterminate:!0},null)])}const B2={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},Op=mr({location:String},"location");function Fp(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,d=arguments.length>2?arguments[2]:void 0;const{isRtl:g}=zd();return{locationStyles:He(()=>{if(!e.location)return{};const{side:E,align:P}=Bx(e.location.split(" ").length>1?e.location:`${e.location} center`,g.value);function i(j){return d?d(j):0}const F={};return E!=="center"&&(l?F[B2[E]]=`calc(100% - ${i(E)}px)`:F[E]=0),P!=="center"?l?F[B2[P]]=`calc(100% - ${i(P)}px)`:F[P]=0:(E==="center"?F.top=F.left="50%":F[{top:"left",bottom:"left",left:"top",right:"top"}[E]]="50%",F.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[E]),F})}}const G4=["static","relative","fixed","absolute","sticky"],jm=mr({position:{type:String,validator:e=>G4.includes(e)}},"position");function Gm(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();return{positionClasses:He(()=>e.position?`${l}--${e.position}`:void 0)}}function xS(){var e,l;return(e=za("useRouter"))==null||(l=e.proxy)==null?void 0:l.$router}function E_(e,l){const d=HM("RouterLink"),g=He(()=>!!(e.href||e.to)),b=He(()=>(g==null?void 0:g.value)||!!(l.onClick||l.onClickOnce));if(typeof d=="string")return{isLink:g,isClickable:b,href:ki(e,"href")};const E=e.to?d.useLink(e):void 0;return{isLink:g,isClickable:b,route:E==null?void 0:E.route,navigate:E==null?void 0:E.navigate,isActive:E&&He(()=>{var P,i;return e.exact?(P=E.isExactActive)==null?void 0:P.value:(i=E.isActive)==null?void 0:i.value}),href:He(()=>e.to?E==null?void 0:E.route.value.href:e.href)}}const qm=mr({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router");let sx=!1;function q4(e,l){let d=!1,g,b;Jo&&(ys(()=>{window.addEventListener("popstate",E),g=e==null?void 0:e.beforeEach((P,i,F)=>{sx?d?l(F):F():setTimeout(()=>d?l(F):F()),sx=!0}),b=e==null?void 0:e.afterEach(()=>{sx=!1})}),Ap(()=>{var P,i;window.removeEventListener("popstate",E),(P=g)==null||P(),(i=b)==null||i()}));function E(P){var i;(i=P.state)!=null&&i.replaced||(d=!0,setTimeout(()=>d=!1))}}function Z4(e,l){Mn(()=>{var d;return(d=e.isActive)==null?void 0:d.value},d=>{e.isLink.value&&d&&l&&ys(()=>{l(!0)})},{immediate:!0})}const ql=$i({name:"VBtn",directives:{Ripple:Rp},props:{active:{type:Boolean,default:void 0},symbol:{type:null,default:G1},flat:Boolean,icon:[Boolean,String,Function,Object],prependIcon:Yn,appendIcon:Yn,block:Boolean,stacked:Boolean,ripple:{type:Boolean,default:!0},...Ec(),...ts(),...oa(),...oh(),...Ns(),...Lp(),...H1(),...Op(),...jm(),...qm(),...Dd(),...lr({tag:"button"}),...Ur(),...xu({variant:"elevated"})},emits:{"group:selected":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const{themeClasses:b}=To(e),{borderClasses:E}=vu(e),{colorClasses:P,colorStyles:i,variantClasses:F}=Dp(e),{densityClasses:j}=Ja(e),{dimensionStyles:K}=sh(e),{elevationClasses:Y}=Da(e),{loaderClasses:q}=Bv(e),{locationStyles:re}=Fp(e),{positionClasses:me}=Gm(e),{roundedClasses:we}=xs(e),{sizeClasses:je,sizeStyles:$e}=$m(e),tt=Um(e,e.symbol,!1),Ae=E_(e,d),mt=He(()=>{var Ze;return e.active!==!1&&(e.active||((Ze=Ae.isActive)==null?void 0:Ze.value)||(tt==null?void 0:tt.isSelected.value))}),Me=He(()=>(tt==null?void 0:tt.disabled.value)||e.disabled),Ye=He(()=>e.variant==="elevated"&&!(e.disabled||e.flat||e.border));return Z4(Ae,tt==null?void 0:tt.select),Ui(()=>{var Ze,rt,gt,vt;const Ut=Ae.isLink.value?"a":e.tag,At=!tt||tt.isSelected.value,ti=!!(e.prependIcon||g.prepend),Nt=!!(e.appendIcon||g.append),Wt=!!(e.icon&&e.icon!==!0);return io(ce(Ut,{type:Ut==="a"?void 0:"button",class:["v-btn",tt==null?void 0:tt.selectedClass.value,{"v-btn--active":mt.value,"v-btn--block":e.block,"v-btn--disabled":Me.value,"v-btn--elevated":Ye.value,"v-btn--flat":e.flat,"v-btn--icon":!!e.icon,"v-btn--loading":e.loading,"v-btn--stacked":e.stacked},b.value,E.value,At?P.value:void 0,j.value,Y.value,q.value,me.value,we.value,je.value,F.value],style:[At?i.value:void 0,K.value,re.value,$e.value],disabled:Me.value||void 0,href:Ae.href.value,onClick:zt=>{var Yt;Me.value||((Yt=Ae.navigate)==null||Yt.call(Ae,zt),tt==null||tt.toggle())}},{default:()=>{var zt;return[zp(!0,"v-btn"),!e.icon&&ti&&ce(Go,{key:"prepend",defaults:{VIcon:{icon:e.prependIcon}}},{default:()=>{var Yt;return[ce("span",{class:"v-btn__prepend"},[(Yt=(Ze=g.prepend)==null?void 0:Ze.call(g))!=null?Yt:ce(As,null,null)])]}}),ce("span",{class:"v-btn__content","data-no-activator":""},[ce(Go,{key:"content",defaults:{VIcon:{icon:Wt?e.icon:void 0}}},{default:()=>{var Yt;return[(Yt=(rt=g.default)==null?void 0:rt.call(g))!=null?Yt:Wt&&ce(As,{key:"icon"},null)]}})]),!e.icon&&Nt&&ce(Go,{key:"append",defaults:{VIcon:{icon:e.appendIcon}}},{default:()=>{var Yt;return[ce("span",{class:"v-btn__append"},[(Yt=(gt=g.append)==null?void 0:gt.call(g))!=null?Yt:ce(As,null,null)])]}}),!!e.loading&&ce("span",{key:"loader",class:"v-btn__loader"},[(zt=(vt=g.loader)==null?void 0:vt.call(g))!=null?zt:ce(W1,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,size:"23",width:"2"},null)])]}}),[[bc("ripple"),!Me.value&&e.ripple,null]])}),{}}}),W4=$i({name:"VAppBarNavIcon",props:{icon:{type:Yn,default:"$menu"}},setup(e,l){let{slots:d}=l;return Ui(()=>ce(ql,{class:"v-app-bar-nav-icon",icon:e.icon},d)),{}}}),X4=$i({name:"VToolbarItems",props:xu({variant:"text"}),setup(e,l){let{slots:d}=l;return Vs({VBtn:{color:ki(e,"color"),height:"inherit",variant:ki(e,"variant")}}),Ui(()=>{var g;return ce("div",{class:"v-toolbar-items"},[(g=d.default)==null?void 0:g.call(d)])}),{}}}),H4=$i({name:"VAppBarTitle",props:{...dv.props},setup(e,l){let{slots:d}=l;return Ui(()=>ce(dv,{class:"v-app-bar-title"},d)),{}}});const bS=yu("v-alert-title"),K4=["success","info","warning","error"],Y4=$i({name:"VAlert",props:{border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Yn,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>K4.includes(e)},...oa(),...oh(),...Ns(),...Op(),...jm(),...ts(),...lr(),...Ur(),...xu({variant:"flat"})},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),b=He(()=>{var mt;if(e.icon!==!1)return e.type?(mt=e.icon)!=null?mt:`$${e.type}`:e.icon}),E=He(()=>{var mt;return{color:(mt=e.color)!=null?mt:e.type,variant:e.variant}}),{themeClasses:P}=To(e),{colorClasses:i,colorStyles:F,variantClasses:j}=Dp(E),{densityClasses:K}=Ja(e),{dimensionStyles:Y}=sh(e),{elevationClasses:q}=Da(e),{locationStyles:re}=Fp(e),{positionClasses:me}=Gm(e),{roundedClasses:we}=xs(e),{textColorClasses:je,textColorStyles:$e}=Zl(ki(e,"borderColor")),{t:tt}=rh(),Ae=He(()=>({"aria-label":tt(e.closeLabel),onClick(mt){g.value=!1}}));return()=>{var mt,Me;const Ye=!!(d.prepend||b.value),Ze=!!(d.title||e.title),rt=!!(e.text||d.text),gt=!!(d.close||e.closable);return g.value&&ce(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},P.value,i.value,K.value,q.value,me.value,we.value,j.value],style:[F.value,Y.value,re.value],role:"alert"},{default:()=>[zp(!1,"v-alert"),e.border&&ce("div",{key:"border",class:["v-alert__border",je.value],style:$e.value},null),Ye&&ce(Go,{key:"prepend",defaults:{VIcon:{density:e.density,icon:b.value,size:e.prominent?44:28}}},{default:()=>[ce("div",{class:"v-alert__prepend"},[d.prepend?d.prepend():b.value&&ce(As,null,null)])]}),ce("div",{class:"v-alert__content"},[Ze&&ce(bS,{key:"title"},{default:()=>[d.title?d.title():e.title]}),rt&&(d.text?d.text():e.text),(mt=d.default)==null?void 0:mt.call(d)]),d.append&&ce("div",{key:"append",class:"v-alert__append"},[d.append()]),gt&&ce(Go,{key:"close",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var vt;return[ce("div",{class:"v-alert__close"},[(vt=(Me=d.close)==null?void 0:Me.call(d,{props:Ae.value}))!=null?vt:ce(ql,Ae.value,null)])]}})]})}}});const wS=$i({name:"VMessages",props:{active:Boolean,color:String,messages:{type:[Array,String],default:()=>[]},...Tc({transition:{component:U1,leaveAbsolute:!0,group:!0}})},setup(e,l){let{slots:d}=l;const g=He(()=>mu(e.messages)),{textColorClasses:b,textColorStyles:E}=Zl(He(()=>e.color));return Ui(()=>ce(Bh,{transition:e.transition,tag:"div",class:["v-messages",b.value],style:E.value},{default:()=>[e.active&&g.value.map((P,i)=>ce("div",{class:"v-messages__message",key:`${i}-${g.value}`},[d.message?d.message({message:P}):P]))]})),{}}}),TS=Symbol.for("vuetify:form"),J4=mr({disabled:Boolean,fastFail:Boolean,lazyValidation:Boolean,readonly:Boolean,modelValue:{type:Boolean,default:null}},"form");function Q4(e){const l=ar(e,"modelValue"),d=He(()=>e.disabled),g=He(()=>e.readonly),b=oi(!1),E=oi([]),P=oi([]);async function i(){const K=[];let Y=!0;P.value=[],b.value=!0;for(const q of E.value){const re=await q.validate();if(re.length>0&&(Y=!1,K.push({id:q.id,errorMessages:re})),!Y&&e.fastFail)break}return P.value=K,b.value=!1,{valid:Y,errors:P.value}}function F(){E.value.forEach(K=>K.reset()),l.value=null}function j(){E.value.forEach(K=>K.resetValidation()),P.value=[],l.value=null}return Mn(E,()=>{let K=0,Y=0;const q=[];for(const re of E.value)re.isValid===!1?(Y++,q.push({id:re.id,errorMessages:re.errorMessages})):re.isValid===!0&&K++;P.value=q,l.value=Y>0?!1:K===E.value.length?!0:null},{deep:!0}),ra(TS,{register:K=>{let{id:Y,validate:q,reset:re,resetValidation:me}=K;E.value.some(we=>we.id===Y)&&Sp(`Duplicate input name "${Y}"`),E.value.push({id:Y,validate:q,reset:re,resetValidation:me,isValid:null,errorMessages:[]})},unregister:K=>{E.value=E.value.filter(Y=>Y.id!==K)},update:(K,Y,q)=>{const re=E.value.find(me=>me.id===K);!re||(re.isValid=Y,re.errorMessages=q)},isDisabled:d,isReadonly:g,isValidating:b,items:E}),{errors:P,isDisabled:d,isReadonly:g,isValidating:b,items:E,validate:i,reset:F,resetValidation:j}}function ez(){return co(TS,null)}const ES=mr({disabled:Boolean,error:Boolean,errorMessages:{type:[Array,String],default:()=>[]},maxErrors:{type:[Number,String],default:1},name:String,label:String,readonly:Boolean,rules:{type:Array,default:()=>[]},modelValue:null,validationValue:null},"validation");function SS(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd(),d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ya();const g=ar(e,"modelValue"),b=He(()=>e.validationValue===void 0?g.value:e.validationValue),E=ez(),P=oi([]),i=oi(!0),F=He(()=>!!(mu(g.value===""?null:g.value).length||mu(b.value===""?null:b.value).length)),j=He(()=>!!(e.disabled||E!=null&&E.isDisabled.value)),K=He(()=>!!(e.readonly||E!=null&&E.isReadonly.value)),Y=He(()=>e.errorMessages.length?mu(e.errorMessages):P.value),q=He(()=>e.error||Y.value.length?!1:e.rules.length&&i.value?null:!0),re=oi(!1),me=He(()=>({[`${l}--error`]:q.value===!1,[`${l}--dirty`]:F.value,[`${l}--disabled`]:j.value,[`${l}--readonly`]:K.value})),we=He(()=>{var Ae;return(Ae=e.name)!=null?Ae:If(d)});Cv(()=>{E==null||E.register({id:we.value,validate:tt,reset:je,resetValidation:$e})}),Xl(()=>{E==null||E.unregister(we.value)}),Wl(()=>E==null?void 0:E.update(we.value,q.value,Y.value)),Mn(b,()=>{b.value!=null&&tt()}),Mn(q,()=>{E==null||E.update(we.value,q.value,Y.value)});function je(){$e(),g.value=null}function $e(){i.value=!0,P.value=[]}async function tt(){const Ae=[];re.value=!0;for(const mt of e.rules){if(Ae.length>=(e.maxErrors||1))break;const Ye=await(typeof mt=="function"?mt:()=>mt)(b.value);if(Ye!==!0){if(typeof Ye!="string"){console.warn(`${Ye} is not a valid value. Rule functions must return boolean true or a string.`);continue}Ae.push(Ye)}}return P.value=Ae,re.value=!1,i.value=!1,P.value}return{errorMessages:Y,isDirty:F,isDisabled:j,isReadonly:K,isPristine:i,isValid:q,isValidating:re,reset:je,resetValidation:$e,validate:tt,validationClasses:me}}function CS(e){const{t:l}=rh();function d(g){var F;let{name:b}=g;const E={prepend:"prependAction",prependInner:"prependAction",append:"appendAction",appendInner:"appendAction",clear:"clear"}[b],P=e[`onClick:${b}`],i=P&&E?l(`$vuetify.input.${E}`,(F=e.label)!=null?F:""):void 0;return ce(As,{icon:e[`${b}Icon`],"aria-label":i,onClick:P},null)}return{InputIcon:d}}const Ld=mr({id:String,appendIcon:Yn,prependIcon:Yn,hideDetails:[Boolean,String],messages:{type:[Array,String],default:()=>[]},direction:{type:String,default:"horizontal",validator:e=>["horizontal","vertical"].includes(e)},"onClick:prepend":n_,"onClick:append":n_,...oa(),...ES()},"VInput"),Fh=es()({name:"VInput",props:{...Ld()},emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g,emit:b}=l;const{densityClasses:E}=Ja(e),{InputIcon:P}=CS(e),i=Ya(),F=He(()=>e.id||`input-${i}`),{errorMessages:j,isDirty:K,isDisabled:Y,isReadonly:q,isPristine:re,isValid:me,isValidating:we,reset:je,resetValidation:$e,validate:tt,validationClasses:Ae}=SS(e,"v-input",F),mt=He(()=>({id:F,isDirty:K,isDisabled:Y,isReadonly:q,isPristine:re,isValid:me,isValidating:we,reset:je,resetValidation:$e,validate:tt}));return Ui(()=>{var Me,Ye,Ze,rt,gt;const vt=!!(g.prepend||e.prependIcon),Ut=!!(g.append||e.appendIcon),At=!!((Me=e.messages)!=null&&Me.length||j.value.length),ti=!e.hideDetails||e.hideDetails==="auto"&&(At||!!g.details);return ce("div",{class:["v-input",`v-input--${e.direction}`,E.value,Ae.value]},[vt&&ce("div",{key:"prepend",class:"v-input__prepend"},[(Ye=g.prepend)==null?void 0:Ye.call(g,mt.value),e.prependIcon&&ce(P,{key:"prepend-icon",name:"prepend"},null)]),g.default&&ce("div",{class:"v-input__control"},[(Ze=g.default)==null?void 0:Ze.call(g,mt.value)]),Ut&&ce("div",{key:"append",class:"v-input__append"},[e.appendIcon&&ce(P,{key:"append-icon",name:"append"},null),(rt=g.append)==null?void 0:rt.call(g,mt.value)]),ti&&ce("div",{class:"v-input__details"},[ce(wS,{active:At,messages:j.value.length>0?j.value:e.messages},{message:g.message}),(gt=g.details)==null?void 0:gt.call(g,mt.value)])])}),{reset:je,resetValidation:$e,validate:tt}}});function Lf(e){const l=Object.keys(Fh.props).filter(d=>!DE(d));return nh(e,l)}const Zm=$i({name:"VLabel",props:{text:String,clickable:Boolean,...Ur()},setup(e,l){let{slots:d}=l;return Ui(()=>{var g;return ce("label",{class:["v-label",{"v-label--clickable":e.clickable}]},[e.text,(g=d.default)==null?void 0:g.call(d)])}),{}}});const IS=Symbol.for("vuetify:selection-control-group"),Y1=mr({color:String,disabled:Boolean,error:Boolean,id:String,inline:Boolean,falseIcon:Yn,trueIcon:Yn,ripple:{type:Boolean,default:!0},multiple:{type:Boolean,default:null},name:String,readonly:Boolean,modelValue:null,type:String,valueComparator:{type:Function,default:T_},...Ur(),...oa()},"VSelectionControlGroup"),AS=$i({name:"VSelectionControlGroup",props:{defaultsTarget:{type:String,default:"VSelectionControl"},...Y1()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),b=Ya(),E=He(()=>e.id||`v-selection-control-group-${b}`),P=He(()=>e.name||E.value);return ra(IS,{modelValue:g}),Vs({[e.defaultsTarget]:{color:ki(e,"color"),disabled:ki(e,"disabled"),density:ki(e,"density"),error:ki(e,"error"),inline:ki(e,"inline"),modelValue:g,multiple:He(()=>!!e.multiple||e.multiple==null&&Array.isArray(g.value)),name:P,falseIcon:ki(e,"falseIcon"),trueIcon:ki(e,"trueIcon"),readonly:ki(e,"readonly"),ripple:ki(e,"ripple"),type:ki(e,"type"),valueComparator:ki(e,"valueComparator")}}),Ui(()=>{var i;return ce("div",{class:["v-selection-control-group",{"v-selection-control-group--inline":e.inline}],"aria-labelled-by":e.type==="radio"?E.value:void 0,role:e.type==="radio"?"radiogroup":void 0},[(i=d.default)==null?void 0:i.call(d)])}),{}}}),Rv=mr({label:String,trueValue:null,falseValue:null,value:null,...Y1()},"VSelectionControl");function tz(e){const l=co(IS,void 0),{densityClasses:d}=Ja(e),g=ar(e,"modelValue"),b=He(()=>e.trueValue!==void 0?e.trueValue:e.value!==void 0?e.value:!0),E=He(()=>e.falseValue!==void 0?e.falseValue:!1),P=He(()=>!!e.multiple||e.multiple==null&&Array.isArray(g.value)),i=He({get(){const Y=l?l.modelValue.value:g.value;return P.value?Y.some(q=>e.valueComparator(q,b.value)):e.valueComparator(Y,b.value)},set(Y){if(e.readonly)return;const q=Y?b.value:E.value;let re=q;P.value&&(re=Y?[...mu(g.value),q]:mu(g.value).filter(me=>!e.valueComparator(me,b.value))),l?l.modelValue.value=re:g.value=re}}),{textColorClasses:F,textColorStyles:j}=Zl(He(()=>i.value&&!e.error&&!e.disabled?e.color:void 0)),K=He(()=>i.value?e.trueIcon:e.falseIcon);return{group:l,densityClasses:d,trueValue:b,falseValue:E,model:i,textColorClasses:F,textColorStyles:j,icon:K}}const S_=es()({name:"VSelectionControl",directives:{Ripple:Rp},inheritAttrs:!1,props:Rv(),emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const{densityClasses:b,icon:E,model:P,textColorClasses:i,textColorStyles:F,trueValue:j}=tz(e),K=Ya(),Y=He(()=>e.id||`input-${K}`),q=oi(!1),re=oi(!1),me=oi();function we(tt){q.value=!0,(!Px||Px&&tt.target.matches(":focus-visible"))&&(re.value=!0)}function je(){q.value=!1,re.value=!1}function $e(tt){P.value=tt.target.checked}return Ui(()=>{var tt,Ae;const mt=g.label?g.label({label:e.label,props:{for:Y.value}}):e.label,[Me,Ye]=Pp(d);return ce("div",zn({class:["v-selection-control",{"v-selection-control--dirty":P.value,"v-selection-control--disabled":e.disabled,"v-selection-control--error":e.error,"v-selection-control--focused":q.value,"v-selection-control--focus-visible":re.value,"v-selection-control--inline":e.inline},b.value]},Me),[ce("div",{class:["v-selection-control__wrapper",i.value],style:F.value},[(tt=g.default)==null?void 0:tt.call(g),io(ce("div",{class:["v-selection-control__input"]},[E.value&&ce(As,{key:"icon",icon:E.value},null),ce("input",zn({ref:me,checked:P.value,disabled:e.disabled,id:Y.value,onBlur:je,onFocus:we,onInput:$e,"aria-readonly":e.readonly,type:e.type,value:j.value,name:e.name,"aria-checked":e.type==="checkbox"?P.value:void 0},Ye),null),(Ae=g.input)==null?void 0:Ae.call(g,{model:P,textColorClasses:i,textColorStyles:F,props:{onFocus:we,onBlur:je,id:Y.value}})]),[[bc("ripple"),e.ripple&&[!e.disabled&&!e.readonly,null,["center","circle"]]]])]),mt&&ce(Zm,{for:Y.value,clickable:!0},{default:()=>[mt]})])}),{isFocused:q,input:me}}});function MS(e){return nh(e,Object.keys(S_.props))}const kS=mr({indeterminate:Boolean,indeterminateIcon:{type:Yn,default:"$checkboxIndeterminate"},...Rv({falseIcon:"$checkboxOff",trueIcon:"$checkboxOn"})},"VCheckboxBtn"),Wm=$i({name:"VCheckboxBtn",props:kS(),emits:{"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"indeterminate"),b=ar(e,"modelValue");function E(F){g.value&&(g.value=!1)}const P=He(()=>e.indeterminate?e.indeterminateIcon:e.falseIcon),i=He(()=>e.indeterminate?e.indeterminateIcon:e.trueIcon);return Ui(()=>ce(S_,zn(e,{modelValue:b.value,"onUpdate:modelValue":[F=>b.value=F,E],class:"v-checkbox-btn",type:"checkbox",inline:!0,falseIcon:P.value,trueIcon:i.value,"aria-checked":e.indeterminate?"mixed":void 0}),d)),{}}});function iz(e){return nh(e,Object.keys(Wm.props))}const nz=$i({name:"VCheckbox",inheritAttrs:!1,props:{...Ld(),...kS()},setup(e,l){let{attrs:d,slots:g}=l;const b=Ya(),E=He(()=>e.id||`checkbox-${b}`);return Ui(()=>{const[P,i]=Pp(d),[F,j]=Lf(e),[K,Y]=iz(e);return ce(Fh,zn({class:"v-checkbox"},P,F,{id:E.value}),{...g,default:q=>{let{id:re,isDisabled:me,isReadonly:we}=q;return ce(Wm,zn(K,{id:re.value,disabled:me.value,readonly:we.value},i),g)}})}),{}}});const rz=mr({start:Boolean,end:Boolean,icon:Yn,image:String,...oa(),...ts(),...Dd(),...lr(),...xu({variant:"flat"})},"VAvatar"),Mf=$i({name:"VAvatar",props:rz(),setup(e,l){let{slots:d}=l;const{colorClasses:g,colorStyles:b,variantClasses:E}=Dp(e),{densityClasses:P}=Ja(e),{roundedClasses:i}=xs(e),{sizeClasses:F,sizeStyles:j}=$m(e);return Ui(()=>{var K;return ce(e.tag,{class:["v-avatar",{"v-avatar--start":e.start,"v-avatar--end":e.end},g.value,P.value,i.value,F.value,E.value],style:[b.value,j.value]},{default:()=>[e.image?ce(Vm,{key:"image",src:e.image,alt:""},null):e.icon?ce(As,{key:"icon",icon:e.icon},null):(K=d.default)==null?void 0:K.call(d),zp(!1,"v-avatar")]})}),{}}});const PS=Symbol.for("vuetify:v-chip-group"),oz=$i({name:"VChipGroup",props:{column:Boolean,filter:Boolean,valueComparator:{type:Function,default:T_},...Nm({selectedClass:"v-chip--selected"}),...lr(),...Ur(),...xu({variant:"tonal"})},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{isSelected:b,select:E,next:P,prev:i,selected:F}=Bp(e,PS);return Vs({VChip:{color:ki(e,"color"),filter:ki(e,"filter"),variant:ki(e,"variant")}}),Ui(()=>{var j;return ce(e.tag,{class:["v-chip-group",{"v-chip-group--column":e.column},g.value]},{default:()=>[(j=d.default)==null?void 0:j.call(d,{isSelected:b,select:E,next:P,prev:i,selected:F.value})]})}),{}}}),C_=$i({name:"VChip",directives:{Ripple:Rp},props:{activeClass:String,appendAvatar:String,appendIcon:Yn,closable:Boolean,closeIcon:{type:Yn,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:String,default:"$complete"},label:Boolean,link:Boolean,pill:Boolean,prependAvatar:String,prependIcon:Yn,ripple:{type:Boolean,default:!0},text:String,modelValue:{type:Boolean,default:!0},...Ec(),...oa(),...Ns(),...Lp(),...ts(),...qm(),...Dd(),...lr({tag:"span"}),...Ur(),...xu({variant:"tonal"})},emits:{"click:close":e=>!0,"update:active":e=>!0,"update:modelValue":e=>!0,"group:selected":e=>!0},setup(e,l){let{attrs:d,emit:g,slots:b}=l;const{borderClasses:E}=vu(e),{colorClasses:P,colorStyles:i,variantClasses:F}=Dp(e),{densityClasses:j}=Ja(e),{elevationClasses:K}=Da(e),{roundedClasses:Y}=xs(e),{sizeClasses:q}=$m(e),{themeClasses:re}=To(e),me=ar(e,"modelValue"),we=Um(e,PS,!1),je=E_(e,d);function $e(tt){me.value=!1,g("click:close",tt)}return()=>{var tt;const Ae=je.isLink.value?"a":e.tag,mt=!!(b.append||e.appendIcon||e.appendAvatar),Me=!!(b.close||e.closable),Ye=!!(b.filter||e.filter)&&we,Ze=!!(b.prepend||e.prependIcon||e.prependAvatar),rt=!we||we.isSelected.value,gt=!e.disabled&&(!!we||je.isClickable.value||e.link),vt=e.link?e.link:we==null?void 0:we.toggle;return me.value&&io(ce(Ae,{class:["v-chip",{"v-chip--disabled":e.disabled,"v-chip--label":e.label,"v-chip--link":gt,"v-chip--filter":Ye,"v-chip--pill":e.pill},re.value,E.value,rt?P.value:void 0,j.value,K.value,Y.value,q.value,F.value,we==null?void 0:we.selectedClass.value],style:[rt?i.value:void 0],disabled:e.disabled||void 0,draggable:e.draggable,href:je.href.value,onClick:gt&&vt},{default:()=>{var Ut;return[zp(gt,"v-chip"),Ye&&ce(Go,{key:"filter",defaults:{VIcon:{icon:e.filterIcon}}},{default:()=>[ce($1,null,{default:()=>[io(ce("div",{class:"v-chip__filter"},[b.filter?b.filter():ce(As,null,null)]),[[na,we.isSelected.value]])]})]}),Ze&&ce(Go,{key:"prepend",defaults:{VAvatar:{image:e.prependAvatar},VIcon:{icon:e.prependIcon}}},{default:()=>[b.prepend?ce("div",{class:"v-chip__prepend"},[b.prepend()]):e.prependAvatar?ce(Mf,{start:!0},null):e.prependIcon?ce(As,{start:!0},null):void 0]}),(Ut=(tt=b.default)==null?void 0:tt.call(b,{isSelected:we==null?void 0:we.isSelected.value,selectedClass:we==null?void 0:we.selectedClass.value,select:we==null?void 0:we.select,toggle:we==null?void 0:we.toggle,value:we==null?void 0:we.value.value,disabled:e.disabled}))!=null?Ut:e.text,mt&&ce(Go,{key:"append",defaults:{VAvatar:{image:e.appendAvatar},VIcon:{icon:e.appendIcon}}},{default:()=>[b.append?ce("div",{class:"v-chip__append"},[b.append()]):e.appendAvatar?ce(Mf,{end:!0},null):e.appendIcon?ce(As,{end:!0},null):void 0]}),Me&&ce(Go,{key:"close",defaults:{VIcon:{icon:e.closeIcon,size:"x-small"}}},{default:()=>[ce("div",{class:"v-chip__close",onClick:$e},[b.close?b.close():ce(As,null,null)])]})]}}),[[bc("ripple"),gt&&e.ripple,null]])}}});const zS=$i({name:"VDivider",props:{color:String,inset:Boolean,length:[Number,String],thickness:[Number,String],vertical:Boolean,...Ur()},setup(e,l){let{attrs:d}=l;const{themeClasses:g}=To(e),{backgroundColorClasses:b,backgroundColorStyles:E}=vs(ki(e,"color")),P=He(()=>{const i={};return e.length&&(i[e.vertical?"maxHeight":"maxWidth"]=pn(e.length)),e.thickness&&(i[e.vertical?"borderRightWidth":"borderTopWidth"]=pn(e.thickness)),i});return Ui(()=>ce("hr",{class:[{"v-divider":!0,"v-divider--inset":e.inset,"v-divider--vertical":e.vertical},g.value,b.value],style:[P.value,E.value],"aria-orientation":!d.role||d.role==="separator"?e.vertical?"vertical":"horizontal":void 0,role:`${d.role||"separator"}`},null)),{}}}),jx=Symbol.for("vuetify:list");function DS(){const e=co(jx,{hasPrepend:oi(!1),updateHasPrepend:()=>null}),l={hasPrepend:oi(!1),updateHasPrepend:d=>{d&&(l.hasPrepend.value=d)}};return ra(jx,l),e}function LS(){return co(jx,null)}const sz={open:e=>{let{id:l,value:d,opened:g,parents:b}=e;if(d){const E=new Set;E.add(l);let P=b.get(l);for(;P!=null;)E.add(P),P=b.get(P);return E}else return g.delete(l),g},select:()=>null},BS={open:e=>{let{id:l,value:d,opened:g,parents:b}=e;if(d){let E=b.get(l);for(g.add(l);E!=null&&E!==l;)g.add(E),E=b.get(E);return g}else g.delete(l);return g},select:()=>null},az={open:BS.open,select:e=>{let{id:l,value:d,opened:g,parents:b}=e;if(!d)return g;const E=[];let P=b.get(l);for(;P!=null;)E.push(P),P=b.get(P);return new Set(E)}},J1=e=>{const l={select:d=>{let{id:g,value:b,selected:E}=d;if(e&&!b){const P=Array.from(E.entries()).reduce((i,F)=>{let[j,K]=F;return K==="on"?[...i,j]:i},[]);if(P.length===1&&P[0]===g)return E}return E.set(g,b?"on":"off"),E},in:(d,g,b)=>{let E=new Map;for(const P of d||[])E=l.select({id:P,value:!0,selected:new Map(E),children:g,parents:b});return E},out:d=>{const g=[];for(const[b,E]of d.entries())E==="on"&&g.push(b);return g}};return l},RS=e=>{const l=J1(e);return{select:g=>{let{selected:b,id:E,...P}=g;const i=b.has(E)?new Map([[E,b.get(E)]]):new Map;return l.select({...P,id:E,selected:i})},in:(g,b,E)=>{let P=new Map;return g!=null&&g.length&&(P=l.in(g.slice(0,1),b,E)),P},out:(g,b,E)=>l.out(g,b,E)}},lz=e=>{const l=J1(e);return{select:g=>{let{id:b,selected:E,children:P,...i}=g;return P.has(b)?E:l.select({id:b,selected:E,children:P,...i})},in:l.in,out:l.out}},cz=e=>{const l=RS(e);return{select:g=>{let{id:b,selected:E,children:P,...i}=g;return P.has(b)?E:l.select({id:b,selected:E,children:P,...i})},in:l.in,out:l.out}},uz=e=>{const l={select:d=>{let{id:g,value:b,selected:E,children:P,parents:i}=d;const F=new Map(E),j=[g];for(;j.length;){const Y=j.shift();E.set(Y,b?"on":"off"),P.has(Y)&&j.push(...P.get(Y))}let K=i.get(g);for(;K;){const Y=P.get(K),q=Y.every(me=>E.get(me)==="on"),re=Y.every(me=>!E.has(me)||E.get(me)==="off");E.set(K,q?"on":re?"off":"indeterminate"),K=i.get(K)}return e&&!b&&Array.from(E.entries()).reduce((q,re)=>{let[me,we]=re;return we==="on"?[...q,me]:q},[]).length===0?F:E},in:(d,g,b)=>{let E=new Map;for(const P of d||[])E=l.select({id:P,value:!0,selected:new Map(E),children:g,parents:b});return E},out:(d,g)=>{const b=[];for(const[E,P]of d.entries())P==="on"&&!g.has(E)&&b.push(E);return b}};return l},y_=Symbol.for("vuetify:nested"),OS={id:oi(),root:{register:()=>null,unregister:()=>null,parents:oi(new Map),children:oi(new Map),open:()=>null,openOnSelect:()=>null,select:()=>null,opened:oi(new Set),selected:oi(new Map),selectedValues:oi([])}},hz=mr({selectStrategy:[String,Function],openStrategy:[String,Function],opened:Array,selected:Array,mandatory:Boolean},"nested"),dz=e=>{let l=!1;const d=oi(new Map),g=oi(new Map),b=ar(e,"opened",e.opened,Y=>new Set(Y),Y=>[...Y.values()]),E=He(()=>{if(typeof e.selectStrategy=="object")return e.selectStrategy;switch(e.selectStrategy){case"single-leaf":return cz(e.mandatory);case"leaf":return lz(e.mandatory);case"independent":return J1(e.mandatory);case"single-independent":return RS(e.mandatory);case"classic":default:return uz(e.mandatory)}}),P=He(()=>{if(typeof e.openStrategy=="function")return e.openStrategy;switch(e.openStrategy){case"list":return az;case"single":return sz;case"multiple":default:return BS}}),i=ar(e,"selected",e.selected,Y=>E.value.in(Y,d.value,g.value),Y=>E.value.out(Y,d.value,g.value));Xl(()=>{l=!0});function F(Y){const q=[];let re=Y;for(;re!=null;)q.unshift(re),re=g.value.get(re);return q}const j=za("nested"),K={id:oi(),root:{opened:b,selected:i,selectedValues:He(()=>{const Y=[];for(const[q,re]of i.value.entries())re==="on"&&Y.push(q);return Y}),register:(Y,q,re)=>{q&&Y!==q&&g.value.set(Y,q),re&&d.value.set(Y,[]),q!=null&&d.value.set(q,[...d.value.get(q)||[],Y])},unregister:Y=>{var re;if(l)return;d.value.delete(Y);const q=g.value.get(Y);if(q){const me=(re=d.value.get(q))!=null?re:[];d.value.set(q,me.filter(we=>we!==Y))}g.value.delete(Y),b.value.delete(Y)},open:(Y,q,re)=>{j.emit("click:open",{id:Y,value:q,path:F(Y),event:re});const me=P.value.open({id:Y,value:q,opened:new Set(b.value),children:d.value,parents:g.value,event:re});me&&(b.value=me)},openOnSelect:(Y,q,re)=>{const me=P.value.select({id:Y,value:q,selected:new Map(i.value),opened:new Set(b.value),children:d.value,parents:g.value,event:re});me&&(b.value=me)},select:(Y,q,re)=>{j.emit("click:select",{id:Y,value:q,path:F(Y),event:re});const me=E.value.select({id:Y,value:q,selected:new Map(i.value),children:d.value,parents:g.value,event:re});me&&(i.value=me),K.root.openOnSelect(Y,q,re)},children:d,parents:g}};return ra(y_,K),K.root},FS=(e,l)=>{const d=co(y_,OS),g=He(()=>{var E;return(E=e.value)!=null?E:Ya().toString()}),b={...d,id:g,open:(E,P)=>d.root.open(g.value,E,P),openOnSelect:(E,P)=>d.root.openOnSelect(g.value,E,P),isOpen:He(()=>d.root.opened.value.has(g.value)),parent:He(()=>d.root.parents.value.get(g.value)),select:(E,P)=>d.root.select(g.value,E,P),isSelected:He(()=>d.root.selected.value.get(g.value)==="on"),isIndeterminate:He(()=>d.root.selected.value.get(g.value)==="indeterminate"),isLeaf:He(()=>!d.root.children.value.get(g.value)),isGroupActivator:d.isGroupActivator};return!d.isGroupActivator&&d.root.register(g.value,d.id.value,l),Xl(()=>{!d.isGroupActivator&&d.root.unregister(g.value)}),l&&ra(y_,b),b},fz=()=>{const e=co(y_,OS);ra(y_,{...e,isGroupActivator:!0})},pz=$i({name:"VListGroupActivator",setup(e,l){let{slots:d}=l;return fz(),()=>{var g;return(g=d.default)==null?void 0:g.call(d)}}}),mz=mr({activeColor:String,color:String,collapseIcon:{type:Yn,default:"$collapse"},expandIcon:{type:Yn,default:"$expand"},prependIcon:Yn,appendIcon:Yn,fluid:Boolean,subgroup:Boolean,value:null,...lr()},"VListGroup"),Q1=es()({name:"VListGroup",props:{title:String,...mz()},setup(e,l){let{slots:d}=l;const{isOpen:g,open:b}=FS(ki(e,"value"),!0),E=LS(),P=j=>{b(!g.value,j)},i=He(()=>({onClick:P,class:"v-list-group__header"})),F=He(()=>g.value?e.collapseIcon:e.expandIcon);return Ui(()=>{var j;return ce(e.tag,{class:["v-list-group",{"v-list-group--prepend":E==null?void 0:E.hasPrepend.value,"v-list-group--fluid":e.fluid,"v-list-group--subgroup":e.subgroup}]},{default:()=>[d.activator&&ce(Go,{defaults:{VListItem:{active:g.value,activeColor:e.activeColor,color:e.color,prependIcon:e.prependIcon||e.subgroup&&F.value,appendIcon:e.appendIcon||!e.subgroup&&F.value,title:e.title,value:e.value}}},{default:()=>[ce(pz,null,{default:()=>[d.activator({props:i.value,isOpen:g})]})]}),ce(zv,null,{default:()=>[io(ce("div",{class:"v-list-group__items"},[(j=d.default)==null?void 0:j.call(d)]),[[na,g.value]])]})]})}),{}}});function gz(e){return nh(e,Object.keys(Q1.props))}const VS=yu("v-list-item-subtitle"),NS=yu("v-list-item-title"),Md=es()({name:"VListItem",directives:{Ripple:Rp},props:{active:{type:Boolean,default:void 0},activeClass:String,activeColor:String,appendAvatar:String,appendIcon:Yn,disabled:Boolean,lines:String,link:{type:Boolean,default:void 0},nav:Boolean,prependAvatar:String,prependIcon:Yn,subtitle:[String,Number,Boolean],title:[String,Number,Boolean],value:null,...Ec(),...oa(),...oh(),...Ns(),...ts(),...qm(),...lr(),...Ur(),...xu({variant:"text"})},setup(e,l){let{attrs:d,slots:g}=l;const b=E_(e,d),E=He(()=>{var Nt;return(Nt=e.value)!=null?Nt:b.href.value}),{select:P,isSelected:i,isIndeterminate:F,isGroupActivator:j,root:K,parent:Y,openOnSelect:q}=FS(E,!1),re=LS(),me=He(()=>{var Nt;return e.active!==!1&&(e.active||((Nt=b.isActive)==null?void 0:Nt.value)||i.value)}),we=He(()=>e.link!==!1&&b.isLink.value),je=He(()=>!e.disabled&&e.link!==!1&&(e.link||b.isClickable.value||e.value!=null&&!!re)),$e=He(()=>e.rounded||e.nav),tt=He(()=>{var Nt;return{color:me.value&&(Nt=e.activeColor)!=null?Nt:e.color,variant:e.variant}});Mn(()=>{var Nt;return(Nt=b.isActive)==null?void 0:Nt.value},Nt=>{Nt&&Y.value!=null&&K.open(Y.value,!0),Nt&&q(Nt)},{immediate:!0});const{themeClasses:Ae}=To(e),{borderClasses:mt}=vu(e),{colorClasses:Me,colorStyles:Ye,variantClasses:Ze}=Dp(tt),{densityClasses:rt}=Ja(e),{dimensionStyles:gt}=sh(e),{elevationClasses:vt}=Da(e),{roundedClasses:Ut}=xs($e),At=He(()=>e.lines?`v-list-item--${e.lines}-line`:void 0),ti=He(()=>({isActive:me.value,select:P,isSelected:i.value,isIndeterminate:F.value}));return Ui(()=>{var Nt,Wt,zt,Yt,vi;const cn=we.value?"a":e.tag,di=!re||i.value||me.value,un=g.title||e.title,mn=g.subtitle||e.subtitle,Er=!!(g.append||e.appendAvatar||e.appendIcon),Li=!!(g.prepend||e.prependAvatar||e.prependIcon);return re==null||re.updateHasPrepend(Li),io(ce(cn,{class:["v-list-item",{"v-list-item--active":me.value,"v-list-item--disabled":e.disabled,"v-list-item--link":je.value,"v-list-item--nav":e.nav,"v-list-item--prepend":!Li&&(re==null?void 0:re.hasPrepend.value),[`${e.activeClass}`]:me.value},Ae.value,mt.value,di?Me.value:void 0,rt.value,vt.value,At.value,Ut.value,Ze.value],style:[di?Ye.value:void 0,gt.value],href:b.href.value,tabindex:je.value?0:void 0,onClick:je.value&&(En=>{var wn;j||((wn=b.navigate)==null||wn.call(b,En),e.value!=null&&P(!i.value,En))})},{default:()=>[zp(je.value||me.value,"v-list-item"),Li&&ce(Go,{key:"prepend",defaults:{VAvatar:{density:e.density,image:e.prependAvatar},VIcon:{density:e.density,icon:e.prependIcon},VListItemAction:{start:!0}}},{default:()=>[ce("div",{class:"v-list-item__prepend"},[e.prependAvatar&&ce(Mf,{key:"prepend-avatar"},null),e.prependIcon&&ce(As,{key:"prepend-icon"},null),(Nt=g.prepend)==null?void 0:Nt.call(g,ti.value)])]}),ce("div",{class:"v-list-item__content"},[un&&ce(NS,{key:"title"},{default:()=>{var En;return[(En=(Wt=g.title)==null?void 0:Wt.call(g,{title:e.title}))!=null?En:e.title]}}),mn&&ce(VS,{key:"subtitle"},{default:()=>{var En;return[(En=(zt=g.subtitle)==null?void 0:zt.call(g,{subtitle:e.subtitle}))!=null?En:e.subtitle]}}),(Yt=g.default)==null?void 0:Yt.call(g,ti.value)]),Er&&ce(Go,{key:"append",defaults:{VAvatar:{density:e.density,image:e.appendAvatar},VIcon:{density:e.density,icon:e.appendIcon},VListItemAction:{end:!0}}},{default:()=>[ce("div",{class:"v-list-item__append"},[(vi=g.append)==null?void 0:vi.call(g,ti.value),e.appendIcon&&ce(As,{key:"append-icon"},null),e.appendAvatar&&ce(Mf,{key:"append-avatar"},null)])]})]}),[[bc("ripple"),je.value]])}),{}}}),US=$i({name:"VListSubheader",props:{color:String,inset:Boolean,sticky:Boolean,title:String,...lr()},setup(e,l){let{slots:d}=l;const{textColorClasses:g,textColorStyles:b}=Zl(ki(e,"color"));return Ui(()=>{var E;const P=!!(d.default||e.title);return ce(e.tag,{class:["v-list-subheader",{"v-list-subheader--inset":e.inset,"v-list-subheader--sticky":e.sticky},g.value],style:{textColorStyles:b}},{default:()=>{var i;return[P&&ce("div",{class:"v-list-subheader__text"},[(i=(E=d.default)==null?void 0:E.call(d))!=null?i:e.title])]}})}),{}}}),$S=es()({name:"VListChildren",props:{items:Array},setup(e,l){let{slots:d}=l;return DS(),()=>{var E;var g,b;return(E=(g=d.default)==null?void 0:g.call(d))!=null?E:(b=e.items)==null?void 0:b.map(P=>{var je,$e;let{children:i,props:F,type:j,raw:K}=P;if(j==="divider"){var Y;return(je=(Y=d.divider)==null?void 0:Y.call(d,{props:F}))!=null?je:ce(zS,F,null)}if(j==="subheader"){var q;return($e=(q=d.subheader)==null?void 0:q.call(d,{props:F}))!=null?$e:ce(US,F,{default:d.subheader})}const re={subtitle:d.subtitle?tt=>{var Ae;return(Ae=d.subtitle)==null?void 0:Ae.call(d,{...tt,item:K})}:void 0,prepend:d.prepend?tt=>{var Ae;return(Ae=d.prepend)==null?void 0:Ae.call(d,{...tt,item:K})}:void 0,append:d.append?tt=>{var Ae;return(Ae=d.append)==null?void 0:Ae.call(d,{...tt,item:K})}:void 0,default:d.default?tt=>{var Ae;return(Ae=d.default)==null?void 0:Ae.call(d,{...tt,item:K})}:void 0,title:d.title?tt=>{var Ae;return(Ae=d.title)==null?void 0:Ae.call(d,{...tt,item:K})}:void 0},[me,we]=gz(F);return i?ce(Q1,zn({value:F==null?void 0:F.value},me),{activator:tt=>{let{props:Ae}=tt;return d.header?d.header({...F,...Ae}):ce(Md,zn(F,Ae),re)},default:()=>ce($S,{items:i},d)}):d.item?d.item(F):ce(Md,F,re)})}}}),jS=mr({items:{type:Array,default:()=>[]},itemTitle:{type:[String,Array,Function],default:"title"},itemValue:{type:[String,Array,Function],default:"value"},itemChildren:{type:[Boolean,String,Array,Function],default:"children"},itemProps:{type:[Boolean,String,Array,Function],default:"props"},returnObject:Boolean},"item");function Em(e,l){var i;const d=Lh(l,e.itemTitle,l),g=e.returnObject?l:Lh(l,e.itemValue,d),b=Lh(l,e.itemChildren),E=e.itemProps===!0?typeof l=="object"&&l!=null&&!Array.isArray(l)?"children"in l?nh(l,["children"])[1]:l:void 0:Lh(l,e.itemProps),P={title:d,value:g,...E};return{title:String((i=P.title)!=null?i:""),value:P.value,props:P,children:Array.isArray(b)?GS(e,b):void 0,raw:l}}function GS(e,l){const d=[];for(const g of l)d.push(Em(e,g));return d}function eb(e){const l=He(()=>GS(e,e.items));function d(b){return b.map(E=>Em(e,E))}function g(b){return b.map(E=>{let{props:P}=E;return P.value})}return{items:l,transformIn:d,transformOut:g}}function _z(e,l){const d=Lh(l,e.itemType,"item"),g=typeof l=="string"?l:Lh(l,e.itemTitle),b=Lh(l,e.itemValue,void 0),E=Lh(l,e.itemChildren),P=e.itemProps===!0?nh(l,["children"])[1]:Lh(l,e.itemProps),i={title:g,value:b,...P};return{type:d,title:i.title,value:i.value,props:i,children:d==="item"&&E?qS(e,E):void 0,raw:l}}function qS(e,l){const d=[];for(const g of l)d.push(_z(e,g));return d}function yz(e){return{items:He(()=>qS(e,e.items))}}const Ov=es()({name:"VList",props:{activeColor:String,activeClass:String,bgColor:String,disabled:Boolean,lines:{type:[Boolean,String],default:"one"},nav:Boolean,...hz({selectStrategy:"single-leaf",openStrategy:"list"}),...Ec(),...oa(),...oh(),...Ns(),itemType:{type:String,default:"type"},...jS(),...ts(),...lr(),...Ur(),...xu({variant:"text"})},emits:{"update:selected":e=>!0,"update:opened":e=>!0,"click:open":e=>!0,"click:select":e=>!0},setup(e,l){let{slots:d}=l;const{items:g}=yz(e),{themeClasses:b}=To(e),{backgroundColorClasses:E,backgroundColorStyles:P}=vs(ki(e,"bgColor")),{borderClasses:i}=vu(e),{densityClasses:F}=Ja(e),{dimensionStyles:j}=sh(e),{elevationClasses:K}=Da(e),{roundedClasses:Y}=xs(e),{open:q,select:re}=dz(e),me=He(()=>e.lines?`v-list--${e.lines}-line`:void 0),we=ki(e,"activeColor"),je=ki(e,"color");return DS(),Vs({VListGroup:{activeColor:we,color:je},VListItem:{activeClass:ki(e,"activeClass"),activeColor:we,color:je,density:ki(e,"density"),disabled:ki(e,"disabled"),lines:ki(e,"lines"),nav:ki(e,"nav"),variant:ki(e,"variant")}}),Ui(()=>ce(e.tag,{class:["v-list",{"v-list--disabled":e.disabled,"v-list--nav":e.nav},b.value,E.value,i.value,F.value,K.value,me.value,Y.value],style:[P.value,j.value]},{default:()=>[ce($S,{items:g.value},d)]})),{open:q,select:re}}}),vz=yu("v-list-img"),xz=$i({name:"VListItemAction",props:{start:Boolean,end:Boolean,...lr()},setup(e,l){let{slots:d}=l;return Ui(()=>ce(e.tag,{class:["v-list-item-action",{"v-list-item-action--start":e.start,"v-list-item-action--end":e.end}]},d)),{}}}),bz=$i({name:"VListItemMedia",props:{start:Boolean,end:Boolean,...lr()},setup(e,l){let{slots:d}=l;return Ui(()=>ce(e.tag,{class:["v-list-item-media",{"v-list-item-media--start":e.start,"v-list-item-media--end":e.end}]},d)),{}}});const ZS=mr({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function WS(e,l){const d={},g=b=>()=>{if(!Jo)return Promise.resolve(!0);const E=b==="openDelay";return d.closeDelay&&window.clearTimeout(d.closeDelay),delete d.closeDelay,d.openDelay&&window.clearTimeout(d.openDelay),delete d.openDelay,new Promise(P=>{var F;const i=parseInt((F=e[b])!=null?F:0,10);d[b]=window.setTimeout(()=>{l==null||l(E),P(E)},i)})};return{runCloseDelay:g("closeDelay"),runOpenDelay:g("openDelay")}}const Gx=Symbol.for("vuetify:v-menu"),wz=mr({activator:[String,Object],activatorProps:{type:Object,default:()=>({})},openOnClick:{type:Boolean,default:void 0},openOnHover:Boolean,openOnFocus:{type:Boolean,default:void 0},closeOnContentClick:Boolean,...ZS()},"VOverlay/useActivator");function Tz(e,l){let{isActive:d,isTop:g}=l;const b=oi();let E=!1,P=!1,i=!0;const F=He(()=>e.openOnFocus||e.openOnFocus==null&&e.openOnHover),j=He(()=>e.openOnClick||e.openOnClick==null&&!e.openOnHover&&!F.value),{runOpenDelay:K,runCloseDelay:Y}=WS(e,Ae=>{Ae===(e.openOnHover&&E||F.value&&P)&&!(e.openOnHover&&d.value&&!g.value)&&(d.value!==Ae&&(i=!0),d.value=Ae)}),q={click:Ae=>{Ae.stopPropagation(),b.value=Ae.currentTarget||Ae.target,d.value=!d.value},mouseenter:Ae=>{E=!0,b.value=Ae.currentTarget||Ae.target,K()},mouseleave:Ae=>{E=!1,Y()},focus:Ae=>{Px&&!Ae.target.matches(":focus-visible")||(P=!0,Ae.stopPropagation(),b.value=Ae.currentTarget||Ae.target,K())},blur:Ae=>{P=!1,Ae.stopPropagation(),Y()}},re=He(()=>{const Ae={};return j.value&&(Ae.click=q.click),e.openOnHover&&(Ae.mouseenter=q.mouseenter,Ae.mouseleave=q.mouseleave),F.value&&(Ae.focus=q.focus,Ae.blur=q.blur),Ae}),me=He(()=>{const Ae={};if(e.openOnHover&&(Ae.mouseenter=()=>{E=!0,K()},Ae.mouseleave=()=>{E=!1,Y()}),e.closeOnContentClick){const mt=co(Gx,null);Ae.click=()=>{d.value=!1,mt==null||mt.closeParents()}}return Ae}),we=He(()=>{const Ae={};return e.openOnHover&&(Ae.mouseenter=()=>{i&&(E=!0,i=!1,K())},Ae.mouseleave=()=>{E=!1,Y()}),Ae});Mn(g,Ae=>{Ae&&(e.openOnHover&&!E&&(!F.value||!P)||F.value&&!P&&(!e.openOnHover||!E))&&(d.value=!1)});const je=oi();Oh(()=>{!je.value||ys(()=>{const Ae=je.value;b.value=fP(Ae)?Ae.$el:Ae})});const $e=za("useActivator");let tt;return Mn(()=>!!e.activator,Ae=>{Ae&&Jo?(tt=b_(),tt.run(()=>{Ez(e,$e,{activatorEl:b,activatorEvents:re})})):tt&&tt.stop()},{flush:"post",immediate:!0}),{activatorEl:b,activatorRef:je,activatorEvents:re,contentEvents:me,scrimEvents:we}}function Ez(e,l,d){let{activatorEl:g,activatorEvents:b}=d;Mn(()=>e.activator,(F,j)=>{if(j&&F!==j){const K=i(j);K&&P(K)}F&&ys(()=>E())},{immediate:!0}),Mn(()=>e.activatorProps,()=>{E()}),Ap(()=>{P()});function E(){let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i(),j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;!F||(Object.entries(b.value).forEach(K=>{let[Y,q]=K;F.addEventListener(Y,q)}),Object.keys(j).forEach(K=>{j[K]==null?F.removeAttribute(K):F.setAttribute(K,j[K])}))}function P(){let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i(),j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;!F||(Object.entries(b.value).forEach(K=>{let[Y,q]=K;F.removeEventListener(Y,q)}),Object.keys(j).forEach(K=>{F.removeAttribute(K)}))}function i(){var F;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.activator,K;if(j)if(j==="parent"){var Y,q;let re=l==null||(Y=l.proxy)==null||(q=Y.$el)==null?void 0:q.parentNode;for(;re.hasAttribute("data-no-activator");)re=re.parentNode;K=re}else typeof j=="string"?K=document.querySelector(j):"$el"in j?K=j.$el:K=j;return g.value=((F=K)==null?void 0:F.nodeType)===Node.ELEMENT_NODE?K:null,g.value}}const Fv=mr({eager:Boolean},"lazy");function tb(e,l){const d=oi(!1),g=He(()=>d.value||e.eager||l.value);Mn(l,()=>d.value=!0);function b(){e.eager||(d.value=!1)}return{isBooted:d,hasContent:g,onAfterLeave:b}}function ax(e,l){return{x:e.x+l.x,y:e.y+l.y}}function Sz(e,l){return{x:e.x-l.x,y:e.y-l.y}}function R2(e,l){if(e.side==="top"||e.side==="bottom"){const{side:d,align:g}=e,b=g==="left"?0:g==="center"?l.width/2:g==="right"?l.width:g,E=d==="top"?0:d==="bottom"?l.height:d;return ax({x:b,y:E},l)}else if(e.side==="left"||e.side==="right"){const{side:d,align:g}=e,b=d==="left"?0:d==="right"?l.width:d,E=g==="top"?0:g==="center"?l.height/2:g==="bottom"?l.height:g;return ax({x:b,y:E},l)}return ax({x:l.width/2,y:l.height/2},l)}const XS={static:Az,connected:kz},Cz=mr({locationStrategy:{type:[String,Function],default:"static",validator:e=>typeof e=="function"||e in XS},location:{type:String,default:"bottom"},origin:{type:String,default:"auto"},offset:[Number,String,Array]},"VOverlay/locationStrategies");function Iz(e,l){const d=oi({}),g=oi();let b;Oh(async()=>{var P;(P=b)==null||P.stop(),g.value=void 0,Jo&&l.isActive.value&&e.locationStrategy&&(b=b_(),await ys(),b.run(()=>{if(typeof e.locationStrategy=="function"){var i;g.value=(i=e.locationStrategy(l,e,d))==null?void 0:i.updateLocation}else{var F;g.value=(F=XS[e.locationStrategy](l,e,d))==null?void 0:F.updateLocation}}))}),Jo&&window.addEventListener("resize",E,{passive:!0}),Ap(()=>{var P;Jo&&window.removeEventListener("resize",E),g.value=void 0,(P=b)==null||P.stop()});function E(P){var i;(i=g.value)==null||i.call(g,P)}return{contentStyles:d,updateLocation:g}}function Az(){}function Mz(e){const l=R1(e);return l.x-=parseFloat(e.style.left||0),l.y-=parseFloat(e.style.top||0),l}function kz(e,l,d){const g=$P(e.activatorEl.value);g&&Object.assign(d.value,{position:"fixed"});const{preferredAnchor:b,preferredOrigin:E}=B1(()=>{const re=Bx(l.location,e.isRtl.value),me=l.origin==="overlap"?re:l.origin==="auto"?tx(re):Bx(l.origin,e.isRtl.value);return re.side===me.side&&re.align===ix(me).align?{preferredAnchor:g2(re),preferredOrigin:g2(me)}:{preferredAnchor:re,preferredOrigin:me}}),[P,i,F,j]=["minWidth","minHeight","maxWidth","maxHeight"].map(re=>He(()=>{const me=parseFloat(l[re]);return isNaN(me)?1/0:me})),K=He(()=>{if(Array.isArray(l.offset))return l.offset;if(typeof l.offset=="string"){const re=l.offset.split(" ").map(parseFloat);return re.length<2&&re.push(0),re}return typeof l.offset=="number"?[l.offset,0]:[0,0]});let Y=!1;if(Jo){const re=new ResizeObserver(()=>{Y&&q()});Mn([e.activatorEl,e.contentEl],(me,we)=>{let[je,$e]=me,[tt,Ae]=we;tt&&re.unobserve(tt),je&&re.observe(je),Ae&&re.unobserve(Ae),$e&&re.observe($e)},{immediate:!0}),Ap(()=>{re.disconnect()})}function q(){if(Y=!1,requestAnimationFrame(()=>{requestAnimationFrame(()=>Y=!0)}),!e.activatorEl.value||!e.contentEl.value)return;const re=e.activatorEl.value.getBoundingClientRect(),me=Mz(e.contentEl.value),we=uv(e.contentEl.value),je=12;we.length||(we.push(document.documentElement),e.contentEl.value.style.top&&e.contentEl.value.style.left||(me.x+=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-x")||0),me.y+=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-y")||0)));const $e=we.reduce((vt,Ut)=>{const At=Ut.getBoundingClientRect(),ti=new Mm({x:Ut===document.documentElement?0:At.x,y:Ut===document.documentElement?0:At.y,width:Ut.clientWidth,height:Ut.clientHeight});return vt?new Mm({x:Math.max(vt.left,ti.left),y:Math.max(vt.top,ti.top),width:Math.min(vt.right,ti.right)-Math.max(vt.left,ti.left),height:Math.min(vt.bottom,ti.bottom)-Math.max(vt.top,ti.top)}):ti},void 0);$e.x+=je,$e.y+=je,$e.width-=je*2,$e.height-=je*2;let tt={anchor:b.value,origin:E.value};function Ae(vt){const Ut=new Mm(me),At=R2(vt.anchor,re),ti=R2(vt.origin,Ut);let{x:Nt,y:Wt}=Sz(At,ti);switch(vt.anchor.side){case"top":Wt-=K.value[0];break;case"bottom":Wt+=K.value[0];break;case"left":Nt-=K.value[0];break;case"right":Nt+=K.value[0];break}switch(vt.anchor.align){case"top":Wt-=K.value[1];break;case"bottom":Wt+=K.value[1];break;case"left":Nt-=K.value[1];break;case"right":Nt+=K.value[1];break}return Ut.x+=Nt,Ut.y+=Wt,Ut.width=Math.min(Ut.width,F.value),Ut.height=Math.min(Ut.height,j.value),{overflows:y2(Ut,$e),x:Nt,y:Wt}}let mt=0,Me=0;const Ye={x:0,y:0},Ze={x:!1,y:!1};let rt=-1;for(;;){if(rt++>10){Ox("Infinite loop detected in connectedLocationStrategy");break}const{x:vt,y:Ut,overflows:At}=Ae(tt);mt+=vt,Me+=Ut,me.x+=vt,me.y+=Ut;{const ti=_2(tt.anchor),Nt=At.x.before||At.x.after,Wt=At.y.before||At.y.after;let zt=!1;if(["x","y"].forEach(Yt=>{if(Yt==="x"&&Nt&&!Ze.x||Yt==="y"&&Wt&&!Ze.y){const vi={anchor:{...tt.anchor},origin:{...tt.origin}},cn=Yt==="x"?ti==="y"?ix:tx:ti==="y"?tx:ix;vi.anchor=cn(vi.anchor),vi.origin=cn(vi.origin);const{overflows:di}=Ae(vi);(di[Yt].before<=At[Yt].before&&di[Yt].after<=At[Yt].after||di[Yt].before+di[Yt].after<(At[Yt].before+At[Yt].after)/2)&&(tt=vi,zt=Ze[Yt]=!0)}}),zt)continue}At.x.before&&(mt+=At.x.before,me.x+=At.x.before),At.x.after&&(mt-=At.x.after,me.x-=At.x.after),At.y.before&&(Me+=At.y.before,me.y+=At.y.before),At.y.after&&(Me-=At.y.after,me.y-=At.y.after);{const ti=y2(me,$e);Ye.x=$e.width-ti.x.before-ti.x.after,Ye.y=$e.height-ti.y.before-ti.y.after,mt+=ti.x.before,me.x+=ti.x.before,Me+=ti.y.before,me.y+=ti.y.before}break}const gt=_2(tt.anchor);Object.assign(d.value,{"--v-overlay-anchor-origin":`${tt.anchor.side} ${tt.anchor.align}`,transformOrigin:`${tt.origin.side} ${tt.origin.align}`,top:pn(O2(Me)),left:pn(O2(mt)),minWidth:pn(gt==="y"?Math.min(P.value,re.width):P.value),maxWidth:pn(F2(du(Ye.x,P.value===1/0?0:P.value,F.value))),maxHeight:pn(F2(du(Ye.y,i.value===1/0?0:i.value,j.value)))})}return Mn(()=>[b.value,E.value,l.offset,l.minWidth,l.minHeight,l.maxWidth,l.maxHeight],()=>q(),{immediate:!g}),g&&ys(()=>q()),requestAnimationFrame(()=>{d.value.maxHeight&&q()}),{updateLocation:q}}function O2(e){return Math.round(e*devicePixelRatio)/devicePixelRatio}function F2(e){return Math.ceil(e*devicePixelRatio)/devicePixelRatio}let qx=!0;const mv=[];function Pz(e){!qx||mv.length?(mv.push(e),Zx()):(qx=!1,e(),Zx())}let V2=-1;function Zx(){cancelAnimationFrame(V2),V2=requestAnimationFrame(()=>{const e=mv.shift();e&&e(),mv.length?Zx():qx=!0})}const Wx={none:null,close:Lz,block:Bz,reposition:Rz},zz=mr({scrollStrategy:{type:[String,Function],default:"block",validator:e=>typeof e=="function"||e in Wx}},"VOverlay/scrollStrategies");function Dz(e,l){if(!Jo)return;let d;Oh(async()=>{var g;(g=d)==null||g.stop(),l.isActive.value&&e.scrollStrategy&&(d=b_(),await ys(),d.run(()=>{if(typeof e.scrollStrategy=="function")e.scrollStrategy(l,e);else{var b;(b=Wx[e.scrollStrategy])==null||b.call(Wx,l,e)}}))})}function Lz(e){var d;function l(g){e.isActive.value=!1}HS((d=e.activatorEl.value)!=null?d:e.contentEl.value,l)}function Bz(e,l){var d;const g=(d=e.root.value)==null?void 0:d.offsetParent,b=[...new Set([...uv(e.activatorEl.value,l.contained?g:void 0),...uv(e.contentEl.value,l.contained?g:void 0)])].filter(i=>!i.classList.contains("v-overlay-scroll-blocked")),E=window.innerWidth-document.documentElement.offsetWidth,P=(i=>V1(i)&&i)(g||document.documentElement);P&&e.root.value.classList.add("v-overlay--scroll-blocked"),b.forEach((i,F)=>{i.style.setProperty("--v-body-scroll-x",pn(-i.scrollLeft)),i.style.setProperty("--v-body-scroll-y",pn(-i.scrollTop)),i.style.setProperty("--v-scrollbar-offset",pn(E)),i.classList.add("v-overlay-scroll-blocked")}),Ap(()=>{b.forEach((i,F)=>{const j=parseFloat(i.style.getPropertyValue("--v-body-scroll-x")),K=parseFloat(i.style.getPropertyValue("--v-body-scroll-y"));i.style.removeProperty("--v-body-scroll-x"),i.style.removeProperty("--v-body-scroll-y"),i.style.removeProperty("--v-scrollbar-offset"),i.classList.remove("v-overlay-scroll-blocked"),i.scrollLeft=-j,i.scrollTop=-K}),P&&e.root.value.classList.remove("v-overlay--scroll-blocked")})}function Rz(e){var b;let l=!1,d=-1;function g(E){Pz(()=>{var P,i;const F=performance.now();(P=(i=e.updateLocation).value)==null||P.call(i,E),l=(performance.now()-F)/(1e3/60)>2})}HS((b=e.activatorEl.value)!=null?b:e.contentEl.value,E=>{l?(cancelAnimationFrame(d),d=requestAnimationFrame(()=>{d=requestAnimationFrame(()=>{g(E)})})):g(E)})}function HS(e,l){const d=[document,...uv(e)];d.forEach(g=>{g.addEventListener("scroll",l,{passive:!0})}),Ap(()=>{d.forEach(g=>{g.removeEventListener("scroll",l)})})}const N2=Symbol.for("vuetify:stack"),Wg=wl([]);function Oz(e,l){const d=za("useStack"),g=co(N2,void 0),b=wl({activeChildren:new Set});ra(N2,b);const E=oi(+l.value);N1(e,()=>{var F;const j=(F=Wg.at(-1))==null?void 0:F[1];E.value=j?j+10:+l.value,Wg.push([d.uid,E.value]),g==null||g.activeChildren.add(d.uid),Ap(()=>{const K=Wg.findIndex(Y=>Y[0]===d.uid);Wg.splice(K,1),g==null||g.activeChildren.delete(d.uid)})});const P=oi(!0);Oh(()=>{var F;const j=((F=Wg.at(-1))==null?void 0:F[0])===d.uid;setTimeout(()=>P.value=j)});const i=He(()=>!b.activeChildren.size);return{globalTop:w_(P),localTop:i,stackStyles:He(()=>({zIndex:E.value}))}}function r_(e){return{teleportTarget:He(()=>{const d=e.value;if(d===!0||!Jo)return;const g=d===!1?document.body:typeof d=="string"?document.querySelector(d):d;if(g==null){EM(`Unable to locate target ${d}`);return}if(!r_.cache.has(g)){const b=document.createElement("div");b.className="v-overlay-container",g.appendChild(b),r_.cache.set(g,b)}return r_.cache.get(g)})}}r_.cache=new WeakMap;function Fz(){return!0}function KS(e,l,d){if(!e||YS(e,d)===!1)return!1;const g=WE(l);if(typeof ShadowRoot<"u"&&g instanceof ShadowRoot&&g.host===e.target)return!1;const b=(typeof d.value=="object"&&d.value.include||(()=>[]))();return b.push(l),!b.some(E=>E==null?void 0:E.contains(e.target))}function YS(e,l){return(typeof l.value=="object"&&l.value.closeConditional||Fz)(e)}function Vz(e,l,d){const g=typeof d.value=="function"?d.value:d.value.handler;l._clickOutside.lastMousedownWasOutside&&KS(e,l,d)&&setTimeout(()=>{YS(e,d)&&g&&g(e)},0)}function U2(e,l){const d=WE(e);l(document),typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&l(d)}const Nz={mounted(e,l){const d=b=>Vz(b,e,l),g=b=>{e._clickOutside.lastMousedownWasOutside=KS(b,e,l)};U2(e,b=>{b.addEventListener("click",d,!0),b.addEventListener("mousedown",g,!0)}),e._clickOutside||(e._clickOutside={lastMousedownWasOutside:!0}),e._clickOutside[l.instance.$.uid]={onClick:d,onMousedown:g}},unmounted(e,l){!e._clickOutside||(U2(e,d=>{var g;if(!d||!((g=e._clickOutside)!=null&&g[l.instance.$.uid]))return;const{onClick:b,onMousedown:E}=e._clickOutside[l.instance.$.uid];d.removeEventListener("click",b,!0),d.removeEventListener("mousedown",E,!0)}),delete e._clickOutside[l.instance.$.uid])}};function Uz(e){const{modelValue:l,color:d,...g}=e;return ce(Rh,{name:"fade-transition",appear:!0},{default:()=>[e.modelValue&&ce("div",zn({class:["v-overlay__scrim",e.color.backgroundColorClasses.value],style:e.color.backgroundColorStyles.value},g),null)]})}const I_=es()({name:"VOverlay",directives:{ClickOutside:Nz},inheritAttrs:!1,props:{absolute:Boolean,attach:[Boolean,String,Object],closeOnBack:{type:Boolean,default:!0},contained:Boolean,contentClass:null,contentProps:null,disabled:Boolean,noClickAnimation:Boolean,modelValue:Boolean,persistent:Boolean,scrim:{type:[String,Boolean],default:!0},zIndex:{type:[Number,String],default:2e3},...wz(),...oh(),...Fv(),...Cz(),...zz(),...Ur(),...Tc()},emits:{"click:outside":e=>!0,"update:modelValue":e=>!0,afterLeave:()=>!0},setup(e,l){let{slots:d,attrs:g,emit:b}=l;const E=ar(e,"modelValue"),P=He({get:()=>E.value,set:Yt=>{Yt&&e.disabled||(E.value=Yt)}}),{teleportTarget:i}=r_(He(()=>e.attach||e.contained)),{themeClasses:F}=To(e),{rtlClasses:j,isRtl:K}=zd(),{hasContent:Y,onAfterLeave:q}=tb(e,P),re=vs(He(()=>typeof e.scrim=="string"?e.scrim:null)),{globalTop:me,localTop:we,stackStyles:je}=Oz(P,ki(e,"zIndex")),{activatorEl:$e,activatorRef:tt,activatorEvents:Ae,contentEvents:mt,scrimEvents:Me}=Tz(e,{isActive:P,isTop:we}),{dimensionStyles:Ye}=sh(e);Mn(()=>e.disabled,Yt=>{Yt&&(P.value=!1)});const Ze=oi(),rt=oi(),{contentStyles:gt,updateLocation:vt}=Iz(e,{isRtl:K,contentEl:rt,activatorEl:$e,isActive:P});Dz(e,{root:Ze,contentEl:rt,activatorEl:$e,isActive:P,updateLocation:vt});function Ut(Yt){b("click:outside",Yt),e.persistent?zt():P.value=!1}function At(){return P.value&&me.value}Jo&&Mn(P,Yt=>{Yt?window.addEventListener("keydown",ti):window.removeEventListener("keydown",ti)},{immediate:!0});function ti(Yt){Yt.key==="Escape"&&me.value&&(e.persistent?zt():P.value=!1)}const Nt=xS();N1(()=>e.closeOnBack,()=>{q4(Nt,Yt=>{me.value&&P.value?(Yt(!1),e.persistent?zt():P.value=!1):Yt()})});const Wt=oi();Mn(()=>P.value&&(e.absolute||e.contained)&&i.value==null,Yt=>{if(Yt){const vi=XE(Ze.value);vi&&vi!==document.scrollingElement&&(Wt.value=vi.scrollTop)}});function zt(){e.noClickAnimation||rt.value&&xp(rt.value,[{transformOrigin:"center"},{transform:"scale(1.03)"},{transformOrigin:"center"}],{duration:150,easing:p_})}return Ui(()=>{var Yt,vi;return ce(Tr,null,[(Yt=d.activator)==null?void 0:Yt.call(d,{isActive:P.value,props:zn({ref:tt},H0(Ae.value),e.activatorProps)}),Jo&&ce(mk,{disabled:!i.value,to:i.value},{default:()=>[Y.value&&ce("div",zn({class:["v-overlay",{"v-overlay--absolute":e.absolute||e.contained,"v-overlay--active":P.value,"v-overlay--contained":e.contained},F.value,j.value],style:[je.value,{top:pn(Wt.value)}],ref:Ze},g),[ce(Uz,zn({color:re,modelValue:P.value&&!!e.scrim},H0(Me.value)),null),ce(Bh,{appear:!0,persisted:!0,transition:e.transition,target:$e.value,onAfterLeave:()=>{q(),b("afterLeave")}},{default:()=>[io(ce("div",zn({ref:rt,class:["v-overlay__content",e.contentClass],style:[Ye.value,gt.value]},H0(mt.value),e.contentProps),[(vi=d.default)==null?void 0:vi.call(d,{isActive:P})]),[[na,P.value],[bc("click-outside"),{handler:Ut,closeConditional:At,include:()=>[$e.value]}]])]})])]})])}),{activatorEl:$e,animateClick:zt,contentEl:rt,globalTop:me,localTop:we,updateLocation:vt}}}),lx=Symbol("Forwarded refs");function ah(e){for(var l=arguments.length,d=new Array(l>1?l-1:0),g=1;g<l;g++)d[g-1]=arguments[g];return e[lx]=d,new Proxy(e,{get(b,E){if(Reflect.has(b,E))return Reflect.get(b,E);for(const P of d)if(P.value&&Reflect.has(P.value,E)){const i=Reflect.get(P.value,E);return typeof i=="function"?i.bind(P.value):i}},getOwnPropertyDescriptor(b,E){const P=Reflect.getOwnPropertyDescriptor(b,E);if(P)return P;if(!(typeof E=="symbol"||E.startsWith("__"))){for(const i of d){if(!i.value)continue;const F=Reflect.getOwnPropertyDescriptor(i.value,E);if(F)return F;if("_"in i.value&&"setupState"in i.value._){const j=Reflect.getOwnPropertyDescriptor(i.value._.setupState,E);if(j)return j}}for(const i of d){let F=i.value&&Object.getPrototypeOf(i.value);for(;F;){const j=Reflect.getOwnPropertyDescriptor(F,E);if(j)return j;F=Object.getPrototypeOf(F)}}for(const i of d){const F=i.value&&i.value[lx];if(!F)continue;const j=F.slice();for(;j.length;){const K=j.shift(),Y=Reflect.getOwnPropertyDescriptor(K.value,E);if(Y)return Y;const q=K.value&&K.value[lx];q&&j.push(...q)}}}}})}function Vv(){const l=za("useScopeId").vnode.scopeId;return{scopeId:l?{[l]:""}:void 0}}const Nv=es()({name:"VMenu",inheritAttrs:!1,props:{modelValue:Boolean,id:String,...Tc({transition:{component:Pv}})},emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const b=ar(e,"modelValue"),{scopeId:E}=Vv(),P=Ya(),i=He(()=>e.id||`v-menu-${P}`),F=oi(),j=co(Gx,null);let K=0;ra(Gx,{register(){++K},unregister(){--K},closeParents(){setTimeout(()=>{K||(b.value=!1,j==null||j.closeParents())},40)}}),Mn(b,q=>{q?j==null||j.register():j==null||j.unregister()});function Y(){j==null||j.closeParents()}return Ui(()=>ce(I_,zn({ref:F,modelValue:b.value,"onUpdate:modelValue":q=>b.value=q,class:["v-menu"],transition:e.transition,absolute:!0,closeOnContentClick:!0,locationStrategy:"connected",scrollStrategy:"reposition",scrim:!1,openDelay:"300",closeDelay:"250",activatorProps:{"aria-haspopup":"menu","aria-expanded":String(b.value),"aria-owns":i.value},"onClick:outside":Y},E,d),{activator:g.activator,default:function(){for(var q,re=arguments.length,me=new Array(re),we=0;we<re;we++)me[we]=arguments[we];return ce(Go,{root:!0},{default:()=>[(q=g.default)==null?void 0:q.call(g,...me)]})}})),ah({id:i},F)}});const Yg=$i({name:"VFieldLabel",props:{floating:Boolean},setup(e,l){let{slots:d}=l;return Ui(()=>ce(Zm,{class:["v-field-label",{"v-field-label--floating":e.floating}],"aria-hidden":e.floating||void 0},d)),{}}}),ib=mr({focused:Boolean},"focus");function nb(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pd();const d=ar(e,"focused"),g=He(()=>({[`${l}--focused`]:d.value}));function b(){d.value=!0}function E(){d.value=!1}return{focusClasses:g,isFocused:d,focus:b,blur:E}}const $z=["underlined","outlined","filled","solo","plain"],Uv=mr({appendInnerIcon:Yn,bgColor:String,clearable:Boolean,clearIcon:{type:Yn,default:"$clear"},active:Boolean,color:String,dirty:Boolean,disabled:Boolean,error:Boolean,label:String,persistentClear:Boolean,prependInnerIcon:Yn,reverse:Boolean,singleLine:Boolean,variant:{type:String,default:"filled",validator:e=>$z.includes(e)},"onClick:clear":n_,"onClick:appendInner":n_,"onClick:prependInner":n_,...Ur(),...H1()},"v-field"),A_=es()({name:"VField",inheritAttrs:!1,props:{id:String,...ib(),...Uv()},emits:{"click:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{attrs:d,emit:g,slots:b}=l;const{themeClasses:E}=To(e),{loaderClasses:P}=Bv(e),{focusClasses:i,isFocused:F,focus:j,blur:K}=nb(e),{InputIcon:Y}=CS(e),q=He(()=>e.dirty||e.active),re=He(()=>!e.singleLine&&!!(e.label||b.label)),me=Ya(),we=He(()=>e.id||`input-${me}`),je=oi(),$e=oi(),tt=oi(),{backgroundColorClasses:Ae,backgroundColorStyles:mt}=vs(ki(e,"bgColor")),{textColorClasses:Me,textColorStyles:Ye}=Zl(He(()=>q.value&&F.value&&!e.error&&!e.disabled?e.color:void 0));Mn(q,gt=>{if(re.value){const vt=je.value.$el,Ut=$e.value.$el,At=R1(vt),ti=Ut.getBoundingClientRect(),Nt=ti.x-At.x,Wt=ti.y-At.y-(At.height/2-ti.height/2),zt=ti.width/.75,Yt=Math.abs(zt-At.width)>1?{maxWidth:pn(zt)}:void 0,vi=getComputedStyle(vt),cn=getComputedStyle(Ut),di=parseFloat(vi.transitionDuration)*1e3||150,un=parseFloat(cn.getPropertyValue("--v-field-label-scale")),mn=cn.getPropertyValue("color");vt.style.visibility="visible",Ut.style.visibility="hidden",xp(vt,{transform:`translate(${Nt}px, ${Wt}px) scale(${un})`,color:mn,...Yt},{duration:di,easing:p_,direction:gt?"normal":"reverse"}).finished.then(()=>{vt.style.removeProperty("visibility"),Ut.style.removeProperty("visibility")})}},{flush:"post"});const Ze=He(()=>({isActive:q,isFocused:F,controlRef:tt,blur:K,focus:j}));function rt(gt){gt.target!==document.activeElement&&gt.preventDefault(),g("click:control",gt)}return Ui(()=>{var gt,vt,Ut;const At=e.variant==="outlined",ti=b["prepend-inner"]||e.prependInnerIcon,Nt=!!(e.clearable||b.clear),Wt=!!(b["append-inner"]||e.appendInnerIcon||Nt),zt=b.label?b.label({label:e.label,props:{for:we.value}}):e.label;return ce("div",zn({class:["v-field",{"v-field--active":q.value,"v-field--appended":Wt,"v-field--disabled":e.disabled,"v-field--dirty":e.dirty,"v-field--error":e.error,"v-field--has-background":!!e.bgColor,"v-field--persistent-clear":e.persistentClear,"v-field--prepended":ti,"v-field--reverse":e.reverse,"v-field--single-line":e.singleLine,"v-field--no-label":!zt,[`v-field--variant-${e.variant}`]:!0},E.value,Ae.value,i.value,P.value],style:[mt.value,Ye.value],onClick:rt},d),[ce("div",{class:"v-field__overlay"},null),ce(K1,{name:"v-field",active:e.loading,color:e.error?"error":e.color},{default:b.loader}),ti&&ce("div",{key:"prepend",class:"v-field__prepend-inner"},[e.prependInnerIcon&&ce(Y,{key:"prepend-icon",name:"prependInner"},null),(gt=b["prepend-inner"])==null?void 0:gt.call(b,Ze.value)]),ce("div",{class:"v-field__field","data-no-activator":""},[["solo","filled"].includes(e.variant)&&re.value&&ce(Yg,{key:"floating-label",ref:$e,class:[Me.value],floating:!0,for:we.value},{default:()=>[zt]}),ce(Yg,{ref:je,for:we.value},{default:()=>[zt]}),(vt=b.default)==null?void 0:vt.call(b,{...Ze.value,props:{id:we.value,class:"v-field__input"},focus:j,blur:K})]),Nt&&ce($1,{key:"clear"},{default:()=>[io(ce("div",{class:"v-field__clearable"},[b.clear?b.clear():ce(Y,{name:"clear"},null)]),[[na,e.dirty]])]}),Wt&&ce("div",{key:"append",class:"v-field__append-inner"},[(Ut=b["append-inner"])==null?void 0:Ut.call(b,Ze.value),e.appendInnerIcon&&ce(Y,{key:"append-icon",name:"appendInner"},null)]),ce("div",{class:["v-field__outline",Me.value]},[At&&ce(Tr,null,[ce("div",{class:"v-field__outline__start"},null),re.value&&ce("div",{class:"v-field__outline__notch"},[ce(Yg,{ref:$e,floating:!0,for:we.value},{default:()=>[zt]})]),ce("div",{class:"v-field__outline__end"},null)]),["plain","underlined"].includes(e.variant)&&re.value&&ce(Yg,{ref:$e,floating:!0,for:we.value},{default:()=>[zt]})])])}),{controlRef:tt}}});function rb(e){const l=Object.keys(A_.props).filter(d=>!DE(d));return nh(e,l)}const $v=$i({name:"VCounter",functional:!0,props:{active:Boolean,max:[Number,String],value:{type:[Number,String],default:0},...Tc({transition:{component:U1}})},setup(e,l){let{slots:d}=l;const g=He(()=>e.max?`${e.value} / ${e.max}`:String(e.value));return Ui(()=>ce(Bh,{transition:e.transition},{default:()=>[io(ce("div",{class:"v-counter"},[d.default?d.default({counter:g.value,max:e.max,value:e.value}):g.value]),[[na,e.active]])]})),{}}}),jz=["color","file","time","date","datetime-local","week","month"],jv=es()({name:"VTextField",directives:{Intersect:Dv},inheritAttrs:!1,props:{autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,hint:String,persistentHint:Boolean,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,suffix:String,type:{type:String,default:"text"},...Ld(),...Uv()},emits:{"click:control":e=>!0,"click:input":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{attrs:d,emit:g,slots:b}=l;const E=ar(e,"modelValue"),P=He(()=>{var Ae;return typeof e.counterValue=="function"?e.counterValue(E.value):((Ae=E.value)!=null?Ae:"").toString().length}),i=He(()=>{if(d.maxlength)return d.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function F(Ae,mt){var Me,Ye;!e.autofocus||!Ae||(Me=mt[0].target)==null||(Ye=Me.focus)==null||Ye.call(Me)}const j=oi(),K=oi(),Y=oi(!1),q=oi(),re=He(()=>jz.includes(e.type)||e.persistentPlaceholder||Y.value),me=He(()=>e.messages.length?e.messages:Y.value||e.persistentHint?e.hint:"");function we(){if(q.value!==document.activeElement){var Ae;(Ae=q.value)==null||Ae.focus()}Y.value||(Y.value=!0)}function je(Ae){we(),g("click:control",Ae)}function $e(Ae){Ae.stopPropagation(),we(),ys(()=>{E.value="",av(e["onClick:clear"],Ae)})}function tt(Ae){E.value=Ae.target.value}return Ui(()=>{const Ae=!!(b.counter||e.counter||e.counterValue),mt=!!(Ae||b.details),[Me,Ye]=Pp(d),[{modelValue:Ze,...rt}]=Lf(e),[gt]=rb(e);return ce(Fh,zn({ref:j,modelValue:E.value,"onUpdate:modelValue":vt=>E.value=vt,class:["v-text-field",{"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-text-field--flush-details":["plain","underlined"].includes(e.variant)}],"onClick:prepend":e["onClick:prepend"],"onClick:append":e["onClick:append"]},Me,rt,{messages:me.value}),{...b,default:vt=>{let{id:Ut,isDisabled:At,isDirty:ti,isReadonly:Nt,isValid:Wt}=vt;return ce(A_,zn({ref:K,onMousedown:zt=>{zt.target!==q.value&&zt.preventDefault()},"onClick:control":je,"onClick:clear":$e,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},gt,{id:Ut.value,active:re.value||ti.value,dirty:ti.value||e.dirty,focused:Y.value,error:Wt.value===!1}),{...b,default:zt=>{let{props:{class:Yt,...vi}}=zt;const cn=io(ce("input",zn({ref:q,value:E.value,onInput:tt,autofocus:e.autofocus,readonly:Nt.value,disabled:At.value,name:e.name,placeholder:e.placeholder,size:1,type:e.type,onFocus:we,onBlur:()=>Y.value=!1},vi,Ye),null),[[bc("intersect"),{handler:F},null,{once:!0}]]);return ce(Tr,null,[e.prefix&&ce("span",{class:"v-text-field__prefix"},[e.prefix]),b.default?ce("div",{class:Yt,onClick:di=>g("click:input",di),"data-no-activator":""},[b.default(),cn]):Id(cn,{class:Yt}),e.suffix&&ce("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:mt?vt=>{var Ut;return ce(Tr,null,[(Ut=b.details)==null?void 0:Ut.call(b,vt),Ae&&ce(Tr,null,[ce("span",null,null),ce($v,{active:e.persistentCounter||Y.value,value:P.value,max:i.value},b.counter)])])}:void 0})}),ah({},j,K,q)}}),ob=mr({chips:Boolean,closableChips:Boolean,eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,menu:Boolean,menuIcon:{type:Yn,default:"$dropdown"},menuProps:{type:Object},modelValue:{type:null,default:()=>[]},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,readonly:Boolean,...jS({itemChildren:!1})},"select"),Gz=es()({name:"VSelect",props:{...ob(),...Tc({transition:{component:Pv}})},emits:{"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,l){let{slots:d}=l;const{t:g}=rh(),b=oi(),E=ar(e,"menu"),{items:P,transformIn:i,transformOut:F}=eb(e),j=ar(e,"modelValue",[],je=>i(mu(je)),je=>{var tt;const $e=F(je);return e.multiple?$e:(tt=$e[0])!=null?tt:null}),K=He(()=>j.value.map(je=>P.value.find($e=>$e.value===je.value)||je)),Y=He(()=>K.value.map(je=>je.props.value));function q(je){j.value=[],e.openOnClear&&(E.value=!0)}function re(){e.hideNoData&&!P.value.length||e.readonly||(E.value=!E.value)}function me(je){e.readonly||(["Enter","ArrowDown"," "].includes(je.key)&&(E.value=!0),["Escape","Tab"].includes(je.key)&&(E.value=!1))}function we(je){if(e.multiple){const $e=Y.value.findIndex(tt=>tt===je.value);if($e===-1)j.value=[...j.value,je];else{const tt=[...j.value];tt.splice($e,1),j.value=tt}}else j.value=[je],E.value=!1}return Ui(()=>{const je=!!(e.chips||d.chip);return ce(jv,{ref:b,modelValue:j.value.map($e=>$e.props.value).join(", "),"onUpdate:modelValue":$e=>{$e==null&&(j.value=[])},validationValue:j.externalValue,dirty:j.value.length>0,class:["v-select",{"v-select--active-menu":E.value,"v-select--chips":!!e.chips,[`v-select--${e.multiple?"multiple":"single"}`]:!0,"v-select--selected":j.value.length}],appendInnerIcon:e.menuIcon,readonly:!0,"onClick:clear":q,"onClick:control":re,onBlur:()=>E.value=!1,onKeydown:me},{...d,default:()=>{var $e,tt,Ae;return ce(Tr,null,[ce(Nv,zn({modelValue:E.value,"onUpdate:modelValue":mt=>E.value=mt,activator:"parent",contentClass:"v-select__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition},e.menuProps),{default:()=>[ce(Ov,{selected:Y.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:mt=>mt.preventDefault()},{default:()=>{var mt;return[!P.value.length&&!e.hideNoData&&((mt=($e=d["no-data"])==null?void 0:$e.call(d))!=null?mt:ce(Md,{title:g(e.noDataText)},null)),(tt=d["prepend-item"])==null?void 0:tt.call(d),P.value.map((Me,Ye)=>{var rt;var Ze;return(rt=(Ze=d.item)==null?void 0:Ze.call(d,{item:Me,index:Ye,props:zn(Me.props,{onClick:()=>we(Me)})}))!=null?rt:ce(Md,zn({key:Ye},Me.props,{onClick:()=>we(Me)}),{prepend:gt=>{let{isSelected:vt}=gt;return e.multiple&&!e.hideSelected?ce(Wm,{modelValue:vt,ripple:!1},null):void 0}})}),(Ae=d["append-item"])==null?void 0:Ae.call(d)]}})]}),K.value.map((mt,Me)=>{function Ye(rt){rt.stopPropagation(),rt.preventDefault(),we(mt)}const Ze={"onClick:close":Ye,modelValue:!0,"onUpdate:modelValue":void 0};return ce("div",{key:mt.value,class:"v-select__selection"},[je?ce(Go,{defaults:{VChip:{closable:e.closableChips,size:"small",text:mt.title}}},{default:()=>[d.chip?d.chip({item:mt,index:Me,props:Ze}):ce(C_,Ze,null)]}):d.selection?d.selection({item:mt,index:Me}):ce("span",{class:"v-select__selection-text"},[mt.title,e.multiple&&Me<K.value.length-1&&ce("span",{class:"v-select__selection-comma"},[Yo(",")])])])})])}})}),ah({menu:E,select:we},b)}}),qz=(e,l,d)=>e==null||l==null?-1:e.toString().toLocaleLowerCase().indexOf(l.toString().toLocaleLowerCase()),JS=mr({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Zz(e,l,d){var F,j;const g=[],b=(F=d==null?void 0:d.default)!=null?F:qz,E=d!=null&&d.filterKeys?mu(d.filterKeys):!1,P=Object.keys((j=d==null?void 0:d.customKeyFilter)!=null?j:{}).length;if(!(e!=null&&e.length))return g;e:for(let K=0;K<e.length;K++){const Y=e[K],q={},re={};let me=-1;if(l&&!(d!=null&&d.noFilter)){if(typeof Y=="object"){const $e=E||Object.keys(Y);for(const tt of $e){var i;const Ae=Lh(Y,tt,Y),mt=d==null||(i=d.customKeyFilter)==null?void 0:i[tt];if(me=mt?mt(Ae,l,Y):b(Ae,l,Y),me!==-1&&me!==!1)mt?q[tt]=me:re[tt]=me;else if((d==null?void 0:d.filterMode)==="every")continue e}}else me=b(Y,l,Y),me!==-1&&me!==!1&&(re.title=me);const we=Object.keys(re).length,je=Object.keys(q).length;if(!we&&!je||(d==null?void 0:d.filterMode)==="union"&&je!==P&&!we||(d==null?void 0:d.filterMode)==="intersection"&&(je!==P||!we))continue}g.push({index:K,matches:{...re,...q}})}return g}function QS(e,l,d){const g=He(()=>typeof(d==null?void 0:d.value)!="string"&&typeof(d==null?void 0:d.value)!="number"?"":String(d.value));return{filteredItems:He(()=>{const E=If(l);return Zz(E,g.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).map(i=>{let{index:F,matches:j}=i;return{item:E[F],matches:j}})})}}function Wz(e,l,d){if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?ce(Tr,null,[ce("span",{class:"v-autocomplete__unmask"},[e.substr(0,l)]),ce("span",{class:"v-autocomplete__mask"},[e.substr(l,d)]),ce("span",{class:"v-autocomplete__unmask"},[e.substr(l+d)])]):e}const Xz=es()({name:"VAutocomplete",props:{search:String,...JS({filterKeys:["title"]}),...ob(),...Tc({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,l){let{slots:d}=l;const{t:g}=rh(),b=oi(),E=oi(!1),P=oi(!0),i=ar(e,"menu"),{items:F,transformIn:j,transformOut:K}=eb(e),Y=ar(e,"search",""),q=ar(e,"modelValue",[],Ze=>j(mu(Ze)),Ze=>{var gt;const rt=K(Ze);return e.multiple?rt:(gt=rt[0])!=null?gt:null}),{filteredItems:re}=QS(e,F,He(()=>P.value?void 0:Y.value)),me=He(()=>q.value.map(Ze=>F.value.find(rt=>rt.value===Ze.value)||Ze)),we=He(()=>me.value.map(Ze=>Ze.props.value));function je(Ze){q.value=[],e.openOnClear&&(i.value=!0),Y.value=""}function $e(){e.hideNoData&&!F.value.length||e.readonly||(i.value=!0)}function tt(Ze){e.readonly||(["Enter","ArrowDown"].includes(Ze.key)&&(i.value=!0),["Escape"].includes(Ze.key)&&(i.value=!1),["Enter","Escape","Tab"].includes(Ze.key)&&(P.value=!0))}function Ae(Ze){Y.value=Ze.target.value}function mt(){E.value&&(P.value=!0)}const Me=oi(!1);function Ye(Ze){if(e.multiple){const rt=we.value.findIndex(gt=>gt===Ze.value);if(rt===-1)q.value=[...q.value,Ze],Y.value="";else{const gt=[...q.value];gt.splice(rt,1),q.value=gt}}else q.value=[Ze],Me.value=!0,d.selection||(Y.value=Ze.title),i.value=!1,P.value=!0,ys(()=>Me.value=!1)}return Mn(E,Ze=>{var gt;if(Ze){var rt;Me.value=!0,Y.value=e.multiple||!!d.selection?"":String((gt=(rt=me.value.at(-1))==null?void 0:rt.props.title)!=null?gt:""),P.value=!0,ys(()=>Me.value=!1)}else i.value=!1,Y.value=""}),Mn(Y,Ze=>{!E.value||Me.value||(Ze&&(i.value=!0),P.value=!Ze)}),Ui(()=>{const Ze=!!(e.chips||d.chip);return ce(jv,{ref:b,modelValue:Y.value,"onUpdate:modelValue":rt=>{rt==null&&(q.value=[])},validationValue:q.externalValue,dirty:q.value.length>0,onInput:Ae,class:["v-autocomplete",{"v-autocomplete--active-menu":i.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!d.selection}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":je,"onClick:control":$e,"onClick:input":$e,onFocus:()=>E.value=!0,onBlur:()=>E.value=!1,onKeydown:tt},{...d,default:()=>{var rt,gt,vt;return ce(Tr,null,[ce(Nv,zn({modelValue:i.value,"onUpdate:modelValue":Ut=>i.value=Ut,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:mt},e.menuProps),{default:()=>[ce(Ov,{selected:we.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:Ut=>Ut.preventDefault()},{default:()=>{var Ut;return[!re.value.length&&!e.hideNoData&&((Ut=(rt=d["no-data"])==null?void 0:rt.call(d))!=null?Ut:ce(Md,{title:g(e.noDataText)},null)),(gt=d["prepend-item"])==null?void 0:gt.call(d),re.value.map((At,ti)=>{var Yt;var Nt;let{item:Wt,matches:zt}=At;return(Yt=(Nt=d.item)==null?void 0:Nt.call(d,{item:Wt,index:ti,props:zn(Wt.props,{onClick:()=>Ye(Wt)})}))!=null?Yt:ce(Md,zn({key:ti},Wt.props,{onClick:()=>Ye(Wt)}),{prepend:vi=>{let{isSelected:cn}=vi;return e.multiple&&!e.hideSelected?ce(Wm,{modelValue:cn,ripple:!1},null):void 0},title:()=>{var cn;var vi;return P.value?Wt.title:Wz(Wt.title,zt.title,(cn=(vi=Y.value)==null?void 0:vi.length)!=null?cn:0)}})}),(vt=d["append-item"])==null?void 0:vt.call(d)]}})]}),me.value.map((Ut,At)=>{function ti(Wt){Wt.stopPropagation(),Wt.preventDefault(),Ye(Ut)}const Nt={"onClick:close":ti,modelValue:!0,"onUpdate:modelValue":void 0};return ce("div",{key:Ut.value,class:"v-autocomplete__selection"},[Ze?ce(Go,{defaults:{VChip:{closable:e.closableChips,size:"small",text:Ut.title}}},{default:()=>[d.chip?d.chip({item:Ut,index:At,props:Nt}):ce(C_,Nt,null)]}):d.selection?d.selection({item:Ut,index:At}):ce("span",{class:"v-autocomplete__selection-text"},[Ut.title,e.multiple&&At<me.value.length-1&&ce("span",{class:"v-autocomplete__selection-comma"},[Yo(",")])])])})])}})}),ah({isFocused:E,isPristine:P,menu:i,search:Y,filteredItems:re,select:Ye},b)}});const Hz=$i({name:"VBadge",inheritAttrs:!1,props:{bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:Yn,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...Op({location:"top end"}),...ts(),...lr(),...Ur(),...Tc({transition:"scale-rotate-transition"})},setup(e,l){const{backgroundColorClasses:d,backgroundColorStyles:g}=vs(ki(e,"color")),{roundedClasses:b}=xs(e),{t:E}=rh(),{textColorClasses:P,textColorStyles:i}=Zl(ki(e,"textColor")),{themeClasses:F}=JE(),{locationStyles:j}=Fp(e,!0,K=>{var q,re;return(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(K)?+((q=e.offsetY)!=null?q:0):["left","right"].includes(K)?+((re=e.offsetX)!=null?re:0):0)});return Ui(()=>{var K,Y,q,re;const me=Number(e.content),we=!e.max||isNaN(me)?e.content:me<=e.max?me:`${e.max}+`,[je,$e]=nh(l.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return ce(e.tag,zn({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline}]},$e),{default:()=>[ce("div",{class:"v-badge__wrapper"},[(K=(Y=l.slots).default)==null?void 0:K.call(Y),ce(Bh,{transition:e.transition},{default:()=>[io(ce("span",zn({class:["v-badge__badge",F.value,d.value,b.value,P.value],style:[g.value,i.value,e.inline?{}:j.value],"aria-atomic":"true","aria-label":E(e.label,me),"aria-live":"polite",role:"status"},je),[e.dot?void 0:l.slots.badge?(q=(re=l.slots).badge)==null?void 0:q.call(re):e.icon?ce(As,{icon:e.icon},null):we]),[[na,e.modelValue]])]})])]})}),{}}});const eC=$i({name:"VBannerActions",props:{color:String,density:String},setup(e,l){let{slots:d}=l;return Vs({VBtn:{color:e.color,density:e.density,variant:"text"}}),Ui(()=>{var g;return ce("div",{class:"v-banner-actions"},[(g=d.default)==null?void 0:g.call(d)])}),{}}}),tC=yu("v-banner-text"),Xx=Symbol.for("vuetify:display"),$2={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},Kz=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$2;return Ad($2,e)};function j2(e){return Jo&&!e?window.innerWidth:0}function G2(e){return Jo&&!e?window.innerHeight:0}function Yz(){const e=Jo?window.navigator.userAgent:"ssr";function l(me){return Boolean(e.match(me))}const d=l(/android/i),g=l(/iphone|ipad|ipod/i),b=l(/cordova/i),E=l(/electron/i),P=l(/chrome/i),i=l(/edge/i),F=l(/firefox/i),j=l(/opera/i),K=l(/win/i),Y=l(/mac/i),q=l(/linux/i),re=l(/ssr/i);return{android:d,ios:g,cordova:b,electron:E,chrome:P,edge:i,firefox:F,opera:j,win:K,mac:Y,linux:q,touch:lP,ssr:re}}function Jz(e,l){const{thresholds:d,mobileBreakpoint:g}=Kz(e),b=oi(G2(l)),E=Yz(),P=wl({}),i=oi(j2(l));function F(){b.value=G2(),i.value=j2()}return Oh(()=>{const j=i.value<d.sm,K=i.value<d.md&&!j,Y=i.value<d.lg&&!(K||j),q=i.value<d.xl&&!(Y||K||j),re=i.value<d.xxl&&!(q||Y||K||j),me=i.value>=d.xxl,we=j?"xs":K?"sm":Y?"md":q?"lg":re?"xl":"xxl",je=typeof g=="number"?g:d[g],$e=E.ssr?E.android||E.ios||E.opera:i.value<je;P.xs=j,P.sm=K,P.md=Y,P.lg=q,P.xl=re,P.xxl=me,P.smAndUp=!j,P.mdAndUp=!(j||K),P.lgAndUp=!(j||K||Y),P.xlAndUp=!(j||K||Y||q),P.smAndDown=!(Y||q||re||me),P.mdAndDown=!(q||re||me),P.lgAndDown=!(re||me),P.xlAndDown=!me,P.name=we,P.height=b.value,P.width=i.value,P.mobile=$e,P.mobileBreakpoint=g,P.platform=E,P.thresholds=d}),Jo&&window.addEventListener("resize",F,{passive:!0}),{...x1(P),update:F}}function Gv(){const e=co(Xx);if(!e)throw new Error("Could not find Vuetify display injection");return e}const Qz=$i({name:"VBanner",props:{avatar:String,color:String,icon:Yn,lines:String,stacked:Boolean,sticky:Boolean,text:String,...Ec(),...oa(),...oh(),...Ns(),...Op(),...jm(),...ts(),...lr(),...Ur()},setup(e,l){let{slots:d}=l;const{borderClasses:g}=vu(e),{densityClasses:b}=Ja(e),{mobile:E}=Gv(),{dimensionStyles:P}=sh(e),{elevationClasses:i}=Da(e),{locationStyles:F}=Fp(e),{positionClasses:j}=Gm(e),{roundedClasses:K}=xs(e),{themeClasses:Y}=To(e),q=ki(e,"color"),re=ki(e,"density");Vs({VBannerActions:{color:q,density:re}}),Ui(()=>{var me;const we=!!(e.text||d.text),je=!!(d.prepend||e.avatar||e.icon);return ce(e.tag,{class:["v-banner",{"v-banner--stacked":e.stacked||E.value,"v-banner--sticky":e.sticky,[`v-banner--${e.lines}-line`]:!!e.lines},g.value,b.value,i.value,j.value,K.value,Y.value],style:[P.value,F.value],role:"banner"},{default:()=>[je&&ce(Go,{key:"prepend",defaults:{VAvatar:{color:q.value,density:re.value,icon:e.icon,image:e.avatar}}},{default:()=>[ce("div",{class:"v-banner__prepend"},[d.prepend?d.prepend():(e.avatar||e.icon)&&ce(Mf,null,null)])]}),ce("div",{class:"v-banner__content"},[we&&ce(tC,{key:"text"},{default:()=>[d.text?d.text():e.text]}),(me=d.default)==null?void 0:me.call(d)]),d.actions&&ce(eC,null,{default:()=>[d.actions()]})]})})}});const e3=$i({name:"VBottomNavigation",props:{bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:e=>!e||["horizontal","shift"].includes(e)},height:{type:[Number,String],default:56},...Ec(),...oa(),...Ns(),...ts(),...Om({name:"bottom-navigation"}),...lr({tag:"header"}),...Nm({modelValue:!0,selectedClass:"v-btn--selected"}),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{themeClasses:g}=JE(),{borderClasses:b}=vu(e),{backgroundColorClasses:E,backgroundColorStyles:P}=vs(ki(e,"bgColor")),{densityClasses:i}=Ja(e),{elevationClasses:F}=Da(e),{roundedClasses:j}=xs(e),K=He(()=>Number(e.height)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0)),Y=ar(e,"modelValue",e.modelValue),{layoutItemStyles:q}=Fm({id:e.name,order:He(()=>parseInt(e.order,10)),position:He(()=>"bottom"),layoutSize:He(()=>Y.value?K.value:0),elementSize:K,active:Y,absolute:ki(e,"absolute")});return Bp(e,G1),Vs({VBtn:{color:ki(e,"color"),density:ki(e,"density"),stacked:He(()=>e.mode!=="horizontal"),variant:"text"}},{scoped:!0}),Ui(()=>ce(e.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":Y.value,"v-bottom-navigation--grow":e.grow,"v-bottom-navigation--shift":e.mode==="shift"},g.value,E.value,b.value,i.value,F.value,j.value],style:[P.value,q.value,{height:pn(K.value),transform:`translateY(${pn(Y.value?0:100,"%")})`}]},{default:()=>[d.default&&ce("div",{class:"v-bottom-navigation__content"},[d.default()])]})),{}}});const iC=yu("v-breadcrumbs-divider","li"),nC=$i({name:"VBreadcrumbsItem",props:{active:Boolean,activeClass:String,activeColor:String,color:String,disabled:Boolean,title:String,...qm(),...lr({tag:"li"})},setup(e,l){let{slots:d,attrs:g}=l;const b=E_(e,g),E=He(()=>{var j;return e.active||((j=b.isActive)==null?void 0:j.value)}),P=He(()=>E.value?e.activeColor:e.color),{textColorClasses:i,textColorStyles:F}=Zl(P);return Ui(()=>{var j;const K=b.isLink.value?"a":e.tag;return ce(K,{class:["v-breadcrumbs-item",{"v-breadcrumbs-item--active":E.value,"v-breadcrumbs-item--disabled":e.disabled,"v-breadcrumbs-item--link":b.isLink.value,[`${e.activeClass}`]:E.value&&e.activeClass},i.value],style:[F.value],href:b.href.value,"aria-current":E.value?"page":void 0,onClick:b.navigate},{default:()=>{var Y;return[(Y=(j=d.default)==null?void 0:j.call(d))!=null?Y:e.title]}})}),{}}}),t3=es()({name:"VBreadcrumbs",props:{activeClass:String,activeColor:String,bgColor:String,color:String,disabled:Boolean,divider:{type:String,default:"/"},icon:Yn,items:{type:Array,default:()=>[]},...oa(),...ts(),...lr({tag:"ul"})},setup(e,l){let{slots:d}=l;const{backgroundColorClasses:g,backgroundColorStyles:b}=vs(ki(e,"bgColor")),{densityClasses:E}=Ja(e),{roundedClasses:P}=xs(e);return Vs({VBreadcrumbsItem:{activeClass:ki(e,"activeClass"),activeColor:ki(e,"activeColor"),color:ki(e,"color"),disabled:ki(e,"disabled")}}),Ui(()=>{var i;const F=!!(d.prepend||e.icon);return ce(e.tag,{class:["v-breadcrumbs",g.value,E.value,P.value],style:b.value},{default:()=>[F&&ce(Go,{key:"prepend",defaults:{VIcon:{icon:e.icon,start:!0}}},{default:()=>[ce("div",{class:"v-breadcrumbs__prepend"},[d.prepend?d.prepend():e.icon&&ce(As,null,null)])]}),e.items.map((j,K,Y)=>{var q;return ce(Tr,null,[ce(nC,zn({key:K,disabled:K>=Y.length-1},typeof j=="string"?{title:j}:j),{default:d.title?()=>{var re;return(re=d.title)==null?void 0:re.call(d,{item:j,index:K})}:void 0}),K<Y.length-1&&ce(iC,null,{default:()=>{var re;return[(re=(q=d.divider)==null?void 0:q.call(d,{item:j,index:K}))!=null?re:e.divider]}})])}),(i=d.default)==null?void 0:i.call(d)]})}),{}}});const rC=$i({name:"VCardActions",setup(e,l){let{slots:d}=l;return Vs({VBtn:{variant:"text"}}),Ui(()=>{var g;return ce("div",{class:"v-card-actions"},[(g=d.default)==null?void 0:g.call(d)])}),{}}}),oC=yu("v-card-subtitle"),sC=yu("v-card-title"),aC=S1({name:"VCardItem",props:{appendAvatar:String,appendIcon:Yn,prependAvatar:String,prependIcon:Yn,subtitle:String,title:String,...oa()},setup(e,l){let{slots:d}=l;return Ui(()=>{var g,b,E,P,i;const F=!!(e.prependAvatar||e.prependIcon||d.prepend),j=!!(e.appendAvatar||e.appendIcon||d.append),K=!!(e.title||d.title),Y=!!(e.subtitle||d.subtitle);return ce("div",{class:"v-card-item"},[F&&ce(Go,{key:"prepend",defaults:{VAvatar:{density:e.density,icon:e.prependIcon,image:e.prependAvatar},VIcon:{density:e.density,icon:e.prependIcon}}},{default:()=>{var q;return[ce("div",{class:"v-card-item__prepend"},[(q=(g=d.prepend)==null?void 0:g.call(d))!=null?q:ce(Mf,null,null)])]}}),ce("div",{class:"v-card-item__content"},[K&&ce(sC,{key:"title"},{default:()=>{var q;return[(q=(b=d.title)==null?void 0:b.call(d))!=null?q:e.title]}}),Y&&ce(oC,{key:"subtitle"},{default:()=>{var q;return[(q=(E=d.subtitle)==null?void 0:E.call(d))!=null?q:e.subtitle]}}),(P=d.default)==null?void 0:P.call(d)]),j&&ce(Go,{key:"append",defaults:{VAvatar:{density:e.density,icon:e.appendIcon,image:e.appendAvatar},VIcon:{density:e.density,icon:e.appendIcon}}},{default:()=>{var q;return[ce("div",{class:"v-card-item__append"},[(q=(i=d.append)==null?void 0:i.call(d))!=null?q:ce(Mf,null,null)])]}})])}),{}}}),lC=yu("v-card-text"),i3=$i({name:"VCard",directives:{Ripple:Rp},props:{appendAvatar:String,appendIcon:Yn,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:Yn,ripple:Boolean,subtitle:String,text:String,title:String,...Ur(),...Ec(),...oa(),...oh(),...Ns(),...H1(),...Op(),...jm(),...ts(),...qm(),...lr(),...xu({variant:"elevated"})},setup(e,l){let{attrs:d,slots:g}=l;const{themeClasses:b}=To(e),{borderClasses:E}=vu(e),{colorClasses:P,colorStyles:i,variantClasses:F}=Dp(e),{densityClasses:j}=Ja(e),{dimensionStyles:K}=sh(e),{elevationClasses:Y}=Da(e),{loaderClasses:q}=Bv(e),{locationStyles:re}=Fp(e),{positionClasses:me}=Gm(e),{roundedClasses:we}=xs(e),je=E_(e,d),$e=He(()=>e.link!==!1&&je.isLink.value),tt=He(()=>!e.disabled&&e.link!==!1&&(e.link||je.isClickable.value));return Ui(()=>{var Ae,mt,Me;const Ye=$e.value?"a":e.tag,Ze=!!(g.title||e.title),rt=!!(g.subtitle||e.subtitle),gt=Ze||rt,vt=!!(g.append||e.appendAvatar||e.appendIcon),Ut=!!(g.prepend||e.prependAvatar||e.prependIcon),At=!!(g.image||e.image),ti=gt||Ut||vt,Nt=!!(g.text||e.text);return io(ce(Ye,{class:["v-card",{"v-card--disabled":e.disabled,"v-card--flat":e.flat,"v-card--hover":e.hover&&!(e.disabled||e.flat),"v-card--link":tt.value},b.value,E.value,P.value,j.value,Y.value,q.value,me.value,we.value,F.value],style:[i.value,K.value,re.value],href:je.href.value,onClick:tt.value&&je.navigate},{default:()=>[At&&ce(Go,{key:"image",defaults:{VImg:{cover:!0,src:e.image}}},{default:()=>{var Wt;return[ce("div",{class:"v-card__image"},[(Wt=(Ae=g.image)==null?void 0:Ae.call(g))!=null?Wt:ce(Vm,null,null)])]}}),ce(K1,{name:"v-card",active:!!e.loading,color:typeof e.loading=="boolean"?void 0:e.loading},{default:g.loader}),ti&&ce(aC,{key:"item",prependAvatar:e.prependAvatar,prependIcon:e.prependIcon,title:e.title,subtitle:e.subtitle,appendAvatar:e.appendAvatar,appendIcon:e.appendIcon},{default:g.item,prepend:g.prepend,title:g.title,subtitle:g.subtitle,append:g.append}),Nt&&ce(lC,{key:"text"},{default:()=>{var Wt;return[(Wt=(mt=g.text)==null?void 0:mt.call(g))!=null?Wt:e.text]}}),(Me=g.default)==null?void 0:Me.call(g),g.actions&&ce(rC,null,{default:g.actions}),zp(tt.value,"v-card")]}),[[bc("ripple"),tt.value]])}),{}}});const n3=e=>{const{touchstartX:l,touchendX:d,touchstartY:g,touchendY:b}=e,E=.5,P=16;e.offsetX=d-l,e.offsetY=b-g,Math.abs(e.offsetY)<E*Math.abs(e.offsetX)&&(e.left&&d<l-P&&e.left(e),e.right&&d>l+P&&e.right(e)),Math.abs(e.offsetX)<E*Math.abs(e.offsetY)&&(e.up&&b<g-P&&e.up(e),e.down&&b>g+P&&e.down(e))};function r3(e,l){var d;const g=e.changedTouches[0];l.touchstartX=g.clientX,l.touchstartY=g.clientY,(d=l.start)==null||d.call(l,{originalEvent:e,...l})}function o3(e,l){var d;const g=e.changedTouches[0];l.touchendX=g.clientX,l.touchendY=g.clientY,(d=l.end)==null||d.call(l,{originalEvent:e,...l}),n3(l)}function s3(e,l){var d;const g=e.changedTouches[0];l.touchmoveX=g.clientX,l.touchmoveY=g.clientY,(d=l.move)==null||d.call(l,{originalEvent:e,...l})}function a3(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:d=>r3(d,l),touchend:d=>o3(d,l),touchmove:d=>s3(d,l)}}function l3(e,l){var F,j;var d;const g=l.value,b=g!=null&&g.parent?e.parentElement:e,E=(F=g==null?void 0:g.options)!=null?F:{passive:!0},P=(d=l.instance)==null?void 0:d.$.uid;if(!b||!P)return;const i=a3(l.value);b._touchHandlers=(j=b._touchHandlers)!=null?j:Object.create(null),b._touchHandlers[P]=i,PE(i).forEach(K=>{b.addEventListener(K,i[K],E)})}function c3(e,l){var d,g;const b=(d=l.value)!=null&&d.parent?e.parentElement:e,E=(g=l.instance)==null?void 0:g.$.uid;if(!(b!=null&&b._touchHandlers)||!E)return;const P=b._touchHandlers[E];PE(P).forEach(i=>{b.removeEventListener(i,P[i])}),delete b._touchHandlers[E]}const cC={mounted:l3,unmounted:c3},u3=cC,uC=Symbol.for("vuetify:v-window"),hC=Symbol.for("vuetify:v-window-group"),dC=es()({name:"VWindow",directives:{Touch:cC},props:{continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{default:"force"},...lr(),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{isRtl:b}=zd(),{t:E}=rh(),P=Bp(e,hC),i=oi(),F=He(()=>b.value?!e.reverse:e.reverse),j=oi(!1),K=He(()=>{const mt=e.direction==="vertical"?"y":"x",Ye=(F.value?!j.value:j.value)?"-reverse":"";return`v-window-${mt}${Ye}-transition`}),Y=oi(0),q=oi(void 0),re=He(()=>P.items.value.findIndex(mt=>P.selected.value.includes(mt.id)));Mn(re,(mt,Me)=>{const Ye=P.items.value.length,Ze=Ye-1;Ye<=2?j.value=mt<Me:mt===Ze&&Me===0?j.value=!0:mt===0&&Me===Ze?j.value=!1:j.value=mt<Me}),ra(uC,{transition:K,isReversed:j,transitionCount:Y,transitionHeight:q,rootRef:i});const me=He(()=>e.continuous||re.value!==0),we=He(()=>e.continuous||re.value!==P.items.value.length-1);function je(){me.value&&P.prev()}function $e(){we.value&&P.next()}const tt=He(()=>{const mt=[],Me={icon:b.value?e.nextIcon:e.prevIcon,class:`v-window__${F.value?"right":"left"}`,onClick:P.prev,ariaLabel:E("$vuetify.carousel.prev")};mt.push(me.value?d.prev?d.prev({props:Me}):ce(ql,Me,null):ce("div",null,null));const Ye={icon:b.value?e.prevIcon:e.nextIcon,class:`v-window__${F.value?"left":"right"}`,onClick:P.next,ariaLabel:E("$vuetify.carousel.next")};return mt.push(we.value?d.next?d.next({props:Ye}):ce(ql,Ye,null):ce("div",null,null)),mt}),Ae=He(()=>e.touch===!1?e.touch:{...{left:()=>{F.value?je():$e()},right:()=>{F.value?$e():je()},start:Me=>{let{originalEvent:Ye}=Me;Ye.stopPropagation()}},...e.touch===!0?{}:e.touch});return Ui(()=>{var mt,Me;return io(ce(e.tag,{ref:i,class:["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover"},g.value]},{default:()=>[ce("div",{class:"v-window__container",style:{height:q.value}},[(mt=d.default)==null?void 0:mt.call(d,{group:P}),e.showArrows!==!1&&ce("div",{class:"v-window__controls"},[tt.value])]),(Me=d.additional)==null?void 0:Me.call(d,{group:P})]}),[[bc("touch"),Ae.value]])}),{group:P}}});function sb(){const e=oi(!1);return Wl(()=>{window.requestAnimationFrame(()=>{e.value=!0})}),{ssrBootStyles:He(()=>e.value?void 0:{transition:"none !important"}),isBooted:w_(e)}}const fC=$i({name:"VWindowItem",directives:{Touch:u3},props:{reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Lp(),...Fv()},emits:{"group:selected":e=>!0},setup(e,l){let{slots:d}=l;const g=co(uC),b=Um(e,hC),{isBooted:E}=sb();if(!g||!b)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const P=oi(!1),i=He(()=>g.isReversed.value?e.reverseTransition!==!1:e.transition!==!1);function F(){!P.value||!g||(P.value=!1,g.transitionCount.value>0&&(g.transitionCount.value-=1,g.transitionCount.value===0&&(g.transitionHeight.value=void 0)))}function j(){if(!(P.value||!g)){if(P.value=!0,g.transitionCount.value===0){var me;g.transitionHeight.value=pn((me=g.rootRef.value)==null?void 0:me.clientHeight)}g.transitionCount.value+=1}}function K(){F()}function Y(me){!P.value||ys(()=>{!i.value||!P.value||!g||(g.transitionHeight.value=pn(me.clientHeight))})}const q=He(()=>{const me=g.isReversed.value?e.reverseTransition:e.transition;return i.value?{name:typeof me!="string"?g.transition.value:me,onBeforeEnter:j,onAfterEnter:F,onEnterCancelled:K,onBeforeLeave:j,onAfterLeave:F,onLeaveCancelled:K,onEnter:Y}:!1}),{hasContent:re}=tb(e,b.isSelected);return Ui(()=>{var me;return ce(Bh,{transition:E.value&&q.value},{default:()=>[io(ce("div",{class:["v-window-item",b.selectedClass.value]},[re.value&&((me=d.default)==null?void 0:me.call(d))]),[[na,b.isSelected.value]])]})}),{}}}),h3=$i({name:"VCarousel",props:{color:String,cycle:Boolean,delimiterIcon:{type:Yn,default:"$delimiter"},height:{type:[Number,String],default:500},hideDelimiters:Boolean,hideDelimiterBackground:Boolean,interval:{type:[Number,String],default:6e3,validator:e=>e>0},modelValue:null,progress:[Boolean,String],showArrows:{type:[Boolean,String],default:!0,validator:e=>typeof e=="boolean"||e==="hover"},verticalDelimiters:[Boolean,String]},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),{t:b}=rh(),E=oi();let P=-1;Mn(g,F),Mn(()=>e.interval,F),Mn(()=>e.cycle,j=>{j?F():window.clearTimeout(P)}),Wl(i);function i(){!e.cycle||!E.value||(P=window.setTimeout(E.value.group.next,+e.interval>0?+e.interval:6e3))}function F(){window.clearTimeout(P),window.requestAnimationFrame(i)}return Ui(()=>ce(dC,{ref:E,modelValue:g.value,"onUpdate:modelValue":j=>g.value=j,class:["v-carousel",{"v-carousel--hide-delimiter-background":e.hideDelimiterBackground,"v-carousel--vertical-delimiters":e.verticalDelimiters}],style:{height:pn(e.height)},continuous:!0,mandatory:"force",showArrows:e.showArrows},{default:d.default,additional:j=>{let{group:K}=j;return ce(Tr,null,[!e.hideDelimiters&&ce("div",{class:"v-carousel__controls",style:{left:e.verticalDelimiters==="left"&&e.verticalDelimiters?0:"auto",right:e.verticalDelimiters==="right"?0:"auto"}},[K.items.value.length>0&&ce(Go,{defaults:{VBtn:{color:e.color,icon:e.delimiterIcon,size:"x-small",variant:"text"}},scoped:!0},{default:()=>[K.items.value.map((Y,q)=>{const re={"aria-label":b("$vuetify.carousel.ariaLabel.delimiter",q+1,K.items.value.length),class:[K.isSelected(Y.id)&&"v-btn--active"],onClick:()=>K.select(Y.id,!0)};return d.item?d.item({props:re,item:Y}):ce(ql,zn(Y,re),null)})]})]),e.progress&&ce(X1,{class:"v-carousel__progress",color:typeof e.progress=="string"?e.progress:void 0,modelValue:(K.getItemIndex(g.value)+1)/K.items.value.length*100},null)])},prev:d.prev,next:d.next})),{}}}),d3=$i({name:"VCarouselItem",inheritAttrs:!1,props:{value:null},setup(e,l){let{slots:d,attrs:g}=l;Ui(()=>ce(fC,{class:"v-carousel-item",value:e.value},{default:()=>[ce(Vm,g,d)]}))}});const f3=yu("v-code");const p3=$i({name:"VColorPickerCanvas",props:{color:{type:Object},disabled:Boolean,dotSize:{type:[Number,String],default:10},height:{type:[Number,String],default:150},width:{type:[Number,String],default:300}},emits:{"update:color":e=>!0,"update:position":e=>!0},setup(e,l){let{emit:d}=l;const g=oi(!1),b=oi(!1),E=oi({x:0,y:0}),P=He(()=>{const{x:me,y:we}=E.value,je=parseInt(e.dotSize,10)/2;return{width:pn(e.dotSize),height:pn(e.dotSize),transform:`translate(${pn(me-je)}, ${pn(we-je)})`}}),i=oi();function F(me,we,je){const{left:$e,top:tt,width:Ae,height:mt}=je;E.value={x:du(me-$e,0,Ae),y:du(we-tt,0,mt)}}function j(me){e.disabled||!i.value||F(me.clientX,me.clientY,i.value.getBoundingClientRect())}function K(me){me.preventDefault(),!e.disabled&&(g.value=!0,window.addEventListener("mousemove",Y),window.addEventListener("mouseup",q),window.addEventListener("touchmove",Y),window.addEventListener("touchend",q))}function Y(me){if(e.disabled||!i.value)return;g.value=!0;const we=gP(me);F(we.clientX,we.clientY,i.value.getBoundingClientRect())}function q(){window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",q),window.removeEventListener("touchmove",Y),window.removeEventListener("touchend",q)}Mn(E,()=>{var mt,Me;var me,we;if(b.value){b.value=!1;return}if(!i.value)return;const{width:je,height:$e}=i.value.getBoundingClientRect(),{x:tt,y:Ae}=E.value;d("update:color",{h:(mt=(me=e.color)==null?void 0:me.h)!=null?mt:0,s:du(tt,0,je)/je,v:1-du(Ae,0,$e)/$e,a:(Me=(we=e.color)==null?void 0:we.a)!=null?Me:1})});function re(){var Ae;var me;if(!i.value)return;const we=i.value,je=we.getContext("2d");if(!je)return;const $e=je.createLinearGradient(0,0,we.width,0);$e.addColorStop(0,"hsla(0, 0%, 100%, 1)"),$e.addColorStop(1,`hsla(${(Ae=(me=e.color)==null?void 0:me.h)!=null?Ae:0}, 100%, 50%, 1)`),je.fillStyle=$e,je.fillRect(0,0,we.width,we.height);const tt=je.createLinearGradient(0,0,0,we.height);tt.addColorStop(0,"hsla(0, 0%, 100%, 0)"),tt.addColorStop(1,"hsla(0, 0%, 0%, 1)"),je.fillStyle=tt,je.fillRect(0,0,we.width,we.height)}return Mn(()=>{var me;return(me=e.color)==null?void 0:me.h},re,{immediate:!0}),Mn(()=>e.color,()=>{if(g.value){g.value=!1;return}!e.color||(b.value=!0,E.value={x:e.color.s*parseInt(e.width,10),y:(1-e.color.v)*parseInt(e.height,10)})},{deep:!0,immediate:!0}),Wl(()=>re()),Ui(()=>ce("div",{class:"v-color-picker-canvas",style:{width:pn(e.width),height:pn(e.height)},onClick:j,onMousedown:K,onTouchstart:K},[ce("canvas",{ref:i,width:e.width,height:e.height},null),ce("div",{class:["v-color-picker-canvas__dot",{"v-color-picker-canvas__dot--disabled":e.disabled}],style:P.value},null)])),{}}});var q2;function bp(e,l){return l.every(d=>e.hasOwnProperty(d))}function pC(e){var d;if(!e)return null;let l=null;if(typeof e=="string"){const g=zP(e);l=$E(g)}return typeof e=="object"&&(bp(e,["r","g","b"])?l=F1(e):bp(e,["h","s","l"])?l=NE(e):bp(e,["h","s","v"])&&(l=e)),l!=null?{...l,a:(d=l.a)!=null?d:1}:null}function m3(e,l){if(l){const{a:d,...g}=e;return g}return e}function g3(e,l){if(l==null||typeof l=="string"){const d=jE(e);return e.a===1?d.slice(0,7):d}if(typeof l=="object"){let d;return bp(l,["r","g","b"])?d=kv(e):bp(l,["h","s","l"])?d=VE(e):bp(l,["h","s","v"])&&(d=e),m3(d,!bp(l,["a"]))}return e}const Xy={h:0,s:0,v:1,a:1},Hx={inputProps:{type:"number",min:0},inputs:[{label:"R",max:255,step:1,getValue:e=>Math.round(e.r),getColor:(e,l)=>({...e,r:Number(l)})},{label:"G",max:255,step:1,getValue:e=>Math.round(e.g),getColor:(e,l)=>({...e,g:Number(l)})},{label:"B",max:255,step:1,getValue:e=>Math.round(e.b),getColor:(e,l)=>({...e,b:Number(l)})},{label:"A",max:1,step:.01,getValue:e=>Math.round(e.a*100)/100,getColor:(e,l)=>({...e,a:Number(l)})}],to:kv,from:F1},_3={...Hx,inputs:(q2=Hx.inputs)==null?void 0:q2.slice(0,3)},Kx={inputProps:{type:"number",min:0},inputs:[{label:"H",max:360,step:1,getValue:e=>Math.round(e.h),getColor:(e,l)=>({...e,h:Number(l)})},{label:"S",max:1,step:.01,getValue:e=>Math.round(e.s*100)/100,getColor:(e,l)=>({...e,s:Number(l)})},{label:"L",max:1,step:.01,getValue:e=>Math.round(e.l*100)/100,getColor:(e,l)=>({...e,l:Number(l)})},{label:"A",max:1,step:.01,getValue:e=>Math.round(e.a*100)/100,getColor:(e,l)=>({...e,a:Number(l)})}],to:VE,from:NE},y3={...Kx,inputs:Kx.inputs.slice(0,3)},mC={inputProps:{type:"text"},inputs:[{label:"HEXA",getValue:e=>e,getColor:(e,l)=>l}],to:jE,from:$E},v3={...mC,inputs:[{label:"HEX",getValue:e=>e.slice(0,7),getColor:(e,l)=>l}]},wp={rgb:_3,rgba:Hx,hsl:y3,hsla:Kx,hex:v3,hexa:mC},x3=e=>{let{label:l,...d}=e;return ce("div",{class:"v-color-picker-edit__input"},[ce("input",d,null),ce("span",null,[l])])},b3=$i({name:"VColorPickerEdit",props:{color:Object,disabled:Boolean,mode:{type:String,default:"rgba",validator:e=>Object.keys(wp).includes(e)},modes:{type:Array,default:()=>Object.keys(wp),validator:e=>Array.isArray(e)&&e.every(l=>Object.keys(wp).includes(l))}},emits:{"update:color":e=>!0,"update:mode":e=>!0},setup(e,l){let{emit:d}=l;const g=He(()=>e.modes.map(E=>({...wp[E],name:E}))),b=He(()=>{var E;const P=g.value.find(F=>F.name===e.mode);if(!P)return[];const i=e.color?P.to(e.color):{};return(E=P.inputs)==null?void 0:E.map(F=>{let{getValue:j,getColor:K,...Y}=F;return{...P.inputProps,...Y,disabled:e.disabled,value:j(i),onChange:q=>{const re=q.target;!re||d("update:color",P.from(K(i,re.value)))}}})});return Ui(()=>{var E;return ce("div",{class:"v-color-picker-edit"},[(E=b.value)==null?void 0:E.map(P=>ce(x3,P,null)),g.value.length>1&&ce(ql,{icon:"$unfold",size:"x-small",variant:"plain",onClick:()=>{const P=g.value.findIndex(i=>i.name===e.mode);d("update:mode",g.value[(P+1)%g.value.length].name)}},null)])}),{}}});const ab=Symbol.for("vuetify:v-slider");function Yx(e,l,d){const g=d==="vertical",b=l.getBoundingClientRect(),E="touches"in e?e.touches[0]:e;return g?E.clientY-(b.top+b.height/2):E.clientX-(b.left+b.width/2)}function w3(e,l){return"touches"in e&&e.touches.length?e.touches[0][l]:"changedTouches"in e&&e.changedTouches.length?e.changedTouches[0][l]:e[l]}const gC=mr({disabled:Boolean,error:Boolean,readonly:Boolean,max:{type:[Number,String],default:100},min:{type:[Number,String],default:0},step:{type:[Number,String],default:0},thumbColor:String,thumbLabel:{type:[Boolean,String],default:void 0,validator:e=>typeof e=="boolean"||e==="always"},thumbSize:{type:[Number,String],default:20},showTicks:{type:[Boolean,String],default:!1,validator:e=>typeof e=="boolean"||e==="always"},ticks:{type:[Array,Object]},tickSize:{type:[Number,String],default:2},color:String,trackColor:String,trackFillColor:String,trackSize:{type:[Number,String],default:4},direction:{type:String,default:"horizontal",validator:e=>["vertical","horizontal"].includes(e)},reverse:Boolean,...ts(),...Ns({elevation:2})},"slider"),_C=e=>{let{props:l,handleSliderMouseUp:d,handleMouseMove:g,getActiveThumb:b}=e;const{isRtl:E}=zd(),P=He(()=>E.value!==l.reverse),i=He(()=>{let Li=E.value?"rtl":"ltr";return l.reverse&&(Li=Li==="rtl"?"ltr":"rtl"),Li}),F=He(()=>parseFloat(l.min)),j=He(()=>parseFloat(l.max)),K=He(()=>l.step>0?parseFloat(l.step):0),Y=He(()=>{const Li=K.value.toString().trim();return Li.includes(".")?Li.length-Li.indexOf(".")-1:0}),q=He(()=>parseInt(l.thumbSize,10)),re=He(()=>parseInt(l.tickSize,10)),me=He(()=>parseInt(l.trackSize,10)),we=He(()=>(j.value-F.value)/K.value),je=ki(l,"disabled"),$e=He(()=>l.direction==="vertical"),tt=He(()=>{var Li;return l.error||l.disabled?void 0:(Li=l.thumbColor)!=null?Li:l.color}),Ae=He(()=>{var Li;return l.error||l.disabled?void 0:(Li=l.trackColor)!=null?Li:l.color}),mt=He(()=>{var Li;return l.error||l.disabled?void 0:(Li=l.trackFillColor)!=null?Li:l.color}),Me=oi(!1),Ye=oi(0),Ze=oi(),rt=oi();function gt(Li){if(K.value<=0)return Li;const En=du(Li,F.value,j.value),wn=F.value%K.value,vr=Math.round((En-wn)/K.value)*K.value+wn;return parseFloat(Math.min(vr,j.value).toFixed(Y.value))}function vt(Li){var En;const wn=l.direction==="vertical",vr=wn?"top":"left",Fo=wn?"height":"width",Xr=wn?"clientY":"clientX",{[vr]:uo,[Fo]:ks}=(En=Ze.value)==null?void 0:En.$el.getBoundingClientRect(),at=w3(Li,Xr);let bt=Math.min(Math.max((at-uo-Ye.value)/ks,0),1)||0;return(wn||P.value)&&(bt=1-bt),gt(F.value+bt*(j.value-F.value))}let Ut=!1;const At=Li=>{Ut||(Ye.value=0,d(vt(Li))),Me.value=!1,Ut=!1,Ye.value=0},ti=Li=>{rt.value=b(Li),rt.value&&(rt.value.focus(),Me.value=!0,rt.value.contains(Li.target)?(Ut=!0,Ye.value=Yx(Li,rt.value,l.direction)):(Ye.value=0,g(vt(Li))))},Nt={passive:!0,capture:!0};function Wt(Li){Ut=!0,g(vt(Li))}function zt(Li){Li.stopPropagation(),Li.preventDefault(),At(Li),window.removeEventListener("mousemove",Wt,Nt),window.removeEventListener("mouseup",zt)}function Yt(Li){var En;At(Li),window.removeEventListener("touchmove",Wt,Nt),(En=Li.target)==null||En.removeEventListener("touchend",Yt)}function vi(Li){var En;ti(Li),window.addEventListener("touchmove",Wt,Nt),(En=Li.target)==null||En.addEventListener("touchend",Yt,{passive:!1})}function cn(Li){Li.preventDefault(),ti(Li),window.addEventListener("mousemove",Wt,Nt),window.addEventListener("mouseup",zt,{passive:!1})}const di=Li=>{const En=(Li-F.value)/(j.value-F.value)*100;return du(isNaN(En)?0:En,0,100)},un=He(()=>l.ticks?Array.isArray(l.ticks)?l.ticks.map(Li=>({value:Li,position:di(Li),label:Li.toString()})):Object.keys(l.ticks).map(Li=>({value:parseFloat(Li),position:di(parseFloat(Li)),label:l.ticks[Li]})):we.value!==1/0?vp(we.value+1).map(Li=>{const En=F.value+Li*K.value;return{value:En,position:di(En)}}):[]),mn=He(()=>un.value.some(Li=>{let{label:En}=Li;return!!En})),Er={activeThumbRef:rt,color:ki(l,"color"),decimals:Y,disabled:je,direction:ki(l,"direction"),elevation:ki(l,"elevation"),hasLabels:mn,horizontalDirection:i,isReversed:P,min:F,max:j,mousePressed:Me,numTicks:we,onSliderMousedown:cn,onSliderTouchstart:vi,parsedTicks:un,parseMouseMove:vt,position:di,readonly:ki(l,"readonly"),rounded:ki(l,"rounded"),roundValue:gt,showTicks:ki(l,"showTicks"),startOffset:Ye,step:K,thumbSize:q,thumbColor:tt,thumbLabel:ki(l,"thumbLabel"),ticks:ki(l,"ticks"),tickSize:re,trackColor:Ae,trackContainerRef:Ze,trackFillColor:mt,trackSize:me,vertical:$e};return ra(ab,Er),Er},Jx=$i({name:"VSliderThumb",directives:{Ripple:Rp},props:{focused:Boolean,max:{type:Number,required:!0},min:{type:Number,required:!0},modelValue:{type:Number,required:!0},position:{type:Number,required:!0}},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d,emit:g}=l;const b=co(ab);if(!b)throw new Error("[Vuetify] v-slider-thumb must be used inside v-slider or v-range-slider");const{thumbColor:E,step:P,vertical:i,disabled:F,thumbSize:j,thumbLabel:K,direction:Y,readonly:q,elevation:re,isReversed:me,horizontalDirection:we,mousePressed:je,decimals:$e}=b,{textColorClasses:tt,textColorStyles:Ae}=Zl(E),{pageup:mt,pagedown:Me,end:Ye,home:Ze,left:rt,right:gt,down:vt,up:Ut}=Lx,At=[mt,Me,Ye,Ze,rt,gt,vt,Ut],ti=He(()=>P.value?[1,2,3]:[1,5,10]);function Nt(zt,Yt){if(!At.includes(zt.key))return;zt.preventDefault();const vi=P.value||.1,cn=(e.max-e.min)/vi;if([rt,gt,vt,Ut].includes(zt.key)){const un=(me.value?[rt,Ut]:[gt,Ut]).includes(zt.key)?1:-1,mn=zt.shiftKey?2:zt.ctrlKey?1:0;Yt=Yt+un*vi*ti.value[mn]}else if(zt.key===Ze)Yt=e.min;else if(zt.key===Ye)Yt=e.max;else{const di=zt.key===Me?1:-1;Yt=Yt-di*vi*(cn>100?cn/10:10)}return Math.max(e.min,Math.min(e.max,Yt))}function Wt(zt){const Yt=Nt(zt,e.modelValue);Yt!=null&&g("update:modelValue",Yt)}return Ui(()=>{var zt;const Yt=pn(i.value?100-e.position:e.position,"%"),vi=i.value?"block":"inline",{elevationClasses:cn}=Da(He(()=>F.value?void 0:re.value));return ce("div",{class:["v-slider-thumb",{"v-slider-thumb--focused":e.focused,"v-slider-thumb--pressed":e.focused&&je.value}],style:{[`inset-${vi}-start`]:`calc(${Yt} - var(--v-slider-thumb-size) / 2)`,"--v-slider-thumb-size":pn(j.value),direction:i.value?void 0:we.value},role:"slider",tabindex:F.value?-1:0,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.modelValue,"aria-readonly":q.value,"aria-orientation":Y.value,onKeydown:q.value?void 0:Wt},[ce("div",{class:["v-slider-thumb__surface",tt.value,cn.value],style:{...Ae.value}},null),io(ce("div",{class:["v-slider-thumb__ripple",tt.value],style:Ae.value},null),[[bc("ripple"),!0,null,{circle:!0,center:!0}]]),ce(rS,{origin:"bottom center"},{default:()=>{var di;return[io(ce("div",{class:"v-slider-thumb__label-container"},[ce("div",{class:["v-slider-thumb__label"]},[ce("div",null,[(di=(zt=d["thumb-label"])==null?void 0:zt.call(d,{modelValue:e.modelValue}))!=null?di:e.modelValue.toFixed(P.value?$e.value:1)])])]),[[na,K.value&&e.focused||K.value==="always"]])]}})])}),{}}});const yC=$i({name:"VSliderTrack",props:{start:{type:Number,required:!0},stop:{type:Number,required:!0}},emits:{},setup(e,l){let{slots:d}=l;const g=co(ab);if(!g)throw new Error("[Vuetify] v-slider-track must be inside v-slider or v-range-slider");const{color:b,horizontalDirection:E,parsedTicks:P,rounded:i,showTicks:F,tickSize:j,trackColor:K,trackFillColor:Y,trackSize:q,vertical:re,min:me,max:we}=g,{roundedClasses:je}=xs(i),{backgroundColorClasses:$e,backgroundColorStyles:tt}=vs(Y),{backgroundColorClasses:Ae,backgroundColorStyles:mt}=vs(K),Me=He(()=>`inset-${re.value?"block-end":"inline-start"}`),Ye=He(()=>re.value?"height":"width"),Ze=He(()=>({[Me.value]:"0%",[Ye.value]:"100%"})),rt=He(()=>e.stop-e.start),gt=He(()=>({[Me.value]:pn(e.start,"%"),[Ye.value]:pn(rt.value,"%")})),vt=He(()=>(re.value?P.value.slice().reverse():P.value).map((At,ti)=>{var Yt;var Nt;const Wt=re.value?"bottom":"margin-inline-start",zt=At.value!==me.value&&At.value!==we.value?pn(At.position,"%"):void 0;return ce("div",{key:At.value,class:["v-slider-track__tick",{"v-slider-track__tick--filled":At.position>=e.start&&At.position<=e.stop,"v-slider-track__tick--first":At.value===me.value,"v-slider-track__tick--last":At.value===we.value}],style:{[Wt]:zt}},[(At.label||d["tick-label"])&&ce("div",{class:"v-slider-track__tick-label"},[(Yt=(Nt=d["tick-label"])==null?void 0:Nt.call(d,{tick:At,index:ti}))!=null?Yt:At.label])])}));return Ui(()=>ce("div",{class:["v-slider-track",je.value],style:{"--v-slider-track-size":pn(q.value),"--v-slider-tick-size":pn(j.value),direction:re.value?void 0:E.value}},[ce("div",{class:["v-slider-track__background",Ae.value,{"v-slider-track__background--opacity":!!b.value||!Y.value}],style:{...Ze.value,...mt.value}},null),ce("div",{class:["v-slider-track__fill",$e.value],style:{...gt.value,...tt.value}},null),F.value&&ce("div",{class:["v-slider-track__ticks",{"v-slider-track__ticks--always-show":F.value==="always"}]},[vt.value])])),{}}}),Qx=$i({name:"VSlider",props:{...ib(),...gC(),...Ld(),modelValue:{type:[Number,String],default:0}},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=oi(),{min:b,max:E,mousePressed:P,roundValue:i,onSliderMousedown:F,onSliderTouchstart:j,trackContainerRef:K,position:Y,hasLabels:q,readonly:re}=_C({props:e,handleSliderMouseUp:Ae=>me.value=i(Ae),handleMouseMove:Ae=>me.value=i(Ae),getActiveThumb:()=>{var Ae;return(Ae=g.value)==null?void 0:Ae.$el}}),me=ar(e,"modelValue",void 0,Ae=>{const mt=typeof Ae=="string"?parseFloat(Ae):Ae==null?b.value:Ae;return i(mt)}),{isFocused:we,focus:je,blur:$e}=nb(e),tt=He(()=>Y(me.value));return Ui(()=>{const[Ae,mt]=Lf(e),Me=!!(e.label||d.label||d.prepend);return ce(Fh,zn({class:["v-slider",{"v-slider--has-labels":!!d["tick-label"]||q.value,"v-slider--focused":we.value,"v-slider--pressed":P.value,"v-slider--disabled":e.disabled}]},Ae,{focused:we.value}),{...d,prepend:Me?Ye=>{var gt;var Ze,rt;return ce(Tr,null,[((gt=(Ze=d.label)==null?void 0:Ze.call(d,Ye))!=null?gt:e.label)?ce(Zm,{class:"v-slider__label",text:e.label},null):void 0,(rt=d.prepend)==null?void 0:rt.call(d,Ye)])}:void 0,default:Ye=>{let{id:Ze}=Ye;return ce("div",{class:"v-slider__container",onMousedown:re.value?void 0:F,onTouchstartPassive:re.value?void 0:j},[ce("input",{id:Ze.value,name:e.name||Ze.value,disabled:e.disabled,readonly:e.readonly,tabindex:"-1",value:me.value},null),ce(yC,{ref:K,start:0,stop:tt.value},{"tick-label":d["tick-label"]}),ce(Jx,{ref:g,focused:we.value,min:b.value,max:E.value,modelValue:me.value,"onUpdate:modelValue":rt=>me.value=rt,position:tt.value,elevation:e.elevation,onFocus:je,onBlur:$e},{"thumb-label":d["thumb-label"]})])}})}),{}}}),T3=$i({name:"VColorPickerPreview",props:{color:{type:Object},disabled:Boolean,hideAlpha:Boolean},emits:{"update:color":e=>!0},setup(e,l){let{emit:d}=l;return Ui(()=>{var E;var g,b;return ce("div",{class:["v-color-picker-preview",{"v-color-picker-preview--hide-alpha":e.hideAlpha}]},[ce("div",{class:"v-color-picker-preview__dot"},[ce("div",{style:{background:UE((E=e.color)!=null?E:Xy)}},null)]),ce("div",{class:"v-color-picker-preview__sliders"},[ce(Qx,{class:"v-color-picker-preview__track v-color-picker-preview__hue",modelValue:(g=e.color)==null?void 0:g.h,"onUpdate:modelValue":P=>{var i;return d("update:color",{...(i=e.color)!=null?i:Xy,h:P})},step:0,min:0,max:360,disabled:e.disabled,thumbSize:14,trackSize:8,trackFillColor:"white",hideDetails:!0},null),!e.hideAlpha&&ce(Qx,{class:"v-color-picker-preview__track v-color-picker-preview__alpha",modelValue:(b=e.color)==null?void 0:b.a,"onUpdate:modelValue":P=>{var i;return d("update:color",{...(i=e.color)!=null?i:Xy,a:P})},step:0,min:0,max:1,disabled:e.disabled,thumbSize:14,trackSize:8,trackFillColor:"white",hideDetails:!0},null)])])}),{}}});const E3=Object.freeze({base:"#f44336",lighten5:"#ffebee",lighten4:"#ffcdd2",lighten3:"#ef9a9a",lighten2:"#e57373",lighten1:"#ef5350",darken1:"#e53935",darken2:"#d32f2f",darken3:"#c62828",darken4:"#b71c1c",accent1:"#ff8a80",accent2:"#ff5252",accent3:"#ff1744",accent4:"#d50000"}),S3=Object.freeze({base:"#e91e63",lighten5:"#fce4ec",lighten4:"#f8bbd0",lighten3:"#f48fb1",lighten2:"#f06292",lighten1:"#ec407a",darken1:"#d81b60",darken2:"#c2185b",darken3:"#ad1457",darken4:"#880e4f",accent1:"#ff80ab",accent2:"#ff4081",accent3:"#f50057",accent4:"#c51162"}),C3=Object.freeze({base:"#9c27b0",lighten5:"#f3e5f5",lighten4:"#e1bee7",lighten3:"#ce93d8",lighten2:"#ba68c8",lighten1:"#ab47bc",darken1:"#8e24aa",darken2:"#7b1fa2",darken3:"#6a1b9a",darken4:"#4a148c",accent1:"#ea80fc",accent2:"#e040fb",accent3:"#d500f9",accent4:"#aa00ff"}),I3=Object.freeze({base:"#673ab7",lighten5:"#ede7f6",lighten4:"#d1c4e9",lighten3:"#b39ddb",lighten2:"#9575cd",lighten1:"#7e57c2",darken1:"#5e35b1",darken2:"#512da8",darken3:"#4527a0",darken4:"#311b92",accent1:"#b388ff",accent2:"#7c4dff",accent3:"#651fff",accent4:"#6200ea"}),A3=Object.freeze({base:"#3f51b5",lighten5:"#e8eaf6",lighten4:"#c5cae9",lighten3:"#9fa8da",lighten2:"#7986cb",lighten1:"#5c6bc0",darken1:"#3949ab",darken2:"#303f9f",darken3:"#283593",darken4:"#1a237e",accent1:"#8c9eff",accent2:"#536dfe",accent3:"#3d5afe",accent4:"#304ffe"}),M3=Object.freeze({base:"#2196f3",lighten5:"#e3f2fd",lighten4:"#bbdefb",lighten3:"#90caf9",lighten2:"#64b5f6",lighten1:"#42a5f5",darken1:"#1e88e5",darken2:"#1976d2",darken3:"#1565c0",darken4:"#0d47a1",accent1:"#82b1ff",accent2:"#448aff",accent3:"#2979ff",accent4:"#2962ff"}),k3=Object.freeze({base:"#03a9f4",lighten5:"#e1f5fe",lighten4:"#b3e5fc",lighten3:"#81d4fa",lighten2:"#4fc3f7",lighten1:"#29b6f6",darken1:"#039be5",darken2:"#0288d1",darken3:"#0277bd",darken4:"#01579b",accent1:"#80d8ff",accent2:"#40c4ff",accent3:"#00b0ff",accent4:"#0091ea"}),P3=Object.freeze({base:"#00bcd4",lighten5:"#e0f7fa",lighten4:"#b2ebf2",lighten3:"#80deea",lighten2:"#4dd0e1",lighten1:"#26c6da",darken1:"#00acc1",darken2:"#0097a7",darken3:"#00838f",darken4:"#006064",accent1:"#84ffff",accent2:"#18ffff",accent3:"#00e5ff",accent4:"#00b8d4"}),z3=Object.freeze({base:"#009688",lighten5:"#e0f2f1",lighten4:"#b2dfdb",lighten3:"#80cbc4",lighten2:"#4db6ac",lighten1:"#26a69a",darken1:"#00897b",darken2:"#00796b",darken3:"#00695c",darken4:"#004d40",accent1:"#a7ffeb",accent2:"#64ffda",accent3:"#1de9b6",accent4:"#00bfa5"}),D3=Object.freeze({base:"#4caf50",lighten5:"#e8f5e9",lighten4:"#c8e6c9",lighten3:"#a5d6a7",lighten2:"#81c784",lighten1:"#66bb6a",darken1:"#43a047",darken2:"#388e3c",darken3:"#2e7d32",darken4:"#1b5e20",accent1:"#b9f6ca",accent2:"#69f0ae",accent3:"#00e676",accent4:"#00c853"}),L3=Object.freeze({base:"#8bc34a",lighten5:"#f1f8e9",lighten4:"#dcedc8",lighten3:"#c5e1a5",lighten2:"#aed581",lighten1:"#9ccc65",darken1:"#7cb342",darken2:"#689f38",darken3:"#558b2f",darken4:"#33691e",accent1:"#ccff90",accent2:"#b2ff59",accent3:"#76ff03",accent4:"#64dd17"}),B3=Object.freeze({base:"#cddc39",lighten5:"#f9fbe7",lighten4:"#f0f4c3",lighten3:"#e6ee9c",lighten2:"#dce775",lighten1:"#d4e157",darken1:"#c0ca33",darken2:"#afb42b",darken3:"#9e9d24",darken4:"#827717",accent1:"#f4ff81",accent2:"#eeff41",accent3:"#c6ff00",accent4:"#aeea00"}),R3=Object.freeze({base:"#ffeb3b",lighten5:"#fffde7",lighten4:"#fff9c4",lighten3:"#fff59d",lighten2:"#fff176",lighten1:"#ffee58",darken1:"#fdd835",darken2:"#fbc02d",darken3:"#f9a825",darken4:"#f57f17",accent1:"#ffff8d",accent2:"#ffff00",accent3:"#ffea00",accent4:"#ffd600"}),O3=Object.freeze({base:"#ffc107",lighten5:"#fff8e1",lighten4:"#ffecb3",lighten3:"#ffe082",lighten2:"#ffd54f",lighten1:"#ffca28",darken1:"#ffb300",darken2:"#ffa000",darken3:"#ff8f00",darken4:"#ff6f00",accent1:"#ffe57f",accent2:"#ffd740",accent3:"#ffc400",accent4:"#ffab00"}),F3=Object.freeze({base:"#ff9800",lighten5:"#fff3e0",lighten4:"#ffe0b2",lighten3:"#ffcc80",lighten2:"#ffb74d",lighten1:"#ffa726",darken1:"#fb8c00",darken2:"#f57c00",darken3:"#ef6c00",darken4:"#e65100",accent1:"#ffd180",accent2:"#ffab40",accent3:"#ff9100",accent4:"#ff6d00"}),V3=Object.freeze({base:"#ff5722",lighten5:"#fbe9e7",lighten4:"#ffccbc",lighten3:"#ffab91",lighten2:"#ff8a65",lighten1:"#ff7043",darken1:"#f4511e",darken2:"#e64a19",darken3:"#d84315",darken4:"#bf360c",accent1:"#ff9e80",accent2:"#ff6e40",accent3:"#ff3d00",accent4:"#dd2c00"}),N3=Object.freeze({base:"#795548",lighten5:"#efebe9",lighten4:"#d7ccc8",lighten3:"#bcaaa4",lighten2:"#a1887f",lighten1:"#8d6e63",darken1:"#6d4c41",darken2:"#5d4037",darken3:"#4e342e",darken4:"#3e2723"}),U3=Object.freeze({base:"#607d8b",lighten5:"#eceff1",lighten4:"#cfd8dc",lighten3:"#b0bec5",lighten2:"#90a4ae",lighten1:"#78909c",darken1:"#546e7a",darken2:"#455a64",darken3:"#37474f",darken4:"#263238"}),$3=Object.freeze({base:"#9e9e9e",lighten5:"#fafafa",lighten4:"#f5f5f5",lighten3:"#eeeeee",lighten2:"#e0e0e0",lighten1:"#bdbdbd",darken1:"#757575",darken2:"#616161",darken3:"#424242",darken4:"#212121"}),j3=Object.freeze({black:"#000000",white:"#ffffff",transparent:"#ffffff00"}),G3=Object.freeze({red:E3,pink:S3,purple:C3,deepPurple:I3,indigo:A3,blue:M3,lightBlue:k3,cyan:P3,teal:z3,green:D3,lightGreen:L3,lime:B3,yellow:R3,amber:O3,orange:F3,deepOrange:V3,brown:N3,blueGrey:U3,grey:$3,shades:j3});function q3(e){return Object.keys(e).map(l=>{const d=e[l];return d.base?[d.base,d.darken4,d.darken3,d.darken2,d.darken1,d.lighten1,d.lighten2,d.lighten3,d.lighten4,d.lighten5]:[d.black,d.white,d.transparent]})}const Z3=$i({name:"VColorPickerSwatches",props:{swatches:{type:Array,default:()=>q3(G3)},disabled:Boolean,color:Object,maxHeight:[Number,String]},emits:{"update:color":e=>!0},setup(e,l){let{emit:d}=l;return Ui(()=>ce("div",{class:"v-color-picker-swatches",style:{maxHeight:pn(e.maxHeight)}},[ce("div",null,[e.swatches.map(g=>ce("div",{class:"v-color-picker-swatches__swatch"},[g.map(b=>{const E=pC(b);return ce("div",{class:"v-color-picker-swatches__color",onClick:()=>E&&d("update:color",E)},[ce("div",{style:{background:b}},[e.color&&T_(e.color,E)?ce(As,{size:"x-small",icon:"$success",color:BP(b,"#FFFFFF")>2?"white":"black"},null):void 0])])})]))])])),{}}});const vC=$i({name:"VSheet",props:{color:String,...Ec(),...oh(),...Ns(),...Op(),...jm(),...ts(),...lr(),...Ur()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{backgroundColorClasses:b,backgroundColorStyles:E}=vs(ki(e,"color")),{borderClasses:P}=vu(e),{dimensionStyles:i}=sh(e),{elevationClasses:F}=Da(e),{locationStyles:j}=Fp(e),{positionClasses:K}=Gm(e),{roundedClasses:Y}=xs(e);return()=>ce(e.tag,{class:["v-sheet",g.value,b.value,P.value,F.value,K.value,Y.value],style:[E.value,i.value,j.value]},d)}}),W3=$i({name:"VColorPicker",inheritAttrs:!1,props:{canvasHeight:{type:[String,Number],default:150},disabled:Boolean,dotSize:{type:[Number,String],default:10},hideCanvas:Boolean,hideSliders:Boolean,hideInputs:Boolean,mode:{type:String,default:"rgba",validator:e=>Object.keys(wp).includes(e)},modes:{type:Array,default:()=>Object.keys(wp),validator:e=>Array.isArray(e)&&e.every(l=>Object.keys(wp).includes(l))},showSwatches:Boolean,swatches:Array,swatchesMaxHeight:{type:[Number,String],default:150},modelValue:{type:[Object,String]},width:{type:[Number,String],default:300},...Ns(),...ts(),...Ur()},emits:{"update:modelValue":e=>!0,"update:mode":e=>!0},setup(e){const l=ar(e,"mode"),d=oi(null),g=ar(e,"modelValue",void 0,E=>{let P=pC(E);return P?(d.value&&(P={...P,h:d.value.h},d.value=null),P):null},E=>E?g3(E,e.modelValue):null),b=E=>{g.value=E,d.value=E};return Wl(()=>{e.modes.includes(l.value)||(l.value=e.modes[0])}),Ui(()=>{var E;return ce(vC,{rounded:e.rounded,elevation:e.elevation,theme:e.theme,class:["v-color-picker"],style:{"--v-color-picker-color-hsv":UE({...(E=g.value)!=null?E:Xy,a:1})},maxWidth:e.width},{default:()=>[!e.hideCanvas&&ce(p3,{key:"canvas",color:g.value,"onUpdate:color":b,disabled:e.disabled,dotSize:e.dotSize,width:e.width,height:e.canvasHeight},null),(!e.hideSliders||!e.hideInputs)&&ce("div",{key:"controls",class:"v-color-picker__controls"},[!e.hideSliders&&ce(T3,{key:"preview",color:g.value,"onUpdate:color":b,hideAlpha:!l.value.endsWith("a"),disabled:e.disabled},null),!e.hideInputs&&ce(b3,{key:"edit",modes:e.modes,mode:l.value,"onUpdate:mode":P=>l.value=P,color:g.value,"onUpdate:color":b,disabled:e.disabled},null)]),e.showSwatches&&ce(Z3,{key:"swatches",color:g.value,"onUpdate:color":b,maxHeight:e.swatchesMaxHeight,swatches:e.swatches,disabled:e.disabled},null)]})}),{}}});function X3(e,l,d){if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?ce(Tr,null,[ce("span",{class:"v-combobox__unmask"},[e.substr(0,l)]),ce("span",{class:"v-combobox__mask"},[e.substr(l,d)]),ce("span",{class:"v-combobox__unmask"},[e.substr(l+d)])]):e}const H3=es()({name:"VCombobox",props:{delimiters:Array,...JS({filterKeys:["title"]}),...ob({hideNoData:!0,returnObject:!0}),...Tc({transition:!1})},emits:{"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,l){var ti;var d;let{emit:g,slots:b}=l;const{t:E}=rh(),P=oi(),i=oi(!1),F=oi(!0),j=ar(e,"menu"),K=oi(-1),Y=He(()=>{var Nt;return(Nt=P.value)==null?void 0:Nt.color}),{items:q,transformIn:re,transformOut:me}=eb(e),{textColorClasses:we,textColorStyles:je}=Zl(Y),$e=ar(e,"modelValue",[],Nt=>re(mu(Nt||[])),Nt=>{var zt;const Wt=me(Nt);return e.multiple?Wt:(zt=Wt[0])!=null?zt:null}),tt=oi(e.multiple?"":(ti=(d=$e.value[0])==null?void 0:d.title)!=null?ti:""),Ae=He({get:()=>tt.value,set:Nt=>{var Wt;if(tt.value=Nt,e.multiple||($e.value=[Em(e,Nt)]),Nt&&e.multiple&&(Wt=e.delimiters)!=null&&Wt.length){const zt=Nt.split(new RegExp(`(?:${e.delimiters.join("|")})+`));zt.length>1&&(zt.forEach(Yt=>{Yt=Yt.trim(),Yt&&At(Em(e,Yt))}),tt.value="")}Nt||(K.value=-1),i.value&&(j.value=!0),F.value=!Nt}});Mn(tt,Nt=>{g("update:search",Nt)}),Mn($e,Nt=>{var zt;if(!e.multiple){var Wt;tt.value=(zt=(Wt=Nt[0])==null?void 0:Wt.title)!=null?zt:""}});const{filteredItems:mt}=QS(e,q,He(()=>F.value?void 0:Ae.value)),Me=He(()=>$e.value.map(Nt=>q.value.find(Wt=>Wt.value===Nt.value)||Nt)),Ye=He(()=>Me.value.map(Nt=>Nt.props.value)),Ze=He(()=>Me.value[K.value]);function rt(Nt){$e.value=[],e.openOnClear&&(j.value=!0)}function gt(){e.hideNoData&&!q.value.length||e.readonly||(j.value=!0)}function vt(Nt){if(e.readonly)return;const Wt=P.value.selectionStart,zt=Ye.value.length;if(K.value>-1&&Nt.preventDefault(),["Enter","ArrowDown"].includes(Nt.key)&&(j.value=!0),["Escape"].includes(Nt.key)&&(j.value=!1),["Enter","Escape","Tab"].includes(Nt.key)&&(F.value=!0),!!e.multiple){if(["Backspace","Delete"].includes(Nt.key)){if(K.value<0){Nt.key==="Backspace"&&!Ae.value&&(K.value=zt-1);return}At(Ze.value),ys(()=>!Ze.value&&(K.value=zt-2))}if(Nt.key==="ArrowLeft"){if(K.value<0&&Wt>0)return;const Yt=K.value>-1?K.value-1:zt-1;Me.value[Yt]?K.value=Yt:(K.value=-1,P.value.setSelectionRange(Ae.value.length,Ae.value.length))}if(Nt.key==="ArrowRight"){if(K.value<0)return;const Yt=K.value+1;Me.value[Yt]?K.value=Yt:(K.value=-1,P.value.setSelectionRange(0,0))}Nt.key==="Enter"&&(At(Em(e,Ae.value)),Ae.value="")}}function Ut(){i.value&&(F.value=!0)}function At(Nt){if(e.multiple){const Wt=Ye.value.findIndex(zt=>zt===Nt.value);if(Wt===-1)$e.value=[...$e.value,Nt];else{const zt=[...$e.value];zt.splice(Wt,1),$e.value=zt}Ae.value=""}else $e.value=[Nt],tt.value=Nt.title,ys(()=>{j.value=!1,F.value=!0})}return Mn(mt,Nt=>{!Nt.length&&e.hideNoData&&(j.value=!1)}),Mn(i,Nt=>{if(Nt)K.value=-1;else{if(j.value=!1,!e.multiple||!Ae.value)return;$e.value=[...$e.value,Em(e,Ae.value)],Ae.value=""}}),Ui(()=>{const Nt=!!(e.chips||b.chip);return ce(jv,{ref:P,modelValue:Ae.value,"onUpdate:modelValue":[Wt=>Ae.value=Wt,Wt=>{Wt==null&&($e.value=[])}],validationValue:$e.externalValue,dirty:$e.value.length>0,class:["v-combobox",{"v-combobox--active-menu":j.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":K.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0}],appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,"onClick:clear":rt,"onClick:control":gt,"onClick:input":gt,onFocus:()=>i.value=!0,onBlur:()=>i.value=!1,onKeydown:vt},{...b,default:()=>{var Wt,zt,Yt;return ce(Tr,null,[ce(Nv,zn({modelValue:j.value,"onUpdate:modelValue":vi=>j.value=vi,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Ut},e.menuProps),{default:()=>[ce(Ov,{selected:Ye.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:vi=>vi.preventDefault()},{default:()=>{var vi;return[!mt.value.length&&!e.hideNoData&&((vi=(Wt=b["no-data"])==null?void 0:Wt.call(b))!=null?vi:ce(Md,{title:E(e.noDataText)},null)),(zt=b["prepend-item"])==null?void 0:zt.call(b),mt.value.map((cn,di)=>{var Li;var un;let{item:mn,matches:Er}=cn;return(Li=(un=b.item)==null?void 0:un.call(b,{item:mn,index:di,props:zn(mn.props,{onClick:()=>At(mn)})}))!=null?Li:ce(Md,zn({key:di},mn.props,{onClick:()=>At(mn)}),{prepend:En=>{let{isSelected:wn}=En;return e.multiple&&!e.hideSelected?ce(Wm,{modelValue:wn,ripple:!1},null):void 0},title:()=>{var wn;var En;return F.value?mn.title:X3(mn.title,Er.title,(wn=(En=Ae.value)==null?void 0:En.length)!=null?wn:0)}})}),(Yt=b["append-item"])==null?void 0:Yt.call(b)]}})]}),Me.value.map((vi,cn)=>{function di(mn){mn.stopPropagation(),mn.preventDefault(),At(vi)}const un={"onClick:close":di,modelValue:!0,"onUpdate:modelValue":void 0};return ce("div",{key:vi.value,class:["v-combobox__selection",cn===K.value&&["v-combobox__selection--selected",we.value]],style:cn===K.value?je.value:{}},[Nt?ce(Go,{defaults:{VChip:{closable:e.closableChips,size:"small",text:vi.title}}},{default:()=>[b.chip?b.chip({item:vi,index:cn,props:un}):ce(C_,un,null)]}):b.selection?b.selection({item:vi,index:cn}):ce("span",{class:"v-combobox__selection-text"},[vi.title,e.multiple&&cn<Me.value.length-1&&ce("span",{class:"v-combobox__selection-comma"},[Yo(",")])])])})])}})}),ah({isFocused:i,isPristine:F,menu:j,search:Ae,selectionIndex:K,filteredItems:mt,select:At},P)}});const K3=es()({name:"VDialog",inheritAttrs:!1,props:{fullscreen:Boolean,origin:{type:String,default:"center center"},retainFocus:{type:Boolean,default:!0},scrollable:Boolean,modelValue:Boolean,...Tc({transition:{component:Pv}})},emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const b=ar(e,"modelValue"),{scopeId:E}=Vv(),P=oi();function i(F){var j,K;const Y=F.relatedTarget,q=F.target;if(Y!==q&&(j=P.value)!=null&&j.contentEl&&(K=P.value)!=null&&K.globalTop&&![document,P.value.contentEl].includes(q)&&!P.value.contentEl.contains(q)){const re=[...P.value.contentEl.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')].filter(je=>!je.hasAttribute("disabled")&&!je.matches('[tabindex="-1"]'));if(!re.length)return;const me=re[0],we=re[re.length-1];Y===me?we.focus():me.focus()}}return Jo&&Mn(()=>b.value&&e.retainFocus,F=>{F?document.addEventListener("focusin",i):document.removeEventListener("focusin",i)},{immediate:!0}),Mn(b,async F=>{if(await ys(),F){var j;(j=P.value.contentEl)==null||j.focus({preventScroll:!0})}else{var K;(K=P.value.activatorEl)==null||K.focus({preventScroll:!0})}}),Ui(()=>ce(I_,zn({modelValue:b.value,"onUpdate:modelValue":F=>b.value=F,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable}],transition:e.transition,scrollStrategy:"block",ref:P,"aria-role":"dialog","aria-modal":"true",activatorProps:{"aria-haspopup":"dialog","aria-expanded":String(b.value)},"z-index":2400},E,d),{activator:g.activator,default:function(){for(var F,j=arguments.length,K=new Array(j),Y=0;Y<j;Y++)K[Y]=arguments[Y];return ce(Go,{root:!0},{default:()=>[(F=g.default)==null?void 0:F.call(g,...K)]})}})),ah({},P)}});const v_=Symbol.for("vuetify:v-expansion-panel"),Y3=["default","accordion","inset","popout"],J3=$i({name:"VExpansionPanels",props:{color:String,variant:{type:String,default:"default",validator:e=>Y3.includes(e)},readonly:Boolean,...Nm(),...lr(),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;Bp(e,v_);const{themeClasses:g}=To(e),b=He(()=>e.variant&&`v-expansion-panels--variant-${e.variant}`);return Vs({VExpansionPanel:{color:ki(e,"color")},VExpansionPanelTitle:{readonly:ki(e,"readonly")}}),Ui(()=>ce(e.tag,{class:["v-expansion-panels",g.value,b.value]},d)),{}}}),xC=mr({color:String,expandIcon:{type:Yn,default:"$expand"},collapseIcon:{type:Yn,default:"$collapse"},hideActions:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean},"VExpansionPanelTitle"),bC=$i({name:"VExpansionPanelTitle",directives:{Ripple:Rp},props:{...xC()},setup(e,l){let{slots:d}=l;const g=co(v_);if(!g)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:b,backgroundColorStyles:E}=vs(e,"color"),P=He(()=>({collapseIcon:e.collapseIcon,disabled:g.disabled.value,expanded:g.isSelected.value,expandIcon:e.expandIcon,readonly:e.readonly}));return Ui(()=>{var i;return io(ce("button",{class:["v-expansion-panel-title",{"v-expansion-panel-title--active":g.isSelected.value},b.value],style:E.value,type:"button",tabindex:g.disabled.value?-1:void 0,disabled:g.disabled.value,"aria-expanded":g.isSelected.value,onClick:e.readonly?void 0:g.toggle},[ce("span",{class:"v-expansion-panel-title__overlay"},null),(i=d.default)==null?void 0:i.call(d,P.value),!e.hideActions&&ce("span",{class:"v-expansion-panel-title__icon"},[d.actions?d.actions(P.value):ce(As,{icon:g.isSelected.value?e.collapseIcon:e.expandIcon},null)])]),[[bc("ripple"),e.ripple]])}),{}}}),wC=$i({name:"VExpansionPanelText",props:{...Fv()},setup(e,l){let{slots:d}=l;const g=co(v_);if(!g)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:b,onAfterLeave:E}=tb(e,g.isSelected);return Ui(()=>{var P;return ce(zv,{onAfterLeave:E},{default:()=>[io(ce("div",{class:"v-expansion-panel-text"},[d.default&&b.value&&ce("div",{class:"v-expansion-panel-text__wrapper"},[(P=d.default)==null?void 0:P.call(d)])]),[[na,g.isSelected.value]])]})}),{}}}),Q3=$i({name:"VExpansionPanel",props:{title:String,text:String,bgColor:String,...Ns(),...Lp(),...Fv(),...ts(),...lr(),...xC()},emits:{"group:selected":e=>!0},setup(e,l){let{slots:d}=l;const g=Um(e,v_),{backgroundColorClasses:b,backgroundColorStyles:E}=vs(e,"bgColor"),{elevationClasses:P}=Da(e),{roundedClasses:i}=xs(e),F=He(()=>(g==null?void 0:g.disabled.value)||e.disabled),j=He(()=>g.group.items.value.reduce((q,re,me)=>(g.group.selected.value.includes(re.id)&&q.push(me),q),[])),K=He(()=>{const q=g.group.items.value.findIndex(re=>re.id===g.id);return!g.isSelected.value&&j.value.some(re=>re-q===1)}),Y=He(()=>{const q=g.group.items.value.findIndex(re=>re.id===g.id);return!g.isSelected.value&&j.value.some(re=>re-q===-1)});return ra(v_,g),Ui(()=>{var q;const re=!!(d.text||e.text),me=!!(d.title||e.title);return ce(e.tag,{class:["v-expansion-panel",{"v-expansion-panel--active":g.isSelected.value,"v-expansion-panel--before-active":K.value,"v-expansion-panel--after-active":Y.value,"v-expansion-panel--disabled":F.value},i.value,b.value],style:E.value,"aria-expanded":g.isSelected.value},{default:()=>[ce("div",{class:["v-expansion-panel__shadow",...P.value]},null),me&&ce(bC,{key:"title",collapseIcon:e.collapseIcon,color:e.color,expandIcon:e.expandIcon,hideActions:e.hideActions,ripple:e.ripple},{default:()=>[d.title?d.title():e.title]}),re&&ce(wC,{key:"text",eager:e.eager},{default:()=>[d.text?d.text():e.text]}),(q=d.default)==null?void 0:q.call(d)]})}),{}}});const eD=$i({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...Ld({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>mu(e).every(l=>l!=null&&typeof l=="object")},...Uv({clearable:!0})},emits:{"click:control":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{attrs:d,emit:g,slots:b}=l;const{t:E}=rh(),P=ar(e,"modelValue"),i=He(()=>typeof e.showSize!="boolean"?e.showSize:void 0),F=He(()=>{var Me;return((Me=P.value)!=null?Me:[]).reduce((Ye,Ze)=>{let{size:rt=0}=Ze;return Ye+rt},0)}),j=He(()=>m2(F.value,i.value)),K=He(()=>{var Me;return((Me=P.value)!=null?Me:[]).map(Ye=>{const{name:Ze="",size:rt=0}=Ye;return e.showSize?`${Ze} (${m2(rt,i.value)})`:Ze})}),Y=He(()=>{var Ze;var Me;const Ye=(Ze=(Me=P.value)==null?void 0:Me.length)!=null?Ze:0;return e.showSize?E(e.counterSizeString,Ye,j.value):E(e.counterString,Ye)}),q=oi(),re=oi(),me=oi(!1),we=oi(),je=He(()=>e.messages.length?e.messages:e.persistentHint?e.hint:"");function $e(){if(we.value!==document.activeElement){var Me;(Me=we.value)==null||Me.focus()}me.value||(me.value=!0)}function tt(Me){av(e["onClick:prepend"],Me),Ae(Me)}function Ae(Me){var Ye;(Ye=we.value)==null||Ye.click(),g("click:control",Me)}function mt(Me){Me.stopPropagation(),$e(),ys(()=>{P.value=[],we!=null&&we.value&&(we.value.value=""),av(e["onClick:clear"],Me)})}return Ui(()=>{const Me=!!(b.counter||e.counter),Ye=!!(Me||b.details),[Ze,rt]=Pp(d),[{modelValue:gt,...vt}]=Lf(e),[Ut]=rb(e);return ce(Fh,zn({ref:q,modelValue:P.value,"onUpdate:modelValue":At=>P.value=At,class:"v-file-input","onClick:prepend":tt,"onClick:append":e["onClick:append"]},Ze,vt,{messages:je.value}),{...b,default:At=>{let{isDisabled:ti,isDirty:Nt,isReadonly:Wt,isValid:zt}=At;return ce(A_,zn({ref:re,"prepend-icon":e.prependIcon,"onClick:control":Ae,"onClick:clear":mt,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Ut,{active:Nt.value||me.value,dirty:Nt.value,focused:me.value,error:zt.value===!1}),{...b,default:Yt=>{let{props:{class:vi,...cn}}=Yt;return ce(Tr,null,[ce("input",zn({ref:we,type:"file",readonly:Wt.value,disabled:ti.value,multiple:e.multiple,name:e.name,onClick:di=>{di.stopPropagation(),$e()},onChange:di=>{var mn;if(!di.target)return;const un=di.target;P.value=[...(mn=un.files)!=null?mn:[]]},onFocus:$e,onBlur:()=>me.value=!1},cn,rt),null),ce("div",{class:vi},[P.value.length>0&&(b.selection?b.selection({fileNames:K.value,totalBytes:F.value,totalBytesReadable:j.value}):e.chips?K.value.map(di=>ce(C_,{key:di,size:"small",color:e.color},{default:()=>[di]})):K.value.join(", "))])])}})},details:Ye?At=>{var ti;return ce(Tr,null,[(ti=b.details)==null?void 0:ti.call(b,At),Me&&ce(Tr,null,[ce("span",null,null),ce($v,{active:!!P.value.length,value:Y.value},b.counter)])])}:void 0})}),ah({},q,re,we)}});const tD=$i({name:"VFooter",props:{app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...Ec(),...Ns(),...Om(),...ts(),...lr({tag:"footer"}),...Ur()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{backgroundColorClasses:b,backgroundColorStyles:E}=vs(ki(e,"color")),{borderClasses:P}=vu(e),{elevationClasses:i}=Da(e),{roundedClasses:F}=xs(e),j=oi(32),{resizeRef:K}=Ip(re=>{!re.length||(j.value=re[0].target.clientHeight)}),Y=He(()=>e.height==="auto"?j.value:parseInt(e.height,10)),{layoutItemStyles:q}=Fm({id:e.name,order:He(()=>parseInt(e.order,10)),position:He(()=>"bottom"),layoutSize:Y,elementSize:He(()=>e.height==="auto"?void 0:Y.value),active:He(()=>e.app),absolute:ki(e,"absolute")});return Ui(()=>ce(e.tag,{ref:K,class:["v-footer",g.value,b.value,P.value,i.value,F.value],style:[E,e.app?q.value:void 0]},d)),{}}}),iD=$i({name:"VForm",props:{...J4()},emits:{"update:modelValue":e=>!0,submit:e=>!0},setup(e,l){let{slots:d,emit:g}=l;const b=Q4(e),E=oi();function P(F){F.preventDefault(),b.reset()}function i(F){const j=F,K=b.validate();j.then=K.then.bind(K),j.catch=K.catch.bind(K),j.finally=K.finally.bind(K),g("submit",j),j.defaultPrevented||K.then(Y=>{let{valid:q}=Y;if(q){var re;(re=E.value)==null||re.submit()}}),j.preventDefault()}return Ui(()=>{var F;return ce("form",{ref:E,class:"v-form",novalidate:!0,onReset:P,onSubmit:i},[(F=d.default)==null?void 0:F.call(d,b)])}),ah(b,E)}});const nD=$i({name:"VContainer",props:{fluid:{type:Boolean,default:!1},...lr()},setup(e,l){let{slots:d}=l;return Ui(()=>ce(e.tag,{class:["v-container",{"v-container--fluid":e.fluid}]},d)),{}}}),lb=["sm","md","lg","xl","xxl"],TC=(()=>lb.reduce((e,l)=>(e[l]={type:[Boolean,String,Number],default:!1},e),{}))(),EC=(()=>lb.reduce((e,l)=>(e["offset"+zf(l)]={type:[String,Number],default:null},e),{}))(),SC=(()=>lb.reduce((e,l)=>(e["order"+zf(l)]={type:[String,Number],default:null},e),{}))(),Z2={col:Object.keys(TC),offset:Object.keys(EC),order:Object.keys(SC)};function rD(e,l,d){let g=e;if(!(d==null||d===!1)){if(l){const b=l.replace(e,"");g+=`-${b}`}return e==="col"&&(g="v-"+g),e==="col"&&(d===""||d===!0)||(g+=`-${d}`),g.toLowerCase()}}const oD=["auto","start","end","center","baseline","stretch"],sD=$i({name:"VCol",props:{cols:{type:[Boolean,String,Number],default:!1},...TC,offset:{type:[String,Number],default:null},...EC,order:{type:[String,Number],default:null},...SC,alignSelf:{type:String,default:null,validator:e=>oD.includes(e)},...lr()},setup(e,l){let{slots:d}=l;const g=He(()=>{const b=[];let E;for(E in Z2)Z2[E].forEach(i=>{const F=e[i],j=rD(E,i,F);j&&b.push(j)});const P=b.some(i=>i.startsWith("v-col-"));return b.push({"v-col":!P||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),b});return()=>{var b;return Df(e.tag,{class:g.value},(b=d.default)==null?void 0:b.call(d))}}}),aD=["sm","md","lg","xl","xxl"],cb=["start","end","center"],CC=["space-between","space-around","space-evenly"];function ub(e,l){return aD.reduce((d,g)=>(d[e+zf(g)]=l(),d),{})}const lD=[...cb,"baseline","stretch"],IC=e=>lD.includes(e),AC=ub("align",()=>({type:String,default:null,validator:IC})),cD=[...cb,...CC],MC=e=>cD.includes(e),kC=ub("justify",()=>({type:String,default:null,validator:MC})),uD=[...cb,...CC,"stretch"],PC=e=>uD.includes(e),zC=ub("alignContent",()=>({type:String,default:null,validator:PC})),W2={align:Object.keys(AC),justify:Object.keys(kC),alignContent:Object.keys(zC)},hD={align:"align",justify:"justify",alignContent:"align-content"};function dD(e,l,d){let g=hD[e];if(d!=null){if(l){const b=l.replace(e,"");g+=`-${b}`}return g+=`-${d}`,g.toLowerCase()}}const fD=$i({name:"VRow",props:{dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:IC},...AC,justify:{type:String,default:null,validator:MC},...kC,alignContent:{type:String,default:null,validator:PC},...zC,...lr()},setup(e,l){let{slots:d}=l;const g=He(()=>{const b=[];let E;for(E in W2)W2[E].forEach(P=>{const i=e[P],F=dD(E,P,i);F&&b.push(F)});return b.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),b});return()=>{var b;return Df(e.tag,{class:["v-row",g.value]},(b=d.default)==null?void 0:b.call(d))}}}),pD=yu("flex-grow-1","div","VSpacer"),mD=$i({name:"VHover",props:{disabled:Boolean,modelValue:{type:Boolean,default:void 0},...ZS()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),{runOpenDelay:b,runCloseDelay:E}=WS(e,P=>!e.disabled&&(g.value=P));return()=>{var P;return(P=d.default)==null?void 0:P.call(d,{isHovering:g.value,props:{onMouseenter:b,onMouseleave:E}})}}});const DC=Symbol.for("vuetify:v-item-group"),gD=$i({name:"VItemGroup",props:{...Nm({selectedClass:"v-item--selected"}),...lr(),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{isSelected:b,select:E,next:P,prev:i,selected:F}=Bp(e,DC);return()=>{var j;return ce(e.tag,{class:["v-item-group",g.value]},{default:()=>[(j=d.default)==null?void 0:j.call(d,{isSelected:b,select:E,next:P,prev:i,selected:F.value})]})}}}),_D=es()({name:"VItem",props:Lp(),emits:{"group:selected":e=>!0},setup(e,l){let{slots:d}=l;const{isSelected:g,select:b,toggle:E,selectedClass:P,value:i,disabled:F}=Um(e,DC);return()=>{var j;return(j=d.default)==null?void 0:j.call(d,{isSelected:g.value,selectedClass:P.value,select:b,toggle:E,value:i.value,disabled:F.value})}}});const yD=yu("v-kbd");const vD=$i({name:"VLayout",props:KE(),setup(e,l){let{slots:d}=l;const{layoutClasses:g,layoutStyles:b,getLayoutItem:E,items:P,layoutRef:i}=YE(e);return Ui(()=>{var F;return ce("div",{ref:i,class:g.value,style:b.value},[(F=d.default)==null?void 0:F.call(d)])}),{getLayoutItem:E,items:P}}});const xD=$i({name:"VLayoutItem",props:{position:{type:String,required:!0},size:{type:[Number,String],default:300},modelValue:Boolean,...Om()},setup(e,l){let{slots:d}=l;const{layoutItemStyles:g}=Fm({id:e.name,order:He(()=>parseInt(e.order,10)),position:ki(e,"position"),elementSize:ki(e,"size"),layoutSize:ki(e,"size"),active:ki(e,"modelValue"),absolute:ki(e,"absolute")});return()=>{var b;return ce("div",{class:["v-layout-item"],style:g.value},[(b=d.default)==null?void 0:b.call(d)])}}}),bD=$i({name:"VLazy",directives:{intersect:Dv},props:{modelValue:Boolean,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},...oh(),...lr(),...Tc({transition:"fade-transition"})},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{dimensionStyles:g}=sh(e),b=ar(e,"modelValue");function E(P){b.value||(b.value=P)}return Ui(()=>{var P;return io(ce(e.tag,{class:"v-lazy",style:g.value},{default:()=>[b.value&&ce(Bh,{transition:e.transition},{default:()=>[(P=d.default)==null?void 0:P.call(d)]})]}),[[bc("intersect"),E,e.options]])}),{}}});const wD=$i({name:"VLocaleProvider",props:{locale:String,fallbackLocale:String,messages:Object,rtl:{type:Boolean,default:void 0}},setup(e,l){let{slots:d}=l;const{rtlClasses:g}=s4(e);return Ui(()=>{var b;return ce("div",{class:["v-locale-provider",g.value]},[(b=d.default)==null?void 0:b.call(d)])}),{}}});const TD=$i({name:"VMain",props:{scrollable:Boolean,...lr({tag:"main"})},setup(e,l){let{slots:d}=l;const{mainStyles:g}=jP(),{ssrBootStyles:b}=sb();return Ui(()=>{var E,P;return ce(e.tag,{class:["v-main",{"v-main--scrollable":e.scrollable}],style:[g.value,b.value]},{default:()=>[e.scrollable?ce("div",{class:"v-main__scroller"},[(E=d.default)==null?void 0:E.call(d)]):(P=d.default)==null?void 0:P.call(d)]})}),{}}});function ED(e){let{rootEl:l,isSticky:d,layoutItemStyles:g}=e;const b=oi(!1),E=oi(0),P=He(()=>{const j=typeof b.value=="boolean"?"top":b.value;return[d.value?{top:"auto",bottom:"auto",height:void 0}:void 0,b.value?{[j]:pn(E.value)}:{top:g.value.top}]});Wl(()=>{Mn(d,j=>{j?window.addEventListener("scroll",F,{passive:!0}):window.removeEventListener("scroll",F)},{immediate:!0})}),Xl(()=>{document.removeEventListener("scroll",F)});let i=0;function F(){var me;const j=i>window.scrollY?"up":"down",K=l.value.getBoundingClientRect(),Y=parseFloat((me=g.value.top)!=null?me:0),q=window.scrollY-Math.max(0,E.value-Y),re=K.height+Math.max(E.value,Y)-window.scrollY-window.innerHeight;K.height<window.innerHeight-Y?(b.value="top",E.value=Y):j==="up"&&b.value==="bottom"||j==="down"&&b.value==="top"?(E.value=window.scrollY+K.top,b.value=!0):j==="down"&&re<=0?(E.value=0,b.value="bottom"):j==="up"&&q<=0&&(E.value=K.top+q,b.value="top"),i=window.scrollY}return{isStuck:b,stickyStyles:P}}const SD=100,CD=20;function X2(e){const l=1.41421356237;return(e<0?-1:1)*Math.sqrt(Math.abs(e))*l}function H2(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let l=0;for(let d=e.length-1;d>0;d--){if(e[d].t===e[d-1].t)continue;const g=X2(l),b=(e[d].d-e[d-1].d)/(e[d].t-e[d-1].t);l+=(b-g)*Math.abs(b),d===e.length-1&&(l*=.5)}return X2(l)*1e3}function ID(){const e={};function l(b){Array.from(b.changedTouches).forEach(E=>{var i;((i=e[E.identifier])!=null?i:e[E.identifier]=new mP(CD)).push([b.timeStamp,E])})}function d(b){Array.from(b.changedTouches).forEach(E=>{delete e[E.identifier]})}function g(b){var E;const P=(E=e[b])==null?void 0:E.values().reverse();if(!P)throw new Error(`No samples for touch id ${b}`);const i=P[0],F=[],j=[];for(const K of P){if(i[0]-K[0]>SD)break;F.push({t:K[0],d:K[1].clientX}),j.push({t:K[0],d:K[1].clientY})}return{x:H2(F),y:H2(j),get direction(){const{x:K,y:Y}=this,[q,re]=[Math.abs(K),Math.abs(Y)];return q>re&&K>=0?"right":q>re&&K<=0?"left":re>q&&Y>=0?"down":re>q&&Y<=0?"up":AD()}}}return{addMovement:l,endTouch:d,getVelocity:g}}function AD(){throw new Error}function MD(e){let{isActive:l,isTemporary:d,width:g,touchless:b,position:E}=e;Wl(()=>{window.addEventListener("touchstart",$e,{passive:!0}),window.addEventListener("touchmove",tt,{passive:!1}),window.addEventListener("touchend",Ae,{passive:!0})}),Xl(()=>{window.removeEventListener("touchstart",$e),window.removeEventListener("touchmove",tt),window.removeEventListener("touchend",Ae)});const P=He(()=>E.value!=="bottom"),{addMovement:i,endTouch:F,getVelocity:j}=ID();let K=!1;const Y=oi(!1),q=oi(0),re=oi(0);let me;function we(Me,Ye){return(E.value==="left"?Me:E.value==="right"?document.documentElement.clientWidth-Me:E.value==="bottom"?document.documentElement.clientHeight-Me:xm())-(Ye?g.value:0)}function je(Me){let Ye=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const Ze=E.value==="left"?(Me-re.value)/g.value:E.value==="right"?(document.documentElement.clientWidth-Me-re.value)/g.value:E.value==="bottom"?(document.documentElement.clientHeight-Me-re.value)/g.value:xm();return Ye?Math.max(0,Math.min(1,Ze)):Ze}function $e(Me){if(b.value)return;const Ye=Me.changedTouches[0].clientX,Ze=Me.changedTouches[0].clientY,rt=25,gt=E.value==="left"?Ye<rt:E.value==="right"?Ye>document.documentElement.clientWidth-rt:E.value==="bottom"?Ze>document.documentElement.clientHeight-rt:xm(),vt=l.value&&(E.value==="left"?Ye<g.value:E.value==="right"?Ye>document.documentElement.clientWidth-g.value:E.value==="bottom"?Ze>document.documentElement.clientHeight-g.value:xm());(gt||vt||l.value&&d.value)&&(K=!0,me=[Ye,Ze],re.value=we(P.value?Ye:Ze,l.value),q.value=je(P.value?Ye:Ze),F(Me),i(Me))}function tt(Me){const Ye=Me.changedTouches[0].clientX,Ze=Me.changedTouches[0].clientY;if(K){if(!Me.cancelable){K=!1;return}const gt=Math.abs(Ye-me[0]),vt=Math.abs(Ze-me[1]);(P.value?gt>vt&&gt>3:vt>gt&&vt>3)?(Y.value=!0,K=!1):(P.value?vt:gt)>3&&(K=!1)}if(!Y.value)return;Me.preventDefault(),i(Me);const rt=je(P.value?Ye:Ze,!1);q.value=Math.max(0,Math.min(1,rt)),rt>1?re.value=we(P.value?Ye:Ze,!0):rt<0&&(re.value=we(P.value?Ye:Ze,!1))}function Ae(Me){if(K=!1,!Y.value)return;i(Me),Y.value=!1;const Ye=j(Me.changedTouches[0].identifier),Ze=Math.abs(Ye.x),rt=Math.abs(Ye.y);(P.value?Ze>rt&&Ze>400:rt>Ze&&rt>3)?l.value=Ye.direction===({left:"right",right:"left",bottom:"up"}[E.value]||xm()):l.value=q.value>.5}const mt=He(()=>Y.value?{transform:E.value==="left"?`translateX(calc(-100% + ${q.value*g.value}px))`:E.value==="right"?`translateX(calc(100% - ${q.value*g.value}px))`:E.value==="bottom"?`translateY(calc(100% - ${q.value*g.value}px))`:xm(),transition:"none"}:void 0);return{isDragging:Y,dragProgress:q,dragStyles:mt}}function xm(){throw new Error}const kD=["start","end","left","right","bottom"],PD=$i({name:"VNavigationDrawer",props:{color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:Boolean,railWidth:{type:[Number,String],default:56},scrim:{type:[String,Boolean],default:!0},image:String,temporary:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>kD.includes(e)},sticky:Boolean,...Ec(),...Ns(),...Om(),...ts(),...lr({tag:"nav"}),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const{isRtl:b}=zd(),{themeClasses:E}=To(e),{borderClasses:P}=vu(e),{backgroundColorClasses:i,backgroundColorStyles:F}=vs(ki(e,"color")),{elevationClasses:j}=Da(e),{mobile:K}=Gv(),{roundedClasses:Y}=xs(e),q=xS(),re=ar(e,"modelValue",null,zt=>!!zt),{ssrBootStyles:me}=sb(),we=oi(),je=oi(!1),$e=He(()=>e.rail&&e.expandOnHover&&je.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),tt=He(()=>Rx(e.location,b.value)),Ae=He(()=>!e.permanent&&(K.value||e.temporary)),mt=He(()=>e.sticky&&!Ae.value&&tt.value!=="bottom");e.disableResizeWatcher||Mn(Ae,zt=>!e.permanent&&(re.value=!zt)),!e.disableRouteWatcher&&q&&Mn(q.currentRoute,()=>Ae.value&&(re.value=!1)),Mn(()=>e.permanent,zt=>{zt&&(re.value=!0)}),Cv(()=>{e.modelValue!=null||Ae.value||(re.value=e.permanent||!K.value)});const{isDragging:Me,dragProgress:Ye,dragStyles:Ze}=MD({isActive:re,isTemporary:Ae,width:$e,touchless:ki(e,"touchless"),position:tt}),rt=He(()=>{const zt=Ae.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):$e.value;return Me.value?zt*Ye.value:zt}),{layoutItemStyles:gt,layoutRect:vt,layoutItemScrimStyles:Ut}=Fm({id:e.name,order:He(()=>parseInt(e.order,10)),position:tt,layoutSize:rt,elementSize:$e,active:He(()=>re.value||Me.value),disableTransitions:He(()=>Me.value),absolute:He(()=>e.absolute||mt.value&&typeof At.value!="string")}),{isStuck:At,stickyStyles:ti}=ED({rootEl:we,isSticky:mt,layoutItemStyles:gt}),Nt=vs(He(()=>typeof e.scrim=="string"?e.scrim:null)),Wt=He(()=>({...Me.value?{opacity:Ye.value*.2,transition:"none"}:void 0,...vt.value?{left:pn(vt.value.left),right:pn(vt.value.right),top:pn(vt.value.top),bottom:pn(vt.value.bottom)}:void 0,...Ut.value}));return Vs({VList:{bgColor:"transparent"}}),Ui(()=>{var zt,Yt,vi,cn;const di=g.image||e.image;return ce(Tr,null,[ce(e.tag,zn({ref:we,onMouseenter:()=>je.value=!0,onMouseleave:()=>je.value=!1,class:["v-navigation-drawer",`v-navigation-drawer--${tt.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":je.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":Ae.value,"v-navigation-drawer--active":re.value,"v-navigation-drawer--sticky":mt.value},E.value,i.value,P.value,j.value,Y.value],style:[F.value,gt.value,Ze.value,me.value,ti.value]},d),{default:()=>[di&&ce("div",{key:"image",class:"v-navigation-drawer__img"},[g.image?(zt=g.image)==null?void 0:zt.call(g,{image:e.image}):ce("img",{src:e.image,alt:""},null)]),g.prepend&&ce("div",{class:"v-navigation-drawer__prepend"},[(Yt=g.prepend)==null?void 0:Yt.call(g)]),ce("div",{class:"v-navigation-drawer__content"},[(vi=g.default)==null?void 0:vi.call(g)]),g.append&&ce("div",{class:"v-navigation-drawer__append"},[(cn=g.append)==null?void 0:cn.call(g)])]}),ce(Rh,{name:"fade-transition"},{default:()=>[Ae.value&&(Me.value||re.value)&&!!e.scrim&&ce("div",{class:["v-navigation-drawer__scrim",Nt.backgroundColorClasses.value],style:[Wt.value,Nt.backgroundColorStyles.value],onClick:()=>re.value=!1},null)]})])}),{isStuck:At}}});function zD(e){var l,d,g;if(!Jo)return;const b=za("useHydration"),E=b==null||(l=b.root)==null||(d=l.appContext)==null||(g=d.app)==null?void 0:g._container;return E!=null&&E.__vue_app__?e():Wl(e)}const DD=$i({name:"VNoSsr",setup(e,l){let{slots:d}=l;const g=oi(!1);return zD(()=>g.value=!0),()=>{var b;return g.value&&((b=d.default)==null?void 0:b.call(d))}}});function LD(){const e=oi([]);aE(()=>e.value=[]);function l(d,g){e.value[g]=d}return{refs:e,updateRef:l}}const BD=$i({name:"VPagination",props:{activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:Yn,default:"$first"},prevIcon:{type:Yn,default:"$prev"},nextIcon:{type:Yn,default:"$next"},lastIcon:{type:Yn,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...Ec(),...oa(),...Ns(),...ts(),...Dd(),...lr({tag:"nav"}),...Ur(),...xu({variant:"text"})},emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,l){let{slots:d,emit:g}=l;const b=ar(e,"modelValue"),{t:E,n:P}=rh(),{isRtl:i}=zd(),{themeClasses:F}=To(e),j=oi(-1);Vs(void 0,{scoped:!0});const{resizeRef:K}=Ip(Ye=>{if(!Ye.length)return;const{target:Ze,contentRect:rt}=Ye[0],gt=Ze.querySelector(".v-pagination__list > *");if(!gt)return;const vt=rt.width,Ut=gt.offsetWidth+parseFloat(getComputedStyle(gt).marginRight)*2,At=e.showFirstLastPage?5:3;j.value=Math.max(0,Math.floor(+((vt-Ut*At)/Ut).toFixed(2)))}),Y=He(()=>parseInt(e.length,10)),q=He(()=>parseInt(e.start,10)),re=He(()=>e.totalVisible?parseInt(e.totalVisible,10):j.value>=0?j.value:Y.value),me=He(()=>{if(Y.value<=0||isNaN(Y.value)||Y.value>Number.MAX_SAFE_INTEGER)return[];if(re.value<=1)return[b.value];if(Y.value<=re.value)return vp(Y.value,q.value);const Ye=re.value%2===0,Ze=Ye?re.value/2:Math.floor(re.value/2),rt=Ye?Ze:Ze+1,gt=Y.value-Ze;if(rt-b.value>=0)return[...vp(Math.max(1,re.value-1),q.value),e.ellipsis,Y.value];if(b.value-gt>=(Ye?1:0)){const vt=re.value-1,Ut=Y.value-vt+q.value;return[q.value,e.ellipsis,...vp(vt,Ut)]}else{const vt=Math.max(1,re.value-3),Ut=vt===1?b.value:b.value-Math.ceil(vt/2)+q.value;return[q.value,e.ellipsis,...vp(vt,Ut),e.ellipsis,Y.value]}});function we(Ye,Ze,rt){Ye.preventDefault(),b.value=Ze,rt&&g(rt,Ze)}const{refs:je,updateRef:$e}=LD();Vs({VPaginationBtn:{color:ki(e,"color"),border:ki(e,"border"),density:ki(e,"density"),size:ki(e,"size"),variant:ki(e,"variant"),rounded:ki(e,"rounded"),elevation:ki(e,"elevation")}});const tt=He(()=>me.value.map((Ye,Ze)=>{const rt=gt=>$e(gt,Ze);if(typeof Ye=="string")return{isActive:!1,key:`ellipsis-${Ze}`,page:Ye,props:{ref:rt,ellipsis:!0,icon:!0,disabled:!0}};{const gt=Ye===b.value;return{isActive:gt,key:Ye,page:P(Ye),props:{ref:rt,ellipsis:!1,icon:!0,disabled:!!e.disabled||e.length<2,color:gt?e.activeColor:e.color,ariaCurrent:gt,ariaLabel:E(gt?e.currentPageAriaLabel:e.pageAriaLabel,Ze+1),onClick:vt=>we(vt,Ye)}}}})),Ae=He(()=>{const Ye=!!e.disabled||b.value<=q.value,Ze=!!e.disabled||b.value>=q.value+Y.value-1;return{first:e.showFirstLastPage?{icon:i.value?e.lastIcon:e.firstIcon,onClick:rt=>we(rt,q.value,"first"),disabled:Ye,ariaLabel:E(e.firstAriaLabel),ariaDisabled:Ye}:void 0,prev:{icon:i.value?e.nextIcon:e.prevIcon,onClick:rt=>we(rt,b.value-1,"prev"),disabled:Ye,ariaLabel:E(e.previousAriaLabel),ariaDisabled:Ye},next:{icon:i.value?e.prevIcon:e.nextIcon,onClick:rt=>we(rt,b.value+1,"next"),disabled:Ze,ariaLabel:E(e.nextAriaLabel),ariaDisabled:Ze},last:e.showFirstLastPage?{icon:i.value?e.firstIcon:e.lastIcon,onClick:rt=>we(rt,q.value+Y.value-1,"last"),disabled:Ze,ariaLabel:E(e.lastAriaLabel),ariaDisabled:Ze}:void 0}});function mt(){var Ye;const Ze=b.value-q.value;(Ye=je.value[Ze])==null||Ye.$el.focus()}function Me(Ye){Ye.key===Lx.left&&!e.disabled&&b.value>e.start?(b.value=b.value-1,ys(mt)):Ye.key===Lx.right&&!e.disabled&&b.value<q.value+Y.value-1&&(b.value=b.value+1,ys(mt))}return Ui(()=>ce(e.tag,{ref:K,class:["v-pagination",F.value],role:"navigation","aria-label":E(e.ariaLabel),onKeydown:Me,"data-test":"v-pagination-root"},{default:()=>[ce("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&ce("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[d.first?d.first(Ae.value.first):ce(ql,zn({_as:"VPaginationBtn"},Ae.value.first),null)]),ce("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[d.prev?d.prev(Ae.value.prev):ce(ql,zn({_as:"VPaginationBtn"},Ae.value.prev),null)]),tt.value.map((Ye,Ze)=>ce("li",{key:Ye.key,class:["v-pagination__item",{"v-pagination__item--is-active":Ye.isActive}],"data-test":"v-pagination-item"},[d.item?d.item(Ye):ce(ql,zn({_as:"VPaginationBtn"},Ye.props),{default:()=>[Ye.page]})])),ce("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[d.next?d.next(Ae.value.next):ce(ql,zn({_as:"VPaginationBtn"},Ae.value.next),null)]),e.showFirstLastPage&&ce("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[d.last?d.last(Ae.value.last):ce(ql,zn({_as:"VPaginationBtn"},Ae.value.last),null)])])]})),{}}});function RD(e){return Math.floor(Math.abs(e))*Math.sign(e)}const OD=$i({name:"VParallax",props:{scale:{type:[Number,String],default:.5}},setup(e,l){let{slots:d}=l;const{intersectionRef:g,isIntersecting:b}=Z1(),{resizeRef:E,contentRect:P}=Ip(),{height:i}=Gv(),F=oi();Oh(()=>{var re;g.value=E.value=(re=F.value)==null?void 0:re.$el});let j;Mn(b,re=>{re?(j=XE(g.value),j=j===document.scrollingElement?document:j,j.addEventListener("scroll",q,{passive:!0}),q()):j.removeEventListener("scroll",q)}),Xl(()=>{var re;(re=j)==null||re.removeEventListener("scroll",q)}),Mn(i,q),Mn(()=>{var re;return(re=P.value)==null?void 0:re.height},q);const K=He(()=>1-du(+e.scale));let Y=-1;function q(){!b.value||(cancelAnimationFrame(Y),Y=requestAnimationFrame(()=>{var Ye,Ze;var re;const me=((re=F.value)==null?void 0:re.$el).querySelector(".v-img__img");if(!me)return;const we=(Ye=j.clientHeight)!=null?Ye:document.documentElement.clientHeight,je=(Ze=j.scrollTop)!=null?Ze:window.scrollY,$e=g.value.offsetTop,tt=P.value.height,Ae=$e+(tt-we)/2,mt=RD((je-Ae)*K.value),Me=Math.max(1,(K.value*(we-tt)+tt)/tt);me.style.setProperty("transform",`translateY(${mt}px) scale(${Me})`)}))}return Ui(()=>ce(Vm,{class:["v-parallax",{"v-parallax--active":b.value}],ref:F,cover:!0,onLoadstart:q,onLoad:q},d)),{}}}),FD=$i({name:"VRadio",props:{...Rv({falseIcon:"$radioOff",trueIcon:"$radioOn"})},setup(e,l){let{slots:d}=l;return Ui(()=>ce(S_,zn(e,{class:"v-radio",type:"radio"}),d)),{}}});const VD=$i({name:"VRadioGroup",inheritAttrs:!1,props:{height:{type:[Number,String],default:"auto"},...Ld(),...FP(Y1(),["multiple"]),trueIcon:{type:Yn,default:"$radioOn"},falseIcon:{type:Yn,default:"$radioOff"},type:{type:String,default:"radio"}},emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const b=Ya(),E=He(()=>e.id||`radio-group-${b}`),P=ar(e,"modelValue");return Ui(()=>{const[i,F]=Pp(d),[j,K]=Lf(e),[Y,q]=MS({...e,multiple:!1}),re=g.label?g.label({label:e.label,props:{for:E.value}}):e.label;return ce(Fh,zn({class:"v-radio-group"},i,j,{modelValue:P.value,"onUpdate:modelValue":me=>P.value=me,id:E.value}),{...g,default:me=>{let{id:we,isDisabled:je,isReadonly:$e}=me;return ce(Tr,null,[re&&ce(Zm,{for:we.value,clickable:!0},{default:()=>[re]}),ce(AS,zn(Y,{id:we.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:je.value,readonly:$e.value},F,{modelValue:P.value,"onUpdate:modelValue":tt=>P.value=tt}),g)])}})}),{}}}),ND=$i({name:"VRangeSlider",props:{...ib(),...Ld(),...gC(),strict:Boolean,modelValue:{type:Array,default:()=>[0,0]}},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=oi(),b=oi(),E=oi();function P(Ze){if(!g.value||!b.value)return;const rt=Yx(Ze,g.value.$el,e.direction),gt=Yx(Ze,b.value.$el,e.direction),vt=Math.abs(rt),Ut=Math.abs(gt);return vt<Ut||vt===Ut&&rt<0?g.value.$el:b.value.$el}const{activeThumbRef:i,hasLabels:F,max:j,min:K,mousePressed:Y,onSliderMousedown:q,onSliderTouchstart:re,position:me,roundValue:we,trackContainerRef:je}=_C({props:e,handleSliderMouseUp:Ze=>{var rt;$e.value=i.value===((rt=g.value)==null?void 0:rt.$el)?[Ze,$e.value[1]]:[$e.value[0],Ze]},handleMouseMove:Ze=>{var rt;const[gt,vt]=$e.value;if(!e.strict&&gt===vt&&gt!==K.value){var Ut,At,ti;i.value=Ze>gt?(Ut=b.value)==null?void 0:Ut.$el:(At=g.value)==null?void 0:At.$el,(ti=i.value)==null||ti.focus()}i.value===((rt=g.value)==null?void 0:rt.$el)?$e.value=[Math.min(Ze,vt),vt]:$e.value=[gt,Math.max(gt,Ze)]},getActiveThumb:P}),$e=ar(e,"modelValue",void 0,Ze=>!Ze||!Ze.length?[0,0]:Ze.map(rt=>we(rt))),{isFocused:tt,focus:Ae,blur:mt}=nb(e),Me=He(()=>me($e.value[0])),Ye=He(()=>me($e.value[1]));return Ui(()=>{const[Ze,rt]=Lf(e),gt=!!(e.label||d.label||d.prepend);return ce(Fh,zn({class:["v-slider","v-range-slider",{"v-slider--has-labels":!!d["tick-label"]||F.value,"v-slider--focused":tt.value,"v-slider--pressed":Y.value,"v-slider--disabled":e.disabled}],ref:E},Ze,{focused:tt.value}),{...d,prepend:gt?vt=>{var ti;var Ut,At;return ce(Tr,null,[((ti=(Ut=d.label)==null?void 0:Ut.call(d,vt))!=null?ti:e.label)?ce(Zm,{class:"v-slider__label",text:e.label},null):void 0,(At=d.prepend)==null?void 0:At.call(d,vt)])}:void 0,default:vt=>{var Ut,At;let{id:ti}=vt;return ce("div",{class:"v-slider__container",onMousedown:q,onTouchstartPassive:re},[ce("input",{id:`${ti.value}_start`,name:e.name||ti.value,disabled:e.disabled,readonly:e.readonly,tabindex:"-1",value:$e.value[0]},null),ce("input",{id:`${ti.value}_stop`,name:e.name||ti.value,disabled:e.disabled,readonly:e.readonly,tabindex:"-1",value:$e.value[1]},null),ce(yC,{ref:je,start:Me.value,stop:Ye.value},{"tick-label":d["tick-label"]}),ce(Jx,{ref:g,focused:tt&&i.value===((Ut=g.value)==null?void 0:Ut.$el),modelValue:$e.value[0],"onUpdate:modelValue":Nt=>$e.value=[Nt,$e.value[1]],onFocus:Nt=>{var Wt,zt;if(Ae(),i.value=(Wt=g.value)==null?void 0:Wt.$el,$e.value[0]===$e.value[1]&&$e.value[1]===K.value&&Nt.relatedTarget!==((zt=b.value)==null?void 0:zt.$el)){var Yt,vi;(Yt=g.value)==null||Yt.$el.blur(),(vi=b.value)==null||vi.$el.focus()}},onBlur:()=>{mt(),i.value=void 0},min:K.value,max:$e.value[1],position:Me.value},{"thumb-label":d["thumb-label"]}),ce(Jx,{ref:b,focused:tt&&i.value===((At=b.value)==null?void 0:At.$el),modelValue:$e.value[1],"onUpdate:modelValue":Nt=>$e.value=[$e.value[0],Nt],onFocus:Nt=>{var Wt,zt;if(Ae(),i.value=(Wt=b.value)==null?void 0:Wt.$el,$e.value[0]===$e.value[1]&&$e.value[0]===j.value&&Nt.relatedTarget!==((zt=g.value)==null?void 0:zt.$el)){var Yt,vi;(Yt=b.value)==null||Yt.$el.blur(),(vi=g.value)==null||vi.$el.focus()}},onBlur:()=>{mt(),i.value=void 0},min:$e.value[0],max:j.value,position:Ye.value},{"thumb-label":d["thumb-label"]})])}})}),{}}});const UD=es()({name:"VRating",props:{name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:Yn,default:"$ratingEmpty"},fullIcon:{type:Yn,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:Number,default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},ripple:Boolean,...oa(),...Dd(),...lr(),...Ur()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{t:g}=rh(),{themeClasses:b}=To(e),E=ar(e,"modelValue"),P=He(()=>vp(Number(e.length),1)),i=He(()=>P.value.flatMap(Ae=>e.halfIncrements?[Ae-.5,Ae]:[Ae])),F=oi(-1),j=oi(-1),K=oi();let Y=!1;const q=He(()=>i.value.map(Ae=>{var Ut;const mt=e.hover&&F.value>-1,Me=E.value>=Ae,Ye=F.value>=Ae,rt=(mt?Ye:Me)?e.fullIcon:e.emptyIcon,gt=(Ut=e.activeColor)!=null?Ut:e.color,vt=Me||Ye?gt:e.color;return{isFilled:Me,isHovered:Ye,icon:rt,color:vt}})),re=He(()=>[0,...i.value].map(Ae=>{function mt(){F.value=Ae}function Me(){F.value=-1}function Ye(){if(Ae===0&&E.value===0){var gt;(gt=K.value)==null||gt.focus()}else j.value=Ae}function Ze(){Y||(j.value=-1)}function rt(){e.disabled||e.readonly||(E.value=E.value===Ae&&e.clearable?0:Ae)}return{onMouseenter:e.hover?mt:void 0,onMouseleave:e.hover?Me:void 0,onFocus:Ye,onBlur:Ze,onClick:rt}}));function me(){Y=!0}function we(){Y=!1}const je=He(()=>{var Ae;return(Ae=e.name)!=null?Ae:`v-rating-${Ya()}`});function $e(Ae){var mt,Me;let{value:Ye,index:Ze,showStar:rt=!0}=Ae;const{onMouseenter:gt,onMouseleave:vt,onFocus:Ut,onBlur:At,onClick:ti}=re.value[Ze+1],Nt=`${je.value}-${String(Ye).replace(".","-")}`,Wt={color:(mt=q.value[Ze])==null?void 0:mt.color,density:e.density,disabled:e.disabled,icon:(Me=q.value[Ze])==null?void 0:Me.icon,ripple:e.ripple,size:e.size,tag:"span",variant:"plain"};return ce(Tr,null,[ce("label",{for:Nt,class:{"v-rating__item--half":e.halfIncrements&&Ye%1>0,"v-rating__item--full":e.halfIncrements&&Ye%1===0},onMousedown:me,onMouseup:we,onMouseenter:gt,onMouseleave:vt},[ce("span",{class:"v-rating__hidden"},[g(e.itemAriaLabel,Ye,e.length)]),rt?d.item?d.item({...q.value[Ze],props:Wt,value:Ye,index:Ze}):ce(ql,Wt,null):void 0]),ce("input",{class:"v-rating__hidden",name:je.value,id:Nt,type:"radio",value:Ye,checked:E.value===Ye,onClick:ti,onFocus:Ut,onBlur:At,ref:Ze===0?K:void 0,readonly:e.readonly,disabled:e.disabled},null)])}function tt(Ae){return d["item-label"]?d["item-label"](Ae):Ae.label?ce("span",null,[Ae.label]):ce("span",null,[Yo("\xA0")])}return Ui(()=>{var Ae;const mt=!!((Ae=e.itemLabels)!=null&&Ae.length)||d["item-label"];return ce(e.tag,{class:["v-rating",{"v-rating--hover":e.hover,"v-rating--readonly":e.readonly},b.value]},{default:()=>[ce($e,{value:0,index:-1,showStar:!1},null),P.value.map((Me,Ye)=>{var Ze,rt;return ce("div",{class:"v-rating__wrapper"},[mt&&e.itemLabelPosition==="top"?tt({value:Me,index:Ye,label:(Ze=e.itemLabels)==null?void 0:Ze[Ye]}):void 0,ce("div",{class:["v-rating__item",{"v-rating__item--focused":Math.ceil(j.value)===Me}]},[e.halfIncrements?ce(Tr,null,[ce($e,{value:Me-.5,index:Ye*2},null),ce($e,{value:Me,index:Ye*2+1},null)]):ce($e,{value:Me,index:Ye},null)]),mt&&e.itemLabelPosition==="bottom"?tt({value:Me,index:Ye,label:(rt=e.itemLabels)==null?void 0:rt[Ye]}):void 0])})]})}),{}}});function K2(e){const d=Math.abs(e);return Math.sign(e)*(d/((1/.501-2)*(1-d)+1))}function Y2(e){let{selectedElement:l,containerSize:d,contentSize:g,isRtl:b,currentScrollOffset:E,isHorizontal:P}=e;const i=P?l.clientWidth:l.clientHeight,F=P?l.offsetLeft:l.offsetTop,j=b&&P?g-F-i:F,K=d+E,Y=i+j,q=i*.4;return j<=E?E=Math.max(j-q,0):K<=Y&&(E=Math.min(E-(K-Y-q),g-d)),E}function $D(e){let{selectedElement:l,containerSize:d,contentSize:g,isRtl:b,isHorizontal:E}=e;const P=E?l.clientWidth:l.clientHeight,i=E?l.offsetLeft:l.offsetTop,F=b&&E?g-i-P/2-d/2:i+P/2-d/2;return Math.min(g-d,Math.max(0,F))}const LC=Symbol.for("vuetify:v-slide-group"),BC=es()({name:"VSlideGroup",props:{centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:LC},nextIcon:{type:Yn,default:"$next"},prevIcon:{type:Yn,default:"$prev"},showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["always","desktop","mobile"].includes(e)},...lr(),...Nm({selectedClass:"v-slide-group-item--active"})},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const{isRtl:g}=zd(),{mobile:b}=Gv(),E=Bp(e,e.symbol),P=oi(!1),i=oi(0),F=oi(0),j=oi(0),K=He(()=>e.direction==="horizontal"),{resizeRef:Y,contentRect:q}=Ip(),{resizeRef:re,contentRect:me}=Ip(),we=He(()=>E.selected.value.length?E.items.value.findIndex(di=>di.id===E.selected.value[0]):-1),je=He(()=>E.selected.value.length?E.items.value.findIndex(di=>di.id===E.selected.value[E.selected.value.length-1]):-1);if(Jo){let di=-1;Mn(()=>[E.selected.value,q.value,me.value,K.value],()=>{cancelAnimationFrame(di),di=requestAnimationFrame(()=>{if(q.value&&me.value){const un=K.value?"width":"height";F.value=q.value[un],j.value=me.value[un],P.value=F.value+1<j.value}if(we.value>=0&&re.value){const un=re.value.children[je.value];we.value===0||!P.value?i.value=0:e.centerActive?i.value=$D({selectedElement:un,containerSize:F.value,contentSize:j.value,isRtl:g.value,isHorizontal:K.value}):P.value&&(i.value=Y2({selectedElement:un,containerSize:F.value,contentSize:j.value,isRtl:g.value,currentScrollOffset:i.value,isHorizontal:K.value}))}})})}const $e=oi(!1);let tt=0,Ae=0;function mt(di){const un=K.value?"clientX":"clientY";Ae=(g.value&&K.value?-1:1)*i.value,tt=di.touches[0][un],$e.value=!0}function Me(di){if(!P.value)return;const un=K.value?"clientX":"clientY",mn=g.value&&K.value?-1:1;i.value=mn*(Ae+tt-di.touches[0][un])}function Ye(di){const un=j.value-F.value;i.value<0||!P.value?i.value=0:i.value>=un&&(i.value=un),$e.value=!1}function Ze(){!Y.value||(Y.value[K.value?"scrollLeft":"scrollTop"]=0)}const rt=oi(!1);function gt(di){if(rt.value=!0,!(!P.value||!re.value)){for(const un of di.composedPath())for(const mn of re.value.children)if(mn===un){i.value=Y2({selectedElement:mn,containerSize:F.value,contentSize:j.value,isRtl:g.value,currentScrollOffset:i.value,isHorizontal:K.value});return}}}function vt(di){rt.value=!1}function Ut(di){var un;!rt.value&&!(di.relatedTarget&&(un=re.value)!=null&&un.contains(di.relatedTarget))&&ti()}function At(di){!re.value||(K.value?di.key==="ArrowRight"?ti(g.value?"prev":"next"):di.key==="ArrowLeft"&&ti(g.value?"next":"prev"):di.key==="ArrowDown"?ti("next"):di.key==="ArrowUp"&&ti("prev"),di.key==="Home"?ti("first"):di.key==="End"&&ti("last"))}function ti(di){if(!!re.value)if(di){if(di==="next"){var mn;const wn=(mn=re.value.querySelector(":focus"))==null?void 0:mn.nextElementSibling;wn?wn.focus():ti("first")}else if(di==="prev"){var Er;const wn=(Er=re.value.querySelector(":focus"))==null?void 0:Er.previousElementSibling;wn?wn.focus():ti("last")}else if(di==="first"){var Li;(Li=re.value.firstElementChild)==null||Li.focus()}else if(di==="last"){var En;(En=re.value.lastElementChild)==null||En.focus()}}else{var un;re.value.querySelector("[tabindex]"),(un=[...re.value.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')].filter(vr=>!vr.hasAttribute("disabled"))[0])==null||un.focus()}}function Nt(di){const un=i.value+(di==="prev"?-1:1)*F.value;i.value=du(un,0,j.value-F.value)}const Wt=He(()=>{let di=i.value>j.value-F.value?-(j.value-F.value)+K2(j.value-F.value-i.value):-i.value;i.value<=0&&(di=K2(-i.value));const un=g.value&&K.value?-1:1;return{transform:`translate${K.value?"X":"Y"}(${un*di}px)`,transition:$e.value?"none":"",willChange:$e.value?"transform":""}}),zt=He(()=>({next:E.next,prev:E.prev,select:E.select,isSelected:E.isSelected})),Yt=He(()=>{switch(e.showArrows){case"always":return!0;case"desktop":return!b.value;case!0:return P.value||Math.abs(i.value)>0;case"mobile":return b.value||P.value||Math.abs(i.value)>0;default:return!b.value&&(P.value||Math.abs(i.value)>0)}}),vi=He(()=>Math.abs(i.value)>0),cn=He(()=>j.value>Math.abs(i.value)+F.value);return Ui(()=>{var di,un,mn;return ce(e.tag,{class:["v-slide-group",{"v-slide-group--vertical":!K.value,"v-slide-group--has-affixes":Yt.value,"v-slide-group--is-overflowing":P.value}],tabindex:rt.value||E.selected.value.length?-1:0,onFocus:Ut},{default:()=>{var Er,Li;return[Yt.value&&ce("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!vi.value}],onClick:()=>Nt("prev")},[(Er=(di=d.prev)==null?void 0:di.call(d,zt.value))!=null?Er:ce(Vx,null,{default:()=>[ce(As,{icon:g.value?e.nextIcon:e.prevIcon},null)]})]),ce("div",{key:"container",ref:Y,class:"v-slide-group__container",onScroll:Ze},[ce("div",{ref:re,class:"v-slide-group__content",style:Wt.value,onTouchstartPassive:mt,onTouchmovePassive:Me,onTouchendPassive:Ye,onFocusin:gt,onFocusout:vt,onKeydown:At},[(un=d.default)==null?void 0:un.call(d,zt.value)])]),Yt.value&&ce("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!cn.value}],onClick:()=>Nt("next")},[(Li=(mn=d.next)==null?void 0:mn.call(d,zt.value))!=null?Li:ce(Vx,null,{default:()=>[ce(As,{icon:g.value?e.prevIcon:e.nextIcon},null)]})])]}})}),{selected:E.selected,scrollTo:Nt,scrollOffset:i,focus:ti}}}),jD=es()({name:"VSlideGroupItem",props:{...Lp()},emits:{"group:selected":e=>!0},setup(e,l){let{slots:d}=l;const g=Um(e,LC);return()=>{var b;return(b=d.default)==null?void 0:b.call(d,{isSelected:g.isSelected.value,select:g.select,toggle:g.toggle,selectedClass:g.selectedClass.value})}}});const GD=es()({name:"VSnackbar",props:{contentClass:{type:String,default:""},multiLine:Boolean,timeout:{type:[Number,String],default:5e3},vertical:Boolean,modelValue:Boolean,...Op({location:"bottom"}),...jm(),...ts(),...xu(),...Tc({transition:"v-snackbar-transition"})},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),{locationStyles:b}=Fp(e),{positionClasses:E}=Gm(e),{scopeId:P}=Vv(),{colorClasses:i,colorStyles:F,variantClasses:j}=Dp(e),{roundedClasses:K}=xs(e),Y=oi();Mn(g,re),Mn(()=>e.timeout,re),Wl(()=>{g.value&&re()});let q=-1;function re(){window.clearTimeout(q);const we=Number(e.timeout);!g.value||we===-1||(q=window.setTimeout(()=>{g.value=!1},we))}function me(){window.clearTimeout(q)}return Ui(()=>ce(I_,zn({modelValue:g.value,"onUpdate:modelValue":we=>g.value=we,ref:Y,class:["v-snackbar",{"v-snackbar--active":g.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--vertical":e.vertical},E.value],contentProps:{style:b.value},contentClass:e.contentClass,persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",transition:e.transition},P),{default:()=>[ce("div",{class:["v-snackbar__wrapper",i.value,K.value,j.value],style:[F.value],onPointerenter:me,onPointerleave:re},[zp(!1,"v-snackbar"),d.default&&ce("div",{class:"v-snackbar__content",role:"status","aria-live":"polite"},[d.default()]),d.actions&&ce(Go,{defaults:{VBtn:{variant:"text",ripple:!1}}},{default:()=>[ce("div",{class:"v-snackbar__actions"},[d.actions()])]})])],activator:d.activator})),ah({},Y)}});const qD=$i({name:"VSwitch",inheritAttrs:!1,props:{indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...Ld(),...Rv()},emits:{"update:modelValue":()=>!0,"update:indeterminate":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const b=ar(e,"indeterminate"),E=ar(e,"modelValue"),{loaderClasses:P}=Bv(e),i=He(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),F=Ya(),j=He(()=>e.id||`switch-${F}`);function K(){b.value&&(b.value=!1)}return Ui(()=>{const[Y,q]=Pp(d),[re,me]=Lf(e),[we,je]=MS(e),$e=oi();function tt(){var Ae,mt;(Ae=$e.value)==null||(mt=Ae.input)==null||mt.click()}return ce(Fh,zn({class:["v-switch",{"v-switch--inset":e.inset},{"v-switch--indeterminate":b.value},P.value]},Y,re,{id:j.value}),{...g,default:Ae=>{let{id:mt,isDisabled:Me,isReadonly:Ye,isValid:Ze}=Ae;return ce(S_,zn({ref:$e},we,{modelValue:E.value,"onUpdate:modelValue":[rt=>E.value=rt,K],id:mt.value,type:"checkbox","aria-checked":b.value?"mixed":void 0,disabled:Me.value,readonly:Ye.value},q),{...g,default:()=>ce("div",{class:"v-switch__track",onClick:tt},null),input:rt=>{let{textColorClasses:gt,textColorStyles:vt}=rt;return ce("div",{class:["v-switch__thumb",gt.value],style:vt.value},[e.loading&&ce(K1,{name:"v-switch",active:!0,color:Ze.value===!1?void 0:i.value},{default:Ut=>g.loader?g.loader(Ut):ce(W1,{active:Ut.isActive,color:Ut.color,indeterminate:!0,size:"16",width:"2"},null)})])}})}})}),{}}});const ZD=$i({name:"VSystemBar",props:{color:String,height:[Number,String],window:Boolean,...Ns(),...Om(),...ts(),...lr(),...Ur()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{backgroundColorClasses:b,backgroundColorStyles:E}=vs(ki(e,"color")),{elevationClasses:P}=Da(e),{roundedClasses:i}=xs(e),F=He(()=>{var K;return(K=e.height)!=null?K:e.window?32:24}),{layoutItemStyles:j}=Fm({id:e.name,order:He(()=>parseInt(e.order,10)),position:oi("top"),layoutSize:F,elementSize:F,active:He(()=>!0),absolute:ki(e,"absolute")});return Ui(()=>ce(e.tag,{class:["v-system-bar",{"v-system-bar--window":e.window},g.value,b.value,P.value,i.value],style:[E.value,j.value]},d)),{}}});const RC=Symbol.for("vuetify:v-tabs"),OC=$i({name:"VTab",props:{fixed:Boolean,icon:[Boolean,String,Function,Object],prependIcon:Yn,appendIcon:Yn,stacked:Boolean,title:String,ripple:{type:Boolean,default:!0},color:String,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...lr(),...qm(),...Lp({selectedClass:"v-tab--selected"}),...Ur()},setup(e,l){let{slots:d,attrs:g}=l;const{textColorClasses:b,textColorStyles:E}=Zl(e,"sliderColor"),P=He(()=>e.direction==="horizontal"),i=oi(!1),F=oi(),j=oi();function K(Y){let{value:q}=Y;if(i.value=q,q){var re,me;const we=(re=F.value)==null||(me=re.$el.parentElement)==null?void 0:me.querySelector(".v-tab--selected .v-tab__slider"),je=j.value;if(!we||!je)return;const $e=getComputedStyle(we).color,tt=we.getBoundingClientRect(),Ae=je.getBoundingClientRect(),mt=P.value?"x":"y",Me=P.value?"X":"Y",Ye=P.value?"right":"bottom",Ze=P.value?"width":"height",rt=tt[mt],gt=Ae[mt],vt=rt>gt?tt[Ye]-Ae[Ye]:tt[mt]-Ae[mt],Ut=Math.sign(vt)>0?P.value?"right":"bottom":Math.sign(vt)<0?P.value?"left":"top":"center",ti=(Math.abs(vt)+(Math.sign(vt)<0?tt[Ze]:Ae[Ze]))/Math.max(tt[Ze],Ae[Ze]),Nt=tt[Ze]/Ae[Ze],Wt=1.5;xp(je,{backgroundColor:[$e,""],transform:[`translate${Me}(${vt}px) scale${Me}(${Nt})`,`translate${Me}(${vt/Wt}px) scale${Me}(${(ti-1)/Wt+1})`,""],transformOrigin:Array(3).fill(Ut)},{duration:225,easing:p_})}}return Ui(()=>{const[Y]=nh(e,["href","to","replace","icon","stacked","prependIcon","appendIcon","ripple","theme","disabled","selectedClass","value","color"]);return ce(ql,zn({_as:"VTab",symbol:RC,ref:F,class:["v-tab"],tabindex:i.value?0:-1,role:"tab","aria-selected":String(i.value),active:!1,block:e.fixed,maxWidth:e.fixed?300:void 0,variant:"text",rounded:0},Y,g,{"onGroup:selected":K}),{default:()=>[d.default?d.default():e.title,!e.hideSlider&&ce("div",{ref:j,class:["v-tab__slider",b.value],style:E.value},null)]})}),{}}});function WD(e){return e?e.map(l=>typeof l=="string"?{title:l,value:l}:l):[]}const XD=$i({name:"VTabs",props:{alignTabs:{type:String,default:"start"},color:String,direction:{type:String,default:"horizontal"},fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,modelValue:null,mandatory:{type:[Boolean,String],default:"force"},...oa(),...lr()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=ar(e,"modelValue"),b=He(()=>WD(e.items)),{densityClasses:E}=Ja(e),{backgroundColorClasses:P,backgroundColorStyles:i}=vs(ki(e,"bgColor"));return Vs({VTab:{color:ki(e,"color"),direction:ki(e,"direction"),stacked:ki(e,"stacked"),fixed:ki(e,"fixedTabs"),sliderColor:ki(e,"sliderColor"),hideSlider:ki(e,"hideSlider")}}),Ui(()=>ce(BC,{modelValue:g.value,"onUpdate:modelValue":F=>g.value=F,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},E.value,P.value],style:i.value,role:"tablist",symbol:RC,mandatory:e.mandatory,direction:e.direction},{default:()=>[d.default?d.default():b.value.map(F=>ce(OC,zn(F,{key:F.title}),null))]})),{}}});const HD=$i({name:"VTable",props:{fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...oa(),...lr(),...Ur()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{densityClasses:b}=Ja(e);return Ui(()=>{var E,P;return ce(e.tag,{class:["v-table",{"v-table--fixed-height":!!e.height,"v-table--fixed-header":e.fixedHeader,"v-table--fixed-footer":e.fixedFooter,"v-table--has-top":!!d.top,"v-table--has-bottom":!!d.bottom,"v-table--hover":e.hover},g.value,b.value]},{default:()=>[(E=d.top)==null?void 0:E.call(d),d.default&&ce("div",{class:"v-table__wrapper",style:{height:pn(e.height)}},[ce("table",null,[d.default()])]),(P=d.bottom)==null?void 0:P.call(d)]})}),{}}});const KD=$i({name:"VTextarea",directives:{Intersect:Dv},inheritAttrs:!1,props:{autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,hint:String,persistentHint:Boolean,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,...Ld(),...Uv()},emits:{"click:control":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{attrs:d,emit:g,slots:b}=l;const E=ar(e,"modelValue"),P=He(()=>typeof e.counterValue=="function"?e.counterValue(E.value):(E.value||"").toString().length),i=He(()=>{if(d.maxlength)return d.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function F(Ze,rt){var gt,vt;!e.autofocus||!Ze||(gt=rt[0].target)==null||(vt=gt.focus)==null||vt.call(gt)}const j=oi(),K=oi(),Y=oi(!1),q=oi(""),re=oi(),me=He(()=>Y.value||e.persistentPlaceholder),we=He(()=>e.messages.length?e.messages:me.value||e.persistentHint?e.hint:"");function je(){if(re.value!==document.activeElement){var Ze;(Ze=re.value)==null||Ze.focus()}Y.value||(Y.value=!0)}function $e(Ze){je(),g("click:control",Ze)}function tt(Ze){Ze.stopPropagation(),je(),ys(()=>{E.value="",av(e["onClick:clear"],Ze)})}function Ae(Ze){E.value=Ze.target.value}const mt=oi();function Me(){!e.autoGrow||ys(()=>{if(!mt.value||!K.value)return;const Ze=getComputedStyle(mt.value),rt=getComputedStyle(K.value.$el),gt=parseFloat(Ze.getPropertyValue("--v-field-padding-top"))+parseFloat(Ze.getPropertyValue("--v-input-padding-top"))+parseFloat(Ze.getPropertyValue("--v-field-padding-bottom")),vt=mt.value.scrollHeight,Ut=parseFloat(Ze.lineHeight),At=Math.max(parseFloat(e.rows)*Ut+gt,parseFloat(rt.getPropertyValue("--v-input-control-height"))),ti=parseFloat(e.maxRows)*Ut+gt||1/0;q.value=pn(du(vt!=null?vt:0,At,ti))})}Wl(Me),Mn(E,Me),Mn(()=>e.rows,Me),Mn(()=>e.maxRows,Me),Mn(()=>e.density,Me);let Ye;return Mn(mt,Ze=>{if(Ze)Ye=new ResizeObserver(Me),Ye.observe(mt.value);else{var rt;(rt=Ye)==null||rt.disconnect()}}),Xl(()=>{var Ze;(Ze=Ye)==null||Ze.disconnect()}),Ui(()=>{const Ze=!!(b.counter||e.counter||e.counterValue),rt=!!(Ze||b.details),[gt,vt]=Pp(d),[{modelValue:Ut,...At}]=Lf(e),[ti]=rb(e);return ce(Fh,zn({ref:j,modelValue:E.value,"onUpdate:modelValue":Nt=>E.value=Nt,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--flush-details":["plain","underlined"].includes(e.variant)}],"onClick:prepend":e["onClick:prepend"],"onClick:append":e["onClick:append"]},gt,At,{messages:we.value}),{...b,default:Nt=>{let{isDisabled:Wt,isDirty:zt,isReadonly:Yt,isValid:vi}=Nt;return ce(A_,zn({ref:K,style:{"--v-textarea-control-height":q.value},"onClick:control":$e,"onClick:clear":tt,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},ti,{active:me.value||zt.value,dirty:zt.value||e.dirty,focused:Y.value,error:vi.value===!1}),{...b,default:cn=>{let{props:{class:di,...un}}=cn;return ce(Tr,null,[e.prefix&&ce("span",{class:"v-text-field__prefix"},[e.prefix]),io(ce("textarea",zn({ref:re,class:di,value:E.value,onInput:Ae,autofocus:e.autofocus,readonly:Yt.value,disabled:Wt.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:je,onBlur:()=>Y.value=!1},un,vt),null),[[bc("intersect"),{handler:F},null,{once:!0}]]),e.autoGrow&&io(ce("textarea",{class:[di,"v-textarea__sizer"],"onUpdate:modelValue":mn=>E.value=mn,ref:mt,readonly:!0,"aria-hidden":"true"},null),[[nP,E.value]]),e.suffix&&ce("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:rt?Nt=>{var Wt;return ce(Tr,null,[(Wt=b.details)==null?void 0:Wt.call(b,Nt),Ze&&ce(Tr,null,[ce("span",null,null),ce($v,{active:e.persistentCounter||Y.value,value:P.value,max:i.value},b.counter)])])}:void 0})}),ah({},j,K,re)}});const YD=$i({name:"VThemeProvider",props:{withBackground:Boolean,...Ur(),...lr()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e);return()=>{var b,E;return e.withBackground?ce(e.tag,{class:["v-theme-provider",g.value]},{default:()=>[(E=d.default)==null?void 0:E.call(d)]}):(b=d.default)==null?void 0:b.call(d)}}});const JD=$i({name:"VTimeline",props:{align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineInset:{type:[String,Number],default:0},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...oa(),...lr(),...Ur()},setup(e,l){let{slots:d}=l;const{themeClasses:g}=To(e),{densityClasses:b}=Ja(e);Vs({VTimelineDivider:{lineColor:ki(e,"lineColor")},VTimelineItem:{density:ki(e,"density"),lineInset:ki(e,"lineInset")}});const E=He(()=>{const i=e.side?e.side:e.density!=="default"?"end":null;return i&&`v-timeline--side-${i}`}),P=He(()=>{const i=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return i;case"start":return i[0];case"end":return i[1];default:return null}});return Ui(()=>ce(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,P.value,{"v-timeline--inset-line":!!e.lineInset},g.value,b.value,E.value],style:{"--v-timeline-line-thickness":pn(e.lineThickness)}},d)),{}}}),QD=$i({name:"VTimelineDivider",props:{dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:Yn,iconColor:String,lineColor:String,...ts(),...Dd(),...Ns()},setup(e,l){let{slots:d}=l;const{sizeClasses:g,sizeStyles:b}=$m(e,"v-timeline-divider__dot"),{backgroundColorStyles:E,backgroundColorClasses:P}=vs(ki(e,"dotColor")),{roundedClasses:i}=xs(e,"v-timeline-divider__dot"),{elevationClasses:F}=Da(e),{backgroundColorClasses:j,backgroundColorStyles:K}=vs(ki(e,"lineColor"));return Vs({VIcon:{color:ki(e,"iconColor"),icon:ki(e,"icon"),size:ki(e,"size")}}),Ui(()=>{var q;var Y;return ce("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot}]},[ce("div",{class:["v-timeline-divider__before",j.value],style:K.value},null),!e.hideDot&&ce("div",{key:"dot",class:["v-timeline-divider__dot",F.value,i.value,g.value],style:b.value},[ce("div",{class:["v-timeline-divider__inner-dot",P.value,i.value],style:E.value},[(q=(Y=d.default)==null?void 0:Y.call(d))!=null?q:e.icon?ce(As,null,null):void 0])]),ce("div",{class:["v-timeline-divider__after",j.value],style:K.value},null)])}),{}}}),eL=$i({name:"VTimelineItem",props:{density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:Yn,iconColor:String,lineInset:[Number,String],...ts(),...Ns(),...Dd(),...lr(),...oh()},setup(e,l){let{slots:d}=l;const{dimensionStyles:g}=sh(e),b=oi(0),E=oi();return Mn(E,P=>{var F;var i;!P||(b.value=(F=(i=P.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:i.getBoundingClientRect().width)!=null?F:0)},{flush:"post"}),Ui(()=>{var P,i;return ce("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot}],style:{"--v-timeline-dot-size":pn(b.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${pn(e.lineInset)})`:pn(0)}},[ce("div",{class:"v-timeline-item__body",style:g.value},[(P=d.default)==null?void 0:P.call(d)]),ce(QD,{ref:E,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:d.icon}),e.density!=="compact"&&ce("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((i=d.opposite)==null?void 0:i.call(d))])])}),{}}});const tL=es()({name:"VTooltip",inheritAttrs:!1,props:{id:String,modelValue:Boolean,text:String,location:{type:String,default:"end"},origin:{type:String,default:"auto"},...Tc({transition:!1})},emits:{"update:modelValue":e=>!0},setup(e,l){let{attrs:d,slots:g}=l;const b=ar(e,"modelValue"),{scopeId:E}=Vv(),P=Ya(),i=He(()=>e.id||`v-tooltip-${P}`),F=oi(),j=He(()=>e.location.split(" ").length>1?e.location:e.location+" center"),K=He(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),Y=He(()=>e.transition?e.transition:b.value?"scale-transition":"fade-transition");return Ui(()=>ce(I_,zn({modelValue:b.value,"onUpdate:modelValue":q=>b.value=q,ref:F,class:["v-tooltip"],id:i.value,transition:Y.value,absolute:!0,locationStrategy:"connected",scrollStrategy:"reposition",location:j.value,origin:K.value,"min-width":0,offset:10,scrim:!1,persistent:!0,"open-on-click":!1,"open-on-hover":!0,"close-on-back":!1,role:"tooltip",eager:!0,activatorProps:{"aria-describedby":i.value}},E,d),{activator:g.activator,default:function(){var je;for(var q,re=arguments.length,me=new Array(re),we=0;we<re;we++)me[we]=arguments[we];return(je=(q=g.default)==null?void 0:q.call(g,...me))!=null?je:e.text}})),ah({},F)}}),iL=$i({name:"VValidation",props:{...ES()},emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:d}=l;const g=SS(e,"validation");return()=>{var b;return(b=d.default)==null?void 0:b.call(d,g)}}}),nL=Object.freeze(Object.defineProperty({__proto__:null,VApp:c4,VAppBar:S4,VAppBarNavIcon:W4,VAppBarTitle:H4,VAlert:Y4,VAlertTitle:bS,VAutocomplete:Xz,VAvatar:Mf,VBadge:Hz,VBanner:Qz,VBannerActions:eC,VBannerText:tC,VBottomNavigation:e3,VBreadcrumbs:t3,VBreadcrumbsItem:nC,VBreadcrumbsDivider:iC,VBtn:ql,VBtnGroup:lS,VBtnToggle:k4,VCard:i3,VCardActions:rC,VCardItem:aC,VCardSubtitle:oC,VCardText:lC,VCardTitle:sC,VCarousel:h3,VCarouselItem:d3,VCheckbox:nz,VCheckboxBtn:Wm,VChip:C_,VChipGroup:oz,VCode:f3,VColorPicker:W3,VCombobox:H3,VCounter:$v,VDefaultsProvider:Go,VDialog:K3,VDivider:zS,VExpansionPanels:J3,VExpansionPanel:Q3,VExpansionPanelText:wC,VExpansionPanelTitle:bC,VField:A_,VFieldLabel:Yg,VFileInput:eD,VFooter:tD,VForm:iD,VContainer:nD,VCol:sD,VRow:fD,VSpacer:pD,VHover:mD,VIcon:As,VComponentIcon:uS,VSvgIcon:hS,VLigatureIcon:D4,VClassIcon:q1,VImg:Vm,VInput:Fh,VItemGroup:gD,VItem:_D,VKbd:yD,VLabel:Zm,VLayout:vD,VLayoutItem:xD,VLazy:bD,VList:Ov,VListGroup:Q1,VListImg:vz,VListItem:Md,VListItemAction:xz,VListItemMedia:bz,VListItemSubtitle:VS,VListItemTitle:NS,VListSubheader:US,VLocaleProvider:wD,VMain:TD,VMenu:Nv,VMessages:wS,VNavigationDrawer:PD,VNoSsr:DD,VOverlay:I_,VPagination:BD,VParallax:OD,VProgressCircular:W1,VProgressLinear:X1,VRadio:FD,VRadioGroup:VD,VRangeSlider:ND,VRating:UD,VResponsive:oS,VSelect:Gz,VSelectionControl:S_,VSelectionControlGroup:AS,VSheet:vC,VSlideGroup:BC,VSlideGroupItem:jD,VSlider:Qx,VSnackbar:GD,VSwitch:qD,VSystemBar:ZD,VTabs:XD,VTab:OC,VTable:HD,VTextarea:KD,VTextField:jv,VThemeProvider:YD,VTimeline:JD,VTimelineItem:eL,VToolbar:fv,VToolbarTitle:dv,VToolbarItems:X4,VTooltip:tL,VValidation:iL,VWindow:dC,VWindowItem:fC,VDialogTransition:Pv,VFabTransition:u4,VDialogBottomTransition:h4,VDialogTopTransition:d4,VFadeTransition:Vx,VScaleTransition:rS,VScrollXTransition:f4,VScrollXReverseTransition:p4,VScrollYTransition:m4,VScrollYReverseTransition:g4,VSlideXTransition:_4,VSlideXReverseTransition:y4,VSlideYTransition:U1,VSlideYReverseTransition:v4,VExpandTransition:zv,VExpandXTransition:$1},Symbol.toStringTag,{value:"Module"}));function FC(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:l,...d}=e,g=Ad(l,d),{aliases:b={},components:E={},directives:P={}}=g,i=OP(g.defaults),F=Jz(g.display,g.ssr),j=QP(g.theme),K=B4(g.icons),Y=o4(g.locale);return{install:re=>{for(const me in P)re.directive(me,P[me]);for(const me in E)re.component(me,E[me]);for(const me in b)re.component(me,$i({...b[me],name:me,aliasName:b[me].name}));if(j.install(re),re.provide(f_,i),re.provide(Xx,F),re.provide(m_,j),re.provide(Nx,K),re.provide(Lm,Y),Jo&&g.ssr){const{mount:me}=re;re.mount=function(){const we=me(...arguments);return ys(()=>F.update()),re.mount=me,we}}Ya.reset(),re.mixin({computed:{$vuetify(){return wl({defaults:Xg.call(this,f_),display:Xg.call(this,Xx),theme:Xg.call(this,m_),icons:Xg.call(this,Nx),locale:Xg.call(this,Lm)})}}})},defaults:i,display:F,theme:j,icons:K,locale:Y}}const rL="3.0.0-beta.15";FC.version=rL;function Xg(e){var E;var l,d;const g=this.$,b=(E=(l=g.parent)==null?void 0:l.provides)!=null?E:(d=g.vnode.appContext)==null?void 0:d.provides;if(b&&e in b)return b[e]}var fu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function oL(e){var l=e.default;if(typeof l=="function"){var d=function(){return l.apply(this,arguments)};d.prototype=l.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(e).forEach(function(g){var b=Object.getOwnPropertyDescriptor(e,g);Object.defineProperty(d,g,b.get?b:{enumerable:!0,get:function(){return e[g]}})}),d}var VC={exports:{}};(function(e,l){(function(d,g){e.exports=g()})(fu,function(){var d,g,b;function E(i,F){if(!d)d=F;else if(!g)g=F;else{var j="var sharedChunk = {}; ("+d+")(sharedChunk); ("+g+")(sharedChunk);",K={};d(K),b=F(K),typeof window<"u"&&(b.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}E(["exports"],function(i){var F=j;function j(c,s,h,v){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(v-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=h,this.p2y=v}function K(c,s,h,v){const I=new F(c,s,h,v);return function(z){return I.solve(z)}}j.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,v=0;v<8;v++){var I=this.sampleCurveX(h)-c;if(Math.abs(I)<s)return h;var z=this.sampleCurveDerivativeX(h);if(Math.abs(z)<1e-6)break;h-=I/z}var B=0,U=1;for(h=c,v=0;v<20&&(I=this.sampleCurveX(h),!(Math.abs(I-c)<s));v++)c>I?B=h:U=h,h=.5*(U-B)+B;return h},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};const Y=K(.25,.1,.25,1);function q(c,s,h){return Math.min(h,Math.max(s,c))}function re(c,s,h){const v=h-s,I=((c-s)%v+v)%v+s;return I===s?h:I}function me(c,...s){for(const h of s)for(const v in h)c[v]=h[v];return c}let we=1;function je(c,s){c.forEach(h=>{s[h]&&(s[h]=s[h].bind(s))})}function $e(c,s,h){const v={};for(const I in c)v[I]=s.call(h||this,c[I],I,c);return v}function tt(c,s,h){const v={};for(const I in c)s.call(h||this,c[I],I,c)&&(v[I]=c[I]);return v}function Ae(c){return Array.isArray(c)?c.map(Ae):typeof c=="object"&&c?$e(c,Ae):c}const mt={};function Me(c){mt[c]||(typeof console<"u"&&console.warn(c),mt[c]=!0)}function Ye(c,s,h){return(h.y-c.y)*(s.x-c.x)>(s.y-c.y)*(h.x-c.x)}function Ze(c){let s=0;for(let h,v,I=0,z=c.length,B=z-1;I<z;B=I++)h=c[I],v=c[B],s+=(v.x-h.x)*(h.y+v.y);return s}function rt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gt(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,v,I,z)=>{const B=I||z;return s[v]=!B||B.toLowerCase(),""}),s["max-age"]){const h=parseInt(s["max-age"],10);isNaN(h)?delete s["max-age"]:s["max-age"]=h}return s}let vt,Ut,At=null;function ti(c){if(At==null){const s=c.navigator?c.navigator.userAgent:null;At=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return At}function Nt(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Wt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){const h=window.document.createElement("canvas"),v=h.getContext("2d");if(!v)throw new Error("failed to create canvas 2d context");return h.width=c.width,h.height=c.height,v.drawImage(c,0,0,c.width,c.height),v.getImageData(-s,-s,c.width+2*s,c.height+2*s)},resolveURL:c=>(vt||(vt=document.createElement("a")),vt.href=c,vt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ut==null&&(Ut=matchMedia("(prefers-reduced-motion: reduce)")),Ut.matches)}};var zt=Yt;function Yt(c,s){this.x=c,this.y=s}Yt.prototype={clone:function(){return new Yt(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,h=c.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),h=Math.sin(c),v=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=v,this},_rotateAround:function(c,s){var h=Math.cos(c),v=Math.sin(c),I=s.y+v*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-v*(this.y-s.y),this.y=I,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Yt.convert=function(c){return c instanceof Yt?c:Array.isArray(c)?new Yt(c[0],c[1]):c};const vi={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},cn="mapbox-tiles";let di,un,mn=500,Er=50;function Li(){typeof caches>"u"||di||(di=caches.open(cn))}let En=1/0;const wn={supported:!1,testSupport:function(c){!Xr&&Fo&&(uo?ks(c):vr=c)}};let vr,Fo,Xr=!1,uo=!1;function ks(c){const s=c.createTexture();c.bindTexture(c.TEXTURE_2D,s);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Fo),c.isContextLost())return;wn.supported=!0}catch{}c.deleteTexture(s),Xr=!0}typeof document<"u"&&(Fo=document.createElement("img"),Fo.onload=function(){vr&&ks(vr),vr=null,uo=!0},Fo.onerror=function(){Xr=!0,vr=null},Fo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const at={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(at);class bt extends Error{constructor(s,h,v,I){super(`AJAXError: ${h} (${s}): ${v}`),this.status=s,this.statusText=h,this.url=v,this.body=I}}const Ft=rt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function fi(c,s){const h=new AbortController,v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ft(),signal:h.signal});let I=!1,z=!1;return c.type==="json"&&v.headers.set("Accept","application/json"),((B,U,Z)=>{if(z)return;const ne=Date.now();fetch(v).then(de=>de.ok?((_e,be,Ce)=>{(c.type==="arrayBuffer"?_e.arrayBuffer():c.type==="json"?_e.json():_e.text()).then(Ie=>{z||(be&&Ce&&function(dt,st,Pt){if(Li(),!di)return;const Xt={status:st.status,statusText:st.statusText,headers:new Headers};st.headers.forEach((jt,hi)=>Xt.headers.set(hi,jt));const Ct=gt(st.headers.get("Cache-Control")||"");Ct["no-store"]||(Ct["max-age"]&&Xt.headers.set("Expires",new Date(Pt+1e3*Ct["max-age"]).toUTCString()),new Date(Xt.headers.get("Expires")).getTime()-Pt<42e4||function(jt,hi){if(un===void 0)try{new Response(new ReadableStream),un=!0}catch{un=!1}un?hi(jt.body):jt.blob().then(hi)}(st,jt=>{const hi=new Response(jt,Xt);Li(),di&&di.then(li=>li.put(function(nn){const Wi=nn.indexOf("?");return Wi<0?nn:nn.slice(0,Wi)}(dt.url),hi)).catch(li=>Me(li.message))}))}(v,be,Ce),I=!0,s(null,Ie,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(Ie=>{z||s(new Error(Ie.message))})})(de,null,ne):de.blob().then(_e=>s(new bt(de.status,de.statusText,c.url,_e)))).catch(de=>{de.code!==20&&s(new Error(de.message))})})(),{cancel:()=>{z=!0,I||h.abort()}}}const gi=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s);if(!rt()){const v=c.url.substring(0,c.url.indexOf("://"));return(vi.REGISTERED_PROTOCOLS[v]||fi)(c,s)}}if(!(/^file:/.test(h=c.url)||/^file:/.test(Ft())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return fi(c,s);if(rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var h;return function(v,I){const z=new XMLHttpRequest;z.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(z.responseType="arraybuffer");for(const B in v.headers)z.setRequestHeader(B,v.headers[B]);return v.type==="json"&&(z.responseType="text",z.setRequestHeader("Accept","application/json")),z.withCredentials=v.credentials==="include",z.onerror=()=>{I(new Error(z.statusText))},z.onload=()=>{if((z.status>=200&&z.status<300||z.status===0)&&z.response!==null){let B=z.response;if(v.type==="json")try{B=JSON.parse(z.response)}catch(U){return I(U)}I(null,B,z.getResponseHeader("Cache-Control"),z.getResponseHeader("Expires"))}else{const B=new Blob([z.response],{type:z.getResponseHeader("Content-Type")});I(new bt(z.status,z.statusText,v.url,B))}},z.send(v.body),{cancel:()=>z.abort()}}(c,s)},Mi=function(c,s){return gi(me(c,{type:"arrayBuffer"}),s)};function Ki(c){const s=window.document.createElement("a");return s.href=c,s.protocol===window.document.location.protocol&&s.host===window.document.location.host}const ci="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pi,Si;Pi=[],Si=0;const tn=function(c,s){if(wn.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Si>=vi.MAX_PARALLEL_IMAGE_REQUESTS){const z={requestParameters:c,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return Pi.push(z),z}Si++;let h=!1;const v=()=>{if(!h)for(h=!0,Si--;Pi.length&&Si<vi.MAX_PARALLEL_IMAGE_REQUESTS;){const z=Pi.shift(),{requestParameters:B,callback:U,cancelled:Z}=z;Z||(z.cancel=tn(B,U).cancel)}},I=Mi(c,(z,B,U,Z)=>{v(),z?s(z):B&&function(ne,de){typeof createImageBitmap=="function"?function(_e,be){const Ce=new Blob([new Uint8Array(_e)],{type:"image/png"});createImageBitmap(Ce).then(Ie=>{be(null,Ie)}).catch(Ie=>{be(new Error(`Could not load image because of ${Ie.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(ne,de):function(_e,be){const Ce=new Image;Ce.onload=()=>{be(null,Ce),URL.revokeObjectURL(Ce.src),Ce.onload=null,window.requestAnimationFrame(()=>{Ce.src=ci})},Ce.onerror=()=>be(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Ie=new Blob([new Uint8Array(_e)],{type:"image/png"});Ce.src=_e.byteLength?URL.createObjectURL(Ie):ci}(ne,de)}(B,(ne,de)=>{ne!=null?s(ne):de!=null&&s(null,de,{cacheControl:U,expires:Z})})});return{cancel:()=>{I.cancel(),v()}}};function on(c,s,h){h[c]&&h[c].indexOf(s)!==-1||(h[c]=h[c]||[],h[c].push(s))}function hn(c,s,h){if(h&&h[c]){const v=h[c].indexOf(s);v!==-1&&h[c].splice(v,1)}}class Tn{constructor(s,h={}){me(this,h),this.type=s}}class On extends Tn{constructor(s,h={}){super("error",me({error:s},h))}}class qn{on(s,h){return this._listeners=this._listeners||{},on(s,h,this._listeners),this}off(s,h){return hn(s,h,this._listeners),hn(s,h,this._oneTimeListeners),this}once(s,h){return this._oneTimeListeners=this._oneTimeListeners||{},on(s,h,this._oneTimeListeners),this}fire(s,h){typeof s=="string"&&(s=new Tn(s,h||{}));const v=s.type;if(this.listens(v)){s.target=this;const I=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const U of I)U.call(this,s);const z=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const U of z)hn(v,U,this._oneTimeListeners),U.call(this,s);const B=this._eventedParent;B&&(me(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(s))}else s instanceof On&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,h){return this._eventedParent=s,this._eventedParentData=h,this}}var Ot={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class yi{constructor(s,h,v,I){this.message=(s?`${s}: `:"")+v,I&&(this.identifier=I),h!=null&&h.__line__&&(this.line=h.__line__)}}function Pr(c){const s=c.value;return s?[new yi(c.key,s,"constants have been deprecated as of v8")]:[]}function Eo(c,...s){for(const h of s)for(const v in h)c[v]=h[v];return c}function jn(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ro(c){if(Array.isArray(c))return c.map(ro);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const h in c)s[h]=ro(c[h]);return s}return jn(c)}class _o extends Error{constructor(s,h){super(h),this.message=h,this.key=s}}class zr{constructor(s,h=[]){this.parent=s,this.bindings={};for(const[v,I]of h)this.bindings[v]=I}concat(s){return new zr(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const So={kind:"null"},zi={kind:"number"},Ln={kind:"string"},Dn={kind:"boolean"},Co={kind:"color"},is={kind:"object"},kn={kind:"value"},sa={kind:"collator"},yo={kind:"formatted"},aa={kind:"padding"},oo={kind:"resolvedImage"};function so(c,s){return{kind:"array",itemType:c,N:s}}function pr(c){if(c.kind==="array"){const s=pr(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const La=[So,zi,Ln,Dn,Co,yo,is,so(kn),aa,oo];function Ve(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Ve(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const h of La)if(!Ve(h,s))return null}}return`Expected ${pr(c)} but found ${pr(s)} instead.`}function fe(c,s){return s.some(h=>h.kind===c.kind)}function ve(c,s){return s.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}var Oe,Je={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function le(c){return(c=Math.round(c))<0?0:c>255?255:c}function X(c){return le(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function ee(c){return(s=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:s>1?1:s;var s}function ae(c,s,h){return h<0?h+=1:h>1&&(h-=1),6*h<1?c+(s-c)*h*6:2*h<1?s:3*h<2?c+(s-c)*(2/3-h)*6:c}try{Oe={}.parseCSSColor=function(c){var s,h=c.replace(/ /g,"").toLowerCase();if(h in Je)return Je[h].slice();if(h[0]==="#")return h.length===4?(s=parseInt(h.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:h.length===7&&(s=parseInt(h.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var v=h.indexOf("("),I=h.indexOf(")");if(v!==-1&&I+1===h.length){var z=h.substr(0,v),B=h.substr(v+1,I-(v+1)).split(","),U=1;switch(z){case"rgba":if(B.length!==4)return null;U=ee(B.pop());case"rgb":return B.length!==3?null:[X(B[0]),X(B[1]),X(B[2]),U];case"hsla":if(B.length!==4)return null;U=ee(B.pop());case"hsl":if(B.length!==3)return null;var Z=(parseFloat(B[0])%360+360)%360/360,ne=ee(B[1]),de=ee(B[2]),_e=de<=.5?de*(ne+1):de+ne-de*ne,be=2*de-_e;return[le(255*ae(be,_e,Z+1/3)),le(255*ae(be,_e,Z)),le(255*ae(be,_e,Z-1/3)),U];default:return null}}return null}}catch{}class he{constructor(s,h,v,I=1){this.r=s,this.g=h,this.b=v,this.a=I}static parse(s){if(!s)return;if(s instanceof he)return s;if(typeof s!="string")return;const h=Oe(s);return h?new he(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3]):void 0}toString(){const[s,h,v,I]=this.toArray();return`rgba(${Math.round(s)},${Math.round(h)},${Math.round(v)},${I})`}toArray(){const{r:s,g:h,b:v,a:I}=this;return I===0?[0,0,0,0]:[255*s/I,255*h/I,255*v/I,I]}}he.black=new he(0,0,0,1),he.white=new he(1,1,1,1),he.transparent=new he(0,0,0,0),he.red=new he(1,0,0,1);class Se{constructor(s,h,v){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,h){return this.collator.compare(s,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qe{constructor(s,h,v,I,z){this.text=s,this.image=h,this.scale=v,this.fontStack=I,this.textColor=z}}class De{constructor(s){this.sections=s}static fromString(s){return new De([new qe(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof De?s:De.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Ue{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ue)return s;if(typeof s=="number")return new Ue([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const h of s)if(typeof h!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Ue(s)}}toString(){return JSON.stringify(this.values)}}class it{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new it({name:s,available:!1}):null}}function xt(c,s,h,v){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof h=="number"&&h>=0&&h<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[c,s,h,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[c,s,h,v]:[c,s,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bt(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof he||c instanceof Se||c instanceof De||c instanceof Ue||c instanceof it)return!0;if(Array.isArray(c)){for(const s of c)if(!Bt(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!Bt(c[s]))return!1;return!0}return!1}function It(c){if(c===null)return So;if(typeof c=="string")return Ln;if(typeof c=="boolean")return Dn;if(typeof c=="number")return zi;if(c instanceof he)return Co;if(c instanceof Se)return sa;if(c instanceof De)return yo;if(c instanceof Ue)return aa;if(c instanceof it)return oo;if(Array.isArray(c)){const s=c.length;let h;for(const v of c){const I=It(v);if(h){if(h===I)continue;h=kn;break}h=I}return so(h||kn,s)}return is}function Ci(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof he||c instanceof De||c instanceof Ue||c instanceof it?c.toString():JSON.stringify(c)}class ri{constructor(s,h){this.type=s,this.value=h}static parse(s,h){if(s.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Bt(s[1]))return h.error("invalid value");const v=s[1];let I=It(v);const z=h.expectedType;return I.kind!=="array"||I.N!==0||!z||z.kind!=="array"||typeof z.N=="number"&&z.N!==0||(I=z),new ri(I,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class xi{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Gi={string:Ln,number:zi,boolean:Dn,object:is};class _n{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");let v,I=1;const z=s[0];if(z==="array"){let U,Z;if(s.length>2){const ne=s[1];if(typeof ne!="string"||!(ne in Gi)||ne==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);U=Gi[ne],I++}else U=kn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);Z=s[2],I++}v=so(U,Z)}else{if(!Gi[z])throw new Error(`Types doesn't contain name = ${z}`);v=Gi[z]}const B=[];for(;I<s.length;I++){const U=h.parse(s[I],I,kn);if(!U)return null;B.push(U)}return new _n(v,B)}evaluate(s){for(let h=0;h<this.args.length;h++){const v=this.args[h].evaluate(s);if(!Ve(this.type,It(v)))return v;if(h===this.args.length-1)throw new xi(`Expected value to be of type ${pr(this.type)}, but found ${pr(It(v))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Zn={"to-boolean":Dn,"to-color":Co,"to-number":zi,"to-string":Ln};class xn{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const v=s[0];if(!Zn[v])throw new Error(`Can't parse ${v} as it is not part of the known types`);if((v==="to-boolean"||v==="to-string")&&s.length!==2)return h.error("Expected one argument.");const I=Zn[v],z=[];for(let B=1;B<s.length;B++){const U=h.parse(s[B],B,kn);if(!U)return null;z.push(U)}return new xn(I,z)}evaluate(s){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(s));if(this.type.kind==="color"){let h,v;for(const I of this.args){if(h=I.evaluate(s),v=null,h instanceof he)return h;if(typeof h=="string"){const z=s.parseColor(h);if(z)return z}else if(Array.isArray(h)&&(v=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:xt(h[0],h[1],h[2],h[3]),!v))return new he(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new xi(v||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}if(this.type.kind==="padding"){let h;for(const v of this.args){h=v.evaluate(s);const I=Ue.parse(h);if(I)return I}throw new xi(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}if(this.type.kind==="number"){let h=null;for(const v of this.args){if(h=v.evaluate(s),h===null)return 0;const I=Number(h);if(!isNaN(I))return I}throw new xi(`Could not convert ${JSON.stringify(h)} to number.`)}return this.type.kind==="formatted"?De.fromString(Ci(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?it.fromString(Ci(this.args[0].evaluate(s))):Ci(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Mt=["Unknown","Point","LineString","Polygon"];class Gn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Mt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=he.parse(s)),h}}class Fn{constructor(s,h,v,I){this.name=s,this.type=h,this._evaluate=v,this.args=I}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,h){const v=s[0],I=Fn.definitions[v];if(!I)return h.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const z=Array.isArray(I)?I[0]:I.type,B=Array.isArray(I)?[[I[1],I[2]]]:I.overloads,U=B.filter(([ne])=>!Array.isArray(ne)||ne.length===s.length-1);let Z=null;for(const[ne,de]of U){Z=new Il(h.registry,h.path,null,h.scope);const _e=[];let be=!1;for(let Ce=1;Ce<s.length;Ce++){const Ie=s[Ce],dt=Array.isArray(ne)?ne[Ce-1]:ne.type,st=Z.parse(Ie,1+_e.length,dt);if(!st){be=!0;break}_e.push(st)}if(!be)if(Array.isArray(ne)&&ne.length!==_e.length)Z.error(`Expected ${ne.length} arguments, but found ${_e.length} instead.`);else{for(let Ce=0;Ce<_e.length;Ce++){const Ie=Array.isArray(ne)?ne[Ce]:ne.type,dt=_e[Ce];Z.concat(Ce+1).checkSubtype(Ie,dt.type)}if(Z.errors.length===0)return new Fn(v,z,de,_e)}}if(U.length===1)h.errors.push(...Z.errors);else{const ne=(U.length?U:B).map(([_e])=>{return be=_e,Array.isArray(be)?`(${be.map(pr).join(", ")})`:`(${pr(be.type)}...)`;var be}).join(" | "),de=[];for(let _e=1;_e<s.length;_e++){const be=h.parse(s[_e],1+de.length);if(!be)return null;de.push(pr(be.type))}h.error(`Expected arguments of type ${ne}, but found (${de.join(", ")}) instead.`)}return null}static register(s,h){Fn.definitions=h;for(const v in h)s[v]=Fn}}class Qr{constructor(s,h,v){this.type=sa,this.locale=v,this.caseSensitive=s,this.diacriticSensitive=h}static parse(s,h){if(s.length!==2)return h.error("Expected one argument.");const v=s[1];if(typeof v!="object"||Array.isArray(v))return h.error("Collator options argument must be an object.");const I=h.parse(v["case-sensitive"]!==void 0&&v["case-sensitive"],1,Dn);if(!I)return null;const z=h.parse(v["diacritic-sensitive"]!==void 0&&v["diacritic-sensitive"],1,Dn);if(!z)return null;let B=null;return v.locale&&(B=h.parse(v.locale,1,Ln),!B)?null:new Qr(I,z,B)}evaluate(s){return new Se(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const ao=8192;function $r(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function el(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function Sc(c,s){const h=(180+c[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,I=Math.pow(2,s.z);return[Math.round(h*I*ao),Math.round(v*I*ao)]}function Wn(c,s,h){const v=c[0]-s[0],I=c[1]-s[1],z=c[0]-h[0],B=c[1]-h[1];return v*B-z*I==0&&v*z<=0&&I*B<=0}function Fi(c,s){let h=!1;for(let B=0,U=s.length;B<U;B++){const Z=s[B];for(let ne=0,de=Z.length;ne<de-1;ne++){if(Wn(c,Z[ne],Z[ne+1]))return!1;(I=Z[ne])[1]>(v=c)[1]!=(z=Z[ne+1])[1]>v[1]&&v[0]<(z[0]-I[0])*(v[1]-I[1])/(z[1]-I[1])+I[0]&&(h=!h)}}var v,I,z;return h}function Jn(c,s){for(let h=0;h<s.length;h++)if(Fi(c,s[h]))return!0;return!1}function Xn(c,s,h,v){const I=v[0]-h[0],z=v[1]-h[1],B=(c[0]-h[0])*z-I*(c[1]-h[1]),U=(s[0]-h[0])*z-I*(s[1]-h[1]);return B>0&&U<0||B<0&&U>0}function la(c,s,h){for(const ne of h)for(let de=0;de<ne.length-1;++de)if((U=[(B=ne[de+1])[0]-(z=ne[de])[0],B[1]-z[1]])[0]*(Z=[(I=s)[0]-(v=c)[0],I[1]-v[1]])[1]-U[1]*Z[0]!=0&&Xn(v,I,z,B)&&Xn(z,B,v,I))return!0;var v,I,z,B,U,Z;return!1}function tl(c,s){for(let h=0;h<c.length;++h)if(!Fi(c[h],s))return!1;for(let h=0;h<c.length-1;++h)if(la(c[h],c[h+1],s))return!1;return!0}function Hn(c,s){for(let h=0;h<s.length;h++)if(tl(c,s[h]))return!0;return!1}function Tl(c,s,h){const v=[];for(let I=0;I<c.length;I++){const z=[];for(let B=0;B<c[I].length;B++){const U=Sc(c[I][B],h);$r(s,U),z.push(U)}v.push(z)}return v}function El(c,s,h){const v=[];for(let I=0;I<c.length;I++){const z=Tl(c[I],s,h);v.push(z)}return v}function il(c,s,h,v){if(c[0]<h[0]||c[0]>h[2]){const I=.5*v;let z=c[0]-h[0]>I?-v:h[0]-c[0]>I?v:0;z===0&&(z=c[0]-h[2]>I?-v:h[2]-c[0]>I?v:0),c[0]+=z}$r(s,c)}function ns(c,s,h,v){const I=Math.pow(2,v.z)*ao,z=[v.x*ao,v.y*ao],B=[];for(const U of c)for(const Z of U){const ne=[Z.x+z[0],Z.y+z[1]];il(ne,s,h,I),B.push(ne)}return B}function eo(c,s,h,v){const I=Math.pow(2,v.z)*ao,z=[v.x*ao,v.y*ao],B=[];for(const Z of c){const ne=[];for(const de of Z){const _e=[de.x+z[0],de.y+z[1]];$r(s,_e),ne.push(_e)}B.push(ne)}if(s[2]-s[0]<=I/2){(U=s)[0]=U[1]=1/0,U[2]=U[3]=-1/0;for(const Z of B)for(const ne of Z)il(ne,s,h,I)}var U;return B}class ms{constructor(s,h){this.type=Dn,this.geojson=s,this.geometries=h}static parse(s,h){if(s.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Bt(s[1])){const v=s[1];if(v.type==="FeatureCollection")for(let I=0;I<v.features.length;++I){const z=v.features[I].geometry.type;if(z==="Polygon"||z==="MultiPolygon")return new ms(v,v.features[I].geometry)}else if(v.type==="Feature"){const I=v.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new ms(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new ms(v,v)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(h,v){const I=[1/0,1/0,-1/0,-1/0],z=[1/0,1/0,-1/0,-1/0],B=h.canonicalID();if(v.type==="Polygon"){const U=Tl(v.coordinates,z,B),Z=ns(h.geometry(),I,z,B);if(!el(I,z))return!1;for(const ne of Z)if(!Fi(ne,U))return!1}if(v.type==="MultiPolygon"){const U=El(v.coordinates,z,B),Z=ns(h.geometry(),I,z,B);if(!el(I,z))return!1;for(const ne of Z)if(!Jn(ne,U))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(h,v){const I=[1/0,1/0,-1/0,-1/0],z=[1/0,1/0,-1/0,-1/0],B=h.canonicalID();if(v.type==="Polygon"){const U=Tl(v.coordinates,z,B),Z=eo(h.geometry(),I,z,B);if(!el(I,z))return!1;for(const ne of Z)if(!tl(ne,U))return!1}if(v.type==="MultiPolygon"){const U=El(v.coordinates,z,B),Z=eo(h.geometry(),I,z,B);if(!el(I,z))return!1;for(const ne of Z)if(!Hn(ne,U))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function nl(c){if(c instanceof Fn&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof ms)return!1;let s=!0;return c.eachChild(h=>{s&&!nl(h)&&(s=!1)}),s}function Ba(c){if(c instanceof Fn&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(h=>{s&&!Ba(h)&&(s=!1)}),s}function Sl(c,s){if(c instanceof Fn&&s.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(v=>{h&&!Sl(v,s)&&(h=!1)}),h}class Cl{constructor(s,h){this.type=h.type,this.name=s,this.boundExpression=h}static parse(s,h){if(s.length!==2||typeof s[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const v=s[1];return h.scope.has(v)?new Cl(v,h.scope.get(v)):h.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Il{constructor(s,h=[],v,I=new zr,z=[]){this.registry=s,this.path=h,this.key=h.map(B=>`[${B}]`).join(""),this.scope=I,this.errors=z,this.expectedType=v}parse(s,h,v,I,z={}){return h?this.concat(h,v,I)._parse(s,z):this._parse(s,z)}_parse(s,h){function v(I,z,B){return B==="assert"?new _n(z,[I]):B==="coerce"?new xn(z,[I]):I}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const I=s[0];if(typeof I!="string")return this.error(`Expression name must be a string, but found ${typeof I} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const z=this.registry[I];if(z){let B=z.parse(s,this);if(!B)return null;if(this.expectedType){const U=this.expectedType,Z=B.type;if(U.kind!=="string"&&U.kind!=="number"&&U.kind!=="boolean"&&U.kind!=="object"&&U.kind!=="array"||Z.kind!=="value")if(U.kind!=="color"&&U.kind!=="formatted"&&U.kind!=="resolvedImage"||Z.kind!=="value"&&Z.kind!=="string")if(U.kind!=="padding"||Z.kind!=="value"&&Z.kind!=="number"&&Z.kind!=="array"){if(this.checkSubtype(U,Z))return null}else B=v(B,U,h.typeAnnotation||"coerce");else B=v(B,U,h.typeAnnotation||"coerce");else B=v(B,U,h.typeAnnotation||"assert")}if(!(B instanceof ri)&&B.type.kind!=="resolvedImage"&&Ra(B)){const U=new Gn;try{B=new ri(B.type,B.evaluate(U))}catch(Z){return this.error(Z.message),null}}return B}return this.error(`Unknown expression "${I}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,h,v){const I=typeof s=="number"?this.path.concat(s):this.path,z=v?this.scope.concat(v):this.scope;return new Il(this.registry,I,h||null,z,this.errors)}error(s,...h){const v=`${this.key}${h.map(I=>`[${I}]`).join("")}`;this.errors.push(new _o(v,s))}checkSubtype(s,h){const v=Ve(s,h);return v&&this.error(v),v}}function Ra(c){if(c instanceof Cl)return Ra(c.boundExpression);if(c instanceof Fn&&c.name==="error"||c instanceof Qr||c instanceof ms)return!1;const s=c instanceof xn||c instanceof _n;let h=!0;return c.eachChild(v=>{h=s?h&&Ra(v):h&&v instanceof ri}),!!h&&nl(c)&&Sl(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Al(c,s){const h=c.length-1;let v,I,z=0,B=h,U=0;for(;z<=B;)if(U=Math.floor((z+B)/2),v=c[U],I=c[U+1],v<=s){if(U===h||s<I)return U;z=U+1}else{if(!(v>s))throw new xi("Input is not a number.");B=U-1}return 0}class Ml{constructor(s,h,v){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(const[I,z]of v)this.labels.push(I),this.outputs.push(z)}static parse(s,h){if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");const v=h.parse(s[1],1,zi);if(!v)return null;const I=[];let z=null;h.expectedType&&h.expectedType.kind!=="value"&&(z=h.expectedType);for(let B=1;B<s.length;B+=2){const U=B===1?-1/0:s[B],Z=s[B+1],ne=B,de=B+1;if(typeof U!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(I.length&&I[I.length-1][0]>=U)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ne);const _e=h.parse(Z,de,z);if(!_e)return null;z=z||_e.type,I.push([U,_e])}return new Ml(z,v,I)}evaluate(s){const h=this.labels,v=this.outputs;if(h.length===1)return v[0].evaluate(s);const I=this.input.evaluate(s);if(I<=h[0])return v[0].evaluate(s);const z=h.length;return I>=h[z-1]?v[z-1].evaluate(s):v[Al(h,I)].evaluate(s)}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Hr(c,s,h){return c*(1-h)+s*h}var rs=Object.freeze({__proto__:null,number:Hr,color:function(c,s,h){return new he(Hr(c.r,s.r,h),Hr(c.g,s.g,h),Hr(c.b,s.b,h),Hr(c.a,s.a,h))},array:function(c,s,h){return c.map((v,I)=>Hr(v,s[I],h))},padding:function(c,s,h){const v=c.values,I=s.values;return new Ue([Hr(v[0],I[0],h),Hr(v[1],I[1],h),Hr(v[2],I[2],h),Hr(v[3],I[3],h)])}});const ho=.95047,Cc=1.08883,bu=4/29,Vo=6/29,Us=3*Vo*Vo,Rd=Math.PI/180,lh=180/Math.PI;function Io(c){return c>.008856451679035631?Math.pow(c,1/3):c/Us+bu}function Kl(c){return c>Vo?c*c*c:Us*(c-bu)}function wu(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Yl(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Bn(c){const s=Yl(c.r),h=Yl(c.g),v=Yl(c.b),I=Io((.4124564*s+.3575761*h+.1804375*v)/ho),z=Io((.2126729*s+.7151522*h+.072175*v)/1);return{l:116*z-16,a:500*(I-z),b:200*(z-Io((.0193339*s+.119192*h+.9503041*v)/Cc)),alpha:c.a}}function Jl(c){let s=(c.l+16)/116,h=isNaN(c.a)?s:s+c.a/500,v=isNaN(c.b)?s:s-c.b/200;return s=1*Kl(s),h=ho*Kl(h),v=Cc*Kl(v),new he(wu(3.2404542*h-1.5371385*s-.4985314*v),wu(-.969266*h+1.8760108*s+.041556*v),wu(.0556434*h-.2040259*s+1.0572252*v),c.alpha)}function Vh(c,s,h){const v=s-c;return c+h*(v>180||v<-180?v-360*Math.round(v/360):v)}const $s={forward:Bn,reverse:Jl,interpolate:function(c,s,h){return{l:Hr(c.l,s.l,h),a:Hr(c.a,s.a,h),b:Hr(c.b,s.b,h),alpha:Hr(c.alpha,s.alpha,h)}}},rl={forward:function(c){const{l:s,a:h,b:v}=Bn(c),I=Math.atan2(v,h)*lh;return{h:I<0?I+360:I,c:Math.sqrt(h*h+v*v),l:s,alpha:c.a}},reverse:function(c){const s=c.h*Rd,h=c.c;return Jl({l:c.l,a:Math.cos(s)*h,b:Math.sin(s)*h,alpha:c.alpha})},interpolate:function(c,s,h){return{h:Vh(c.h,s.h,h),c:Hr(c.c,s.c,h),l:Hr(c.l,s.l,h),alpha:Hr(c.alpha,s.alpha,h)}}};var Tu=Object.freeze({__proto__:null,lab:$s,hcl:rl});class js{constructor(s,h,v,I,z){this.type=s,this.operator=h,this.interpolation=v,this.input=I,this.labels=[],this.outputs=[];for(const[B,U]of z)this.labels.push(B),this.outputs.push(U)}static interpolationFactor(s,h,v,I){let z=0;if(s.name==="exponential")z=Eu(h,s.base,v,I);else if(s.name==="linear")z=Eu(h,1,v,I);else if(s.name==="cubic-bezier"){const B=s.controlPoints;z=new F(B[0],B[1],B[2],B[3]).solve(Eu(h,1,v,I))}return z}static parse(s,h){let[v,I,z,...B]=s;if(!Array.isArray(I)||I.length===0)return h.error("Expected an interpolation type expression.",1);if(I[0]==="linear")I={name:"linear"};else if(I[0]==="exponential"){const ne=I[1];if(typeof ne!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);I={name:"exponential",base:ne}}else{if(I[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(I[0])}`,1,0);{const ne=I.slice(1);if(ne.length!==4||ne.some(de=>typeof de!="number"||de<0||de>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);I={name:"cubic-bezier",controlPoints:ne}}}if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(z=h.parse(z,2,zi),!z)return null;const U=[];let Z=null;v==="interpolate-hcl"||v==="interpolate-lab"?Z=Co:h.expectedType&&h.expectedType.kind!=="value"&&(Z=h.expectedType);for(let ne=0;ne<B.length;ne+=2){const de=B[ne],_e=B[ne+1],be=ne+3,Ce=ne+4;if(typeof de!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',be);if(U.length&&U[U.length-1][0]>=de)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',be);const Ie=h.parse(_e,Ce,Z);if(!Ie)return null;Z=Z||Ie.type,U.push([de,Ie])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="padding"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new js(Z,v,I,z,U):h.error(`Type ${pr(Z)} is not interpolatable.`)}evaluate(s){const h=this.labels,v=this.outputs;if(h.length===1)return v[0].evaluate(s);const I=this.input.evaluate(s);if(I<=h[0])return v[0].evaluate(s);const z=h.length;if(I>=h[z-1])return v[z-1].evaluate(s);const B=Al(h,I),U=js.interpolationFactor(this.interpolation,I,h[B],h[B+1]),Z=v[B].evaluate(s),ne=v[B+1].evaluate(s);return this.operator==="interpolate"?rs[this.type.kind.toLowerCase()](Z,ne,U):this.operator==="interpolate-hcl"?rl.reverse(rl.interpolate(rl.forward(Z),rl.forward(ne),U)):$s.reverse($s.interpolate($s.forward(Z),$s.forward(ne),U))}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Eu(c,s,h,v){const I=v-h,z=c-h;return I===0?0:s===1?z/I:(Math.pow(s,z)-1)/(Math.pow(s,I)-1)}class Oa{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expectected at least one argument.");let v=null;const I=h.expectedType;I&&I.kind!=="value"&&(v=I);const z=[];for(const U of s.slice(1)){const Z=h.parse(U,1+z.length,v,void 0,{typeAnnotation:"omit"});if(!Z)return null;v=v||Z.type,z.push(Z)}if(!v)throw new Error("No output type");const B=I&&z.some(U=>Ve(I,U.type));return new Oa(B?kn:v,z)}evaluate(s){let h,v=null,I=0;for(const z of this.args)if(I++,v=z.evaluate(s),v&&v instanceof it&&!v.available&&(h||(h=v.name),v=null,I===this.args.length&&(v=h)),v!==null)break;return v}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Ql{constructor(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const h of this.bindings)s(h[1]);s(this.result)}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const v=[];for(let z=1;z<s.length-1;z+=2){const B=s[z];if(typeof B!="string")return h.error(`Expected string, but found ${typeof B} instead.`,z);if(/[^a-zA-Z0-9_]/.test(B))return h.error("Variable names must contain only alphanumeric characters or '_'.",z);const U=h.parse(s[z+1],z+1);if(!U)return null;v.push([B,U])}const I=h.parse(s[s.length-1],s.length-1,h.expectedType,v);return I?new Ql(v,I):null}outputDefined(){return this.result.outputDefined()}}class ch{constructor(s,h,v){this.type=s,this.index=h,this.input=v}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const v=h.parse(s[1],1,zi),I=h.parse(s[2],2,so(h.expectedType||kn));return v&&I?new ch(I.type.itemType,v,I):null}evaluate(s){const h=this.index.evaluate(s),v=this.input.evaluate(s);if(h<0)throw new xi(`Array index out of bounds: ${h} < 0.`);if(h>=v.length)throw new xi(`Array index out of bounds: ${h} > ${v.length-1}.`);if(h!==Math.floor(h))throw new xi(`Array index must be an integer, but found ${h} instead.`);return v[h]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class kl{constructor(s,h){this.type=Dn,this.needle=s,this.haystack=h}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const v=h.parse(s[1],1,kn),I=h.parse(s[2],2,kn);return v&&I?fe(v.type,[Dn,Ln,zi,So,kn])?new kl(v,I):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(v.type)} instead`):null}evaluate(s){const h=this.needle.evaluate(s),v=this.haystack.evaluate(s);if(!v)return!1;if(!ve(h,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${pr(It(h))} instead.`);if(!ve(v,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${pr(It(v))} instead.`);return v.indexOf(h)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class ya{constructor(s,h,v){this.type=zi,this.needle=s,this.haystack=h,this.fromIndex=v}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const v=h.parse(s[1],1,kn),I=h.parse(s[2],2,kn);if(!v||!I)return null;if(!fe(v.type,[Dn,Ln,zi,So,kn]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(v.type)} instead`);if(s.length===4){const z=h.parse(s[3],3,zi);return z?new ya(v,I,z):null}return new ya(v,I)}evaluate(s){const h=this.needle.evaluate(s),v=this.haystack.evaluate(s);if(!ve(h,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${pr(It(h))} instead.`);if(!ve(v,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${pr(It(v))} instead.`);if(this.fromIndex){const I=this.fromIndex.evaluate(s);return v.indexOf(h,I)}return v.indexOf(h)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Ic{constructor(s,h,v,I,z,B){this.inputType=s,this.type=h,this.input=v,this.cases=I,this.outputs=z,this.otherwise=B}static parse(s,h){if(s.length<5)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return h.error("Expected an even number of arguments.");let v,I;h.expectedType&&h.expectedType.kind!=="value"&&(I=h.expectedType);const z={},B=[];for(let ne=2;ne<s.length-1;ne+=2){let de=s[ne];const _e=s[ne+1];Array.isArray(de)||(de=[de]);const be=h.concat(ne);if(de.length===0)return be.error("Expected at least one branch label.");for(const Ie of de){if(typeof Ie!="number"&&typeof Ie!="string")return be.error("Branch labels must be numbers or strings.");if(typeof Ie=="number"&&Math.abs(Ie)>Number.MAX_SAFE_INTEGER)return be.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ie=="number"&&Math.floor(Ie)!==Ie)return be.error("Numeric branch labels must be integer values.");if(v){if(be.checkSubtype(v,It(Ie)))return null}else v=It(Ie);if(z[String(Ie)]!==void 0)return be.error("Branch labels must be unique.");z[String(Ie)]=B.length}const Ce=h.parse(_e,ne,I);if(!Ce)return null;I=I||Ce.type,B.push(Ce)}const U=h.parse(s[1],1,kn);if(!U)return null;const Z=h.parse(s[s.length-1],s.length-1,I);return Z?U.type.kind!=="value"&&h.concat(1).checkSubtype(v,U.type)?null:new Ic(v,I,U,z,B,Z):null}evaluate(s){const h=this.input.evaluate(s);return(It(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Zo{constructor(s,h,v){this.type=s,this.branches=h,this.otherwise=v}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return h.error("Expected an odd number of arguments.");let v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const I=[];for(let B=1;B<s.length-1;B+=2){const U=h.parse(s[B],B,Dn);if(!U)return null;const Z=h.parse(s[B+1],B+1,v);if(!Z)return null;I.push([U,Z]),v=v||Z.type}const z=h.parse(s[s.length-1],s.length-1,v);if(!z)return null;if(!v)throw new Error("Can't infer output type");return new Zo(v,I,z)}evaluate(s){for(const[h,v]of this.branches)if(h.evaluate(s))return v.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[h,v]of this.branches)s(h),s(v);s(this.otherwise)}outputDefined(){return this.branches.every(([s,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class ec{constructor(s,h,v,I){this.type=s,this.input=h,this.beginIndex=v,this.endIndex=I}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const v=h.parse(s[1],1,kn),I=h.parse(s[2],2,zi);if(!v||!I)return null;if(!fe(v.type,[so(kn),Ln,kn]))return h.error(`Expected first argument to be of type array or string, but found ${pr(v.type)} instead`);if(s.length===4){const z=h.parse(s[3],3,zi);return z?new ec(v.type,v,I,z):null}return new ec(v.type,v,I)}evaluate(s){const h=this.input.evaluate(s),v=this.beginIndex.evaluate(s);if(!ve(h,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${pr(It(h))} instead.`);if(this.endIndex){const I=this.endIndex.evaluate(s);return h.slice(v,I)}return h.slice(v)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Ac(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Nh(c,s,h,v){return v.compare(s,h)===0}function tc(c,s,h){const v=c!=="=="&&c!=="!=";return class NC{constructor(z,B,U){this.type=Dn,this.lhs=z,this.rhs=B,this.collator=U,this.hasUntypedArgument=z.type.kind==="value"||B.type.kind==="value"}static parse(z,B){if(z.length!==3&&z.length!==4)return B.error("Expected two or three arguments.");const U=z[0];let Z=B.parse(z[1],1,kn);if(!Z)return null;if(!Ac(U,Z.type))return B.concat(1).error(`"${U}" comparisons are not supported for type '${pr(Z.type)}'.`);let ne=B.parse(z[2],2,kn);if(!ne)return null;if(!Ac(U,ne.type))return B.concat(2).error(`"${U}" comparisons are not supported for type '${pr(ne.type)}'.`);if(Z.type.kind!==ne.type.kind&&Z.type.kind!=="value"&&ne.type.kind!=="value")return B.error(`Cannot compare types '${pr(Z.type)}' and '${pr(ne.type)}'.`);v&&(Z.type.kind==="value"&&ne.type.kind!=="value"?Z=new _n(ne.type,[Z]):Z.type.kind!=="value"&&ne.type.kind==="value"&&(ne=new _n(Z.type,[ne])));let de=null;if(z.length===4){if(Z.type.kind!=="string"&&ne.type.kind!=="string"&&Z.type.kind!=="value"&&ne.type.kind!=="value")return B.error("Cannot use collator to compare non-string types.");if(de=B.parse(z[3],3,sa),!de)return null}return new NC(Z,ne,de)}evaluate(z){const B=this.lhs.evaluate(z),U=this.rhs.evaluate(z);if(v&&this.hasUntypedArgument){const Z=It(B),ne=It(U);if(Z.kind!==ne.kind||Z.kind!=="string"&&Z.kind!=="number")throw new xi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${Z.kind}, ${ne.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const Z=It(B),ne=It(U);if(Z.kind!=="string"||ne.kind!=="string")return s(z,B,U)}return this.collator?h(z,B,U,this.collator.evaluate(z)):s(z,B,U)}eachChild(z){z(this.lhs),z(this.rhs),this.collator&&z(this.collator)}outputDefined(){return!0}}}const uh=tc("==",function(c,s,h){return s===h},Nh),Od=tc("!=",function(c,s,h){return s!==h},function(c,s,h,v){return!Nh(0,s,h,v)}),hh=tc("<",function(c,s,h){return s<h},function(c,s,h,v){return v.compare(s,h)<0}),Su=tc(">",function(c,s,h){return s>h},function(c,s,h,v){return v.compare(s,h)>0}),Uh=tc("<=",function(c,s,h){return s<=h},function(c,s,h,v){return v.compare(s,h)<=0}),Fd=tc(">=",function(c,s,h){return s>=h},function(c,s,h,v){return v.compare(s,h)>=0});class ic{constructor(s,h,v,I,z){this.type=Ln,this.number=s,this.locale=h,this.currency=v,this.minFractionDigits=I,this.maxFractionDigits=z}static parse(s,h){if(s.length!==3)return h.error("Expected two arguments.");const v=h.parse(s[1],1,zi);if(!v)return null;const I=s[2];if(typeof I!="object"||Array.isArray(I))return h.error("NumberFormat options argument must be an object.");let z=null;if(I.locale&&(z=h.parse(I.locale,1,Ln),!z))return null;let B=null;if(I.currency&&(B=h.parse(I.currency,1,Ln),!B))return null;let U=null;if(I["min-fraction-digits"]&&(U=h.parse(I["min-fraction-digits"],1,zi),!U))return null;let Z=null;return I["max-fraction-digits"]&&(Z=h.parse(I["max-fraction-digits"],1,zi),!Z)?null:new ic(v,z,B,U,Z)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Mc{constructor(s){this.type=yo,this.sections=s}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const v=s[1];if(!Array.isArray(v)&&typeof v=="object")return h.error("First argument must be an image or text section.");const I=[];let z=!1;for(let B=1;B<=s.length-1;++B){const U=s[B];if(z&&typeof U=="object"&&!Array.isArray(U)){z=!1;let Z=null;if(U["font-scale"]&&(Z=h.parse(U["font-scale"],1,zi),!Z))return null;let ne=null;if(U["text-font"]&&(ne=h.parse(U["text-font"],1,so(Ln)),!ne))return null;let de=null;if(U["text-color"]&&(de=h.parse(U["text-color"],1,Co),!de))return null;const _e=I[I.length-1];_e.scale=Z,_e.font=ne,_e.textColor=de}else{const Z=h.parse(s[B],1,kn);if(!Z)return null;const ne=Z.type.kind;if(ne!=="string"&&ne!=="value"&&ne!=="null"&&ne!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");z=!0,I.push({content:Z,scale:null,font:null,textColor:null})}}return new Mc(I)}evaluate(s){return new De(this.sections.map(h=>{const v=h.content.evaluate(s);return It(v)===oo?new qe("",v,null,null,null):new qe(Ci(v),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))}eachChild(s){for(const h of this.sections)s(h.content),h.scale&&s(h.scale),h.font&&s(h.font),h.textColor&&s(h.textColor)}outputDefined(){return!1}}class ol{constructor(s){this.type=oo,this.input=s}static parse(s,h){if(s.length!==2)return h.error("Expected two arguments.");const v=h.parse(s[1],1,Ln);return v?new ol(v):h.error("No image name provided.")}evaluate(s){const h=this.input.evaluate(s),v=it.fromString(h);return v&&s.availableImages&&(v.available=s.availableImages.indexOf(h)>-1),v}eachChild(s){s(this.input)}outputDefined(){return!1}}class gr{constructor(s){this.type=zi,this.input=s}static parse(s,h){if(s.length!==2)return h.error(`Expected 1 argument, but found ${s.length-1} instead.`);const v=h.parse(s[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${pr(v.type)} instead.`):new gr(v):null}evaluate(s){const h=this.input.evaluate(s);if(typeof h=="string"||Array.isArray(h))return h.length;throw new xi(`Expected value to be of type string or array, but found ${pr(It(h))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const nc={"==":uh,"!=":Od,">":Su,"<":hh,">=":Fd,"<=":Uh,array:_n,at:ch,boolean:_n,case:Zo,coalesce:Oa,collator:Qr,format:Mc,image:ol,in:kl,"index-of":ya,interpolate:js,"interpolate-hcl":js,"interpolate-lab":js,length:gr,let:Ql,literal:ri,match:Ic,number:_n,"number-format":ic,object:_n,slice:ec,step:Ml,string:_n,"to-boolean":xn,"to-color":xn,"to-number":xn,"to-string":xn,var:Cl,within:ms};function kc(c,[s,h,v,I]){s=s.evaluate(c),h=h.evaluate(c),v=v.evaluate(c);const z=I?I.evaluate(c):1,B=xt(s,h,v,z);if(B)throw new xi(B);return new he(s/255*z,h/255*z,v/255*z,z)}function dh(c,s){return c in s}function sl(c,s){const h=s[c];return h===void 0?null:h}function Fa(c){return{type:c}}function Pc(c){return{result:"success",value:c}}function al(c){return{result:"error",value:c}}function jr(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Cu(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Un(c){return!!c.expression&&c.expression.interpolated}function cr(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Lr(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Br(c){return c}function Pl(c,s){const h=s.type==="color",v=c.stops&&typeof c.stops[0][0]=="object",I=v||!(v||c.property!==void 0),z=c.type||(Un(s)?"exponential":"interval");if(h||s.type==="padding"){const ne=h?he.parse:Ue.parse;(c=Eo({},c)).stops&&(c.stops=c.stops.map(de=>[de[0],ne(de[1])])),c.default=ne(c.default?c.default:s.default)}if(c.colorSpace&&c.colorSpace!=="rgb"&&!Tu[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let B,U,Z;if(z==="exponential")B=jh;else if(z==="interval")B=$h;else if(z==="categorical"){B=fh,U=Object.create(null);for(const ne of c.stops)U[ne[0]]=ne[1];Z=typeof c.stops[0][0]}else{if(z!=="identity")throw new Error(`Unknown function type "${z}"`);B=Gh}if(v){const ne={},de=[];for(let Ce=0;Ce<c.stops.length;Ce++){const Ie=c.stops[Ce],dt=Ie[0].zoom;ne[dt]===void 0&&(ne[dt]={zoom:dt,type:c.type,property:c.property,default:c.default,stops:[]},de.push(dt)),ne[dt].stops.push([Ie[0].value,Ie[1]])}const _e=[];for(const Ce of de)_e.push([ne[Ce].zoom,Pl(ne[Ce],s)]);const be={name:"linear"};return{kind:"composite",interpolationType:be,interpolationFactor:js.interpolationFactor.bind(void 0,be),zoomStops:_e.map(Ce=>Ce[0]),evaluate:({zoom:Ce},Ie)=>jh({stops:_e,base:c.base},s,Ce).evaluate(Ce,Ie)}}if(I){const ne=z==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:ne,interpolationFactor:js.interpolationFactor.bind(void 0,ne),zoomStops:c.stops.map(de=>de[0]),evaluate:({zoom:de})=>B(c,s,de,U,Z)}}return{kind:"source",evaluate(ne,de){const _e=de&&de.properties?de.properties[c.property]:void 0;return _e===void 0?Qn(c.default,s.default):B(c,s,_e,U,Z)}}}function Qn(c,s,h){return c!==void 0?c:s!==void 0?s:h!==void 0?h:void 0}function fh(c,s,h,v,I){return Qn(typeof h===I?v[h]:void 0,c.default,s.default)}function $h(c,s,h){if(cr(h)!=="number")return Qn(c.default,s.default);const v=c.stops.length;if(v===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[v-1][0])return c.stops[v-1][1];const I=Al(c.stops.map(z=>z[0]),h);return c.stops[I][1]}function jh(c,s,h){const v=c.base!==void 0?c.base:1;if(cr(h)!=="number")return Qn(c.default,s.default);const I=c.stops.length;if(I===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[I-1][0])return c.stops[I-1][1];const z=Al(c.stops.map(de=>de[0]),h),B=function(de,_e,be,Ce){const Ie=Ce-be,dt=de-be;return Ie===0?0:_e===1?dt/Ie:(Math.pow(_e,dt)-1)/(Math.pow(_e,Ie)-1)}(h,v,c.stops[z][0],c.stops[z+1][0]),U=c.stops[z][1],Z=c.stops[z+1][1];let ne=rs[s.type]||Br;if(c.colorSpace&&c.colorSpace!=="rgb"){const de=Tu[c.colorSpace];ne=(_e,be)=>de.reverse(de.interpolate(de.forward(_e),de.forward(be),B))}return typeof U.evaluate=="function"?{evaluate(...de){const _e=U.evaluate.apply(void 0,de),be=Z.evaluate.apply(void 0,de);if(_e!==void 0&&be!==void 0)return ne(_e,be,B)}}:ne(U,Z,B)}function Gh(c,s,h){switch(s.type){case"color":h=he.parse(h);break;case"formatted":h=De.fromString(h.toString());break;case"resolvedImage":h=it.fromString(h.toString());break;case"padding":h=Ue.parse(h);break;default:cr(h)===s.type||s.type==="enum"&&s.values[h]||(h=void 0)}return Qn(h,c.default,s.default)}Fn.register(nc,{error:[{kind:"error"},[Ln],(c,[s])=>{throw new xi(s.evaluate(c))}],typeof:[Ln,[kn],(c,[s])=>pr(It(s.evaluate(c)))],"to-rgba":[so(zi,4),[Co],(c,[s])=>s.evaluate(c).toArray()],rgb:[Co,[zi,zi,zi],kc],rgba:[Co,[zi,zi,zi,zi],kc],has:{type:Dn,overloads:[[[Ln],(c,[s])=>dh(s.evaluate(c),c.properties())],[[Ln,is],(c,[s,h])=>dh(s.evaluate(c),h.evaluate(c))]]},get:{type:kn,overloads:[[[Ln],(c,[s])=>sl(s.evaluate(c),c.properties())],[[Ln,is],(c,[s,h])=>sl(s.evaluate(c),h.evaluate(c))]]},"feature-state":[kn,[Ln],(c,[s])=>sl(s.evaluate(c),c.featureState||{})],properties:[is,[],c=>c.properties()],"geometry-type":[Ln,[],c=>c.geometryType()],id:[kn,[],c=>c.id()],zoom:[zi,[],c=>c.globals.zoom],"heatmap-density":[zi,[],c=>c.globals.heatmapDensity||0],"line-progress":[zi,[],c=>c.globals.lineProgress||0],accumulated:[kn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[zi,Fa(zi),(c,s)=>{let h=0;for(const v of s)h+=v.evaluate(c);return h}],"*":[zi,Fa(zi),(c,s)=>{let h=1;for(const v of s)h*=v.evaluate(c);return h}],"-":{type:zi,overloads:[[[zi,zi],(c,[s,h])=>s.evaluate(c)-h.evaluate(c)],[[zi],(c,[s])=>-s.evaluate(c)]]},"/":[zi,[zi,zi],(c,[s,h])=>s.evaluate(c)/h.evaluate(c)],"%":[zi,[zi,zi],(c,[s,h])=>s.evaluate(c)%h.evaluate(c)],ln2:[zi,[],()=>Math.LN2],pi:[zi,[],()=>Math.PI],e:[zi,[],()=>Math.E],"^":[zi,[zi,zi],(c,[s,h])=>Math.pow(s.evaluate(c),h.evaluate(c))],sqrt:[zi,[zi],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[zi,[zi],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[zi,[zi],(c,[s])=>Math.log(s.evaluate(c))],log2:[zi,[zi],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[zi,[zi],(c,[s])=>Math.sin(s.evaluate(c))],cos:[zi,[zi],(c,[s])=>Math.cos(s.evaluate(c))],tan:[zi,[zi],(c,[s])=>Math.tan(s.evaluate(c))],asin:[zi,[zi],(c,[s])=>Math.asin(s.evaluate(c))],acos:[zi,[zi],(c,[s])=>Math.acos(s.evaluate(c))],atan:[zi,[zi],(c,[s])=>Math.atan(s.evaluate(c))],min:[zi,Fa(zi),(c,s)=>Math.min(...s.map(h=>h.evaluate(c)))],max:[zi,Fa(zi),(c,s)=>Math.max(...s.map(h=>h.evaluate(c)))],abs:[zi,[zi],(c,[s])=>Math.abs(s.evaluate(c))],round:[zi,[zi],(c,[s])=>{const h=s.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[zi,[zi],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[zi,[zi],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[Dn,[Ln,kn],(c,[s,h])=>c.properties()[s.value]===h.value],"filter-id-==":[Dn,[kn],(c,[s])=>c.id()===s.value],"filter-type-==":[Dn,[Ln],(c,[s])=>c.geometryType()===s.value],"filter-<":[Dn,[Ln,kn],(c,[s,h])=>{const v=c.properties()[s.value],I=h.value;return typeof v==typeof I&&v<I}],"filter-id-<":[Dn,[kn],(c,[s])=>{const h=c.id(),v=s.value;return typeof h==typeof v&&h<v}],"filter->":[Dn,[Ln,kn],(c,[s,h])=>{const v=c.properties()[s.value],I=h.value;return typeof v==typeof I&&v>I}],"filter-id->":[Dn,[kn],(c,[s])=>{const h=c.id(),v=s.value;return typeof h==typeof v&&h>v}],"filter-<=":[Dn,[Ln,kn],(c,[s,h])=>{const v=c.properties()[s.value],I=h.value;return typeof v==typeof I&&v<=I}],"filter-id-<=":[Dn,[kn],(c,[s])=>{const h=c.id(),v=s.value;return typeof h==typeof v&&h<=v}],"filter->=":[Dn,[Ln,kn],(c,[s,h])=>{const v=c.properties()[s.value],I=h.value;return typeof v==typeof I&&v>=I}],"filter-id->=":[Dn,[kn],(c,[s])=>{const h=c.id(),v=s.value;return typeof h==typeof v&&h>=v}],"filter-has":[Dn,[kn],(c,[s])=>s.value in c.properties()],"filter-has-id":[Dn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Dn,[so(Ln)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[Dn,[so(kn)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[Dn,[Ln,so(kn)],(c,[s,h])=>h.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[Dn,[Ln,so(kn)],(c,[s,h])=>function(v,I,z,B){for(;z<=B;){const U=z+B>>1;if(I[U]===v)return!0;I[U]>v?B=U-1:z=U+1}return!1}(c.properties()[s.value],h.value,0,h.value.length-1)],all:{type:Dn,overloads:[[[Dn,Dn],(c,[s,h])=>s.evaluate(c)&&h.evaluate(c)],[Fa(Dn),(c,s)=>{for(const h of s)if(!h.evaluate(c))return!1;return!0}]]},any:{type:Dn,overloads:[[[Dn,Dn],(c,[s,h])=>s.evaluate(c)||h.evaluate(c)],[Fa(Dn),(c,s)=>{for(const h of s)if(h.evaluate(c))return!0;return!1}]]},"!":[Dn,[Dn],(c,[s])=>!s.evaluate(c)],"is-supported-script":[Dn,[Ln],(c,[s])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(s.evaluate(c))}],upcase:[Ln,[Ln],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Ln,[Ln],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Ln,Fa(kn),(c,s)=>s.map(h=>Ci(h.evaluate(c))).join("")],"resolved-locale":[Ln,[sa],(c,[s])=>s.evaluate(c).resolvedLocale()]});class rc{constructor(s,h){this.expression=s,this._warningHistory={},this._evaluator=new Gn,this._defaultValue=h?function(v){return v.type==="color"&&Lr(v.default)?new he(0,0,0,0):v.type==="color"?he.parse(v.default)||null:v.type==="padding"?Ue.parse(v.default)||null:v.default===void 0?null:v.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(s,h,v,I,z,B){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=v,this._evaluator.canonical=I,this._evaluator.availableImages=z||null,this._evaluator.formattedSection=B,this.expression.evaluate(this._evaluator)}evaluate(s,h,v,I,z,B){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=v||null,this._evaluator.canonical=I,this._evaluator.availableImages=z||null,this._evaluator.formattedSection=B||null;try{const U=this.expression.evaluate(this._evaluator);if(U==null||typeof U=="number"&&U!=U)return this._defaultValue;if(this._enumValues&&!(U in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(Z=>JSON.stringify(Z)).join(", ")}, but found ${JSON.stringify(U)} instead.`);return U}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(U.message)),this._defaultValue}}}function zc(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in nc}function Dc(c,s){const h=new Il(nc,[],s?function(I){const z={color:Co,string:Ln,number:zi,enum:Ln,boolean:Dn,formatted:yo,padding:aa,resolvedImage:oo};return I.type==="array"?so(z[I.value]||kn,I.length):z[I.type]}(s):void 0),v=h.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Pc(new rc(v,s)):al(h.errors)}class Iu{constructor(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent=s!=="constant"&&!Ba(h.expression)}evaluateWithoutErrorHandling(s,h,v,I,z,B){return this._styleExpression.evaluateWithoutErrorHandling(s,h,v,I,z,B)}evaluate(s,h,v,I,z,B){return this._styleExpression.evaluate(s,h,v,I,z,B)}}class Lc{constructor(s,h,v,I){this.kind=s,this.zoomStops=v,this._styleExpression=h,this.isStateDependent=s!=="camera"&&!Ba(h.expression),this.interpolationType=I}evaluateWithoutErrorHandling(s,h,v,I,z,B){return this._styleExpression.evaluateWithoutErrorHandling(s,h,v,I,z,B)}evaluate(s,h,v,I,z,B){return this._styleExpression.evaluate(s,h,v,I,z,B)}interpolationFactor(s,h,v){return this.interpolationType?js.interpolationFactor(this.interpolationType,s,h,v):0}}function Au(c,s){const h=Dc(c,s);if(h.result==="error")return h;const v=h.value.expression,I=nl(v);if(!I&&!jr(s))return al([new _o("","data expressions not supported")]);const z=Sl(v,["zoom"]);if(!z&&!Cu(s))return al([new _o("","zoom expressions not supported")]);const B=Rc(v);return B||z?B instanceof _o?al([B]):B instanceof js&&!Un(s)?al([new _o("",'"interpolate" expressions cannot be used with this property')]):Pc(B?new Lc(I?"camera":"composite",h.value,B.labels,B instanceof js?B.interpolation:void 0):new Iu(I?"constant":"source",h.value)):al([new _o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bc{constructor(s,h){this._parameters=s,this._specification=h,Eo(this,Pl(this._parameters,this._specification))}static deserialize(s){return new Bc(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Rc(c){let s=null;if(c instanceof Ql)s=Rc(c.result);else if(c instanceof Oa){for(const h of c.args)if(s=Rc(h),s)break}else(c instanceof Ml||c instanceof js)&&c.input instanceof Fn&&c.input.name==="zoom"&&(s=c);return s instanceof _o||c.eachChild(h=>{const v=Rc(h);v instanceof _o?s=v:!s&&v?s=new _o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&v&&s!==v&&(s=new _o("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ca(c){const s=c.key,h=c.value,v=c.valueSpec||{},I=c.objectElementValidators||{},z=c.style,B=c.styleSpec;let U=[];const Z=cr(h);if(Z!=="object")return[new yi(s,h,`object expected, ${Z} found`)];for(const ne in h){const de=ne.split(".")[0],_e=v[de]||v["*"];let be;if(I[de])be=I[de];else if(v[de])be=zs;else if(I["*"])be=I["*"];else{if(!v["*"]){U.push(new yi(s,h[ne],`unknown property "${ne}"`));continue}be=zs}U=U.concat(be({key:(s&&`${s}.`)+ne,value:h[ne],valueSpec:_e,style:z,styleSpec:B,object:h,objectKey:ne},h))}for(const ne in v)I[ne]||v[ne].required&&v[ne].default===void 0&&h[ne]===void 0&&U.push(new yi(s,h,`missing required property "${ne}"`));return U}function qh(c){const s=c.value,h=c.valueSpec,v=c.style,I=c.styleSpec,z=c.key,B=c.arrayElementValidator||zs;if(cr(s)!=="array")return[new yi(z,s,`array expected, ${cr(s)} found`)];if(h.length&&s.length!==h.length)return[new yi(z,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new yi(z,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let U={type:h.value,values:h.values};I.$version<7&&(U.function=h.function),cr(h.value)==="object"&&(U=h.value);let Z=[];for(let ne=0;ne<s.length;ne++)Z=Z.concat(B({array:s,arrayIndex:ne,value:s[ne],valueSpec:U,style:v,styleSpec:I,key:`${z}[${ne}]`}));return Z}function Zh(c){const s=c.key,h=c.value,v=c.valueSpec;let I=cr(h);return I==="number"&&h!=h&&(I="NaN"),I!=="number"?[new yi(s,h,`number expected, ${I} found`)]:"minimum"in v&&h<v.minimum?[new yi(s,h,`${h} is less than the minimum value ${v.minimum}`)]:"maximum"in v&&h>v.maximum?[new yi(s,h,`${h} is greater than the maximum value ${v.maximum}`)]:[]}function Oc(c){const s=c.valueSpec,h=jn(c.value.type);let v,I,z,B={};const U=h!=="categorical"&&c.value.property===void 0,Z=!U,ne=cr(c.value.stops)==="array"&&cr(c.value.stops[0])==="array"&&cr(c.value.stops[0][0])==="object",de=ca({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(Ce){if(h==="identity")return[new yi(Ce.key,Ce.value,'identity function may not have a "stops" property')];let Ie=[];const dt=Ce.value;return Ie=Ie.concat(qh({key:Ce.key,value:dt,valueSpec:Ce.valueSpec,style:Ce.style,styleSpec:Ce.styleSpec,arrayElementValidator:_e})),cr(dt)==="array"&&dt.length===0&&Ie.push(new yi(Ce.key,dt,"array must have at least one stop")),Ie},default:function(Ce){return zs({key:Ce.key,value:Ce.value,valueSpec:s,style:Ce.style,styleSpec:Ce.styleSpec})}}});return h==="identity"&&U&&de.push(new yi(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||de.push(new yi(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Un(c.valueSpec)&&de.push(new yi(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(Z&&!jr(c.valueSpec)?de.push(new yi(c.key,c.value,"property functions not supported")):U&&!Cu(c.valueSpec)&&de.push(new yi(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!ne||c.value.property!==void 0||de.push(new yi(c.key,c.value,'"property" property is required')),de;function _e(Ce){let Ie=[];const dt=Ce.value,st=Ce.key;if(cr(dt)!=="array")return[new yi(st,dt,`array expected, ${cr(dt)} found`)];if(dt.length!==2)return[new yi(st,dt,`array length 2 expected, length ${dt.length} found`)];if(ne){if(cr(dt[0])!=="object")return[new yi(st,dt,`object expected, ${cr(dt[0])} found`)];if(dt[0].zoom===void 0)return[new yi(st,dt,"object stop key must have zoom")];if(dt[0].value===void 0)return[new yi(st,dt,"object stop key must have value")];if(z&&z>jn(dt[0].zoom))return[new yi(st,dt[0].zoom,"stop zoom values must appear in ascending order")];jn(dt[0].zoom)!==z&&(z=jn(dt[0].zoom),I=void 0,B={}),Ie=Ie.concat(ca({key:`${st}[0]`,value:dt[0],valueSpec:{zoom:{}},style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{zoom:Zh,value:be}}))}else Ie=Ie.concat(be({key:`${st}[0]`,value:dt[0],valueSpec:{},style:Ce.style,styleSpec:Ce.styleSpec},dt));return zc(ro(dt[1]))?Ie.concat([new yi(`${st}[1]`,dt[1],"expressions are not allowed in function stops.")]):Ie.concat(zs({key:`${st}[1]`,value:dt[1],valueSpec:s,style:Ce.style,styleSpec:Ce.styleSpec}))}function be(Ce,Ie){const dt=cr(Ce.value),st=jn(Ce.value),Pt=Ce.value!==null?Ce.value:Ie;if(v){if(dt!==v)return[new yi(Ce.key,Pt,`${dt} stop domain type must match previous stop domain type ${v}`)]}else v=dt;if(dt!=="number"&&dt!=="string"&&dt!=="boolean")return[new yi(Ce.key,Pt,"stop domain value must be a number, string, or boolean")];if(dt!=="number"&&h!=="categorical"){let Xt=`number expected, ${dt} found`;return jr(s)&&h===void 0&&(Xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yi(Ce.key,Pt,Xt)]}return h!=="categorical"||dt!=="number"||isFinite(st)&&Math.floor(st)===st?h!=="categorical"&&dt==="number"&&I!==void 0&&st<I?[new yi(Ce.key,Pt,"stop domain values must appear in ascending order")]:(I=st,h==="categorical"&&st in B?[new yi(Ce.key,Pt,"stop domain values must be unique")]:(B[st]=!0,[])):[new yi(Ce.key,Pt,`integer expected, found ${st}`)]}}function ua(c){const s=(c.expressionContext==="property"?Au:Dc)(ro(c.value),c.valueSpec);if(s.result==="error")return s.value.map(v=>new yi(`${c.key}${v.key}`,c.value,v.message));const h=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new yi(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Ba(h))return[new yi(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Ba(h))return[new yi(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Sl(h,["zoom","feature-state"]))return[new yi(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!nl(h))return[new yi(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fc(c){const s=c.key,h=c.value,v=c.valueSpec,I=[];return Array.isArray(v.values)?v.values.indexOf(jn(h))===-1&&I.push(new yi(s,h,`expected one of [${v.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(v.values).indexOf(jn(h))===-1&&I.push(new yi(s,h,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(h)} found`)),I}function ll(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!ll(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Wh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gs(c){if(c==null)return{filter:()=>!0,needGeometry:!1};ll(c)||(c=zl(c));const s=Dc(c,Wh);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,v,I)=>s.value.evaluate(h,v,{},I),needGeometry:ph(c)}}function Mu(c,s){return c<s?-1:c>s?1:0}function ph(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(ph(c[s]))return!0;return!1}function zl(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?mh(c[1],c[2],"=="):s==="!="?cl(mh(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?mh(c[1],c[2],s):s==="any"?(h=c.slice(1),["any"].concat(h.map(zl))):s==="all"?["all"].concat(c.slice(1).map(zl)):s==="none"?["all"].concat(c.slice(1).map(zl).map(cl)):s==="in"?Vc(c[1],c.slice(2)):s==="!in"?cl(Vc(c[1],c.slice(2))):s==="has"?Nc(c[1]):s==="!has"?cl(Nc(c[1])):s!=="within"||c;var h}function mh(c,s,h){switch(c){case"$type":return[`filter-type-${h}`,s];case"$id":return[`filter-id-${h}`,s];default:return[`filter-${h}`,c,s]}}function Vc(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(h=>typeof h!=typeof s[0])?["filter-in-large",c,["literal",s.sort(Mu)]]:["filter-in-small",c,["literal",s]]}}function Nc(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function cl(c){return["!",c]}function Uc(c){return ll(ro(c.value))?ua(Eo({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ku(c)}function ku(c){const s=c.value,h=c.key;if(cr(s)!=="array")return[new yi(h,s,`array expected, ${cr(s)} found`)];const v=c.styleSpec;let I,z=[];if(s.length<1)return[new yi(h,s,"filter array must have at least 1 element")];switch(z=z.concat(Fc({key:`${h}[0]`,value:s[0],valueSpec:v.filter_operator,style:c.style,styleSpec:c.styleSpec})),jn(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&jn(s[1])==="$type"&&z.push(new yi(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&z.push(new yi(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(I=cr(s[1]),I!=="string"&&z.push(new yi(`${h}[1]`,s[1],`string expected, ${I} found`)));for(let B=2;B<s.length;B++)I=cr(s[B]),jn(s[1])==="$type"?z=z.concat(Fc({key:`${h}[${B}]`,value:s[B],valueSpec:v.geometry_type,style:c.style,styleSpec:c.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&z.push(new yi(`${h}[${B}]`,s[B],`string, number, or boolean expected, ${I} found`));break;case"any":case"all":case"none":for(let B=1;B<s.length;B++)z=z.concat(ku({key:`${h}[${B}]`,value:s[B],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":I=cr(s[1]),s.length!==2?z.push(new yi(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):I!=="string"&&z.push(new yi(`${h}[1]`,s[1],`string expected, ${I} found`));break;case"within":I=cr(s[1]),s.length!==2?z.push(new yi(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):I!=="object"&&z.push(new yi(`${h}[1]`,s[1],`object expected, ${I} found`))}return z}function Pu(c,s){const h=c.key,v=c.style,I=c.styleSpec,z=c.value,B=c.objectKey,U=I[`${s}_${c.layerType}`];if(!U)return[];const Z=B.match(/^(.*)-transition$/);if(s==="paint"&&Z&&U[Z[1]]&&U[Z[1]].transition)return zs({key:h,value:z,valueSpec:I.transition,style:v,styleSpec:I});const ne=c.valueSpec||U[B];if(!ne)return[new yi(h,z,`unknown property "${B}"`)];let de;if(cr(z)==="string"&&jr(ne)&&!ne.tokens&&(de=/^{([^}]+)}$/.exec(z)))return[new yi(h,z,`"${B}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(de[1])} }\`.`)];const _e=[];return c.layerType==="symbol"&&(B==="text-field"&&v&&!v.glyphs&&_e.push(new yi(h,z,'use of "text-field" requires a style "glyphs" property')),B==="text-font"&&Lr(ro(z))&&jn(z.type)==="identity"&&_e.push(new yi(h,z,'"text-font" does not support identity functions'))),_e.concat(zs({key:c.key,value:z,valueSpec:ne,style:v,styleSpec:I,expressionContext:"property",propertyType:s,propertyKey:B}))}function gh(c){return Pu(c,"paint")}function Vd(c){return Pu(c,"layout")}function oc(c){let s=[];const h=c.value,v=c.key,I=c.style,z=c.styleSpec;h.type||h.ref||s.push(new yi(v,h,'either "type" or "ref" is required'));let B=jn(h.type);const U=jn(h.ref);if(h.id){const Z=jn(h.id);for(let ne=0;ne<c.arrayIndex;ne++){const de=I.layers[ne];jn(de.id)===Z&&s.push(new yi(v,h.id,`duplicate layer id "${h.id}", previously used at line ${de.id.__line__}`))}}if("ref"in h){let Z;["type","source","source-layer","filter","layout"].forEach(ne=>{ne in h&&s.push(new yi(v,h[ne],`"${ne}" is prohibited for ref layers`))}),I.layers.forEach(ne=>{jn(ne.id)===U&&(Z=ne)}),Z?Z.ref?s.push(new yi(v,h.ref,"ref cannot reference another ref layer")):B=jn(Z.type):s.push(new yi(v,h.ref,`ref layer "${U}" not found`))}else if(B!=="background")if(h.source){const Z=I.sources&&I.sources[h.source],ne=Z&&jn(Z.type);Z?ne==="vector"&&B==="raster"?s.push(new yi(v,h.source,`layer "${h.id}" requires a raster source`)):ne==="raster"&&B!=="raster"?s.push(new yi(v,h.source,`layer "${h.id}" requires a vector source`)):ne!=="vector"||h["source-layer"]?ne==="raster-dem"&&B!=="hillshade"?s.push(new yi(v,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):B!=="line"||!h.paint||!h.paint["line-gradient"]||ne==="geojson"&&Z.lineMetrics||s.push(new yi(v,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new yi(v,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new yi(v,h.source,`source "${h.source}" not found`))}else s.push(new yi(v,h,'missing required property "source"'));return s=s.concat(ca({key:v,value:h,valueSpec:z.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zs({key:`${v}.type`,value:h.type,valueSpec:z.layer.type,style:c.style,styleSpec:c.styleSpec,object:h,objectKey:"type"}),filter:Uc,layout:Z=>ca({layer:h,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":ne=>Vd(Eo({layerType:B},ne))}}),paint:Z=>ca({layer:h,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":ne=>gh(Eo({layerType:B},ne))}})}})),s}function sc(c){const s=c.value,h=c.key,v=cr(s);return v!=="string"?[new yi(h,s,`string expected, ${v} found`)]:[]}const $c={promoteId:function({key:c,value:s}){if(cr(s)==="string")return sc({key:c,value:s});{const h=[];for(const v in s)h.push(...sc({key:`${c}.${v}`,value:s[v]}));return h}}};function zu(c){const s=c.value,h=c.key,v=c.styleSpec,I=c.style;if(!s.type)return[new yi(h,s,'"type" is required')];const z=jn(s.type);let B;switch(z){case"vector":case"raster":case"raster-dem":return B=ca({key:h,value:s,valueSpec:v[`source_${z.replace("-","_")}`],style:c.style,styleSpec:v,objectElementValidators:$c}),B;case"geojson":if(B=ca({key:h,value:s,valueSpec:v.source_geojson,style:I,styleSpec:v,objectElementValidators:$c}),s.cluster)for(const U in s.clusterProperties){const[Z,ne]=s.clusterProperties[U],de=typeof Z=="string"?[Z,["accumulated"],["get",U]]:Z;B.push(...ua({key:`${h}.${U}.map`,value:ne,expressionContext:"cluster-map"})),B.push(...ua({key:`${h}.${U}.reduce`,value:de,expressionContext:"cluster-reduce"}))}return B;case"video":return ca({key:h,value:s,valueSpec:v.source_video,style:I,styleSpec:v});case"image":return ca({key:h,value:s,valueSpec:v.source_image,style:I,styleSpec:v});case"canvas":return[new yi(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fc({key:`${h}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:I,styleSpec:v})}}function jc(c){const s=c.value,h=c.styleSpec,v=h.light,I=c.style;let z=[];const B=cr(s);if(s===void 0)return z;if(B!=="object")return z=z.concat([new yi("light",s,`object expected, ${B} found`)]),z;for(const U in s){const Z=U.match(/^(.*)-transition$/);z=z.concat(Z&&v[Z[1]]&&v[Z[1]].transition?zs({key:U,value:s[U],valueSpec:h.transition,style:I,styleSpec:h}):v[U]?zs({key:U,value:s[U],valueSpec:v[U],style:I,styleSpec:h}):[new yi(U,s[U],`unknown property "${U}"`)])}return z}function Ps(c){const s=c.value,h=c.styleSpec,v=h.terrain,I=c.style;let z=[];const B=cr(s);if(s===void 0)return z;if(B!=="object")return z=z.concat([new yi("terrain",s,`object expected, ${B} found`)]),z;for(const U in s)z=z.concat(v[U]?zs({key:U,value:s[U],valueSpec:v[U],style:I,styleSpec:h}):[new yi(U,s[U],`unknown property "${U}"`)]);return z}const va={"*":()=>[],array:qh,boolean:function(c){const s=c.value,h=c.key,v=cr(s);return v!=="boolean"?[new yi(h,s,`boolean expected, ${v} found`)]:[]},number:Zh,color:function(c){const s=c.key,h=c.value,v=cr(h);return v!=="string"?[new yi(s,h,`color expected, ${v} found`)]:Oe(h)===null?[new yi(s,h,`color expected, "${h}" found`)]:[]},constants:Pr,enum:Fc,filter:Uc,function:Oc,layer:oc,object:ca,source:zu,light:jc,terrain:Ps,string:sc,formatted:function(c){return sc(c).length===0?[]:ua(c)},resolvedImage:function(c){return sc(c).length===0?[]:ua(c)},padding:function(c){const s=c.key,h=c.value;if(cr(h)==="array"){if(h.length<1||h.length>4)return[new yi(s,h,`padding requires 1 to 4 values; ${h.length} values found`)];const v={type:"number"};let I=[];for(let z=0;z<h.length;z++)I=I.concat(zs({key:`${s}[${z}]`,value:h[z],valueSpec:v}));return I}return Zh({key:s,value:h,valueSpec:{}})}};function zs(c){const s=c.value,h=c.valueSpec,v=c.styleSpec;return h.expression&&Lr(jn(s))?Oc(c):h.expression&&zc(ro(s))?ua(c):h.type&&va[h.type]?va[h.type](c):ca(Eo({},c,{valueSpec:h.type?v[h.type]:h}))}function Nd(c){const s=c.value,h=c.key,v=sc(c);return v.length||(s.indexOf("{fontstack}")===-1&&v.push(new yi(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&v.push(new yi(h,s,'"glyphs" url must include a "{range}" token'))),v}function Va(c,s=Ot){let h=[];return h=h.concat(zs({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,objectElementValidators:{glyphs:Nd,"*":()=>[]}})),c.constants&&(h=h.concat(Pr({key:"constants",value:c.constants,style:c,styleSpec:s}))),Ud(h)}function Ud(c){return[].concat(c).sort((s,h)=>s.line-h.line)}function ul(c){return function(...s){return Ud(c.apply(this,s))}}Va.source=ul(zu),Va.light=ul(jc),Va.terrain=ul(Ps),Va.layer=ul(oc),Va.filter=ul(Uc),Va.paintProperty=ul(gh),Va.layoutProperty=ul(Vd);const Du=Va,Lu=Du.light,Xh=Du.paintProperty,$d=Du.layoutProperty;function Bu(c,s){let h=!1;if(s&&s.length)for(const v of s)c.fire(new On(new Error(v.message))),h=!0;return h}class ac{constructor(s,h,v){const I=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const B=new Int32Array(this.arrayBuffer);s=B[0],this.d=(h=B[1])+2*(v=B[2]);for(let Z=0;Z<this.d*this.d;Z++){const ne=B[3+Z],de=B[3+Z+1];I.push(ne===de?null:B.subarray(ne,de))}const U=B[3+I.length+1];this.keys=B.subarray(B[3+I.length],U),this.bboxes=B.subarray(U),this.insert=this._insertReadonly}else{this.d=h+2*v;for(let B=0;B<this.d*this.d;B++)I.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=v,this.scale=h/s,this.uid=0;const z=v/h*s;this.min=-z,this.max=s+z}insert(s,h,v,I,z){this._forEachCell(h,v,I,z,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(I),this.bboxes.push(z)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,h,v,I,z,B){this.cells[z].push(B)}query(s,h,v,I,z){const B=this.min,U=this.max;if(s<=B&&h<=B&&U<=v&&U<=I&&!z)return Array.prototype.slice.call(this.keys);{const Z=[];return this._forEachCell(s,h,v,I,this._queryCell,Z,{},z),Z}}_queryCell(s,h,v,I,z,B,U,Z){const ne=this.cells[z];if(ne!==null){const de=this.keys,_e=this.bboxes;for(let be=0;be<ne.length;be++){const Ce=ne[be];if(U[Ce]===void 0){const Ie=4*Ce;(Z?Z(_e[Ie+0],_e[Ie+1],_e[Ie+2],_e[Ie+3]):s<=_e[Ie+2]&&h<=_e[Ie+3]&&v>=_e[Ie+0]&&I>=_e[Ie+1])?(U[Ce]=!0,B.push(de[Ce])):U[Ce]=!1}}}}_forEachCell(s,h,v,I,z,B,U,Z){const ne=this._convertToCellCoord(s),de=this._convertToCellCoord(h),_e=this._convertToCellCoord(v),be=this._convertToCellCoord(I);for(let Ce=ne;Ce<=_e;Ce++)for(let Ie=de;Ie<=be;Ie++){const dt=this.d*Ie+Ce;if((!Z||Z(this._convertFromCellCoord(Ce),this._convertFromCellCoord(Ie),this._convertFromCellCoord(Ce+1),this._convertFromCellCoord(Ie+1)))&&z.call(this,s,h,v,I,dt,B,U,Z))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,h=3+this.cells.length+1+1;let v=0;for(let B=0;B<this.cells.length;B++)v+=this.cells[B].length;const I=new Int32Array(h+v+this.keys.length+this.bboxes.length);I[0]=this.extent,I[1]=this.n,I[2]=this.padding;let z=h;for(let B=0;B<s.length;B++){const U=s[B];I[3+B]=z,I.set(U,z),z+=U.length}return I[3+s.length]=z,I.set(this.keys,z),z+=this.keys.length,I[3+s.length+1]=z,I.set(this.bboxes,z),z+=this.bboxes.length,I.buffer}static serialize(s,h){const v=s.toArrayBuffer();return h&&h.push(v),{buffer:v}}static deserialize(s){return new ac(s.buffer)}}const ha={};function Zi(c,s,h={}){if(ha[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),ha[c]={klass:s,omit:h.omit||[],shallow:h.shallow||[]}}Zi("Object",Object),Zi("TransferableGridIndex",ac),Zi("Color",he),Zi("Error",Error),Zi("AJAXError",bt),Zi("ResolvedImage",it),Zi("StylePropertyFunction",Bc),Zi("StyleExpression",rc,{omit:["_evaluator"]}),Zi("ZoomDependentExpression",Lc),Zi("ZoomConstantExpression",Iu),Zi("CompoundExpression",Fn,{omit:["_evaluate"]});for(const c in nc)nc[c]._classRegistryKey||Zi(`Expression_${c}`,nc[c]);function Gc(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Dl(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(Gc(c)||Nt(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return s&&s.push(h.buffer),h}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const v of c)h.push(Dl(v,s));return h}if(typeof c=="object"){const h=c.constructor,v=h._classRegistryKey;if(!v)throw new Error("can't serialize object of unregistered class");if(!ha[v])throw new Error(`${v} is not registered.`);const I=h.serialize?h.serialize(c,s):{};if(h.serialize){if(s&&I===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const z in c){if(!c.hasOwnProperty(z)||ha[v].omit.indexOf(z)>=0)continue;const B=c[z];I[z]=ha[v].shallow.indexOf(z)>=0?B:Dl(B,s)}c instanceof Error&&(I.message=c.message)}if(I.$name)throw new Error("$name property is reserved for worker serialization logic.");return v!=="Object"&&(I.$name=v),I}throw new Error("can't serialize object of type "+typeof c)}function No(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||Gc(c)||Nt(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(No);if(typeof c=="object"){const s=c.$name||"Object";if(!ha[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:h}=ha[s];if(!h)throw new Error(`can't deserialize unregistered class ${s}`);if(h.deserialize)return h.deserialize(c);const v=Object.create(h.prototype);for(const I of Object.keys(c)){if(I==="$name")continue;const z=c[I];v[I]=ha[s].shallow.indexOf(I)>=0?z:No(z)}return v}throw new Error("can't deserialize object of type "+typeof c)}class hl{constructor(){this.first=!0}update(s,h){const v=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=v,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=v,!0):(this.lastFloorZoom>v?(this.lastIntegerZoom=v+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<v&&(this.lastIntegerZoom=v,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=v,!0))}}const Ni={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function qc(c){for(const s of c)if(Hh(s.charCodeAt(0)))return!0;return!1}function Sr(c){for(const s of c)if(!lc(s.charCodeAt(0)))return!1;return!0}function lc(c){return!(Ni.Arabic(c)||Ni["Arabic Supplement"](c)||Ni["Arabic Extended-A"](c)||Ni["Arabic Presentation Forms-A"](c)||Ni["Arabic Presentation Forms-B"](c))}function Hh(c){return!(c!==746&&c!==747&&(c<4352||!(Ni["Bopomofo Extended"](c)||Ni.Bopomofo(c)||Ni["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Ni["CJK Compatibility Ideographs"](c)||Ni["CJK Compatibility"](c)||Ni["CJK Radicals Supplement"](c)||Ni["CJK Strokes"](c)||!(!Ni["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Ni["CJK Unified Ideographs Extension A"](c)||Ni["CJK Unified Ideographs"](c)||Ni["Enclosed CJK Letters and Months"](c)||Ni["Hangul Compatibility Jamo"](c)||Ni["Hangul Jamo Extended-A"](c)||Ni["Hangul Jamo Extended-B"](c)||Ni["Hangul Jamo"](c)||Ni["Hangul Syllables"](c)||Ni.Hiragana(c)||Ni["Ideographic Description Characters"](c)||Ni.Kanbun(c)||Ni["Kangxi Radicals"](c)||Ni["Katakana Phonetic Extensions"](c)||Ni.Katakana(c)&&c!==12540||!(!Ni["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Ni["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Ni["Unified Canadian Aboriginal Syllabics"](c)||Ni["Unified Canadian Aboriginal Syllabics Extended"](c)||Ni["Vertical Forms"](c)||Ni["Yijing Hexagram Symbols"](c)||Ni["Yi Syllables"](c)||Ni["Yi Radicals"](c))))}function Ru(c){return!(Hh(c)||function(s){return!!(Ni["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Ni["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Ni["Letterlike Symbols"](s)||Ni["Number Forms"](s)||Ni["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Ni["Control Pictures"](s)&&s!==9251||Ni["Optical Character Recognition"](s)||Ni["Enclosed Alphanumerics"](s)||Ni["Geometric Shapes"](s)||Ni["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Ni["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Ni["CJK Symbols and Punctuation"](s)||Ni.Katakana(s)||Ni["Private Use Area"](s)||Ni["CJK Compatibility Forms"](s)||Ni["Small Form Variants"](s)||Ni["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function cc(c){return c>=1424&&c<=2303||Ni["Arabic Presentation Forms-A"](c)||Ni["Arabic Presentation Forms-B"](c)}function Kh(c,s){return!(!s&&cc(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Ni.Khmer(c))}function Yh(c){for(const s of c)if(cc(s.charCodeAt(0)))return!0;return!1}const Ou="deferred",Fu="loading",Zc="loaded";let uc=null,Po="unavailable",bs=null;const Vu=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Po="error"),uc&&uc(c)};function Ll(){Bl.fire(new Tn("pluginStateChange",{pluginStatus:Po,pluginURL:bs}))}const Bl=new qn,dl=function(){return Po},ji=function(){if(Po!==Ou||!bs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Po=Fu,Ll(),bs&&Mi({url:bs},c=>{c?Vu(c):(Po=Zc,Ll())})},vo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Po===Zc||vo.applyArabicShaping!=null,isLoading:()=>Po===Fu,setState(c){if(!rt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Po=c.pluginStatus,bs=c.pluginURL},isParsed(){if(!rt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return vo.applyArabicShaping!=null&&vo.processBidirectionalText!=null&&vo.processStyledBidirectionalText!=null},getPluginURL(){if(!rt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return bs}};class Rr{constructor(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hl,this.transition={})}isSupportedScript(s){return function(h,v){for(const I of h)if(!Kh(I.charCodeAt(0),v))return!1;return!0}(s,vo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,h=s-Math.floor(s),v=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*v}:{fromScale:.5,toScale:1,t:1-(1-v)*h}}}class Wc{constructor(s,h){this.property=s,this.value=h,this.expression=function(v,I){if(Lr(v))return new Bc(v,I);if(zc(v)){const z=Au(v,I);if(z.result==="error")throw new Error(z.value.map(B=>`${B.key}: ${B.message}`).join(", "));return z.value}{let z=v;return I.type==="color"&&typeof v=="string"?z=he.parse(v):I.type!=="padding"||typeof v!="number"&&!Array.isArray(v)||(z=Ue.parse(v)),{kind:"constant",evaluate:()=>z}}}(h===void 0?s.specification.default:h,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,h,v){return this.property.possiblyEvaluate(this,s,h,v)}}class Nu{constructor(s){this.property=s,this.value=new Wc(s,void 0)}transitioned(s,h){return new Jh(this.property,this.value,h,me({},s.transition,this.transition),s.now)}untransitioned(){return new Jh(this.property,this.value,null,{},0)}}class hc{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Ae(this._values[s].value.value)}setValue(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Nu(this._values[s].property)),this._values[s].value=new Wc(this._values[s].property,h===null?void 0:Ae(h))}getTransition(s){return Ae(this._values[s].transition)}setTransition(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Nu(this._values[s].property)),this._values[s].transition=Ae(h)||void 0}serialize(){const s={};for(const h of Object.keys(this._values)){const v=this.getValue(h);v!==void 0&&(s[h]=v);const I=this.getTransition(h);I!==void 0&&(s[`${h}-transition`]=I)}return s}transitioned(s,h){const v=new Uu(this._properties);for(const I of Object.keys(this._values))v._values[I]=this._values[I].transitioned(s,h._values[I]);return v}untransitioned(){const s=new Uu(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].untransitioned();return s}}class Jh{constructor(s,h,v,I,z){this.property=s,this.value=h,this.begin=z+I.delay||0,this.end=this.begin+I.duration||0,s.specification.transition&&(I.delay||I.duration)&&(this.prior=v)}possiblyEvaluate(s,h,v){const I=s.now||0,z=this.value.possiblyEvaluate(s,h,v),B=this.prior;if(B){if(I>this.end)return this.prior=null,z;if(this.value.isDataDriven())return this.prior=null,z;if(I<this.begin)return B.possiblyEvaluate(s,h,v);{const U=(I-this.begin)/(this.end-this.begin);return this.property.interpolate(B.possiblyEvaluate(s,h,v),z,function(Z){if(Z<=0)return 0;if(Z>=1)return 1;const ne=Z*Z,de=ne*Z;return 4*(Z<.5?de:3*(Z-ne)+de-.75)}(U))}}return z}}class Uu{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,h,v){const I=new os(this._properties);for(const z of Object.keys(this._values))I._values[z]=this._values[z].possiblyEvaluate(s,h,v);return I}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Xc{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}getValue(s){return Ae(this._values[s].value)}setValue(s,h){this._values[s]=new Wc(this._values[s].property,h===null?void 0:Ae(h))}serialize(){const s={};for(const h of Object.keys(this._values)){const v=this.getValue(h);v!==void 0&&(s[h]=v)}return s}possiblyEvaluate(s,h,v){const I=new os(this._properties);for(const z of Object.keys(this._values))I._values[z]=this._values[z].possiblyEvaluate(s,h,v);return I}}class gs{constructor(s,h,v){this.property=s,this.value=h,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,h,v,I){return this.property.evaluate(this.value,this.parameters,s,h,v,I)}}class os{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class an{constructor(s){this.specification=s}possiblyEvaluate(s,h){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(h)}interpolate(s,h,v){const I=rs[this.specification.type];return I?I(s,h,v):s}}class yn{constructor(s,h){this.specification=s,this.overrides=h}possiblyEvaluate(s,h,v,I){return new gs(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(h,null,{},v,I)}:s.expression,h)}interpolate(s,h,v){if(s.value.kind!=="constant"||h.value.kind!=="constant")return s;if(s.value.value===void 0||h.value.value===void 0)return new gs(this,{kind:"constant",value:void 0},s.parameters);const I=rs[this.specification.type];return I?new gs(this,{kind:"constant",value:I(s.value.value,h.value.value,v)},s.parameters):s}evaluate(s,h,v,I,z,B){return s.kind==="constant"?s.value:s.evaluate(h,v,I,z,B)}}class Hc extends yn{possiblyEvaluate(s,h,v,I){if(s.value===void 0)return new gs(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){const z=s.expression.evaluate(h,null,{},v,I),B=s.property.specification.type==="resolvedImage"&&typeof z!="string"?z.name:z,U=this._calculate(B,B,B,h);return new gs(this,{kind:"constant",value:U},h)}if(s.expression.kind==="camera"){const z=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new gs(this,{kind:"constant",value:z},h)}return new gs(this,s.expression,h)}evaluate(s,h,v,I,z,B){if(s.kind==="source"){const U=s.evaluate(h,v,I,z,B);return this._calculate(U,U,U,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},v,I),s.evaluate({zoom:Math.floor(h.zoom)},v,I),s.evaluate({zoom:Math.floor(h.zoom)+1},v,I),h):s.value}_calculate(s,h,v,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:v,to:h}}interpolate(s){return s}}class Qh{constructor(s){this.specification=s}possiblyEvaluate(s,h,v,I){if(s.value!==void 0){if(s.expression.kind==="constant"){const z=s.expression.evaluate(h,null,{},v,I);return this._calculate(z,z,z,h)}return this._calculate(s.expression.evaluate(new Rr(Math.floor(h.zoom-1),h)),s.expression.evaluate(new Rr(Math.floor(h.zoom),h)),s.expression.evaluate(new Rr(Math.floor(h.zoom+1),h)),h)}}_calculate(s,h,v,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:v,to:h}}interpolate(s){return s}}class fl{constructor(s){this.specification=s}possiblyEvaluate(s,h,v,I){return!!s.expression.evaluate(h,null,{},v,I)}interpolate(){return!1}}class Ao{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in s){const v=s[h];v.specification.overridable&&this.overridableProperties.push(h);const I=this.defaultPropertyValues[h]=new Wc(v,void 0),z=this.defaultTransitionablePropertyValues[h]=new Nu(v);this.defaultTransitioningPropertyValues[h]=z.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=I.possiblyEvaluate({})}}}Zi("DataDrivenProperty",yn),Zi("DataConstantProperty",an),Zi("CrossFadedDataDrivenProperty",Hc),Zi("CrossFadedProperty",Qh),Zi("ColorRampProperty",fl);const Na="-transition";class qs extends qn{constructor(s,h){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Xc(h.layout)),h.paint)){this._transitionablePaint=new hc(h.paint);for(const v in s.paint)this.setPaintProperty(v,s.paint[v],{validate:!1});for(const v in s.layout)this.setLayoutProperty(v,s.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new os(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,h,v={}){h!=null&&this._validate($d,`layers.${this.id}.layout.${s}`,s,h,v)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)}getPaintProperty(s){return s.endsWith(Na)?this._transitionablePaint.getTransition(s.slice(0,-Na.length)):this._transitionablePaint.getValue(s)}setPaintProperty(s,h,v={}){if(h!=null&&this._validate(Xh,`layers.${this.id}.paint.${s}`,s,h,v))return!1;if(s.endsWith(Na))return this._transitionablePaint.setTransition(s.slice(0,-Na.length),h||void 0),!1;{const I=this._transitionablePaint._values[s],z=I.property.specification["property-type"]==="cross-faded-data-driven",B=I.value.isDataDriven(),U=I.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);const Z=this._transitionablePaint._values[s].value;return Z.isDataDriven()||B||z||this._handleOverridablePaintPropertyUpdate(s,U,Z)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,h,v){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),tt(s,(h,v)=>!(h===void 0||v==="layout"&&!Object.keys(h).length||v==="paint"&&!Object.keys(h).length))}_validate(s,h,v,I,z={}){return(!z||z.validate!==!1)&&Bu(this,s.call(Du,{key:h,layerType:this.type,objectKey:v,value:I,styleSpec:Ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const h=this.paint.get(s);if(h instanceof gs&&jr(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const ed={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xa{constructor(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class to{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function zo(c,s=1){let h=0,v=0;return{members:c.map(I=>{const z=ed[I.type].BYTES_PER_ELEMENT,B=h=$u(h,Math.max(s,z)),U=I.components||1;return v=Math.max(v,z),h+=z*U,{name:I.name,type:I.type,components:U,offset:B}}),size:$u(h,Math.max(v,s)),alignment:s}}function $u(c,s){return Math.ceil(c/s)*s}class pl extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h){const v=this.length;return this.resize(v+1),this.emplace(v,s,h)}emplace(s,h,v){const I=2*s;return this.int16[I+0]=h,this.int16[I+1]=v,s}}pl.prototype.bytesPerElement=4,Zi("StructArrayLayout2i4",pl);class C extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,v,I){const z=this.length;return this.resize(z+1),this.emplace(z,s,h,v,I)}emplace(s,h,v,I,z){const B=4*s;return this.int16[B+0]=h,this.int16[B+1]=v,this.int16[B+2]=I,this.int16[B+3]=z,s}}C.prototype.bytesPerElement=8,Zi("StructArrayLayout4i8",C);class a extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B){const U=this.length;return this.resize(U+1),this.emplace(U,s,h,v,I,z,B)}emplace(s,h,v,I,z,B,U){const Z=6*s;return this.int16[Z+0]=h,this.int16[Z+1]=v,this.int16[Z+2]=I,this.int16[Z+3]=z,this.int16[Z+4]=B,this.int16[Z+5]=U,s}}a.prototype.bytesPerElement=12,Zi("StructArrayLayout2i4i12",a);class m extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B){const U=this.length;return this.resize(U+1),this.emplace(U,s,h,v,I,z,B)}emplace(s,h,v,I,z,B,U){const Z=4*s,ne=8*s;return this.int16[Z+0]=h,this.int16[Z+1]=v,this.uint8[ne+4]=I,this.uint8[ne+5]=z,this.uint8[ne+6]=B,this.uint8[ne+7]=U,s}}m.prototype.bytesPerElement=8,Zi("StructArrayLayout2i4ub8",m);class T extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h){const v=this.length;return this.resize(v+1),this.emplace(v,s,h)}emplace(s,h,v){const I=2*s;return this.float32[I+0]=h,this.float32[I+1]=v,s}}T.prototype.bytesPerElement=8,Zi("StructArrayLayout2f8",T);class A extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B,U,Z,ne,de){const _e=this.length;return this.resize(_e+1),this.emplace(_e,s,h,v,I,z,B,U,Z,ne,de)}emplace(s,h,v,I,z,B,U,Z,ne,de,_e){const be=10*s;return this.uint16[be+0]=h,this.uint16[be+1]=v,this.uint16[be+2]=I,this.uint16[be+3]=z,this.uint16[be+4]=B,this.uint16[be+5]=U,this.uint16[be+6]=Z,this.uint16[be+7]=ne,this.uint16[be+8]=de,this.uint16[be+9]=_e,s}}A.prototype.bytesPerElement=20,Zi("StructArrayLayout10ui20",A);class L extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B,U,Z,ne,de,_e,be){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,s,h,v,I,z,B,U,Z,ne,de,_e,be)}emplace(s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce){const Ie=12*s;return this.int16[Ie+0]=h,this.int16[Ie+1]=v,this.int16[Ie+2]=I,this.int16[Ie+3]=z,this.uint16[Ie+4]=B,this.uint16[Ie+5]=U,this.uint16[Ie+6]=Z,this.uint16[Ie+7]=ne,this.int16[Ie+8]=de,this.int16[Ie+9]=_e,this.int16[Ie+10]=be,this.int16[Ie+11]=Ce,s}}L.prototype.bytesPerElement=24,Zi("StructArrayLayout4i4ui4i24",L);class N extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,v){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,v)}emplace(s,h,v,I){const z=3*s;return this.float32[z+0]=h,this.float32[z+1]=v,this.float32[z+2]=I,s}}N.prototype.bytesPerElement=12,Zi("StructArrayLayout3f12",N);class H extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint32[1*s+0]=h,s}}H.prototype.bytesPerElement=4,Zi("StructArrayLayout1ul4",H);class Q extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B,U,Z,ne){const de=this.length;return this.resize(de+1),this.emplace(de,s,h,v,I,z,B,U,Z,ne)}emplace(s,h,v,I,z,B,U,Z,ne,de){const _e=10*s,be=5*s;return this.int16[_e+0]=h,this.int16[_e+1]=v,this.int16[_e+2]=I,this.int16[_e+3]=z,this.int16[_e+4]=B,this.int16[_e+5]=U,this.uint32[be+3]=Z,this.uint16[_e+8]=ne,this.uint16[_e+9]=de,s}}Q.prototype.bytesPerElement=20,Zi("StructArrayLayout6i1ul2ui20",Q);class se extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B){const U=this.length;return this.resize(U+1),this.emplace(U,s,h,v,I,z,B)}emplace(s,h,v,I,z,B,U){const Z=6*s;return this.int16[Z+0]=h,this.int16[Z+1]=v,this.int16[Z+2]=I,this.int16[Z+3]=z,this.int16[Z+4]=B,this.int16[Z+5]=U,s}}se.prototype.bytesPerElement=12,Zi("StructArrayLayout2i2i2i12",se);class pe extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z){const B=this.length;return this.resize(B+1),this.emplace(B,s,h,v,I,z)}emplace(s,h,v,I,z,B){const U=4*s,Z=8*s;return this.float32[U+0]=h,this.float32[U+1]=v,this.float32[U+2]=I,this.int16[Z+6]=z,this.int16[Z+7]=B,s}}pe.prototype.bytesPerElement=16,Zi("StructArrayLayout2f1f2i16",pe);class xe extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,v,I){const z=this.length;return this.resize(z+1),this.emplace(z,s,h,v,I)}emplace(s,h,v,I,z){const B=12*s,U=3*s;return this.uint8[B+0]=h,this.uint8[B+1]=v,this.float32[U+1]=I,this.float32[U+2]=z,s}}xe.prototype.bytesPerElement=12,Zi("StructArrayLayout2ub2f12",xe);class Ee extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,v){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,v)}emplace(s,h,v,I){const z=3*s;return this.uint16[z+0]=h,this.uint16[z+1]=v,this.uint16[z+2]=I,s}}Ee.prototype.bytesPerElement=6,Zi("StructArrayLayout3ui6",Ee);class Qe extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt,st,Pt){const Xt=this.length;return this.resize(Xt+1),this.emplace(Xt,s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt,st,Pt)}emplace(s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt,st,Pt,Xt){const Ct=24*s,jt=12*s,hi=48*s;return this.int16[Ct+0]=h,this.int16[Ct+1]=v,this.uint16[Ct+2]=I,this.uint16[Ct+3]=z,this.uint32[jt+2]=B,this.uint32[jt+3]=U,this.uint32[jt+4]=Z,this.uint16[Ct+10]=ne,this.uint16[Ct+11]=de,this.uint16[Ct+12]=_e,this.float32[jt+7]=be,this.float32[jt+8]=Ce,this.uint8[hi+36]=Ie,this.uint8[hi+37]=dt,this.uint8[hi+38]=st,this.uint32[jt+10]=Pt,this.int16[Ct+22]=Xt,s}}Qe.prototype.bytesPerElement=48,Zi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qe);class Ge extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt,st,Pt,Xt,Ct,jt,hi,li,nn,Wi,Xi,Ri,Di,Qi){const Hi=this.length;return this.resize(Hi+1),this.emplace(Hi,s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt,st,Pt,Xt,Ct,jt,hi,li,nn,Wi,Xi,Ri,Di,Qi)}emplace(s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt,st,Pt,Xt,Ct,jt,hi,li,nn,Wi,Xi,Ri,Di,Qi,Hi){const Ai=34*s,bn=17*s;return this.int16[Ai+0]=h,this.int16[Ai+1]=v,this.int16[Ai+2]=I,this.int16[Ai+3]=z,this.int16[Ai+4]=B,this.int16[Ai+5]=U,this.int16[Ai+6]=Z,this.int16[Ai+7]=ne,this.uint16[Ai+8]=de,this.uint16[Ai+9]=_e,this.uint16[Ai+10]=be,this.uint16[Ai+11]=Ce,this.uint16[Ai+12]=Ie,this.uint16[Ai+13]=dt,this.uint16[Ai+14]=st,this.uint16[Ai+15]=Pt,this.uint16[Ai+16]=Xt,this.uint16[Ai+17]=Ct,this.uint16[Ai+18]=jt,this.uint16[Ai+19]=hi,this.uint16[Ai+20]=li,this.uint16[Ai+21]=nn,this.uint16[Ai+22]=Wi,this.uint32[bn+12]=Xi,this.float32[bn+13]=Ri,this.float32[bn+14]=Di,this.float32[bn+15]=Qi,this.float32[bn+16]=Hi,s}}Ge.prototype.bytesPerElement=68,Zi("StructArrayLayout8i15ui1ul4f68",Ge);class We extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.float32[1*s+0]=h,s}}We.prototype.bytesPerElement=4,Zi("StructArrayLayout1f4",We);class _t extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,v){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,v)}emplace(s,h,v,I){const z=3*s;return this.int16[z+0]=h,this.int16[z+1]=v,this.int16[z+2]=I,s}}_t.prototype.bytesPerElement=6,Zi("StructArrayLayout3i6",_t);class Tt extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,v){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,v)}emplace(s,h,v,I){const z=4*s;return this.uint32[2*s+0]=h,this.uint16[z+2]=v,this.uint16[z+3]=I,s}}Tt.prototype.bytesPerElement=8,Zi("StructArrayLayout1ul2ui8",Tt);class kt extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h){const v=this.length;return this.resize(v+1),this.emplace(v,s,h)}emplace(s,h,v){const I=2*s;return this.uint16[I+0]=h,this.uint16[I+1]=v,s}}kt.prototype.bytesPerElement=4,Zi("StructArrayLayout2ui4",kt);class ot extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint16[1*s+0]=h,s}}ot.prototype.bytesPerElement=2,Zi("StructArrayLayout1ui2",ot);class ft extends to{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,v,I){const z=this.length;return this.resize(z+1),this.emplace(z,s,h,v,I)}emplace(s,h,v,I,z){const B=4*s;return this.float32[B+0]=h,this.float32[B+1]=v,this.float32[B+2]=I,this.float32[B+3]=z,s}}ft.prototype.bytesPerElement=16,Zi("StructArrayLayout4f16",ft);class Rt extends xa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new zt(this.anchorPointX,this.anchorPointY)}}Rt.prototype.size=20;class ii extends Q{get(s){return new Rt(this,s)}}Zi("CollisionBoxArray",ii);class Qt extends xa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Qt.prototype.size=48;class _i extends Qe{get(s){return new Qt(this,s)}}Zi("PlacedSymbolArray",_i);class Jt extends xa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Jt.prototype.size=68;class Ji extends Ge{get(s){return new Jt(this,s)}}Zi("SymbolInstanceArray",Ji);class Vi extends We{getoffsetX(s){return this.float32[1*s+0]}}Zi("GlyphOffsetArray",Vi);class en extends _t{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Zi("SymbolLineVertexArray",en);class Rn extends xa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Rn.prototype.size=8;class $n extends Tt{get(s){return new Rn(this,s)}}Zi("FeatureIndexArray",$n);class dn extends pl{}class xr extends pl{}class Cr extends pl{}class ur extends a{}class hr extends m{}class Dr extends T{}class Wo extends A{}class ba extends L{}class da extends N{}class wa extends H{}class Ua extends se{}class Zs extends xe{}class ws extends Ee{}class Ta extends kt{}const Rl=zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:_}=Rl;class o{constructor(s=[]){this.segments=s}prepareSegment(s,h,v,I){let z=this.segments[this.segments.length-1];return s>o.MAX_VERTEX_ARRAY_LENGTH&&Me(`Max vertices per segment is ${o.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!z||z.vertexLength+s>o.MAX_VERTEX_ARRAY_LENGTH||z.sortKey!==I)&&(z={vertexOffset:h.length,primitiveOffset:v.length,vertexLength:0,primitiveLength:0},I!==void 0&&(z.sortKey=I),this.segments.push(z)),z}get(){return this.segments}destroy(){for(const s of this.segments)for(const h in s.vaos)s.vaos[h].destroy()}static simpleSegment(s,h,v,I){return new o([{vertexOffset:s,primitiveOffset:h,vertexLength:v,primitiveLength:I,vaos:{},sortKey:0}])}}function f(c,s){return 256*(c=q(Math.floor(c),0,255))+q(Math.floor(s),0,255)}o.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zi("SegmentVector",o);const x=zo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var S={exports:{}},k={exports:{}};k.exports=function(c,s){var h,v,I,z,B,U,Z,ne;for(v=c.length-(h=3&c.length),I=s,B=3432918353,U=461845907,ne=0;ne<v;)Z=255&c.charCodeAt(ne)|(255&c.charCodeAt(++ne))<<8|(255&c.charCodeAt(++ne))<<16|(255&c.charCodeAt(++ne))<<24,++ne,I=27492+(65535&(z=5*(65535&(I=(I^=Z=(65535&(Z=(Z=(65535&Z)*B+(((Z>>>16)*B&65535)<<16)&4294967295)<<15|Z>>>17))*U+(((Z>>>16)*U&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(z>>>16)&65535)<<16);switch(Z=0,h){case 3:Z^=(255&c.charCodeAt(ne+2))<<16;case 2:Z^=(255&c.charCodeAt(ne+1))<<8;case 1:I^=Z=(65535&(Z=(Z=(65535&(Z^=255&c.charCodeAt(ne)))*B+(((Z>>>16)*B&65535)<<16)&4294967295)<<15|Z>>>17))*U+(((Z>>>16)*U&65535)<<16)&4294967295}return I^=c.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0};var O={exports:{}};O.exports=function(c,s){for(var h,v=c.length,I=s^v,z=0;v>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(z)|(255&c.charCodeAt(++z))<<8|(255&c.charCodeAt(++z))<<16|(255&c.charCodeAt(++z))<<24))+((1540483477*(h>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),v-=4,++z;switch(v){case 3:I^=(255&c.charCodeAt(z+2))<<16;case 2:I^=(255&c.charCodeAt(z+1))<<8;case 1:I=1540483477*(65535&(I^=255&c.charCodeAt(z)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0};var V=k.exports,G=O.exports;S.exports=V,S.exports.murmur3=V,S.exports.murmur2=G;class te{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,h,v,I){this.ids.push(ie(s)),this.positions.push(h,v,I)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=ie(s);let v=0,I=this.ids.length-1;for(;v<I;){const B=v+I>>1;this.ids[B]>=h?I=B:v=B+1}const z=[];for(;this.ids[v]===h;)z.push({index:this.positions[3*v],start:this.positions[3*v+1],end:this.positions[3*v+2]}),v++;return z}static serialize(s,h){const v=new Float64Array(s.ids),I=new Uint32Array(s.positions);return ge(v,I,0,v.length-1),h&&h.push(v.buffer,I.buffer),{ids:v,positions:I}}static deserialize(s){const h=new te;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h}}function ie(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:S.exports(String(c))}function ge(c,s,h,v){for(;h<v;){const I=c[h+v>>1];let z=h-1,B=v+1;for(;;){do z++;while(c[z]<I);do B--;while(c[B]>I);if(z>=B)break;Te(c,z,B),Te(s,3*z,3*B),Te(s,3*z+1,3*B+1),Te(s,3*z+2,3*B+2)}B-h<v-B?(ge(c,s,h,B),h=B+1):(ge(c,s,B+1,v),v=B)}}function Te(c,s,h){const v=c[s];c[s]=c[h],c[h]=v}Zi("FeaturePositionMap",te);class Be{constructor(s,h){this.gl=s.gl,this.location=h}}class Le extends Be{constructor(s,h){super(s,h),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Re extends Be{constructor(s,h){super(s,h),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Pe extends Be{constructor(s,h){super(s,h),this.current=he.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const ze=new Float32Array(16);function Ne(c){return[f(255*c.r,255*c.g),f(255*c.b,255*c.a)]}class Fe{constructor(s,h,v){this.value=s,this.uniformNames=h.map(I=>`u_${I}`),this.type=v}setUniform(s,h,v){s.set(v.constantOr(this.value))}getBinding(s,h,v){return this.type==="color"?new Pe(s,h):new Le(s,h)}}class et{constructor(s,h){this.uniformNames=h.map(v=>`u_${v}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr}setUniform(s,h,v,I){const z=I==="u_pattern_to"?this.patternTo:I==="u_pattern_from"?this.patternFrom:I==="u_pixel_ratio_to"?this.pixelRatioTo:I==="u_pixel_ratio_from"?this.pixelRatioFrom:null;z&&s.set(z)}getBinding(s,h,v){return v.substr(0,9)==="u_pattern"?new Re(s,h):new Le(s,h)}}class ut{constructor(s,h,v,I){this.expression=s,this.type=v,this.maxValue=0,this.paintVertexAttributes=h.map(z=>({name:`a_${z}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new I}populatePaintArray(s,h,v,I,z){const B=this.paintVertexArray.length,U=this.expression.evaluate(new Rr(0),h,{},I,[],z);this.paintVertexArray.resize(s),this._setPaintValue(B,s,U)}updatePaintArray(s,h,v,I){const z=this.expression.evaluate({zoom:0},v,I);this._setPaintValue(s,h,z)}_setPaintValue(s,h,v){if(this.type==="color"){const I=Ne(v);for(let z=s;z<h;z++)this.paintVertexArray.emplace(z,I[0],I[1])}else{for(let I=s;I<h;I++)this.paintVertexArray.emplace(I,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lt{constructor(s,h,v,I,z,B){this.expression=s,this.uniformNames=h.map(U=>`u_${U}_t`),this.type=v,this.useIntegerZoom=I,this.zoom=z,this.maxValue=0,this.paintVertexAttributes=h.map(U=>({name:`a_${U}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new B}populatePaintArray(s,h,v,I,z){const B=this.expression.evaluate(new Rr(this.zoom),h,{},I,[],z),U=this.expression.evaluate(new Rr(this.zoom+1),h,{},I,[],z),Z=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(Z,s,B,U)}updatePaintArray(s,h,v,I){const z=this.expression.evaluate({zoom:this.zoom},v,I),B=this.expression.evaluate({zoom:this.zoom+1},v,I);this._setPaintValue(s,h,z,B)}_setPaintValue(s,h,v,I){if(this.type==="color"){const z=Ne(v),B=Ne(I);for(let U=s;U<h;U++)this.paintVertexArray.emplace(U,z[0],z[1],B[0],B[1])}else{for(let z=s;z<h;z++)this.paintVertexArray.emplace(z,v,I);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(I))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,h){const v=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,I=q(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);s.set(I)}getBinding(s,h,v){return new Le(s,h)}}class yt{constructor(s,h,v,I,z,B){this.expression=s,this.type=h,this.useIntegerZoom=v,this.zoom=I,this.layerId=B,this.zoomInPaintVertexArray=new z,this.zoomOutPaintVertexArray=new z}populatePaintArray(s,h,v){const I=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(I,s,h.patterns&&h.patterns[this.layerId],v)}updatePaintArray(s,h,v,I,z){this._setPaintValues(s,h,v.patterns&&v.patterns[this.layerId],z)}_setPaintValues(s,h,v,I){if(!I||!v)return;const{min:z,mid:B,max:U}=v,Z=I[z],ne=I[B],de=I[U];if(Z&&ne&&de)for(let _e=s;_e<h;_e++)this.zoomInPaintVertexArray.emplace(_e,ne.tl[0],ne.tl[1],ne.br[0],ne.br[1],Z.tl[0],Z.tl[1],Z.br[0],Z.br[1],ne.pixelRatio,Z.pixelRatio),this.zoomOutPaintVertexArray.emplace(_e,ne.tl[0],ne.tl[1],ne.br[0],ne.br[1],de.tl[0],de.tl[1],de.br[0],de.br[1],ne.pixelRatio,de.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,x.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,x.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $t{constructor(s,h,v){this.binders={},this._buffers=[];const I=[];for(const z in s.paint._values){if(!v(z))continue;const B=s.paint.get(z);if(!(B instanceof gs&&jr(B.property.specification)))continue;const U=Et(z,s.type),Z=B.value,ne=B.property.specification.type,de=B.property.useIntegerZoom,_e=B.property.specification["property-type"],be=_e==="cross-faded"||_e==="cross-faded-data-driven";if(Z.kind==="constant")this.binders[z]=be?new et(Z.value,U):new Fe(Z.value,U,ne),I.push(`/u_${z}`);else if(Z.kind==="source"||be){const Ce=bi(z,ne,"source");this.binders[z]=be?new yt(Z,ne,de,h,Ce,s.id):new ut(Z,U,ne,Ce),I.push(`/a_${z}`)}else{const Ce=bi(z,ne,"composite");this.binders[z]=new lt(Z,U,ne,de,h,Ce),I.push(`/z_${z}`)}}this.cacheKey=I.sort().join("")}getMaxValue(s){const h=this.binders[s];return h instanceof ut||h instanceof lt?h.maxValue:0}populatePaintArrays(s,h,v,I,z){for(const B in this.binders){const U=this.binders[B];(U instanceof ut||U instanceof lt||U instanceof yt)&&U.populatePaintArray(s,h,v,I,z)}}setConstantPatternPositions(s,h){for(const v in this.binders){const I=this.binders[v];I instanceof et&&I.setConstantPatternPositions(s,h)}}updatePaintArrays(s,h,v,I,z){let B=!1;for(const U in s){const Z=h.getPositions(U);for(const ne of Z){const de=v.feature(ne.index);for(const _e in this.binders){const be=this.binders[_e];if((be instanceof ut||be instanceof lt||be instanceof yt)&&be.expression.isStateDependent===!0){const Ce=I.paint.get(_e);be.expression=Ce.value,be.updatePaintArray(ne.start,ne.end,de,s[U],z),B=!0}}}}return B}defines(){const s=[];for(const h in this.binders){const v=this.binders[h];(v instanceof Fe||v instanceof et)&&s.push(...v.uniformNames.map(I=>`#define HAS_UNIFORM_${I}`))}return s}getBinderAttributes(){const s=[];for(const h in this.binders){const v=this.binders[h];if(v instanceof ut||v instanceof lt)for(let I=0;I<v.paintVertexAttributes.length;I++)s.push(v.paintVertexAttributes[I].name);else if(v instanceof yt)for(let I=0;I<x.members.length;I++)s.push(x.members[I].name)}return s}getBinderUniforms(){const s=[];for(const h in this.binders){const v=this.binders[h];if(v instanceof Fe||v instanceof et||v instanceof lt)for(const I of v.uniformNames)s.push(I)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,h){const v=[];for(const I in this.binders){const z=this.binders[I];if(z instanceof Fe||z instanceof et||z instanceof lt){for(const B of z.uniformNames)if(h[B]){const U=z.getBinding(s,h[B],B);v.push({name:B,property:I,binding:U})}}}return v}setUniforms(s,h,v,I){for(const{name:z,property:B,binding:U}of h)this.binders[B].setUniform(U,I,v.get(B),z)}updatePaintBuffers(s){this._buffers=[];for(const h in this.binders){const v=this.binders[h];if(s&&v instanceof yt){const I=s.fromScale===2?v.zoomInPaintVertexBuffer:v.zoomOutPaintVertexBuffer;I&&this._buffers.push(I)}else(v instanceof ut||v instanceof lt)&&v.paintVertexBuffer&&this._buffers.push(v.paintVertexBuffer)}}upload(s){for(const h in this.binders){const v=this.binders[h];(v instanceof ut||v instanceof lt||v instanceof yt)&&v.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const h=this.binders[s];(h instanceof ut||h instanceof lt||h instanceof yt)&&h.destroy()}}}class Dt{constructor(s,h,v=()=>!0){this.programConfigurations={};for(const I of s)this.programConfigurations[I.id]=new $t(I,h,v);this.needsUpload=!1,this._featureMap=new te,this._bufferOffset=0}populatePaintArrays(s,h,v,I,z,B){for(const U in this.programConfigurations)this.programConfigurations[U].populatePaintArrays(s,h,I,z,B);h.id!==void 0&&this._featureMap.add(h.id,v,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,h,v,I){for(const z of v)this.needsUpload=this.programConfigurations[z.id].updatePaintArrays(s,this._featureMap,h,z,I)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function Et(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function bi(c,s,h){const v={color:{source:T,composite:ft},number:{source:We,composite:T}},I=function(z){return{"line-pattern":{source:Wo,composite:Wo},"fill-pattern":{source:Wo,composite:Wo},"fill-extrusion-pattern":{source:Wo,composite:Wo}}[z]}(c);return I&&I[h]||v[s][h]}Zi("ConstantBinder",Fe),Zi("CrossFadedConstantBinder",et),Zi("SourceExpressionBinder",ut),Zi("CrossFadedCompositeBinder",yt),Zi("CompositeExpressionBinder",lt),Zi("ProgramConfiguration",$t,{omit:["_buffers"]}),Zi("ProgramConfigurationSet",Dt);var wt=8192;const ei=Math.pow(2,14)-1,qt=-ei-1;function pi(c){const s=wt/c.extent,h=c.loadGeometry();for(let v=0;v<h.length;v++){const I=h[v];for(let z=0;z<I.length;z++){const B=I[z],U=Math.round(B.x*s),Z=Math.round(B.y*s);B.x=q(U,qt,ei),B.y=q(Z,qt,ei),(U<B.x||U>B.x+1||Z<B.y||Z>B.y+1)&&Me("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Gt(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?pi(c):[]}}function ai(c,s,h,v,I){c.emplaceBack(2*s+(v+1)/2,2*h+(I+1)/2)}class Ti{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new xr,this.indexArray=new ws,this.segments=new o,this.programConfigurations=new Dt(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,v){const I=this.layers[0],z=[];let B=null,U=!1;I.type==="circle"&&(B=I.layout.get("circle-sort-key"),U=!B.isConstant());for(const{feature:Z,id:ne,index:de,sourceLayerIndex:_e}of s){const be=this.layers[0]._featureFilter.needGeometry,Ce=Gt(Z,be);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),Ce,v))continue;const Ie=U?B.evaluate(Ce,{},v):void 0,dt={id:ne,properties:Z.properties,type:Z.type,sourceLayerIndex:_e,index:de,geometry:be?Ce.geometry:pi(Z),patterns:{},sortKey:Ie};z.push(dt)}U&&z.sort((Z,ne)=>Z.sortKey-ne.sortKey);for(const Z of z){const{geometry:ne,index:de,sourceLayerIndex:_e}=Z,be=s[de].feature;this.addFeature(Z,ne,de,v),h.featureIndex.insert(be,ne,de,_e,this.index)}}update(s,h,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,_),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,h,v,I){for(const z of h)for(const B of z){const U=B.x,Z=B.y;if(U<0||U>=wt||Z<0||Z>=wt)continue;const ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),de=ne.vertexLength;ai(this.layoutVertexArray,U,Z,-1,-1),ai(this.layoutVertexArray,U,Z,1,-1),ai(this.layoutVertexArray,U,Z,1,1),ai(this.layoutVertexArray,U,Z,-1,1),this.indexArray.emplaceBack(de,de+1,de+2),this.indexArray.emplaceBack(de,de+3,de+2),ne.vertexLength+=4,ne.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,v,{},I)}}function St(c,s){for(let h=0;h<c.length;h++)if(br(s,c[h]))return!0;for(let h=0;h<s.length;h++)if(br(c,s[h]))return!0;return!!rn(c,s)}function Zt(c,s,h){return!!br(c,s)||!!Nn(s,c,h)}function sn(c,s){if(c.length===1)return Yi(s,c[0]);for(let h=0;h<s.length;h++){const v=s[h];for(let I=0;I<v.length;I++)if(br(c,v[I]))return!0}for(let h=0;h<c.length;h++)if(Yi(s,c[h]))return!0;for(let h=0;h<s.length;h++)if(rn(c,s[h]))return!0;return!1}function vn(c,s,h){if(c.length>1){if(rn(c,s))return!0;for(let v=0;v<s.length;v++)if(Nn(s[v],c,h))return!0}for(let v=0;v<c.length;v++)if(Nn(c[v],s,h))return!0;return!1}function rn(c,s){if(c.length===0||s.length===0)return!1;for(let h=0;h<c.length-1;h++){const v=c[h],I=c[h+1];for(let z=0;z<s.length-1;z++)if(Cn(v,I,s[z],s[z+1]))return!0}return!1}function Cn(c,s,h,v){return Ye(c,h,v)!==Ye(s,h,v)&&Ye(c,s,h)!==Ye(c,s,v)}function Nn(c,s,h){const v=h*h;if(s.length===1)return c.distSqr(s[0])<v;for(let I=1;I<s.length;I++)if(gn(c,s[I-1],s[I])<v)return!0;return!1}function gn(c,s,h){const v=s.distSqr(h);if(v===0)return c.distSqr(s);const I=((c.x-s.x)*(h.x-s.x)+(c.y-s.y)*(h.y-s.y))/v;return c.distSqr(I<0?s:I>1?h:h.sub(s)._mult(I)._add(s))}function Yi(c,s){let h,v,I,z=!1;for(let B=0;B<c.length;B++){h=c[B];for(let U=0,Z=h.length-1;U<h.length;Z=U++)v=h[U],I=h[Z],v.y>s.y!=I.y>s.y&&s.x<(I.x-v.x)*(s.y-v.y)/(I.y-v.y)+v.x&&(z=!z)}return z}function br(c,s){let h=!1;for(let v=0,I=c.length-1;v<c.length;I=v++){const z=c[v],B=c[I];z.y>s.y!=B.y>s.y&&s.x<(B.x-z.x)*(s.y-z.y)/(B.y-z.y)+z.x&&(h=!h)}return h}function Ir(c,s,h){const v=h[0],I=h[2];if(c.x<v.x&&s.x<v.x||c.x>I.x&&s.x>I.x||c.y<v.y&&s.y<v.y||c.y>I.y&&s.y>I.y)return!1;const z=Ye(c,s,h[0]);return z!==Ye(c,s,h[1])||z!==Ye(c,s,h[2])||z!==Ye(c,s,h[3])}function Ar(c,s,h){const v=s.paint.get(c).value;return v.kind==="constant"?v.value:h.programConfigurations.get(s.id).getMaxValue(c)}function Mr(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Ts(c,s,h,v,I){if(!s[0]&&!s[1])return c;const z=zt.convert(s)._mult(I);h==="viewport"&&z._rotate(-v);const B=[];for(let U=0;U<c.length;U++)B.push(c[U].sub(z));return B}Zi("CircleBucket",Ti,{omit:["layers"]});const Ea=new Ao({"circle-sort-key":new yn(Ot.layout_circle["circle-sort-key"])});var Ws={paint:new Ao({"circle-radius":new yn(Ot.paint_circle["circle-radius"]),"circle-color":new yn(Ot.paint_circle["circle-color"]),"circle-blur":new yn(Ot.paint_circle["circle-blur"]),"circle-opacity":new yn(Ot.paint_circle["circle-opacity"]),"circle-translate":new an(Ot.paint_circle["circle-translate"]),"circle-translate-anchor":new an(Ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new an(Ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new an(Ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Ot.paint_circle["circle-stroke-opacity"])}),layout:Ea},xo=1e-6,er=typeof Float32Array<"u"?Float32Array:Array;function Or(){var c=new er(9);return er!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function _r(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Do(c,s,h){var v=s[0],I=s[1],z=s[2],B=s[3],U=s[4],Z=s[5],ne=s[6],de=s[7],_e=s[8],be=s[9],Ce=s[10],Ie=s[11],dt=s[12],st=s[13],Pt=s[14],Xt=s[15],Ct=h[0],jt=h[1],hi=h[2],li=h[3];return c[0]=Ct*v+jt*U+hi*_e+li*dt,c[1]=Ct*I+jt*Z+hi*be+li*st,c[2]=Ct*z+jt*ne+hi*Ce+li*Pt,c[3]=Ct*B+jt*de+hi*Ie+li*Xt,c[4]=(Ct=h[4])*v+(jt=h[5])*U+(hi=h[6])*_e+(li=h[7])*dt,c[5]=Ct*I+jt*Z+hi*be+li*st,c[6]=Ct*z+jt*ne+hi*Ce+li*Pt,c[7]=Ct*B+jt*de+hi*Ie+li*Xt,c[8]=(Ct=h[8])*v+(jt=h[9])*U+(hi=h[10])*_e+(li=h[11])*dt,c[9]=Ct*I+jt*Z+hi*be+li*st,c[10]=Ct*z+jt*ne+hi*Ce+li*Pt,c[11]=Ct*B+jt*de+hi*Ie+li*Xt,c[12]=(Ct=h[12])*v+(jt=h[13])*U+(hi=h[14])*_e+(li=h[15])*dt,c[13]=Ct*I+jt*Z+hi*be+li*st,c[14]=Ct*z+jt*ne+hi*Ce+li*Pt,c[15]=Ct*B+jt*de+hi*Ie+li*Xt,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var ss,Kr=Do;function Ds(){var c=new er(3);return er!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function _h(c,s,h){var v=new er(3);return v[0]=c,v[1]=s,v[2]=h,v}function $a(c,s,h){var v=s[0],I=s[1],z=s[2],B=s[3];return c[0]=h[0]*v+h[4]*I+h[8]*z+h[12]*B,c[1]=h[1]*v+h[5]*I+h[9]*z+h[13]*B,c[2]=h[2]*v+h[6]*I+h[10]*z+h[14]*B,c[3]=h[3]*v+h[7]*I+h[11]*z+h[15]*B,c}function Es(){var c=new er(4);return er!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Sa(c,s){const h=$a([],[c.x,c.y,0,1],s);return new zt(h[0]/h[3],h[1]/h[3])}Ds(),ss=new er(4),er!=Float32Array&&(ss[0]=0,ss[1]=0,ss[2]=0,ss[3]=0),Ds(),_h(1,0,0),_h(0,1,0),Es(),Es(),Or(),function(){var c;c=new er(2),er!=Float32Array&&(c[0]=0,c[1]=0)}();class ml extends Ti{}Zi("HeatmapBucket",ml,{omit:["layers"]});var Ol={paint:new Ao({"heatmap-radius":new yn(Ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new an(Ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fl(Ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new an(Ot.paint_heatmap["heatmap-opacity"])})};function ju(c,{width:s,height:h},v,I){if(I){if(I instanceof Uint8ClampedArray)I=new Uint8Array(I.buffer);else if(I.length!==s*h*v)throw new RangeError(`mismatched image size. expected: ${I.length} but got: ${s*h*v}`)}else I=new Uint8Array(s*h*v);return c.width=s,c.height=h,c.data=I,c}function Gu(c,{width:s,height:h},v){if(s===c.width&&h===c.height)return;const I=ju({},{width:s,height:h},v);ja(c,I,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,h)},v),c.width=s,c.height=h,c.data=I.data}function ja(c,s,h,v,I,z){if(I.width===0||I.height===0)return s;if(I.width>c.width||I.height>c.height||h.x>c.width-I.width||h.y>c.height-I.height)throw new RangeError("out of range source coordinates for image copy");if(I.width>s.width||I.height>s.height||v.x>s.width-I.width||v.y>s.height-I.height)throw new RangeError("out of range destination coordinates for image copy");const B=c.data,U=s.data;if(B===U)throw new Error("srcData equals dstData, so image is already copied");for(let Z=0;Z<I.height;Z++){const ne=((h.y+Z)*c.width+h.x)*z,de=((v.y+Z)*s.width+v.x)*z;for(let _e=0;_e<I.width*z;_e++)U[de+_e]=B[ne+_e]}return s}class qu{constructor(s,h){ju(this,s,1,h)}resize(s){Gu(this,s,1)}clone(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,v,I,z){ja(s,h,v,I,z,1)}}class fa{constructor(s,h){ju(this,s,4,h)}resize(s){Gu(this,s,4)}replace(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new fa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,v,I,z){ja(s,h,v,I,z,4)}}function Ym(c){const s={},h=c.resolution||256,v=c.clips?c.clips.length:1,I=c.image||new fa({width:h,height:v});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const z=(B,U,Z)=>{s[c.evaluationKey]=Z;const ne=c.expression.evaluate(s);I.data[B+U+0]=Math.floor(255*ne.r/ne.a),I.data[B+U+1]=Math.floor(255*ne.g/ne.a),I.data[B+U+2]=Math.floor(255*ne.b/ne.a),I.data[B+U+3]=Math.floor(255*ne.a)};if(c.clips)for(let B=0,U=0;B<v;++B,U+=4*h)for(let Z=0,ne=0;Z<h;Z++,ne+=4){const de=Z/(h-1),{start:_e,end:be}=c.clips[B];z(U,ne,_e*(1-de)+be*de)}else for(let B=0,U=0;B<h;B++,U+=4)z(0,U,B/(h-1));return I}Zi("AlphaImage",qu),Zi("RGBAImage",fa);var Jm={paint:new Ao({"hillshade-illumination-direction":new an(Ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new an(Ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new an(Ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new an(Ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new an(Ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new an(Ot.paint_hillshade["hillshade-accent-color"])})};const P_=zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:z_}=P_;var Bf={exports:{}};function Rf(c,s,h){h=h||2;var v,I,z,B,U,Z,ne,de=s&&s.length,_e=de?s[0]*h:c.length,be=Qm(c,0,_e,h,!0),Ce=[];if(!be||be.next===be.prev)return Ce;if(de&&(be=function(dt,st,Pt,Xt){var Ct,jt,hi,li=[];for(Ct=0,jt=st.length;Ct<jt;Ct++)(hi=Qm(dt,st[Ct]*Xt,Ct<jt-1?st[Ct+1]*Xt:dt.length,Xt,!1))===hi.next&&(hi.steiner=!0),li.push(e0(hi));for(li.sort(Gd),Ct=0;Ct<li.length;Ct++)Pt=B_(li[Ct],Pt);return Pt}(c,s,be,h)),c.length>80*h){v=z=c[0],I=B=c[1];for(var Ie=h;Ie<_e;Ie+=h)(U=c[Ie])<v&&(v=U),(Z=c[Ie+1])<I&&(I=Z),U>z&&(z=U),Z>B&&(B=Z);ne=(ne=Math.max(z-v,B-I))!==0?32767/ne:0}return jd(be,Ce,h,v,I,ne,0),Ce}function Qm(c,s,h,v,I){var z,B;if(I===nd(c,s,h,v)>0)for(z=s;z<h;z+=v)B=V_(z,c[z],c[z+1],B);else for(z=h-v;z>=s;z-=v)B=V_(z,c[z],c[z+1],B);return B&&td(B,B.next)&&(Ff(B),B=B.next),B}function yh(c,s){if(!c)return c;s||(s=c);var h,v=c;do if(h=!1,v.steiner||!td(v,v.next)&&Lo(v.prev,v,v.next)!==0)v=v.next;else{if(Ff(v),(v=s=v.prev)===v.next)break;h=!0}while(h||v!==s);return s}function jd(c,s,h,v,I,z,B){if(c){!B&&z&&function(de,_e,be,Ce){var Ie=de;do Ie.z===0&&(Ie.z=Vp(Ie.x,Ie.y,_e,be,Ce)),Ie.prevZ=Ie.prev,Ie.nextZ=Ie.next,Ie=Ie.next;while(Ie!==de);Ie.prevZ.nextZ=null,Ie.prevZ=null,function(dt){var st,Pt,Xt,Ct,jt,hi,li,nn,Wi=1;do{for(Pt=dt,dt=null,jt=null,hi=0;Pt;){for(hi++,Xt=Pt,li=0,st=0;st<Wi&&(li++,Xt=Xt.nextZ);st++);for(nn=Wi;li>0||nn>0&&Xt;)li!==0&&(nn===0||!Xt||Pt.z<=Xt.z)?(Ct=Pt,Pt=Pt.nextZ,li--):(Ct=Xt,Xt=Xt.nextZ,nn--),jt?jt.nextZ=Ct:dt=Ct,Ct.prevZ=jt,jt=Ct;Pt=Xt}jt.nextZ=null,Wi*=2}while(hi>1)}(Ie)}(c,v,I,z);for(var U,Z,ne=c;c.prev!==c.next;)if(U=c.prev,Z=c.next,z?L_(c,v,I,z):D_(c))s.push(U.i/h|0),s.push(c.i/h|0),s.push(Z.i/h|0),Ff(c),c=Z.next,ne=Z.next;else if((c=Z)===ne){B?B===1?jd(c=Jv(yh(c),s,h),s,h,v,I,z,2):B===2&&Qv(c,s,h,v,I,z):jd(yh(c),s,h,v,I,z,1);break}}}function D_(c){var s=c.prev,h=c,v=c.next;if(Lo(s,h,v)>=0)return!1;for(var I=s.x,z=h.x,B=v.x,U=s.y,Z=h.y,ne=v.y,de=I<z?I<B?I:B:z<B?z:B,_e=U<Z?U<ne?U:ne:Z<ne?Z:ne,be=I>z?I>B?I:B:z>B?z:B,Ce=U>Z?U>ne?U:ne:Z>ne?Z:ne,Ie=v.next;Ie!==s;){if(Ie.x>=de&&Ie.x<=be&&Ie.y>=_e&&Ie.y<=Ce&&Zu(I,U,z,Z,B,ne,Ie.x,Ie.y)&&Lo(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.next}return!0}function L_(c,s,h,v){var I=c.prev,z=c,B=c.next;if(Lo(I,z,B)>=0)return!1;for(var U=I.x,Z=z.x,ne=B.x,de=I.y,_e=z.y,be=B.y,Ce=U<Z?U<ne?U:ne:Z<ne?Z:ne,Ie=de<_e?de<be?de:be:_e<be?_e:be,dt=U>Z?U>ne?U:ne:Z>ne?Z:ne,st=de>_e?de>be?de:be:_e>be?_e:be,Pt=Vp(Ce,Ie,s,h,v),Xt=Vp(dt,st,s,h,v),Ct=c.prevZ,jt=c.nextZ;Ct&&Ct.z>=Pt&&jt&&jt.z<=Xt;){if(Ct.x>=Ce&&Ct.x<=dt&&Ct.y>=Ie&&Ct.y<=st&&Ct!==I&&Ct!==B&&Zu(U,de,Z,_e,ne,be,Ct.x,Ct.y)&&Lo(Ct.prev,Ct,Ct.next)>=0||(Ct=Ct.prevZ,jt.x>=Ce&&jt.x<=dt&&jt.y>=Ie&&jt.y<=st&&jt!==I&&jt!==B&&Zu(U,de,Z,_e,ne,be,jt.x,jt.y)&&Lo(jt.prev,jt,jt.next)>=0))return!1;jt=jt.nextZ}for(;Ct&&Ct.z>=Pt;){if(Ct.x>=Ce&&Ct.x<=dt&&Ct.y>=Ie&&Ct.y<=st&&Ct!==I&&Ct!==B&&Zu(U,de,Z,_e,ne,be,Ct.x,Ct.y)&&Lo(Ct.prev,Ct,Ct.next)>=0)return!1;Ct=Ct.prevZ}for(;jt&&jt.z<=Xt;){if(jt.x>=Ce&&jt.x<=dt&&jt.y>=Ie&&jt.y<=st&&jt!==I&&jt!==B&&Zu(U,de,Z,_e,ne,be,jt.x,jt.y)&&Lo(jt.prev,jt,jt.next)>=0)return!1;jt=jt.nextZ}return!0}function Jv(c,s,h){var v=c;do{var I=v.prev,z=v.next.next;!td(I,z)&&Kc(I,v,v.next,z)&&qd(I,z)&&qd(z,I)&&(s.push(I.i/h|0),s.push(v.i/h|0),s.push(z.i/h|0),Ff(v),Ff(v.next),v=c=z),v=v.next}while(v!==c);return yh(v)}function Qv(c,s,h,v,I,z){var B=c;do{for(var U=B.next.next;U!==B.prev;){if(B.i!==U.i&&O_(B,U)){var Z=F_(B,U);return B=yh(B,B.next),Z=yh(Z,Z.next),jd(B,s,h,v,I,z,0),void jd(Z,s,h,v,I,z,0)}U=U.next}B=B.next}while(B!==c)}function Gd(c,s){return c.x-s.x}function B_(c,s){var h=function(I,z){var B,U=z,Z=I.x,ne=I.y,de=-1/0;do{if(ne<=U.y&&ne>=U.next.y&&U.next.y!==U.y){var _e=U.x+(ne-U.y)*(U.next.x-U.x)/(U.next.y-U.y);if(_e<=Z&&_e>de&&(de=_e,B=U.x<U.next.x?U:U.next,_e===Z))return B}U=U.next}while(U!==z);if(!B)return null;var be,Ce=B,Ie=B.x,dt=B.y,st=1/0;U=B;do Z>=U.x&&U.x>=Ie&&Z!==U.x&&Zu(ne<dt?Z:de,ne,Ie,dt,ne<dt?de:Z,ne,U.x,U.y)&&(be=Math.abs(ne-U.y)/(Z-U.x),qd(U,I)&&(be<st||be===st&&(U.x>B.x||U.x===B.x&&R_(B,U)))&&(B=U,st=be)),U=U.next;while(U!==Ce);return B}(c,s);if(!h)return s;var v=F_(h,c);return yh(v,v.next),yh(h,h.next)}function R_(c,s){return Lo(c.prev,c,s.prev)<0&&Lo(s.next,c,c.next)<0}function Vp(c,s,h,v,I){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*I|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-v)*I|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function e0(c){var s=c,h=c;do(s.x<h.x||s.x===h.x&&s.y<h.y)&&(h=s),s=s.next;while(s!==c);return h}function Zu(c,s,h,v,I,z,B,U){return(I-B)*(s-U)>=(c-B)*(z-U)&&(c-B)*(v-U)>=(h-B)*(s-U)&&(h-B)*(z-U)>=(I-B)*(v-U)}function O_(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(h,v){var I=h;do{if(I.i!==h.i&&I.next.i!==h.i&&I.i!==v.i&&I.next.i!==v.i&&Kc(I,I.next,h,v))return!0;I=I.next}while(I!==h);return!1}(c,s)&&(qd(c,s)&&qd(s,c)&&function(h,v){var I=h,z=!1,B=(h.x+v.x)/2,U=(h.y+v.y)/2;do I.y>U!=I.next.y>U&&I.next.y!==I.y&&B<(I.next.x-I.x)*(U-I.y)/(I.next.y-I.y)+I.x&&(z=!z),I=I.next;while(I!==h);return z}(c,s)&&(Lo(c.prev,c,s.prev)||Lo(c,s.prev,s))||td(c,s)&&Lo(c.prev,c,c.next)>0&&Lo(s.prev,s,s.next)>0)}function Lo(c,s,h){return(s.y-c.y)*(h.x-s.x)-(s.x-c.x)*(h.y-s.y)}function td(c,s){return c.x===s.x&&c.y===s.y}function Kc(c,s,h,v){var I=Of(Lo(c,s,h)),z=Of(Lo(c,s,v)),B=Of(Lo(h,v,c)),U=Of(Lo(h,v,s));return I!==z&&B!==U||!(I!==0||!id(c,h,s))||!(z!==0||!id(c,v,s))||!(B!==0||!id(h,c,v))||!(U!==0||!id(h,s,v))}function id(c,s,h){return s.x<=Math.max(c.x,h.x)&&s.x>=Math.min(c.x,h.x)&&s.y<=Math.max(c.y,h.y)&&s.y>=Math.min(c.y,h.y)}function Of(c){return c>0?1:c<0?-1:0}function qd(c,s){return Lo(c.prev,c,c.next)<0?Lo(c,s,c.next)>=0&&Lo(c,c.prev,s)>=0:Lo(c,s,c.prev)<0||Lo(c,c.next,s)<0}function F_(c,s){var h=new Vf(c.i,c.x,c.y),v=new Vf(s.i,s.x,s.y),I=c.next,z=s.prev;return c.next=s,s.prev=c,h.next=I,I.prev=h,v.next=h,h.prev=v,z.next=v,v.prev=z,v}function V_(c,s,h,v){var I=new Vf(c,s,h);return v?(I.next=v.next,I.prev=v,v.next.prev=I,v.next=I):(I.prev=I,I.next=I),I}function Ff(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Vf(c,s,h){this.i=c,this.x=s,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nd(c,s,h,v){for(var I=0,z=s,B=h-v;z<h;z+=v)I+=(c[B]-c[z])*(c[z+1]+c[B+1]),B=z;return I}function Zd(c,s,h,v,I){Yc(c,s,h||0,v||c.length-1,I||vh)}function Yc(c,s,h,v,I){for(;v>h;){if(v-h>600){var z=v-h+1,B=s-h+1,U=Math.log(z),Z=.5*Math.exp(2*U/3),ne=.5*Math.sqrt(U*Z*(z-Z)/z)*(B-z/2<0?-1:1);Yc(c,s,Math.max(h,Math.floor(s-B*Z/z+ne)),Math.min(v,Math.floor(s+(z-B)*Z/z+ne)),I)}var de=c[s],_e=h,be=v;for(Ca(c,h,s),I(c[v],de)>0&&Ca(c,h,v);_e<be;){for(Ca(c,_e,be),_e++,be--;I(c[_e],de)<0;)_e++;for(;I(c[be],de)>0;)be--}I(c[h],de)===0?Ca(c,h,be):Ca(c,++be,v),be<=s&&(h=be+1),s<=be&&(v=be-1)}}function Ca(c,s,h){var v=c[s];c[s]=c[h],c[h]=v}function vh(c,s){return c<s?-1:c>s?1:0}function Jc(c,s){const h=c.length;if(h<=1)return[c];const v=[];let I,z;for(let B=0;B<h;B++){const U=Ze(c[B]);U!==0&&(c[B].area=Math.abs(U),z===void 0&&(z=U<0),z===U<0?(I&&v.push(I),I=[c[B]]):I.push(c[B]))}if(I&&v.push(I),s>1)for(let B=0;B<v.length;B++)v[B].length<=s||(Zd(v[B],s,1,v[B].length-1,rd),v[B]=v[B].slice(0,s));return v}function rd(c,s){return s.area-c.area}function eg(c,s,h){const v=h.patternDependencies;let I=!1;for(const z of s){const B=z.paint.get(`${c}-pattern`);B.isConstant()||(I=!0);const U=B.constantOr(null);U&&(I=!0,v[U.to]=!0,v[U.from]=!0)}return I}function tg(c,s,h,v,I){const z=I.patternDependencies;for(const B of s){const U=B.paint.get(`${c}-pattern`).value;if(U.kind!=="constant"){let Z=U.evaluate({zoom:v-1},h,{},I.availableImages),ne=U.evaluate({zoom:v},h,{},I.availableImages),de=U.evaluate({zoom:v+1},h,{},I.availableImages);Z=Z&&Z.name?Z.name:Z,ne=ne&&ne.name?ne.name:ne,de=de&&de.name?de.name:de,z[Z]=!0,z[ne]=!0,z[de]=!0,h.patterns[B.id]={min:Z,mid:ne,max:de}}}return h}Bf.exports=Rf,Bf.exports.default=Rf,Rf.deviation=function(c,s,h,v){var I=s&&s.length,z=Math.abs(nd(c,0,I?s[0]*h:c.length,h));if(I)for(var B=0,U=s.length;B<U;B++)z-=Math.abs(nd(c,s[B]*h,B<U-1?s[B+1]*h:c.length,h));var Z=0;for(B=0;B<v.length;B+=3){var ne=v[B]*h,de=v[B+1]*h,_e=v[B+2]*h;Z+=Math.abs((c[ne]-c[_e])*(c[de+1]-c[ne+1])-(c[ne]-c[de])*(c[_e+1]-c[ne+1]))}return z===0&&Z===0?0:Math.abs((Z-z)/z)},Rf.flatten=function(c){for(var s=c[0][0].length,h={vertices:[],holes:[],dimensions:s},v=0,I=0;I<c.length;I++){for(var z=0;z<c[I].length;z++)for(var B=0;B<s;B++)h.vertices.push(c[I][z][B]);I>0&&h.holes.push(v+=c[I-1].length)}return h};class ig{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cr,this.indexArray=new ws,this.indexArray2=new Ta,this.programConfigurations=new Dt(s.layers,s.zoom),this.segments=new o,this.segments2=new o,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,v){this.hasPattern=eg("fill",this.layers,h);const I=this.layers[0].layout.get("fill-sort-key"),z=!I.isConstant(),B=[];for(const{feature:U,id:Z,index:ne,sourceLayerIndex:de}of s){const _e=this.layers[0]._featureFilter.needGeometry,be=Gt(U,_e);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),be,v))continue;const Ce=z?I.evaluate(be,{},v,h.availableImages):void 0,Ie={id:Z,properties:U.properties,type:U.type,sourceLayerIndex:de,index:ne,geometry:_e?be.geometry:pi(U),patterns:{},sortKey:Ce};B.push(Ie)}z&&B.sort((U,Z)=>U.sortKey-Z.sortKey);for(const U of B){const{geometry:Z,index:ne,sourceLayerIndex:de}=U;if(this.hasPattern){const _e=tg("fill",this.layers,U,this.zoom,h);this.patternFeatures.push(_e)}else this.addFeature(U,Z,ne,v,{});h.featureIndex.insert(s[ne].feature,Z,ne,de,this.index)}}update(s,h,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,v)}addFeatures(s,h,v){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,h,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,z_),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,h,v,I,z){for(const B of Jc(h,500)){let U=0;for(const Ce of B)U+=Ce.length;const Z=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray),ne=Z.vertexLength,de=[],_e=[];for(const Ce of B){if(Ce.length===0)continue;Ce!==B[0]&&_e.push(de.length/2);const Ie=this.segments2.prepareSegment(Ce.length,this.layoutVertexArray,this.indexArray2),dt=Ie.vertexLength;this.layoutVertexArray.emplaceBack(Ce[0].x,Ce[0].y),this.indexArray2.emplaceBack(dt+Ce.length-1,dt),de.push(Ce[0].x),de.push(Ce[0].y);for(let st=1;st<Ce.length;st++)this.layoutVertexArray.emplaceBack(Ce[st].x,Ce[st].y),this.indexArray2.emplaceBack(dt+st-1,dt+st),de.push(Ce[st].x),de.push(Ce[st].y);Ie.vertexLength+=Ce.length,Ie.primitiveLength+=Ce.length}const be=Bf.exports(de,_e);for(let Ce=0;Ce<be.length;Ce+=3)this.indexArray.emplaceBack(ne+be[Ce],ne+be[Ce+1],ne+be[Ce+2]);Z.vertexLength+=U,Z.primitiveLength+=be.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,v,z,I)}}Zi("FillBucket",ig,{omit:["layers","patternFeatures"]});const t0=new Ao({"fill-sort-key":new yn(Ot.layout_fill["fill-sort-key"])});var N_={paint:new Ao({"fill-antialias":new an(Ot.paint_fill["fill-antialias"]),"fill-opacity":new yn(Ot.paint_fill["fill-opacity"]),"fill-color":new yn(Ot.paint_fill["fill-color"]),"fill-outline-color":new yn(Ot.paint_fill["fill-outline-color"]),"fill-translate":new an(Ot.paint_fill["fill-translate"]),"fill-translate-anchor":new an(Ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hc(Ot.paint_fill["fill-pattern"])}),layout:t0};const Np=zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),dc=zo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:i0}=Np;var xh={},as=zt,In=gl;function gl(c,s,h,v,I){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=v,this._values=I,c.readFields(Up,this,s)}function Up(c,s,h){c==1?s.id=h.readVarint():c==2?function(v,I){for(var z=v.readVarint()+v.pos;v.pos<z;){var B=I._keys[v.readVarint()],U=I._values[v.readVarint()];I.properties[B]=U}}(h,s):c==3?s.type=h.readVarint():c==4&&(s._geometry=h.pos)}function wr(c){for(var s,h,v=0,I=0,z=c.length,B=z-1;I<z;B=I++)v+=((h=c[B]).x-(s=c[I]).x)*(s.y+h.y);return v}gl.types=["Unknown","Point","LineString","Polygon"],gl.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,h=c.readVarint()+c.pos,v=1,I=0,z=0,B=0,U=[];c.pos<h;){if(I<=0){var Z=c.readVarint();v=7&Z,I=Z>>3}if(I--,v===1||v===2)z+=c.readSVarint(),B+=c.readSVarint(),v===1&&(s&&U.push(s),s=[]),s.push(new as(z,B));else{if(v!==7)throw new Error("unknown command "+v);s&&s.push(s[0].clone())}}return s&&U.push(s),U},gl.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,h=1,v=0,I=0,z=0,B=1/0,U=-1/0,Z=1/0,ne=-1/0;c.pos<s;){if(v<=0){var de=c.readVarint();h=7&de,v=de>>3}if(v--,h===1||h===2)(I+=c.readSVarint())<B&&(B=I),I>U&&(U=I),(z+=c.readSVarint())<Z&&(Z=z),z>ne&&(ne=z);else if(h!==7)throw new Error("unknown command "+h)}return[B,Z,U,ne]},gl.prototype.toGeoJSON=function(c,s,h){var v,I,z=this.extent*Math.pow(2,h),B=this.extent*c,U=this.extent*s,Z=this.loadGeometry(),ne=gl.types[this.type];function de(Ce){for(var Ie=0;Ie<Ce.length;Ie++){var dt=Ce[Ie];Ce[Ie]=[360*(dt.x+B)/z-180,360/Math.PI*Math.atan(Math.exp((180-360*(dt.y+U)/z)*Math.PI/180))-90]}}switch(this.type){case 1:var _e=[];for(v=0;v<Z.length;v++)_e[v]=Z[v][0];de(Z=_e);break;case 2:for(v=0;v<Z.length;v++)de(Z[v]);break;case 3:for(Z=function(Ce){var Ie=Ce.length;if(Ie<=1)return[Ce];for(var dt,st,Pt=[],Xt=0;Xt<Ie;Xt++){var Ct=wr(Ce[Xt]);Ct!==0&&(st===void 0&&(st=Ct<0),st===Ct<0?(dt&&Pt.push(dt),dt=[Ce[Xt]]):dt.push(Ce[Xt]))}return dt&&Pt.push(dt),Pt}(Z),v=0;v<Z.length;v++)for(I=0;I<Z[v].length;I++)de(Z[v][I])}Z.length===1?Z=Z[0]:ne="Multi"+ne;var be={type:"Feature",geometry:{type:ne,coordinates:Z},properties:this.properties};return"id"in this&&(be.id=this.id),be};var U_=In,$p=fc;function fc(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Qc,this,s),this.length=this._features.length}function Qc(c,s,h){c===15?s.version=h.readVarint():c===1?s.name=h.readString():c===5?s.extent=h.readVarint():c===2?s._features.push(h.pos):c===3?s._keys.push(h.readString()):c===4&&s._values.push(function(v){for(var I=null,z=v.readVarint()+v.pos;v.pos<z;){var B=v.readVarint()>>3;I=B===1?v.readString():B===2?v.readFloat():B===3?v.readDouble():B===4?v.readVarint64():B===5?v.readVarint():B===6?v.readSVarint():B===7?v.readBoolean():null}return I}(h))}fc.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new U_(this._pbf,s,this.extent,this._keys,this._values)};var Fl=$p;function _l(c,s,h){if(c===3){var v=new Fl(h,h.readVarint()+h.pos);v.length&&(s[v.name]=v)}}xh.VectorTile=function(c,s){this.layers=c.readFields(_l,{},s)},xh.VectorTileFeature=In,xh.VectorTileLayer=$p;const Ls=xh.VectorTileFeature.types,jp=Math.pow(2,13);function Ga(c,s,h,v,I,z,B,U){c.emplaceBack(s,h,2*Math.floor(v*jp)+B,I*jp*2,z*jp*2,Math.round(U))}class Gp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ur,this.centroidVertexArray=new dn,this.indexArray=new ws,this.programConfigurations=new Dt(s.layers,s.zoom),this.segments=new o,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,v){this.features=[],this.hasPattern=eg("fill-extrusion",this.layers,h);for(const{feature:I,id:z,index:B,sourceLayerIndex:U}of s){const Z=this.layers[0]._featureFilter.needGeometry,ne=Gt(I,Z);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),ne,v))continue;const de={id:z,sourceLayerIndex:U,index:B,geometry:Z?ne.geometry:pi(I),properties:I.properties,type:I.type,patterns:{}};this.hasPattern?this.features.push(tg("fill-extrusion",this.layers,de,this.zoom,h)):this.addFeature(de,de.geometry,B,v,{}),h.featureIndex.insert(I,de.geometry,B,U,this.index,!0)}}addFeatures(s,h,v){for(const I of this.features){const{geometry:z}=I;this.addFeature(I,z,I.index,h,v)}}update(s,h,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,i0),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,dc.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,h,v,I,z){const B={x:0,y:0,vertexCount:0};for(const U of Jc(h,500)){let Z=0;for(const Ie of U)Z+=Ie.length;let ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Ie of U){if(Ie.length===0||ng(Ie))continue;let dt=0;for(let st=0;st<Ie.length;st++){const Pt=Ie[st];if(st>=1){const Xt=Ie[st-1];if(!Wd(Pt,Xt)){ne.vertexLength+4>o.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ct=Pt.sub(Xt)._perp()._unit(),jt=Xt.dist(Pt);dt+jt>32768&&(dt=0),Ga(this.layoutVertexArray,Pt.x,Pt.y,Ct.x,Ct.y,0,0,dt),Ga(this.layoutVertexArray,Pt.x,Pt.y,Ct.x,Ct.y,0,1,dt),B.x+=2*Pt.x,B.y+=2*Pt.y,B.vertexCount+=2,dt+=jt,Ga(this.layoutVertexArray,Xt.x,Xt.y,Ct.x,Ct.y,0,0,dt),Ga(this.layoutVertexArray,Xt.x,Xt.y,Ct.x,Ct.y,0,1,dt),B.x+=2*Xt.x,B.y+=2*Xt.y,B.vertexCount+=2;const hi=ne.vertexLength;this.indexArray.emplaceBack(hi,hi+2,hi+1),this.indexArray.emplaceBack(hi+1,hi+2,hi+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+Z>o.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray)),Ls[s.type]!=="Polygon")continue;const de=[],_e=[],be=ne.vertexLength;for(const Ie of U)if(Ie.length!==0){Ie!==U[0]&&_e.push(de.length/2);for(let dt=0;dt<Ie.length;dt++){const st=Ie[dt];Ga(this.layoutVertexArray,st.x,st.y,0,0,1,1,0),B.x+=st.x,B.y+=st.y,B.vertexCount+=1,de.push(st.x),de.push(st.y)}}const Ce=Bf.exports(de,_e);for(let Ie=0;Ie<Ce.length;Ie+=3)this.indexArray.emplaceBack(be+Ce[Ie],be+Ce[Ie+2],be+Ce[Ie+1]);ne.primitiveLength+=Ce.length/3,ne.vertexLength+=Z}for(let U=0;U<B.vertexCount;U++)this.centroidVertexArray.emplaceBack(Math.floor(B.x/B.vertexCount),Math.floor(B.y/B.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,v,z,I)}}function Wd(c,s){return c.x===s.x&&(c.x<0||c.x>wt)||c.y===s.y&&(c.y<0||c.y>wt)}function ng(c){return c.every(s=>s.x<0)||c.every(s=>s.x>wt)||c.every(s=>s.y<0)||c.every(s=>s.y>wt)}Zi("FillExtrusionBucket",Gp,{omit:["layers","features"]});var $_={paint:new Ao({"fill-extrusion-opacity":new an(Ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(Ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new an(Ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new an(Ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hc(Ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(Ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(Ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new an(Ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function od(c,s){return c.x*s.x+c.y*s.y}function j_(c,s){if(c.length===1){let h=0;const v=s[h++];let I;for(;!I||v.equals(I);)if(I=s[h++],!I)return 1/0;for(;h<s.length;h++){const z=s[h],B=c[0],U=I.sub(v),Z=z.sub(v),ne=B.sub(v),de=od(U,U),_e=od(U,Z),be=od(Z,Z),Ce=od(ne,U),Ie=od(ne,Z),dt=de*be-_e*_e,st=(be*Ce-_e*Ie)/dt,Pt=(de*Ie-_e*Ce)/dt,Xt=v.z*(1-st-Pt)+I.z*st+z.z*Pt;if(isFinite(Xt))return Xt}return 1/0}{let h=1/0;for(const v of s)h=Math.min(h,v.z);return h}}const rg=zo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:G_}=rg,n0=zo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Wu}=n0,sd=xh.VectorTileFeature.types,qp=Math.cos(Math.PI/180*37.5),Nf=Math.pow(2,14)/.5;class Uf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new hr,this.layoutVertexArray2=new Dr,this.indexArray=new ws,this.programConfigurations=new Dt(s.layers,s.zoom),this.segments=new o,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,v){this.hasPattern=eg("line",this.layers,h);const I=this.layers[0].layout.get("line-sort-key"),z=!I.isConstant(),B=[];for(const{feature:U,id:Z,index:ne,sourceLayerIndex:de}of s){const _e=this.layers[0]._featureFilter.needGeometry,be=Gt(U,_e);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),be,v))continue;const Ce=z?I.evaluate(be,{},v):void 0,Ie={id:Z,properties:U.properties,type:U.type,sourceLayerIndex:de,index:ne,geometry:_e?be.geometry:pi(U),patterns:{},sortKey:Ce};B.push(Ie)}z&&B.sort((U,Z)=>U.sortKey-Z.sortKey);for(const U of B){const{geometry:Z,index:ne,sourceLayerIndex:de}=U;if(this.hasPattern){const _e=tg("line",this.layers,U,this.zoom,h);this.patternFeatures.push(_e)}else this.addFeature(U,Z,ne,v,{});h.featureIndex.insert(s[ne].feature,Z,ne,de,this.index)}}update(s,h,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,v)}addFeatures(s,h,v){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,h,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Wu)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,G_),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,h,v,I,z){const B=this.layers[0].layout,U=B.get("line-join").evaluate(s,{}),Z=B.get("line-cap"),ne=B.get("line-miter-limit"),de=B.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const _e of h)this.addLine(_e,s,U,Z,ne,de);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,v,z,I)}addLine(s,h,v,I,z,B){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pt=0;Pt<s.length-1;Pt++)this.totalDistance+=s[Pt].dist(s[Pt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const U=sd[h.type]==="Polygon";let Z=s.length;for(;Z>=2&&s[Z-1].equals(s[Z-2]);)Z--;let ne=0;for(;ne<Z-1&&s[ne].equals(s[ne+1]);)ne++;if(Z<(U?3:2))return;v==="bevel"&&(z=1.05);const de=this.overscaling<=16?122880/(512*this.overscaling):0,_e=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let be,Ce,Ie,dt,st;this.e1=this.e2=-1,U&&(be=s[Z-2],st=s[ne].sub(be)._unit()._perp());for(let Pt=ne;Pt<Z;Pt++){if(Ie=Pt===Z-1?U?s[ne+1]:void 0:s[Pt+1],Ie&&s[Pt].equals(Ie))continue;st&&(dt=st),be&&(Ce=be),be=s[Pt],st=Ie?Ie.sub(be)._unit()._perp():dt,dt=dt||st;let Xt=dt.add(st);Xt.x===0&&Xt.y===0||Xt._unit();const Ct=dt.x*st.x+dt.y*st.y,jt=Xt.x*st.x+Xt.y*st.y,hi=jt!==0?1/jt:1/0,li=2*Math.sqrt(2-2*jt),nn=jt<qp&&Ce&&Ie,Wi=dt.x*st.y-dt.y*st.x>0;if(nn&&Pt>ne){const Di=be.dist(Ce);if(Di>2*de){const Qi=be.sub(be.sub(Ce)._mult(de/Di)._round());this.updateDistance(Ce,Qi),this.addCurrentVertex(Qi,dt,0,0,_e),Ce=Qi}}const Xi=Ce&&Ie;let Ri=Xi?v:U?"butt":I;if(Xi&&Ri==="round"&&(hi<B?Ri="miter":hi<=2&&(Ri="fakeround")),Ri==="miter"&&hi>z&&(Ri="bevel"),Ri==="bevel"&&(hi>2&&(Ri="flipbevel"),hi<z&&(Ri="miter")),Ce&&this.updateDistance(Ce,be),Ri==="miter")Xt._mult(hi),this.addCurrentVertex(be,Xt,0,0,_e);else if(Ri==="flipbevel"){if(hi>100)Xt=st.mult(-1);else{const Di=hi*dt.add(st).mag()/dt.sub(st).mag();Xt._perp()._mult(Di*(Wi?-1:1))}this.addCurrentVertex(be,Xt,0,0,_e),this.addCurrentVertex(be,Xt.mult(-1),0,0,_e)}else if(Ri==="bevel"||Ri==="fakeround"){const Di=-Math.sqrt(hi*hi-1),Qi=Wi?Di:0,Hi=Wi?0:Di;if(Ce&&this.addCurrentVertex(be,dt,Qi,Hi,_e),Ri==="fakeround"){const Ai=Math.round(180*li/Math.PI/20);for(let bn=1;bn<Ai;bn++){let fn=bn/Ai;if(fn!==.5){const fo=fn-.5;fn+=fn*fo*(fn-1)*((1.0904+Ct*(Ct*(3.55645-1.43519*Ct)-3.2452))*fo*fo+(.848013+Ct*(.215638*Ct-1.06021)))}const tr=st.sub(dt)._mult(fn)._add(dt)._unit()._mult(Wi?-1:1);this.addHalfVertex(be,tr.x,tr.y,!1,Wi,0,_e)}}Ie&&this.addCurrentVertex(be,st,-Qi,-Hi,_e)}else if(Ri==="butt")this.addCurrentVertex(be,Xt,0,0,_e);else if(Ri==="square"){const Di=Ce?1:-1;this.addCurrentVertex(be,Xt,Di,Di,_e)}else Ri==="round"&&(Ce&&(this.addCurrentVertex(be,dt,0,0,_e),this.addCurrentVertex(be,dt,1,1,_e,!0)),Ie&&(this.addCurrentVertex(be,st,-1,-1,_e,!0),this.addCurrentVertex(be,st,0,0,_e)));if(nn&&Pt<Z-1){const Di=be.dist(Ie);if(Di>2*de){const Qi=be.add(Ie.sub(be)._mult(de/Di)._round());this.updateDistance(be,Qi),this.addCurrentVertex(Qi,st,0,0,_e),be=Qi}}}}addCurrentVertex(s,h,v,I,z,B=!1){const U=h.y*I-h.x,Z=-h.y-h.x*I;this.addHalfVertex(s,h.x+h.y*v,h.y-h.x*v,B,!1,v,z),this.addHalfVertex(s,U,Z,B,!0,-I,z),this.distance>Nf/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,h,v,I,z,B))}addHalfVertex({x:s,y:h},v,I,z,B,U,Z){const ne=.5*(this.lineClips?this.scaledDistance*(Nf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(z?1:0),(h<<1)+(B?1:0),Math.round(63*v)+128,Math.round(63*I)+128,1+(U===0?0:U<0?-1:1)|(63&ne)<<2,ne>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const de=Z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,de),Z.primitiveLength++),B?this.e2=de:this.e1=de}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,h){this.distance+=s.dist(h),this.updateScaledDistance()}}Zi("LineBucket",Uf,{omit:["layers","patternFeatures"]});const q_=new Ao({"line-cap":new an(Ot.layout_line["line-cap"]),"line-join":new yn(Ot.layout_line["line-join"]),"line-miter-limit":new an(Ot.layout_line["line-miter-limit"]),"line-round-limit":new an(Ot.layout_line["line-round-limit"]),"line-sort-key":new yn(Ot.layout_line["line-sort-key"])});var Z_={paint:new Ao({"line-opacity":new yn(Ot.paint_line["line-opacity"]),"line-color":new yn(Ot.paint_line["line-color"]),"line-translate":new an(Ot.paint_line["line-translate"]),"line-translate-anchor":new an(Ot.paint_line["line-translate-anchor"]),"line-width":new yn(Ot.paint_line["line-width"]),"line-gap-width":new yn(Ot.paint_line["line-gap-width"]),"line-offset":new yn(Ot.paint_line["line-offset"]),"line-blur":new yn(Ot.paint_line["line-blur"]),"line-dasharray":new Qh(Ot.paint_line["line-dasharray"]),"line-pattern":new Hc(Ot.paint_line["line-pattern"]),"line-gradient":new fl(Ot.paint_line["line-gradient"])}),layout:q_};const og=new class extends yn{possiblyEvaluate(c,s){return s=new Rr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(c,s)}evaluate(c,s,h,v){return s=me({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(c,s,h,v)}}(Z_.paint.properties["line-width"].specification);function W_(c,s){return s>0?s+2*c:c}og.useIntegerZoom=!0;const sg=zo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),r0=zo([{name:"a_projected_pos",components:3,type:"Float32"}],4);zo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ag=zo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);zo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lg=zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),X_=zo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ad(c,s,h){return c.sections.forEach(v=>{v.text=function(I,z,B){const U=z.layout.get("text-transform").evaluate(B,{});return U==="uppercase"?I=I.toLocaleUpperCase():U==="lowercase"&&(I=I.toLocaleLowerCase()),vo.applyArabicShaping&&(I=vo.applyArabicShaping(I)),I}(v.text,s,h)}),c}zo([{name:"triangle",components:3,type:"Uint16"}]),zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zo([{type:"Float32",name:"offsetX"}]),zo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Xd={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Ss=24,bh=Gr,$f=function(c,s,h,v,I){var z,B,U=8*I-v-1,Z=(1<<U)-1,ne=Z>>1,de=-7,_e=h?I-1:0,be=h?-1:1,Ce=c[s+_e];for(_e+=be,z=Ce&(1<<-de)-1,Ce>>=-de,de+=U;de>0;z=256*z+c[s+_e],_e+=be,de-=8);for(B=z&(1<<-de)-1,z>>=-de,de+=v;de>0;B=256*B+c[s+_e],_e+=be,de-=8);if(z===0)z=1-ne;else{if(z===Z)return B?NaN:1/0*(Ce?-1:1);B+=Math.pow(2,v),z-=ne}return(Ce?-1:1)*B*Math.pow(2,z-v)},cg=function(c,s,h,v,I,z){var B,U,Z,ne=8*z-I-1,de=(1<<ne)-1,_e=de>>1,be=I===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ce=v?0:z-1,Ie=v?1:-1,dt=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(U=isNaN(s)?1:0,B=de):(B=Math.floor(Math.log(s)/Math.LN2),s*(Z=Math.pow(2,-B))<1&&(B--,Z*=2),(s+=B+_e>=1?be/Z:be*Math.pow(2,1-_e))*Z>=2&&(B++,Z/=2),B+_e>=de?(U=0,B=de):B+_e>=1?(U=(s*Z-1)*Math.pow(2,I),B+=_e):(U=s*Math.pow(2,_e-1)*Math.pow(2,I),B=0));I>=8;c[h+Ce]=255&U,Ce+=Ie,U/=256,I-=8);for(B=B<<I|U,ne+=I;ne>0;c[h+Ce]=255&B,Ce+=Ie,B/=256,ne-=8);c[h+Ce-Ie]|=128*dt};function Gr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Gr.Varint=0,Gr.Fixed64=1,Gr.Bytes=2,Gr.Fixed32=5;var wh,ug=4294967296,jf=1/ug,Ia=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function eu(c){return c.type===Gr.Bytes?c.readVarint()+c.pos:c.pos+1}function ld(c,s,h){return h?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function Vl(c,s,h){var v=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));h.realloc(v);for(var I=h.pos-1;I>=c;I--)h.buf[I+v]=h.buf[I]}function hg(c,s){for(var h=0;h<c.length;h++)s.writeVarint(c[h])}function cd(c,s){for(var h=0;h<c.length;h++)s.writeSVarint(c[h])}function Gf(c,s){for(var h=0;h<c.length;h++)s.writeFloat(c[h])}function ud(c,s){for(var h=0;h<c.length;h++)s.writeDouble(c[h])}function dg(c,s){for(var h=0;h<c.length;h++)s.writeBoolean(c[h])}function Zp(c,s){for(var h=0;h<c.length;h++)s.writeFixed32(c[h])}function H_(c,s){for(var h=0;h<c.length;h++)s.writeSFixed32(c[h])}function K_(c,s){for(var h=0;h<c.length;h++)s.writeFixed64(c[h])}function o0(c,s){for(var h=0;h<c.length;h++)s.writeSFixed64(c[h])}function Hd(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function hd(c,s,h){c[h]=s,c[h+1]=s>>>8,c[h+2]=s>>>16,c[h+3]=s>>>24}function Kd(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}function Yd(c,s,h){c===1&&h.readMessage(Xu,s)}function Xu(c,s,h){if(c===3){const{id:v,bitmap:I,width:z,height:B,left:U,top:Z,advance:ne}=h.readMessage(fg,{});s.push({id:v,bitmap:new qu({width:z+6,height:B+6},I),metrics:{width:z,height:B,left:U,top:Z,advance:ne}})}}function fg(c,s,h){c===1?s.id=h.readVarint():c===2?s.bitmap=h.readBytes():c===3?s.width=h.readVarint():c===4?s.height=h.readVarint():c===5?s.left=h.readSVarint():c===6?s.top=h.readSVarint():c===7&&(s.advance=h.readVarint())}function pg(c){let s=0,h=0;for(const B of c)s+=B.w*B.h,h=Math.max(h,B.w);c.sort((B,U)=>U.h-B.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),h),h:1/0}];let I=0,z=0;for(const B of c)for(let U=v.length-1;U>=0;U--){const Z=v[U];if(!(B.w>Z.w||B.h>Z.h)){if(B.x=Z.x,B.y=Z.y,z=Math.max(z,B.y+B.h),I=Math.max(I,B.x+B.w),B.w===Z.w&&B.h===Z.h){const ne=v.pop();U<v.length&&(v[U]=ne)}else B.h===Z.h?(Z.x+=B.w,Z.w-=B.w):B.w===Z.w?(Z.y+=B.h,Z.h-=B.h):(v.push({x:Z.x+B.w,y:Z.y,w:Z.w-B.w,h:B.h}),Z.y+=B.h,Z.h-=B.h);break}}return{w:I,h:z,fill:s/(I*z)||0}}Gr.prototype={destroy:function(){this.buf=null},readFields:function(c,s,h){for(h=h||this.length;this.pos<h;){var v=this.readVarint(),I=v>>3,z=this.pos;this.type=7&v,c(I,s,this),this.pos===z&&this.skip(v)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=Hd(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Kd(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Hd(this.buf,this.pos)+Hd(this.buf,this.pos+4)*ug;return this.pos+=8,c},readSFixed64:function(){var c=Hd(this.buf,this.pos)+Kd(this.buf,this.pos+4)*ug;return this.pos+=8,c},readFloat:function(){var c=$f(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=$f(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,h,v=this.buf;return s=127&(h=v[this.pos++]),h<128?s:(s|=(127&(h=v[this.pos++]))<<7,h<128?s:(s|=(127&(h=v[this.pos++]))<<14,h<128?s:(s|=(127&(h=v[this.pos++]))<<21,h<128?s:function(I,z,B){var U,Z,ne=B.buf;if(U=(112&(Z=ne[B.pos++]))>>4,Z<128||(U|=(127&(Z=ne[B.pos++]))<<3,Z<128)||(U|=(127&(Z=ne[B.pos++]))<<10,Z<128)||(U|=(127&(Z=ne[B.pos++]))<<17,Z<128)||(U|=(127&(Z=ne[B.pos++]))<<24,Z<128)||(U|=(1&(Z=ne[B.pos++]))<<31,Z<128))return ld(I,U,z);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(h=v[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&Ia?function(h,v,I){return Ia.decode(h.subarray(v,I))}(this.buf,s,c):function(h,v,I){for(var z="",B=v;B<I;){var U,Z,ne,de=h[B],_e=null,be=de>239?4:de>223?3:de>191?2:1;if(B+be>I)break;be===1?de<128&&(_e=de):be===2?(192&(U=h[B+1]))==128&&(_e=(31&de)<<6|63&U)<=127&&(_e=null):be===3?(Z=h[B+2],(192&(U=h[B+1]))==128&&(192&Z)==128&&((_e=(15&de)<<12|(63&U)<<6|63&Z)<=2047||_e>=55296&&_e<=57343)&&(_e=null)):be===4&&(Z=h[B+2],ne=h[B+3],(192&(U=h[B+1]))==128&&(192&Z)==128&&(192&ne)==128&&((_e=(15&de)<<18|(63&U)<<12|(63&Z)<<6|63&ne)<=65535||_e>=1114112)&&(_e=null)),_e===null?(_e=65533,be=1):_e>65535&&(_e-=65536,z+=String.fromCharCode(_e>>>10&1023|55296),_e=56320|1023&_e),z+=String.fromCharCode(_e),B+=be}return z}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==Gr.Bytes)return c.push(this.readVarint(s));var h=eu(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==Gr.Bytes)return c.push(this.readSVarint());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Gr.Bytes)return c.push(this.readBoolean());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Gr.Bytes)return c.push(this.readFloat());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Gr.Bytes)return c.push(this.readDouble());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Gr.Bytes)return c.push(this.readFixed32());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Gr.Bytes)return c.push(this.readSFixed32());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Gr.Bytes)return c.push(this.readFixed64());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Gr.Bytes)return c.push(this.readSFixed64());var s=eu(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===Gr.Varint)for(;this.buf[this.pos++]>127;);else if(s===Gr.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Gr.Fixed32)this.pos+=4;else{if(s!==Gr.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),hd(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),hd(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),hd(this.buf,-1&c,this.pos),hd(this.buf,Math.floor(c*jf),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),hd(this.buf,-1&c,this.pos),hd(this.buf,Math.floor(c*jf),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,h){var v,I;if(s>=0?(v=s%4294967296|0,I=s/4294967296|0):(I=~(-s/4294967296),4294967295^(v=~(-s%4294967296))?v=v+1|0:(v=0,I=I+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(z,B,U){U.buf[U.pos++]=127&z|128,z>>>=7,U.buf[U.pos++]=127&z|128,z>>>=7,U.buf[U.pos++]=127&z|128,z>>>=7,U.buf[U.pos++]=127&z|128,U.buf[U.pos]=127&(z>>>=7)}(v,0,h),function(z,B){var U=(7&z)<<4;B.buf[B.pos++]|=U|((z>>>=3)?128:0),z&&(B.buf[B.pos++]=127&z|((z>>>=7)?128:0),z&&(B.buf[B.pos++]=127&z|((z>>>=7)?128:0),z&&(B.buf[B.pos++]=127&z|((z>>>=7)?128:0),z&&(B.buf[B.pos++]=127&z|((z>>>=7)?128:0),z&&(B.buf[B.pos++]=127&z)))))}(I,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(Boolean(c))},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(v,I,z){for(var B,U,Z=0;Z<I.length;Z++){if((B=I.charCodeAt(Z))>55295&&B<57344){if(!U){B>56319||Z+1===I.length?(v[z++]=239,v[z++]=191,v[z++]=189):U=B;continue}if(B<56320){v[z++]=239,v[z++]=191,v[z++]=189,U=B;continue}B=U-55296<<10|B-56320|65536,U=null}else U&&(v[z++]=239,v[z++]=191,v[z++]=189,U=null);B<128?v[z++]=B:(B<2048?v[z++]=B>>6|192:(B<65536?v[z++]=B>>12|224:(v[z++]=B>>18|240,v[z++]=B>>12&63|128),v[z++]=B>>6&63|128),v[z++]=63&B|128)}return z}(this.buf,c,this.pos);var h=this.pos-s;h>=128&&Vl(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),cg(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),cg(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var h=0;h<s;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,s){this.pos++;var h=this.pos;c(s,this);var v=this.pos-h;v>=128&&Vl(h,v,this),this.pos=h-1,this.writeVarint(v),this.pos+=v},writeMessage:function(c,s,h){this.writeTag(c,Gr.Bytes),this.writeRawMessage(s,h)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,hg,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,cd,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,dg,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,Gf,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,ud,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,Zp,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,H_,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,K_,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,o0,s)},writeBytesField:function(c,s){this.writeTag(c,Gr.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,Gr.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,Gr.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,Gr.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,Gr.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,Gr.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,Gr.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,Gr.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,Gr.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,Gr.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,Boolean(s))}};class dd{constructor(s,{pixelRatio:h,version:v,stretchX:I,stretchY:z,content:B}){this.paddedRect=s,this.pixelRatio=h,this.stretchX=I,this.stretchY=z,this.content=B,this.version=v}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jd{constructor(s,h){const v={},I={};this.haveRenderCallbacks=[];const z=[];this.addImages(s,v,z),this.addImages(h,I,z);const{w:B,h:U}=pg(z),Z=new fa({width:B||1,height:U||1});for(const ne in s){const de=s[ne],_e=v[ne].paddedRect;fa.copy(de.data,Z,{x:0,y:0},{x:_e.x+1,y:_e.y+1},de.data)}for(const ne in h){const de=h[ne],_e=I[ne].paddedRect,be=_e.x+1,Ce=_e.y+1,Ie=de.data.width,dt=de.data.height;fa.copy(de.data,Z,{x:0,y:0},{x:be,y:Ce},de.data),fa.copy(de.data,Z,{x:0,y:dt-1},{x:be,y:Ce-1},{width:Ie,height:1}),fa.copy(de.data,Z,{x:0,y:0},{x:be,y:Ce+dt},{width:Ie,height:1}),fa.copy(de.data,Z,{x:Ie-1,y:0},{x:be-1,y:Ce},{width:1,height:dt}),fa.copy(de.data,Z,{x:0,y:0},{x:be+Ie,y:Ce},{width:1,height:dt})}this.image=Z,this.iconPositions=v,this.patternPositions=I}addImages(s,h,v){for(const I in s){const z=s[I],B={x:0,y:0,w:z.data.width+2,h:z.data.height+2};v.push(B),h[I]=new dd(B,z),z.hasRenderCallback&&this.haveRenderCallbacks.push(I)}}patchUpdatedImages(s,h){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const v in s.updatedImages)this.patchUpdatedImage(this.iconPositions[v],s.getImage(v),h),this.patchUpdatedImage(this.patternPositions[v],s.getImage(v),h)}patchUpdatedImage(s,h,v){if(!s||!h||s.version===h.version)return;s.version=h.version;const[I,z]=s.tl;v.update(h.data,void 0,{x:I,y:z})}}Zi("ImagePosition",dd),Zi("ImageAtlas",Jd),i.WritingMode=void 0,(wh=i.WritingMode||(i.WritingMode={}))[wh.none=0]="none",wh[wh.horizontal=1]="horizontal",wh[wh.vertical=2]="vertical",wh[wh.horizontalOnly=3]="horizontalOnly";const pa=-17;class Hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,h){const v=new Hu;return v.scale=s||1,v.fontStack=h,v}static forImage(s){const h=new Hu;return h.imageName=s,h}}class hs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,h){const v=new hs;for(let I=0;I<s.sections.length;I++){const z=s.sections[I];z.image?v.addImageSection(z):v.addTextSection(z,h)}return v}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let h="";for(let v=0;v<s.length;v++){const I=s.charCodeAt(v+1)||null,z=s.charCodeAt(v-1)||null;h+=I&&Ru(I)&&!Xd[s[v+1]]||z&&Ru(z)&&!Xd[s[v-1]]||!Xd[s[v]]?s[v]:Xd[s[v]]}return h}(this.text)}trim(){let s=0;for(let v=0;v<this.text.length&&Qd[this.text.charCodeAt(v)];v++)s++;let h=this.text.length;for(let v=this.text.length-1;v>=0&&v>=s&&Qd[this.text.charCodeAt(v)];v--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)}substring(s,h){const v=new hs;return v.text=this.text.substring(s,h),v.sectionIndex=this.sectionIndex.slice(s,h),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,h)=>Math.max(s,this.sections[h].scale),0)}addTextSection(s,h){this.text+=s.text,this.sections.push(Hu.forText(s.scale,s.fontStack||h));const v=this.sections.length-1;for(let I=0;I<s.text.length;++I)this.sectionIndex.push(v)}addImageSection(s){const h=s.image?s.image.name:"";if(h.length===0)return void Me("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCharCode(v),this.sections.push(Hu.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Me("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Aa(c,s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt){const st=hs.fromFeature(c,I);let Pt;_e===i.WritingMode.vertical&&st.verticalizePunctuation();const{processBidirectionalText:Xt,processStyledBidirectionalText:Ct}=vo;if(Xt&&st.sections.length===1){Pt=[];const li=Xt(st.toString(),Wp(st,ne,z,s,v,Ce,Ie));for(const nn of li){const Wi=new hs;Wi.text=nn,Wi.sections=st.sections;for(let Xi=0;Xi<nn.length;Xi++)Wi.sectionIndex.push(0);Pt.push(Wi)}}else if(Ct){Pt=[];const li=Ct(st.text,st.sectionIndex,Wp(st,ne,z,s,v,Ce,Ie));for(const nn of li){const Wi=new hs;Wi.text=nn[0],Wi.sectionIndex=nn[1],Wi.sections=st.sections,Pt.push(Wi)}}else Pt=function(li,nn){const Wi=[],Xi=li.text;let Ri=0;for(const Di of nn)Wi.push(li.substring(Ri,Di)),Ri=Di;return Ri<Xi.length&&Wi.push(li.substring(Ri,Xi.length)),Wi}(st,Wp(st,ne,z,s,v,Ce,Ie));const jt=[],hi={positionedLines:jt,text:st.toString(),top:de[1],bottom:de[1],left:de[0],right:de[0],writingMode:_e,iconsInText:!1,verticalizable:!1};return function(li,nn,Wi,Xi,Ri,Di,Qi,Hi,Ai,bn,fn,tr){let fo=0,bo=pa,$o=0,vl=0;const Cs=Hi==="right"?1:Hi==="left"?0:.5;let Xo=0;for(const ls of Ri){ls.trim();const Rs=ls.getMaxScale(),Os=(Rs-1)*Ss,ma={positionedGlyphs:[],lineOffset:0};li.positionedLines[Xo]=ma;const qr=ma.positionedGlyphs;let jo=0;if(!ls.length()){bo+=Di,++Xo;continue}for(let Ho=0;Ho<ls.length();Ho++){const Kn=ls.getSection(Ho),Wa=ls.getSectionIndex(Ho),Fs=ls.getCharCode(Ho);let fs=0,Ul=null,gc=null,ka=null,iu=Ss;const xl=!(Ai===i.WritingMode.horizontal||!fn&&!Hh(Fs)||fn&&(Qd[Fs]||(ds=Fs,Ni.Arabic(ds)||Ni["Arabic Supplement"](ds)||Ni["Arabic Extended-A"](ds)||Ni["Arabic Presentation Forms-A"](ds)||Ni["Arabic Presentation Forms-B"](ds))));if(Kn.imageName){const or=Xi[Kn.imageName];if(!or)continue;ka=Kn.imageName,li.iconsInText=li.iconsInText||!0,gc=or.paddedRect;const Ks=or.displaySize;Kn.scale=Kn.scale*Ss/tr,Ul={width:Ks[0],height:Ks[1],left:1,top:-3,advance:xl?Ks[1]:Ks[0]},fs=Os+(Ss-Ks[1]*Kn.scale),iu=Ul.advance;const nu=xl?Ks[0]*Kn.scale-Ss*Rs:Ks[1]*Kn.scale-Ss*Rs;nu>0&&nu>jo&&(jo=nu)}else{const or=Wi[Kn.fontStack],Ks=or&&or[Fs];if(Ks&&Ks.rect)gc=Ks.rect,Ul=Ks.metrics;else{const nu=nn[Kn.fontStack],hf=nu&&nu[Fs];if(!hf)continue;Ul=hf.metrics}fs=(Rs-Kn.scale)*Ss}xl?(li.verticalizable=!0,qr.push({glyph:Fs,imageName:ka,x:fo,y:bo+fs,vertical:xl,scale:Kn.scale,fontStack:Kn.fontStack,sectionIndex:Wa,metrics:Ul,rect:gc}),fo+=iu*Kn.scale+bn):(qr.push({glyph:Fs,imageName:ka,x:fo,y:bo+fs,vertical:xl,scale:Kn.scale,fontStack:Kn.fontStack,sectionIndex:Wa,metrics:Ul,rect:gc}),fo+=Ul.advance*Kn.scale+bn)}qr.length!==0&&($o=Math.max(fo-bn,$o),fd(qr,0,qr.length-1,Cs,jo)),fo=0;const po=Di*Rs+jo;ma.lineOffset=Math.max(jo,Os),bo+=po,vl=Math.max(po,vl),++Xo}var ds;const Bs=bo-pa,{horizontalAlign:Hs,verticalAlign:Ma}=Xp(Qi);(function(ls,Rs,Os,ma,qr,jo,po,Ho,Kn){const Wa=(Rs-Os)*qr;let Fs=0;Fs=jo!==po?-Ho*ma-pa:(-ma*Kn+.5)*po;for(const fs of ls)for(const Ul of fs.positionedGlyphs)Ul.x+=Wa,Ul.y+=Fs})(li.positionedLines,Cs,Hs,Ma,$o,vl,Di,Bs,Ri.length),li.top+=-Ma*Bs,li.bottom=li.top+Bs,li.left+=-Hs*$o,li.right=li.left+$o}(hi,s,h,v,Pt,B,U,Z,_e,ne,be,dt),!function(li){for(const nn of li)if(nn.positionedGlyphs.length!==0)return!1;return!0}(jt)&&hi}const Qd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Uo={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mg(c,s,h,v,I,z){if(s.imageName){const B=v[s.imageName];return B?B.displaySize[0]*s.scale*Ss/z+I:0}{const B=h[s.fontStack],U=B&&B[c];return U?U.metrics.advance*s.scale+I:0}}function ef(c,s,h,v){const I=Math.pow(c-s,2);return v?c<s?I/2:2*I:I+Math.abs(h)*h}function pc(c,s,h){let v=0;return c===10&&(v-=1e4),h&&(v+=150),c!==40&&c!==65288||(v+=50),s!==41&&s!==65289||(v+=50),v}function Y_(c,s,h,v,I,z){let B=null,U=ef(s,h,I,z);for(const Z of v){const ne=ef(s-Z.x,h,I,z)+Z.badness;ne<=U&&(B=Z,U=ne)}return{index:c,x:s,priorBreak:B,badness:U}}function J_(c){return c?J_(c.priorBreak).concat(c.index):[]}function Wp(c,s,h,v,I,z,B){if(z!=="point")return[];if(!c)return[];const U=[],Z=function(be,Ce,Ie,dt,st,Pt){let Xt=0;for(let Ct=0;Ct<be.length();Ct++){const jt=be.getSection(Ct);Xt+=mg(be.getCharCode(Ct),jt,dt,st,Ce,Pt)}return Xt/Math.max(1,Math.ceil(Xt/Ie))}(c,s,h,v,I,B),ne=c.text.indexOf("\u200B")>=0;let de=0;for(let be=0;be<c.length();be++){const Ce=c.getSection(be),Ie=c.getCharCode(be);if(Qd[Ie]||(de+=mg(Ie,Ce,v,I,s,B)),be<c.length()-1){const dt=!((_e=Ie)<11904||!(Ni["Bopomofo Extended"](_e)||Ni.Bopomofo(_e)||Ni["CJK Compatibility Forms"](_e)||Ni["CJK Compatibility Ideographs"](_e)||Ni["CJK Compatibility"](_e)||Ni["CJK Radicals Supplement"](_e)||Ni["CJK Strokes"](_e)||Ni["CJK Symbols and Punctuation"](_e)||Ni["CJK Unified Ideographs Extension A"](_e)||Ni["CJK Unified Ideographs"](_e)||Ni["Enclosed CJK Letters and Months"](_e)||Ni["Halfwidth and Fullwidth Forms"](_e)||Ni.Hiragana(_e)||Ni["Ideographic Description Characters"](_e)||Ni["Kangxi Radicals"](_e)||Ni["Katakana Phonetic Extensions"](_e)||Ni.Katakana(_e)||Ni["Vertical Forms"](_e)||Ni["Yi Radicals"](_e)||Ni["Yi Syllables"](_e)));(Uo[Ie]||dt||Ce.imageName)&&U.push(Y_(be+1,de,Z,U,pc(Ie,c.getCharCode(be+1),dt&&ne),!1))}}var _e;return J_(Y_(c.length(),de,Z,U,0,!0))}function Xp(c){let s=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:s,verticalAlign:h}}function fd(c,s,h,v,I){if(!v&&!I)return;const z=c[h],B=(c[h].x+z.metrics.advance*z.scale)*v;for(let U=s;U<=h;U++)c[U].x-=B,c[U].y+=I}function Q_(c,s,h){const{horizontalAlign:v,verticalAlign:I}=Xp(h),z=s[0]-c.displaySize[0]*v,B=s[1]-c.displaySize[1]*I;return{image:c,top:B,bottom:B+c.displaySize[1],left:z,right:z+c.displaySize[0]}}function gg(c,s,h,v,I,z){const B=c.image;let U;if(B.content){const st=B.content,Pt=B.pixelRatio||1;U=[st[0]/Pt,st[1]/Pt,B.displaySize[0]-st[2]/Pt,B.displaySize[1]-st[3]/Pt]}const Z=s.left*z,ne=s.right*z;let de,_e,be,Ce;h==="width"||h==="both"?(Ce=I[0]+Z-v[3],_e=I[0]+ne+v[1]):(Ce=I[0]+(Z+ne-B.displaySize[0])/2,_e=Ce+B.displaySize[0]);const Ie=s.top*z,dt=s.bottom*z;return h==="height"||h==="both"?(de=I[1]+Ie-v[0],be=I[1]+dt+v[2]):(de=I[1]+(Ie+dt-B.displaySize[1])/2,be=de+B.displaySize[1]),{image:B,top:de,right:_e,bottom:be,left:Ce,collisionPadding:U}}const tu=128;function _g(c,s){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Rr(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:I}=h;let z=0;for(;z<v.length&&v[z]<=c;)z++;z=Math.max(0,z-1);let B=z;for(;B<v.length&&v[B]<c+1;)B++;B=Math.min(v.length-1,B);const U=v[z],Z=v[B];return h.kind==="composite"?{kind:"composite",minZoom:U,maxZoom:Z,interpolationType:I}:{kind:"camera",minZoom:U,maxZoom:Z,minSize:h.evaluate(new Rr(U)),maxSize:h.evaluate(new Rr(Z)),interpolationType:I}}}class Th extends zt{constructor(s,h,v,I){super(s,h),this.angle=v,I!==void 0&&(this.segment=I)}clone(){return new Th(this.x,this.y,this.angle,this.segment)}}function Hp(c,s,h,v,I){if(s.segment===void 0)return!0;let z=s,B=s.segment+1,U=0;for(;U>-h/2;){if(B--,B<0)return!1;U-=c[B].dist(z),z=c[B]}U+=c[B].dist(c[B+1]),B++;const Z=[];let ne=0;for(;U<h/2;){const de=c[B],_e=c[B+1];if(!_e)return!1;let be=c[B-1].angleTo(de)-de.angleTo(_e);for(be=Math.abs((be+3*Math.PI)%(2*Math.PI)-Math.PI),Z.push({distance:U,angleDelta:be}),ne+=be;U-Z[0].distance>v;)ne-=Z.shift().angleDelta;if(ne>I)return!1;B++,U+=de.dist(_e)}return!0}function Kp(c){let s=0;for(let h=0;h<c.length-1;h++)s+=c[h].dist(c[h+1]);return s}function Yp(c,s,h){return c?.6*s*h:0}function Xs(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function ey(c,s,h,v,I,z){const B=Yp(h,I,z),U=Xs(h,v)*z;let Z=0;const ne=Kp(c)/2;for(let de=0;de<c.length-1;de++){const _e=c[de],be=c[de+1],Ce=_e.dist(be);if(Z+Ce>ne){const Ie=(ne-Z)/Ce,dt=Hr(_e.x,be.x,Ie),st=Hr(_e.y,be.y,Ie),Pt=new Th(dt,st,be.angleTo(_e),de);return Pt._round(),!B||Hp(c,Pt,U,B,s)?Pt:void 0}Z+=Ce}}function s0(c,s,h,v,I,z,B,U,Z){const ne=Yp(v,z,B),de=Xs(v,I),_e=de*B,be=c[0].x===0||c[0].x===Z||c[0].y===0||c[0].y===Z;return s-_e<s/4&&(s=_e+s/4),yg(c,be?s/2*U%s:(de/2+2*z)*B*U%s,s,ne,h,_e,be,!1,Z)}function yg(c,s,h,v,I,z,B,U,Z){const ne=z/2,de=Kp(c);let _e=0,be=s-h,Ce=[];for(let Ie=0;Ie<c.length-1;Ie++){const dt=c[Ie],st=c[Ie+1],Pt=dt.dist(st),Xt=st.angleTo(dt);for(;be+h<_e+Pt;){be+=h;const Ct=(be-_e)/Pt,jt=Hr(dt.x,st.x,Ct),hi=Hr(dt.y,st.y,Ct);if(jt>=0&&jt<Z&&hi>=0&&hi<Z&&be-ne>=0&&be+ne<=de){const li=new Th(jt,hi,Xt,Ie);li._round(),v&&!Hp(c,li,z,v,I)||Ce.push(li)}}_e+=Pt}return U||Ce.length||B||(Ce=yg(c,_e/2,h,v,I,z,B,!0,Z)),Ce}function ty(c,s,h,v,I){const z=[];for(let B=0;B<c.length;B++){const U=c[B];let Z;for(let ne=0;ne<U.length-1;ne++){let de=U[ne],_e=U[ne+1];de.x<s&&_e.x<s||(de.x<s?de=new zt(s,de.y+(s-de.x)/(_e.x-de.x)*(_e.y-de.y))._round():_e.x<s&&(_e=new zt(s,de.y+(s-de.x)/(_e.x-de.x)*(_e.y-de.y))._round()),de.y<h&&_e.y<h||(de.y<h?de=new zt(de.x+(h-de.y)/(_e.y-de.y)*(_e.x-de.x),h)._round():_e.y<h&&(_e=new zt(de.x+(h-de.y)/(_e.y-de.y)*(_e.x-de.x),h)._round()),de.x>=v&&_e.x>=v||(de.x>=v?de=new zt(v,de.y+(v-de.x)/(_e.x-de.x)*(_e.y-de.y))._round():_e.x>=v&&(_e=new zt(v,de.y+(v-de.x)/(_e.x-de.x)*(_e.y-de.y))._round()),de.y>=I&&_e.y>=I||(de.y>=I?de=new zt(de.x+(I-de.y)/(_e.y-de.y)*(_e.x-de.x),I)._round():_e.y>=I&&(_e=new zt(de.x+(I-de.y)/(_e.y-de.y)*(_e.x-de.x),I)._round()),Z&&de.equals(Z[Z.length-1])||(Z=[de],z.push(Z)),Z.push(_e)))))}}return z}function iy(c,s,h,v){const I=[],z=c.image,B=z.pixelRatio,U=z.paddedRect.w-2,Z=z.paddedRect.h-2,ne=c.right-c.left,de=c.bottom-c.top,_e=z.stretchX||[[0,U]],be=z.stretchY||[[0,Z]],Ce=(Di,Qi)=>Di+Qi[1]-Qi[0],Ie=_e.reduce(Ce,0),dt=be.reduce(Ce,0),st=U-Ie,Pt=Z-dt;let Xt=0,Ct=Ie,jt=0,hi=dt,li=0,nn=st,Wi=0,Xi=Pt;if(z.content&&v){const Di=z.content;Xt=qf(_e,0,Di[0]),jt=qf(be,0,Di[1]),Ct=qf(_e,Di[0],Di[2]),hi=qf(be,Di[1],Di[3]),li=Di[0]-Xt,Wi=Di[1]-jt,nn=Di[2]-Di[0]-Ct,Xi=Di[3]-Di[1]-hi}const Ri=(Di,Qi,Hi,Ai)=>{const bn=Zf(Di.stretch-Xt,Ct,ne,c.left),fn=tf(Di.fixed-li,nn,Di.stretch,Ie),tr=Zf(Qi.stretch-jt,hi,de,c.top),fo=tf(Qi.fixed-Wi,Xi,Qi.stretch,dt),bo=Zf(Hi.stretch-Xt,Ct,ne,c.left),$o=tf(Hi.fixed-li,nn,Hi.stretch,Ie),vl=Zf(Ai.stretch-jt,hi,de,c.top),Cs=tf(Ai.fixed-Wi,Xi,Ai.stretch,dt),Xo=new zt(bn,tr),ds=new zt(bo,tr),Bs=new zt(bo,vl),Hs=new zt(bn,vl),Ma=new zt(fn/B,fo/B),ls=new zt($o/B,Cs/B),Rs=s*Math.PI/180;if(Rs){const qr=Math.sin(Rs),jo=Math.cos(Rs),po=[jo,-qr,qr,jo];Xo._matMult(po),ds._matMult(po),Hs._matMult(po),Bs._matMult(po)}const Os=Di.stretch+Di.fixed,ma=Qi.stretch+Qi.fixed;return{tl:Xo,tr:ds,bl:Hs,br:Bs,tex:{x:z.paddedRect.x+1+Os,y:z.paddedRect.y+1+ma,w:Hi.stretch+Hi.fixed-Os,h:Ai.stretch+Ai.fixed-ma},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ma,pixelOffsetBR:ls,minFontScaleX:nn/B/ne,minFontScaleY:Xi/B/de,isSDF:h}};if(v&&(z.stretchX||z.stretchY)){const Di=vg(_e,st,Ie),Qi=vg(be,Pt,dt);for(let Hi=0;Hi<Di.length-1;Hi++){const Ai=Di[Hi],bn=Di[Hi+1];for(let fn=0;fn<Qi.length-1;fn++)I.push(Ri(Ai,Qi[fn],bn,Qi[fn+1]))}}else I.push(Ri({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:U+1},{fixed:0,stretch:Z+1}));return I}function qf(c,s,h){let v=0;for(const I of c)v+=Math.max(s,Math.min(h,I[1]))-Math.max(s,Math.min(h,I[0]));return v}function vg(c,s,h){const v=[{fixed:-1,stretch:0}];for(const[I,z]of c){const B=v[v.length-1];v.push({fixed:I-B.stretch,stretch:B.stretch}),v.push({fixed:I-B.stretch,stretch:B.stretch+(z-I)})}return v.push({fixed:s+1,stretch:h}),v}function Zf(c,s,h,v){return c/s*h+v}function tf(c,s,h,v){return c-s*h/v}Zi("Anchor",Th);class Nl{constructor(s,h,v,I,z,B,U,Z,ne,de){if(this.boxStartIndex=s.length,ne){let _e=B.top,be=B.bottom;const Ce=B.collisionPadding;Ce&&(_e-=Ce[1],be+=Ce[3]);let Ie=be-_e;Ie>0&&(Ie=Math.max(10,Ie),this.circleDiameter=Ie)}else{let _e=B.top*U-Z[0],be=B.bottom*U+Z[2],Ce=B.left*U-Z[3],Ie=B.right*U+Z[1];const dt=B.collisionPadding;if(dt&&(Ce-=dt[0]*U,_e-=dt[1]*U,Ie+=dt[2]*U,be+=dt[3]*U),de){const st=new zt(Ce,_e),Pt=new zt(Ie,_e),Xt=new zt(Ce,be),Ct=new zt(Ie,be),jt=de*Math.PI/180;st._rotate(jt),Pt._rotate(jt),Xt._rotate(jt),Ct._rotate(jt),Ce=Math.min(st.x,Pt.x,Xt.x,Ct.x),Ie=Math.max(st.x,Pt.x,Xt.x,Ct.x),_e=Math.min(st.y,Pt.y,Xt.y,Ct.y),be=Math.max(st.y,Pt.y,Xt.y,Ct.y)}s.emplaceBack(h.x,h.y,Ce,_e,Ie,be,v,I,z)}this.boxEndIndex=s.length}}class qa{constructor(s=[],h=a0){if(this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:h,compare:v}=this,I=h[s];for(;s>0;){const z=s-1>>1,B=h[z];if(v(I,B)>=0)break;h[s]=B,s=z}h[s]=I}_down(s){const{data:h,compare:v}=this,I=this.length>>1,z=h[s];for(;s<I;){let B=1+(s<<1),U=h[B];const Z=B+1;if(Z<this.length&&v(h[Z],U)<0&&(B=Z,U=h[Z]),v(U,z)>=0)break;h[s]=U,s=B}h[s]=z}}function a0(c,s){return c<s?-1:c>s?1:0}function xg(c,s=1,h=!1){let v=1/0,I=1/0,z=-1/0,B=-1/0;const U=c[0];for(let Ce=0;Ce<U.length;Ce++){const Ie=U[Ce];(!Ce||Ie.x<v)&&(v=Ie.x),(!Ce||Ie.y<I)&&(I=Ie.y),(!Ce||Ie.x>z)&&(z=Ie.x),(!Ce||Ie.y>B)&&(B=Ie.y)}const Z=Math.min(z-v,B-I);let ne=Z/2;const de=new qa([],l0);if(Z===0)return new zt(v,I);for(let Ce=v;Ce<z;Ce+=Z)for(let Ie=I;Ie<B;Ie+=Z)de.push(new nf(Ce+ne,Ie+ne,ne,c));let _e=function(Ce){let Ie=0,dt=0,st=0;const Pt=Ce[0];for(let Xt=0,Ct=Pt.length,jt=Ct-1;Xt<Ct;jt=Xt++){const hi=Pt[Xt],li=Pt[jt],nn=hi.x*li.y-li.x*hi.y;dt+=(hi.x+li.x)*nn,st+=(hi.y+li.y)*nn,Ie+=3*nn}return new nf(dt/Ie,st/Ie,0,Ce)}(c),be=de.length;for(;de.length;){const Ce=de.pop();(Ce.d>_e.d||!_e.d)&&(_e=Ce,h&&console.log("found best %d after %d probes",Math.round(1e4*Ce.d)/1e4,be)),Ce.max-_e.d<=s||(ne=Ce.h/2,de.push(new nf(Ce.p.x-ne,Ce.p.y-ne,ne,c)),de.push(new nf(Ce.p.x+ne,Ce.p.y-ne,ne,c)),de.push(new nf(Ce.p.x-ne,Ce.p.y+ne,ne,c)),de.push(new nf(Ce.p.x+ne,Ce.p.y+ne,ne,c)),be+=4)}return h&&(console.log(`num probes: ${be}`),console.log(`best distance: ${_e.d}`)),_e.p}function l0(c,s){return s.max-c.max}function nf(c,s,h,v){this.p=new zt(c,s),this.h=h,this.d=function(I,z){let B=!1,U=1/0;for(let Z=0;Z<z.length;Z++){const ne=z[Z];for(let de=0,_e=ne.length,be=_e-1;de<_e;be=de++){const Ce=ne[de],Ie=ne[be];Ce.y>I.y!=Ie.y>I.y&&I.x<(Ie.x-Ce.x)*(I.y-Ce.y)/(Ie.y-Ce.y)+Ce.x&&(B=!B),U=Math.min(U,gn(I,Ce,Ie))}}return(B?1:-1)*Math.sqrt(U)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}const bg=Number.POSITIVE_INFINITY;function rf(c,s){return s[1]!==bg?function(h,v,I){let z=0,B=0;switch(v=Math.abs(v),I=Math.abs(I),h){case"top-right":case"top-left":case"top":B=I-7;break;case"bottom-right":case"bottom-left":case"bottom":B=7-I}switch(h){case"top-right":case"bottom-right":case"right":z=-v;break;case"top-left":case"bottom-left":case"left":z=v}return[z,B]}(c,s[0],s[1]):function(h,v){let I=0,z=0;v<0&&(v=0);const B=v/Math.sqrt(2);switch(h){case"top-right":case"top-left":z=B-7;break;case"bottom-right":case"bottom-left":z=7-B;break;case"bottom":z=7-v;break;case"top":z=v-7}switch(h){case"top-right":case"bottom-right":I=-B;break;case"top-left":case"bottom-left":I=B;break;case"left":I=v;break;case"right":I=-v}return[I,z]}(c,s[0])}function of(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ny(c,s,h,v,I,z,B,U,Z,ne,de){let _e=z.textMaxSize.evaluate(s,{});_e===void 0&&(_e=B);const be=c.layers[0].layout,Ce=be.get("icon-offset").evaluate(s,{},de),Ie=ry(h.horizontal),dt=B/24,st=c.tilePixelRatio*dt,Pt=c.tilePixelRatio*_e/24,Xt=c.tilePixelRatio*U,Ct=c.tilePixelRatio*be.get("symbol-spacing"),jt=be.get("text-padding")*c.tilePixelRatio,hi=function(Ai,bn,fn,tr=1){const fo=Ai.get("icon-padding").evaluate(bn,{},fn),bo=fo&&fo.values;return[bo[0]*tr,bo[1]*tr,bo[2]*tr,bo[3]*tr]}(be,s,de,c.tilePixelRatio),li=be.get("text-max-angle")/180*Math.PI,nn=be.get("text-rotation-alignment")!=="viewport"&&be.get("symbol-placement")!=="point",Wi=be.get("icon-rotation-alignment")==="map"&&be.get("symbol-placement")!=="point",Xi=be.get("symbol-placement"),Ri=Ct/2,Di=be.get("icon-text-fit");let Qi;v&&Di!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(Qi=gg(v,h.vertical,Di,be.get("icon-text-fit-padding"),Ce,dt)),Ie&&(v=gg(v,Ie,Di,be.get("icon-text-fit-padding"),Ce,dt)));const Hi=(Ai,bn)=>{bn.x<0||bn.x>=wt||bn.y<0||bn.y>=wt||function(fn,tr,fo,bo,$o,vl,Cs,Xo,ds,Bs,Hs,Ma,ls,Rs,Os,ma,qr,jo,po,Ho,Kn,Wa,Fs,fs,Ul){const gc=fn.addToLineVertexArray(tr,fo);let ka,iu,xl,or,Ks=0,nu=0,hf=0,ru=0,Eh=-1,rm=-1;const Ku={};let fy=S.exports(""),Ag=0,Mg=0;if(Xo._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ag,Mg]=Xo.layout.get("text-offset").evaluate(Kn,{},fs).map(Ys=>Ys*Ss):(Ag=Xo.layout.get("text-radial-offset").evaluate(Kn,{},fs)*Ss,Mg=bg),fn.allowVerticalPlacement&&bo.vertical){const Ys=Xo.layout.get("text-rotate").evaluate(Kn,{},fs)+90;xl=new Nl(ds,tr,Bs,Hs,Ma,bo.vertical,ls,Rs,Os,Ys),Cs&&(or=new Nl(ds,tr,Bs,Hs,Ma,Cs,qr,jo,Os,Ys))}if($o){const Ys=Xo.layout.get("icon-rotate").evaluate(Kn,{}),yc=Xo.layout.get("icon-text-fit")!=="none",Js=iy($o,Ys,Fs,yc),Yu=Cs?iy(Cs,Ys,Fs,yc):void 0;iu=new Nl(ds,tr,Bs,Hs,Ma,$o,qr,jo,!1,Ys),Ks=4*Js.length;const gd=fn.iconSizeData;let Ju=null;gd.kind==="source"?(Ju=[tu*Xo.layout.get("icon-size").evaluate(Kn,{})],Ju[0]>Za&&Me(`${fn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):gd.kind==="composite"&&(Ju=[tu*Wa.compositeIconSizes[0].evaluate(Kn,{},fs),tu*Wa.compositeIconSizes[1].evaluate(Kn,{},fs)],(Ju[0]>Za||Ju[1]>Za)&&Me(`${fn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),fn.addSymbols(fn.icon,Js,Ju,Ho,po,Kn,i.WritingMode.none,tr,gc.lineStartIndex,gc.lineLength,-1,fs),Eh=fn.icon.placedSymbolArray.length-1,Yu&&(nu=4*Yu.length,fn.addSymbols(fn.icon,Yu,Ju,Ho,po,Kn,i.WritingMode.vertical,tr,gc.lineStartIndex,gc.lineLength,-1,fs),rm=fn.icon.placedSymbolArray.length-1)}const py=Object.keys(bo.horizontal);for(const Ys of py){const yc=bo.horizontal[Ys];if(!ka){fy=S.exports(yc.text);const Yu=Xo.layout.get("text-rotate").evaluate(Kn,{},fs);ka=new Nl(ds,tr,Bs,Hs,Ma,yc,ls,Rs,Os,Yu)}const Js=yc.positionedLines.length===1;if(hf+=sf(fn,tr,yc,vl,Xo,Os,Kn,ma,gc,bo.vertical?i.WritingMode.horizontal:i.WritingMode.horizontalOnly,Js?py:[Ys],Ku,Eh,Wa,fs),Js)break}bo.vertical&&(ru+=sf(fn,tr,bo.vertical,vl,Xo,Os,Kn,ma,gc,i.WritingMode.vertical,["vertical"],Ku,rm,Wa,fs));const g0=ka?ka.boxStartIndex:fn.collisionBoxArray.length,_0=ka?ka.boxEndIndex:fn.collisionBoxArray.length,y0=xl?xl.boxStartIndex:fn.collisionBoxArray.length,v0=xl?xl.boxEndIndex:fn.collisionBoxArray.length,om=iu?iu.boxStartIndex:fn.collisionBoxArray.length,df=iu?iu.boxEndIndex:fn.collisionBoxArray.length,my=or?or.boxStartIndex:fn.collisionBoxArray.length,x0=or?or.boxEndIndex:fn.collisionBoxArray.length;let _c=-1;const sm=(Ys,yc)=>Ys&&Ys.circleDiameter?Math.max(Ys.circleDiameter,yc):yc;_c=sm(ka,_c),_c=sm(xl,_c),_c=sm(iu,_c),_c=sm(or,_c);const am=_c>-1?1:0;am&&(_c*=Ul/Ss),fn.glyphOffsetArray.length>=mc.MAX_GLYPHS&&Me("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Kn.sortKey!==void 0&&fn.addToSortKeyRanges(fn.symbolInstances.length,Kn.sortKey),fn.symbolInstances.emplaceBack(tr.x,tr.y,Ku.right>=0?Ku.right:-1,Ku.center>=0?Ku.center:-1,Ku.left>=0?Ku.left:-1,Ku.vertical||-1,Eh,rm,fy,g0,_0,y0,v0,om,df,my,x0,Bs,hf,ru,Ks,nu,am,0,ls,Ag,Mg,_c)}(c,bn,Ai,h,v,I,Qi,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,st,[jt,jt,jt,jt],nn,Z,Xt,hi,Wi,Ce,s,z,ne,de,B)};if(Xi==="line")for(const Ai of ty(s.geometry,0,0,wt,wt)){const bn=s0(Ai,Ct,li,h.vertical||Ie,v,24,Pt,c.overscaling,wt);for(const fn of bn){const tr=Ie;tr&&c0(c,tr.text,Ri,fn)||Hi(Ai,fn)}}else if(Xi==="line-center"){for(const Ai of s.geometry)if(Ai.length>1){const bn=ey(Ai,li,h.vertical||Ie,v,24,Pt);bn&&Hi(Ai,bn)}}else if(s.type==="Polygon")for(const Ai of Jc(s.geometry,0)){const bn=xg(Ai,16);Hi(Ai[0],new Th(bn.x,bn.y,0))}else if(s.type==="LineString")for(const Ai of s.geometry)Hi(Ai,new Th(Ai[0].x,Ai[0].y,0));else if(s.type==="Point")for(const Ai of s.geometry)for(const bn of Ai)Hi([bn],new Th(bn.x,bn.y,0))}const Za=32640;function sf(c,s,h,v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie){const dt=function(Xt,Ct,jt,hi,li,nn,Wi,Xi){const Ri=hi.layout.get("text-rotate").evaluate(nn,{})*Math.PI/180,Di=[];for(const Qi of Ct.positionedLines)for(const Hi of Qi.positionedGlyphs){if(!Hi.rect)continue;const Ai=Hi.rect||{};let bn=4,fn=!0,tr=1,fo=0;const bo=(li||Xi)&&Hi.vertical,$o=Hi.metrics.advance*Hi.scale/2;if(Xi&&Ct.verticalizable){const po=(Hi.scale-1)*Ss,Ho=(Ss-Hi.metrics.width*Hi.scale)/2;fo=Qi.lineOffset/2-(Hi.imageName?-Ho:po)}if(Hi.imageName){const po=Wi[Hi.imageName];fn=po.sdf,tr=po.pixelRatio,bn=1/tr}const vl=li?[Hi.x+$o,Hi.y]:[0,0];let Cs=li?[0,0]:[Hi.x+$o+jt[0],Hi.y+jt[1]-fo],Xo=[0,0];bo&&(Xo=Cs,Cs=[0,0]);const ds=(Hi.metrics.left-bn)*Hi.scale-$o+Cs[0],Bs=(-Hi.metrics.top-bn)*Hi.scale+Cs[1],Hs=ds+Ai.w*Hi.scale/tr,Ma=Bs+Ai.h*Hi.scale/tr,ls=new zt(ds,Bs),Rs=new zt(Hs,Bs),Os=new zt(ds,Ma),ma=new zt(Hs,Ma);if(bo){const po=new zt(-$o,$o-pa),Ho=-Math.PI/2,Kn=12-$o,Wa=new zt(22-Kn,-(Hi.imageName?Kn:0)),Fs=new zt(...Xo);ls._rotateAround(Ho,po)._add(Wa)._add(Fs),Rs._rotateAround(Ho,po)._add(Wa)._add(Fs),Os._rotateAround(Ho,po)._add(Wa)._add(Fs),ma._rotateAround(Ho,po)._add(Wa)._add(Fs)}if(Ri){const po=Math.sin(Ri),Ho=Math.cos(Ri),Kn=[Ho,-po,po,Ho];ls._matMult(Kn),Rs._matMult(Kn),Os._matMult(Kn),ma._matMult(Kn)}const qr=new zt(0,0),jo=new zt(0,0);Di.push({tl:ls,tr:Rs,bl:Os,br:ma,tex:Ai,writingMode:Ct.writingMode,glyphOffset:vl,sectionIndex:Hi.sectionIndex,isSDF:fn,pixelOffsetTL:qr,pixelOffsetBR:jo,minFontScaleX:0,minFontScaleY:0})}return Di}(0,h,U,I,z,B,v,c.allowVerticalPlacement),st=c.textSizeData;let Pt=null;st.kind==="source"?(Pt=[tu*I.layout.get("text-size").evaluate(B,{})],Pt[0]>Za&&Me(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):st.kind==="composite"&&(Pt=[tu*Ce.compositeTextSizes[0].evaluate(B,{},Ie),tu*Ce.compositeTextSizes[1].evaluate(B,{},Ie)],(Pt[0]>Za||Pt[1]>Za)&&Me(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,dt,Pt,U,z,B,ne,s,Z.lineStartIndex,Z.lineLength,be,Ie);for(const Xt of de)_e[Xt]=c.text.placedSymbolArray.length-1;return 4*dt.length}function ry(c){for(const s in c)return c[s];return null}function c0(c,s,h,v){const I=c.compareText;if(s in I){const z=I[s];for(let B=z.length-1;B>=0;B--)if(v.dist(z[B])<h)return!0}else I[s]=[];return I[s].push(v),!1}const u0=xh.VectorTileFeature.types,h0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jp(c,s,h,v,I,z,B,U,Z,ne,de,_e,be){const Ce=U?Math.min(Za,Math.round(U[0])):0,Ie=U?Math.min(Za,Math.round(U[1])):0;c.emplaceBack(s,h,Math.round(32*v),Math.round(32*I),z,B,(Ce<<1)+(Z?1:0),Ie,16*ne,16*de,256*_e,256*be)}function wg(c,s,h){c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h)}function d0(c){for(const s of c.sections)if(Yh(s.text))return!0;return!1}class Wf{constructor(s){this.layoutVertexArray=new ba,this.indexArray=new ws,this.programConfigurations=s,this.segments=new o,this.dynamicLayoutVertexArray=new da,this.opacityVertexArray=new wa,this.placedSymbolArray=new _i}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,h,v,I){this.isEmpty()||(v&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,sg.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,r0.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,h0,!0),this.opacityVertexBuffer.itemSize=1),(v||I)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zi("SymbolBuffers",Wf);class Tg{constructor(s,h,v){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new v,this.segments=new o,this.collisionVertexArray=new Zs}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,ag.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zi("CollisionBuffers",Tg);class mc{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(B=>B.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_r([]),this.placementViewportMatrix=_r([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_g(this.zoom,h["text-size"]),this.iconSizeData=_g(this.zoom,h["icon-size"]);const v=this.layers[0].layout,I=v.get("symbol-sort-key"),z=v.get("symbol-z-order");this.canOverlap=af(v,"text-overlap","text-allow-overlap")!=="never"||af(v,"icon-overlap","icon-allow-overlap")!=="never"||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=z!=="viewport-y"&&!I.isConstant(),this.sortFeaturesByY=(z==="viewport-y"||z==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,v.get("symbol-placement")==="point"&&(this.writingModes=v.get("text-writing-mode").map(B=>i.WritingMode[B])),this.stateDependentLayerIds=this.layers.filter(B=>B.isStateDependent()).map(B=>B.id),this.sourceID=s.sourceID}createArrays(){this.text=new Wf(new Dt(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Wf(new Dt(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new Vi,this.lineVertexArray=new en,this.symbolInstances=new Ji}calculateGlyphDependencies(s,h,v,I,z){for(let B=0;B<s.length;B++)if(h[s.charCodeAt(B)]=!0,(v||I)&&z){const U=Xd[s.charAt(B)];U&&(h[U.charCodeAt(0)]=!0)}}populate(s,h,v){const I=this.layers[0],z=I.layout,B=z.get("text-font"),U=z.get("text-field"),Z=z.get("icon-image"),ne=(U.value.kind!=="constant"||U.value.value instanceof De&&!U.value.value.isEmpty()||U.value.value.toString().length>0)&&(B.value.kind!=="constant"||B.value.value.length>0),de=Z.value.kind!=="constant"||!!Z.value.value||Object.keys(Z.parameters).length>0,_e=z.get("symbol-sort-key");if(this.features=[],!ne&&!de)return;const be=h.iconDependencies,Ce=h.glyphDependencies,Ie=h.availableImages,dt=new Rr(this.zoom);for(const{feature:st,id:Pt,index:Xt,sourceLayerIndex:Ct}of s){const jt=I._featureFilter.needGeometry,hi=Gt(st,jt);if(!I._featureFilter.filter(dt,hi,v))continue;let li,nn;if(jt||(hi.geometry=pi(st)),ne){const Xi=I.getValueAndResolveTokens("text-field",hi,v,Ie),Ri=De.factory(Xi);d0(Ri)&&(this.hasRTLText=!0),(!this.hasRTLText||dl()==="unavailable"||this.hasRTLText&&vo.isParsed())&&(li=ad(Ri,I,hi))}if(de){const Xi=I.getValueAndResolveTokens("icon-image",hi,v,Ie);nn=Xi instanceof it?Xi:it.fromString(Xi)}if(!li&&!nn)continue;const Wi=this.sortFeaturesByKey?_e.evaluate(hi,{},v):void 0;if(this.features.push({id:Pt,text:li,icon:nn,index:Xt,sourceLayerIndex:Ct,geometry:hi.geometry,properties:st.properties,type:u0[st.type],sortKey:Wi}),nn&&(be[nn.name]=!0),li){const Xi=B.evaluate(hi,{},v).join(","),Ri=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(i.WritingMode.vertical)>=0;for(const Di of li.sections)if(Di.image)be[Di.image.name]=!0;else{const Qi=qc(li.toString()),Hi=Di.fontStack||Xi,Ai=Ce[Hi]=Ce[Hi]||{};this.calculateGlyphDependencies(Di.text,Ai,Ri,this.allowVerticalPlacement,Qi)}}}z.get("symbol-placement")==="line"&&(this.features=function(st){const Pt={},Xt={},Ct=[];let jt=0;function hi(Xi){Ct.push(st[Xi]),jt++}function li(Xi,Ri,Di){const Qi=Xt[Xi];return delete Xt[Xi],Xt[Ri]=Qi,Ct[Qi].geometry[0].pop(),Ct[Qi].geometry[0]=Ct[Qi].geometry[0].concat(Di[0]),Qi}function nn(Xi,Ri,Di){const Qi=Pt[Ri];return delete Pt[Ri],Pt[Xi]=Qi,Ct[Qi].geometry[0].shift(),Ct[Qi].geometry[0]=Di[0].concat(Ct[Qi].geometry[0]),Qi}function Wi(Xi,Ri,Di){const Qi=Di?Ri[0][Ri[0].length-1]:Ri[0][0];return`${Xi}:${Qi.x}:${Qi.y}`}for(let Xi=0;Xi<st.length;Xi++){const Ri=st[Xi],Di=Ri.geometry,Qi=Ri.text?Ri.text.toString():null;if(!Qi){hi(Xi);continue}const Hi=Wi(Qi,Di),Ai=Wi(Qi,Di,!0);if(Hi in Xt&&Ai in Pt&&Xt[Hi]!==Pt[Ai]){const bn=nn(Hi,Ai,Di),fn=li(Hi,Ai,Ct[bn].geometry);delete Pt[Hi],delete Xt[Ai],Xt[Wi(Qi,Ct[fn].geometry,!0)]=fn,Ct[bn].geometry=null}else Hi in Xt?li(Hi,Ai,Di):Ai in Pt?nn(Hi,Ai,Di):(hi(Xi),Pt[Hi]=jt-1,Xt[Ai]=jt-1)}return Ct.filter(Xi=>Xi.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((st,Pt)=>st.sortKey-Pt.sortKey)}update(s,h,v){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,v),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,v))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,h){const v=this.lineVertexArray.length;if(s.segment!==void 0){let I=s.dist(h[s.segment+1]),z=s.dist(h[s.segment]);const B={};for(let U=s.segment+1;U<h.length;U++)B[U]={x:h[U].x,y:h[U].y,tileUnitDistanceFromAnchor:I},U<h.length-1&&(I+=h[U+1].dist(h[U]));for(let U=s.segment||0;U>=0;U--)B[U]={x:h[U].x,y:h[U].y,tileUnitDistanceFromAnchor:z},U>0&&(z+=h[U-1].dist(h[U]));for(let U=0;U<h.length;U++){const Z=B[U];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(s,h,v,I,z,B,U,Z,ne,de,_e,be){const Ce=s.indexArray,Ie=s.layoutVertexArray,dt=s.segments.prepareSegment(4*h.length,Ie,Ce,this.canOverlap?B.sortKey:void 0),st=this.glyphOffsetArray.length,Pt=dt.vertexLength,Xt=this.allowVerticalPlacement&&U===i.WritingMode.vertical?Math.PI/2:0,Ct=B.text&&B.text.sections;for(let jt=0;jt<h.length;jt++){const{tl:hi,tr:li,bl:nn,br:Wi,tex:Xi,pixelOffsetTL:Ri,pixelOffsetBR:Di,minFontScaleX:Qi,minFontScaleY:Hi,glyphOffset:Ai,isSDF:bn,sectionIndex:fn}=h[jt],tr=dt.vertexLength,fo=Ai[1];Jp(Ie,Z.x,Z.y,hi.x,fo+hi.y,Xi.x,Xi.y,v,bn,Ri.x,Ri.y,Qi,Hi),Jp(Ie,Z.x,Z.y,li.x,fo+li.y,Xi.x+Xi.w,Xi.y,v,bn,Di.x,Ri.y,Qi,Hi),Jp(Ie,Z.x,Z.y,nn.x,fo+nn.y,Xi.x,Xi.y+Xi.h,v,bn,Ri.x,Di.y,Qi,Hi),Jp(Ie,Z.x,Z.y,Wi.x,fo+Wi.y,Xi.x+Xi.w,Xi.y+Xi.h,v,bn,Di.x,Di.y,Qi,Hi),wg(s.dynamicLayoutVertexArray,Z,Xt),Ce.emplaceBack(tr,tr+1,tr+2),Ce.emplaceBack(tr+1,tr+2,tr+3),dt.vertexLength+=4,dt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ai[0]),jt!==h.length-1&&fn===h[jt+1].sectionIndex||s.programConfigurations.populatePaintArrays(Ie.length,B,B.index,{},be,Ct&&Ct[fn])}s.placedSymbolArray.emplaceBack(Z.x,Z.y,st,this.glyphOffsetArray.length-st,Pt,ne,de,Z.segment,v?v[0]:0,v?v[1]:0,I[0],I[1],U,0,!1,0,_e)}_addCollisionDebugVertex(s,h,v,I,z,B){return h.emplaceBack(0,0),s.emplaceBack(v.x,v.y,I,z,Math.round(B.x),Math.round(B.y))}addCollisionDebugVertices(s,h,v,I,z,B,U){const Z=z.segments.prepareSegment(4,z.layoutVertexArray,z.indexArray),ne=Z.vertexLength,de=z.layoutVertexArray,_e=z.collisionVertexArray,be=U.anchorX,Ce=U.anchorY;this._addCollisionDebugVertex(de,_e,B,be,Ce,new zt(s,h)),this._addCollisionDebugVertex(de,_e,B,be,Ce,new zt(v,h)),this._addCollisionDebugVertex(de,_e,B,be,Ce,new zt(v,I)),this._addCollisionDebugVertex(de,_e,B,be,Ce,new zt(s,I)),Z.vertexLength+=4;const Ie=z.indexArray;Ie.emplaceBack(ne,ne+1),Ie.emplaceBack(ne+1,ne+2),Ie.emplaceBack(ne+2,ne+3),Ie.emplaceBack(ne+3,ne),Z.primitiveLength+=4}addDebugCollisionBoxes(s,h,v,I){for(let z=s;z<h;z++){const B=this.collisionBoxArray.get(z);this.addCollisionDebugVertices(B.x1,B.y1,B.x2,B.y2,I?this.textCollisionBox:this.iconCollisionBox,B.anchorPoint,v)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tg(Ua,lg.members,Ta),this.iconCollisionBox=new Tg(Ua,lg.members,Ta);for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(s,h,v,I,z,B,U,Z,ne){const de={};for(let _e=h;_e<v;_e++){const be=s.get(_e);de.textBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},de.textFeatureIndex=be.featureIndex;break}for(let _e=I;_e<z;_e++){const be=s.get(_e);de.verticalTextBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},de.verticalTextFeatureIndex=be.featureIndex;break}for(let _e=B;_e<U;_e++){const be=s.get(_e);de.iconBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},de.iconFeatureIndex=be.featureIndex;break}for(let _e=Z;_e<ne;_e++){const be=s.get(_e);de.verticalIconBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},de.verticalIconFeatureIndex=be.featureIndex;break}return de}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const v=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,h){const v=s.placedSymbolArray.get(h),I=v.vertexStartIndex+4*v.numGlyphs;for(let z=v.vertexStartIndex;z<I;z+=4)s.indexArray.emplaceBack(z,z+1,z+2),s.indexArray.emplaceBack(z+1,z+2,z+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(s),v=Math.cos(s),I=[],z=[],B=[];for(let U=0;U<this.symbolInstances.length;++U){B.push(U);const Z=this.symbolInstances.get(U);I.push(0|Math.round(h*Z.anchorX+v*Z.anchorY)),z.push(Z.featureIndex)}return B.sort((U,Z)=>I[U]-I[Z]||z[Z]-z[U]),B}addToSortKeyRanges(s,h){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===h?v.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const v=this.symbolInstances.get(h);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach((I,z,B)=>{I>=0&&B.indexOf(I)===z&&this.addIndicesForPlacedSymbol(this.text,I)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zi("SymbolBucket",mc,{omit:["layers","collisionBoxArray","features","compareText"]}),mc.MAX_GLYPHS=65535,mc.addDynamicAttributes=wg;const f0=new Ao({"symbol-placement":new an(Ot.layout_symbol["symbol-placement"]),"symbol-spacing":new an(Ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new an(Ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new an(Ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new an(Ot.layout_symbol["icon-allow-overlap"]),"icon-overlap":new an(Ot.layout_symbol["icon-overlap"]),"icon-ignore-placement":new an(Ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new an(Ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new an(Ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Ot.layout_symbol["icon-size"]),"icon-text-fit":new an(Ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an(Ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Ot.layout_symbol["icon-image"]),"icon-rotate":new yn(Ot.layout_symbol["icon-rotate"]),"icon-padding":new yn(Ot.layout_symbol["icon-padding"]),"icon-keep-upright":new an(Ot.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Ot.layout_symbol["icon-offset"]),"icon-anchor":new yn(Ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new an(Ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new an(Ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new an(Ot.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Ot.layout_symbol["text-field"]),"text-font":new yn(Ot.layout_symbol["text-font"]),"text-size":new yn(Ot.layout_symbol["text-size"]),"text-max-width":new yn(Ot.layout_symbol["text-max-width"]),"text-line-height":new an(Ot.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Ot.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Ot.layout_symbol["text-justify"]),"text-radial-offset":new yn(Ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new an(Ot.layout_symbol["text-variable-anchor"]),"text-anchor":new yn(Ot.layout_symbol["text-anchor"]),"text-max-angle":new an(Ot.layout_symbol["text-max-angle"]),"text-writing-mode":new an(Ot.layout_symbol["text-writing-mode"]),"text-rotate":new yn(Ot.layout_symbol["text-rotate"]),"text-padding":new an(Ot.layout_symbol["text-padding"]),"text-keep-upright":new an(Ot.layout_symbol["text-keep-upright"]),"text-transform":new yn(Ot.layout_symbol["text-transform"]),"text-offset":new yn(Ot.layout_symbol["text-offset"]),"text-allow-overlap":new an(Ot.layout_symbol["text-allow-overlap"]),"text-overlap":new an(Ot.layout_symbol["text-overlap"]),"text-ignore-placement":new an(Ot.layout_symbol["text-ignore-placement"]),"text-optional":new an(Ot.layout_symbol["text-optional"])});var Bo={paint:new Ao({"icon-opacity":new yn(Ot.paint_symbol["icon-opacity"]),"icon-color":new yn(Ot.paint_symbol["icon-color"]),"icon-halo-color":new yn(Ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Ot.paint_symbol["icon-halo-blur"]),"icon-translate":new an(Ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new an(Ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(Ot.paint_symbol["text-opacity"]),"text-color":new yn(Ot.paint_symbol["text-color"],{runtimeType:Co,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new yn(Ot.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Ot.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Ot.paint_symbol["text-halo-blur"]),"text-translate":new an(Ot.paint_symbol["text-translate"]),"text-translate-anchor":new an(Ot.paint_symbol["text-translate-anchor"])}),layout:f0};class Xf{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:So,this.defaultValue=s}evaluate(s){if(s.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zi("FormatSectionOverride",Xf,{omit:["defaultValue"]});class Hf extends qs{constructor(s){super(s,Bo)}recalculate(s,h){if(super.recalculate(s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const v=this.layout.get("text-writing-mode");if(v){const I=[];for(const z of v)I.indexOf(z)<0&&I.push(z);this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,h,v,I){const z=this.layout.get(s).evaluate(h,{},v,I),B=this._unevaluatedLayout._values[s];return B.isDataDriven()||zc(B.value)||!z?z:function(U,Z){return Z.replace(/{([^{}]+)}/g,(ne,de)=>de in U?String(U[de]):"")}(h.properties,z)}createBucket(s){return new mc(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Bo.paint.overridableProperties){if(!Hf.hasPaintOverride(this.layout,s))continue;const h=this.paint.get(s),v=new Xf(h),I=new rc(v,h.property.specification);let z=null;z=h.value.kind==="constant"||h.value.kind==="source"?new Iu("source",I):new Lc("composite",I,h.value.zoomStops),this.paint._values[s]=new gs(h.property,z,h.parameters)}}_handleOverridablePaintPropertyUpdate(s,h,v){return!(!this.layout||h.isDataDriven()||v.isDataDriven())&&Hf.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,h){const v=s.get("text-field"),I=Bo.paint.properties[h];let z=!1;const B=U=>{for(const Z of U)if(I.overrides&&I.overrides.hasOverride(Z))return void(z=!0)};if(v.value.kind==="constant"&&v.value.value instanceof De)B(v.value.value.sections);else if(v.value.kind==="source"){const U=ne=>{z||(ne instanceof ri&&It(ne.value)===yo?B(ne.value.sections):ne instanceof Mc?B(ne.sections):ne.eachChild(U))},Z=v.value;Z._styleExpression&&U(Z._styleExpression.expression)}return z}}function af(c,s,h){let v="never";const I=c.get(s);return I?v=I:c.get(h)&&(v="always"),v}var Qp={paint:new Ao({"background-color":new an(Ot.paint_background["background-color"]),"background-pattern":new Qh(Ot.paint_background["background-pattern"]),"background-opacity":new an(Ot.paint_background["background-opacity"])})},Kf={paint:new Ao({"raster-opacity":new an(Ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new an(Ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new an(Ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new an(Ot.paint_raster["raster-brightness-max"]),"raster-saturation":new an(Ot.paint_raster["raster-saturation"]),"raster-contrast":new an(Ot.paint_raster["raster-contrast"]),"raster-resampling":new an(Ot.paint_raster["raster-resampling"]),"raster-fade-duration":new an(Ot.paint_raster["raster-fade-duration"])})};class oy extends qs{constructor(s){super(s,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const sy={circle:class extends qs{constructor(c){super(c,Ws)}createBucket(c){return new Ti(c)}queryRadius(c){const s=c;return Ar("circle-radius",this,s)+Ar("circle-stroke-width",this,s)+Mr(this.paint.get("circle-translate"))}queryIntersectsFeature(c,s,h,v,I,z,B,U){const Z=Ts(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),z.angle,B),ne=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),de=this.paint.get("circle-pitch-alignment")==="map",_e=de?Z:function(Ce,Ie){return Ce.map(dt=>Sa(dt,Ie))}(Z,U),be=de?ne*B:ne;for(const Ce of v)for(const Ie of Ce){const dt=de?Ie:Sa(Ie,U);let st=be;const Pt=$a([],[Ie.x,Ie.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?st*=Pt[3]/z.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(st*=z.cameraToCenterDistance/Pt[3]),Zt(_e,dt,st))return!0}return!1}},heatmap:class extends qs{constructor(c){super(c,Ol),this._updateColorRamp()}createBucket(c){return new ml(c)}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ym({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends qs{constructor(c){super(c,Jm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends qs{constructor(c){super(c,N_)}recalculate(c,s){super.recalculate(c,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new ig(c)}queryRadius(){return Mr(this.paint.get("fill-translate"))}queryIntersectsFeature(c,s,h,v,I,z,B){return sn(Ts(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),z.angle,B),v)}isTileClipped(){return!0}},"fill-extrusion":class extends qs{constructor(c){super(c,$_)}createBucket(c){return new Gp(c)}queryRadius(){return Mr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,s,h,v,I,z,B,U){const Z=Ts(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),z.angle,B),ne=this.paint.get("fill-extrusion-height").evaluate(s,h),de=this.paint.get("fill-extrusion-base").evaluate(s,h),_e=function(Ce,Ie,dt,st){const Pt=[];for(const Xt of Ce){const Ct=[Xt.x,Xt.y,0,1];$a(Ct,Ct,Ie),Pt.push(new zt(Ct[0]/Ct[3],Ct[1]/Ct[3]))}return Pt}(Z,U),be=function(Ce,Ie,dt,st){const Pt=[],Xt=[],Ct=st[8]*Ie,jt=st[9]*Ie,hi=st[10]*Ie,li=st[11]*Ie,nn=st[8]*dt,Wi=st[9]*dt,Xi=st[10]*dt,Ri=st[11]*dt;for(const Di of Ce){const Qi=[],Hi=[];for(const Ai of Di){const bn=Ai.x,fn=Ai.y,tr=st[0]*bn+st[4]*fn+st[12],fo=st[1]*bn+st[5]*fn+st[13],bo=st[2]*bn+st[6]*fn+st[14],$o=st[3]*bn+st[7]*fn+st[15],vl=bo+hi,Cs=$o+li,Xo=tr+nn,ds=fo+Wi,Bs=bo+Xi,Hs=$o+Ri,Ma=new zt((tr+Ct)/Cs,(fo+jt)/Cs);Ma.z=vl/Cs,Qi.push(Ma);const ls=new zt(Xo/Hs,ds/Hs);ls.z=Bs/Hs,Hi.push(ls)}Pt.push(Qi),Xt.push(Hi)}return[Pt,Xt]}(v,de,ne,U);return function(Ce,Ie,dt){let st=1/0;sn(dt,Ie)&&(st=j_(dt,Ie[0]));for(let Pt=0;Pt<Ie.length;Pt++){const Xt=Ie[Pt],Ct=Ce[Pt];for(let jt=0;jt<Xt.length-1;jt++){const hi=Xt[jt],li=[hi,Xt[jt+1],Ct[jt+1],Ct[jt],hi];St(dt,li)&&(st=Math.min(st,j_(dt,li)))}}return st!==1/0&&st}(be[0],be[1],_e)}},line:class extends qs{constructor(c){super(c,Z_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ml,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,s){super.recalculate(c,s),this.paint._values["line-floorwidth"]=og.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Uf(c)}queryRadius(c){const s=c,h=W_(Ar("line-width",this,s),Ar("line-gap-width",this,s)),v=Ar("line-offset",this,s);return h/2+Math.abs(v)+Mr(this.paint.get("line-translate"))}queryIntersectsFeature(c,s,h,v,I,z,B){const U=Ts(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),z.angle,B),Z=B/2*W_(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),ne=this.paint.get("line-offset").evaluate(s,h);return ne&&(v=function(de,_e){const be=[];for(let Ce=0;Ce<de.length;Ce++){const Ie=de[Ce],dt=[];for(let st=0;st<Ie.length;st++){const Pt=Ie[st-1],Xt=Ie[st],Ct=Ie[st+1],jt=st===0?new zt(0,0):Xt.sub(Pt)._unit()._perp(),hi=st===Ie.length-1?new zt(0,0):Ct.sub(Xt)._unit()._perp(),li=jt._add(hi)._unit(),nn=li.x*hi.x+li.y*hi.y;nn!==0&&li._mult(1/nn),dt.push(li._mult(_e)._add(Xt))}be.push(dt)}return be}(v,ne*B)),function(de,_e,be){for(let Ce=0;Ce<_e.length;Ce++){const Ie=_e[Ce];if(de.length>=3){for(let dt=0;dt<Ie.length;dt++)if(br(de,Ie[dt]))return!0}if(vn(de,Ie,be))return!0}return!1}(U,v,Z)}isTileClipped(){return!0}},symbol:Hf,background:class extends qs{constructor(c){super(c,Qp)}},raster:class extends qs{constructor(c){super(c,Kf)}}};class Yf{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const em=63710088e-1;class Mo{constructor(s,h){if(isNaN(s)||isNaN(h))throw new Error(`Invalid LngLat object: (${s}, ${h})`);if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mo(re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const h=Math.PI/180,v=this.lat*h,I=s.lat*h,z=Math.sin(v)*Math.sin(I)+Math.cos(v)*Math.cos(I)*Math.cos((s.lng-this.lng)*h);return em*Math.acos(Math.min(z,1))}toBounds(s=0){const h=360*s/40075017,v=h/Math.cos(Math.PI/180*this.lat);return new pd(new Mo(this.lng-v,this.lat-h),new Mo(this.lng+v,this.lat+h))}static convert(s){if(s instanceof Mo)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Mo(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Mo(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class pd{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof Mo?new Mo(s.lng,s.lat):Mo.convert(s),this}setSouthWest(s){return this._sw=s instanceof Mo?new Mo(s.lng,s.lat):Mo.convert(s),this}extend(s){const h=this._sw,v=this._ne;let I,z;if(s instanceof Mo)I=s,z=s;else{if(!(s instanceof pd))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(pd.convert(s)):this.extend(Mo.convert(s)):this;if(I=s._sw,z=s._ne,!I||!z)return this}return h||v?(h.lng=Math.min(I.lng,h.lng),h.lat=Math.min(I.lat,h.lat),v.lng=Math.max(z.lng,v.lng),v.lat=Math.max(z.lat,v.lat)):(this._sw=new Mo(I.lng,I.lat),this._ne=new Mo(z.lng,z.lat)),this}getCenter(){return new Mo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Mo(this.getWest(),this.getNorth())}getSouthEast(){return new Mo(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:v}=Mo.convert(s);let I=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(I=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&I}static convert(s){return s instanceof pd?s:s&&new pd(s)}}const Eg=2*Math.PI*em;function lf(c){return Eg*Math.cos(c*Math.PI/180)}function ay(c){return(180+c)/360}function tm(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function ly(c,s){return c/lf(s)}function Jf(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class cf{constructor(s,h,v=0){this.x=+s,this.y=+h,this.z=+v}static fromLngLat(s,h=0){const v=Mo.convert(s);return new cf(ay(v.lng),tm(v.lat),ly(h,v.lat))}toLngLat(){return new Mo(360*this.x-180,Jf(this.y))}toAltitude(){return this.z*lf(Jf(this.y))}meterInMercatorCoordinateUnits(){return 1/Eg*(s=Jf(this.y),1/Math.cos(s*Math.PI/180));var s}}function Qf(c,s,h){var v=2*Math.PI*6378137/256/Math.pow(2,h);return[c*v-2*Math.PI*6378137/2,s*v-2*Math.PI*6378137/2]}class Sg{constructor(s,h,v){if(s<0||s>25||v<0||v>=Math.pow(2,s)||h<0||h>=Math.pow(2,s))throw new Error(`x=${h}, y=${v}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=h,this.y=v,this.key=ep(0,s,s,h,v)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,h,v){const I=(B=this.y,U=this.z,Z=Qf(256*(z=this.x),256*(B=Math.pow(2,U)-B-1),U),ne=Qf(256*(z+1),256*(B+1),U),Z[0]+","+Z[1]+","+ne[0]+","+ne[1]);var z,B,U,Z,ne;const de=function(_e,be,Ce){let Ie,dt="";for(let st=_e;st>0;st--)Ie=1<<st-1,dt+=(be&Ie?1:0)+(Ce&Ie?2:0);return dt}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(v==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,de).replace(/{bbox-epsg-3857}/g,I)}isChildOf(s){const h=this.z-s.z;return h>0&&s.x===this.x>>h&&s.y===this.y>>h}getTilePoint(s){const h=Math.pow(2,this.z);return new zt((s.x*h-this.x)*wt,(s.y*h-this.y)*wt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cy{constructor(s,h){this.wrap=s,this.canonical=h,this.key=ep(s,h.z,h.z,h.x,h.y)}}class yl{constructor(s,h,v,I,z){if(s<v)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${v}`);this.overscaledZ=s,this.wrap=h,this.canonical=new Sg(v,+I,+z),this.key=ep(h,s,v,I,z)}clone(){return new yl(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?new yl(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yl(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(s,h){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const v=this.canonical.z-s;return s>this.canonical.z?ep(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):ep(this.wrap*+h,s,s,this.canonical.x>>v,this.canonical.y>>v)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const h=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h}children(s){if(this.overscaledZ>=s)return[new yl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,v=2*this.canonical.x,I=2*this.canonical.y;return[new yl(h,this.wrap,h,v,I),new yl(h,this.wrap,h,v+1,I),new yl(h,this.wrap,h,v,I+1),new yl(h,this.wrap,h,v+1,I+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new yl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new yl(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new cf(s.x-this.wrap,s.y))}}function ep(c,s,h,v,I){(c*=2)<0&&(c=-1*c-1);const z=1<<h;return(z*z*c+z*I+v).toString(36)+h.toString(36)+s.toString(36)}Zi("CanonicalTileID",Sg),Zi("OverscaledTileID",yl,{omit:["posMatrix"]});class uy{constructor(s,h,v){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(v&&v!=="mapbox"&&v!=="terrarium")return void Me(`"${v}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const I=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=v||"mapbox";for(let z=0;z<I;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(I,z)]=this.data[this._idx(I-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,I)]=this.data[this._idx(z,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<I;z++)for(let B=0;B<I;B++){const U=this.get(z,B);U>this.max&&(this.max=U),U<this.min&&(this.min=U)}}get(s,h){const v=new Uint8Array(this.data.buffer),I=4*this._idx(s,h);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(v[I],v[I+1],v[I+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)}_unpackMapbox(s,h,v){return(256*s*256+256*h+v)/10-1e4}_unpackTerrarium(s,h,v){return 256*s+h+v/256-32768}getPixels(){return new fa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,h,v){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let I=h*this.dim,z=h*this.dim+this.dim,B=v*this.dim,U=v*this.dim+this.dim;switch(h){case-1:I=z-1;break;case 1:z=I+1}switch(v){case-1:B=U-1;break;case 1:U=B+1}const Z=-h*this.dim,ne=-v*this.dim;for(let de=B;de<U;de++)for(let _e=I;_e<z;_e++)this.data[this._idx(_e,de)]=s.data[this._idx(_e+Z,de+ne)]}}Zi("DEMData",uy);class hy{constructor(s){this._stringToNumber={},this._numberToString=[];for(let h=0;h<s.length;h++){const v=s[h];this._stringToNumber[v]=h,this._numberToString[h]=v}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class tp{constructor(s,h,v,I,z){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=v,s._y=I,this.properties=s.properties,this.id=z}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(s[h]=this[h]);return s}}class dy{constructor(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new ac(wt,16,0),this.grid3D=new ac(wt,16,0),this.featureIndexArray=new $n,this.promoteId=h}insert(s,h,v,I,z,B){const U=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,I,z);const Z=B?this.grid3D:this.grid;for(let ne=0;ne<h.length;ne++){const de=h[ne],_e=[1/0,1/0,-1/0,-1/0];for(let be=0;be<de.length;be++){const Ce=de[be];_e[0]=Math.min(_e[0],Ce.x),_e[1]=Math.min(_e[1],Ce.y),_e[2]=Math.max(_e[2],Ce.x),_e[3]=Math.max(_e[3],Ce.y)}_e[0]<wt&&_e[1]<wt&&_e[2]>=0&&_e[3]>=0&&Z.insert(U,_e[0],_e[1],_e[2],_e[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xh.VectorTile(new bh(this.rawTileData)).layers,this.sourceLayerCoder=new hy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,h,v,I){this.loadVTLayers();const z=s.params||{},B=wt/s.tileSize/s.scale,U=Gs(z.filter),Z=s.queryGeometry,ne=s.queryPadding*B,de=md(Z),_e=this.grid.query(de.minX-ne,de.minY-ne,de.maxX+ne,de.maxY+ne),be=md(s.cameraQueryGeometry),Ce=this.grid3D.query(be.minX-ne,be.minY-ne,be.maxX+ne,be.maxY+ne,(st,Pt,Xt,Ct)=>function(jt,hi,li,nn,Wi){for(const Ri of jt)if(hi<=Ri.x&&li<=Ri.y&&nn>=Ri.x&&Wi>=Ri.y)return!0;const Xi=[new zt(hi,li),new zt(hi,Wi),new zt(nn,Wi),new zt(nn,li)];if(jt.length>2){for(const Ri of Xi)if(br(jt,Ri))return!0}for(let Ri=0;Ri<jt.length-1;Ri++)if(Ir(jt[Ri],jt[Ri+1],Xi))return!0;return!1}(s.cameraQueryGeometry,st-ne,Pt-ne,Xt+ne,Ct+ne));for(const st of Ce)_e.push(st);_e.sort(p0);const Ie={};let dt;for(let st=0;st<_e.length;st++){const Pt=_e[st];if(Pt===dt)continue;dt=Pt;const Xt=this.featureIndexArray.get(Pt);let Ct=null;this.loadMatchingFeature(Ie,Xt.bucketIndex,Xt.sourceLayerIndex,Xt.featureIndex,U,z.layers,z.availableImages,h,v,I,(jt,hi,li)=>(Ct||(Ct=pi(jt)),hi.queryIntersectsFeature(Z,jt,li,Ct,this.z,s.transform,B,s.pixelPosMatrix)))}return Ie}loadMatchingFeature(s,h,v,I,z,B,U,Z,ne,de,_e){const be=this.bucketLayerIDs[h];if(B&&!function(st,Pt){for(let Xt=0;Xt<st.length;Xt++)if(Pt.indexOf(st[Xt])>=0)return!0;return!1}(B,be))return;const Ce=this.sourceLayerCoder.decode(v),Ie=this.vtLayers[Ce].feature(I);if(z.needGeometry){const st=Gt(Ie,!0);if(!z.filter(new Rr(this.tileID.overscaledZ),st,this.tileID.canonical))return}else if(!z.filter(new Rr(this.tileID.overscaledZ),Ie))return;const dt=this.getId(Ie,Ce);for(let st=0;st<be.length;st++){const Pt=be[st];if(B&&B.indexOf(Pt)<0)continue;const Xt=Z[Pt];if(!Xt)continue;let Ct={};dt&&de&&(Ct=de.getState(Xt.sourceLayer||"_geojsonTileLayer",dt));const jt=me({},ne[Pt]);jt.paint=Cg(jt.paint,Xt.paint,Ie,Ct,U),jt.layout=Cg(jt.layout,Xt.layout,Ie,Ct,U);const hi=!_e||_e(Ie,Xt,Ct);if(!hi)continue;const li=new tp(Ie,this.z,this.x,this.y,dt);li.layer=jt;let nn=s[Pt];nn===void 0&&(nn=s[Pt]=[]),nn.push({featureIndex:I,feature:li,intersectionZ:hi})}}lookupSymbolFeatures(s,h,v,I,z,B,U,Z){const ne={};this.loadVTLayers();const de=Gs(z);for(const _e of s)this.loadMatchingFeature(ne,v,I,_e,de,B,U,Z,h);return ne}hasLayer(s){for(const h of this.bucketLayerIDs)for(const v of h)if(s===v)return!0;return!1}getId(s,h){let v=s.id;return this.promoteId&&(v=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof v=="boolean"&&(v=Number(v))),v}}function Cg(c,s,h,v,I){return $e(c,(z,B)=>{const U=s instanceof os?s.get(B):null;return U&&U.evaluate?U.evaluate(h,v,I):U})}function md(c){let s=1/0,h=1/0,v=-1/0,I=-1/0;for(const z of c)s=Math.min(s,z.x),h=Math.min(h,z.y),v=Math.max(v,z.x),I=Math.max(I,z.y);return{minX:s,minY:h,maxX:v,maxY:I}}function p0(c,s){return s-c}var Ig;Zi("FeatureIndex",dy,{omit:["rawTileData","sourceLayerCoder"]}),i.PerformanceMarkers=void 0,(Ig=i.PerformanceMarkers||(i.PerformanceMarkers={})).create="create",Ig.load="load",Ig.fullLoad="fullLoad";let im=null,uf=[];const nm=1e3/30,m0={mark(c){performance.mark(c)},frame(c){const s=c;im!=null&&uf.push(s-im),im=s},clearMetrics(){im=null,uf=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const c in i.PerformanceMarkers)performance.clearMarks(i.PerformanceMarkers[c])},getPerformanceMetrics(){performance.measure("loadTime",i.PerformanceMarkers.create,i.PerformanceMarkers.load),performance.measure("fullLoadTime",i.PerformanceMarkers.create,i.PerformanceMarkers.fullLoad);const c=performance.getEntriesByName("loadTime")[0].duration,s=performance.getEntriesByName("fullLoadTime")[0].duration,h=uf.length,v=1/(uf.reduce((z,B)=>z+B,0)/h/1e3),I=uf.filter(z=>z>nm).reduce((z,B)=>z+(B-nm)/nm,0);return{loadTime:c,fullLoadTime:s,fps:v,percentDroppedFrames:I/(h+I)*100}}};i.AJAXError=bt,i.ARRAY_TYPE=er,i.Actor=class{constructor(c,s,h){this.target=c,this.parent=s,this.mapId=h,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},je(["receive","process"],this),this.invoker=new Yf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=rt()?c:window}send(c,s,h,v,I=!1){const z=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(this.callbacks[z]=h);const B=ti(this.globalScope)?void 0:[];return this.target.postMessage({id:z,type:c,hasCallback:!!h,targetMapId:v,mustQueue:I,sourceMapId:this.mapId,data:Dl(s,B)},B),{cancel:()=>{h&&delete this.callbacks[z],this.target.postMessage({id:z,type:"<cancel>",targetMapId:v,sourceMapId:this.mapId})}}}receive(c){const s=c.data,h=s.id;if(h&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[h];const v=this.cancelCallbacks[h];delete this.cancelCallbacks[h],v&&v()}else rt()||s.mustQueue?(this.tasks[h]=s,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,s)}process(){if(!this.taskQueue.length)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){if(s.type==="<response>"){const h=this.callbacks[c];delete this.callbacks[c],h&&(s.error?h(No(s.error)):h(null,No(s.data)))}else{let h=!1;const v=ti(this.globalScope)?void 0:[],I=s.hasCallback?(U,Z)=>{h=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:U?Dl(U):null,data:Dl(Z,v)},v)}:U=>{h=!0};let z=null;const B=No(s.data);if(this.parent[s.type])z=this.parent[s.type](s.sourceMapId,B,I);else if(this.parent.getWorkerSource){const U=s.type.split(".");z=this.parent.getWorkerSource(s.sourceMapId,U[0],B.source)[U[1]](B,I)}else I(new Error(`Could not find function ${s.type}`));!h&&z&&z.cancel&&(this.cancelCallbacks[c]=z.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.AlphaImage=qu,i.CanonicalTileID=Sg,i.CollisionBoxArray=ii,i.CollisionCircleLayoutArray=class extends pe{},i.Color=he,i.DEMData=uy,i.DataConstantProperty=an,i.DictionaryCoder=hy,i.EXTENT=wt,i.ErrorEvent=On,i.EvaluationParameters=Rr,i.Event=Tn,i.Evented=qn,i.FeatureIndex=dy,i.FillBucket=ig,i.FillExtrusionBucket=Gp,i.GeoJSONFeature=tp,i.ImageAtlas=Jd,i.ImagePosition=dd,i.LineBucket=Uf,i.LineStripIndexArray=class extends ot{},i.LngLat=Mo,i.LngLatBounds=pd,i.MercatorCoordinate=cf,i.ONE_EM=Ss,i.OverscaledTileID=yl,i.PerformanceUtils=m0,i.PosArray=dn,i.Properties=Ao,i.QuadTriangleArray=class extends Ee{},i.RGBAImage=fa,i.RasterBoundsArray=class extends C{},i.RequestPerformance=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},i.ResourceType=at,i.SegmentVector=o,i.SymbolBucket=mc,i.Transitionable=hc,i.TriangleIndexArray=ws,i.Uniform1f=Le,i.Uniform1i=class extends Be{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},i.Uniform2f=class extends Be{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},i.Uniform3f=class extends Be{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},i.Uniform4f=Re,i.UniformColor=Pe,i.UniformMatrix4f=class extends Be{constructor(c,s){super(c,s),this.current=ze}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},i.UnwrappedTileID=cy,i.ValidationError=yi,i.ZoomHistory=hl,i.add=function(c,s,h){return c[0]=s[0]+h[0],c[1]=s[1]+h[1],c[2]=s[2]+h[2],c},i.addDynamicAttributes=wg,i.asyncAll=function(c,s,h){if(!c.length)return h(null,[]);let v=c.length;const I=new Array(c.length);let z=null;c.forEach((B,U)=>{s(B,(Z,ne)=>{Z&&(z=Z),I[U]=ne,--v==0&&h(z,I)})})},i.bezier=K,i.bindAll=je,i.cacheEntryPossiblyAdded=function(c){En++,En>Er&&(c.getActor().send("enforceCacheSizeLimit",mn),En=0)},i.clamp=q,i.clearTileCache=function(c){const s=caches.delete(cn);c&&s.catch(c).then(()=>c())},i.clipLine=ty,i.clone=function(c){var s=new er(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},i.clone$1=Ae,i.clone$2=function(c){var s=new er(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s},i.collisionCircleLayout=X_,i.config=vi,i.copy=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},i.create=function(){var c=new er(16);return er!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},i.create$1=Or,i.createExpression=Dc,i.createFilter=Gs,i.createLayout=zo,i.createStyleLayer=function(c){return c.type==="custom"?new oy(c):new sy[c.type](c)},i.cross=function(c,s,h){var v=s[0],I=s[1],z=s[2],B=h[0],U=h[1],Z=h[2];return c[0]=I*Z-z*U,c[1]=z*B-v*Z,c[2]=v*U-I*B,c},i.dot=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]},i.dot$1=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},i.ease=Y,i.emitValidationErrors=Bu,i.enforceCacheSizeLimit=function(c){Li(),di&&di.then(s=>{s.keys().then(h=>{for(let v=0;v<h.length-c;v++)s.delete(h[v])})})},i.equals=function(c,s){var h=c[0],v=c[1],I=c[2],z=c[3],B=c[4],U=c[5],Z=c[6],ne=c[7],de=c[8],_e=c[9],be=c[10],Ce=c[11],Ie=c[12],dt=c[13],st=c[14],Pt=c[15],Xt=s[0],Ct=s[1],jt=s[2],hi=s[3],li=s[4],nn=s[5],Wi=s[6],Xi=s[7],Ri=s[8],Di=s[9],Qi=s[10],Hi=s[11],Ai=s[12],bn=s[13],fn=s[14],tr=s[15];return Math.abs(h-Xt)<=xo*Math.max(1,Math.abs(h),Math.abs(Xt))&&Math.abs(v-Ct)<=xo*Math.max(1,Math.abs(v),Math.abs(Ct))&&Math.abs(I-jt)<=xo*Math.max(1,Math.abs(I),Math.abs(jt))&&Math.abs(z-hi)<=xo*Math.max(1,Math.abs(z),Math.abs(hi))&&Math.abs(B-li)<=xo*Math.max(1,Math.abs(B),Math.abs(li))&&Math.abs(U-nn)<=xo*Math.max(1,Math.abs(U),Math.abs(nn))&&Math.abs(Z-Wi)<=xo*Math.max(1,Math.abs(Z),Math.abs(Wi))&&Math.abs(ne-Xi)<=xo*Math.max(1,Math.abs(ne),Math.abs(Xi))&&Math.abs(de-Ri)<=xo*Math.max(1,Math.abs(de),Math.abs(Ri))&&Math.abs(_e-Di)<=xo*Math.max(1,Math.abs(_e),Math.abs(Di))&&Math.abs(be-Qi)<=xo*Math.max(1,Math.abs(be),Math.abs(Qi))&&Math.abs(Ce-Hi)<=xo*Math.max(1,Math.abs(Ce),Math.abs(Hi))&&Math.abs(Ie-Ai)<=xo*Math.max(1,Math.abs(Ie),Math.abs(Ai))&&Math.abs(dt-bn)<=xo*Math.max(1,Math.abs(dt),Math.abs(bn))&&Math.abs(st-fn)<=xo*Math.max(1,Math.abs(st),Math.abs(fn))&&Math.abs(Pt-tr)<=xo*Math.max(1,Math.abs(Pt),Math.abs(tr))},i.evaluateSizeForFeature=function(c,{uSize:s,uSizeT:h},{lowerSize:v,upperSize:I}){return c.kind==="source"?v/tu:c.kind==="composite"?Hr(v/tu,I/tu,h):s},i.evaluateSizeForZoom=function(c,s){let h=0,v=0;if(c.kind==="constant")v=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:I,minZoom:z,maxZoom:B}=c,U=I?q(js.interpolationFactor(I,s,z,B),0,1):0;c.kind==="camera"?v=Hr(c.minSize,c.maxSize,U):h=U}return{uSizeT:h,uSize:v}},i.evaluateVariableOffset=rf,i.evented=Bl,i.exported=Wt,i.exported$1=wn,i.extend=me,i.filterObject=tt,i.fromRotation=function(c,s){var h=Math.sin(s),v=Math.cos(s);return c[0]=v,c[1]=h,c[2]=0,c[3]=-h,c[4]=v,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},i.fromScaling=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},i.getAnchorAlignment=Xp,i.getAnchorJustification=of,i.getArrayBuffer=Mi,i.getImage=tn,i.getJSON=function(c,s){return gi(me(c,{type:"json"}),s)},i.getOverlapMode=af,i.getRTLTextPluginStatus=dl,i.getReferrer=Ft,i.getVideo=function(c,s){const h=window.document.createElement("video");h.muted=!0,h.onloadstart=function(){s(null,h)};for(let v=0;v<c.length;v++){const I=window.document.createElement("source");Ki(c[v])||(h.crossOrigin="Anonymous"),I.src=c[v],h.appendChild(I)}return{cancel:()=>{}}},i.identity=_r,i.invert=function(c,s){var h=s[0],v=s[1],I=s[2],z=s[3],B=s[4],U=s[5],Z=s[6],ne=s[7],de=s[8],_e=s[9],be=s[10],Ce=s[11],Ie=s[12],dt=s[13],st=s[14],Pt=s[15],Xt=h*U-v*B,Ct=h*Z-I*B,jt=h*ne-z*B,hi=v*Z-I*U,li=v*ne-z*U,nn=I*ne-z*Z,Wi=de*dt-_e*Ie,Xi=de*st-be*Ie,Ri=de*Pt-Ce*Ie,Di=_e*st-be*dt,Qi=_e*Pt-Ce*dt,Hi=be*Pt-Ce*st,Ai=Xt*Hi-Ct*Qi+jt*Di+hi*Ri-li*Xi+nn*Wi;return Ai?(c[0]=(U*Hi-Z*Qi+ne*Di)*(Ai=1/Ai),c[1]=(I*Qi-v*Hi-z*Di)*Ai,c[2]=(dt*nn-st*li+Pt*hi)*Ai,c[3]=(be*li-_e*nn-Ce*hi)*Ai,c[4]=(Z*Ri-B*Hi-ne*Xi)*Ai,c[5]=(h*Hi-I*Ri+z*Xi)*Ai,c[6]=(st*jt-Ie*nn-Pt*Ct)*Ai,c[7]=(de*nn-be*jt+Ce*Ct)*Ai,c[8]=(B*Qi-U*Ri+ne*Wi)*Ai,c[9]=(v*Ri-h*Qi-z*Wi)*Ai,c[10]=(Ie*li-dt*jt+Pt*Xt)*Ai,c[11]=(_e*jt-de*li-Ce*Xt)*Ai,c[12]=(U*Xi-B*Di-Z*Wi)*Ai,c[13]=(h*Di-v*Xi+I*Wi)*Ai,c[14]=(dt*Ct-Ie*hi-st*Xt)*Ai,c[15]=(de*hi-_e*Ct+be*Xt)*Ai,c):null},i.isImageBitmap=Nt,i.isSafari=ti,i.isWorker=rt,i.keysDifference=function(c,s){const h=[];for(const v in c)v in s||h.push(v);return h},i.lazyLoadRTLTextPlugin=function(){vo.isLoading()||vo.isLoaded()||dl()!=="deferred"||ji()},i.makeRequest=gi,i.mapObject=$e,i.mercatorXfromLng=ay,i.mercatorYfromLat=tm,i.mercatorZfromAltitude=ly,i.mul=Kr,i.mul$1=function(c,s,h){return c[0]=s[0]*h[0],c[1]=s[1]*h[1],c[2]=s[2]*h[2],c[3]=s[3]*h[3],c},i.multiply=Do,i.nextPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},i.normalize=function(c,s){var h=s[0],v=s[1],I=s[2],z=h*h+v*v+I*I;return z>0&&(z=1/Math.sqrt(z)),c[0]=s[0]*z,c[1]=s[1]*z,c[2]=s[2]*z,c},i.number=Hr,i.ortho=function(c,s,h,v,I,z,B){var U=1/(s-h),Z=1/(v-I),ne=1/(z-B);return c[0]=-2*U,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*Z,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*ne,c[11]=0,c[12]=(s+h)*U,c[13]=(I+v)*Z,c[14]=(B+z)*ne,c[15]=1,c},i.parseCacheControl=gt,i.parseGlyphPbf=function(c){return new bh(c).readFields(Yd,[])},i.pbf=bh,i.performSymbolLayout=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=wt/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0].layout,h=c.bucket.layers[0]._unevaluatedLayout._values,v={layoutIconSize:h["icon-size"].possiblyEvaluate(new Rr(c.bucket.zoom+1),c.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Rr(c.bucket.zoom+1),c.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Rr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:Z,maxZoom:ne}=c.bucket.textSizeData;v.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Rr(Z),c.canonical),h["text-size"].possiblyEvaluate(new Rr(ne),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:Z,maxZoom:ne}=c.bucket.iconSizeData;v.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Rr(Z),c.canonical),h["icon-size"].possiblyEvaluate(new Rr(ne),c.canonical)]}const I=s.get("text-line-height")*Ss,z=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",B=s.get("text-keep-upright"),U=s.get("text-size");for(const Z of c.bucket.features){const ne=s.get("text-font").evaluate(Z,{},c.canonical).join(","),de=U.evaluate(Z,{},c.canonical),_e=v.layoutTextSize.evaluate(Z,{},c.canonical),be=v.layoutIconSize.evaluate(Z,{},c.canonical),Ce={horizontal:{},vertical:void 0},Ie=Z.text;let dt,st=[0,0];if(Ie){const Ct=Ie.toString(),jt=s.get("text-letter-spacing").evaluate(Z,{},c.canonical)*Ss,hi=Sr(Ct)?jt:0,li=s.get("text-anchor").evaluate(Z,{},c.canonical),nn=s.get("text-variable-anchor");if(!nn){const Qi=s.get("text-radial-offset").evaluate(Z,{},c.canonical);st=Qi?rf(li,[Qi*Ss,bg]):s.get("text-offset").evaluate(Z,{},c.canonical).map(Hi=>Hi*Ss)}let Wi=z?"center":s.get("text-justify").evaluate(Z,{},c.canonical);const Xi=s.get("symbol-placement"),Ri=Xi==="point"?s.get("text-max-width").evaluate(Z,{},c.canonical)*Ss:0,Di=()=>{c.bucket.allowVerticalPlacement&&qc(Ct)&&(Ce.vertical=Aa(Ie,c.glyphMap,c.glyphPositions,c.imagePositions,ne,Ri,I,li,"left",hi,st,i.WritingMode.vertical,!0,Xi,_e,de))};if(!z&&nn){const Qi=Wi==="auto"?nn.map(Ai=>of(Ai)):[Wi];let Hi=!1;for(let Ai=0;Ai<Qi.length;Ai++){const bn=Qi[Ai];if(!Ce.horizontal[bn])if(Hi)Ce.horizontal[bn]=Ce.horizontal[0];else{const fn=Aa(Ie,c.glyphMap,c.glyphPositions,c.imagePositions,ne,Ri,I,"center",bn,hi,st,i.WritingMode.horizontal,!1,Xi,_e,de);fn&&(Ce.horizontal[bn]=fn,Hi=fn.positionedLines.length===1)}}Di()}else{Wi==="auto"&&(Wi=of(li));const Qi=Aa(Ie,c.glyphMap,c.glyphPositions,c.imagePositions,ne,Ri,I,li,Wi,hi,st,i.WritingMode.horizontal,!1,Xi,_e,de);Qi&&(Ce.horizontal[Wi]=Qi),Di(),qc(Ct)&&z&&B&&(Ce.vertical=Aa(Ie,c.glyphMap,c.glyphPositions,c.imagePositions,ne,Ri,I,li,Wi,hi,st,i.WritingMode.vertical,!1,Xi,_e,de))}}let Pt=!1;if(Z.icon&&Z.icon.name){const Ct=c.imageMap[Z.icon.name];Ct&&(dt=Q_(c.imagePositions[Z.icon.name],s.get("icon-offset").evaluate(Z,{},c.canonical),s.get("icon-anchor").evaluate(Z,{},c.canonical)),Pt=!!Ct.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Pt:c.bucket.sdfIcons!==Pt&&Me("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ct.pixelRatio!==c.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Xt=ry(Ce.horizontal)||Ce.vertical;c.bucket.iconsInText=!!Xt&&Xt.iconsInText,(Xt||dt)&&ny(c.bucket,Z,Ce,dt,c.imageMap,v,_e,be,st,Pt,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},i.perspective=function(c,s,h,v,I){var z,B=1/Math.tan(s/2);return c[0]=B/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=B,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,I!=null&&I!==1/0?(c[10]=(I+v)*(z=1/(v-I)),c[14]=2*I*v*z):(c[10]=-1,c[14]=-2*v),c},i.pick=function(c,s){const h={};for(let v=0;v<s.length;v++){const I=s[v];I in c&&(h[I]=c[I])}return h},i.plugin=vo,i.pointGeometry=zt,i.polygonIntersectsPolygon=St,i.potpack=pg,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.register=Zi,i.registerForPluginStateChange=function(c){return c({pluginStatus:Po,pluginURL:bs}),Bl.on("pluginStateChange",c),c},i.renderColorRamp=Ym,i.rotateX=function(c,s,h){var v=Math.sin(h),I=Math.cos(h),z=s[4],B=s[5],U=s[6],Z=s[7],ne=s[8],de=s[9],_e=s[10],be=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=z*I+ne*v,c[5]=B*I+de*v,c[6]=U*I+_e*v,c[7]=Z*I+be*v,c[8]=ne*I-z*v,c[9]=de*I-B*v,c[10]=_e*I-U*v,c[11]=be*I-Z*v,c},i.rotateZ=function(c,s,h){var v=Math.sin(h),I=Math.cos(h),z=s[0],B=s[1],U=s[2],Z=s[3],ne=s[4],de=s[5],_e=s[6],be=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=z*I+ne*v,c[1]=B*I+de*v,c[2]=U*I+_e*v,c[3]=Z*I+be*v,c[4]=ne*I-z*v,c[5]=de*I-B*v,c[6]=_e*I-U*v,c[7]=be*I-Z*v,c},i.scale=function(c,s,h){var v=h[0],I=h[1],z=h[2];return c[0]=s[0]*v,c[1]=s[1]*v,c[2]=s[2]*v,c[3]=s[3]*v,c[4]=s[4]*I,c[5]=s[5]*I,c[6]=s[6]*I,c[7]=s[7]*I,c[8]=s[8]*z,c[9]=s[9]*z,c[10]=s[10]*z,c[11]=s[11]*z,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},i.scale$1=function(c,s,h){return c[0]=s[0]*h,c[1]=s[1]*h,c[2]=s[2]*h,c},i.setCacheLimits=function(c,s){mn=c,Er=s},i.setRTLTextPlugin=function(c,s,h=!1){if(Po===Ou||Po===Fu||Po===Zc)throw new Error("setRTLTextPlugin cannot be called multiple times.");bs=Wt.resolveURL(c),Po=Ou,uc=s,Ll(),h||ji()},i.spec=Ot,i.sphericalToCartesian=function([c,s,h]){return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(h),y:c*Math.sin(s)*Math.sin(h),z:c*Math.cos(h)}},i.sqrLen=function(c){var s=c[0],h=c[1];return s*s+h*h},i.sub=function(c,s,h){return c[0]=s[0]-h[0],c[1]=s[1]-h[1],c[2]=s[2]-h[2],c},i.toEvaluationFeature=Gt,i.transformMat3=function(c,s,h){var v=s[0],I=s[1],z=s[2];return c[0]=v*h[0]+I*h[3]+z*h[6],c[1]=v*h[1]+I*h[4]+z*h[7],c[2]=v*h[2]+I*h[5]+z*h[8],c},i.transformMat4=$a,i.transformMat4$1=function(c,s,h){var v=s[0],I=s[1];return c[0]=h[0]*v+h[4]*I+h[12],c[1]=h[1]*v+h[5]*I+h[13],c},i.translate=function(c,s,h){var v,I,z,B,U,Z,ne,de,_e,be,Ce,Ie,dt=h[0],st=h[1],Pt=h[2];return s===c?(c[12]=s[0]*dt+s[4]*st+s[8]*Pt+s[12],c[13]=s[1]*dt+s[5]*st+s[9]*Pt+s[13],c[14]=s[2]*dt+s[6]*st+s[10]*Pt+s[14],c[15]=s[3]*dt+s[7]*st+s[11]*Pt+s[15]):(I=s[1],z=s[2],B=s[3],U=s[4],Z=s[5],ne=s[6],de=s[7],_e=s[8],be=s[9],Ce=s[10],Ie=s[11],c[0]=v=s[0],c[1]=I,c[2]=z,c[3]=B,c[4]=U,c[5]=Z,c[6]=ne,c[7]=de,c[8]=_e,c[9]=be,c[10]=Ce,c[11]=Ie,c[12]=v*dt+U*st+_e*Pt+s[12],c[13]=I*dt+Z*st+be*Pt+s[13],c[14]=z*dt+ne*st+Ce*Pt+s[14],c[15]=B*dt+de*st+Ie*Pt+s[15]),c},i.triggerPluginCompletionEvent=Vu,i.unicodeBlockLookup=Ni,i.uniqueId=function(){return we++},i.validateCustomStyleLayer=function(c){const s=[],h=c.id;return h===void 0&&s.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),s},i.validateLight=Lu,i.validateStyle=Du,i.vectorTile=xh,i.warnOnce=Me,i.wrap=re}),E(["./shared"],function(i){function F(le){const X=typeof le;if(X==="number"||X==="boolean"||X==="string"||le==null)return JSON.stringify(le);if(Array.isArray(le)){let he="[";for(const Se of le)he+=`${F(Se)},`;return`${he}]`}const ee=Object.keys(le).sort();let ae="{";for(let he=0;he<ee.length;he++)ae+=`${JSON.stringify(ee[he])}:${F(le[ee[he]])},`;return`${ae}}`}function j(le){let X="";for(const ee of i.refProperties)X+=`/${F(le[ee])}`;return X}class K{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,ee){for(const he of X){this._layerConfigs[he.id]=he;const Se=this._layers[he.id]=i.createStyleLayer(he);Se._featureFilter=i.createFilter(Se.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of ee)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ae=function(he,Se){const qe={};for(let Ue=0;Ue<he.length;Ue++){const it=Se&&Se[he[Ue].id]||j(he[Ue]);Se&&(Se[he[Ue].id]=it);let xt=qe[it];xt||(xt=qe[it]=[]),xt.push(he[Ue])}const De=[];for(const Ue in qe)De.push(qe[Ue]);return De}(Object.values(this._layerConfigs),this.keyCache);for(const he of ae){const Se=he.map(Bt=>this._layers[Bt.id]),qe=Se[0];if(qe.visibility==="none")continue;const De=qe.source||"";let Ue=this.familiesBySource[De];Ue||(Ue=this.familiesBySource[De]={});const it=qe.sourceLayer||"_geojsonTileLayer";let xt=Ue[it];xt||(xt=Ue[it]=[]),xt.push(Se)}}}class Y{constructor(X){const ee={},ae=[];for(const De in X){const Ue=X[De],it=ee[De]={};for(const xt in Ue){const Bt=Ue[+xt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const It={x:0,y:0,w:Bt.bitmap.width+2,h:Bt.bitmap.height+2};ae.push(It),it[xt]={rect:It,metrics:Bt.metrics}}}const{w:he,h:Se}=i.potpack(ae),qe=new i.AlphaImage({width:he||1,height:Se||1});for(const De in X){const Ue=X[De];for(const it in Ue){const xt=Ue[+it];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const Bt=ee[De][it].rect;i.AlphaImage.copy(xt.bitmap,qe,{x:0,y:0},{x:Bt.x+1,y:Bt.y+1},xt.bitmap)}}this.image=qe,this.positions=ee}}i.register("GlyphAtlas",Y);class q{constructor(X){this.tileID=new i.OverscaledTileID(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId}parse(X,ee,ae,he,Se){this.status="parsing",this.data=X,this.collisionBoxArray=new i.CollisionBoxArray;const qe=new i.DictionaryCoder(Object.keys(X.layers).sort()),De=new i.FeatureIndex(this.tileID,this.promoteId);De.bucketLayerIDs=[];const Ue={},it={featureIndex:De,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},xt=ee.familiesBySource[this.source];for(const xn in xt){const Mt=X.layers[xn];if(!Mt)continue;Mt.version===1&&i.warnOnce(`Vector tile source "${this.source}" layer "${xn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Gn=qe.encode(xn),Fn=[];for(let Qr=0;Qr<Mt.length;Qr++){const ao=Mt.feature(Qr),$r=De.getId(ao,xn);Fn.push({feature:ao,id:$r,index:Qr,sourceLayerIndex:Gn})}for(const Qr of xt[xn]){const ao=Qr[0];ao.source!==this.source&&i.warnOnce(`layer.source = ${ao.source} does not equal this.source = ${this.source}`),ao.minzoom&&this.zoom<Math.floor(ao.minzoom)||ao.maxzoom&&this.zoom>=ao.maxzoom||ao.visibility!=="none"&&(re(Qr,this.zoom,ae),(Ue[ao.id]=ao.createBucket({index:De.bucketLayerIDs.length,layers:Qr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Gn,sourceID:this.source})).populate(Fn,it,this.tileID.canonical),De.bucketLayerIDs.push(Qr.map($r=>$r.id)))}}let Bt,It,Ci,ri;const xi=i.mapObject(it.glyphDependencies,xn=>Object.keys(xn).map(Number));Object.keys(xi).length?he.send("getGlyphs",{uid:this.uid,stacks:xi},(xn,Mt)=>{Bt||(Bt=xn,It=Mt,Zn.call(this))}):It={};const Gi=Object.keys(it.iconDependencies);Gi.length?he.send("getImages",{icons:Gi,source:this.source,tileID:this.tileID,type:"icons"},(xn,Mt)=>{Bt||(Bt=xn,Ci=Mt,Zn.call(this))}):Ci={};const _n=Object.keys(it.patternDependencies);function Zn(){if(Bt)return Se(Bt);if(It&&Ci&&ri){const xn=new Y(It),Mt=new i.ImageAtlas(Ci,ri);for(const Gn in Ue){const Fn=Ue[Gn];Fn instanceof i.SymbolBucket?(re(Fn.layers,this.zoom,ae),i.performSymbolLayout({bucket:Fn,glyphMap:It,glyphPositions:xn.positions,imageMap:Ci,imagePositions:Mt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Fn.hasPattern&&(Fn instanceof i.LineBucket||Fn instanceof i.FillBucket||Fn instanceof i.FillExtrusionBucket)&&(re(Fn.layers,this.zoom,ae),Fn.addFeatures(it,this.tileID.canonical,Mt.patternPositions))}this.status="done",Se(null,{buckets:Object.values(Ue).filter(Gn=>!Gn.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xn.image,imageAtlas:Mt,glyphMap:this.returnDependencies?It:null,iconMap:this.returnDependencies?Ci:null,glyphPositions:this.returnDependencies?xn.positions:null})}}_n.length?he.send("getImages",{icons:_n,source:this.source,tileID:this.tileID,type:"patterns"},(xn,Mt)=>{Bt||(Bt=xn,ri=Mt,Zn.call(this))}):ri={},Zn.call(this)}}function re(le,X,ee){const ae=new i.EvaluationParameters(X);for(const he of le)he.recalculate(ae,ee)}function me(le,X){const ee=i.getArrayBuffer(le.request,(ae,he,Se,qe)=>{ae?X(ae):he&&X(null,{vectorTile:new i.vectorTile.VectorTile(new i.pbf(he)),rawData:he,cacheControl:Se,expires:qe})});return()=>{ee.cancel(),X()}}class we{constructor(X,ee,ae,he){this.actor=X,this.layerIndex=ee,this.availableImages=ae,this.loadVectorData=he||me,this.loading={},this.loaded={}}loadTile(X,ee){const ae=X.uid;this.loading||(this.loading={});const he=!!(X&&X.request&&X.request.collectResourceTiming)&&new i.RequestPerformance(X.request),Se=this.loading[ae]=new q(X);Se.abort=this.loadVectorData(X,(qe,De)=>{if(delete this.loading[ae],qe||!De)return Se.status="done",this.loaded[ae]=Se,ee(qe);const Ue=De.rawData,it={};De.expires&&(it.expires=De.expires),De.cacheControl&&(it.cacheControl=De.cacheControl);const xt={};if(he){const Bt=he.finish();Bt&&(xt.resourceTiming=JSON.parse(JSON.stringify(Bt)))}Se.vectorTile=De.vectorTile,Se.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,(Bt,It)=>{if(Bt||!It)return ee(Bt);ee(null,i.extend({rawTileData:Ue.slice(0)},It,it,xt))}),this.loaded=this.loaded||{},this.loaded[ae]=Se})}reloadTile(X,ee){const ae=this.loaded,he=X.uid,Se=this;if(ae&&ae[he]){const qe=ae[he];qe.showCollisionBoxes=X.showCollisionBoxes;const De=(Ue,it)=>{const xt=qe.reloadCallback;xt&&(delete qe.reloadCallback,qe.parse(qe.vectorTile,Se.layerIndex,this.availableImages,Se.actor,xt)),ee(Ue,it)};qe.status==="parsing"?qe.reloadCallback=De:qe.status==="done"&&(qe.vectorTile?qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,De):De())}}abortTile(X,ee){const ae=this.loading,he=X.uid;ae&&ae[he]&&ae[he].abort&&(ae[he].abort(),delete ae[he]),ee()}removeTile(X,ee){const ae=this.loaded,he=X.uid;ae&&ae[he]&&delete ae[he],ee()}}class je{constructor(){this.loaded={}}loadTile(X,ee){const{uid:ae,encoding:he,rawImageData:Se}=X,qe=i.isImageBitmap(Se)?this.getImageData(Se):Se,De=new i.DEMData(ae,qe,he);this.loaded=this.loaded||{},this.loaded[ae]=De,ee(null,De)}getImageData(X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const ee=this.offscreenCanvasContext.getImageData(-1,-1,X.width+2,X.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new i.RGBAImage({width:ee.width,height:ee.height},ee.data)}removeTile(X){const ee=this.loaded,ae=X.uid;ee&&ee[ae]&&delete ee[ae]}}var $e=function le(X,ee){var ae,he=X&&X.type;if(he==="FeatureCollection")for(ae=0;ae<X.features.length;ae++)le(X.features[ae],ee);else if(he==="GeometryCollection")for(ae=0;ae<X.geometries.length;ae++)le(X.geometries[ae],ee);else if(he==="Feature")le(X.geometry,ee);else if(he==="Polygon")tt(X.coordinates,ee);else if(he==="MultiPolygon")for(ae=0;ae<X.coordinates.length;ae++)tt(X.coordinates[ae],ee);return X};function tt(le,X){if(le.length!==0){Ae(le[0],X);for(var ee=1;ee<le.length;ee++)Ae(le[ee],!X)}}function Ae(le,X){for(var ee=0,ae=0,he=0,Se=le.length,qe=Se-1;he<Se;qe=he++){var De=(le[he][0]-le[qe][0])*(le[qe][1]+le[he][1]),Ue=ee+De;ae+=Math.abs(ee)>=Math.abs(De)?ee-Ue+De:De-Ue+ee,ee=Ue}ee+ae>=0!=!!X&&le.reverse()}const mt=i.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Me{constructor(X){this._feature=X,this.extent=i.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const ee of this._feature.geometry)X.push([new i.pointGeometry(ee[0],ee[1])]);return X}{const X=[];for(const ee of this._feature.geometry){const ae=[];for(const he of ee)ae.push(new i.pointGeometry(he[0],he[1]));X.push(ae)}return X}}toGeoJSON(X,ee,ae){return mt.call(this,X,ee,ae)}}class Ye{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=X.length,this._features=X}feature(X){return new Me(this._features[X])}}var Ze={exports:{}},rt=i.pointGeometry,gt=i.vectorTile.VectorTileFeature,vt=Ut;function Ut(le,X){this.options=X||{},this.features=le,this.length=le.length}function At(le,X){this.id=typeof le.id=="number"?le.id:void 0,this.type=le.type,this.rawGeometry=le.type===1?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=X||4096}Ut.prototype.feature=function(le){return new At(this.features[le],this.options.extent)},At.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var X=0;X<le.length;X++){for(var ee=le[X],ae=[],he=0;he<ee.length;he++)ae.push(new rt(ee[he][0],ee[he][1]));this.geometry.push(ae)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,X=1/0,ee=-1/0,ae=1/0,he=-1/0,Se=0;Se<le.length;Se++)for(var qe=le[Se],De=0;De<qe.length;De++){var Ue=qe[De];X=Math.min(X,Ue.x),ee=Math.max(ee,Ue.x),ae=Math.min(ae,Ue.y),he=Math.max(he,Ue.y)}return[X,ae,ee,he]},At.prototype.toGeoJSON=gt.prototype.toGeoJSON;var ti=i.pbf,Nt=vt;function Wt(le){var X=new ti;return function(ee,ae){for(var he in ee.layers)ae.writeMessage(3,zt,ee.layers[he])}(le,X),X.finish()}function zt(le,X){var ee;X.writeVarintField(15,le.version||1),X.writeStringField(1,le.name||""),X.writeVarintField(5,le.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(ee=0;ee<le.length;ee++)ae.feature=le.feature(ee),X.writeMessage(2,Yt,ae);var he=ae.keys;for(ee=0;ee<he.length;ee++)X.writeStringField(3,he[ee]);var Se=ae.values;for(ee=0;ee<Se.length;ee++)X.writeMessage(4,mn,Se[ee])}function Yt(le,X){var ee=le.feature;ee.id!==void 0&&X.writeVarintField(1,ee.id),X.writeMessage(2,vi,le),X.writeVarintField(3,ee.type),X.writeMessage(4,un,ee)}function vi(le,X){var ee=le.feature,ae=le.keys,he=le.values,Se=le.keycache,qe=le.valuecache;for(var De in ee.properties){var Ue=ee.properties[De],it=Se[De];if(Ue!==null){it===void 0&&(ae.push(De),Se[De]=it=ae.length-1),X.writeVarint(it);var xt=typeof Ue;xt!=="string"&&xt!=="boolean"&&xt!=="number"&&(Ue=JSON.stringify(Ue));var Bt=xt+":"+Ue,It=qe[Bt];It===void 0&&(he.push(Ue),qe[Bt]=It=he.length-1),X.writeVarint(It)}}}function cn(le,X){return(X<<3)+(7&le)}function di(le){return le<<1^le>>31}function un(le,X){for(var ee=le.loadGeometry(),ae=le.type,he=0,Se=0,qe=ee.length,De=0;De<qe;De++){var Ue=ee[De],it=1;ae===1&&(it=Ue.length),X.writeVarint(cn(1,it));for(var xt=ae===3?Ue.length-1:Ue.length,Bt=0;Bt<xt;Bt++){Bt===1&&ae!==1&&X.writeVarint(cn(2,xt-1));var It=Ue[Bt].x-he,Ci=Ue[Bt].y-Se;X.writeVarint(di(It)),X.writeVarint(di(Ci)),he+=It,Se+=Ci}ae===3&&X.writeVarint(cn(7,1))}}function mn(le,X){var ee=typeof le;ee==="string"?X.writeStringField(1,le):ee==="boolean"?X.writeBooleanField(7,le):ee==="number"&&(le%1!=0?X.writeDoubleField(3,le):le<0?X.writeSVarintField(6,le):X.writeVarintField(5,le))}function Er(le,X,ee,ae,he,Se){if(he-ae<=ee)return;const qe=ae+he>>1;Li(le,X,qe,ae,he,Se%2),Er(le,X,ee,ae,qe-1,Se+1),Er(le,X,ee,qe+1,he,Se+1)}function Li(le,X,ee,ae,he,Se){for(;he>ae;){if(he-ae>600){const it=he-ae+1,xt=ee-ae+1,Bt=Math.log(it),It=.5*Math.exp(2*Bt/3),Ci=.5*Math.sqrt(Bt*It*(it-It)/it)*(xt-it/2<0?-1:1);Li(le,X,ee,Math.max(ae,Math.floor(ee-xt*It/it+Ci)),Math.min(he,Math.floor(ee+(it-xt)*It/it+Ci)),Se)}const qe=X[2*ee+Se];let De=ae,Ue=he;for(En(le,X,ae,ee),X[2*he+Se]>qe&&En(le,X,ae,he);De<Ue;){for(En(le,X,De,Ue),De++,Ue--;X[2*De+Se]<qe;)De++;for(;X[2*Ue+Se]>qe;)Ue--}X[2*ae+Se]===qe?En(le,X,ae,Ue):(Ue++,En(le,X,Ue,he)),Ue<=ee&&(ae=Ue+1),ee<=Ue&&(he=Ue-1)}}function En(le,X,ee,ae){wn(le,ee,ae),wn(X,2*ee,2*ae),wn(X,2*ee+1,2*ae+1)}function wn(le,X,ee){const ae=le[X];le[X]=le[ee],le[ee]=ae}function vr(le,X,ee,ae){const he=le-ee,Se=X-ae;return he*he+Se*Se}Ze.exports=Wt,Ze.exports.fromVectorTileJs=Wt,Ze.exports.fromGeojsonVt=function(le,X){X=X||{};var ee={};for(var ae in le)ee[ae]=new Nt(le[ae].features,X),ee[ae].name=ae,ee[ae].version=X.version,ee[ae].extent=X.extent;return Wt({layers:ee})},Ze.exports.GeoJSONWrapper=Nt;const Fo=le=>le[0],Xr=le=>le[1];class uo{constructor(X,ee=Fo,ae=Xr,he=64,Se=Float64Array){this.nodeSize=he,this.points=X;const qe=X.length<65536?Uint16Array:Uint32Array,De=this.ids=new qe(X.length),Ue=this.coords=new Se(2*X.length);for(let it=0;it<X.length;it++)De[it]=it,Ue[2*it]=ee(X[it]),Ue[2*it+1]=ae(X[it]);Er(De,Ue,he,0,De.length-1,0)}range(X,ee,ae,he){return function(Se,qe,De,Ue,it,xt,Bt){const It=[0,Se.length-1,0],Ci=[];let ri,xi;for(;It.length;){const Gi=It.pop(),_n=It.pop(),Zn=It.pop();if(_n-Zn<=Bt){for(let Gn=Zn;Gn<=_n;Gn++)ri=qe[2*Gn],xi=qe[2*Gn+1],ri>=De&&ri<=it&&xi>=Ue&&xi<=xt&&Ci.push(Se[Gn]);continue}const xn=Math.floor((Zn+_n)/2);ri=qe[2*xn],xi=qe[2*xn+1],ri>=De&&ri<=it&&xi>=Ue&&xi<=xt&&Ci.push(Se[xn]);const Mt=(Gi+1)%2;(Gi===0?De<=ri:Ue<=xi)&&(It.push(Zn),It.push(xn-1),It.push(Mt)),(Gi===0?it>=ri:xt>=xi)&&(It.push(xn+1),It.push(_n),It.push(Mt))}return Ci}(this.ids,this.coords,X,ee,ae,he,this.nodeSize)}within(X,ee,ae){return function(he,Se,qe,De,Ue,it){const xt=[0,he.length-1,0],Bt=[],It=Ue*Ue;for(;xt.length;){const Ci=xt.pop(),ri=xt.pop(),xi=xt.pop();if(ri-xi<=it){for(let Mt=xi;Mt<=ri;Mt++)vr(Se[2*Mt],Se[2*Mt+1],qe,De)<=It&&Bt.push(he[Mt]);continue}const Gi=Math.floor((xi+ri)/2),_n=Se[2*Gi],Zn=Se[2*Gi+1];vr(_n,Zn,qe,De)<=It&&Bt.push(he[Gi]);const xn=(Ci+1)%2;(Ci===0?qe-Ue<=_n:De-Ue<=Zn)&&(xt.push(xi),xt.push(Gi-1),xt.push(xn)),(Ci===0?qe+Ue>=_n:De+Ue>=Zn)&&(xt.push(Gi+1),xt.push(ri),xt.push(xn))}return Bt}(this.ids,this.coords,X,ee,ae,this.nodeSize)}}const ks={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},at=Math.fround||(bt=new Float32Array(1),le=>(bt[0]=+le,bt[0]));var bt;class Ft{constructor(X){this.options=tn(Object.create(ks),X),this.trees=new Array(this.options.maxZoom+1)}load(X){const{log:ee,minZoom:ae,maxZoom:he,nodeSize:Se}=this.options;ee&&console.time("total time");const qe=`prepare ${X.length} points`;ee&&console.time(qe),this.points=X;let De=[];for(let Ue=0;Ue<X.length;Ue++)X[Ue].geometry&&De.push(gi(X[Ue],Ue));this.trees[he+1]=new uo(De,on,hn,Se,Float32Array),ee&&console.timeEnd(qe);for(let Ue=he;Ue>=ae;Ue--){const it=+Date.now();De=this._cluster(De,Ue),this.trees[Ue]=new uo(De,on,hn,Se,Float32Array),ee&&console.log("z%d: %d clusters in %dms",Ue,De.length,+Date.now()-it)}return ee&&console.timeEnd("total time"),this}getClusters(X,ee){let ae=((X[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,X[1]));let Se=X[2]===180?180:((X[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ae=-180,Se=180;else if(ae>Se){const xt=this.getClusters([ae,he,180,qe],ee),Bt=this.getClusters([-180,he,Se,qe],ee);return xt.concat(Bt)}const De=this.trees[this._limitZoom(ee)],Ue=De.range(ci(ae),Pi(qe),ci(Se),Pi(he)),it=[];for(const xt of Ue){const Bt=De.points[xt];it.push(Bt.numPoints?Mi(Bt):this.points[Bt.index])}return it}getChildren(X){const ee=this._getOriginId(X),ae=this._getOriginZoom(X),he="No cluster with the specified id.",Se=this.trees[ae];if(!Se)throw new Error(he);const qe=Se.points[ee];if(!qe)throw new Error(he);const De=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Ue=Se.within(qe.x,qe.y,De),it=[];for(const xt of Ue){const Bt=Se.points[xt];Bt.parentId===X&&it.push(Bt.numPoints?Mi(Bt):this.points[Bt.index])}if(it.length===0)throw new Error(he);return it}getLeaves(X,ee,ae){const he=[];return this._appendLeaves(he,X,ee=ee||10,ae=ae||0,0),he}getTile(X,ee,ae){const he=this.trees[this._limitZoom(X)],Se=Math.pow(2,X),{extent:qe,radius:De}=this.options,Ue=De/qe,it=(ae-Ue)/Se,xt=(ae+1+Ue)/Se,Bt={features:[]};return this._addTileFeatures(he.range((ee-Ue)/Se,it,(ee+1+Ue)/Se,xt),he.points,ee,ae,Se,Bt),ee===0&&this._addTileFeatures(he.range(1-Ue/Se,it,1,xt),he.points,Se,ae,Se,Bt),ee===Se-1&&this._addTileFeatures(he.range(0,it,Ue/Se,xt),he.points,-1,ae,Se,Bt),Bt.features.length?Bt:null}getClusterExpansionZoom(X){let ee=this._getOriginZoom(X)-1;for(;ee<=this.options.maxZoom;){const ae=this.getChildren(X);if(ee++,ae.length!==1)break;X=ae[0].properties.cluster_id}return ee}_appendLeaves(X,ee,ae,he,Se){const qe=this.getChildren(ee);for(const De of qe){const Ue=De.properties;if(Ue&&Ue.cluster?Se+Ue.point_count<=he?Se+=Ue.point_count:Se=this._appendLeaves(X,Ue.cluster_id,ae,he,Se):Se<he?Se++:X.push(De),X.length===ae)break}return Se}_addTileFeatures(X,ee,ae,he,Se,qe){for(const De of X){const Ue=ee[De],it=Ue.numPoints;let xt,Bt,It;if(it)xt=Ki(Ue),Bt=Ue.x,It=Ue.y;else{const xi=this.points[Ue.index];xt=xi.properties,Bt=ci(xi.geometry.coordinates[0]),It=Pi(xi.geometry.coordinates[1])}const Ci={type:1,geometry:[[Math.round(this.options.extent*(Bt*Se-ae)),Math.round(this.options.extent*(It*Se-he))]],tags:xt};let ri;it?ri=Ue.id:this.options.generateId?ri=Ue.index:this.points[Ue.index].id&&(ri=this.points[Ue.index].id),ri!==void 0&&(Ci.id=ri),qe.features.push(Ci)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,ee){const ae=[],{radius:he,extent:Se,reduce:qe,minPoints:De}=this.options,Ue=he/(Se*Math.pow(2,ee));for(let it=0;it<X.length;it++){const xt=X[it];if(xt.zoom<=ee)continue;xt.zoom=ee;const Bt=this.trees[ee+1],It=Bt.within(xt.x,xt.y,Ue),Ci=xt.numPoints||1;let ri=Ci;for(const xi of It){const Gi=Bt.points[xi];Gi.zoom>ee&&(ri+=Gi.numPoints||1)}if(ri>Ci&&ri>=De){let xi=xt.x*Ci,Gi=xt.y*Ci,_n=qe&&Ci>1?this._map(xt,!0):null;const Zn=(it<<5)+(ee+1)+this.points.length;for(const xn of It){const Mt=Bt.points[xn];if(Mt.zoom<=ee)continue;Mt.zoom=ee;const Gn=Mt.numPoints||1;xi+=Mt.x*Gn,Gi+=Mt.y*Gn,Mt.parentId=Zn,qe&&(_n||(_n=this._map(xt,!0)),qe(_n,this._map(Mt)))}xt.parentId=Zn,ae.push(fi(xi/ri,Gi/ri,Zn,ri,_n))}else if(ae.push(xt),ri>1)for(const xi of It){const Gi=Bt.points[xi];Gi.zoom<=ee||(Gi.zoom=ee,ae.push(Gi))}}return ae}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,ee){if(X.numPoints)return ee?tn({},X.properties):X.properties;const ae=this.points[X.index].properties,he=this.options.map(ae);return ee&&he===ae?tn({},he):he}}function fi(le,X,ee,ae,he){return{x:at(le),y:at(X),zoom:1/0,id:ee,parentId:-1,numPoints:ae,properties:he}}function gi(le,X){const[ee,ae]=le.geometry.coordinates;return{x:at(ci(ee)),y:at(Pi(ae)),zoom:1/0,index:X,parentId:-1}}function Mi(le){return{type:"Feature",id:le.id,properties:Ki(le),geometry:{type:"Point",coordinates:[(X=le.x,360*(X-.5)),Si(le.y)]}};var X}function Ki(le){const X=le.numPoints,ee=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X;return tn(tn({},le.properties),{cluster:!0,cluster_id:le.id,point_count:X,point_count_abbreviated:ee})}function ci(le){return le/360+.5}function Pi(le){const X=Math.sin(le*Math.PI/180),ee=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ee<0?0:ee>1?1:ee}function Si(le){const X=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function tn(le,X){for(const ee in X)le[ee]=X[ee];return le}function on(le){return le.x}function hn(le){return le.y}function Tn(le,X,ee,ae){for(var he,Se=ae,qe=ee-X>>1,De=ee-X,Ue=le[X],it=le[X+1],xt=le[ee],Bt=le[ee+1],It=X+3;It<ee;It+=3){var Ci=On(le[It],le[It+1],Ue,it,xt,Bt);if(Ci>Se)he=It,Se=Ci;else if(Ci===Se){var ri=Math.abs(It-qe);ri<De&&(he=It,De=ri)}}Se>ae&&(he-X>3&&Tn(le,X,he,ae),le[he+2]=Se,ee-he>3&&Tn(le,he,ee,ae))}function On(le,X,ee,ae,he,Se){var qe=he-ee,De=Se-ae;if(qe!==0||De!==0){var Ue=((le-ee)*qe+(X-ae)*De)/(qe*qe+De*De);Ue>1?(ee=he,ae=Se):Ue>0&&(ee+=qe*Ue,ae+=De*Ue)}return(qe=le-ee)*qe+(De=X-ae)*De}function qn(le,X,ee,ae){var he={id:le===void 0?null:le,type:X,geometry:ee,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Se){var qe=Se.geometry,De=Se.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ot(Se,qe);else if(De==="Polygon"||De==="MultiLineString")for(var Ue=0;Ue<qe.length;Ue++)Ot(Se,qe[Ue]);else if(De==="MultiPolygon")for(Ue=0;Ue<qe.length;Ue++)for(var it=0;it<qe[Ue].length;it++)Ot(Se,qe[Ue][it])}(he),he}function Ot(le,X){for(var ee=0;ee<X.length;ee+=3)le.minX=Math.min(le.minX,X[ee]),le.minY=Math.min(le.minY,X[ee+1]),le.maxX=Math.max(le.maxX,X[ee]),le.maxY=Math.max(le.maxY,X[ee+1])}function yi(le,X,ee,ae){if(X.geometry){var he=X.geometry.coordinates,Se=X.geometry.type,qe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2),De=[],Ue=X.id;if(ee.promoteId?Ue=X.properties[ee.promoteId]:ee.generateId&&(Ue=ae||0),Se==="Point")Pr(he,De);else if(Se==="MultiPoint")for(var it=0;it<he.length;it++)Pr(he[it],De);else if(Se==="LineString")Eo(he,De,qe,!1);else if(Se==="MultiLineString"){if(ee.lineMetrics){for(it=0;it<he.length;it++)Eo(he[it],De=[],qe,!1),le.push(qn(Ue,"LineString",De,X.properties));return}jn(he,De,qe,!1)}else if(Se==="Polygon")jn(he,De,qe,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(it=0;it<X.geometry.geometries.length;it++)yi(le,{id:Ue,geometry:X.geometry.geometries[it],properties:X.properties},ee,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(it=0;it<he.length;it++){var xt=[];jn(he[it],xt,qe,!0),De.push(xt)}}le.push(qn(Ue,Se,De,X.properties))}}function Pr(le,X){X.push(ro(le[0])),X.push(_o(le[1])),X.push(0)}function Eo(le,X,ee,ae){for(var he,Se,qe=0,De=0;De<le.length;De++){var Ue=ro(le[De][0]),it=_o(le[De][1]);X.push(Ue),X.push(it),X.push(0),De>0&&(qe+=ae?(he*it-Ue*Se)/2:Math.sqrt(Math.pow(Ue-he,2)+Math.pow(it-Se,2))),he=Ue,Se=it}var xt=X.length-3;X[2]=1,Tn(X,0,xt,ee),X[xt+2]=1,X.size=Math.abs(qe),X.start=0,X.end=X.size}function jn(le,X,ee,ae){for(var he=0;he<le.length;he++){var Se=[];Eo(le[he],Se,ee,ae),X.push(Se)}}function ro(le){return le/360+.5}function _o(le){var X=Math.sin(le*Math.PI/180),ee=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ee<0?0:ee>1?1:ee}function zr(le,X,ee,ae,he,Se,qe,De){if(ae/=X,Se>=(ee/=X)&&qe<ae)return le;if(qe<ee||Se>=ae)return null;for(var Ue=[],it=0;it<le.length;it++){var xt=le[it],Bt=xt.geometry,It=xt.type,Ci=he===0?xt.minX:xt.minY,ri=he===0?xt.maxX:xt.maxY;if(Ci>=ee&&ri<ae)Ue.push(xt);else if(!(ri<ee||Ci>=ae)){var xi=[];if(It==="Point"||It==="MultiPoint")So(Bt,xi,ee,ae,he);else if(It==="LineString")zi(Bt,xi,ee,ae,he,!1,De.lineMetrics);else if(It==="MultiLineString")Dn(Bt,xi,ee,ae,he,!1);else if(It==="Polygon")Dn(Bt,xi,ee,ae,he,!0);else if(It==="MultiPolygon")for(var Gi=0;Gi<Bt.length;Gi++){var _n=[];Dn(Bt[Gi],_n,ee,ae,he,!0),_n.length&&xi.push(_n)}if(xi.length){if(De.lineMetrics&&It==="LineString"){for(Gi=0;Gi<xi.length;Gi++)Ue.push(qn(xt.id,It,xi[Gi],xt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(xi.length===1?(It="LineString",xi=xi[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=xi.length===3?"Point":"MultiPoint"),Ue.push(qn(xt.id,It,xi,xt.tags))}}}return Ue.length?Ue:null}function So(le,X,ee,ae,he){for(var Se=0;Se<le.length;Se+=3){var qe=le[Se+he];qe>=ee&&qe<=ae&&(X.push(le[Se]),X.push(le[Se+1]),X.push(le[Se+2]))}}function zi(le,X,ee,ae,he,Se,qe){for(var De,Ue,it=Ln(le),xt=he===0?is:kn,Bt=le.start,It=0;It<le.length-3;It+=3){var Ci=le[It],ri=le[It+1],xi=le[It+2],Gi=le[It+3],_n=le[It+4],Zn=he===0?Ci:ri,xn=he===0?Gi:_n,Mt=!1;qe&&(De=Math.sqrt(Math.pow(Ci-Gi,2)+Math.pow(ri-_n,2))),Zn<ee?xn>ee&&(Ue=xt(it,Ci,ri,Gi,_n,ee),qe&&(it.start=Bt+De*Ue)):Zn>ae?xn<ae&&(Ue=xt(it,Ci,ri,Gi,_n,ae),qe&&(it.start=Bt+De*Ue)):Co(it,Ci,ri,xi),xn<ee&&Zn>=ee&&(Ue=xt(it,Ci,ri,Gi,_n,ee),Mt=!0),xn>ae&&Zn<=ae&&(Ue=xt(it,Ci,ri,Gi,_n,ae),Mt=!0),!Se&&Mt&&(qe&&(it.end=Bt+De*Ue),X.push(it),it=Ln(le)),qe&&(Bt+=De)}var Gn=le.length-3;Ci=le[Gn],ri=le[Gn+1],xi=le[Gn+2],(Zn=he===0?Ci:ri)>=ee&&Zn<=ae&&Co(it,Ci,ri,xi),Gn=it.length-3,Se&&Gn>=3&&(it[Gn]!==it[0]||it[Gn+1]!==it[1])&&Co(it,it[0],it[1],it[2]),it.length&&X.push(it)}function Ln(le){var X=[];return X.size=le.size,X.start=le.start,X.end=le.end,X}function Dn(le,X,ee,ae,he,Se){for(var qe=0;qe<le.length;qe++)zi(le[qe],X,ee,ae,he,Se,!1)}function Co(le,X,ee,ae){le.push(X),le.push(ee),le.push(ae)}function is(le,X,ee,ae,he,Se){var qe=(Se-X)/(ae-X);return le.push(Se),le.push(ee+(he-ee)*qe),le.push(1),qe}function kn(le,X,ee,ae,he,Se){var qe=(Se-ee)/(he-ee);return le.push(X+(ae-X)*qe),le.push(Se),le.push(1),qe}function sa(le,X){for(var ee=[],ae=0;ae<le.length;ae++){var he,Se=le[ae],qe=Se.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")he=yo(Se.geometry,X);else if(qe==="MultiLineString"||qe==="Polygon"){he=[];for(var De=0;De<Se.geometry.length;De++)he.push(yo(Se.geometry[De],X))}else if(qe==="MultiPolygon")for(he=[],De=0;De<Se.geometry.length;De++){for(var Ue=[],it=0;it<Se.geometry[De].length;it++)Ue.push(yo(Se.geometry[De][it],X));he.push(Ue)}ee.push(qn(Se.id,qe,he,Se.tags))}return ee}function yo(le,X){var ee=[];ee.size=le.size,le.start!==void 0&&(ee.start=le.start,ee.end=le.end);for(var ae=0;ae<le.length;ae+=3)ee.push(le[ae]+X,le[ae+1],le[ae+2]);return ee}function aa(le,X){if(le.transformed)return le;var ee,ae,he,Se=1<<le.z,qe=le.x,De=le.y;for(ee=0;ee<le.features.length;ee++){var Ue=le.features[ee],it=Ue.geometry,xt=Ue.type;if(Ue.geometry=[],xt===1)for(ae=0;ae<it.length;ae+=2)Ue.geometry.push(oo(it[ae],it[ae+1],X,Se,qe,De));else for(ae=0;ae<it.length;ae++){var Bt=[];for(he=0;he<it[ae].length;he+=2)Bt.push(oo(it[ae][he],it[ae][he+1],X,Se,qe,De));Ue.geometry.push(Bt)}}return le.transformed=!0,le}function oo(le,X,ee,ae,he,Se){return[Math.round(ee*(le*ae-he)),Math.round(ee*(X*ae-Se))]}function so(le,X,ee,ae,he){for(var Se=X===he.maxZoom?0:he.tolerance/((1<<X)*he.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ee,y:ae,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},De=0;De<le.length;De++){qe.numFeatures++,pr(qe,le[De],Se,he);var Ue=le[De].minX,it=le[De].minY,xt=le[De].maxX,Bt=le[De].maxY;Ue<qe.minX&&(qe.minX=Ue),it<qe.minY&&(qe.minY=it),xt>qe.maxX&&(qe.maxX=xt),Bt>qe.maxY&&(qe.maxY=Bt)}return qe}function pr(le,X,ee,ae){var he=X.geometry,Se=X.type,qe=[];if(Se==="Point"||Se==="MultiPoint")for(var De=0;De<he.length;De+=3)qe.push(he[De]),qe.push(he[De+1]),le.numPoints++,le.numSimplified++;else if(Se==="LineString")La(qe,he,le,ee,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(De=0;De<he.length;De++)La(qe,he[De],le,ee,Se==="Polygon",De===0);else if(Se==="MultiPolygon")for(var Ue=0;Ue<he.length;Ue++){var it=he[Ue];for(De=0;De<it.length;De++)La(qe,it[De],le,ee,!0,De===0)}if(qe.length){var xt=X.tags||null;if(Se==="LineString"&&ae.lineMetrics){for(var Bt in xt={},X.tags)xt[Bt]=X.tags[Bt];xt.mapbox_clip_start=he.start/he.size,xt.mapbox_clip_end=he.end/he.size}var It={geometry:qe,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:xt};X.id!==null&&(It.id=X.id),le.features.push(It)}}function La(le,X,ee,ae,he,Se){var qe=ae*ae;if(ae>0&&X.size<(he?qe:ae))ee.numPoints+=X.length/3;else{for(var De=[],Ue=0;Ue<X.length;Ue+=3)(ae===0||X[Ue+2]>qe)&&(ee.numSimplified++,De.push(X[Ue]),De.push(X[Ue+1])),ee.numPoints++;he&&function(it,xt){for(var Bt=0,It=0,Ci=it.length,ri=Ci-2;It<Ci;ri=It,It+=2)Bt+=(it[It]-it[ri])*(it[It+1]+it[ri+1]);if(Bt>0===xt)for(It=0,Ci=it.length;It<Ci/2;It+=2){var xi=it[It],Gi=it[It+1];it[It]=it[Ci-2-It],it[It+1]=it[Ci-1-It],it[Ci-2-It]=xi,it[Ci-1-It]=Gi}}(De,Se),le.push(De)}}function Ve(le,X){var ee=(X=this.options=function(he,Se){for(var qe in Se)he[qe]=Se[qe];return he}(Object.create(this.options),X)).debug;if(ee&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var ae=function(he,Se){var qe=[];if(he.type==="FeatureCollection")for(var De=0;De<he.features.length;De++)yi(qe,he.features[De],Se,De);else yi(qe,he.type==="Feature"?he:{geometry:he},Se);return qe}(le,X);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(he,Se){var qe=Se.buffer/Se.extent,De=he,Ue=zr(he,1,-1-qe,qe,0,-1,2,Se),it=zr(he,1,1-qe,2+qe,0,-1,2,Se);return(Ue||it)&&(De=zr(he,1,-qe,1+qe,0,-1,2,Se)||[],Ue&&(De=sa(Ue,1).concat(De)),it&&(De=De.concat(sa(it,-1)))),De}(ae,X),ae.length&&this.splitTile(ae,0,0,0),ee&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fe(le,X,ee){return 32*((1<<le)*ee+X)+le}function ve(le,X){const ee=le.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const ae=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!ae)return X(null,null);const he=new Ye(ae.features);let Se=Ze.exports(he);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),X(null,{vectorTile:he,rawData:Se.buffer})}Ve.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ve.prototype.splitTile=function(le,X,ee,ae,he,Se,qe){for(var De=[le,X,ee,ae],Ue=this.options,it=Ue.debug;De.length;){ae=De.pop(),ee=De.pop(),X=De.pop(),le=De.pop();var xt=1<<X,Bt=fe(X,ee,ae),It=this.tiles[Bt];if(!It&&(it>1&&console.time("creation"),It=this.tiles[Bt]=so(le,X,ee,ae,Ue),this.tileCoords.push({z:X,x:ee,y:ae}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ee,ae,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));var Ci="z"+X;this.stats[Ci]=(this.stats[Ci]||0)+1,this.total++}if(It.source=le,he){if(X===Ue.maxZoom||X===he)continue;var ri=1<<he-X;if(ee!==Math.floor(Se/ri)||ae!==Math.floor(qe/ri))continue}else if(X===Ue.indexMaxZoom||It.numPoints<=Ue.indexMaxPoints)continue;if(It.source=null,le.length!==0){it>1&&console.time("clipping");var xi,Gi,_n,Zn,xn,Mt,Gn=.5*Ue.buffer/Ue.extent,Fn=.5-Gn,Qr=.5+Gn,ao=1+Gn;xi=Gi=_n=Zn=null,xn=zr(le,xt,ee-Gn,ee+Qr,0,It.minX,It.maxX,Ue),Mt=zr(le,xt,ee+Fn,ee+ao,0,It.minX,It.maxX,Ue),le=null,xn&&(xi=zr(xn,xt,ae-Gn,ae+Qr,1,It.minY,It.maxY,Ue),Gi=zr(xn,xt,ae+Fn,ae+ao,1,It.minY,It.maxY,Ue),xn=null),Mt&&(_n=zr(Mt,xt,ae-Gn,ae+Qr,1,It.minY,It.maxY,Ue),Zn=zr(Mt,xt,ae+Fn,ae+ao,1,It.minY,It.maxY,Ue),Mt=null),it>1&&console.timeEnd("clipping"),De.push(xi||[],X+1,2*ee,2*ae),De.push(Gi||[],X+1,2*ee,2*ae+1),De.push(_n||[],X+1,2*ee+1,2*ae),De.push(Zn||[],X+1,2*ee+1,2*ae+1)}}},Ve.prototype.getTile=function(le,X,ee){var ae=this.options,he=ae.extent,Se=ae.debug;if(le<0||le>24)return null;var qe=1<<le,De=fe(le,X=(X%qe+qe)%qe,ee);if(this.tiles[De])return aa(this.tiles[De],he);Se>1&&console.log("drilling down to z%d-%d-%d",le,X,ee);for(var Ue,it=le,xt=X,Bt=ee;!Ue&&it>0;)it--,xt=Math.floor(xt/2),Bt=Math.floor(Bt/2),Ue=this.tiles[fe(it,xt,Bt)];return Ue&&Ue.source?(Se>1&&console.log("found parent tile z%d-%d-%d",it,xt,Bt),Se>1&&console.time("drilling down"),this.splitTile(Ue.source,it,xt,Bt,le,X,ee),Se>1&&console.timeEnd("drilling down"),this.tiles[De]?aa(this.tiles[De],he):null):null};class Oe extends we{constructor(X,ee,ae,he){super(X,ee,ae,ve),he&&(this.loadGeoJSON=he)}loadData(X,ee){var ae;(ae=this._pendingRequest)===null||ae===void 0||ae.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const he=!!(X&&X.request&&X.request.collectResourceTiming)&&new i.RequestPerformance(X.request);this._pendingCallback=ee,this._pendingRequest=this.loadGeoJSON(X,(Se,qe)=>{if(delete this._pendingCallback,delete this._pendingRequest,Se||!qe)return ee(Se);if(typeof qe!="object")return ee(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{$e(qe,!0);try{if(X.filter){const Ue=i.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(xt=>`${xt.key}: ${xt.message}`).join(", "));qe={type:"FeatureCollection",features:qe.features.filter(xt=>Ue.value.evaluate({zoom:0},xt))}}this._geoJSONIndex=X.cluster?new Ft(function({superclusterOptions:Ue,clusterProperties:it}){if(!it||!Ue)return Ue;const xt={},Bt={},It={accumulated:null,zoom:0},Ci={properties:null},ri=Object.keys(it);for(const xi of ri){const[Gi,_n]=it[xi],Zn=i.createExpression(_n),xn=i.createExpression(typeof Gi=="string"?[Gi,["accumulated"],["get",xi]]:Gi);xt[xi]=Zn.value,Bt[xi]=xn.value}return Ue.map=xi=>{Ci.properties=xi;const Gi={};for(const _n of ri)Gi[_n]=xt[_n].evaluate(It,Ci);return Gi},Ue.reduce=(xi,Gi)=>{Ci.properties=Gi;for(const _n of ri)It.accumulated=xi[_n],xi[_n]=Bt[_n].evaluate(It,Ci)},Ue}(X)).load(qe.features):function(Ue,it){return new Ve(Ue,it)}(qe,X.geojsonVtOptions)}catch(Ue){return ee(Ue)}this.loaded={};const De={};if(he){const Ue=he.finish();Ue&&(De.resourceTiming={},De.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ue)))}ee(null,De)}})}reloadTile(X,ee){const ae=this.loaded;return ae&&ae[X.uid]?super.reloadTile(X,ee):this.loadTile(X,ee)}loadGeoJSON(X,ee){if(X.request)return i.getJSON(X.request,ee);if(typeof X.data=="string")try{ee(null,JSON.parse(X.data))}catch{ee(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}else ee(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(X,ee){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ee()}getClusterExpansionZoom(X,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(ae){ee(ae)}}getClusterChildren(X,ee){try{ee(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(ae){ee(ae)}}getClusterLeaves(X,ee){try{ee(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(ae){ee(ae)}}}class Je{constructor(X){this.self=X,this.actor=new i.Actor(X,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:Oe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ee,ae)=>{if(this.workerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.workerSourceTypes[ee]=ae},this.self.registerRTLTextPlugin=ee=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=ee.applyArabicShaping,i.plugin.processBidirectionalText=ee.processBidirectionalText,i.plugin.processStyledBidirectionalText=ee.processStyledBidirectionalText}}setReferrer(X,ee){this.referrer=ee}setImages(X,ee,ae){this.availableImages[X]=ee;for(const he in this.workerSources[X]){const Se=this.workerSources[X][he];for(const qe in Se)Se[qe].availableImages=ee}ae()}setLayers(X,ee,ae){this.getLayerIndex(X).replace(ee),ae()}updateLayers(X,ee,ae){this.getLayerIndex(X).update(ee.layers,ee.removedIds),ae()}loadTile(X,ee,ae){this.getWorkerSource(X,ee.type,ee.source).loadTile(ee,ae)}loadDEMTile(X,ee,ae){this.getDEMWorkerSource(X,ee.source).loadTile(ee,ae)}reloadTile(X,ee,ae){this.getWorkerSource(X,ee.type,ee.source).reloadTile(ee,ae)}abortTile(X,ee,ae){this.getWorkerSource(X,ee.type,ee.source).abortTile(ee,ae)}removeTile(X,ee,ae){this.getWorkerSource(X,ee.type,ee.source).removeTile(ee,ae)}removeDEMTile(X,ee){this.getDEMWorkerSource(X,ee.source).removeTile(ee)}removeSource(X,ee,ae){if(!this.workerSources[X]||!this.workerSources[X][ee.type]||!this.workerSources[X][ee.type][ee.source])return;const he=this.workerSources[X][ee.type][ee.source];delete this.workerSources[X][ee.type][ee.source],he.removeSource!==void 0?he.removeSource(ee,ae):ae()}loadWorkerSource(X,ee,ae){try{this.self.importScripts(ee.url),ae()}catch(he){ae(he.toString())}}syncRTLPluginState(X,ee,ae){try{i.plugin.setState(ee);const he=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&he!=null){this.self.importScripts(he);const Se=i.plugin.isParsed();ae(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),Se)}}catch(he){ae(he.toString())}}getAvailableImages(X){let ee=this.availableImages[X];return ee||(ee=[]),ee}getLayerIndex(X){let ee=this.layerIndexes[X];return ee||(ee=this.layerIndexes[X]=new K),ee}getWorkerSource(X,ee,ae){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][ee]||(this.workerSources[X][ee]={}),!this.workerSources[X][ee][ae]){const he={send:(Se,qe,De)=>{this.actor.send(Se,qe,De,X)}};this.workerSources[X][ee][ae]=new this.workerSourceTypes[ee](he,this.getLayerIndex(X),this.getAvailableImages(X))}return this.workerSources[X][ee][ae]}getDEMWorkerSource(X,ee){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][ee]||(this.demWorkerSources[X][ee]=new je),this.demWorkerSources[X][ee]}enforceCacheSizeLimit(X,ee){i.enforceCacheSizeLimit(ee)}}return i.isWorker()&&(self.worker=new Je(self)),Je}),E(["./shared"],function(i){var F=j;function j(C){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,A,L=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(L);try{A=new Worker(N),T=!0}catch{T=!1}return A&&A.terminate(),URL.revokeObjectURL(N),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var A=T.getContext("2d");if(!A)return!1;var L=A.getImageData(0,0,1,1);return L&&L.width===T.width}()?(K[m=a&&a.failIfMajorPerformanceCaveat]===void 0&&(K[m]=function(T){var A,L=function(N){var H=document.createElement("canvas"),Q=Object.create(j.webGLContextAttributes);return Q.failIfMajorPerformanceCaveat=N,H.getContext("webgl",Q)||H.getContext("experimental-webgl",Q)}(T);if(!L)return!1;try{A=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!A||L.isContextLost())&&(L.shaderSource(A,"void main() {}"),L.compileShader(A),L.getShaderParameter(A,L.COMPILE_STATUS)===!0)}(m)),K[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var m}(C)}var K={};function Y(C,a){if(Array.isArray(C)){if(!Array.isArray(a)||C.length!==a.length)return!1;for(let m=0;m<C.length;m++)if(!Y(C[m],a[m]))return!1;return!0}if(typeof C=="object"&&C!==null&&a!==null){if(typeof a!="object"||Object.keys(C).length!==Object.keys(a).length)return!1;for(const m in C)if(!Y(C[m],a[m]))return!1;return!0}return C===a}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class q{static testProp(a){if(!q.docStyle)return a[0];for(let m=0;m<a.length;m++)if(a[m]in q.docStyle)return a[m];return a[0]}static create(a,m,T){const A=window.document.createElement(a);return m!==void 0&&(A.className=m),T&&T.appendChild(A),A}static createNS(a,m){return window.document.createElementNS(a,m)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(a,m){a.style[q.transformProp]=m}static addEventListener(a,m,T,A={}){a.addEventListener(m,T,"passive"in A?A:A.capture)}static removeEventListener(a,m,T,A={}){a.removeEventListener(m,T,"passive"in A?A:A.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static mousePos(a,m){const T=a.getBoundingClientRect();return new i.pointGeometry(m.clientX-T.left-a.clientLeft,m.clientY-T.top-a.clientTop)}static touchPos(a,m){const T=a.getBoundingClientRect(),A=[];for(let L=0;L<m.length;L++)A.push(new i.pointGeometry(m[L].clientX-T.left-a.clientLeft,m[L].clientY-T.top-a.clientTop));return A}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);class re{constructor(a){this._transformRequestFn=a}transformRequest(a,m){return this._transformRequestFn&&this._transformRequestFn(a,m)||{url:a}}normalizeSpriteURL(a,m,T){const A=function(L){const N=L.match(me);if(!N)throw new Error(`Unable to parse URL "${L}"`);return{protocol:N[1],authority:N[2],path:N[3]||"/",params:N[4]?N[4].split("&"):[]}}(a);return A.path+=`${m}${T}`,function(L){const N=L.params.length?`?${L.params.join("&")}`:"";return`${L.protocol}://${L.authority}${L.path}${N}`}(A)}setTransformRequest(a){this._transformRequestFn=a}}const me=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class we{constructor(a,m,T,A){this.context=a,this.format=T,this.texture=a.gl.createTexture(),this.update(m,A)}update(a,m,T){const{width:A,height:L}=a,N=!(this.size&&this.size[0]===A&&this.size[1]===L||T),{context:H}=this,{gl:Q}=H;if(this.useMipmap=Boolean(m&&m.useMipmap),Q.bindTexture(Q.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===Q.RGBA&&(!m||m.premultiply!==!1)),N)this.size=[A,L],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||i.isImageBitmap(a)?Q.texImage2D(Q.TEXTURE_2D,0,this.format,this.format,Q.UNSIGNED_BYTE,a):Q.texImage2D(Q.TEXTURE_2D,0,this.format,A,L,0,this.format,Q.UNSIGNED_BYTE,a.data);else{const{x:se,y:pe}=T||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||i.isImageBitmap(a)?Q.texSubImage2D(Q.TEXTURE_2D,0,se,pe,Q.RGBA,Q.UNSIGNED_BYTE,a):Q.texSubImage2D(Q.TEXTURE_2D,0,se,pe,A,L,Q.RGBA,Q.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Q.generateMipmap(Q.TEXTURE_2D)}bind(a,m,T){const{context:A}=this,{gl:L}=A;L.bindTexture(L.TEXTURE_2D,this.texture),T!==L.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(T=L.LINEAR),a!==this.filter&&(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,a),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,T||a),this.filter=a),m!==this.wrap&&(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,m),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,m),this.wrap=m)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function je(C){const{userImage:a}=C;return!!(a&&a.render&&a.render())&&(C.data.replace(new Uint8Array(a.data.buffer)),!0)}class $e extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:m,callback:T}of this.requestors)this._notify(m,T);this.requestors=[]}}getImage(a){return this.images[a]}addImage(a,m){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,m)&&(this.images[a]=m)}_validate(a,m){let T=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),T=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),T=!1),this._validateContent(m.content,m)||(this.fire(new i.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),T=!1),T}_validateStretch(a,m){if(!a)return!0;let T=0;for(const A of a){if(A[0]<T||A[1]<A[0]||m<A[1])return!1;T=A[1]}return!0}_validateContent(a,m){return!(a&&(a.length!==4||a[0]<0||m.data.width<a[0]||a[1]<0||m.data.height<a[1]||a[2]<0||m.data.width<a[2]||a[3]<0||m.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,m){const T=this.images[a];if(T.data.width!==m.data.width||T.data.height!==m.data.height)throw new Error(`size mismatch between old image (${T.data.width}x${T.data.height}) and new image (${m.data.width}x${m.data.height}).`);m.version=T.version+1,this.images[a]=m,this.updatedImages[a]=!0}removeImage(a){const m=this.images[a];delete this.images[a],delete this.patterns[a],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,m){let T=!0;if(!this.isLoaded())for(const A of a)this.images[A]||(T=!1);this.isLoaded()||T?this._notify(a,m):this.requestors.push({ids:a,callback:m})}_notify(a,m){const T={};for(const A of a){this.images[A]||this.fire(new i.Event("styleimagemissing",{id:A}));const L=this.images[A];L?T[A]={data:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:Boolean(L.userImage&&L.userImage.render)}:i.warnOnce(`Image "${A}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,T)}getPixelSize(){const{width:a,height:m}=this.atlasImage;return{width:a,height:m}}getPattern(a){const m=this.patterns[a],T=this.getImage(a);if(!T)return null;if(m&&m.position.version===T.version)return m.position;if(m)m.position.version=T.version;else{const A={w:T.data.width+2,h:T.data.height+2,x:0,y:0},L=new i.ImagePosition(A,T);this.patterns[a]={bin:A,position:L}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const m=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(a,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const L in this.patterns)a.push(this.patterns[L].bin);const{w:m,h:T}=i.potpack(a),A=this.atlasImage;A.resize({width:m||1,height:T||1});for(const L in this.patterns){const{bin:N}=this.patterns[L],H=N.x+1,Q=N.y+1,se=this.images[L].data,pe=se.width,xe=se.height;i.RGBAImage.copy(se,A,{x:0,y:0},{x:H,y:Q},{width:pe,height:xe}),i.RGBAImage.copy(se,A,{x:0,y:xe-1},{x:H,y:Q-1},{width:pe,height:1}),i.RGBAImage.copy(se,A,{x:0,y:0},{x:H,y:Q+xe},{width:pe,height:1}),i.RGBAImage.copy(se,A,{x:pe-1,y:0},{x:H-1,y:Q},{width:1,height:xe}),i.RGBAImage.copy(se,A,{x:0,y:0},{x:H+pe,y:Q},{width:1,height:xe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const m of a){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;const T=this.images[m];T||i.warnOnce(`Image with ID: "${m}" was not found`),je(T)&&this.updateImage(m,T)}}}const tt=1e20;function Ae(C,a,m,T,A,L,N,H,Q){for(let se=a;se<a+T;se++)mt(C,m*L+se,L,A,N,H,Q);for(let se=m;se<m+A;se++)mt(C,se*L+a,1,T,N,H,Q)}function mt(C,a,m,T,A,L,N){L[0]=0,N[0]=-tt,N[1]=tt,A[0]=C[a];for(let H=1,Q=0,se=0;H<T;H++){A[H]=C[a+H*m];const pe=H*H;do{const xe=L[Q];se=(A[H]-A[xe]+pe-xe*xe)/(H-xe)/2}while(se<=N[Q]&&--Q>-1);Q++,L[Q]=H,N[Q]=se,N[Q+1]=tt}for(let H=0,Q=0;H<T;H++){for(;N[Q+1]<H;)Q++;const se=L[Q],pe=H-se;C[a+H*m]=A[se]+pe*pe}}class Me{constructor(a,m){this.requestManager=a,this.localIdeographFontFamily=m,this.entries={}}setURL(a){this.url=a}getGlyphs(a,m){const T=[];for(const A in a)for(const L of a[A])T.push({stack:A,id:L});i.asyncAll(T,({stack:A,id:L},N)=>{let H=this.entries[A];H||(H=this.entries[A]={glyphs:{},requests:{},ranges:{}});let Q=H.glyphs[L];if(Q!==void 0)return void N(null,{stack:A,id:L,glyph:Q});if(Q=this._tinySDF(H,A,L),Q)return H.glyphs[L]=Q,void N(null,{stack:A,id:L,glyph:Q});const se=Math.floor(L/256);if(256*se>65535)return void N(new Error("glyphs > 65535 not supported"));if(H.ranges[se])return void N(null,{stack:A,id:L,glyph:Q});let pe=H.requests[se];pe||(pe=H.requests[se]=[],Me.loadGlyphRange(A,se,this.url,this.requestManager,(xe,Ee)=>{if(Ee){for(const Qe in Ee)this._doesCharSupportLocalGlyph(+Qe)||(H.glyphs[+Qe]=Ee[+Qe]);H.ranges[se]=!0}for(const Qe of pe)Qe(xe,Ee);delete H.requests[se]})),pe.push((xe,Ee)=>{xe?N(xe):Ee&&N(null,{stack:A,id:L,glyph:Ee[L]||null})})},(A,L)=>{if(A)m(A);else if(L){const N={};for(const{stack:H,id:Q,glyph:se}of L)(N[H]||(N[H]={}))[Q]=se&&{id:se.id,bitmap:se.bitmap.clone(),metrics:se.metrics};m(null,N)}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(i.unicodeBlockLookup["CJK Unified Ideographs"](a)||i.unicodeBlockLookup["Hangul Syllables"](a)||i.unicodeBlockLookup.Hiragana(a)||i.unicodeBlockLookup.Katakana(a))}_tinySDF(a,m,T){const A=this.localIdeographFontFamily;if(!A||!this._doesCharSupportLocalGlyph(T))return;let L=a.tinySDF;if(!L){let H="400";/bold/i.test(m)?H="900":/medium/i.test(m)?H="500":/light/i.test(m)&&(H="200"),L=a.tinySDF=new Me.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:A,fontWeight:H})}const N=L.draw(String.fromCharCode(T));return{id:T,bitmap:new i.AlphaImage({width:N.width||30,height:N.height||30},N.data),metrics:{width:N.glyphWidth||24,height:N.glyphHeight||24,left:N.glyphLeft||0,top:N.glyphTop-27||-8,advance:N.glyphAdvance||24}}}}Me.loadGlyphRange=function(C,a,m,T,A){const L=256*a,N=L+255,H=T.transformRequest(m.replace("{fontstack}",C).replace("{range}",`${L}-${N}`),i.ResourceType.Glyphs);i.getArrayBuffer(H,(Q,se)=>{if(Q)A(Q);else if(se){const pe={};for(const xe of i.parseGlyphPbf(se))pe[xe.id]=xe;A(null,pe)}})},Me.TinySDF=class{constructor({fontSize:C=24,buffer:a=3,radius:m=8,cutoff:T=.25,fontFamily:A="sans-serif",fontWeight:L="normal",fontStyle:N="normal"}={}){this.buffer=a,this.cutoff=T,this.radius=m;const H=this.size=C+4*a,Q=this._createCanvas(H),se=this.ctx=Q.getContext("2d",{willReadFrequently:!0});se.font=`${N} ${L} ${C}px ${A}`,se.textBaseline="alphabetic",se.textAlign="left",se.fillStyle="black",this.gridOuter=new Float64Array(H*H),this.gridInner=new Float64Array(H*H),this.f=new Float64Array(H),this.z=new Float64Array(H+1),this.v=new Uint16Array(H)}_createCanvas(C){const a=document.createElement("canvas");return a.width=a.height=C,a}draw(C){const{width:a,actualBoundingBoxAscent:m,actualBoundingBoxDescent:T,actualBoundingBoxLeft:A,actualBoundingBoxRight:L}=this.ctx.measureText(C),N=Math.ceil(m),H=Math.min(this.size-this.buffer,Math.ceil(L-A)),Q=Math.min(this.size-this.buffer,N+Math.ceil(T)),se=H+2*this.buffer,pe=Q+2*this.buffer,xe=Math.max(se*pe,0),Ee=new Uint8ClampedArray(xe),Qe={data:Ee,width:se,height:pe,glyphWidth:H,glyphHeight:Q,glyphTop:N,glyphLeft:0,glyphAdvance:a};if(H===0||Q===0)return Qe;const{ctx:Ge,buffer:We,gridInner:_t,gridOuter:Tt}=this;Ge.clearRect(We,We,H,Q),Ge.fillText(C,We,We+N);const kt=Ge.getImageData(We,We,H,Q);Tt.fill(tt,0,xe),_t.fill(0,0,xe);for(let ot=0;ot<Q;ot++)for(let ft=0;ft<H;ft++){const Rt=kt.data[4*(ot*H+ft)+3]/255;if(Rt===0)continue;const ii=(ot+We)*se+ft+We;if(Rt===1)Tt[ii]=0,_t[ii]=tt;else{const Qt=.5-Rt;Tt[ii]=Qt>0?Qt*Qt:0,_t[ii]=Qt<0?Qt*Qt:0}}Ae(Tt,0,0,se,pe,se,this.f,this.v,this.z),Ae(_t,We,We,H,Q,se,this.f,this.v,this.z);for(let ot=0;ot<xe;ot++){const ft=Math.sqrt(Tt[ot])-Math.sqrt(_t[ot]);Ee[ot]=Math.round(255-255*(ft/this.radius+this.cutoff))}return Qe}};const Ye=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(C,a){return i.sphericalToCartesian(C.expression.evaluate(a))}interpolate(C,a,m){return{x:i.number(C.x,a.x,m),y:i.number(C.y,a.y,m),z:i.number(C.z,a.z,m)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)}),Ze="-transition";class rt extends i.Evented{constructor(a){super(),this._transitionable=new i.Transitionable(Ye),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,m={}){if(!this._validate(i.validateLight,a,m))for(const T in a){const A=a[T];T.endsWith(Ze)?this._transitionable.setTransition(T.slice(0,-Ze.length),A):this._transitionable.setValue(T,A)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,m,T){return(!T||T.validate!==!1)&&i.emitValidationErrors(this,a.call(i.validateStyle,i.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class gt{constructor(a,m){this.width=a,this.height=m,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,m){const T=a.join(",")+String(m);return this.dashEntry[T]||(this.dashEntry[T]=this.addDash(a,m)),this.dashEntry[T]}getDashRanges(a,m,T){const A=[];let L=a.length%2==1?-a[a.length-1]*T:0,N=a[0]*T,H=!0;A.push({left:L,right:N,isDash:H,zeroLength:a[0]===0});let Q=a[0];for(let se=1;se<a.length;se++){H=!H;const pe=a[se];L=Q*T,Q+=pe,N=Q*T,A.push({left:L,right:N,isDash:H,zeroLength:pe===0})}return A}addRoundDash(a,m,T){const A=m/2;for(let L=-T;L<=T;L++){const N=this.width*(this.nextRow+T+L);let H=0,Q=a[H];for(let se=0;se<this.width;se++){se/Q.right>1&&(Q=a[++H]);const pe=Math.abs(se-Q.left),xe=Math.abs(se-Q.right),Ee=Math.min(pe,xe);let Qe;const Ge=L/T*(A+1);if(Q.isDash){const We=A-Math.abs(Ge);Qe=Math.sqrt(Ee*Ee+We*We)}else Qe=A-Math.sqrt(Ee*Ee+Ge*Ge);this.data[N+se]=Math.max(0,Math.min(255,Qe+128))}}}addRegularDash(a){for(let H=a.length-1;H>=0;--H){const Q=a[H],se=a[H+1];Q.zeroLength?a.splice(H,1):se&&se.isDash===Q.isDash&&(se.left=Q.left,a.splice(H,1))}const m=a[0],T=a[a.length-1];m.isDash===T.isDash&&(m.left=T.left-this.width,T.right=m.right+this.width);const A=this.width*this.nextRow;let L=0,N=a[L];for(let H=0;H<this.width;H++){H/N.right>1&&(N=a[++L]);const Q=Math.abs(H-N.left),se=Math.abs(H-N.right),pe=Math.min(Q,se);this.data[A+H]=Math.max(0,Math.min(255,(N.isDash?pe:-pe)+128))}}addDash(a,m){const T=m?7:0,A=2*T+1;if(this.nextRow+A>this.height)return i.warnOnce("LineAtlas out of space"),null;let L=0;for(let H=0;H<a.length;H++)L+=a[H];if(L!==0){const H=this.width/L,Q=this.getDashRanges(a,this.width,H);m?this.addRoundDash(Q,H,T):this.addRegularDash(Q)}const N={y:(this.nextRow+T+.5)/this.height,height:2*T/this.height,width:L};return this.nextRow+=A,this.dirty=!0,N}bind(a){const m=a.gl;this.texture?(m.bindTexture(m.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,m.texSubImage2D(m.TEXTURE_2D,0,0,0,this.width,this.height,m.ALPHA,m.UNSIGNED_BYTE,this.data))):(this.texture=m.createTexture(),m.bindTexture(m.TEXTURE_2D,this.texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texImage2D(m.TEXTURE_2D,0,m.ALPHA,this.width,this.height,0,m.ALPHA,m.UNSIGNED_BYTE,this.data))}}class vt{constructor(a,m){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=i.uniqueId();const T=this.workerPool.acquire(this.id);for(let A=0;A<T.length;A++){const L=new vt.Actor(T[A],m,this.id);L.name=`Worker ${A}`,this.actors.push(L)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,m,T){i.asyncAll(this.actors,(A,L)=>{A.send(a,m,L)},T=T||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ut(C,a,m){const T=function(A,L){if(A)return m(A);if(L){const N=i.pick(i.extend(L,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(N.vectorLayers=L.vector_layers,N.vectorLayerIds=N.vectorLayers.map(H=>H.id)),m(null,N)}};return C.url?i.getJSON(a.transformRequest(C.url,i.ResourceType.Source),T):i.exported.frame(()=>T(null,C))}vt.Actor=i.Actor;class At{constructor(a,m,T){this.bounds=i.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=m||0,this.maxzoom=T||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const m=Math.pow(2,a.z),T=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*m),A=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*m),L=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*m),N=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*m);return a.x>=T&&a.x<L&&a.y>=A&&a.y<N}}class ti extends i.Evented{constructor(a,m,T,A){if(super(),this.id=a,this.dispatcher=T,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(m,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ut(this._options,this.map._requestManager,(a,m)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a?this.fire(new i.ErrorEvent(a)):m&&(i.extend(this,m),m.bounds&&(this.tileBounds=new At(m.bounds,this.minzoom,this.maxzoom)),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}loadTile(a,m){const T=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),A={request:this.map._requestManager.transformRequest(T,i.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function L(N,H){return delete a.request,a.aborted?m(null):N&&N.status!==404?m(N):(H&&H.resourceTiming&&(a.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&a.setExpiryData(H),a.loadVectorData(H,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=m:a.request=a.actor.send("reloadTile",A,L.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",A,L.bind(this)))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Nt extends i.Evented{constructor(a,m,T,A){super(),this.id=a,this.dispatcher=T,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},m),i.extend(this,i.pick(m,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ut(this._options,this.map._requestManager,(a,m)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new i.ErrorEvent(a)):m&&(i.extend(this,m),m.bounds&&(this.tileBounds=new At(m.bounds,this.minzoom,this.maxzoom)),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,m){const T=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.request=i.getImage(this.map._requestManager.transformRequest(T,i.ResourceType.Tile),(A,L,N)=>{if(delete a.request,a.aborted)a.state="unloaded",m(null);else if(A)a.state="errored",m(A);else if(L){this.map._refreshExpiredTiles&&a.setExpiryData(N);const H=this.map.painter.context,Q=H.gl;a.texture=this.map.painter.getTileTexture(L.width),a.texture?a.texture.update(L,{useMipmap:!0}):(a.texture=new we(H,L,Q.RGBA,{useMipmap:!0}),a.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&Q.texParameterf(Q.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),a.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),m(null)}})}abortTile(a,m){a.request&&(a.request.cancel(),delete a.request),m()}unloadTile(a,m){a.texture&&this.map.painter.saveTileTexture(a.texture),m()}hasTransition(){return!1}}let Wt;class zt extends Nt{constructor(a,m,T,A){super(a,m,T,A),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(a,m){const T=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function A(L,N){L&&(a.state="errored",m(L)),N&&(a.dem=N,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded",m(null))}a.request=i.getImage(this.map._requestManager.transformRequest(T,i.ResourceType.Tile),function(L,N){if(delete a.request,a.aborted)a.state="unloaded",m(null);else if(L)a.state="errored",m(L);else if(N){this.map._refreshExpiredTiles&&a.setExpiryData(N),delete N.cacheControl,delete N.expires;const H=i.isImageBitmap(N)&&(Wt==null&&(Wt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Wt)?N:i.exported.getImageData(N,1),Q={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:H,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",Q,A.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)}_getNeighboringTiles(a){const m=a.canonical,T=Math.pow(2,m.z),A=(m.x-1+T)%T,L=m.x===0?a.wrap-1:a.wrap,N=(m.x+1+T)%T,H=m.x+1===T?a.wrap+1:a.wrap,Q={};return Q[new i.OverscaledTileID(a.overscaledZ,L,m.z,A,m.y).key]={backfilled:!1},Q[new i.OverscaledTileID(a.overscaledZ,H,m.z,N,m.y).key]={backfilled:!1},m.y>0&&(Q[new i.OverscaledTileID(a.overscaledZ,L,m.z,A,m.y-1).key]={backfilled:!1},Q[new i.OverscaledTileID(a.overscaledZ,a.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},Q[new i.OverscaledTileID(a.overscaledZ,H,m.z,N,m.y-1).key]={backfilled:!1}),m.y+1<T&&(Q[new i.OverscaledTileID(a.overscaledZ,L,m.z,A,m.y+1).key]={backfilled:!1},Q[new i.OverscaledTileID(a.overscaledZ,a.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},Q[new i.OverscaledTileID(a.overscaledZ,H,m.z,N,m.y+1).key]={backfilled:!1}),Q}unloadTile(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})}}class Yt extends i.Evented{constructor(a,m,T,A){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=T.getActor(),this.setEventedParent(A),this._data=m.data,this._options=i.extend({},m),this._collectResourceTiming=m.collectResourceTiming,m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;const L=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*L,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*L,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?m.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:i.EXTENT,radius:(m.clusterRadius||50)*L,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData("content"),this}getClusterExpansionZoom(a,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},m),this}getClusterChildren(a,m){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},m),this}getClusterLeaves(a,m,T,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:m,offset:T},A),this}_updateWorkerData(a){const m=i.extend({},this.workerOptions),T=this._data;typeof T=="string"?(m.request=this.map._requestManager.transformRequest(i.exported.resolveURL(T),i.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(T),this._pendingLoads++,this.fire(new i.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,m,(A,L)=>{if(this._pendingLoads--,this._removed||L&&L.abandoned)return void this.fire(new i.Event("dataabort",{dataType:"source",sourceDataType:a}));let N=null;if(L&&L.resourceTiming&&L.resourceTiming[this.id]&&(N=L.resourceTiming[this.id].slice(0)),A)return void this.fire(new i.ErrorEvent(A));const H={dataType:"source",sourceDataType:a};this._collectResourceTiming&&N&&N.length>0&&i.extend(H,{resourceTiming:N}),this.fire(new i.Event("data",H))})}loaded(){return this._pendingLoads===0}loadTile(a,m){const T=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const A={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request=this.actor.send(T,A,(L,N)=>(delete a.request,a.unloadVectorData(),a.aborted?m(null):L?m(L):(a.loadVectorData(N,this.map.painter,T==="reloadTile"),m(null))))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0}unloadTile(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var vi=i.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class cn extends i.Evented{constructor(a,m,T,A){super(),this.id=a,this.dispatcher=T,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=m}load(a,m){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(T,A)=>{this._loaded=!0,T?this.fire(new i.ErrorEvent(T)):A&&(this.image=A,a&&(this.coordinates=a),m&&m(),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}setCoordinates(a){this.coordinates=a;const m=a.map(i.MercatorCoordinate.fromLngLat);this.tileID=function(A){let L=1/0,N=1/0,H=-1/0,Q=-1/0;for(const Ee of A)L=Math.min(L,Ee.x),N=Math.min(N,Ee.y),H=Math.max(H,Ee.x),Q=Math.max(Q,Ee.y);const se=Math.max(H-L,Q-N),pe=Math.max(0,Math.floor(-Math.log(se)/Math.LN2)),xe=Math.pow(2,pe);return new i.CanonicalTileID(pe,Math.floor((L+H)/2*xe),Math.floor((N+Q)/2*xe))}(m),this.minzoom=this.maxzoom=this.tileID.z;const T=m.map(A=>this.tileID.getTilePoint(A)._round());return this._boundsArray=new i.RasterBoundsArray,this._boundsArray.emplaceBack(T[0].x,T[0].y,0,0),this._boundsArray.emplaceBack(T[1].x,T[1].y,i.EXTENT,0),this._boundsArray.emplaceBack(T[3].x,T[3].y,0,i.EXTENT),this._boundsArray.emplaceBack(T[2].x,T[2].y,i.EXTENT,i.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,m=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,vi.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(a,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));for(const T in this.tiles){const A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}loadTile(a,m){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},m(null)):(a.state="errored",m(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class di extends cn{constructor(a,m,T,A){super(a,m,T,A),this.roundZoom=!0,this.type="video",this.options=m}load(){this._loaded=!1;const a=this.options;this.urls=[];for(const m of a.urls)this.urls.push(this.map._requestManager.transformRequest(m,i.ResourceType.Source).url);i.getVideo(this.urls,(m,T)=>{this._loaded=!0,m?this.fire(new i.ErrorEvent(m)):T&&(this.video=T,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const m=this.video.seekable;a<m.start(0)||a>m.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${m.start(0)} and ${m.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,m=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,vi.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new we(a,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));for(const T in this.tiles){const A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class un extends cn{constructor(a,m,T,A){super(a,m,T,A),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(L=>!Array.isArray(L)||L.length!==2||L.some(N=>typeof N!="number"))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${a}`,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${a}`,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const m=this.map.painter.context,T=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,vi.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(m,this.canvas,T.RGBA,{premultiply:!0});for(const A in this.tiles){const L=this.tiles[A];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const mn={vector:ti,raster:Nt,"raster-dem":zt,geojson:Yt,video:di,image:cn,canvas:un};function Er(C,a){const m=i.create();return i.translate(m,m,[1,1,0]),i.scale(m,m,[.5*C.width,.5*C.height,1]),i.multiply(m,m,C.calculatePosMatrix(a.toUnwrapped()))}function Li(C,a,m,T,A,L){const N=function(xe,Ee,Qe){if(xe)for(const Ge of xe){const We=Ee[Ge];if(We&&We.source===Qe&&We.type==="fill-extrusion")return!0}else for(const Ge in Ee){const We=Ee[Ge];if(We.source===Qe&&We.type==="fill-extrusion")return!0}return!1}(A&&A.layers,a,C.id),H=L.maxPitchScaleFactor(),Q=C.tilesIn(T,H,N);Q.sort(En);const se=[];for(const xe of Q)se.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(a,m,C._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,A,L,H,Er(C.transform,xe.tileID))});const pe=function(xe){const Ee={},Qe={};for(const Ge of xe){const We=Ge.queryResults,_t=Ge.wrappedTileID,Tt=Qe[_t]=Qe[_t]||{};for(const kt in We){const ot=We[kt],ft=Tt[kt]=Tt[kt]||{},Rt=Ee[kt]=Ee[kt]||[];for(const ii of ot)ft[ii.featureIndex]||(ft[ii.featureIndex]=!0,Rt.push(ii))}}return Ee}(se);for(const xe in pe)pe[xe].forEach(Ee=>{const Qe=Ee.feature,Ge=C.getFeatureState(Qe.layer["source-layer"],Qe.id);Qe.source=Qe.layer.source,Qe.layer["source-layer"]&&(Qe.sourceLayer=Qe.layer["source-layer"]),Qe.state=Ge});return pe}function En(C,a){const m=C.tileID,T=a.tileID;return m.overscaledZ-T.overscaledZ||m.canonical.y-T.canonical.y||m.wrap-T.wrap||m.canonical.x-T.canonical.x}class wn{constructor(a,m){this.tileID=a,this.uid=i.uniqueId(),this.uses=0,this.tileSize=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const m=a+this.timeAdded;m<i.exported.now()||this.fadeEndTime&&m<this.fadeEndTime||(this.fadeEndTime=m)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.textures.forEach(m=>a.saveTileTexture(m)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(a,m,T){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(A,L){const N={};if(!L)return N;for(const H of A){const Q=H.layerIds.map(se=>L.getLayer(se)).filter(Boolean);if(Q.length!==0){H.layers=Q,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map(se=>Q.filter(pe=>pe.id===se)[0]));for(const se of Q)N[se.id]=H}}return N}(a.buckets,m.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const L=this.buckets[A];if(L instanceof i.SymbolBucket){if(this.hasSymbolBuckets=!0,!T)break;L.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const L=this.buckets[A];if(L instanceof i.SymbolBucket&&L.hasRTLText){this.hasRTLText=!0,i.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const A in this.buckets){const L=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,m.style.getLayer(A).queryRadius(L))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new i.CollisionBoxArray}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const T in this.buckets){const A=this.buckets[T];A.uploadPending()&&A.upload(a)}const m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,m,T,A,L,N,H,Q,se,pe){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:A,cameraQueryGeometry:L,scale:N,tileSize:this.tileSize,pixelPosMatrix:pe,transform:Q,params:H,queryPadding:this.queryPadding*se},a,m,T):{}}querySourceFeatures(a,m){const T=this.latestFeatureIndex;if(!T||!T.rawTileData)return;const A=T.loadVTLayers(),L=m?m.sourceLayer:"",N=A._geojsonTileLayer||A[L];if(!N)return;const H=i.createFilter(m&&m.filter),{z:Q,x:se,y:pe}=this.tileID.canonical,xe={z:Q,x:se,y:pe};for(let Ee=0;Ee<N.length;Ee++){const Qe=N.feature(Ee);if(H.needGeometry){const _t=i.toEvaluationFeature(Qe,!0);if(!H.filter(new i.EvaluationParameters(this.tileID.overscaledZ),_t,this.tileID.canonical))continue}else if(!H.filter(new i.EvaluationParameters(this.tileID.overscaledZ),Qe))continue;const Ge=T.getId(Qe,L),We=new i.GeoJSONFeature(Qe,Q,se,pe,Ge);We.tile=xe,a.push(We)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const m=this.expirationTime;if(a.cacheControl){const T=i.parseCacheControl(a.cacheControl);T["max-age"]&&(this.expirationTime=Date.now()+1e3*T["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const T=Date.now();let A=!1;if(this.expirationTime>T)A=!1;else if(m)if(this.expirationTime<m)A=!0;else{const L=this.expirationTime-m;L?this.expirationTime=T+Math.max(L,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,m){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const T=this.latestFeatureIndex.loadVTLayers();for(const A in this.buckets){if(!m.style.hasLayer(A))continue;const L=this.buckets[A],N=L.layers[0].sourceLayer||"_geojsonTileLayer",H=T[N],Q=a[N];if(!H||!Q||Object.keys(Q).length===0)continue;L.update(Q,H,this.imageAtlas&&this.imageAtlas.patternPositions||{});const se=m&&m.style&&m.style.getLayer(A);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=i.exported.now()+a}setDependencies(a,m){const T={};for(const A of m)T[A]=!0;this.dependencies[a]=T}hasDependency(a,m){for(const T of a){const A=this.dependencies[T];if(A){for(const L of m)if(A[L])return!0}}return!1}}class vr{constructor(a,m){this.max=a,this.onRemove=m,this.reset()}reset(){for(const a in this.data)for(const m of this.data[a])m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value);return this.data={},this.order=[],this}add(a,m,T){const A=a.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const L={value:m,timeout:void 0};if(T!==void 0&&(L.timeout=setTimeout(()=>{this.remove(a,L)},T)),this.data[A].push(L),this.order.push(A),this.order.length>this.max){const N=this._getAndRemoveByKey(this.order[0]);N&&this.onRemove(N)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const m=this.data[a].shift();return m.timeout&&clearTimeout(m.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),m.value}getByKey(a){const m=this.data[a];return m?m[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,m){if(!this.has(a))return this;const T=a.wrapped().key,A=m===void 0?0:this.data[T].indexOf(m),L=this.data[T][A];return this.data[T].splice(A,1),L.timeout&&clearTimeout(L.timeout),this.data[T].length===0&&delete this.data[T],this.onRemove(L.value),this.order.splice(this.order.indexOf(T),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}filter(a){const m=[];for(const T in this.data)for(const A of this.data[T])a(A.value)||m.push(A);for(const T of m)this.remove(T.value.tileID,T)}}class Fo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,m,T){const A=String(m);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][A]=this.stateChanges[a][A]||{},i.extend(this.stateChanges[a][A],T),this.deletedStates[a]===null){this.deletedStates[a]={};for(const L in this.state[a])L!==A&&(this.deletedStates[a][L]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][A]===null){this.deletedStates[a][A]={};for(const L in this.state[a][A])T[L]||(this.deletedStates[a][A][L]=null)}else for(const L in T)this.deletedStates[a]&&this.deletedStates[a][A]&&this.deletedStates[a][A][L]===null&&delete this.deletedStates[a][A][L]}removeFeatureState(a,m,T){if(this.deletedStates[a]===null)return;const A=String(m);if(this.deletedStates[a]=this.deletedStates[a]||{},T&&m!==void 0)this.deletedStates[a][A]!==null&&(this.deletedStates[a][A]=this.deletedStates[a][A]||{},this.deletedStates[a][A][T]=null);else if(m!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][A])for(T in this.deletedStates[a][A]={},this.stateChanges[a][A])this.deletedStates[a][A][T]=null;else this.deletedStates[a][A]=null;else this.deletedStates[a]=null}getState(a,m){const T=String(m),A=i.extend({},(this.state[a]||{})[T],(this.stateChanges[a]||{})[T]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const L=this.deletedStates[a][m];if(L===null)return{};for(const N in L)delete A[N]}return A}initializeTileState(a,m){a.setFeatureState(this.state,m)}coalesceChanges(a,m){const T={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const L={};for(const N in this.stateChanges[A])this.state[A][N]||(this.state[A][N]={}),i.extend(this.state[A][N],this.stateChanges[A][N]),L[N]=this.state[A][N];T[A]=L}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const L={};if(this.deletedStates[A]===null)for(const N in this.state[A])L[N]={},this.state[A][N]={};else for(const N in this.deletedStates[A]){if(this.deletedStates[A][N]===null)this.state[A][N]={};else for(const H of Object.keys(this.deletedStates[A][N]))delete this.state[A][N][H];L[N]=this.state[A][N]}T[A]=T[A]||{},i.extend(T[A],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(T).length!==0)for(const A in a)a[A].setFeatureState(T,m)}}class Xr extends i.Evented{constructor(a,m,T){super(),this.id=a,this.dispatcher=T,this.on("data",A=>{A.dataType==="source"&&A.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(A,L,N,H){const Q=new mn[L.type](A,L,N,H);if(Q.id!==A)throw new Error(`Expected Source id to be ${A} instead of ${Q.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],Q),Q}(a,m,T,this),this._tiles={},this._cache=new vr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fo}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles){const m=this._tiles[a];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,m){return this._source.loadTile(a,m)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){this._source.abortTile&&this._source.abortTile(a,()=>{}),this._source.fire(new i.Event("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const m in this._tiles){const T=this._tiles[m];T.upload(a),T.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(uo).map(a=>a.key)}getRenderableIds(a){const m=[];for(const T in this._tiles)this._isIdRenderable(T,a)&&m.push(this._tiles[T]);return a?m.sort((T,A)=>{const L=T.tileID,N=A.tileID,H=new i.pointGeometry(L.canonical.x,L.canonical.y)._rotate(this.transform.angle),Q=new i.pointGeometry(N.canonical.x,N.canonical.y)._rotate(this.transform.angle);return L.overscaledZ-N.overscaledZ||Q.y-H.y||Q.x-H.x}).map(T=>T.tileID.key):m.map(T=>T.tileID).sort(uo).map(T=>T.key)}hasRenderableParent(a){const m=this.findLoadedParent(a,0);return!!m&&this._isIdRenderable(m.tileID.key)}_isIdRenderable(a,m){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(m||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,m){const T=this._tiles[a];T&&(T.state!=="loading"&&(T.state=m),this._loadTile(T,this._tileLoaded.bind(this,T,a,m)))}_tileLoaded(a,m,T,A){if(A)return a.state="errored",void(A.status!==404?this._source.fire(new i.ErrorEvent(A,{tile:a})):this.update(this.transform,this.terrain));a.timeAdded=i.exported.now(),T==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(m,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new i.Event("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const m=this.getRenderableIds();for(let A=0;A<m.length;A++){const L=m[A];if(a.neighboringTiles&&a.neighboringTiles[L]){const N=this.getTileByID(L);T(a,N),T(N,a)}}function T(A,L){A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0;let N=L.tileID.canonical.x-A.tileID.canonical.x;const H=L.tileID.canonical.y-A.tileID.canonical.y,Q=Math.pow(2,A.tileID.canonical.z),se=L.tileID.key;N===0&&H===0||Math.abs(H)>1||(Math.abs(N)>1&&(Math.abs(N+Q)===1?N+=Q:Math.abs(N-Q)===1&&(N-=Q)),L.dem&&A.dem&&(A.dem.backfillBorder(L.dem,N,H),A.neighboringTiles&&A.neighboringTiles[se]&&(A.neighboringTiles[se].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,m,T,A){for(const L in this._tiles){let N=this._tiles[L];if(A[L]||!N.hasData()||N.tileID.overscaledZ<=m||N.tileID.overscaledZ>T)continue;let H=N.tileID;for(;N&&N.tileID.overscaledZ>m+1;){const se=N.tileID.scaledTo(N.tileID.overscaledZ-1);N=this._tiles[se.key],N&&N.hasData()&&(H=se)}let Q=H;for(;Q.overscaledZ>m;)if(Q=Q.scaledTo(Q.overscaledZ-1),a[Q.key]){A[H.key]=H;break}}}findLoadedParent(a,m){if(a.key in this._loadedParentTiles){const T=this._loadedParentTiles[a.key];return T&&T.tileID.overscaledZ>=m?T:null}for(let T=a.overscaledZ-1;T>=m;T--){const A=a.scaledTo(T),L=this._getLoadedTile(A);if(L)return L}}_getLoadedTile(a){const m=this._tiles[a.key];return m&&m.hasData()?m:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const m=Math.ceil(a.width/this._source.tileSize)+1,T=Math.ceil(a.height/this._source.tileSize)+1,A=Math.floor(m*T*5),L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(L)}handleWrapJump(a){const m=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,m){const T={};for(const A in this._tiles){const L=this._tiles[A];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+m),T[L.tileID.key]=L}this._tiles=T;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(A,this._tiles[A])}}update(a,m){if(this.transform=a,this.terrain=m,!this._sourceLoaded||this._paused)return;let T;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?T=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(se=>new i.OverscaledTileID(se.canonical.z,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y)):(T=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:m}),this._source.hasTile&&(T=T.filter(se=>this._source.hasTile(se)))):T=[];const A=a.coveringZoomLevel(this._source),L=Math.max(A-Xr.maxOverzooming,this._source.minzoom),N=Math.max(A+Xr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const se={};for(const pe of T)if(pe.canonical.z>this._source.minzoom){const xe=pe.scaledTo(pe.canonical.z-1);se[xe.key]=xe;const Ee=pe.scaledTo(Math.max(this._source.minzoom,Math.min(pe.canonical.z,5)));se[Ee.key]=Ee}T=T.concat(Object.values(se))}const H=this._updateRetainedTiles(T,A);if(ks(this._source.type)){const se={},pe={},xe=Object.keys(H);for(const Ee of xe){const Qe=H[Ee],Ge=this._tiles[Ee];if(!Ge||Ge.fadeEndTime&&Ge.fadeEndTime<=i.exported.now())continue;const We=this.findLoadedParent(Qe,L);We&&(this._addTile(We.tileID),se[We.tileID.key]=We.tileID),pe[Ee]=Qe}this._retainLoadedChildren(pe,A,N,H);for(const Ee in se)H[Ee]||(this._coveredTiles[Ee]=!0,H[Ee]=se[Ee]);if(m){const Ee={},Qe={};for(const Ge of T)this._tiles[Ge.key].hasData()?Ee[Ge.key]=Ge:Qe[Ge.key]=Ge;for(const Ge in Qe){const We=Qe[Ge].children(this._source.maxzoom);this._tiles[We[0].key]&&this._tiles[We[1].key]&&this._tiles[We[2].key]&&this._tiles[We[3].key]&&(Ee[We[0].key]=H[We[0].key]=We[0],Ee[We[1].key]=H[We[1].key]=We[1],Ee[We[2].key]=H[We[2].key]=We[2],Ee[We[3].key]=H[We[3].key]=We[3],delete Qe[Ge])}for(const Ge in Qe){const We=this.findLoadedParent(Qe[Ge],this._source.minzoom);if(We){Ee[We.tileID.key]=H[We.tileID.key]=We.tileID;for(const _t in Ee)Ee[_t].isChildOf(We.tileID)&&delete Ee[_t]}}for(const Ge in this._tiles)Ee[Ge]||(this._coveredTiles[Ge]=!0)}}for(const se in H)this._tiles[se].clearFadeHold();const Q=i.keysDifference(this._tiles,H);for(const se of Q){const pe=this._tiles[se];pe.hasSymbolBuckets&&!pe.holdingForFade()?pe.setHoldDuration(this.map._fadeDuration):pe.hasSymbolBuckets&&!pe.symbolFadeFinished()||this._removeTile(se)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,m){const T={},A={},L=Math.max(m-Xr.maxOverzooming,this._source.minzoom),N=Math.max(m+Xr.maxUnderzooming,this._source.minzoom),H={};for(const Q of a){const se=this._addTile(Q);T[Q.key]=Q,se.hasData()||m<this._source.maxzoom&&(H[Q.key]=Q)}this._retainLoadedChildren(H,m,N,T);for(const Q of a){let se=this._tiles[Q.key];if(se.hasData())continue;if(m+1>this._source.maxzoom){const xe=Q.children(this._source.maxzoom)[0],Ee=this.getTile(xe);if(Ee&&Ee.hasData()){T[xe.key]=xe;continue}}else{const xe=Q.children(this._source.maxzoom);if(T[xe[0].key]&&T[xe[1].key]&&T[xe[2].key]&&T[xe[3].key])continue}let pe=se.wasRequested();for(let xe=Q.overscaledZ-1;xe>=L;--xe){const Ee=Q.scaledTo(xe);if(A[Ee.key]||(A[Ee.key]=!0,se=this.getTile(Ee),!se&&pe&&(se=this._addTile(Ee)),se&&(T[Ee.key]=Ee,pe=se.wasRequested(),se.hasData())))break}}return T}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const m=[];let T,A=this._tiles[a].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){T=this._loadedParentTiles[A.key];break}m.push(A.key);const L=A.scaledTo(A.overscaledZ-1);if(T=this._getLoadedTile(L),T)break;A=L}for(const L of m)this._loadedParentTiles[L]=T}}_addTile(a){let m=this._tiles[a.key];if(m)return m;m=this._cache.getAndRemove(a),m&&(this._setTileReloadTimer(a.key,m),m.tileID=a,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,m)));const T=m;return m||(m=new wn(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,a.key,m.state))),m.uses++,this._tiles[a.key]=m,T||this._source.fire(new i.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m}_setTileReloadTimer(a,m){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const T=m.getExpiryTimeout();T&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},T))}_removeTile(a){const m=this._tiles[a];m&&(m.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,m,T){const A=[],L=this.transform;if(!L)return A;const N=T?L.getCameraQueryGeometry(a):a,H=a.map(Ge=>L.pointCoordinate(Ge,this.terrain)),Q=N.map(Ge=>L.pointCoordinate(Ge,this.terrain)),se=this.getIds();let pe=1/0,xe=1/0,Ee=-1/0,Qe=-1/0;for(const Ge of Q)pe=Math.min(pe,Ge.x),xe=Math.min(xe,Ge.y),Ee=Math.max(Ee,Ge.x),Qe=Math.max(Qe,Ge.y);for(let Ge=0;Ge<se.length;Ge++){const We=this._tiles[se[Ge]];if(We.holdingForFade())continue;const _t=We.tileID,Tt=Math.pow(2,L.zoom-We.tileID.overscaledZ),kt=m*We.queryPadding*i.EXTENT/We.tileSize/Tt,ot=[_t.getTilePoint(new i.MercatorCoordinate(pe,xe)),_t.getTilePoint(new i.MercatorCoordinate(Ee,Qe))];if(ot[0].x-kt<i.EXTENT&&ot[0].y-kt<i.EXTENT&&ot[1].x+kt>=0&&ot[1].y+kt>=0){const ft=H.map(ii=>_t.getTilePoint(ii)),Rt=Q.map(ii=>_t.getTilePoint(ii));A.push({tile:We,tileID:_t,queryGeometry:ft,cameraQueryGeometry:Rt,scale:Tt})}}return A}getVisibleCoordinates(a){const m=this.getRenderableIds(a).map(T=>this._tiles[T].tileID);for(const T of m)T.posMatrix=this.transform.calculatePosMatrix(T.toUnwrapped());return m}hasTransition(){if(this._source.hasTransition())return!0;if(ks(this._source.type))for(const a in this._tiles){const m=this._tiles[a];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=i.exported.now())return!0}return!1}setFeatureState(a,m,T){this._state.updateState(a=a||"_geojsonTileLayer",m,T)}removeFeatureState(a,m,T){this._state.removeFeatureState(a=a||"_geojsonTileLayer",m,T)}getFeatureState(a,m){return this._state.getState(a=a||"_geojsonTileLayer",m)}setDependencies(a,m,T){const A=this._tiles[a];A&&A.setDependencies(m,T)}reloadTilesForDependencies(a,m){for(const T in this._tiles)this._tiles[T].hasDependency(a,m)&&this._reloadTile(T,"reloading");this._cache.filter(T=>!T.hasDependency(a,m))}}function uo(C,a){const m=Math.abs(2*C.wrap)-+(C.wrap<0),T=Math.abs(2*a.wrap)-+(a.wrap<0);return C.overscaledZ-a.overscaledZ||T-m||a.canonical.y-C.canonical.y||a.canonical.x-C.canonical.x}function ks(C){return C==="raster"||C==="image"||C==="video"}Xr.maxOverzooming=10,Xr.maxUnderzooming=3;const at="mapboxgl_preloaded_worker_pool";class bt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<bt.workerCount;)this.workers.push(new Worker(pl.workerUrl));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(m=>{m.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[at]}numActive(){return Object.keys(this.active).length}}const Ft=Math.floor(i.exported.hardwareConcurrency/2);let fi;function gi(){return fi||(fi=new bt),fi}function Mi(C,a){const m={};for(const T in C)T!=="ref"&&(m[T]=C[T]);return i.refProperties.forEach(T=>{T in a&&(m[T]=a[T])}),m}function Ki(C){C=C.slice();const a=Object.create(null);for(let m=0;m<C.length;m++)a[C[m].id]=C[m];for(let m=0;m<C.length;m++)"ref"in C[m]&&(C[m]=Mi(C[m],a[C[m].ref]));return C}bt.workerCount=Math.max(Math.min(Ft,6),1);const ci={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Pi(C,a,m){m.push({command:ci.addSource,args:[C,a[C]]})}function Si(C,a,m){a.push({command:ci.removeSource,args:[C]}),m[C]=!0}function tn(C,a,m,T){Si(C,m,T),Pi(C,a,m)}function on(C,a,m){let T;for(T in C[m])if(Object.prototype.hasOwnProperty.call(C[m],T)&&T!=="data"&&!Y(C[m][T],a[m][T]))return!1;for(T in a[m])if(Object.prototype.hasOwnProperty.call(a[m],T)&&T!=="data"&&!Y(C[m][T],a[m][T]))return!1;return!0}function hn(C,a,m,T,A,L){let N;for(N in a=a||{},C=C||{})Object.prototype.hasOwnProperty.call(C,N)&&(Y(C[N],a[N])||m.push({command:L,args:[T,N,a[N],A]}));for(N in a)Object.prototype.hasOwnProperty.call(a,N)&&!Object.prototype.hasOwnProperty.call(C,N)&&(Y(C[N],a[N])||m.push({command:L,args:[T,N,a[N],A]}))}function Tn(C){return C.id}function On(C,a){return C[a.id]=a,C}class qn{constructor(a,m){this.reset(a,m)}reset(a,m){this.points=a||[],this._distances=[0];for(let T=1;T<this.points.length;T++)this._distances[T]=this._distances[T-1]+this.points[T].dist(this.points[T-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=i.clamp(a,0,1);let m=1,T=this._distances[m];const A=a*this.paddedLength+this.padding;for(;T<A&&m<this._distances.length;)T=this._distances[++m];const L=m-1,N=this._distances[L],H=T-N,Q=H>0?(A-N)/H:0;return this.points[L].mult(1-Q).add(this.points[m].mult(Q))}}function Ot(C,a){let m=!0;return C==="always"||C!=="never"&&a!=="never"||(m=!1),m}class yi{constructor(a,m,T){const A=this.boxCells=[],L=this.circleCells=[];this.xCellCount=Math.ceil(a/T),this.yCellCount=Math.ceil(m/T);for(let N=0;N<this.xCellCount*this.yCellCount;N++)A.push([]),L.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=m,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,m,T,A,L){this._forEachCell(m,T,A,L,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(m),this.bboxes.push(T),this.bboxes.push(A),this.bboxes.push(L)}insertCircle(a,m,T,A){this._forEachCell(m-A,T-A,m+A,T+A,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(m),this.circles.push(T),this.circles.push(A)}_insertBoxCell(a,m,T,A,L,N){this.boxCells[L].push(N)}_insertCircleCell(a,m,T,A,L,N){this.circleCells[L].push(N)}_query(a,m,T,A,L,N,H){if(T<0||a>this.width||A<0||m>this.height)return[];const Q=[];if(a<=0&&m<=0&&this.width<=T&&this.height<=A){if(L)return[{key:null,x1:a,y1:m,x2:T,y2:A}];for(let se=0;se<this.boxKeys.length;se++)Q.push({key:this.boxKeys[se],x1:this.bboxes[4*se],y1:this.bboxes[4*se+1],x2:this.bboxes[4*se+2],y2:this.bboxes[4*se+3]});for(let se=0;se<this.circleKeys.length;se++){const pe=this.circles[3*se],xe=this.circles[3*se+1],Ee=this.circles[3*se+2];Q.push({key:this.circleKeys[se],x1:pe-Ee,y1:xe-Ee,x2:pe+Ee,y2:xe+Ee})}}else this._forEachCell(a,m,T,A,this._queryCell,Q,{hitTest:L,overlapMode:N,seenUids:{box:{},circle:{}}},H);return Q}query(a,m,T,A){return this._query(a,m,T,A,!1,null)}hitTest(a,m,T,A,L,N){return this._query(a,m,T,A,!0,L,N).length>0}hitTestCircle(a,m,T,A,L){const N=a-T,H=a+T,Q=m-T,se=m+T;if(H<0||N>this.width||se<0||Q>this.height)return!1;const pe=[];return this._forEachCell(N,Q,H,se,this._queryCellCircle,pe,{hitTest:!0,overlapMode:A,circle:{x:a,y:m,radius:T},seenUids:{box:{},circle:{}}},L),pe.length>0}_queryCell(a,m,T,A,L,N,H,Q){const{seenUids:se,hitTest:pe,overlapMode:xe}=H,Ee=this.boxCells[L];if(Ee!==null){const Ge=this.bboxes;for(const We of Ee)if(!se.box[We]){se.box[We]=!0;const _t=4*We,Tt=this.boxKeys[We];if(a<=Ge[_t+2]&&m<=Ge[_t+3]&&T>=Ge[_t+0]&&A>=Ge[_t+1]&&(!Q||Q(Tt))&&(!pe||!Ot(xe,Tt.overlapMode))&&(N.push({key:Tt,x1:Ge[_t],y1:Ge[_t+1],x2:Ge[_t+2],y2:Ge[_t+3]}),pe))return!0}}const Qe=this.circleCells[L];if(Qe!==null){const Ge=this.circles;for(const We of Qe)if(!se.circle[We]){se.circle[We]=!0;const _t=3*We,Tt=this.circleKeys[We];if(this._circleAndRectCollide(Ge[_t],Ge[_t+1],Ge[_t+2],a,m,T,A)&&(!Q||Q(Tt))&&(!pe||!Ot(xe,Tt.overlapMode))){const kt=Ge[_t],ot=Ge[_t+1],ft=Ge[_t+2];if(N.push({key:Tt,x1:kt-ft,y1:ot-ft,x2:kt+ft,y2:ot+ft}),pe)return!0}}}return!1}_queryCellCircle(a,m,T,A,L,N,H,Q){const{circle:se,seenUids:pe,overlapMode:xe}=H,Ee=this.boxCells[L];if(Ee!==null){const Ge=this.bboxes;for(const We of Ee)if(!pe.box[We]){pe.box[We]=!0;const _t=4*We,Tt=this.boxKeys[We];if(this._circleAndRectCollide(se.x,se.y,se.radius,Ge[_t+0],Ge[_t+1],Ge[_t+2],Ge[_t+3])&&(!Q||Q(Tt))&&!Ot(xe,Tt.overlapMode))return N.push(!0),!0}}const Qe=this.circleCells[L];if(Qe!==null){const Ge=this.circles;for(const We of Qe)if(!pe.circle[We]){pe.circle[We]=!0;const _t=3*We,Tt=this.circleKeys[We];if(this._circlesCollide(Ge[_t],Ge[_t+1],Ge[_t+2],se.x,se.y,se.radius)&&(!Q||Q(Tt))&&!Ot(xe,Tt.overlapMode))return N.push(!0),!0}}}_forEachCell(a,m,T,A,L,N,H,Q){const se=this._convertToXCellCoord(a),pe=this._convertToYCellCoord(m),xe=this._convertToXCellCoord(T),Ee=this._convertToYCellCoord(A);for(let Qe=se;Qe<=xe;Qe++)for(let Ge=pe;Ge<=Ee;Ge++)if(L.call(this,a,m,T,A,this.xCellCount*Ge+Qe,N,H,Q))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,m,T,A,L,N){const H=A-a,Q=L-m,se=T+N;return se*se>H*H+Q*Q}_circleAndRectCollide(a,m,T,A,L,N,H){const Q=(N-A)/2,se=Math.abs(a-(A+Q));if(se>Q+T)return!1;const pe=(H-L)/2,xe=Math.abs(m-(L+pe));if(xe>pe+T)return!1;if(se<=Q||xe<=pe)return!0;const Ee=se-Q,Qe=xe-pe;return Ee*Ee+Qe*Qe<=T*T}}function Pr(C,a,m,T,A){const L=i.create();return a?(i.scale(L,L,[1/A,1/A,1]),m||i.rotateZ(L,L,T.angle)):i.multiply(L,T.labelPlaneMatrix,C),L}function Eo(C,a,m,T,A){if(a){const L=i.clone(C);return i.scale(L,L,[A,A,1]),m||i.rotateZ(L,L,-T.angle),L}return T.glCoordMatrix}function jn(C,a,m){let T;m?(T=[C.x,C.y,m(C.x,C.y),1],i.transformMat4(T,T,a)):(T=[C.x,C.y,0,1],sa(T,T,a));const A=T[3];return{point:new i.pointGeometry(T[0]/A,T[1]/A),signedDistanceFromCamera:A}}function ro(C,a){return .5+C/a*.5}function _o(C,a){const m=C[0]/C[3],T=C[1]/C[3];return m>=-a[0]&&m<=a[0]&&T>=-a[1]&&T<=a[1]}function zr(C,a,m,T,A,L,N,H,Q,se){const pe=T?C.textSizeData:C.iconSizeData,xe=i.evaluateSizeForZoom(pe,m.transform.zoom),Ee=[256/m.width*2+1,256/m.height*2+1],Qe=T?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;Qe.clear();const Ge=C.lineVertexArray,We=T?C.text.placedSymbolArray:C.icon.placedSymbolArray,_t=m.transform.width/m.transform.height;let Tt=!1;for(let kt=0;kt<We.length;kt++){const ot=We.get(kt);if(ot.hidden||ot.writingMode===i.WritingMode.vertical&&!Tt){kn(ot.numGlyphs,Qe);continue}let ft;if(Tt=!1,se?(ft=[ot.anchorX,ot.anchorY,se(ot.anchorX,ot.anchorY),1],i.transformMat4(ft,ft,a)):(ft=[ot.anchorX,ot.anchorY,0,1],sa(ft,ft,a)),!_o(ft,Ee)){kn(ot.numGlyphs,Qe);continue}const Rt=ro(m.transform.cameraToCenterDistance,ft[3]),ii=i.evaluateSizeForFeature(pe,xe,ot),Qt=N?ii/Rt:ii*Rt,_i=new i.pointGeometry(ot.anchorX,ot.anchorY),Jt=jn(_i,A,se).point,Ji={},Vi=Ln(ot,Qt,!1,H,a,A,L,C.glyphOffsetArray,Ge,Qe,Jt,_i,Ji,_t,Q,se);Tt=Vi.useVertical,(Vi.notEnoughRoom||Tt||Vi.needsFlipping&&Ln(ot,Qt,!0,H,a,A,L,C.glyphOffsetArray,Ge,Qe,Jt,_i,Ji,_t,Q,se).notEnoughRoom)&&kn(ot.numGlyphs,Qe)}T?C.text.dynamicLayoutVertexBuffer.updateData(Qe):C.icon.dynamicLayoutVertexBuffer.updateData(Qe)}function So(C,a,m,T,A,L,N,H,Q,se,pe,xe,Ee){const Qe=H.glyphStartIndex+H.numGlyphs,Ge=H.lineStartIndex,We=H.lineStartIndex+H.lineLength,_t=a.getoffsetX(H.glyphStartIndex),Tt=a.getoffsetX(Qe-1),kt=Co(C*_t,m,T,A,L,N,H.segment,Ge,We,Q,se,pe,xe,Ee);if(!kt)return null;const ot=Co(C*Tt,m,T,A,L,N,H.segment,Ge,We,Q,se,pe,xe,Ee);return ot?{first:kt,last:ot}:null}function zi(C,a,m,T){return C===i.WritingMode.horizontal&&Math.abs(m.y-a.y)>Math.abs(m.x-a.x)*T?{useVertical:!0}:(C===i.WritingMode.vertical?a.y<m.y:a.x>m.x)?{needsFlipping:!0}:null}function Ln(C,a,m,T,A,L,N,H,Q,se,pe,xe,Ee,Qe,Ge,We){const _t=a/24,Tt=C.lineOffsetX*_t,kt=C.lineOffsetY*_t;let ot;if(C.numGlyphs>1){const ft=C.glyphStartIndex+C.numGlyphs,Rt=C.lineStartIndex,ii=C.lineStartIndex+C.lineLength,Qt=So(_t,H,Tt,kt,m,pe,xe,C,Q,L,Ee,Ge,We);if(!Qt)return{notEnoughRoom:!0};const _i=jn(Qt.first.point,N,We).point,Jt=jn(Qt.last.point,N,We).point;if(T&&!m){const Ji=zi(C.writingMode,_i,Jt,Qe);if(Ji)return Ji}ot=[Qt.first];for(let Ji=C.glyphStartIndex+1;Ji<ft-1;Ji++)ot.push(Co(_t*H.getoffsetX(Ji),Tt,kt,m,pe,xe,C.segment,Rt,ii,Q,L,Ee,Ge,We));ot.push(Qt.last)}else{if(T&&!m){const Rt=jn(xe,A,We).point,ii=C.lineStartIndex+C.segment+1,Qt=new i.pointGeometry(Q.getx(ii),Q.gety(ii)),_i=jn(Qt,A,We),Jt=_i.signedDistanceFromCamera>0?_i.point:Dn(xe,Qt,Rt,1,A,We),Ji=zi(C.writingMode,Rt,Jt,Qe);if(Ji)return Ji}const ft=Co(_t*H.getoffsetX(C.glyphStartIndex),Tt,kt,m,pe,xe,C.segment,C.lineStartIndex,C.lineStartIndex+C.lineLength,Q,L,Ee,Ge,We);if(!ft)return{notEnoughRoom:!0};ot=[ft]}for(const ft of ot)i.addDynamicAttributes(se,ft.point,ft.angle);return{}}function Dn(C,a,m,T,A,L){const N=jn(C.add(C.sub(a)._unit()),A,L).point,H=m.sub(N);return m.add(H._mult(T/H.mag()))}function Co(C,a,m,T,A,L,N,H,Q,se,pe,xe,Ee,Qe){const Ge=T?C-a:C+a;let We=Ge>0?1:-1,_t=0;T&&(We*=-1,_t=Math.PI),We<0&&(_t+=Math.PI);let Tt=We>0?H+N:H+N+1,kt=A,ot=A,ft=0,Rt=0;const ii=Math.abs(Ge),Qt=[];for(;ft+Rt<=ii;){if(Tt+=We,Tt<H||Tt>=Q)return null;if(ot=kt,Qt.push(kt),kt=xe[Tt],kt===void 0){const en=new i.pointGeometry(se.getx(Tt),se.gety(Tt)),Rn=jn(en,pe,Qe);if(Rn.signedDistanceFromCamera>0)kt=xe[Tt]=Rn.point;else{const $n=Tt-We;kt=Dn(ft===0?L:new i.pointGeometry(se.getx($n),se.gety($n)),en,ot,ii-ft+1,pe,Qe)}}ft+=Rt,Rt=ot.dist(kt)}const _i=(ii-ft)/Rt,Jt=kt.sub(ot),Ji=Jt.mult(_i)._add(ot);Ji._add(Jt._unit()._perp()._mult(m*We));const Vi=_t+Math.atan2(kt.y-ot.y,kt.x-ot.x);return Qt.push(Ji),{point:Ji,angle:Ee?Vi:0,path:Qt}}const is=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function kn(C,a){for(let m=0;m<C;m++){const T=a.length;a.resize(T+4),a.float32.set(is,3*T)}}function sa(C,a,m){const T=a[0],A=a[1];return C[0]=m[0]*T+m[4]*A+m[12],C[1]=m[1]*T+m[5]*A+m[13],C[3]=m[3]*T+m[7]*A+m[15],C}const yo=100;class aa{constructor(a,m=new yi(a.width+200,a.height+200,25),T=new yi(a.width+200,a.height+200,25)){this.transform=a,this.grid=m,this.ignoredGrid=T,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+yo,this.screenBottomBoundary=a.height+yo,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,m,T,A,L,N){const H=this.projectAndGetPerspectiveRatio(A,a.anchorPointX,a.anchorPointY,N),Q=T*H.perspectiveRatio,se=a.x1*Q+H.point.x,pe=a.y1*Q+H.point.y,xe=a.x2*Q+H.point.x,Ee=a.y2*Q+H.point.y;return!this.isInsideGrid(se,pe,xe,Ee)||m!=="always"&&this.grid.hitTest(se,pe,xe,Ee,m,L)||H.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[se,pe,xe,Ee],offscreen:this.isOffscreen(se,pe,xe,Ee)}}placeCollisionCircles(a,m,T,A,L,N,H,Q,se,pe,xe,Ee,Qe,Ge){const We=[],_t=new i.pointGeometry(m.anchorX,m.anchorY),Tt=jn(_t,N,Ge),kt=ro(this.transform.cameraToCenterDistance,Tt.signedDistanceFromCamera),ot=(pe?L/kt:L*kt)/i.ONE_EM,ft=jn(_t,H,Ge).point,Rt=So(ot,A,m.lineOffsetX*ot,m.lineOffsetY*ot,!1,ft,_t,m,T,H,{},!1,Ge);let ii=!1,Qt=!1,_i=!0;if(Rt){const Jt=.5*Ee*kt+Qe,Ji=new i.pointGeometry(-100,-100),Vi=new i.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),en=new qn,Rn=Rt.first,$n=Rt.last;let dn=[];for(let ur=Rn.path.length-1;ur>=1;ur--)dn.push(Rn.path[ur]);for(let ur=1;ur<$n.path.length;ur++)dn.push($n.path[ur]);const xr=2.5*Jt;if(Q){const ur=dn.map(hr=>jn(hr,Q,Ge));dn=ur.some(hr=>hr.signedDistanceFromCamera<=0)?[]:ur.map(hr=>hr.point)}let Cr=[];if(dn.length>0){const ur=dn[0].clone(),hr=dn[0].clone();for(let Dr=1;Dr<dn.length;Dr++)ur.x=Math.min(ur.x,dn[Dr].x),ur.y=Math.min(ur.y,dn[Dr].y),hr.x=Math.max(hr.x,dn[Dr].x),hr.y=Math.max(hr.y,dn[Dr].y);Cr=ur.x>=Ji.x&&hr.x<=Vi.x&&ur.y>=Ji.y&&hr.y<=Vi.y?[dn]:hr.x<Ji.x||ur.x>Vi.x||hr.y<Ji.y||ur.y>Vi.y?[]:i.clipLine([dn],Ji.x,Ji.y,Vi.x,Vi.y)}for(const ur of Cr){en.reset(ur,.25*Jt);let hr=0;hr=en.length<=.5*Jt?1:Math.ceil(en.paddedLength/xr)+1;for(let Dr=0;Dr<hr;Dr++){const Wo=Dr/Math.max(hr-1,1),ba=en.lerp(Wo),da=ba.x+yo,wa=ba.y+yo;We.push(da,wa,Jt,0);const Ua=da-Jt,Zs=wa-Jt,ws=da+Jt,Ta=wa+Jt;if(_i=_i&&this.isOffscreen(Ua,Zs,ws,Ta),Qt=Qt||this.isInsideGrid(Ua,Zs,ws,Ta),a!=="always"&&this.grid.hitTestCircle(da,wa,Jt,a,xe)&&(ii=!0,!se))return{circles:[],offscreen:!1,collisionDetected:ii}}}}return{circles:!se&&ii||!Qt||kt<this.perspectiveRatioCutoff?[]:We,offscreen:_i,collisionDetected:ii}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const m=[];let T=1/0,A=1/0,L=-1/0,N=-1/0;for(const pe of a){const xe=new i.pointGeometry(pe.x+yo,pe.y+yo);T=Math.min(T,xe.x),A=Math.min(A,xe.y),L=Math.max(L,xe.x),N=Math.max(N,xe.y),m.push(xe)}const H=this.grid.query(T,A,L,N).concat(this.ignoredGrid.query(T,A,L,N)),Q={},se={};for(const pe of H){const xe=pe.key;if(Q[xe.bucketInstanceId]===void 0&&(Q[xe.bucketInstanceId]={}),Q[xe.bucketInstanceId][xe.featureIndex])continue;const Ee=[new i.pointGeometry(pe.x1,pe.y1),new i.pointGeometry(pe.x2,pe.y1),new i.pointGeometry(pe.x2,pe.y2),new i.pointGeometry(pe.x1,pe.y2)];i.polygonIntersectsPolygon(m,Ee)&&(Q[xe.bucketInstanceId][xe.featureIndex]=!0,se[xe.bucketInstanceId]===void 0&&(se[xe.bucketInstanceId]=[]),se[xe.bucketInstanceId].push(xe.featureIndex))}return se}insertCollisionBox(a,m,T,A,L,N){(T?this.ignoredGrid:this.grid).insert({bucketInstanceId:A,featureIndex:L,collisionGroupID:N,overlapMode:m},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,m,T,A,L,N){const H=T?this.ignoredGrid:this.grid,Q={bucketInstanceId:A,featureIndex:L,collisionGroupID:N,overlapMode:m};for(let se=0;se<a.length;se+=4)H.insertCircle(Q,a[se],a[se+1],a[se+2])}projectAndGetPerspectiveRatio(a,m,T,A){let L;return A?(L=[m,T,A(m,T),1],i.transformMat4(L,L,a)):(L=[m,T,0,1],sa(L,L,a)),{point:new i.pointGeometry((L[0]/L[3]+1)/2*this.transform.width+yo,(-L[1]/L[3]+1)/2*this.transform.height+yo),perspectiveRatio:.5+this.transform.cameraToCenterDistance/L[3]*.5}}isOffscreen(a,m,T,A){return T<yo||a>=this.screenRightBoundary||A<yo||m>this.screenBottomBoundary}isInsideGrid(a,m,T,A){return T>=0&&a<this.gridRightBoundary&&A>=0&&m<this.gridBottomBoundary}getViewportMatrix(){const a=i.identity([]);return i.translate(a,a,[-100,-100,0]),a}}function oo(C,a,m){return a*(i.EXTENT/(C.tileSize*Math.pow(2,m-C.tileID.overscaledZ)))}class so{constructor(a,m,T,A){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?m:-m))):A&&T?1:0,this.placed=T}isHidden(){return this.opacity===0&&!this.placed}}class pr{constructor(a,m,T,A,L){this.text=new so(a?a.text:null,m,T,L),this.icon=new so(a?a.icon:null,m,A,L)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class La{constructor(a,m,T){this.text=a,this.icon=m,this.skipFade=T}}class Ve{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class fe{constructor(a,m,T,A,L){this.bucketInstanceId=a,this.featureIndex=m,this.sourceLayerIndex=T,this.bucketIndex=A,this.tileID=L}}class ve{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const m=++this.maxGroupID;this.collisionGroups[a]={ID:m,predicate:T=>T.collisionGroupID===m}}return this.collisionGroups[a]}}function Oe(C,a,m,T,A){const{horizontalAlign:L,verticalAlign:N}=i.getAnchorAlignment(C),H=-(L-.5)*a,Q=-(N-.5)*m,se=i.evaluateVariableOffset(C,T);return new i.pointGeometry(H+se[0]*A,Q+se[1]*A)}function Je(C,a,m,T,A,L){const{x1:N,x2:H,y1:Q,y2:se,anchorPointX:pe,anchorPointY:xe}=C,Ee=new i.pointGeometry(a,m);return T&&Ee._rotate(A?L:-L),{x1:N+Ee.x,y1:Q+Ee.y,x2:H+Ee.x,y2:se+Ee.y,anchorPointX:pe,anchorPointY:xe}}class le{constructor(a,m,T,A,L){this.transform=a.clone(),this.terrain=m,this.collisionIndex=new aa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=T,this.retainedQueryData={},this.collisionGroups=new ve(A),this.collisionCircleArrays={},this.prevPlacement=L,L&&(L.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,m,T,A){const L=T.getBucket(m),N=T.latestFeatureIndex;if(!L||!N||m.id!==L.layerIds[0])return;const H=T.collisionBoxArray,Q=L.layers[0].layout,se=Math.pow(2,this.transform.zoom-T.tileID.overscaledZ),pe=T.tileSize/i.EXTENT,xe=this.transform.calculatePosMatrix(T.tileID.toUnwrapped()),Ee=Q.get("text-pitch-alignment")==="map",Qe=Q.get("text-rotation-alignment")==="map",Ge=oo(T,1,this.transform.zoom),We=Pr(xe,Ee,Qe,this.transform,Ge);let _t=null;if(Ee){const kt=Eo(xe,Ee,Qe,this.transform,Ge);_t=i.multiply([],this.transform.labelPlaneMatrix,kt)}this.retainedQueryData[L.bucketInstanceId]=new fe(L.bucketInstanceId,N,L.sourceLayerIndex,L.index,T.tileID);const Tt={bucket:L,layout:Q,posMatrix:xe,textLabelPlaneMatrix:We,labelToScreenMatrix:_t,scale:se,textPixelRatio:pe,holdingForFade:T.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(L.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(L.sourceID)};if(A)for(const kt of L.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:ft,symbolInstanceEnd:Rt}=kt;a.push({sortKey:ot,symbolInstanceStart:ft,symbolInstanceEnd:Rt,parameters:Tt})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:L.symbolInstances.length,parameters:Tt})}attemptAnchorPlacement(a,m,T,A,L,N,H,Q,se,pe,xe,Ee,Qe,Ge,We,_t){const Tt=[Ee.textOffset0,Ee.textOffset1],kt=Oe(a,T,A,Tt,L),ot=this.collisionIndex.placeCollisionBox(Je(m,kt.x,kt.y,N,H,this.transform.angle),xe,Q,se,pe.predicate,_t);if((!We||this.collisionIndex.placeCollisionBox(Je(We,kt.x,kt.y,N,H,this.transform.angle),xe,Q,se,pe.predicate,_t).box.length!==0)&&ot.box.length>0){let ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID].text&&(ft=this.prevPlacement.variableOffsets[Ee.crossTileID].anchor),Ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ee.crossTileID]={textOffset:Tt,width:T,height:A,anchor:a,textBoxScale:L,prevAnchor:ft},this.markUsedJustification(Qe,a,Ee,Ge),Qe.allowVerticalPlacement&&(this.markUsedOrientation(Qe,Ge,Ee),this.placedOrientations[Ee.crossTileID]=Ge),{shift:kt,placedGlyphBoxes:ot}}}placeLayerBucketPart(a,m,T){const{bucket:A,layout:L,posMatrix:N,textLabelPlaneMatrix:H,labelToScreenMatrix:Q,textPixelRatio:se,holdingForFade:pe,collisionBoxArray:xe,partiallyEvaluatedTextSize:Ee,collisionGroup:Qe}=a.parameters,Ge=L.get("text-optional"),We=L.get("icon-optional"),_t=i.getOverlapMode(L,"text-overlap","text-allow-overlap"),Tt=_t==="always",kt=i.getOverlapMode(L,"icon-overlap","icon-allow-overlap"),ot=kt==="always",ft=L.get("text-rotation-alignment")==="map",Rt=L.get("text-pitch-alignment")==="map",ii=L.get("icon-text-fit")!=="none",Qt=L.get("symbol-z-order")==="viewport-y",_i=Tt&&(ot||!A.hasIconData()||We),Jt=ot&&(Tt||!A.hasTextData()||Ge);!A.collisionArrays&&xe&&A.deserializeCollisionBoxes(xe);const Ji=(Vi,en)=>{if(m[Vi.crossTileID])return;if(pe)return void(this.placements[Vi.crossTileID]=new La(!1,!1,!1));let Rn=!1,$n=!1,dn=!0,xr=null,Cr={box:null,offscreen:null},ur={box:null,offscreen:null},hr=null,Dr=null,Wo=null,ba=0,da=0,wa=0;en.textFeatureIndex?ba=en.textFeatureIndex:Vi.useRuntimeCollisionCircles&&(ba=Vi.featureIndex),en.verticalTextFeatureIndex&&(da=en.verticalTextFeatureIndex);const Ua=this.retainedQueryData[A.bucketInstanceId].tileID,Zs=this.terrain?(_,o)=>this.terrain.getElevation(Ua,_,o):null;for(const _ of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const o=en[_];o&&(o.elevation=Zs?Zs(o.anchorPointX,o.anchorPointY):0)}const ws=en.textBox;if(ws){const _=f=>{let x=i.WritingMode.horizontal;if(A.allowVerticalPlacement&&!f&&this.prevPlacement){const S=this.prevPlacement.placedOrientations[Vi.crossTileID];S&&(this.placedOrientations[Vi.crossTileID]=S,x=S,this.markUsedOrientation(A,x,Vi))}return x},o=(f,x)=>{if(A.allowVerticalPlacement&&Vi.numVerticalGlyphVertices>0&&en.verticalTextBox){for(const S of A.writingModes)if(S===i.WritingMode.vertical?(Cr=x(),ur=Cr):Cr=f(),Cr&&Cr.box&&Cr.box.length)break}else Cr=f()};if(L.get("text-variable-anchor")){let f=L.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Vi.crossTileID]){const k=this.prevPlacement.variableOffsets[Vi.crossTileID];f.indexOf(k.anchor)>0&&(f=f.filter(O=>O!==k.anchor),f.unshift(k.anchor))}const x=(k,O,V)=>{const G=k.x2-k.x1,te=k.y2-k.y1,ie=Vi.textBoxScale,ge=ii&&kt==="never"?O:null;let Te={box:[],offscreen:!1};const Be=_t!=="never"?2*f.length:f.length;for(let Le=0;Le<Be;++Le){const Re=this.attemptAnchorPlacement(f[Le%f.length],k,G,te,ie,ft,Rt,se,N,Qe,Le>=f.length?_t:"never",Vi,A,V,ge,Zs);if(Re&&(Te=Re.placedGlyphBoxes,Te&&Te.box&&Te.box.length)){Rn=!0,xr=Re.shift;break}}return Te};o(()=>x(ws,en.iconBox,i.WritingMode.horizontal),()=>{const k=en.verticalTextBox;return A.allowVerticalPlacement&&!(Cr&&Cr.box&&Cr.box.length)&&Vi.numVerticalGlyphVertices>0&&k?x(k,en.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null}}),Cr&&(Rn=Cr.box,dn=Cr.offscreen);const S=_(Cr&&Cr.box);if(!Rn&&this.prevPlacement){const k=this.prevPlacement.variableOffsets[Vi.crossTileID];k&&(this.variableOffsets[Vi.crossTileID]=k,this.markUsedJustification(A,k.anchor,Vi,S))}}else{const f=(x,S)=>{const k=this.collisionIndex.placeCollisionBox(x,_t,se,N,Qe.predicate,Zs);return k&&k.box&&k.box.length&&(this.markUsedOrientation(A,S,Vi),this.placedOrientations[Vi.crossTileID]=S),k};o(()=>f(ws,i.WritingMode.horizontal),()=>{const x=en.verticalTextBox;return A.allowVerticalPlacement&&Vi.numVerticalGlyphVertices>0&&x?f(x,i.WritingMode.vertical):{box:null,offscreen:null}}),_(Cr&&Cr.box&&Cr.box.length)}}if(hr=Cr,Rn=hr&&hr.box&&hr.box.length>0,dn=hr&&hr.offscreen,Vi.useRuntimeCollisionCircles){const _=A.text.placedSymbolArray.get(Vi.centerJustifiedTextSymbolIndex),o=i.evaluateSizeForFeature(A.textSizeData,Ee,_),f=L.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(_t,_,A.lineVertexArray,A.glyphOffsetArray,o,N,H,Q,T,Rt,Qe.predicate,Vi.collisionCircleDiameter,f,Zs),Dr.circles.length&&Dr.collisionDetected&&!T&&i.warnOnce("Collisions detected, but collision boxes are not shown"),Rn=Tt||Dr.circles.length>0&&!Dr.collisionDetected,dn=dn&&Dr.offscreen}if(en.iconFeatureIndex&&(wa=en.iconFeatureIndex),en.iconBox){const _=o=>{const f=ii&&xr?Je(o,xr.x,xr.y,ft,Rt,this.transform.angle):o;return this.collisionIndex.placeCollisionBox(f,kt,se,N,Qe.predicate,Zs)};ur&&ur.box&&ur.box.length&&en.verticalIconBox?(Wo=_(en.verticalIconBox),$n=Wo.box.length>0):(Wo=_(en.iconBox),$n=Wo.box.length>0),dn=dn&&Wo.offscreen}const Ta=Ge||Vi.numHorizontalGlyphVertices===0&&Vi.numVerticalGlyphVertices===0,Rl=We||Vi.numIconVertices===0;if(Ta||Rl?Rl?Ta||($n=$n&&Rn):Rn=$n&&Rn:$n=Rn=$n&&Rn,Rn&&hr&&hr.box&&this.collisionIndex.insertCollisionBox(hr.box,_t,L.get("text-ignore-placement"),A.bucketInstanceId,ur&&ur.box&&da?da:ba,Qe.ID),$n&&Wo&&this.collisionIndex.insertCollisionBox(Wo.box,kt,L.get("icon-ignore-placement"),A.bucketInstanceId,wa,Qe.ID),Dr&&(Rn&&this.collisionIndex.insertCollisionCircles(Dr.circles,_t,L.get("text-ignore-placement"),A.bucketInstanceId,ba,Qe.ID),T)){const _=A.bucketInstanceId;let o=this.collisionCircleArrays[_];o===void 0&&(o=this.collisionCircleArrays[_]=new Ve);for(let f=0;f<Dr.circles.length;f+=4)o.circles.push(Dr.circles[f+0]),o.circles.push(Dr.circles[f+1]),o.circles.push(Dr.circles[f+2]),o.circles.push(Dr.collisionDetected?1:0)}if(Vi.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(A.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Vi.crossTileID]=new La(Rn||_i,$n||Jt,dn||A.justReloaded),m[Vi.crossTileID]=!0};if(Qt){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Vi=A.getSortedSymbolIndexes(this.transform.angle);for(let en=Vi.length-1;en>=0;--en){const Rn=Vi[en];Ji(A.symbolInstances.get(Rn),A.collisionArrays[Rn])}}else for(let Vi=a.symbolInstanceStart;Vi<a.symbolInstanceEnd;Vi++)Ji(A.symbolInstances.get(Vi),A.collisionArrays[Vi]);if(T&&A.bucketInstanceId in this.collisionCircleArrays){const Vi=this.collisionCircleArrays[A.bucketInstanceId];i.invert(Vi.invProjMatrix,N),Vi.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(a,m,T,A){let L;L=A===i.WritingMode.vertical?T.verticalPlacedTextSymbolIndex:{left:T.leftJustifiedTextSymbolIndex,center:T.centerJustifiedTextSymbolIndex,right:T.rightJustifiedTextSymbolIndex}[i.getAnchorJustification(m)];const N=[T.leftJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.rightJustifiedTextSymbolIndex,T.verticalPlacedTextSymbolIndex];for(const H of N)H>=0&&(a.text.placedSymbolArray.get(H).crossTileID=L>=0&&H!==L?0:T.crossTileID)}markUsedOrientation(a,m,T){const A=m===i.WritingMode.horizontal||m===i.WritingMode.horizontalOnly?m:0,L=m===i.WritingMode.vertical?m:0,N=[T.leftJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.rightJustifiedTextSymbolIndex];for(const H of N)a.text.placedSymbolArray.get(H).placedOrientation=A;T.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(T.verticalPlacedTextSymbolIndex).placedOrientation=L)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const m=this.prevPlacement;let T=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;const A=m?m.symbolFadeChange(a):1,L=m?m.opacities:{},N=m?m.variableOffsets:{},H=m?m.placedOrientations:{};for(const Q in this.placements){const se=this.placements[Q],pe=L[Q];pe?(this.opacities[Q]=new pr(pe,A,se.text,se.icon),T=T||se.text!==pe.text.placed||se.icon!==pe.icon.placed):(this.opacities[Q]=new pr(null,A,se.text,se.icon,se.skipFade),T=T||se.text||se.icon)}for(const Q in L){const se=L[Q];if(!this.opacities[Q]){const pe=new pr(se,A,!1,!1);pe.isHidden()||(this.opacities[Q]=pe,T=T||se.text.placed||se.icon.placed)}}for(const Q in N)this.variableOffsets[Q]||!this.opacities[Q]||this.opacities[Q].isHidden()||(this.variableOffsets[Q]=N[Q]);for(const Q in H)this.placedOrientations[Q]||!this.opacities[Q]||this.opacities[Q].isHidden()||(this.placedOrientations[Q]=H[Q]);if(m&&m.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");T?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:a)}updateLayerOpacities(a,m){const T={};for(const A of m){const L=A.getBucket(a);L&&A.latestFeatureIndex&&a.id===L.layerIds[0]&&this.updateBucketOpacities(L,T,A.collisionBoxArray)}}updateBucketOpacities(a,m,T){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const A=a.layers[0].layout,L=new pr(null,0,!1,!1,!0),N=A.get("text-allow-overlap"),H=A.get("icon-allow-overlap"),Q=A.get("text-variable-anchor"),se=A.get("text-rotation-alignment")==="map",pe=A.get("text-pitch-alignment")==="map",xe=A.get("icon-text-fit")!=="none",Ee=new pr(null,0,N&&(H||!a.hasIconData()||A.get("icon-optional")),H&&(N||!a.hasTextData()||A.get("text-optional")),!0);!a.collisionArrays&&T&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(T);const Qe=(Ge,We,_t)=>{for(let Tt=0;Tt<We/4;Tt++)Ge.opacityVertexArray.emplaceBack(_t)};for(let Ge=0;Ge<a.symbolInstances.length;Ge++){const We=a.symbolInstances.get(Ge),{numHorizontalGlyphVertices:_t,numVerticalGlyphVertices:Tt,crossTileID:kt}=We;let ot=this.opacities[kt];m[kt]?ot=L:ot||(ot=Ee,this.opacities[kt]=ot),m[kt]=!0;const ft=We.numIconVertices>0,Rt=this.placedOrientations[We.crossTileID],ii=Rt===i.WritingMode.vertical,Qt=Rt===i.WritingMode.horizontal||Rt===i.WritingMode.horizontalOnly;if(_t>0||Tt>0){const _i=it(ot.text);Qe(a.text,_t,ii?xt:_i),Qe(a.text,Tt,Qt?xt:_i);const Jt=ot.text.isHidden();[We.rightJustifiedTextSymbolIndex,We.centerJustifiedTextSymbolIndex,We.leftJustifiedTextSymbolIndex].forEach(en=>{en>=0&&(a.text.placedSymbolArray.get(en).hidden=Jt||ii?1:0)}),We.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(We.verticalPlacedTextSymbolIndex).hidden=Jt||Qt?1:0);const Ji=this.variableOffsets[We.crossTileID];Ji&&this.markUsedJustification(a,Ji.anchor,We,Rt);const Vi=this.placedOrientations[We.crossTileID];Vi&&(this.markUsedJustification(a,"left",We,Vi),this.markUsedOrientation(a,Vi,We))}if(ft){const _i=it(ot.icon),Jt=!(xe&&We.verticalPlacedIconSymbolIndex&&ii);We.placedIconSymbolIndex>=0&&(Qe(a.icon,We.numIconVertices,Jt?_i:xt),a.icon.placedSymbolArray.get(We.placedIconSymbolIndex).hidden=ot.icon.isHidden()),We.verticalPlacedIconSymbolIndex>=0&&(Qe(a.icon,We.numVerticalIconVertices,Jt?xt:_i),a.icon.placedSymbolArray.get(We.verticalPlacedIconSymbolIndex).hidden=ot.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const _i=a.collisionArrays[Ge];if(_i){let Jt=new i.pointGeometry(0,0);if(_i.textBox||_i.verticalTextBox){let Vi=!0;if(Q){const en=this.variableOffsets[kt];en?(Jt=Oe(en.anchor,en.width,en.height,en.textOffset,en.textBoxScale),se&&Jt._rotate(pe?this.transform.angle:-this.transform.angle)):Vi=!1}_i.textBox&&X(a.textCollisionBox.collisionVertexArray,ot.text.placed,!Vi||ii,Jt.x,Jt.y),_i.verticalTextBox&&X(a.textCollisionBox.collisionVertexArray,ot.text.placed,!Vi||Qt,Jt.x,Jt.y)}const Ji=Boolean(!Qt&&_i.verticalIconBox);_i.iconBox&&X(a.iconCollisionBox.collisionVertexArray,ot.icon.placed,Ji,xe?Jt.x:0,xe?Jt.y:0),_i.verticalIconBox&&X(a.iconCollisionBox.collisionVertexArray,ot.icon.placed,!Ji,xe?Jt.x:0,xe?Jt.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const Ge=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Ge.invProjMatrix,a.placementViewportMatrix=Ge.viewportMatrix,a.collisionCircleArray=Ge.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,m){const T=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*T>a}setStale(){this.stale=!0}}function X(C,a,m,T,A){C.emplaceBack(a?1:0,m?1:0,T||0,A||0),C.emplaceBack(a?1:0,m?1:0,T||0,A||0),C.emplaceBack(a?1:0,m?1:0,T||0,A||0),C.emplaceBack(a?1:0,m?1:0,T||0,A||0)}const ee=Math.pow(2,25),ae=Math.pow(2,24),he=Math.pow(2,17),Se=Math.pow(2,16),qe=Math.pow(2,9),De=Math.pow(2,8),Ue=Math.pow(2,1);function it(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const a=C.placed?1:0,m=Math.floor(127*C.opacity);return m*ee+a*ae+m*he+a*Se+m*qe+a*De+m*Ue+a}const xt=0;class Bt{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,m,T,A,L){const N=this._bucketParts;for(;this._currentTileIndex<a.length;)if(m.getBucketParts(N,A,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,L())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort((H,Q)=>H.sortKey-Q.sortKey));this._currentPartIndex<N.length;)if(m.placeLayerBucketPart(N[this._currentPartIndex],this._seenCrossTileIDs,T),this._currentPartIndex++,L())return!0;return!1}}class It{constructor(a,m,T,A,L,N,H,Q){this.placement=new le(a,m,N,H,Q),this._currentPlacementIndex=T.length-1,this._forceFullPlacement=A,this._showCollisionBoxes=L,this._done=!1}isDone(){return this._done}continuePlacement(a,m,T){const A=i.exported.now(),L=()=>{const N=i.exported.now()-A;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=m[a[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=H)&&(!N.maxzoom||N.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new Bt(N)),this._inProgressLayer.continuePlacement(T[N.source],this.placement,this._showCollisionBoxes,N,L))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Ci=512/i.EXTENT/2;class ri{constructor(a,m,T){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=T;for(let A=0;A<m.length;A++){const L=m.get(A),N=L.key;this.indexedSymbolInstances[N]||(this.indexedSymbolInstances[N]=[]),this.indexedSymbolInstances[N].push({crossTileID:L.crossTileID,coord:this.getScaledCoordinates(L,a)})}}getScaledCoordinates(a,m){const T=Ci/Math.pow(2,m.canonical.z-this.tileID.canonical.z);return{x:Math.floor((m.canonical.x*i.EXTENT+a.anchorX)*T),y:Math.floor((m.canonical.y*i.EXTENT+a.anchorY)*T)}}findMatches(a,m,T){const A=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z);for(let L=0;L<a.length;L++){const N=a.get(L);if(N.crossTileID)continue;const H=this.indexedSymbolInstances[N.key];if(!H)continue;const Q=this.getScaledCoordinates(N,m);for(const se of H)if(Math.abs(se.coord.x-Q.x)<=A&&Math.abs(se.coord.y-Q.y)<=A&&!T[se.crossTileID]){T[se.crossTileID]=!0,N.crossTileID=se.crossTileID;break}}}}class xi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const m=Math.round((a-this.lng)/360);if(m!==0)for(const T in this.indexes){const A=this.indexes[T],L={};for(const N in A){const H=A[N];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+m),L[H.tileID.key]=H}this.indexes[T]=L}this.lng=a}addBucket(a,m,T){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let L=0;L<m.symbolInstances.length;L++)m.symbolInstances.get(L).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const A=this.usedCrossTileIDs[a.overscaledZ];for(const L in this.indexes){const N=this.indexes[L];if(Number(L)>a.overscaledZ)for(const H in N){const Q=N[H];Q.tileID.isChildOf(a)&&Q.findMatches(m.symbolInstances,a,A)}else{const H=N[a.scaledTo(Number(L)).key];H&&H.findMatches(m.symbolInstances,a,A)}}for(let L=0;L<m.symbolInstances.length;L++){const N=m.symbolInstances.get(L);N.crossTileID||(N.crossTileID=T.generate(),A[N.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new ri(a,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(a,m){for(const T in m.indexedSymbolInstances)for(const A of m.indexedSymbolInstances[T])delete this.usedCrossTileIDs[a][A.crossTileID]}removeStaleBuckets(a){let m=!1;for(const T in this.indexes){const A=this.indexes[T];for(const L in A)a[A[L].bucketInstanceId]||(this.removeBucketCrossTileIDs(T,A[L]),delete A[L],m=!0)}return m}}class _n{constructor(){this.layerIndexes={},this.crossTileIDs=new xi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,m,T){let A=this.layerIndexes[a.id];A===void 0&&(A=this.layerIndexes[a.id]=new Gi);let L=!1;const N={};A.handleWrapJump(T);for(const H of m){const Q=H.getBucket(a);Q&&a.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(H.tileID,Q,this.crossTileIDs)&&(L=!0),N[Q.bucketInstanceId]=!0)}return A.removeStaleBuckets(N)&&(L=!0),L}pruneUnusedLayers(a){const m={};a.forEach(T=>{m[T]=!0});for(const T in this.layerIndexes)m[T]||delete this.layerIndexes[T]}}var Zn=i.createLayout([{name:"a_pos",type:"Int16",components:2}]);class xn extends i.Evented{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=a._cache.max,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const a in this._tiles){const m=this._tiles[a];m.textures.forEach(T=>T.destroy()),m.textures=[]}}update(a,m){this.sourceCache.update(a,m),this._renderableTilesKeys=[];for(const T of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:m}))this._renderableTilesKeys.push(T.key),this._tiles[T.key]||(T.posMatrix=new Float64Array(16),i.ortho(T.posMatrix,0,i.EXTENT,0,i.EXTENT,0,1),this._tiles[T.key]=new wn(T,this.tileSize))}removeOutdated(a){const m={};this.renderHistory=this.renderHistory.filter((T,A)=>this.renderHistory.indexOf(T)===A).slice(0,this.renderHistorySize);for(const T of this._renderableTilesKeys)m[T]=!0;for(const T of this.renderHistory)m[T]=!0;for(const T in this._tiles)m[T]||(this._tiles[T].clearTextures(a),delete this._tiles[T])}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const m={};for(const T of this._renderableTilesKeys){const A=this._tiles[T].tileID;if(A.canonical.equals(a.canonical)){const L=a.clone();L.posMatrix=new Float64Array(16),i.ortho(L.posMatrix,0,i.EXTENT,0,i.EXTENT,0,1),m[T]=L}else if(A.canonical.isChildOf(a.canonical)){const L=a.clone();L.posMatrix=new Float64Array(16);const N=A.canonical.z-a.canonical.z,H=A.canonical.x-(A.canonical.x>>N<<N),Q=A.canonical.y-(A.canonical.y>>N<<N),se=i.EXTENT>>N;i.ortho(L.posMatrix,0,se,0,se,0,1),i.translate(L.posMatrix,L.posMatrix,[-H*se,-Q*se,0]),m[T]=L}else if(a.canonical.isChildOf(A.canonical)){const L=a.clone();L.posMatrix=new Float64Array(16);const N=a.canonical.z-A.canonical.z,H=a.canonical.x-(a.canonical.x>>N<<N),Q=a.canonical.y-(a.canonical.y>>N<<N),se=i.EXTENT>>N;i.ortho(L.posMatrix,0,i.EXTENT,0,i.EXTENT,0,1),i.translate(L.posMatrix,L.posMatrix,[H*se,Q*se,0]),i.scale(L.posMatrix,L.posMatrix,[1/2**N,1/2**N,0]),m[T]=L}}return m}getSourceTile(a,m){const T=this.sourceCache._source;let A=a.overscaledZ-this.deltaZoom;if(A>T.maxzoom&&(A=T.maxzoom),A<T.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(A).key);let L=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!L||!L.dem)&&m)for(;A>=T.minzoom&&(!L||!L.dem);)L=this.sourceCache.getTileByID(a.scaledTo(A--).key);return L}tilesAfterTime(a=Date.now()){return Object.values(this._tiles).filter(m=>m.timeLoaded>=a)}}class Mt{constructor(a,m,T){this.style=a,this.sourceCache=new xn(m),this.options=T,this.exaggeration=typeof T.exaggeration=="number"?T.exaggeration:1,this.elevationOffset=typeof T.elevationOffset=="number"?T.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(a,m,T,A=i.EXTENT){if(!(m>=0&&m<A&&T>=0&&T<A))return this.elevationOffset;let L=0;const N=this.getTerrainData(a);if(N.tile&&N.tile.dem){const H=i.transformMat4$1([],[m/A*i.EXTENT,T/A*i.EXTENT],N.u_terrain_matrix),Q=[H[0]*N.tile.dem.dim,H[1]*N.tile.dem.dim],se=[Math.floor(Q[0]),Math.floor(Q[1])],pe=N.tile.dem.get(se[0],se[1]),xe=N.tile.dem.get(se[0],se[1]+1),Ee=N.tile.dem.get(se[0]+1,se[1]),Qe=N.tile.dem.get(se[0]+1,se[1]+1);L=i.number(i.number(pe,xe,Q[0]-se[0]),i.number(Ee,Qe,Q[0]-se[0]),Q[1]-se[1])}return L}rememberForRerender(a,m){for(const T in this.sourceCache._tiles){const A=this.sourceCache._tiles[T];(A.tileID.equals(m)||A.tileID.isChildOf(m))&&(a===this.sourceCache.sourceCache.id&&(A.timeLoaded=Date.now()),this._rerender[a]=this._rerender[a]||{},this._rerender[a][A.tileID.key]=!0)}}needsRerender(a,m){return this._rerender[a]&&this._rerender[a][m.key]}clearRerenderCache(){this._rerender={}}getElevation(a,m,T,A=i.EXTENT){return(this.getDEMElevation(a,m,T,A)+this.elevationOffset)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const A=this.style.map.painter.context,L=new i.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(A,L,A.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(A,new i.RGBAImage({width:1,height:1}),A.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=i.identity([])}const m=this.sourceCache.getSourceTile(a,!0);if(m&&m.dem&&(!m.demTexture||m.needsTerrainPrepare)){const A=this.style.map.painter.context;m.demTexture=this.style.map.painter.getTileTexture(m.dem.stride),m.demTexture?m.demTexture.update(m.dem.getPixels(),{premultiply:!1}):m.demTexture=new we(A,m.dem.getPixels(),A.gl.RGBA,{premultiply:!1}),m.demTexture.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),m.needsTerrainPrepare=!1}const T=m&&m+m.tileID.key+a.key;if(T&&!this._demMatrixCache[T]){const A=this.sourceCache.sourceCache._source.maxzoom;let L=a.canonical.z-m.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=A?L=a.canonical.z-A:i.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const N=a.canonical.x-(a.canonical.x>>L<<L),H=a.canonical.y-(a.canonical.y>>L<<L),Q=i.fromScaling(new Float64Array(16),[1/(i.EXTENT<<L),1/(i.EXTENT<<L),0]);i.translate(Q,Q,[N*i.EXTENT,H*i.EXTENT,0]),this._demMatrixCache[a.key]={matrix:Q,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:m&&m.dem&&m.dem.dim||1,u_terrain_matrix:T?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:m&&m.dem&&m.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(m&&m.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:m}}getRTTFramebuffer(){const a=this.style.map.painter;if(!this._rttFramebuffer){const m=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=a.context.createFramebuffer(m,m,!0),this._rttFramebuffer.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,m,m))}return this._rttFramebuffer}getFramebuffer(a){const m=this.style.map.painter,T=m.width/devicePixelRatio,A=m.height/devicePixelRatio;return!this._fbo||this._fbo.width===T&&this._fbo.height===A||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(m.context,{width:T,height:A,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(m.context,{width:T,height:A,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=m.context.createFramebuffer(T,A,!0),this._fbo.depthAttachment.set(m.context.createRenderbuffer(m.context.gl.DEPTH_COMPONENT16,T,A))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const m=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let L=0,N=0;L<this._coordsTextureSize;L++)for(let H=0;H<this._coordsTextureSize;H++,N+=4)m[N+0]=255&H,m[N+1]=255&L,m[N+2]=H>>8<<4|L>>8,m[N+3]=0;const T=new i.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(m.buffer)),A=new we(a,T,a.gl.RGBA,{premultiply:!1});return A.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=A,A}pointCoordinate(a){const m=new Uint8Array(4),T=this.style.map.painter,A=T.context,L=A.gl;A.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),L.readPixels(a.x,T.height/devicePixelRatio-a.y-1,1,1,L.RGBA,L.UNSIGNED_BYTE,m),A.bindFramebuffer.set(null);const N=m[0]+(m[2]>>4<<8),H=m[1]+((15&m[2])<<8),Q=this.coordsIndex[255-m[3]],se=Q&&this.sourceCache.getTileByID(Q);if(!se)return null;const pe=this._coordsTextureSize,xe=(1<<se.tileID.canonical.z)*pe;return new i.MercatorCoordinate((se.tileID.canonical.x*pe+N)/xe,(se.tileID.canonical.y*pe+H)/xe,this.getElevation(se.tileID,N,H,pe))}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.style.map.painter.context,m=new i.PosArray,T=new i.TriangleIndexArray,A=this.meshSize,L=i.EXTENT/A,N=A*A;for(let H=0;H<=A;H++)for(let Q=0;Q<=A;Q++)m.emplaceBack(Q*L,H*L);for(let H=0;H<N;H+=A+1)for(let Q=0;Q<A;Q++)T.emplaceBack(Q+H,A+Q+H+1,A+Q+H+2),T.emplaceBack(Q+H,A+Q+H+2,Q+H+1);return this._mesh={indexBuffer:a.createIndexBuffer(T),vertexBuffer:a.createVertexBuffer(m,Zn.members),segments:i.SegmentVector.simpleSegment(0,0,m.length,T.length)},this._mesh}getMinMaxElevation(a){const m=this.getTerrainData(a).tile,T={minElevation:null,maxElevation:null};return m&&m.dem&&(T.minElevation=(m.dem.min+this.elevationOffset)*this.exaggeration,T.maxElevation=(m.dem.max+this.elevationOffset)*this.exaggeration),T}}const Gn=(C,a)=>i.emitValidationErrors(C,a&&a.filter(m=>m.identifier!=="source.canvas")),Fn=i.pick(ci,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qr=i.pick(ci,["setCenter","setZoom","setBearing","setPitch"]),ao=function(){const C={},a=i.spec.$version;for(const m in i.spec.$root){const T=i.spec.$root[m];if(T.required){let A=null;A=m==="version"?a:T.type==="array"?[]:{},A!=null&&(C[m]=A)}}return C}();class $r extends i.Evented{constructor(a,m={}){super(),this.map=a,this.dispatcher=new vt(gi(),this),this.imageManager=new $e,this.imageManager.setEventedParent(this),this.glyphManager=new Me(a._requestManager,m.localIdeographFontFamily),this.lineAtlas=new gt(256,512),this.crossTileSymbolIndex=new _n,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new i.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());const T=this;this._rtlTextPluginCallback=$r.registerForPluginStateChange(A=>{T.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},(L,N)=>{if(i.triggerPluginCompletionEvent(L),N&&N.every(H=>H))for(const H in T.sourceCaches)T.sourceCaches[H].reload()})}),this.on("data",A=>{if(A.dataType!=="source"||A.sourceDataType!=="metadata")return;const L=this.sourceCaches[A.sourceId];if(!L)return;const N=L.getSource();if(N&&N.vectorLayerIds)for(const H in this._layers){const Q=this._layers[H];Q.source===N.id&&this._validateLayer(Q)}})}loadURL(a,m={}){this.fire(new i.Event("dataloading",{dataType:"style"}));const T=typeof m.validate!="boolean"||m.validate,A=this.map._requestManager.transformRequest(a,i.ResourceType.Style);this._request=i.getJSON(A,(L,N)=>{this._request=null,L?this.fire(new i.ErrorEvent(L)):N&&this._load(N,T)})}loadJSON(a,m={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(a,m.validate!==!1)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(ao,!1)}_load(a,m){if(m&&Gn(this,i.validateStyle(a)))return;this._loaded=!0,this.stylesheet=a;for(const A in a.sources)this.addSource(A,a.sources[A],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);const T=Ki(this.stylesheet.layers);this._order=T.map(A=>A.id),this._layers={},this._serializedLayers={};for(let A of T)A=i.createStyleLayer(A),A.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=A,this._serializedLayers[A.id]=A.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new rt(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}_loadSprite(a){this._spriteRequest=function(m,T,A,L){let N,H,Q;const se=A>1?"@2x":"";let pe=i.getJSON(T.transformRequest(T.normalizeSpriteURL(m,se,".json"),i.ResourceType.SpriteJSON),(Qe,Ge)=>{pe=null,Q||(Q=Qe,N=Ge,Ee())}),xe=i.getImage(T.transformRequest(T.normalizeSpriteURL(m,se,".png"),i.ResourceType.SpriteImage),(Qe,Ge)=>{xe=null,Q||(Q=Qe,H=Ge,Ee())});function Ee(){if(Q)L(Q);else if(N&&H){const Qe=i.exported.getImageData(H),Ge={};for(const We in N){const{width:_t,height:Tt,x:kt,y:ot,sdf:ft,pixelRatio:Rt,stretchX:ii,stretchY:Qt,content:_i}=N[We],Jt=new i.RGBAImage({width:_t,height:Tt});i.RGBAImage.copy(Qe,Jt,{x:kt,y:ot},{x:0,y:0},{width:_t,height:Tt}),Ge[We]={data:Jt,pixelRatio:Rt,sdf:ft,stretchX:ii,stretchY:Qt,content:_i}}L(null,Ge)}}return{cancel(){pe&&(pe.cancel(),pe=null),xe&&(xe.cancel(),xe=null)}}}(a,this.map._requestManager,this.map.getPixelRatio(),(m,T)=>{if(this._spriteRequest=null,m)this.fire(new i.ErrorEvent(m));else if(T)for(const A in T)this.imageManager.addImage(A,T[A]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(a){const m=this.sourceCaches[a.source];if(!m)return;const T=a.sourceLayer;if(!T)return;const A=m.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(T)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${T}" does not exist on source "${A.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const m=[];for(const T of a){const A=this._layers[T];A.type!=="custom"&&m.push(A.serialize())}return m}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const m=this._changed;if(this._changed){const A=Object.keys(this._updatedLayers),L=Object.keys(this._removedLayers);(A.length||L.length)&&this._updateWorkerLayers(A,L);for(const N in this._updatedSources){const H=this._updatedSources[N];if(H==="reload")this._reloadSource(N);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource(N)}}this._updateTilesForChangedImages();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const T={};for(const A in this.sourceCaches){const L=this.sourceCaches[A];T[A]=L.used,L.used=!1}for(const A of this._order){const L=this._layers[A];L.recalculate(a,this._availableImages),!L.isHidden(a.zoom)&&L.source&&(this.sourceCaches[L.source].used=!0)}for(const A in T){const L=this.sourceCaches[A];T[A]!==L.used&&L.fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:A}))}this.light.recalculate(a),this.z=a.zoom,m&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(a){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),a){const m=this.sourceCaches[a.source];if(!m)throw new Error(`cannot load terrain, because there exists no source with ID: ${a.source}`);this.terrain=new Mt(this,m,a),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=T=>{T.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=T=>{T.tile&&(T.sourceId===a.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(T.sourceId,T.tile.tileID)):T.source.type==="geojson"&&this.terrain.rememberForRerender(T.sourceId,T.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new i.Event("terrain",{terrain:a}))}setState(a){if(this._checkLoaded(),Gn(this,i.validateStyle(a)))return!1;(a=i.clone$1(a)).layers=Ki(a.layers);const m=function(A,L){if(!A)return[{command:ci.setStyle,args:[L]}];let N=[];try{if(!Y(A.version,L.version))return[{command:ci.setStyle,args:[L]}];Y(A.center,L.center)||N.push({command:ci.setCenter,args:[L.center]}),Y(A.zoom,L.zoom)||N.push({command:ci.setZoom,args:[L.zoom]}),Y(A.bearing,L.bearing)||N.push({command:ci.setBearing,args:[L.bearing]}),Y(A.pitch,L.pitch)||N.push({command:ci.setPitch,args:[L.pitch]}),Y(A.sprite,L.sprite)||N.push({command:ci.setSprite,args:[L.sprite]}),Y(A.glyphs,L.glyphs)||N.push({command:ci.setGlyphs,args:[L.glyphs]}),Y(A.transition,L.transition)||N.push({command:ci.setTransition,args:[L.transition]}),Y(A.light,L.light)||N.push({command:ci.setLight,args:[L.light]});const H={},Q=[];(function(pe,xe,Ee,Qe){let Ge;for(Ge in xe=xe||{},pe=pe||{})Object.prototype.hasOwnProperty.call(pe,Ge)&&(Object.prototype.hasOwnProperty.call(xe,Ge)||Si(Ge,Ee,Qe));for(Ge in xe)Object.prototype.hasOwnProperty.call(xe,Ge)&&(Object.prototype.hasOwnProperty.call(pe,Ge)?Y(pe[Ge],xe[Ge])||(pe[Ge].type==="geojson"&&xe[Ge].type==="geojson"&&on(pe,xe,Ge)?Ee.push({command:ci.setGeoJSONSourceData,args:[Ge,xe[Ge].data]}):tn(Ge,xe,Ee,Qe)):Pi(Ge,xe,Ee))})(A.sources,L.sources,Q,H);const se=[];A.layers&&A.layers.forEach(pe=>{H[pe.source]?N.push({command:ci.removeLayer,args:[pe.id]}):se.push(pe)}),N=N.concat(Q),function(pe,xe,Ee){xe=xe||[];const Qe=(pe=pe||[]).map(Tn),Ge=xe.map(Tn),We=pe.reduce(On,{}),_t=xe.reduce(On,{}),Tt=Qe.slice(),kt=Object.create(null);let ot,ft,Rt,ii,Qt,_i,Jt;for(ot=0,ft=0;ot<Qe.length;ot++)Rt=Qe[ot],Object.prototype.hasOwnProperty.call(_t,Rt)?ft++:(Ee.push({command:ci.removeLayer,args:[Rt]}),Tt.splice(Tt.indexOf(Rt,ft),1));for(ot=0,ft=0;ot<Ge.length;ot++)Rt=Ge[Ge.length-1-ot],Tt[Tt.length-1-ot]!==Rt&&(Object.prototype.hasOwnProperty.call(We,Rt)?(Ee.push({command:ci.removeLayer,args:[Rt]}),Tt.splice(Tt.lastIndexOf(Rt,Tt.length-ft),1)):ft++,_i=Tt[Tt.length-ot],Ee.push({command:ci.addLayer,args:[_t[Rt],_i]}),Tt.splice(Tt.length-ot,0,Rt),kt[Rt]=!0);for(ot=0;ot<Ge.length;ot++)if(Rt=Ge[ot],ii=We[Rt],Qt=_t[Rt],!kt[Rt]&&!Y(ii,Qt))if(Y(ii.source,Qt.source)&&Y(ii["source-layer"],Qt["source-layer"])&&Y(ii.type,Qt.type)){for(Jt in hn(ii.layout,Qt.layout,Ee,Rt,null,ci.setLayoutProperty),hn(ii.paint,Qt.paint,Ee,Rt,null,ci.setPaintProperty),Y(ii.filter,Qt.filter)||Ee.push({command:ci.setFilter,args:[Rt,Qt.filter]}),Y(ii.minzoom,Qt.minzoom)&&Y(ii.maxzoom,Qt.maxzoom)||Ee.push({command:ci.setLayerZoomRange,args:[Rt,Qt.minzoom,Qt.maxzoom]}),ii)Object.prototype.hasOwnProperty.call(ii,Jt)&&Jt!=="layout"&&Jt!=="paint"&&Jt!=="filter"&&Jt!=="metadata"&&Jt!=="minzoom"&&Jt!=="maxzoom"&&(Jt.indexOf("paint.")===0?hn(ii[Jt],Qt[Jt],Ee,Rt,Jt.slice(6),ci.setPaintProperty):Y(ii[Jt],Qt[Jt])||Ee.push({command:ci.setLayerProperty,args:[Rt,Jt,Qt[Jt]]}));for(Jt in Qt)Object.prototype.hasOwnProperty.call(Qt,Jt)&&!Object.prototype.hasOwnProperty.call(ii,Jt)&&Jt!=="layout"&&Jt!=="paint"&&Jt!=="filter"&&Jt!=="metadata"&&Jt!=="minzoom"&&Jt!=="maxzoom"&&(Jt.indexOf("paint.")===0?hn(ii[Jt],Qt[Jt],Ee,Rt,Jt.slice(6),ci.setPaintProperty):Y(ii[Jt],Qt[Jt])||Ee.push({command:ci.setLayerProperty,args:[Rt,Jt,Qt[Jt]]}))}else Ee.push({command:ci.removeLayer,args:[Rt]}),_i=Tt[Tt.lastIndexOf(Rt)+1],Ee.push({command:ci.addLayer,args:[Qt,_i]})}(se,L.layers,N)}catch(H){console.warn("Unable to compute style diff:",H),N=[{command:ci.setStyle,args:[L]}]}return N}(this.serialize(),a).filter(A=>!(A.command in Qr));if(m.length===0)return!1;const T=m.filter(A=>!(A.command in Fn));if(T.length>0)throw new Error(`Unimplemented: ${T.map(A=>A.command).join(", ")}.`);return m.forEach(A=>{A.command!=="setTransition"&&this[A.command].apply(this,A.args)}),this.stylesheet=a,!0}addImage(a,m){if(this.getImage(a))return this.fire(new i.ErrorEvent(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,m),this._afterImageUpdated(a)}updateImage(a,m){this.imageManager.updateImage(a,m)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new i.ErrorEvent(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,m,T={}){if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(i.validateStyle.source,`sources.${a}`,m,null,T))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);const A=this.sourceCaches[a]=new Xr(a,m,this.dispatcher);A.style=this,A.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:A.serialize(),sourceId:a})),A.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const T in this._layers)if(this._layers[T].source===a)return this.fire(new i.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${T}" is using it.`)));const m=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],m.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),m.setEventedParent(null),m.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,m){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const T=this.sourceCaches[a].getSource();if(T.type!=="geojson")throw new Error(`geojsonSource.type is ${T.type}, which is !== 'geojson`);T.setData(m),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,m,T={}){this._checkLoaded();const A=a.id;if(this.getLayer(A))return void this.fire(new i.ErrorEvent(new Error(`Layer "${A}" already exists on this map.`)));let L;if(a.type==="custom"){if(Gn(this,i.validateCustomStyleLayer(a)))return;L=i.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(A,a.source),a=i.clone$1(a),a=i.extend(a,{source:A})),this._validate(i.validateStyle.layer,`layers.${A}`,a,{arrayIndex:-1},T))return;L=i.createStyleLayer(a),this._validateLayer(L),L.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[L.id]=L.serialize()}const N=m?this._order.indexOf(m):this._order.length;if(m&&N===-1)this.fire(new i.ErrorEvent(new Error(`Cannot add layer "${A}" before non-existing layer "${m}".`)));else{if(this._order.splice(N,0,A),this._layerOrderChanged=!0,this._layers[A]=L,this._removedLayers[A]&&L.source&&L.type!=="custom"){const H=this._removedLayers[A];delete this._removedLayers[A],H.type!==L.type?this._updatedSources[L.source]="clear":(this._updatedSources[L.source]="reload",this.sourceCaches[L.source].pause())}this._updateLayer(L),L.onAdd&&L.onAdd(this.map)}}moveLayer(a,m){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new i.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===m)return;const T=this._order.indexOf(a);this._order.splice(T,1);const A=m?this._order.indexOf(m):this._order.length;m&&A===-1?this.fire(new i.ErrorEvent(new Error(`Cannot move layer "${a}" before non-existing layer "${m}".`))):(this._order.splice(A,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const m=this._layers[a];if(!m)return void this.fire(new i.ErrorEvent(new Error(`Cannot remove non-existing layer "${a}".`)));m.setEventedParent(null);const T=this._order.indexOf(a);this._order.splice(T,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=m,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],m.onRemove&&m.onRemove(this.map)}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,m,T){this._checkLoaded();const A=this.getLayer(a);A?A.minzoom===m&&A.maxzoom===T||(m!=null&&(A.minzoom=m),T!=null&&(A.maxzoom=T),this._updateLayer(A)):this.fire(new i.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,m,T={}){this._checkLoaded();const A=this.getLayer(a);if(A){if(!Y(A.filter,m))return m==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(i.validateStyle.filter,`layers.${A.id}.filter`,m,null,T)||(A.filter=i.clone$1(m),this._updateLayer(A)))}else this.fire(new i.ErrorEvent(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return i.clone$1(this.getLayer(a).filter)}setLayoutProperty(a,m,T,A={}){this._checkLoaded();const L=this.getLayer(a);L?Y(L.getLayoutProperty(m),T)||(L.setLayoutProperty(m,T,A),this._updateLayer(L)):this.fire(new i.ErrorEvent(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,m){const T=this.getLayer(a);if(T)return T.getLayoutProperty(m);this.fire(new i.ErrorEvent(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,m,T,A={}){this._checkLoaded();const L=this.getLayer(a);L?Y(L.getPaintProperty(m),T)||(L.setPaintProperty(m,T,A)&&this._updateLayer(L),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new i.ErrorEvent(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,m){return this.getLayer(a).getPaintProperty(m)}setFeatureState(a,m){this._checkLoaded();const T=a.source,A=a.sourceLayer,L=this.sourceCaches[T];if(L===void 0)return void this.fire(new i.ErrorEvent(new Error(`The source '${T}' does not exist in the map's style.`)));const N=L.getSource().type;N==="geojson"&&A?this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||A?(a.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),L.setFeatureState(A,a.id,m)):this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,m){this._checkLoaded();const T=a.source,A=this.sourceCaches[T];if(A===void 0)return void this.fire(new i.ErrorEvent(new Error(`The source '${T}' does not exist in the map's style.`)));const L=A.getSource().type,N=L==="vector"?a.sourceLayer:void 0;L!=="vector"||N?m&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(N,a.id,m):this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const m=a.source,T=a.sourceLayer,A=this.sourceCaches[m];if(A!==void 0)return A.getSource().type!=="vector"||T?(a.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(T,a.id)):void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new i.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:i.mapObject(this.sourceCaches,a=>a.serialize()),layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(a){const m=N=>this._layers[N].type==="fill-extrusion",T={},A=[];for(let N=this._order.length-1;N>=0;N--){const H=this._order[N];if(m(H)){T[H]=N;for(const Q of a){const se=Q[H];if(se)for(const pe of se)A.push(pe)}}}A.sort((N,H)=>H.intersectionZ-N.intersectionZ);const L=[];for(let N=this._order.length-1;N>=0;N--){const H=this._order[N];if(m(H))for(let Q=A.length-1;Q>=0;Q--){const se=A[Q].feature;if(T[se.layer.id]<N)break;L.push(se),A.pop()}else for(const Q of a){const se=Q[H];if(se)for(const pe of se)L.push(pe.feature)}}return L}queryRenderedFeatures(a,m,T){m&&m.filter&&this._validate(i.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);const A={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of m.layers){const H=this._layers[N];if(!H)return this.fire(new i.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];A[H.source]=!0}}const L=[];m.availableImages=this._availableImages;for(const N in this.sourceCaches)m.layers&&!A[N]||L.push(Li(this.sourceCaches[N],this._layers,this._serializedLayers,a,m,T));return this.placement&&L.push(function(N,H,Q,se,pe,xe,Ee){const Qe={},Ge=xe.queryRenderedSymbols(se),We=[];for(const _t of Object.keys(Ge).map(Number))We.push(Ee[_t]);We.sort(En);for(const _t of We){const Tt=_t.featureIndex.lookupSymbolFeatures(Ge[_t.bucketInstanceId],H,_t.bucketIndex,_t.sourceLayerIndex,pe.filter,pe.layers,pe.availableImages,N);for(const kt in Tt){const ot=Qe[kt]=Qe[kt]||[],ft=Tt[kt];ft.sort((Rt,ii)=>{const Qt=_t.featureSortOrder;if(Qt){const _i=Qt.indexOf(Rt.featureIndex);return Qt.indexOf(ii.featureIndex)-_i}return ii.featureIndex-Rt.featureIndex});for(const Rt of ft)ot.push(Rt)}}for(const _t in Qe)Qe[_t].forEach(Tt=>{const kt=Tt.feature,ot=Q[N[_t].source].getFeatureState(kt.layer["source-layer"],kt.id);kt.source=kt.layer.source,kt.layer["source-layer"]&&(kt.sourceLayer=kt.layer["source-layer"]),kt.state=ot});return Qe}(this._layers,this._serializedLayers,this.sourceCaches,a,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(L)}querySourceFeatures(a,m){m&&m.filter&&this._validate(i.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);const T=this.sourceCaches[a];return T?function(A,L){const N=A.getRenderableIds().map(se=>A.getTileByID(se)),H=[],Q={};for(let se=0;se<N.length;se++){const pe=N[se],xe=pe.tileID.canonical.key;Q[xe]||(Q[xe]=!0,pe.querySourceFeatures(H,L))}return H}(T,m):[]}addSourceType(a,m,T){return $r.getSourceType(a)?T(new Error(`A source type called "${a}" already exists.`)):($r.setSourceType(a,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:m.workerSourceURL},T):T(null,null))}getLight(){return this.light.getLight()}setLight(a,m={}){this._checkLoaded();const T=this.light.getLight();let A=!1;for(const N in a)if(!Y(a[N],T[N])){A=!0;break}if(!A)return;const L={now:i.exported.now(),transition:i.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,m),this.light.updateTransitions(L)}_validate(a,m,T,A,L={}){return(!L||L.validate!==!1)&&Gn(this,a.call(i.validateStyle,i.extend({key:m,style:this.serialize(),value:T,styleSpec:i.spec},A)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const m=this.sourceCaches[a];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const m in this.sourceCaches)this.sourceCaches[m].update(a,this.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,m,T,A,L=!1){let N=!1,H=!1;const Q={};for(const se of this._order){const pe=this._layers[se];if(pe.type!=="symbol")continue;if(!Q[pe.source]){const Ee=this.sourceCaches[pe.source];Q[pe.source]=Ee.getRenderableIds(!0).map(Qe=>Ee.getTileByID(Qe)).sort((Qe,Ge)=>Ge.tileID.overscaledZ-Qe.tileID.overscaledZ||(Qe.tileID.isLessThan(Ge.tileID)?-1:1))}const xe=this.crossTileSymbolIndex.addLayer(pe,Q[pe.source],a.center.lng);N=N||xe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((L=L||this._layerOrderChanged||T===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),a.zoom))&&(this.pauseablePlacement=new It(a,this.terrain,this._order,L,m,T,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),H=!0),N&&this.pauseablePlacement.placement.setStale()),H||N)for(const se of this._order){const pe=this._layers[se];pe.type==="symbol"&&this.placement.updateLayerOpacities(pe,Q[pe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,m,T){this.imageManager.getImages(m.icons,T),this._updateTilesForChangedImages();const A=this.sourceCaches[m.source];A&&A.setDependencies(m.tileID.key,m.type,m.icons)}getGlyphs(a,m,T){this.glyphManager.getGlyphs(m.stacks,T)}getResource(a,m,T){return i.makeRequest(m,T)}}$r.getSourceType=function(C){return mn[C]},$r.setSourceType=function(C,a){mn[C]=a},$r.registerForPluginStateChange=i.registerForPluginStateChange;var el="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Sc={prelude:Wn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Wn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Wn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Wn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Wn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Wn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Wn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Wn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Wn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Wn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Wn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Wn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Wn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Wn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Wn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Wn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Wn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Wn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Wn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Wn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Wn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Wn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Wn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",el),terrainDepth:Wn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",el),terrainCoords:Wn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",el)};function Wn(C,a){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,T=a.match(/attribute ([\w]+) ([\w]+)/g),A=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),N=L?L.concat(A):A,H={};return{fragmentSource:C=C.replace(m,(Q,se,pe,xe,Ee)=>(H[Ee]=!0,se==="define"?`
#ifndef HAS_UNIFORM_u_${Ee}
varying ${pe} ${xe} ${Ee};
#else
uniform ${pe} ${xe} u_${Ee};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Ee}
    ${pe} ${xe} ${Ee} = u_${Ee};
#endif
`)),vertexSource:a=a.replace(m,(Q,se,pe,xe,Ee)=>{const Qe=xe==="float"?"vec2":"vec4",Ge=Ee.match(/color/)?"color":Qe;return H[Ee]?se==="define"?`
#ifndef HAS_UNIFORM_u_${Ee}
uniform lowp float u_${Ee}_t;
attribute ${pe} ${Qe} a_${Ee};
varying ${pe} ${xe} ${Ee};
#else
uniform ${pe} ${xe} u_${Ee};
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ee}
    ${Ee} = a_${Ee};
#else
    ${pe} ${xe} ${Ee} = u_${Ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ee}
    ${Ee} = unpack_mix_${Ge}(a_${Ee}, u_${Ee}_t);
#else
    ${pe} ${xe} ${Ee} = u_${Ee};
#endif
`:se==="define"?`
#ifndef HAS_UNIFORM_u_${Ee}
uniform lowp float u_${Ee}_t;
attribute ${pe} ${Qe} a_${Ee};
#else
uniform ${pe} ${xe} u_${Ee};
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ee}
    ${pe} ${xe} ${Ee} = a_${Ee};
#else
    ${pe} ${xe} ${Ee} = u_${Ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ee}
    ${pe} ${xe} ${Ee} = unpack_mix_${Ge}(a_${Ee}, u_${Ee}_t);
#else
    ${pe} ${xe} ${Ee} = u_${Ee};
#endif
`}),staticAttributes:T,staticUniforms:N}}class Fi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,m,T,A,L,N,H,Q,se){this.context=a;let pe=this.boundPaintVertexBuffers.length!==A.length;for(let xe=0;!pe&&xe<A.length;xe++)this.boundPaintVertexBuffers[xe]!==A[xe]&&(pe=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===m&&this.boundLayoutVertexBuffer===T&&!pe&&this.boundIndexBuffer===L&&this.boundVertexOffset===N&&this.boundDynamicVertexBuffer===H&&this.boundDynamicVertexBuffer2===Q&&this.boundDynamicVertexBuffer3===se?(a.bindVertexArrayOES.set(this.vao),H&&H.bind(),L&&L.dynamicDraw&&L.bind(),Q&&Q.bind(),se&&se.bind()):this.freshBind(m,T,A,L,N,H,Q,se)}freshBind(a,m,T,A,L,N,H,Q){let se;const pe=a.numAttributes,xe=this.context,Ee=xe.gl;if(xe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=xe.extVertexArrayObject.createVertexArrayOES(),xe.bindVertexArrayOES.set(this.vao),se=0,this.boundProgram=a,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=T,this.boundIndexBuffer=A,this.boundVertexOffset=L,this.boundDynamicVertexBuffer=N,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=Q;else{se=xe.currentNumAttributes||0;for(let Qe=pe;Qe<se;Qe++)Ee.disableVertexAttribArray(Qe)}m.enableAttributes(Ee,a);for(const Qe of T)Qe.enableAttributes(Ee,a);N&&N.enableAttributes(Ee,a),H&&H.enableAttributes(Ee,a),Q&&Q.enableAttributes(Ee,a),m.bind(),m.setVertexAttribPointers(Ee,a,L);for(const Qe of T)Qe.bind(),Qe.setVertexAttribPointers(Ee,a,L);N&&(N.bind(),N.setVertexAttribPointers(Ee,a,L)),A&&A.bind(),H&&(H.bind(),H.setVertexAttribPointers(Ee,a,L)),Q&&(Q.bind(),Q.setVertexAttribPointers(Ee,a,L)),xe.currentNumAttributes=pe}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Jn(C){const a=[];for(let m=0;m<C.length;m++){if(C[m]===null)continue;const T=C[m].split(" ");a.push(T.pop())}return a}class Xn{constructor(a,m,T,A,L,N,H){const Q=a.gl;this.program=Q.createProgram();const se=Jn(T.staticAttributes),pe=A?A.getBinderAttributes():[],xe=se.concat(pe),Ee=Sc.prelude.staticUniforms?Jn(Sc.prelude.staticUniforms):[],Qe=T.staticUniforms?Jn(T.staticUniforms):[],Ge=A?A.getBinderUniforms():[],We=Ee.concat(Qe).concat(Ge),_t=[];for(const Qt of We)_t.indexOf(Qt)<0&&_t.push(Qt);const Tt=A?A.defines():[];N&&Tt.push("#define OVERDRAW_INSPECTOR;"),H&&Tt.push("#define TERRAIN3D;");const kt=Tt.concat(Sc.prelude.fragmentSource,T.fragmentSource).join(`
`),ot=Tt.concat(Sc.prelude.vertexSource,T.vertexSource).join(`
`),ft=Q.createShader(Q.FRAGMENT_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);Q.shaderSource(ft,kt),Q.compileShader(ft),Q.attachShader(this.program,ft);const Rt=Q.createShader(Q.VERTEX_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);Q.shaderSource(Rt,ot),Q.compileShader(Rt),Q.attachShader(this.program,Rt),this.attributes={};const ii={};this.numAttributes=xe.length;for(let Qt=0;Qt<this.numAttributes;Qt++)xe[Qt]&&(Q.bindAttribLocation(this.program,Qt,xe[Qt]),this.attributes[xe[Qt]]=Qt);Q.linkProgram(this.program),Q.deleteShader(Rt),Q.deleteShader(ft);for(let Qt=0;Qt<_t.length;Qt++){const _i=_t[Qt];if(_i&&!ii[_i]){const Jt=Q.getUniformLocation(this.program,_i);Jt&&(ii[_i]=Jt)}}this.fixedUniforms=L(a,ii),this.terrainUniforms=((Qt,_i)=>({u_depth:new i.Uniform1i(Qt,_i.u_depth),u_terrain:new i.Uniform1i(Qt,_i.u_terrain),u_terrain_dim:new i.Uniform1f(Qt,_i.u_terrain_dim),u_terrain_matrix:new i.UniformMatrix4f(Qt,_i.u_terrain_matrix),u_terrain_unpack:new i.Uniform4f(Qt,_i.u_terrain_unpack),u_terrain_offset:new i.Uniform1f(Qt,_i.u_terrain_offset),u_terrain_exaggeration:new i.Uniform1f(Qt,_i.u_terrain_exaggeration)}))(a,ii),this.binderUniforms=A?A.getUniforms(a,ii):[]}draw(a,m,T,A,L,N,H,Q,se,pe,xe,Ee,Qe,Ge,We,_t,Tt,kt){const ot=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(T),a.setStencilMode(A),a.setColorMode(L),a.setCullFace(N),Q){a.activeTexture.set(ot.TEXTURE2),ot.bindTexture(ot.TEXTURE_2D,Q.depthTexture),a.activeTexture.set(ot.TEXTURE3),ot.bindTexture(ot.TEXTURE_2D,Q.texture);for(const Rt in this.terrainUniforms)this.terrainUniforms[Rt].set(Q[Rt])}for(const Rt in this.fixedUniforms)this.fixedUniforms[Rt].set(H[Rt]);We&&We.setUniforms(a,this.binderUniforms,Qe,{zoom:Ge});let ft=0;switch(m){case ot.LINES:ft=2;break;case ot.TRIANGLES:ft=3;break;case ot.LINE_STRIP:ft=1}for(const Rt of Ee.get()){const ii=Rt.vaos||(Rt.vaos={});(ii[se]||(ii[se]=new Fi)).bind(a,this,pe,We?We.getPaintVertexBuffers():[],xe,Rt.vertexOffset,_t,Tt,kt),ot.drawElements(m,Rt.primitiveLength*ft,ot.UNSIGNED_SHORT,Rt.primitiveOffset*ft*2)}}}function la(C,a,m){const T=1/oo(m,1,a.transform.tileZoom),A=Math.pow(2,m.tileID.overscaledZ),L=m.tileSize*Math.pow(2,a.transform.tileZoom)/A,N=L*(m.tileID.canonical.x+m.tileID.wrap*A),H=L*m.tileID.canonical.y;return{u_image:0,u_texsize:m.imageAtlasTexture.size,u_scale:[T,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[N>>16,H>>16],u_pixel_coord_lower:[65535&N,65535&H]}}const tl=(C,a,m,T)=>{const A=a.style.light,L=A.properties.get("position"),N=[L.x,L.y,L.z],H=i.create$1();A.properties.get("anchor")==="viewport"&&i.fromRotation(H,-a.transform.angle),i.transformMat3(N,N,H);const Q=A.properties.get("color");return{u_matrix:C,u_lightpos:N,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+m,u_opacity:T}},Hn=(C,a,m,T,A,L,N)=>i.extend(tl(C,a,m,T),la(L,a,N),{u_height_factor:-Math.pow(2,A.overscaledZ)/N.tileSize/8}),Tl=C=>({u_matrix:C}),El=(C,a,m,T)=>i.extend(Tl(C),la(m,a,T)),il=(C,a)=>({u_matrix:C,u_world:a}),ns=(C,a,m,T,A)=>i.extend(El(C,a,m,T),{u_world:A}),eo=(C,a,m,T)=>{const A=C.transform;let L,N;if(T.paint.get("circle-pitch-alignment")==="map"){const H=oo(m,1,A.zoom);L=!0,N=[H,H]}else L=!1,N=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(T.paint.get("circle-pitch-scale")==="map"),u_matrix:C.translatePosMatrix(a.posMatrix,m,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_pitch_with_map:+L,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:N}},ms=(C,a,m)=>{const T=oo(m,1,a.zoom),A=Math.pow(2,a.zoom-m.tileID.overscaledZ),L=m.tileID.overscaleFactor();return{u_matrix:C,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:T,u_extrude_scale:[a.pixelsToGLUnits[0]/(T*A),a.pixelsToGLUnits[1]/(T*A)],u_overscale_factor:L}},nl=(C,a,m=1)=>({u_matrix:C,u_color:a,u_overlay:0,u_overlay_scale:m}),Ba=C=>({u_matrix:C}),Sl=(C,a,m,T)=>({u_matrix:C,u_extrude_scale:oo(a,1,m),u_intensity:T});function Cl(C,a){const m=Math.pow(2,a.canonical.z),T=a.canonical.y;return[new i.MercatorCoordinate(0,T/m).toLngLat().lat,new i.MercatorCoordinate(0,(T+1)/m).toLngLat().lat]}const Il=(C,a,m,T)=>{const A=C.transform;return{u_matrix:rs(C,a,m,T),u_ratio:1/oo(a,1,A.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Ra=(C,a,m,T,A)=>i.extend(Il(C,a,m,A),{u_image:0,u_image_height:T}),Al=(C,a,m,T,A)=>{const L=C.transform,N=Hr(a,L);return{u_matrix:rs(C,a,m,A),u_texsize:a.imageAtlasTexture.size,u_ratio:1/oo(a,1,L.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[N,T.fromScale,T.toScale],u_fade:T.t,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]]}},Ml=(C,a,m,T,A,L)=>{const N=C.lineAtlas,H=Hr(a,C.transform),Q=m.layout.get("line-cap")==="round",se=N.getDash(T.from,Q),pe=N.getDash(T.to,Q),xe=se.width*A.fromScale,Ee=pe.width*A.toScale;return i.extend(Il(C,a,m,L),{u_patternscale_a:[H/xe,-se.height/2],u_patternscale_b:[H/Ee,-pe.height/2],u_sdfgamma:N.width/(256*Math.min(xe,Ee)*C.pixelRatio)/2,u_image:0,u_tex_y_a:se.y,u_tex_y_b:pe.y,u_mix:A.t})};function Hr(C,a){return 1/oo(C,1,a.tileZoom)}function rs(C,a,m,T){return C.translatePosMatrix(T?T.posMatrix:a.tileID.posMatrix,a,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}const ho=(C,a,m,T,A)=>{return{u_matrix:C,u_tl_parent:a,u_scale_parent:m,u_buffer_scale:1,u_fade_t:T.mix,u_opacity:T.opacity*A.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:A.paint.get("raster-brightness-min"),u_brightness_high:A.paint.get("raster-brightness-max"),u_saturation_factor:(N=A.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(L=A.paint.get("raster-contrast"),L>0?1/(1-L):1+L),u_spin_weights:Cc(A.paint.get("raster-hue-rotate"))};var L,N};function Cc(C){C*=Math.PI/180;const a=Math.sin(C),m=Math.cos(C);return[(2*m+1)/3,(-Math.sqrt(3)*a-m+1)/3,(Math.sqrt(3)*a-m+1)/3]}const bu=(C,a,m,T,A,L,N,H,Q,se)=>{const pe=A.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:pe.cameraToCenterDistance,u_pitch:pe.pitch/360*2*Math.PI,u_rotate_symbol:+m,u_aspect_ratio:pe.width/pe.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:N,u_coord_matrix:H,u_is_text:+Q,u_pitch_with_map:+T,u_texsize:se,u_texture:0}},Vo=(C,a,m,T,A,L,N,H,Q,se,pe)=>{const xe=A.transform;return i.extend(bu(C,a,m,T,A,L,N,H,Q,se),{u_gamma_scale:T?Math.cos(xe._pitch)*xe.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:+pe})},Us=(C,a,m,T,A,L,N,H,Q,se)=>i.extend(Vo(C,a,m,T,A,L,N,H,!0,Q,!0),{u_texsize_icon:se,u_texture_icon:1}),Rd=(C,a,m)=>({u_matrix:C,u_opacity:a,u_color:m}),lh=(C,a,m,T,A,L)=>i.extend(function(N,H,Q,se){const pe=Q.imageManager.getPattern(N.from.toString()),xe=Q.imageManager.getPattern(N.to.toString()),{width:Ee,height:Qe}=Q.imageManager.getPixelSize(),Ge=Math.pow(2,se.tileID.overscaledZ),We=se.tileSize*Math.pow(2,Q.transform.tileZoom)/Ge,_t=We*(se.tileID.canonical.x+se.tileID.wrap*Ge),Tt=We*se.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:pe.tl,u_pattern_br_a:pe.br,u_pattern_tl_b:xe.tl,u_pattern_br_b:xe.br,u_texsize:[Ee,Qe],u_mix:H.t,u_pattern_size_a:pe.displaySize,u_pattern_size_b:xe.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/oo(se,1,Q.transform.tileZoom),u_pixel_coord_upper:[_t>>16,Tt>>16],u_pixel_coord_lower:[65535&_t,65535&Tt]}}(T,L,m,A),{u_matrix:C,u_opacity:a}),Io={fillExtrusion:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_lightpos:new i.Uniform3f(C,a.u_lightpos),u_lightintensity:new i.Uniform1f(C,a.u_lightintensity),u_lightcolor:new i.Uniform3f(C,a.u_lightcolor),u_vertical_gradient:new i.Uniform1f(C,a.u_vertical_gradient),u_opacity:new i.Uniform1f(C,a.u_opacity)}),fillExtrusionPattern:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_lightpos:new i.Uniform3f(C,a.u_lightpos),u_lightintensity:new i.Uniform1f(C,a.u_lightintensity),u_lightcolor:new i.Uniform3f(C,a.u_lightcolor),u_vertical_gradient:new i.Uniform1f(C,a.u_vertical_gradient),u_height_factor:new i.Uniform1f(C,a.u_height_factor),u_image:new i.Uniform1i(C,a.u_image),u_texsize:new i.Uniform2f(C,a.u_texsize),u_pixel_coord_upper:new i.Uniform2f(C,a.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(C,a.u_pixel_coord_lower),u_scale:new i.Uniform3f(C,a.u_scale),u_fade:new i.Uniform1f(C,a.u_fade),u_opacity:new i.Uniform1f(C,a.u_opacity)}),fill:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix)}),fillPattern:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_image:new i.Uniform1i(C,a.u_image),u_texsize:new i.Uniform2f(C,a.u_texsize),u_pixel_coord_upper:new i.Uniform2f(C,a.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(C,a.u_pixel_coord_lower),u_scale:new i.Uniform3f(C,a.u_scale),u_fade:new i.Uniform1f(C,a.u_fade)}),fillOutline:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_world:new i.Uniform2f(C,a.u_world)}),fillOutlinePattern:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_world:new i.Uniform2f(C,a.u_world),u_image:new i.Uniform1i(C,a.u_image),u_texsize:new i.Uniform2f(C,a.u_texsize),u_pixel_coord_upper:new i.Uniform2f(C,a.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(C,a.u_pixel_coord_lower),u_scale:new i.Uniform3f(C,a.u_scale),u_fade:new i.Uniform1f(C,a.u_fade)}),circle:(C,a)=>({u_camera_to_center_distance:new i.Uniform1f(C,a.u_camera_to_center_distance),u_scale_with_map:new i.Uniform1i(C,a.u_scale_with_map),u_pitch_with_map:new i.Uniform1i(C,a.u_pitch_with_map),u_extrude_scale:new i.Uniform2f(C,a.u_extrude_scale),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_matrix:new i.UniformMatrix4f(C,a.u_matrix)}),collisionBox:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_camera_to_center_distance:new i.Uniform1f(C,a.u_camera_to_center_distance),u_pixels_to_tile_units:new i.Uniform1f(C,a.u_pixels_to_tile_units),u_extrude_scale:new i.Uniform2f(C,a.u_extrude_scale),u_overscale_factor:new i.Uniform1f(C,a.u_overscale_factor)}),collisionCircle:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_inv_matrix:new i.UniformMatrix4f(C,a.u_inv_matrix),u_camera_to_center_distance:new i.Uniform1f(C,a.u_camera_to_center_distance),u_viewport_size:new i.Uniform2f(C,a.u_viewport_size)}),debug:(C,a)=>({u_color:new i.UniformColor(C,a.u_color),u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_overlay:new i.Uniform1i(C,a.u_overlay),u_overlay_scale:new i.Uniform1f(C,a.u_overlay_scale)}),clippingMask:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix)}),heatmap:(C,a)=>({u_extrude_scale:new i.Uniform1f(C,a.u_extrude_scale),u_intensity:new i.Uniform1f(C,a.u_intensity),u_matrix:new i.UniformMatrix4f(C,a.u_matrix)}),heatmapTexture:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_world:new i.Uniform2f(C,a.u_world),u_image:new i.Uniform1i(C,a.u_image),u_color_ramp:new i.Uniform1i(C,a.u_color_ramp),u_opacity:new i.Uniform1f(C,a.u_opacity)}),hillshade:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_image:new i.Uniform1i(C,a.u_image),u_latrange:new i.Uniform2f(C,a.u_latrange),u_light:new i.Uniform2f(C,a.u_light),u_shadow:new i.UniformColor(C,a.u_shadow),u_highlight:new i.UniformColor(C,a.u_highlight),u_accent:new i.UniformColor(C,a.u_accent)}),hillshadePrepare:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_image:new i.Uniform1i(C,a.u_image),u_dimension:new i.Uniform2f(C,a.u_dimension),u_zoom:new i.Uniform1f(C,a.u_zoom),u_unpack:new i.Uniform4f(C,a.u_unpack)}),line:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_ratio:new i.Uniform1f(C,a.u_ratio),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(C,a.u_units_to_pixels)}),lineGradient:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_ratio:new i.Uniform1f(C,a.u_ratio),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(C,a.u_units_to_pixels),u_image:new i.Uniform1i(C,a.u_image),u_image_height:new i.Uniform1f(C,a.u_image_height)}),linePattern:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_texsize:new i.Uniform2f(C,a.u_texsize),u_ratio:new i.Uniform1f(C,a.u_ratio),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_image:new i.Uniform1i(C,a.u_image),u_units_to_pixels:new i.Uniform2f(C,a.u_units_to_pixels),u_scale:new i.Uniform3f(C,a.u_scale),u_fade:new i.Uniform1f(C,a.u_fade)}),lineSDF:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_ratio:new i.Uniform1f(C,a.u_ratio),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(C,a.u_units_to_pixels),u_patternscale_a:new i.Uniform2f(C,a.u_patternscale_a),u_patternscale_b:new i.Uniform2f(C,a.u_patternscale_b),u_sdfgamma:new i.Uniform1f(C,a.u_sdfgamma),u_image:new i.Uniform1i(C,a.u_image),u_tex_y_a:new i.Uniform1f(C,a.u_tex_y_a),u_tex_y_b:new i.Uniform1f(C,a.u_tex_y_b),u_mix:new i.Uniform1f(C,a.u_mix)}),raster:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_tl_parent:new i.Uniform2f(C,a.u_tl_parent),u_scale_parent:new i.Uniform1f(C,a.u_scale_parent),u_buffer_scale:new i.Uniform1f(C,a.u_buffer_scale),u_fade_t:new i.Uniform1f(C,a.u_fade_t),u_opacity:new i.Uniform1f(C,a.u_opacity),u_image0:new i.Uniform1i(C,a.u_image0),u_image1:new i.Uniform1i(C,a.u_image1),u_brightness_low:new i.Uniform1f(C,a.u_brightness_low),u_brightness_high:new i.Uniform1f(C,a.u_brightness_high),u_saturation_factor:new i.Uniform1f(C,a.u_saturation_factor),u_contrast_factor:new i.Uniform1f(C,a.u_contrast_factor),u_spin_weights:new i.Uniform3f(C,a.u_spin_weights)}),symbolIcon:(C,a)=>({u_is_size_zoom_constant:new i.Uniform1i(C,a.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(C,a.u_is_size_feature_constant),u_size_t:new i.Uniform1f(C,a.u_size_t),u_size:new i.Uniform1f(C,a.u_size),u_camera_to_center_distance:new i.Uniform1f(C,a.u_camera_to_center_distance),u_pitch:new i.Uniform1f(C,a.u_pitch),u_rotate_symbol:new i.Uniform1i(C,a.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(C,a.u_aspect_ratio),u_fade_change:new i.Uniform1f(C,a.u_fade_change),u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(C,a.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(C,a.u_coord_matrix),u_is_text:new i.Uniform1i(C,a.u_is_text),u_pitch_with_map:new i.Uniform1i(C,a.u_pitch_with_map),u_texsize:new i.Uniform2f(C,a.u_texsize),u_texture:new i.Uniform1i(C,a.u_texture)}),symbolSDF:(C,a)=>({u_is_size_zoom_constant:new i.Uniform1i(C,a.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(C,a.u_is_size_feature_constant),u_size_t:new i.Uniform1f(C,a.u_size_t),u_size:new i.Uniform1f(C,a.u_size),u_camera_to_center_distance:new i.Uniform1f(C,a.u_camera_to_center_distance),u_pitch:new i.Uniform1f(C,a.u_pitch),u_rotate_symbol:new i.Uniform1i(C,a.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(C,a.u_aspect_ratio),u_fade_change:new i.Uniform1f(C,a.u_fade_change),u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(C,a.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(C,a.u_coord_matrix),u_is_text:new i.Uniform1i(C,a.u_is_text),u_pitch_with_map:new i.Uniform1i(C,a.u_pitch_with_map),u_texsize:new i.Uniform2f(C,a.u_texsize),u_texture:new i.Uniform1i(C,a.u_texture),u_gamma_scale:new i.Uniform1f(C,a.u_gamma_scale),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_is_halo:new i.Uniform1i(C,a.u_is_halo)}),symbolTextAndIcon:(C,a)=>({u_is_size_zoom_constant:new i.Uniform1i(C,a.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(C,a.u_is_size_feature_constant),u_size_t:new i.Uniform1f(C,a.u_size_t),u_size:new i.Uniform1f(C,a.u_size),u_camera_to_center_distance:new i.Uniform1f(C,a.u_camera_to_center_distance),u_pitch:new i.Uniform1f(C,a.u_pitch),u_rotate_symbol:new i.Uniform1i(C,a.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(C,a.u_aspect_ratio),u_fade_change:new i.Uniform1f(C,a.u_fade_change),u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(C,a.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(C,a.u_coord_matrix),u_is_text:new i.Uniform1i(C,a.u_is_text),u_pitch_with_map:new i.Uniform1i(C,a.u_pitch_with_map),u_texsize:new i.Uniform2f(C,a.u_texsize),u_texsize_icon:new i.Uniform2f(C,a.u_texsize_icon),u_texture:new i.Uniform1i(C,a.u_texture),u_texture_icon:new i.Uniform1i(C,a.u_texture_icon),u_gamma_scale:new i.Uniform1f(C,a.u_gamma_scale),u_device_pixel_ratio:new i.Uniform1f(C,a.u_device_pixel_ratio),u_is_halo:new i.Uniform1i(C,a.u_is_halo)}),background:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_opacity:new i.Uniform1f(C,a.u_opacity),u_color:new i.UniformColor(C,a.u_color)}),backgroundPattern:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_opacity:new i.Uniform1f(C,a.u_opacity),u_image:new i.Uniform1i(C,a.u_image),u_pattern_tl_a:new i.Uniform2f(C,a.u_pattern_tl_a),u_pattern_br_a:new i.Uniform2f(C,a.u_pattern_br_a),u_pattern_tl_b:new i.Uniform2f(C,a.u_pattern_tl_b),u_pattern_br_b:new i.Uniform2f(C,a.u_pattern_br_b),u_texsize:new i.Uniform2f(C,a.u_texsize),u_mix:new i.Uniform1f(C,a.u_mix),u_pattern_size_a:new i.Uniform2f(C,a.u_pattern_size_a),u_pattern_size_b:new i.Uniform2f(C,a.u_pattern_size_b),u_scale_a:new i.Uniform1f(C,a.u_scale_a),u_scale_b:new i.Uniform1f(C,a.u_scale_b),u_pixel_coord_upper:new i.Uniform2f(C,a.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(C,a.u_pixel_coord_lower),u_tile_units_to_pixels:new i.Uniform1f(C,a.u_tile_units_to_pixels)}),terrain:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_texture:new i.Uniform1i(C,a.u_texture)}),terrainDepth:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix)}),terrainCoords:(C,a)=>({u_matrix:new i.UniformMatrix4f(C,a.u_matrix),u_texture:new i.Uniform1i(C,a.u_texture),u_terrain_coords_id:new i.Uniform1f(C,a.u_terrain_coords_id)})};class Kl{constructor(a,m,T){this.context=a;const A=a.gl;this.buffer=A.createBuffer(),this.dynamicDraw=Boolean(T),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const m=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const wu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yl{constructor(a,m,T,A){this.length=m.length,this.attributes=T,this.itemSize=m.bytesPerElement,this.dynamicDraw=A,this.context=a;const L=a.gl;this.buffer=L.createBuffer(),a.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,m){for(let T=0;T<this.attributes.length;T++){const A=m.attributes[this.attributes[T].name];A!==void 0&&a.enableVertexAttribArray(A)}}setVertexAttribPointers(a,m,T){for(let A=0;A<this.attributes.length;A++){const L=this.attributes[A],N=m.attributes[L.name];N!==void 0&&a.vertexAttribPointer(N,L.components,a[wu[L.type]],!1,this.itemSize,L.offset+this.itemSize*(T||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Bn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jl extends Bn{getDefault(){return i.Color.transparent}set(a){const m=this.current;(a.r!==m.r||a.g!==m.g||a.b!==m.b||a.a!==m.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Vh extends Bn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class $s extends Bn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class rl extends Bn{getDefault(){return[!0,!0,!0,!0]}set(a){const m=this.current;(a[0]!==m[0]||a[1]!==m[1]||a[2]!==m[2]||a[3]!==m[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Tu extends Bn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class js extends Bn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Eu extends Bn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const m=this.current;(a.func!==m.func||a.ref!==m.ref||a.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Oa extends Bn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const m=this.current;(a[0]!==m[0]||a[1]!==m[1]||a[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Ql extends Bn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;a?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=a,this.dirty=!1}}class ch extends Bn{getDefault(){return[0,1]}set(a){const m=this.current;(a[0]!==m[0]||a[1]!==m[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class kl extends Bn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;a?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=a,this.dirty=!1}}class ya extends Bn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ic extends Bn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;a?m.enable(m.BLEND):m.disable(m.BLEND),this.current=a,this.dirty=!1}}class Zo extends Bn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const m=this.current;(a[0]!==m[0]||a[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class ec extends Bn{getDefault(){return i.Color.transparent}set(a){const m=this.current;(a.r!==m.r||a.g!==m.g||a.b!==m.b||a.a!==m.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ac extends Bn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Nh extends Bn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;a?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=a,this.dirty=!1}}class tc extends Bn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class uh extends Bn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Od extends Bn{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class hh extends Bn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Su extends Bn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const m=this.current;(a[0]!==m[0]||a[1]!==m[1]||a[2]!==m[2]||a[3]!==m[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Uh extends Bn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Fd extends Bn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ic extends Bn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.bindTexture(m.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Mc extends Bn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ol extends Bn{getDefault(){return null}set(a){const m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class gr extends Bn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class nc extends Bn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class kc extends Bn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class dh extends Bn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class sl extends Bn{constructor(a,m){super(a),this.context=a,this.parent=m}getDefault(){return null}}class Fa extends sl{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Pc extends sl{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class al{constructor(a,m,T,A){this.context=a,this.width=m,this.height=T;const L=a.gl,N=this.framebuffer=L.createFramebuffer();if(this.colorAttachment=new Fa(a,N),A&&(this.depthAttachment=new Pc(a,N)),L.checkFramebufferStatus(L.FRAMEBUFFER)!==L.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,m=this.colorAttachment.get();if(m&&a.deleteTexture(m),this.depthAttachment){const T=this.depthAttachment.get();T&&a.deleteRenderbuffer(T)}a.deleteFramebuffer(this.framebuffer)}}class jr{constructor(a,m,T){this.blendFunction=a,this.blendColor=m,this.mask=T}}jr.Replace=[1,0],jr.disabled=new jr(jr.Replace,i.Color.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,i.Color.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,771],i.Color.transparent,[!0,!0,!0,!0]);class Cu{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Jl(this),this.clearDepth=new Vh(this),this.clearStencil=new $s(this),this.colorMask=new rl(this),this.depthMask=new Tu(this),this.stencilMask=new js(this),this.stencilFunc=new Eu(this),this.stencilOp=new Oa(this),this.stencilTest=new Ql(this),this.depthRange=new ch(this),this.depthTest=new kl(this),this.depthFunc=new ya(this),this.blend=new Ic(this),this.blendFunc=new Zo(this),this.blendColor=new ec(this),this.blendEquation=new Ac(this),this.cullFace=new Nh(this),this.cullFaceSide=new tc(this),this.frontFace=new uh(this),this.program=new Od(this),this.activeTexture=new hh(this),this.viewport=new Su(this),this.bindFramebuffer=new Uh(this),this.bindRenderbuffer=new Fd(this),this.bindTexture=new ic(this),this.bindVertexBuffer=new Mc(this),this.bindElementBuffer=new ol(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gr(this),this.pixelStoreUnpack=new nc(this),this.pixelStoreUnpackPremultiplyAlpha=new kc(this),this.pixelStoreUnpackFlipY=new dh(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,m){return new Kl(this,a,m)}createVertexBuffer(a,m,T){return new Yl(this,a,m,T)}createRenderbuffer(a,m,T){const A=this.gl,L=A.createRenderbuffer();return this.bindRenderbuffer.set(L),A.renderbufferStorage(A.RENDERBUFFER,a,m,T),this.bindRenderbuffer.set(null),L}createFramebuffer(a,m,T){return new al(this,a,m,T)}clear({color:a,depth:m}){const T=this.gl;let A=0;a&&(A|=T.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(A|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),T.clear(A)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){Y(a.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Un{constructor(a,m,T){this.func=a,this.mask=m,this.range=T}}Un.ReadOnly=!1,Un.ReadWrite=!0,Un.disabled=new Un(519,Un.ReadOnly,[0,1]);const cr=7680;class Lr{constructor(a,m,T,A,L,N){this.test=a,this.ref=m,this.mask=T,this.fail=A,this.depthFail=L,this.pass=N}}Lr.disabled=new Lr({func:519,mask:0},0,0,cr,cr,cr);class Br{constructor(a,m,T){this.enable=a,this.mode=m,this.frontFace=T}}let Pl;function Qn(C,a,m,T,A,L,N){const H=C.context,Q=H.gl,se=C.useProgram("collisionBox"),pe=[];let xe=0,Ee=0;for(let ot=0;ot<T.length;ot++){const ft=T[ot],Rt=a.getTile(ft),ii=Rt.getBucket(m);if(!ii)continue;let Qt=ft.posMatrix;A[0]===0&&A[1]===0||(Qt=C.translatePosMatrix(ft.posMatrix,Rt,A,L));const _i=N?ii.textCollisionBox:ii.iconCollisionBox,Jt=ii.collisionCircleArray;if(Jt.length>0){const Ji=i.create(),Vi=Qt;i.mul(Ji,ii.placementInvProjMatrix,C.transform.glCoordMatrix),i.mul(Ji,Ji,ii.placementViewportMatrix),pe.push({circleArray:Jt,circleOffset:Ee,transform:Vi,invTransform:Ji,coord:ft}),xe+=Jt.length/4,Ee=xe}_i&&se.draw(H,Q.LINES,Un.disabled,Lr.disabled,C.colorModeForRenderPass(),Br.disabled,ms(Qt,C.transform,Rt),C.style.terrain&&C.style.terrain.getTerrainData(ft),m.id,_i.layoutVertexBuffer,_i.indexBuffer,_i.segments,null,C.transform.zoom,null,null,_i.collisionVertexBuffer)}if(!N||!pe.length)return;const Qe=C.useProgram("collisionCircle"),Ge=new i.CollisionCircleLayoutArray;Ge.resize(4*xe),Ge._trim();let We=0;for(const ot of pe)for(let ft=0;ft<ot.circleArray.length/4;ft++){const Rt=4*ft,ii=ot.circleArray[Rt+0],Qt=ot.circleArray[Rt+1],_i=ot.circleArray[Rt+2],Jt=ot.circleArray[Rt+3];Ge.emplace(We++,ii,Qt,_i,Jt,0),Ge.emplace(We++,ii,Qt,_i,Jt,1),Ge.emplace(We++,ii,Qt,_i,Jt,2),Ge.emplace(We++,ii,Qt,_i,Jt,3)}(!Pl||Pl.length<2*xe)&&(Pl=function(ot){const ft=2*ot,Rt=new i.QuadTriangleArray;Rt.resize(ft),Rt._trim();for(let ii=0;ii<ft;ii++){const Qt=6*ii;Rt.uint16[Qt+0]=4*ii+0,Rt.uint16[Qt+1]=4*ii+1,Rt.uint16[Qt+2]=4*ii+2,Rt.uint16[Qt+3]=4*ii+2,Rt.uint16[Qt+4]=4*ii+3,Rt.uint16[Qt+5]=4*ii+0}return Rt}(xe));const _t=H.createIndexBuffer(Pl,!0),Tt=H.createVertexBuffer(Ge,i.collisionCircleLayout.members,!0);for(const ot of pe){const ft={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(kt=C.transform).cameraToCenterDistance,u_viewport_size:[kt.width,kt.height]};Qe.draw(H,Q.TRIANGLES,Un.disabled,Lr.disabled,C.colorModeForRenderPass(),Br.disabled,ft,C.style.terrain&&C.style.terrain.getTerrainData(ot.coord),m.id,Tt,_t,i.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,C.transform.zoom,null,null,null)}var kt;Tt.destroy(),_t.destroy()}Br.disabled=new Br(!1,1029,2305),Br.backCCW=new Br(!0,1029,2305);const fh=i.identity(new Float32Array(16));function $h(C,a,m,T,A,L){const{horizontalAlign:N,verticalAlign:H}=i.getAnchorAlignment(C),Q=-(N-.5)*a,se=-(H-.5)*m,pe=i.evaluateVariableOffset(C,T);return new i.pointGeometry((Q/A+pe[0])*L,(se/A+pe[1])*L)}function jh(C,a,m,T,A,L,N,H,Q,se,pe){const xe=C.text.placedSymbolArray,Ee=C.text.dynamicLayoutVertexArray,Qe=C.icon.dynamicLayoutVertexArray,Ge={};Ee.clear();for(let We=0;We<xe.length;We++){const _t=xe.get(We),Tt=C.allowVerticalPlacement&&!_t.placedOrientation,kt=_t.hidden||!_t.crossTileID||Tt?null:T[_t.crossTileID];if(kt){const ot=new i.pointGeometry(_t.anchorX,_t.anchorY),ft=jn(ot,m?N:L,pe),Rt=ro(A.cameraToCenterDistance,ft.signedDistanceFromCamera);let ii=i.evaluateSizeForFeature(C.textSizeData,Q,_t)*Rt/i.ONE_EM;m&&(ii*=C.tilePixelRatio/H);const{width:Qt,height:_i,anchor:Jt,textOffset:Ji,textBoxScale:Vi}=kt,en=$h(Jt,Qt,_i,Ji,Vi,ii),Rn=m?jn(ot.add(en),L,pe).point:ft.point.add(a?en.rotate(-A.angle):en),$n=C.allowVerticalPlacement&&_t.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let dn=0;dn<_t.numGlyphs;dn++)i.addDynamicAttributes(Ee,Rn,$n);se&&_t.associatedIconIndex>=0&&(Ge[_t.associatedIconIndex]={shiftedAnchor:Rn,angle:$n})}else kn(_t.numGlyphs,Ee)}if(se){Qe.clear();const We=C.icon.placedSymbolArray;for(let _t=0;_t<We.length;_t++){const Tt=We.get(_t);if(Tt.hidden)kn(Tt.numGlyphs,Qe);else{const kt=Ge[_t];if(kt)for(let ot=0;ot<Tt.numGlyphs;ot++)i.addDynamicAttributes(Qe,kt.shiftedAnchor,kt.angle);else kn(Tt.numGlyphs,Qe)}}C.icon.dynamicLayoutVertexBuffer.updateData(Qe)}C.text.dynamicLayoutVertexBuffer.updateData(Ee)}function Gh(C,a,m){return m.iconsInText&&a?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function rc(C,a,m,T,A,L,N,H,Q,se,pe,xe){const Ee=C.context,Qe=Ee.gl,Ge=C.transform,We=H==="map",_t=Q==="map",Tt=H!=="viewport"&&m.layout.get("symbol-placement")!=="point",kt=We&&!_t&&!Tt,ot=!m.layout.get("symbol-sort-key").isConstant();let ft=!1;const Rt=C.depthModeForSublayer(0,Un.ReadOnly),ii=m.layout.get("text-variable-anchor"),Qt=[];for(const _i of T){const Jt=a.getTile(_i),Ji=Jt.getBucket(m);if(!Ji)continue;const Vi=A?Ji.text:Ji.icon;if(!Vi||!Vi.segments.get().length)continue;const en=Vi.programConfigurations.get(m.id),Rn=A||Ji.sdfIcons,$n=A?Ji.textSizeData:Ji.iconSizeData,dn=_t||Ge.pitch!==0,xr=C.useProgram(Gh(Rn,A,Ji),en),Cr=i.evaluateSizeForZoom($n,Ge.zoom),ur=C.style.terrain&&C.style.terrain.getTerrainData(_i);let hr,Dr,Wo,ba,da=[0,0],wa=null;if(A){if(Dr=Jt.glyphAtlasTexture,Wo=Qe.LINEAR,hr=Jt.glyphAtlasTexture.size,Ji.iconsInText){da=Jt.imageAtlasTexture.size,wa=Jt.imageAtlasTexture;const O=$n.kind==="composite"||$n.kind==="camera";ba=dn||C.options.rotating||C.options.zooming||O?Qe.LINEAR:Qe.NEAREST}}else{const O=m.layout.get("icon-size").constantOr(0)!==1||Ji.iconsNeedLinear;Dr=Jt.imageAtlasTexture,Wo=Rn||C.options.rotating||C.options.zooming||O||dn?Qe.LINEAR:Qe.NEAREST,hr=Jt.imageAtlasTexture.size}const Ua=oo(Jt,1,C.transform.zoom),Zs=Pr(_i.posMatrix,_t,We,C.transform,Ua),ws=Eo(_i.posMatrix,_t,We,C.transform,Ua),Ta=ii&&Ji.hasTextData(),Rl=m.layout.get("icon-text-fit")!=="none"&&Ta&&Ji.hasIconData();if(Tt){const O=C.style.terrain?(G,te)=>C.style.terrain.getElevation(_i,G,te):null,V=m.layout.get("text-rotation-alignment")==="map";zr(Ji,_i.posMatrix,C,A,Zs,ws,_t,se,V,O)}const _=C.translatePosMatrix(_i.posMatrix,Jt,L,N),o=Tt||A&&ii||Rl?fh:Zs,f=C.translatePosMatrix(ws,Jt,L,N,!0),x=Rn&&m.paint.get(A?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let S;S=Rn?Ji.iconsInText?Us($n.kind,Cr,kt,_t,C,_,o,f,hr,da):Vo($n.kind,Cr,kt,_t,C,_,o,f,A,hr,!0):bu($n.kind,Cr,kt,_t,C,_,o,f,A,hr);const k={program:xr,buffers:Vi,uniformValues:S,atlasTexture:Dr,atlasTextureIcon:wa,atlasInterpolation:Wo,atlasInterpolationIcon:ba,isSDF:Rn,hasHalo:x};if(ot&&Ji.canOverlap){ft=!0;const O=Vi.segments.get();for(const V of O)Qt.push({segments:new i.SegmentVector([V]),sortKey:V.sortKey,state:k,terrainData:ur})}else Qt.push({segments:Vi.segments,sortKey:0,state:k,terrainData:ur})}ft&&Qt.sort((_i,Jt)=>_i.sortKey-Jt.sortKey);for(const _i of Qt){const Jt=_i.state;if(Ee.activeTexture.set(Qe.TEXTURE0),Jt.atlasTexture.bind(Jt.atlasInterpolation,Qe.CLAMP_TO_EDGE),Jt.atlasTextureIcon&&(Ee.activeTexture.set(Qe.TEXTURE1),Jt.atlasTextureIcon&&Jt.atlasTextureIcon.bind(Jt.atlasInterpolationIcon,Qe.CLAMP_TO_EDGE)),Jt.isSDF){const Ji=Jt.uniformValues;Jt.hasHalo&&(Ji.u_is_halo=1,zc(Jt.buffers,_i.segments,m,C,Jt.program,Rt,pe,xe,Ji,_i.terrainData)),Ji.u_is_halo=0}zc(Jt.buffers,_i.segments,m,C,Jt.program,Rt,pe,xe,Jt.uniformValues,_i.terrainData)}}function zc(C,a,m,T,A,L,N,H,Q,se){const pe=T.context;A.draw(pe,pe.gl.TRIANGLES,L,N,H,Br.disabled,Q,se,m.id,C.layoutVertexBuffer,C.indexBuffer,a,m.paint,T.transform.zoom,C.programConfigurations.get(m.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function Dc(C,a,m,T,A,L,N){const H=C.context.gl,Q=m.paint.get("fill-pattern"),se=Q&&Q.constantOr(1),pe=m.getCrossfadeParameters();let xe,Ee,Qe,Ge,We;N?(Ee=se&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",xe=H.LINES):(Ee=se?"fillPattern":"fill",xe=H.TRIANGLES);for(const _t of T){const Tt=a.getTile(_t);if(se&&!Tt.patternsLoaded())continue;const kt=Tt.getBucket(m);if(!kt)continue;const ot=kt.programConfigurations.get(m.id),ft=C.useProgram(Ee,ot),Rt=C.style.terrain&&C.style.terrain.getTerrainData(_t);se&&(C.context.activeTexture.set(H.TEXTURE0),Tt.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),ot.updatePaintBuffers(pe));const ii=Q.constantOr(null);if(ii&&Tt.imageAtlas){const Jt=Tt.imageAtlas,Ji=Jt.patternPositions[ii.to.toString()],Vi=Jt.patternPositions[ii.from.toString()];Ji&&Vi&&ot.setConstantPatternPositions(Ji,Vi)}const Qt=Rt?_t:null,_i=C.translatePosMatrix(Qt?Qt.posMatrix:_t.posMatrix,Tt,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));if(N){Ge=kt.indexBuffer2,We=kt.segments2;const Jt=[H.drawingBufferWidth,H.drawingBufferHeight];Qe=Ee==="fillOutlinePattern"&&se?ns(_i,C,pe,Tt,Jt):il(_i,Jt)}else Ge=kt.indexBuffer,We=kt.segments,Qe=se?El(_i,C,pe,Tt):Tl(_i);ft.draw(C.context,xe,A,C.stencilModeForClipping(_t),L,Br.disabled,Qe,Rt,m.id,kt.layoutVertexBuffer,Ge,We,m.paint,C.transform.zoom,ot)}}function Iu(C,a,m,T,A,L,N){const H=C.context,Q=H.gl,se=m.paint.get("fill-extrusion-pattern"),pe=se.constantOr(1),xe=m.getCrossfadeParameters(),Ee=m.paint.get("fill-extrusion-opacity");for(const Qe of T){const Ge=a.getTile(Qe),We=Ge.getBucket(m);if(!We)continue;const _t=C.style.terrain&&C.style.terrain.getTerrainData(Qe),Tt=We.programConfigurations.get(m.id),kt=C.useProgram(pe?"fillExtrusionPattern":"fillExtrusion",Tt);pe&&(C.context.activeTexture.set(Q.TEXTURE0),Ge.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Tt.updatePaintBuffers(xe));const ot=se.constantOr(null);if(ot&&Ge.imageAtlas){const Qt=Ge.imageAtlas,_i=Qt.patternPositions[ot.to.toString()],Jt=Qt.patternPositions[ot.from.toString()];_i&&Jt&&Tt.setConstantPatternPositions(_i,Jt)}const ft=C.translatePosMatrix(Qe.posMatrix,Ge,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),Rt=m.paint.get("fill-extrusion-vertical-gradient"),ii=pe?Hn(ft,C,Rt,Ee,Qe,xe,Ge):tl(ft,C,Rt,Ee);kt.draw(H,H.gl.TRIANGLES,A,L,N,Br.backCCW,ii,_t,m.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,m.paint,C.transform.zoom,Tt,C.style.terrain&&We.centroidVertexBuffer)}}function Lc(C,a,m,T,A,L,N){const H=C.context,Q=H.gl,se=m.fbo;if(!se)return;const pe=C.useProgram("hillshade"),xe=C.style.terrain&&C.style.terrain.getTerrainData(a);H.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,se.colorAttachment.get()),pe.draw(H,Q.TRIANGLES,A,L,N,Br.disabled,((Ee,Qe,Ge,We)=>{const _t=Ge.paint.get("hillshade-shadow-color"),Tt=Ge.paint.get("hillshade-highlight-color"),kt=Ge.paint.get("hillshade-accent-color");let ot=Ge.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ge.paint.get("hillshade-illumination-anchor")==="viewport"&&(ot-=Ee.transform.angle);const ft=!Ee.options.moving;return{u_matrix:We?We.posMatrix:Ee.transform.calculatePosMatrix(Qe.tileID.toUnwrapped(),ft),u_image:0,u_latrange:Cl(0,Qe.tileID),u_light:[Ge.paint.get("hillshade-exaggeration"),ot],u_shadow:_t,u_highlight:Tt,u_accent:kt}})(C,m,T,xe?a:null),xe,T.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments)}function Au(C,a,m,T,A,L){const N=C.context,H=N.gl,Q=a.dem;if(Q&&Q.data){const se=Q.dim,pe=Q.stride,xe=Q.getPixels();if(N.activeTexture.set(H.TEXTURE1),N.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||C.getTileTexture(pe),a.demTexture){const Qe=a.demTexture;Qe.update(xe,{premultiply:!1}),Qe.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else a.demTexture=new we(N,xe,H.RGBA,{premultiply:!1}),a.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);N.activeTexture.set(H.TEXTURE0);let Ee=a.fbo;if(!Ee){const Qe=new we(N,{width:se,height:se,data:null},H.RGBA);Qe.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ee=a.fbo=N.createFramebuffer(se,se,!0),Ee.colorAttachment.set(Qe.texture)}N.bindFramebuffer.set(Ee.framebuffer),N.viewport.set([0,0,se,se]),C.useProgram("hillshadePrepare").draw(N,H.TRIANGLES,T,A,L,Br.disabled,((Qe,Ge)=>{const We=Ge.stride,_t=i.create();return i.ortho(_t,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(_t,_t,[0,-i.EXTENT,0]),{u_matrix:_t,u_image:1,u_dimension:[We,We],u_zoom:Qe.overscaledZ,u_unpack:Ge.getUnpackVector()}})(a.tileID,Q),null,m.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function Bc(C,a,m,T,A,L){const N=T.paint.get("raster-fade-duration");if(!L&&N>0){const H=i.exported.now(),Q=(H-C.timeAdded)/N,se=a?(H-a.timeAdded)/N:-1,pe=m.getSource(),xe=A.coveringZoomLevel({tileSize:pe.tileSize,roundZoom:pe.roundZoom}),Ee=!a||Math.abs(a.tileID.overscaledZ-xe)>Math.abs(C.tileID.overscaledZ-xe),Qe=Ee&&C.refreshedUponExpiration?1:i.clamp(Ee?Q:1-se,0,1);return C.refreshedUponExpiration&&Q>=1&&(C.refreshedUponExpiration=!1),a?{opacity:1,mix:1-Qe}:{opacity:Qe,mix:0}}return{opacity:1,mix:0}}const Rc=new i.Color(1,0,0,1),ca=new i.Color(0,1,0,1),qh=new i.Color(0,0,1,1),Zh=new i.Color(1,0,1,1),Oc=new i.Color(0,1,1,1);function ua(C,a,m,T){ll(C,0,a+m/2,C.transform.width,m,T)}function Fc(C,a,m,T){ll(C,a-m/2,0,m,C.transform.height,T)}function ll(C,a,m,T,A,L){const N=C.context,H=N.gl;H.enable(H.SCISSOR_TEST),H.scissor(a*C.pixelRatio,m*C.pixelRatio,T*C.pixelRatio,A*C.pixelRatio),N.clear({color:L}),H.disable(H.SCISSOR_TEST)}function Wh(C,a,m){const T=C.context,A=T.gl,L=m.posMatrix,N=C.useProgram("debug"),H=Un.disabled,Q=Lr.disabled,se=C.colorModeForRenderPass(),pe="$debug",xe=C.style.terrain&&C.style.terrain.getTerrainData(m);T.activeTexture.set(A.TEXTURE0),C.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE);const Ee=a.getTileByID(m.key).latestRawTileData,Qe=Math.floor((Ee&&Ee.byteLength||0)/1024),Ge=a.getTile(m).tileSize,We=512/Math.min(Ge,512)*(m.overscaledZ/C.transform.zoom)*.5;let _t=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(_t+=` => ${m.overscaledZ}`),function(Tt,kt){Tt.initDebugOverlayCanvas();const ot=Tt.debugOverlayCanvas,ft=Tt.context.gl,Rt=Tt.debugOverlayCanvas.getContext("2d");Rt.clearRect(0,0,ot.width,ot.height),Rt.shadowColor="white",Rt.shadowBlur=2,Rt.lineWidth=1.5,Rt.strokeStyle="white",Rt.textBaseline="top",Rt.font="bold 36px Open Sans, sans-serif",Rt.fillText(kt,5,5),Rt.strokeText(kt,5,5),Tt.debugOverlayTexture.update(ot),Tt.debugOverlayTexture.bind(ft.LINEAR,ft.CLAMP_TO_EDGE)}(C,`${_t} ${Qe}kB`),N.draw(T,A.TRIANGLES,H,Q,jr.alphaBlended,Br.disabled,nl(L,i.Color.transparent,We),null,pe,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),N.draw(T,A.LINE_STRIP,H,Q,se,Br.disabled,nl(L,i.Color.red),xe,pe,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function Gs(C,a,m){const T=C.context,A=T.gl,L=C.colorModeForRenderPass(),N=new Un(A.LEQUAL,Un.ReadWrite,C.depthRangeFor3D),H=C.useProgram("terrain"),Q=a.getTerrainMesh(),se=a.getTerrainData(m.tileID);T.bindFramebuffer.set(null),T.viewport.set([0,0,C.width,C.height]),T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,a.getRTTFramebuffer().colorAttachment.get());const pe=C.transform.calculatePosMatrix(m.tileID.toUnwrapped());H.draw(T,A.TRIANGLES,N,Lr.disabled,L,Br.backCCW,{u_matrix:pe,u_texture:0},se,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}function Mu(C,a,m,T){const A=C.context,L=m.tileSize*a.qualityFactor;m.textures[T]||(m.textures[T]=C.getTileTexture(L)||new we(A,{width:L,height:L,data:null},A.gl.RGBA),m.textures[T].bind(A.gl.LINEAR,A.gl.CLAMP_TO_EDGE),T===0&&a.sourceCache.renderHistory.unshift(m.tileID.key));const N=a.getRTTFramebuffer();N.colorAttachment.set(m.textures[T].texture),A.bindFramebuffer.set(N.framebuffer),A.viewport.set([0,0,L,L])}class ph{constructor(a){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=a,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=a.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const a=this.painter.style,m=a.terrain;for(const T in a.sourceCaches){this._coordsDescendingInv[T]={};const A=a.sourceCaches[T].getVisibleCoordinates();for(const L of A){const N=m.sourceCache.getTerrainCoords(L);for(const H in N)this._coordsDescendingInv[T][H]||(this._coordsDescendingInv[T][H]=[]),this._coordsDescendingInv[T][H].push(N[H])}}for(const T of a._order){const A=a._layers[T],L=A.source;if(this._renderToTexture[A.type]&&!this._coordsDescendingInvStr[L]){this._coordsDescendingInvStr[L]={};for(const N in this._coordsDescendingInv[L])this._coordsDescendingInvStr[L][N]=this._coordsDescendingInv[L][N].map(H=>H.key).sort().join()}}return this._renderableTiles.forEach(T=>{for(const A in this._coordsDescendingInvStr){const L=this._coordsDescendingInvStr[A][T.tileID.key];L&&L!==T.textureCoords[A]&&T.clearTextures(this.painter),m.needsRerender(A,T.tileID)&&T.clearTextures(this.painter)}this._rerender[T.tileID.key]=!T.textures.length}),m.clearRerenderCache(),m.sourceCache.removeOutdated(this.painter),this}renderLayer(a){const m=a.type,T=this.painter,A=T.style._order,L=T.currentLayer,N=L+1===A.length;if(this._renderToTexture[m]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(A[L]),!N))return!0;if(this._renderToTexture[this._prevType]||m==="hillshade"||this._renderToTexture[m]&&N){this._prevType=m;const H=this._stacks.length-1,Q=this._stacks[H]||[];for(const se of this._renderableTiles){if(Mu(T,T.style.terrain,se,H),this._rerender[se.tileID.key]){T.context.clear({color:i.Color.transparent});for(let pe=0;pe<Q.length;pe++){const xe=T.style._layers[Q[pe]],Ee=xe.source?this._coordsDescendingInv[xe.source][se.tileID.key]:[se.tileID];T._renderTileClippingMasks(xe,Ee),T.renderLayer(T,T.style.sourceCaches[xe.source],xe,Ee),xe.source&&(se.textureCoords[xe.source]=this._coordsDescendingInvStr[xe.source][se.tileID.key])}}Gs(T,T.style.terrain,se)}if(m==="hillshade"){this._stacks.push([A[L]]);for(const se of this._renderableTiles){const pe=this._coordsDescendingInv[a.source][se.tileID.key];Mu(T,T.style.terrain,se,this._stacks.length-1),T.context.clear({color:i.Color.transparent}),T._renderTileClippingMasks(a,pe),T.renderLayer(T,T.style.sourceCaches[a.source],a,pe),Gs(T,T.style.terrain,se)}return!0}return this._renderToTexture[m]}return!1}}const zl={symbol:function(C,a,m,T,A){if(C.renderPass!=="translucent")return;const L=Lr.disabled,N=C.colorModeForRenderPass();m.layout.get("text-variable-anchor")&&function(H,Q,se,pe,xe,Ee,Qe){const Ge=Q.transform,We=xe==="map",_t=Ee==="map";for(const Tt of H){const kt=pe.getTile(Tt),ot=kt.getBucket(se);if(!ot||!ot.text||!ot.text.segments.get().length)continue;const ft=i.evaluateSizeForZoom(ot.textSizeData,Ge.zoom),Rt=oo(kt,1,Q.transform.zoom),ii=Pr(Tt.posMatrix,_t,We,Q.transform,Rt),Qt=se.layout.get("icon-text-fit")!=="none"&&ot.hasIconData();if(ft){const _i=Math.pow(2,Ge.zoom-kt.tileID.overscaledZ);jh(ot,We,_t,Qe,Ge,ii,Tt.posMatrix,_i,ft,Qt,Q.style.terrain?(Jt,Ji)=>Q.style.terrain.getElevation(Tt,Jt,Ji):null)}}}(T,C,m,a,m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),A),m.paint.get("icon-opacity").constantOr(1)!==0&&rc(C,a,m,T,!1,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),m.layout.get("icon-rotation-alignment"),m.layout.get("icon-pitch-alignment"),m.layout.get("icon-keep-upright"),L,N),m.paint.get("text-opacity").constantOr(1)!==0&&rc(C,a,m,T,!0,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),m.layout.get("text-keep-upright"),L,N),a.map.showCollisionBoxes&&(Qn(C,a,m,T,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),!0),Qn(C,a,m,T,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),!1))},circle:function(C,a,m,T){if(C.renderPass!=="translucent")return;const A=m.paint.get("circle-opacity"),L=m.paint.get("circle-stroke-width"),N=m.paint.get("circle-stroke-opacity"),H=!m.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(L.constantOr(1)===0||N.constantOr(1)===0))return;const Q=C.context,se=Q.gl,pe=C.depthModeForSublayer(0,Un.ReadOnly),xe=Lr.disabled,Ee=C.colorModeForRenderPass(),Qe=[];for(let Ge=0;Ge<T.length;Ge++){const We=T[Ge],_t=a.getTile(We),Tt=_t.getBucket(m);if(!Tt)continue;const kt=Tt.programConfigurations.get(m.id),ot=C.useProgram("circle",kt),ft=Tt.layoutVertexBuffer,Rt=Tt.indexBuffer,ii=C.style.terrain&&C.style.terrain.getTerrainData(We),Qt={programConfiguration:kt,program:ot,layoutVertexBuffer:ft,indexBuffer:Rt,uniformValues:eo(C,We,_t,m),terrainData:ii};if(H){const _i=Tt.segments.get();for(const Jt of _i)Qe.push({segments:new i.SegmentVector([Jt]),sortKey:Jt.sortKey,state:Qt})}else Qe.push({segments:Tt.segments,sortKey:0,state:Qt})}H&&Qe.sort((Ge,We)=>Ge.sortKey-We.sortKey);for(const Ge of Qe){const{programConfiguration:We,program:_t,layoutVertexBuffer:Tt,indexBuffer:kt,uniformValues:ot,terrainData:ft}=Ge.state;_t.draw(Q,se.TRIANGLES,pe,xe,Ee,Br.disabled,ot,ft,m.id,Tt,kt,Ge.segments,m.paint,C.transform.zoom,We)}},heatmap:function(C,a,m,T){if(m.paint.get("heatmap-opacity")!==0)if(C.renderPass==="offscreen"){const A=C.context,L=A.gl,N=Lr.disabled,H=new jr([L.ONE,L.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(Q,se,pe){const xe=Q.gl;Q.activeTexture.set(xe.TEXTURE1),Q.viewport.set([0,0,se.width/4,se.height/4]);let Ee=pe.heatmapFbo;if(Ee)xe.bindTexture(xe.TEXTURE_2D,Ee.colorAttachment.get()),Q.bindFramebuffer.set(Ee.framebuffer);else{const Qe=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Qe),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),Ee=pe.heatmapFbo=Q.createFramebuffer(se.width/4,se.height/4,!1),function(Ge,We,_t,Tt){const kt=Ge.gl;kt.texImage2D(kt.TEXTURE_2D,0,kt.RGBA,We.width/4,We.height/4,0,kt.RGBA,Ge.extRenderToTextureHalfFloat?Ge.extTextureHalfFloat.HALF_FLOAT_OES:kt.UNSIGNED_BYTE,null),Tt.colorAttachment.set(_t)}(Q,se,Qe,Ee)}})(A,C,m),A.clear({color:i.Color.transparent});for(let Q=0;Q<T.length;Q++){const se=T[Q];if(a.hasRenderableParent(se))continue;const pe=a.getTile(se),xe=pe.getBucket(m);if(!xe)continue;const Ee=xe.programConfigurations.get(m.id),Qe=C.useProgram("heatmap",Ee),{zoom:Ge}=C.transform;Qe.draw(A,L.TRIANGLES,Un.disabled,N,H,Br.disabled,Sl(se.posMatrix,pe,Ge,m.paint.get("heatmap-intensity")),null,m.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,m.paint,C.transform.zoom,Ee)}A.viewport.set([0,0,C.width,C.height])}else C.renderPass==="translucent"&&(C.context.setColorMode(C.colorModeForRenderPass()),function(A,L){const N=A.context,H=N.gl,Q=L.heatmapFbo;if(!Q)return;N.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Q.colorAttachment.get()),N.activeTexture.set(H.TEXTURE1);let se=L.colorRampTexture;se||(se=L.colorRampTexture=new we(N,L.colorRamp,H.RGBA)),se.bind(H.LINEAR,H.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(N,H.TRIANGLES,Un.disabled,Lr.disabled,A.colorModeForRenderPass(),Br.disabled,((pe,xe,Ee,Qe)=>{const Ge=i.create();i.ortho(Ge,0,pe.width,pe.height,0,0,1);const We=pe.context.gl;return{u_matrix:Ge,u_world:[We.drawingBufferWidth,We.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:xe.paint.get("heatmap-opacity")}})(A,L),null,L.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,L.paint,A.transform.zoom)}(C,m))},line:function(C,a,m,T){if(C.renderPass!=="translucent")return;const A=m.paint.get("line-opacity"),L=m.paint.get("line-width");if(A.constantOr(1)===0||L.constantOr(1)===0)return;const N=C.depthModeForSublayer(0,Un.ReadOnly),H=C.colorModeForRenderPass(),Q=m.paint.get("line-dasharray"),se=m.paint.get("line-pattern"),pe=se.constantOr(1),xe=m.paint.get("line-gradient"),Ee=m.getCrossfadeParameters(),Qe=pe?"linePattern":Q?"lineSDF":xe?"lineGradient":"line",Ge=C.context,We=Ge.gl;let _t=!0;for(const Tt of T){const kt=a.getTile(Tt);if(pe&&!kt.patternsLoaded())continue;const ot=kt.getBucket(m);if(!ot)continue;const ft=ot.programConfigurations.get(m.id),Rt=C.context.program.get(),ii=C.useProgram(Qe,ft),Qt=_t||ii.program!==Rt,_i=C.style.terrain&&C.style.terrain.getTerrainData(Tt),Jt=se.constantOr(null);if(Jt&&kt.imageAtlas){const en=kt.imageAtlas,Rn=en.patternPositions[Jt.to.toString()],$n=en.patternPositions[Jt.from.toString()];Rn&&$n&&ft.setConstantPatternPositions(Rn,$n)}const Ji=_i?Tt:null,Vi=pe?Al(C,kt,m,Ee,Ji):Q?Ml(C,kt,m,Q,Ee,Ji):xe?Ra(C,kt,m,ot.lineClipsArray.length,Ji):Il(C,kt,m,Ji);if(pe)Ge.activeTexture.set(We.TEXTURE0),kt.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),ft.updatePaintBuffers(Ee);else if(Q&&(Qt||C.lineAtlas.dirty))Ge.activeTexture.set(We.TEXTURE0),C.lineAtlas.bind(Ge);else if(xe){const en=ot.gradients[m.id];let Rn=en.texture;if(m.gradientVersion!==en.version){let $n=256;if(m.stepInterpolant){const dn=a.getSource().maxzoom,xr=Tt.canonical.z===dn?Math.ceil(1<<C.transform.maxZoom-Tt.canonical.z):1;$n=i.clamp(i.nextPowerOfTwo(ot.maxLineLength/i.EXTENT*1024*xr),256,Ge.maxTextureSize)}en.gradient=i.renderColorRamp({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:$n,image:en.gradient||void 0,clips:ot.lineClipsArray}),en.texture?en.texture.update(en.gradient):en.texture=new we(Ge,en.gradient,We.RGBA),en.version=m.gradientVersion,Rn=en.texture}Ge.activeTexture.set(We.TEXTURE0),Rn.bind(m.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}ii.draw(Ge,We.TRIANGLES,N,C.stencilModeForClipping(Tt),H,Br.disabled,Vi,_i,m.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,m.paint,C.transform.zoom,ft,ot.layoutVertexBuffer2),_t=!1}},fill:function(C,a,m,T){const A=m.paint.get("fill-color"),L=m.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const N=C.colorModeForRenderPass(),H=m.paint.get("fill-pattern"),Q=C.opaquePassEnabledForLayer()&&!H.constantOr(1)&&A.constantOr(i.Color.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===Q){const se=C.depthModeForSublayer(1,C.renderPass==="opaque"?Un.ReadWrite:Un.ReadOnly);Dc(C,a,m,T,se,N,!1)}if(C.renderPass==="translucent"&&m.paint.get("fill-antialias")){const se=C.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,Un.ReadOnly);Dc(C,a,m,T,se,N,!0)}},"fill-extrusion":function(C,a,m,T){const A=m.paint.get("fill-extrusion-opacity");if(A!==0&&C.renderPass==="translucent"){const L=new Un(C.context.gl.LEQUAL,Un.ReadWrite,C.depthRangeFor3D);if(A!==1||m.paint.get("fill-extrusion-pattern").constantOr(1))Iu(C,a,m,T,L,Lr.disabled,jr.disabled),Iu(C,a,m,T,L,C.stencilModeFor3D(),C.colorModeForRenderPass());else{const N=C.colorModeForRenderPass();Iu(C,a,m,T,L,Lr.disabled,N)}}},hillshade:function(C,a,m,T){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const A=C.context,L=C.depthModeForSublayer(0,Un.ReadOnly),N=C.colorModeForRenderPass(),[H,Q]=C.renderPass==="translucent"?C.stencilConfigForOverlap(T):[{},T];for(const se of Q){const pe=a.getTile(se);pe.needsHillshadePrepare!==void 0&&pe.needsHillshadePrepare&&C.renderPass==="offscreen"?Au(C,pe,m,L,Lr.disabled,N):C.renderPass==="translucent"&&Lc(C,se,pe,m,L,H[se.overscaledZ],N)}A.viewport.set([0,0,C.width,C.height])},raster:function(C,a,m,T){if(C.renderPass!=="translucent"||m.paint.get("raster-opacity")===0||!T.length)return;const A=C.context,L=A.gl,N=a.getSource(),H=C.useProgram("raster"),Q=C.colorModeForRenderPass(),[se,pe]=N instanceof cn?[{},T]:C.stencilConfigForOverlap(T),xe=pe[pe.length-1].overscaledZ,Ee=!C.options.moving;for(const Qe of pe){const Ge=C.depthModeForSublayer(Qe.overscaledZ-xe,m.paint.get("raster-opacity")===1?Un.ReadWrite:Un.ReadOnly,L.LESS),We=a.getTile(Qe);We.registerFadeDuration(m.paint.get("raster-fade-duration"));const _t=a.findLoadedParent(Qe,0),Tt=Bc(We,_t,a,m,C.transform,C.style.terrain);let kt,ot;const ft=m.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;A.activeTexture.set(L.TEXTURE0),We.texture.bind(ft,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(L.TEXTURE1),_t?(_t.texture.bind(ft,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),kt=Math.pow(2,_t.tileID.overscaledZ-We.tileID.overscaledZ),ot=[We.tileID.canonical.x*kt%1,We.tileID.canonical.y*kt%1]):We.texture.bind(ft,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Rt=C.style.terrain&&C.style.terrain.getTerrainData(Qe),ii=Rt?Qe:null,Qt=ii?ii.posMatrix:C.transform.calculatePosMatrix(Qe.toUnwrapped(),Ee),_i=ho(Qt,ot||[0,0],kt||1,Tt,m);N instanceof cn?H.draw(A,L.TRIANGLES,Ge,Lr.disabled,Q,Br.disabled,_i,Rt,m.id,N.boundsBuffer,C.quadTriangleIndexBuffer,N.boundsSegments):H.draw(A,L.TRIANGLES,Ge,se[Qe.overscaledZ],Q,Br.disabled,_i,Rt,m.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments)}},background:function(C,a,m,T){const A=m.paint.get("background-color"),L=m.paint.get("background-opacity");if(L===0)return;const N=C.context,H=N.gl,Q=C.transform,se=Q.tileSize,pe=m.paint.get("background-pattern");if(C.isPatternMissing(pe))return;const xe=!pe&&A.a===1&&L===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==xe)return;const Ee=Lr.disabled,Qe=C.depthModeForSublayer(0,xe==="opaque"?Un.ReadWrite:Un.ReadOnly),Ge=C.colorModeForRenderPass(),We=C.useProgram(pe?"backgroundPattern":"background"),_t=T||Q.coveringTiles({tileSize:se,terrain:C.style.terrain});pe&&(N.activeTexture.set(H.TEXTURE0),C.imageManager.bind(C.context));const Tt=m.getCrossfadeParameters();for(const kt of _t){const ot=T?kt.posMatrix:C.transform.calculatePosMatrix(kt.toUnwrapped()),ft=pe?lh(ot,L,C,pe,{tileID:kt,tileSize:se},Tt):Rd(ot,L,A),Rt=C.style.terrain&&C.style.terrain.getTerrainData(kt);We.draw(N,H.TRIANGLES,Qe,Ee,Ge,Br.disabled,ft,Rt,m.id,C.tileExtentBuffer,C.quadTriangleIndexBuffer,C.tileExtentSegments)}},debug:function(C,a,m){for(let T=0;T<m.length;T++)Wh(C,a,m[T])},custom:function(C,a,m){const T=C.context,A=m.implementation;if(C.renderPass==="offscreen"){const L=A.prerender;L&&(C.setCustomLayerDefaults(),T.setColorMode(C.colorModeForRenderPass()),L.call(A,T.gl,C.transform.customLayerMatrix()),T.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),T.setColorMode(C.colorModeForRenderPass()),T.setStencilMode(Lr.disabled);const L=A.renderingMode==="3d"?new Un(C.context.gl.LEQUAL,Un.ReadWrite,C.depthRangeFor3D):C.depthModeForSublayer(0,Un.ReadOnly);T.setDepthMode(L),A.render(T.gl,C.transform.customLayerMatrix()),T.setDirty(),C.setBaseState(),T.bindFramebuffer.set(null)}}};class mh{constructor(a,m){this.context=new Cu(a),this.transform=m,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:i.create(),renderTime:0},this.setup(),this.numSublayers=Xr.maxUnderzooming+Xr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _n,this.gpuTimers={}}resize(a,m,T){if(this.width=a*T,this.height=m*T,this.pixelRatio=T,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const A of this.style._order)this.style._layers[A].resize()}setup(){const a=this.context,m=new i.PosArray;m.emplaceBack(0,0),m.emplaceBack(i.EXTENT,0),m.emplaceBack(0,i.EXTENT),m.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(m,Zn.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);const T=new i.PosArray;T.emplaceBack(0,0),T.emplaceBack(i.EXTENT,0),T.emplaceBack(0,i.EXTENT),T.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=a.createVertexBuffer(T,Zn.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);const A=new i.RasterBoundsArray;A.emplaceBack(0,0,0,0),A.emplaceBack(i.EXTENT,0,i.EXTENT,0),A.emplaceBack(0,i.EXTENT,0,i.EXTENT),A.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.rasterBoundsBuffer=a.createVertexBuffer(A,vi.members),this.rasterBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);const L=new i.PosArray;L.emplaceBack(0,0),L.emplaceBack(1,0),L.emplaceBack(0,1),L.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(L,Zn.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);const N=new i.LineStripIndexArray;N.emplaceBack(0),N.emplaceBack(1),N.emplaceBack(3),N.emplaceBack(2),N.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(N);const H=new i.TriangleIndexArray;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(H),this.emptyTexture=new we(a,{width:1,height:1,data:new Uint8Array([0,0,0,0])},a.gl.RGBA);const Q=this.context.gl;this.stencilClearMode=new Lr({func:Q.ALWAYS,mask:0},0,255,Q.ZERO,Q.ZERO,Q.ZERO)}clearStencil(){const a=this.context,m=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const T=i.create();i.ortho(T,0,this.width,this.height,0,0,1),i.scale(T,T,[m.drawingBufferWidth,m.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,m.TRIANGLES,Un.disabled,this.stencilClearMode,jr.disabled,Br.disabled,Ba(T),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,m){if(this.currentStencilSource===a.source||!a.isTileClipped()||!m||!m.length)return;this.currentStencilSource=a.source;const T=this.context,A=T.gl;this.nextStencilID+m.length>256&&this.clearStencil(),T.setColorMode(jr.disabled),T.setDepthMode(Un.disabled);const L=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const N of m){const H=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,Q=this.style.terrain&&this.style.terrain.getTerrainData(N);L.draw(T,A.TRIANGLES,Un.disabled,new Lr({func:A.ALWAYS,mask:0},H,255,A.KEEP,A.KEEP,A.REPLACE),jr.disabled,Br.disabled,Ba(N.posMatrix),Q,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,m=this.context.gl;return new Lr({func:m.NOTEQUAL,mask:255},a,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(a){const m=this.context.gl;return new Lr({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,m.KEEP,m.KEEP,m.REPLACE)}stencilConfigForOverlap(a){const m=this.context.gl,T=a.sort((N,H)=>H.overscaledZ-N.overscaledZ),A=T[T.length-1].overscaledZ,L=T[0].overscaledZ-A+1;if(L>1){this.currentStencilSource=void 0,this.nextStencilID+L>256&&this.clearStencil();const N={};for(let H=0;H<L;H++)N[H+A]=new Lr({func:m.GEQUAL,mask:255},H+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=L,[N,T]}return[{[A]:Lr.disabled},T]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new jr([a.CONSTANT_COLOR,a.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}depthModeForSublayer(a,m,T){if(!this.opaquePassEnabledForLayer())return Un.disabled;const A=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Un(T||this.context.gl.LEQUAL,m,[A,A])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,m){this.style=a,this.options=m,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();const T=this.style._order,A=this.style.sourceCaches,L=this.style.terrain&&new ph(this);for(const se in A){const pe=A[se];pe.used&&pe.prepare(this.context)}const N={},H={},Q={};for(const se in A){const pe=A[se];N[se]=pe.getVisibleCoordinates(),H[se]=N[se].slice().reverse(),Q[se]=pe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let se=0;se<T.length;se++)if(this.style._layers[T[se]].is3D()){this.opaquePassCutoff=se;break}if(L){this.opaquePassCutoff=0;const se=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!i.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||se.length)&&(i.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(pe,xe){const Ee=pe.context,Qe=Ee.gl,Ge=jr.unblended,We=new Un(Qe.LEQUAL,Un.ReadWrite,[0,1]),_t=xe.getTerrainMesh(),Tt=xe.sourceCache.getRenderableTiles(),kt=pe.useProgram("terrainDepth");Ee.bindFramebuffer.set(xe.getFramebuffer("depth").framebuffer),Ee.viewport.set([0,0,pe.width/devicePixelRatio,pe.height/devicePixelRatio]),Ee.clear({color:i.Color.transparent,depth:1});for(const ot of Tt){const ft=xe.getTerrainData(ot.tileID),Rt=pe.transform.calculatePosMatrix(ot.tileID.toUnwrapped());kt.draw(Ee,Qe.TRIANGLES,We,Lr.disabled,Ge,Br.backCCW,{u_matrix:Rt},ft,"terrain",_t.vertexBuffer,_t.indexBuffer,_t.segments)}Ee.bindFramebuffer.set(null),Ee.viewport.set([0,0,pe.width,pe.height])}(this,this.style.terrain),function(pe,xe){const Ee=pe.context,Qe=Ee.gl,Ge=jr.unblended,We=new Un(Qe.LEQUAL,Un.ReadWrite,[0,1]),_t=xe.getTerrainMesh(),Tt=xe.getCoordsTexture(),kt=xe.sourceCache.getRenderableTiles(),ot=pe.useProgram("terrainCoords");Ee.bindFramebuffer.set(xe.getFramebuffer("coords").framebuffer),Ee.viewport.set([0,0,pe.width/devicePixelRatio,pe.height/devicePixelRatio]),Ee.clear({color:i.Color.transparent,depth:1}),xe.coordsIndex=[];for(const ft of kt){const Rt=xe.getTerrainData(ft.tileID);Ee.activeTexture.set(Qe.TEXTURE0),Qe.bindTexture(Qe.TEXTURE_2D,Tt.texture);const ii=pe.transform.calculatePosMatrix(ft.tileID.toUnwrapped());ot.draw(Ee,Qe.TRIANGLES,We,Lr.disabled,Ge,Br.backCCW,{u_matrix:ii,u_terrain_coords_id:(255-xe.coordsIndex.length)/255,u_texture:0},Rt,"terrain",_t.vertexBuffer,_t.indexBuffer,_t.segments),xe.coordsIndex.push(ft.tileID.key)}Ee.bindFramebuffer.set(null),Ee.viewport.set([0,0,pe.width,pe.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const se of T){const pe=this.style._layers[se];if(!pe.hasOffscreenPass()||pe.isHidden(this.transform.zoom))continue;const xe=H[pe.source];(pe.type==="custom"||xe.length)&&this.renderLayer(this,A[pe.source],pe,xe)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:m.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=m.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!L)for(this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const se=this.style._layers[T[this.currentLayer]],pe=A[se.source],xe=N[se.source];this._renderTileClippingMasks(se,xe),this.renderLayer(this,pe,se,xe)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const se=this.style._layers[T[this.currentLayer]],pe=A[se.source];if(L&&L.renderLayer(se))continue;const xe=(se.type==="symbol"?Q:H)[se.source];this._renderTileClippingMasks(se,N[se.source]),this.renderLayer(this,pe,se,xe)}if(this.options.showTileBoundaries){let se,pe;Object.values(this.style._layers).forEach(xe=>{xe.source&&!xe.isHidden(this.transform.zoom)&&(xe.source!==(pe&&pe.id)&&(pe=this.style.sourceCaches[xe.source]),(!se||se.getSource().maxzoom<pe.getSource().maxzoom)&&(se=pe))}),se&&zl.debug(this,se,se.getVisibleCoordinates())}this.options.showPadding&&function(se){const pe=se.transform.padding;ua(se,se.transform.height-(pe.top||0),3,Rc),ua(se,pe.bottom||0,3,ca),Fc(se,pe.left||0,3,qh),Fc(se,se.transform.width-(pe.right||0),3,Zh);const xe=se.transform.centerPoint;(function(Ee,Qe,Ge,We){ll(Ee,Qe-1,Ge-10,2,20,We),ll(Ee,Qe-10,Ge-1,20,2,We)})(se,xe.x,se.transform.height-xe.y,Oc)}(this),this.context.setDefault()}renderLayer(a,m,T,A){T.isHidden(this.transform.zoom)||(T.type==="background"||T.type==="custom"||(A||[]).length)&&(this.id=T.id,this.gpuTimingStart(T),zl[T.type](a,m,T,A,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const m=this.context.extTimerQuery;let T=this.gpuTimers[a.id];T||(T=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:m.createQueryEXT()}),T.calls++,m.beginQueryEXT(m.TIME_ELAPSED_EXT,T.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}queryGpuTimers(a){const m={};for(const T in a){const A=a[T],L=this.context.extTimerQuery,N=L.getQueryObjectEXT(A.query,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(A.query),m[T]=N}return m}translatePosMatrix(a,m,T,A,L){if(!T[0]&&!T[1])return a;const N=L?A==="map"?this.transform.angle:0:A==="viewport"?-this.transform.angle:0;if(N){const se=Math.sin(N),pe=Math.cos(N);T=[T[0]*pe-T[1]*se,T[0]*se+T[1]*pe]}const H=[L?T[0]:oo(m,T[0],this.transform.zoom),L?T[1]:oo(m,T[1],this.transform.zoom),0],Q=new Float32Array(16);return i.translate(Q,a,H),Q}saveTileTexture(a){const m=this._tileTextures[a.size[0]];m?m.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const m=this._tileTextures[a];return m&&m.length>0?m.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const m=this.imageManager.getPattern(a.from.toString()),T=this.imageManager.getPattern(a.to.toString());return!m||!T}useProgram(a,m){this.cache=this.cache||{};const T=a+(m?m.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[T]||(this.cache[T]=new Xn(this.context,a,Sc[a],m,Io[a],this._showOverdrawInspector,this.style.terrain)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Vc{constructor(a,m){this.points=a,this.planes=m}static fromInvProjectionMatrix(a,m,T){const A=Math.pow(2,T),L=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{const Q=1/(H=i.transformMat4([],H,a))[3]/m*A;return i.mul$1(H,H,[Q,Q,1/H[3],Q])}),N=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{const Q=i.sub([],L[H[0]],L[H[1]]),se=i.sub([],L[H[2]],L[H[1]]),pe=i.normalize([],i.cross([],Q,se)),xe=-i.dot(pe,L[H[1]]);return pe.concat(xe)});return new Vc(L,N)}}class Nc{constructor(a,m){this.min=a,this.max=m,this.center=i.scale$1([],i.add([],this.min,this.max),.5)}quadrant(a){const m=[a%2==0,a<2],T=i.clone$2(this.min),A=i.clone$2(this.max);for(let L=0;L<m.length;L++)T[L]=m[L]?this.min[L]:this.center[L],A[L]=m[L]?this.center[L]:this.max[L];return A[2]=this.max[2],new Nc(T,A)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const m=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let T=!0;for(let A=0;A<a.planes.length;A++){const L=a.planes[A];let N=0;for(let H=0;H<m.length;H++)i.dot$1(L,m[H])>=0&&N++;if(N===0)return 0;N!==m.length&&(T=!1)}if(T)return 2;for(let A=0;A<3;A++){let L=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let H=0;H<a.points.length;H++){const Q=a.points[H][A]-this.min[A];L=Math.min(L,Q),N=Math.max(N,Q)}if(N<0||L>this.max[A]-this.min[A])return 0}return 1}}class cl{constructor(a=0,m=0,T=0,A=0){if(isNaN(a)||a<0||isNaN(m)||m<0||isNaN(T)||T<0||isNaN(A)||A<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=m,this.left=T,this.right=A}interpolate(a,m,T){return m.top!=null&&a.top!=null&&(this.top=i.number(a.top,m.top,T)),m.bottom!=null&&a.bottom!=null&&(this.bottom=i.number(a.bottom,m.bottom,T)),m.left!=null&&a.left!=null&&(this.left=i.number(a.left,m.left,T)),m.right!=null&&a.right!=null&&(this.right=i.number(a.right,m.right,T)),this}getCenter(a,m){const T=i.clamp((this.left+a-this.right)/2,0,a),A=i.clamp((this.top+m-this.bottom)/2,0,m);return new i.pointGeometry(T,A)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new cl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Uc{constructor(a,m,T,A,L){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=L===void 0||!!L,this._minZoom=a||0,this._maxZoom=m||22,this._minPitch=T==null?0:T,this._maxPitch=A==null?60:A,this.setMaxBounds(),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cl,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const a=new Uc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.tileSize=this.tileSize,a.latRange=this.latRange,a.width=this.width,a.height=this.height,a._center=this._center,a._elevation=this._elevation,a.zoom=this.zoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const m=-i.wrap(a,-180,180)*Math.PI/180;var T;this.angle!==m&&(this._unmodified=!1,this.angle=m,this._calcMatrices(),this.rotationMatrix=(T=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(T[1]=0,T[2]=0),T[0]=1,T[3]=1,T),function(A,L,N){var H=L[0],Q=L[1],se=L[2],pe=L[3],xe=Math.sin(N),Ee=Math.cos(N);A[0]=H*Ee+se*xe,A[1]=Q*Ee+pe*xe,A[2]=H*-xe+se*Ee,A[3]=Q*-xe+pe*Ee}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const m=i.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==m&&(this._unmodified=!1,this._pitch=m,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const m=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==m&&(this._unmodified=!1,this._zoom=m,this.scale=this.zoomScale(m),this.tileZoom=Math.floor(m),this.zoomFraction=m-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,m,T){this._unmodified=!1,this._edgeInsets.interpolate(a,m,T),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const m=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,m)}getVisibleUnwrappedCoordinates(a){const m=[new i.UnwrappedTileID(0,a)];if(this._renderWorldCopies){const T=this.pointCoordinate(new i.pointGeometry(0,0)),A=this.pointCoordinate(new i.pointGeometry(this.width,0)),L=this.pointCoordinate(new i.pointGeometry(this.width,this.height)),N=this.pointCoordinate(new i.pointGeometry(0,this.height)),H=Math.floor(Math.min(T.x,A.x,L.x,N.x)),Q=Math.floor(Math.max(T.x,A.x,L.x,N.x)),se=1;for(let pe=H-se;pe<=Q+se;pe++)pe!==0&&m.push(new i.UnwrappedTileID(pe,a))}return m}coveringTiles(a){var m,T;let A=this.coveringZoomLevel(a);const L=A;if(a.minzoom!==void 0&&A<a.minzoom)return[];a.maxzoom!==void 0&&A>a.maxzoom&&(A=a.maxzoom);const N=this.pointCoordinate(this.getCameraPoint()),H=i.MercatorCoordinate.fromLngLat(this.center),Q=Math.pow(2,A),se=[Q*N.x,Q*N.y,0],pe=[Q*H.x,Q*H.y,0],xe=Vc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,A);let Ee=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Ee=A);const Qe=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,Ge=ot=>({aabb:new Nc([ot*Q,0,0],[(ot+1)*Q,Q,0]),zoom:0,x:0,y:0,wrap:ot,fullyVisible:!1}),We=[],_t=[],Tt=A,kt=a.reparseOverscaled?L:A;if(this._renderWorldCopies)for(let ot=1;ot<=3;ot++)We.push(Ge(-ot)),We.push(Ge(ot));for(We.push(Ge(0));We.length>0;){const ot=We.pop(),ft=ot.x,Rt=ot.y;let ii=ot.fullyVisible;if(!ii){const en=ot.aabb.intersects(xe);if(en===0)continue;ii=en===2}const Qt=a.terrain?se:pe,_i=ot.aabb.distanceX(Qt),Jt=ot.aabb.distanceY(Qt),Ji=Math.max(Math.abs(_i),Math.abs(Jt)),Vi=Qe+(1<<Tt-ot.zoom)-2;if(ot.zoom===Tt||Ji>Vi&&ot.zoom>=Ee){const en=Tt-ot.zoom,Rn=se[0]-.5-(ft<<en),$n=se[1]-.5-(Rt<<en);_t.push({tileID:new i.OverscaledTileID(ot.zoom===Tt?kt:ot.zoom,ot.wrap,ot.zoom,ft,Rt),distanceSq:i.sqrLen([pe[0]-.5-ft,pe[1]-.5-Rt]),tileDistanceToCamera:Math.sqrt(Rn*Rn+$n*$n)})}else for(let en=0;en<4;en++){const Rn=(ft<<1)+en%2,$n=(Rt<<1)+(en>>1),dn=ot.zoom+1;let xr=ot.aabb.quadrant(en);if(a.terrain){const Cr=new i.OverscaledTileID(dn,ot.wrap,dn,Rn,$n),ur=a.terrain.getMinMaxElevation(Cr),hr=(m=ur.minElevation)!==null&&m!==void 0?m:this.elevation,Dr=(T=ur.maxElevation)!==null&&T!==void 0?T:this.elevation;xr=new Nc([xr.min[0],xr.min[1],hr],[xr.max[0],xr.max[1],Dr])}We.push({aabb:xr,zoom:dn,x:Rn,y:$n,wrap:ot.wrap,fullyVisible:ii})}}return _t.sort((ot,ft)=>ot.distanceSq-ft.distanceSq).map(ot=>ot.tileID)}resize(a,m){this.width=a,this.height=m,this.pixelsToGLUnits=[2/a,-2/m],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const m=i.clamp(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new i.pointGeometry(i.mercatorXfromLng(a.lng)*this.worldSize,i.mercatorYfromLat(m)*this.worldSize)}unproject(a){return new i.MercatorCoordinate(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(a){this.freezeElevation||(this.elevation=a?this.getElevation(this._center,a):0)}getElevation(a,m){const T=i.MercatorCoordinate.fromLngLat(a),A=(1<<this.tileZoom)*i.EXTENT,L=T.x*A,N=T.y*A,H=Math.floor(L/i.EXTENT),Q=Math.floor(N/i.EXTENT),se=new i.OverscaledTileID(this.tileZoom,0,this.tileZoom,H,Q);return m.getElevation(se,L%i.EXTENT,N%i.EXTENT,i.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const m=this.pointLocation(this.centerPoint,a),T=this.getElevation(m,a);if(!(this.elevation-T))return;const A=this.getCameraPosition(),L=i.MercatorCoordinate.fromLngLat(A.lngLat,A.altitude),N=i.MercatorCoordinate.fromLngLat(m,T),H=L.x-N.x,Q=L.y-N.y,se=L.z-N.z,pe=Math.sqrt(H*H+Q*Q+se*se),xe=this.scaleZoom(this.cameraToCenterDistance/pe/this.tileSize);this._elevation=T,this._center=m,this.zoom=xe}setLocationAtPoint(a,m){const T=this.pointCoordinate(m),A=this.pointCoordinate(this.centerPoint),L=this.locationCoordinate(a),N=new i.MercatorCoordinate(L.x-(T.x-A.x),L.y-(T.y-A.y));this.center=this.coordinateLocation(N),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,m){return m?this.coordinatePoint(this.locationCoordinate(a),this.getElevation(a,m),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,m){return this.coordinateLocation(this.pointCoordinate(a,m))}locationCoordinate(a){return i.MercatorCoordinate.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,m){if(m){const Ee=m.pointCoordinate(a);if(Ee!=null)return Ee}const T=[a.x,a.y,0,1],A=[a.x,a.y,1,1];i.transformMat4(T,T,this.pixelMatrixInverse),i.transformMat4(A,A,this.pixelMatrixInverse);const L=T[3],N=A[3],H=T[1]/L,Q=A[1]/N,se=T[2]/L,pe=A[2]/N,xe=se===pe?0:(0-se)/(pe-se);return new i.MercatorCoordinate(i.number(T[0]/L,A[0]/N,xe)/this.worldSize,i.number(H,Q,xe)/this.worldSize)}coordinatePoint(a,m=0,T=this.pixelMatrix){const A=[a.x*this.worldSize,a.y*this.worldSize,m,1];return i.transformMat4(A,A,T),new i.pointGeometry(A[0]/A[3],A[1]/A[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new i.LngLatBounds().extend(this.pointLocation(new i.pointGeometry(0,a))).extend(this.pointLocation(new i.pointGeometry(this.width,a))).extend(this.pointLocation(new i.pointGeometry(this.width,this.height))).extend(this.pointLocation(new i.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new i.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(a,m=!1){const T=a.key,A=m?this._alignedPosMatrixCache:this._posMatrixCache;if(A[T])return A[T];const L=a.canonical,N=this.worldSize/this.zoomScale(L.z),H=L.x+Math.pow(2,L.z)*a.wrap,Q=i.identity(new Float64Array(16));return i.translate(Q,Q,[H*N,L.y*N,0]),i.scale(Q,Q,[N/i.EXTENT,N/i.EXTENT,1]),i.multiply(Q,m?this.alignedProjMatrix:this.projMatrix,Q),A[T]=new Float32Array(Q),A[T]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a,m,T,A,L=-90,N=90,H=-180,Q=180;const se=this.size,pe=this._unmodified;if(this.latRange){const Qe=this.latRange;L=i.mercatorYfromLat(Qe[1])*this.worldSize,N=i.mercatorYfromLat(Qe[0])*this.worldSize,a=N-L<se.y?se.y/(N-L):0}if(this.lngRange){const Qe=this.lngRange;H=i.wrap(i.mercatorXfromLng(Qe[0])*this.worldSize,0,this.worldSize),Q=i.wrap(i.mercatorXfromLng(Qe[1])*this.worldSize,0,this.worldSize),Q<H&&(Q+=this.worldSize),m=Q-H<se.x?se.x/(Q-H):0}const xe=this.point,Ee=Math.max(m||0,a||0);if(Ee)return this.center=this.unproject(new i.pointGeometry(m?(Q+H)/2:xe.x,a?(N+L)/2:xe.y)),this.zoom+=this.scaleZoom(Ee),this._unmodified=pe,void(this._constraining=!1);if(this.latRange){const Qe=xe.y,Ge=se.y/2;Qe-Ge<L&&(A=L+Ge),Qe+Ge>N&&(A=N-Ge)}if(this.lngRange){const Qe=(H+Q)/2,Ge=i.wrap(xe.x,Qe-this.worldSize/2,Qe+this.worldSize/2),We=se.x/2;Ge-We<H&&(T=H+We),Ge+We>Q&&(T=Q-We)}T===void 0&&A===void 0||(this.center=this.unproject(new i.pointGeometry(T!==void 0?T:xe.x,A!==void 0?A:xe.y)).wrap()),this._unmodified=pe,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,m=this.point.x,T=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=i.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let A=i.identity(new Float64Array(16));i.scale(A,A,[this.width/2,-this.height/2,1]),i.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=i.identity(new Float64Array(16)),i.scale(A,A,[1,-1,1]),i.translate(A,A,[-1,-1,0]),i.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const L=Math.PI/2+this._pitch,N=this._fov*(.5+a.y/this.height),H=Math.sin(N)*this.cameraToSeaLevelDistance/Math.sin(i.clamp(Math.PI-L-N,.01,Math.PI-.01)),Q=this.getHorizon(),se=2*Math.atan(Q/this.cameraToCenterDistance)*(.5+a.y/(2*Q)),pe=Math.sin(se)*this.cameraToSeaLevelDistance/Math.sin(i.clamp(Math.PI-L-se,.01,Math.PI-.01)),xe=Math.cos(Math.PI/2-this._pitch)*H+this.cameraToSeaLevelDistance,Ee=Math.cos(Math.PI/2-this._pitch)*pe+this.cameraToSeaLevelDistance,Qe=1.01*Math.min(xe,Ee),Ge=this.height/50;A=new Float64Array(16),i.perspective(A,this._fov,this.width/this.height,Ge,Qe),A[8]=2*-a.x/this.width,A[9]=2*a.y/this.height,i.scale(A,A,[1,-1,1]),i.translate(A,A,[0,0,-this.cameraToCenterDistance]),i.rotateX(A,A,this._pitch),i.rotateZ(A,A,this.angle),i.translate(A,A,[-m,-T,0]),this.mercatorMatrix=i.scale([],A,[this.worldSize,this.worldSize,this.worldSize]),i.scale(A,A,[1,1,this._pixelPerMeter]),this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,A),i.translate(A,A,[0,0,-this.elevation]),this.projMatrix=A,this.invProjMatrix=i.invert([],A),this.pixelMatrix3D=i.multiply(new Float64Array(16),this.labelPlaneMatrix,A);const We=this.width%2/2,_t=this.height%2/2,Tt=Math.cos(this.angle),kt=Math.sin(this.angle),ot=m-Math.round(m)+Tt*We+kt*_t,ft=T-Math.round(T)+Tt*_t+kt*We,Rt=new Float64Array(A);if(i.translate(Rt,Rt,[ot>.5?ot-1:ot,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=Rt,A=i.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");this.pixelMatrixInverse=A,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new i.pointGeometry(0,0)),m=[a.x*this.worldSize,a.y*this.worldSize,0,1];return i.transformMat4(m,m,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.pointGeometry(0,a))}getCameraQueryGeometry(a){const m=this.getCameraPoint();if(a.length===1)return[a[0],m];{let T=m.x,A=m.y,L=m.x,N=m.y;for(const H of a)T=Math.min(T,H.x),A=Math.min(A,H.y),L=Math.max(L,H.x),N=Math.max(N,H.y);return[new i.pointGeometry(T,A),new i.pointGeometry(L,A),new i.pointGeometry(L,N),new i.pointGeometry(T,N),new i.pointGeometry(T,A)]}}}class ku{constructor(a){this._hashName=a&&encodeURIComponent(a),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(m,T){let A=!1,L=null;const N=()=>{L=null,A&&(m(),L=setTimeout(N,300),A=!1)};return()=>(A=!0,L||N(),L)}(this._updateHashUnthrottled.bind(this))}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const m=this._map.getCenter(),T=Math.round(100*this._map.getZoom())/100,A=Math.ceil((T*Math.LN2+Math.log(512/360/.5))/Math.LN10),L=Math.pow(10,A),N=Math.round(m.lng*L)/L,H=Math.round(m.lat*L)/L,Q=this._map.getBearing(),se=this._map.getPitch();let pe="";if(pe+=a?`/${N}/${H}/${T}`:`${T}/${H}/${N}`,(Q||se)&&(pe+="/"+Math.round(10*Q)/10),se&&(pe+=`/${Math.round(se)}`),this._hashName){const xe=this._hashName;let Ee=!1;const Qe=window.location.hash.slice(1).split("&").map(Ge=>{const We=Ge.split("=")[0];return We===xe?(Ee=!0,`${We}=${pe}`):Ge}).filter(Ge=>Ge);return Ee||Qe.push(`${xe}=${pe}`),`#${Qe.join("&")}`}return`#${pe}`}_getCurrentHash(){const a=window.location.hash.replace("#","");if(this._hashName){let m;return a.split("&").map(T=>T.split("=")).forEach(T=>{T[0]===this._hashName&&(m=T)}),(m&&m[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._getCurrentHash();if(a.length>=3&&!a.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:m,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}}}const Pu={linearity:.3,easing:i.bezier(0,0,.3,1)},gh=i.extend({deceleration:2500,maxSpeed:1400},Pu),Vd=i.extend({deceleration:20,maxSpeed:1400},Pu),oc=i.extend({deceleration:1e3,maxSpeed:360},Pu),sc=i.extend({deceleration:1e3,maxSpeed:90},Pu);class $c{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,m=i.exported.now();for(;a.length>0&&m-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const m={zoom:0,bearing:0,pitch:0,pan:new i.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:L}of this._inertiaBuffer)m.zoom+=L.zoomDelta||0,m.bearing+=L.bearingDelta||0,m.pitch+=L.pitchDelta||0,L.panDelta&&m.pan._add(L.panDelta),L.around&&(m.around=L.around),L.pinchAround&&(m.pinchAround=L.pinchAround);const T=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(m.pan.mag()){const L=jc(m.pan.mag(),T,i.extend({},gh,a||{}));A.offset=m.pan.mult(L.amount/m.pan.mag()),A.center=this._map.transform.center,zu(A,L)}if(m.zoom){const L=jc(m.zoom,T,Vd);A.zoom=this._map.transform.zoom+L.amount,zu(A,L)}if(m.bearing){const L=jc(m.bearing,T,oc);A.bearing=this._map.transform.bearing+i.clamp(L.amount,-179,179),zu(A,L)}if(m.pitch){const L=jc(m.pitch,T,sc);A.pitch=this._map.transform.pitch+L.amount,zu(A,L)}if(A.zoom||A.bearing){const L=m.pinchAround===void 0?m.around:m.pinchAround;A.around=L?this._map.unproject(L):this._map.getCenter()}return this.clear(),i.extend(A,{noMoveStart:!0})}}function zu(C,a){(!C.duration||C.duration<a.duration)&&(C.duration=a.duration,C.easing=a.easing)}function jc(C,a,m){const{maxSpeed:T,linearity:A,deceleration:L}=m,N=i.clamp(C*A/(a/1e3),-T,T),H=Math.abs(N)/(L*A);return{easing:m.easing,duration:1e3*H,amount:N*(H/2)}}class Ps extends i.Event{constructor(a,m,T,A={}){const L=q.mousePos(m.getCanvasContainer(),T),N=m.unproject(L);super(a,i.extend({point:L,lngLat:N,originalEvent:T},A)),this._defaultPrevented=!1,this.target=m}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class va extends i.Event{constructor(a,m,T){const A=a==="touchend"?T.changedTouches:T.touches,L=q.touchPos(m.getCanvasContainer(),A),N=L.map(Q=>m.unproject(Q)),H=L.reduce((Q,se,pe,xe)=>Q.add(se.div(xe.length)),new i.pointGeometry(0,0));super(a,{points:L,point:H,lngLats:N,lngLat:m.unproject(H),originalEvent:T}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class zs extends i.Event{constructor(a,m,T){super(a,{originalEvent:T}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Nd{constructor(a,m){this._map=a,this._clickTolerance=m.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new zs(a.type,this._map,a))}mousedown(a,m){return this._mousedownPos=m,this._firePreventable(new Ps(a.type,this._map,a))}mouseup(a){this._map.fire(new Ps(a.type,this._map,a))}click(a,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||this._map.fire(new Ps(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Ps(a.type,this._map,a))}mouseover(a){this._map.fire(new Ps(a.type,this._map,a))}mouseout(a){this._map.fire(new Ps(a.type,this._map,a))}touchstart(a){return this._firePreventable(new va(a.type,this._map,a))}touchmove(a){this._map.fire(new va(a.type,this._map,a))}touchend(a){this._map.fire(new va(a.type,this._map,a))}touchcancel(a){this._map.fire(new va(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Va{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Ps(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ps("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Ps(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ud{constructor(a,m){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,m){this.isEnabled()&&a.shiftKey&&a.button===0&&(q.disableDrag(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(a,m){if(!this._active)return;const T=m;if(this._lastPos.equals(T)||!this._box&&T.dist(this._startPos)<this._clickTolerance)return;const A=this._startPos;this._lastPos=T,this._box||(this._box=q.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const L=Math.min(A.x,T.x),N=Math.max(A.x,T.x),H=Math.min(A.y,T.y),Q=Math.max(A.y,T.y);q.setTransform(this._box,`translate(${L}px,${H}px)`),this._box.style.width=N-L+"px",this._box.style.height=Q-H+"px"}mouseupWindow(a,m){if(!this._active||a.button!==0)return;const T=this._startPos,A=m;if(this.reset(),q.suppressClick(),T.x!==A.x||T.y!==A.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:L=>L.fitScreenCoordinates(T,A,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,m){return this._map.fire(new i.Event(a,{originalEvent:m}))}}function ul(C,a){if(C.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${a.length}`);const m={};for(let T=0;T<C.length;T++)m[C[T].identifier]=a[T];return m}class Du{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,m,T){(this.centroid||T.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),T.length===this.numTouches&&(this.centroid=function(A){const L=new i.pointGeometry(0,0);for(const N of A)L._add(N);return L.div(A.length)}(m),this.touches=ul(T,m)))}touchmove(a,m,T){if(this.aborted||!this.centroid)return;const A=ul(T,m);for(const L in this.touches){const N=this.touches[L],H=A[L];(!H||H.dist(N)>30)&&(this.aborted=!0)}}touchend(a,m,T){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),T.length===0){const A=!this.aborted&&this.centroid;if(this.reset(),A)return A}}}class Lu{constructor(a){this.singleTap=new Du(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,m,T){this.singleTap.touchstart(a,m,T)}touchmove(a,m,T){this.singleTap.touchmove(a,m,T)}touchend(a,m,T){const A=this.singleTap.touchend(a,m,T);if(A){const L=a.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(A)<30;if(L&&N||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=A,this.count===this.numTaps)return this.reset(),A}}}class Xh{constructor(){this._zoomIn=new Lu({numTouches:1,numTaps:2}),this._zoomOut=new Lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,m,T){this._zoomIn.touchstart(a,m,T),this._zoomOut.touchstart(a,m,T)}touchmove(a,m,T){this._zoomIn.touchmove(a,m,T),this._zoomOut.touchmove(a,m,T)}touchend(a,m,T){const A=this._zoomIn.touchend(a,m,T),L=this._zoomOut.touchend(a,m,T);return A?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()+1,around:N.unproject(A)},{originalEvent:a})}):L?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()-1,around:N.unproject(L)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $d={0:1,2:2};class Bu{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(a,m){return!1}_move(a,m){return{}}mousedown(a,m){if(this._lastPoint)return;const T=q.mouseButton(a);this._correctButton(a,T)&&(this._lastPoint=m,this._eventButton=T)}mousemoveWindow(a,m){const T=this._lastPoint;if(T){if(a.preventDefault(),function(A,L){const N=$d[L];return A.buttons===void 0||(A.buttons&N)!==N}(a,this._eventButton))this.reset();else if(this._moved||!(m.dist(T)<this._clickTolerance))return this._moved=!0,this._lastPoint=m,this._move(T,m)}}mouseupWindow(a){this._lastPoint&&q.mouseButton(a)===this._eventButton&&(this._moved&&q.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ac extends Bu{mousedown(a,m){super.mousedown(a,m),this._lastPoint&&(this._active=!0)}_correctButton(a,m){return m===0&&!a.ctrlKey}_move(a,m){return{around:m,panDelta:m.sub(a)}}}class ha extends Bu{_correctButton(a,m){return m===0&&a.ctrlKey||m===2}_move(a,m){const T=.8*(m.x-a.x);if(T)return this._active=!0,{bearingDelta:T}}contextmenu(a){a.preventDefault()}}class Zi extends Bu{_correctButton(a,m){return m===0&&a.ctrlKey||m===2}_move(a,m){const T=-.5*(m.y-a.y);if(T)return this._active=!0,{pitchDelta:T}}contextmenu(a){a.preventDefault()}}class Gc{constructor(a,m){this._minTouches=a.cooperativeGestures?2:1,this._clickTolerance=a.clickTolerance||1,this._map=m,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new i.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(a,m,T){return this._calculateTransform(a,m,T)}touchmove(a,m,T){if(this._map._cooperativeGestures&&(this._minTouches===2&&T.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(a,!1,T.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(T.length<this._minTouches))return a.preventDefault(),this._calculateTransform(a,m,T)}touchend(a,m,T){this._calculateTransform(a,m,T),this._active&&T.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,m,T){T.length>0&&(this._active=!0);const A=ul(T,m),L=new i.pointGeometry(0,0),N=new i.pointGeometry(0,0);let H=0;for(const se in A){const pe=A[se],xe=this._touches[se];xe&&(L._add(pe),N._add(pe.sub(xe)),H++,A[se]=pe)}if(this._touches=A,H<this._minTouches||!N.mag())return;const Q=N.div(H);return this._sum._add(Q),this._sum.mag()<this._clickTolerance?void 0:{around:L.div(H),panDelta:Q}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(a){}_move(a,m,T){return{}}touchstart(a,m,T){this._firstTwoTouches||T.length<2||(this._firstTwoTouches=[T[0].identifier,T[1].identifier],this._start([m[0],m[1]]))}touchmove(a,m,T){if(!this._firstTwoTouches)return;a.preventDefault();const[A,L]=this._firstTwoTouches,N=No(T,m,A),H=No(T,m,L);if(!N||!H)return;const Q=this._aroundCenter?null:N.add(H).div(2);return this._move([N,H],Q,a)}touchend(a,m,T){if(!this._firstTwoTouches)return;const[A,L]=this._firstTwoTouches,N=No(T,m,A),H=No(T,m,L);N&&H||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function No(C,a,m){for(let T=0;T<C.length;T++)if(C[T].identifier===m)return a[T]}function hl(C,a){return Math.log(C/a)/Math.LN2}class Ni extends Dl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,m){const T=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(hl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hl(this._distance,T),pinchAround:m}}}function qc(C,a){return 180*C.angleWith(a)/Math.PI}class Sr extends Dl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,m){const T=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qc(this._vector,T),pinchAround:m}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const m=25/(Math.PI*this._minDiameter)*360,T=qc(a,this._startVector);return Math.abs(T)<m}}function lc(C){return Math.abs(C.y)>Math.abs(C.x)}class Hh extends Dl{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,m,T){super.touchstart(a,m,T),this._currentTouchCount=T.length}_start(a){this._lastPoints=a,lc(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,m,T){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const A=a[0].sub(this._lastPoints[0]),L=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(A,L,T.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(A.y+L.y)/2*-.5}):void 0}gestureBeginsVertically(a,m,T){if(this._valid!==void 0)return this._valid;const A=a.mag()>=2,L=m.mag()>=2;if(!A&&!L)return;if(!A||!L)return this._firstMove===void 0&&(this._firstMove=T),T-this._firstMove<100&&void 0;const N=a.y>0==m.y>0;return lc(a)&&lc(m)&&N}}const Ru={panStep:100,bearingStep:15,pitchStep:10};class cc{constructor(){const a=Ru;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let m=0,T=0,A=0,L=0,N=0;switch(a.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:a.shiftKey?T=-1:(a.preventDefault(),L=-1);break;case 39:a.shiftKey?T=1:(a.preventDefault(),L=1);break;case 38:a.shiftKey?A=1:(a.preventDefault(),N=-1);break;case 40:a.shiftKey?A=-1:(a.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(T=0,A=0),{cameraAnimation:H=>{const Q=H.getZoom();H.easeTo({duration:300,easeId:"keyboardHandler",easing:Kh,zoom:m?Math.round(Q)+m*(a.shiftKey?2:1):Q,bearing:H.getBearing()+T*this._bearingStep,pitch:H.getPitch()+A*this._pitchStep,offset:[-L*this._panStep,-N*this._panStep],center:H.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kh(C){return C*(2-C)}const Yh=4.000244140625;class Ou{constructor(a,m){this._map=a,this._el=a.getCanvasContainer(),this._handler=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;a.preventDefault()}let m=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const T=i.exported.now(),A=T-(this._lastWheelEventTime||0);this._lastWheelEventTime=T,m!==0&&m%Yh==0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":A>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(A*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),a.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=a,this._delta-=m,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const m=q.mousePos(this._el,a);this._around=i.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(m)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;if(this._delta!==0){const H=this._type==="wheel"&&Math.abs(this._delta)>Yh?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&Q!==0&&(Q=1/Q);const se=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(se*Q))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,T=this._startZoom,A=this._easing;let L,N=!1;if(this._type==="wheel"&&T&&A){const H=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),Q=A(H);L=i.number(T,m,Q),H<1?this._frameId||(this._frameId=!0):N=!0}else L=m,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!N,zoomDelta:L-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let m=i.ease;if(this._prevEase){const T=this._prevEase,A=(i.exported.now()-T.start)/T.duration,L=T.easing(A+.01)-T.easing(A),N=.27/Math.sqrt(L*L+1e-4)*.01,H=Math.sqrt(.0729-N*N);m=i.bezier(N,H,.25,1)}return this._prevEase={start:i.exported.now(),duration:a,easing:m},m}reset(){this._active=!1}}class Fu{constructor(a,m){this._clickZoom=a,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zc{constructor(){this.reset()}reset(){this._active=!1}dblclick(a,m){return a.preventDefault(),{cameraAnimation:T=>{T.easeTo({duration:300,zoom:T.getZoom()+(a.shiftKey?-1:1),around:T.unproject(m)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uc{constructor(){this._tap=new Lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(a,m,T){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?T.length>0&&(this._swipePoint=m[0],this._swipeTouch=T[0].identifier):this._tap.touchstart(a,m,T))}touchmove(a,m,T){if(this._tapTime){if(this._swipePoint){if(T[0].identifier!==this._swipeTouch)return;const A=m[0],L=A.y-this._swipePoint.y;return this._swipePoint=A,a.preventDefault(),this._active=!0,{zoomDelta:L/128}}}else this._tap.touchmove(a,m,T)}touchend(a,m,T){this._tapTime?this._swipePoint&&T.length===0&&this.reset():this._tap.touchend(a,m,T)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Po{constructor(a,m,T){this._el=a,this._mousePan=m,this._touchPan=T}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bs{constructor(a,m,T){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=m,this._mousePitch=T}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vu{constructor(a,m,T,A){this._el=a,this._touchZoom=m,this._touchRotate=T,this._tapDragZoom=A,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ll=C=>C.zoom||C.drag||C.pitch||C.rotate;class Bl extends i.Event{}function dl(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta}class ji{constructor(a,m){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $c(a),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(m),i.bindAll(["handleEvent","handleWindowEvent"],this);const T=this._el;this._listeners=[[T,"touchstart",{passive:!0}],[T,"touchmove",{passive:!1}],[T,"touchend",void 0],[T,"touchcancel",void 0],[T,"mousedown",void 0],[T,"mousemove",void 0],[T,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[T,"mouseover",void 0],[T,"mouseout",void 0],[T,"dblclick",void 0],[T,"click",void 0],[T,"keydown",{capture:!1}],[T,"keyup",void 0],[T,"wheel",{passive:!1}],[T,"contextmenu",void 0],[window,"blur",void 0]];for(const[A,L,N]of this._listeners)q.addEventListener(A,L,A===document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[a,m,T]of this._listeners)q.removeEventListener(a,m,a===document?this.handleWindowEvent:this.handleEvent,T)}_addDefaultHandlers(a){const m=this._map,T=m.getCanvasContainer();this._add("mapEvent",new Nd(m,a));const A=m.boxZoom=new Ud(m,a);this._add("boxZoom",A);const L=new Xh,N=new Zc;m.doubleClickZoom=new Fu(N,L),this._add("tapZoom",L),this._add("clickZoom",N);const H=new uc;this._add("tapDragZoom",H);const Q=m.touchPitch=new Hh(m);this._add("touchPitch",Q);const se=new ha(a),pe=new Zi(a);m.dragRotate=new bs(a,se,pe),this._add("mouseRotate",se,["mousePitch"]),this._add("mousePitch",pe,["mouseRotate"]);const xe=new ac(a),Ee=new Gc(a,m);m.dragPan=new Po(T,xe,Ee),this._add("mousePan",xe),this._add("touchPan",Ee,["touchZoom","touchRotate"]);const Qe=new Sr,Ge=new Ni;m.touchZoomRotate=new Vu(T,Ge,Qe,H),this._add("touchRotate",Qe,["touchPan","touchZoom"]),this._add("touchZoom",Ge,["touchPan","touchRotate"]);const We=m.scrollZoom=new Ou(m,this);this._add("scrollZoom",We,["mousePan"]);const _t=m.keyboard=new cc;this._add("keyboard",_t),this._add("blockableMapEvent",new Va(m));for(const Tt of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Tt]&&m[Tt].enable(a[Tt])}_add(a,m,T){this._handlers.push({handlerName:a,handler:m,allowed:T}),this._handlersById[a]=m}stop(a){if(!this._updatingCamera){for(const{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ll(this._eventsInProgress))||this.isZooming()}_blockedByActive(a,m,T){for(const A in a)if(A!==T&&(!m||m.indexOf(A)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const m=[];for(const T of a)this._el.contains(T.target)&&m.push(T);return m}handleEvent(a,m){if(a.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=a.type==="renderFrame"?void 0:a,A={needsRenderFrame:!1},L={},N={},H=a.touches,Q=H?this._getMapTouches(H):void 0,se=Q?q.touchPos(this._el,Q):q.mousePos(this._el,a);for(const{handlerName:Ee,handler:Qe,allowed:Ge}of this._handlers){if(!Qe.isEnabled())continue;let We;this._blockedByActive(N,Ge,Ee)?Qe.reset():Qe[m||a.type]&&(We=Qe[m||a.type](a,se,Q),this.mergeHandlerResult(A,L,We,Ee,T),We&&We.needsRenderFrame&&this._triggerRenderFrame()),(We||Qe.isActive())&&(N[Ee]=Qe)}const pe={};for(const Ee in this._previousActiveHandlers)N[Ee]||(pe[Ee]=T);this._previousActiveHandlers=N,(Object.keys(pe).length||dl(A))&&(this._changes.push([A,L,pe]),this._triggerRenderFrame()),(Object.keys(N).length||dl(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:xe}=A;xe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],xe(this._map))}mergeHandlerResult(a,m,T,A,L){if(!T)return;i.extend(a,T);const N={handlerName:A,originalEvent:T.originalEvent||L};T.zoomDelta!==void 0&&(m.zoom=N),T.panDelta!==void 0&&(m.drag=N),T.pitchDelta!==void 0&&(m.pitch=N),T.bearingDelta!==void 0&&(m.rotate=N)}_applyChanges(){const a={},m={},T={};for(const[A,L,N]of this._changes)A.panDelta&&(a.panDelta=(a.panDelta||new i.pointGeometry(0,0))._add(A.panDelta)),A.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(a.around=A.around),A.pinchAround!==void 0&&(a.pinchAround=A.pinchAround),A.noInertia&&(a.noInertia=A.noInertia),i.extend(m,L),i.extend(T,N);this._updateMapTransform(a,m,T),this._changes=[]}_updateMapTransform(a,m,T){const A=this._map,L=A.transform,N=A.style&&A.style.terrain;if(!(dl(a)||N&&this._drag))return this._fireEvents(m,T,!0);let{panDelta:H,zoomDelta:Q,bearingDelta:se,pitchDelta:pe,around:xe,pinchAround:Ee}=a;Ee!==void 0&&(xe=Ee),A._stop(!0),xe=xe||A.transform.centerPoint;const Qe=L.pointLocation(H?xe.sub(H):xe);se&&(L.bearing+=se),pe&&(L.pitch+=pe),Q&&(L.zoom+=Q),N?m.drag&&!this._drag?(this._drag={center:L.centerPoint,lngLat:L.pointLocation(xe),point:xe,handlerName:m.drag.handlerName},A.fire(new i.Event("freezeElevation",{freeze:!0}))):this._drag&&T[this._drag.handlerName]?(A.fire(new i.Event("freezeElevation",{freeze:!1})),this._drag=null):m.drag&&this._drag&&(L.center=L.pointLocation(L.centerPoint.sub(H))):L.setLocationAtPoint(Qe,xe),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(m,T,!0)}_fireEvents(a,m,T){const A=Ll(this._eventsInProgress),L=Ll(a),N={};for(const pe in a){const{originalEvent:xe}=a[pe];this._eventsInProgress[pe]||(N[`${pe}start`]=xe),this._eventsInProgress[pe]=a[pe]}!A&&L&&this._fireEvent("movestart",L.originalEvent);for(const pe in N)this._fireEvent(pe,N[pe]);L&&this._fireEvent("move",L.originalEvent);for(const pe in a){const{originalEvent:xe}=a[pe];this._fireEvent(pe,xe)}const H={};let Q;for(const pe in this._eventsInProgress){const{handlerName:xe,originalEvent:Ee}=this._eventsInProgress[pe];this._handlersById[xe].isActive()||(delete this._eventsInProgress[pe],Q=m[xe]||Ee,H[`${pe}end`]=Q)}for(const pe in H)this._fireEvent(pe,H[pe]);const se=Ll(this._eventsInProgress);if(T&&(A||L)&&!se){this._updatingCamera=!0;const pe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),xe=Ee=>Ee!==0&&-this._bearingSnap<Ee&&Ee<this._bearingSnap;pe?(xe(pe.bearing||this._map.getBearing())&&(pe.bearing=0),this._map.easeTo(pe,{originalEvent:Q})):(this._map.fire(new i.Event("moveend",{originalEvent:Q})),xe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,m){this._map.fire(new i.Event(a,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new Bl("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const vo={extend:(C,...a)=>i.extend(C,...a),run(C){C()},logToElement(C,a=!1,m="log"){const T=window.document.getElementById(m);T&&(a&&(T.innerHTML=""),T.innerHTML+=`<br>${C}`)}};class Rr extends i.Evented{constructor(a,m){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=m.bearingSnap,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,m){return this.jumpTo({center:a},m)}panBy(a,m,T){return a=i.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,i.extend({offset:a},m),T)}panTo(a,m,T){return this.easeTo(i.extend({center:a},m),T)}getZoom(){return this.transform.zoom}setZoom(a,m){return this.jumpTo({zoom:a},m),this}zoomTo(a,m,T){return this.easeTo(i.extend({zoom:a},m),T)}zoomIn(a,m){return this.zoomTo(this.getZoom()+1,a,m),this}zoomOut(a,m){return this.zoomTo(this.getZoom()-1,a,m),this}getBearing(){return this.transform.bearing}setBearing(a,m){return this.jumpTo({bearing:a},m),this}getPadding(){return this.transform.padding}setPadding(a,m){return this.jumpTo({padding:a},m),this}rotateTo(a,m,T){return this.easeTo(i.extend({bearing:a},m),T)}resetNorth(a,m){return this.rotateTo(0,i.extend({duration:1e3},a),m),this}resetNorthPitch(a,m){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},a),m),this}snapToNorth(a,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,m):this}getPitch(){return this.transform.pitch}setPitch(a,m){return this.jumpTo({pitch:a},m),this}cameraForBounds(a,m){a=i.LngLatBounds.convert(a);const T=m&&m.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),T,m)}_cameraForBoxAndBearing(a,m,T,A){const L={top:0,bottom:0,right:0,left:0};if(typeof(A=i.extend({padding:L,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){const Rt=A.padding;A.padding={top:Rt,bottom:Rt,right:Rt,left:Rt}}A.padding=i.extend(L,A.padding);const N=this.transform,H=N.padding,Q=N.project(i.LngLat.convert(a)),se=N.project(i.LngLat.convert(m)),pe=Q.rotate(-T*Math.PI/180),xe=se.rotate(-T*Math.PI/180),Ee=new i.pointGeometry(Math.max(pe.x,xe.x),Math.max(pe.y,xe.y)),Qe=new i.pointGeometry(Math.min(pe.x,xe.x),Math.min(pe.y,xe.y)),Ge=Ee.sub(Qe),We=(N.width-(H.left+H.right+A.padding.left+A.padding.right))/Ge.x,_t=(N.height-(H.top+H.bottom+A.padding.top+A.padding.bottom))/Ge.y;if(_t<0||We<0)return void i.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Tt=Math.min(N.scaleZoom(N.scale*Math.min(We,_t)),A.maxZoom),kt=i.pointGeometry.convert(A.offset),ot=new i.pointGeometry((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(T*Math.PI/180),ft=kt.add(ot).mult(N.scale/N.zoomScale(Tt));return{center:N.unproject(Q.add(se).div(2).sub(ft)),zoom:Tt,bearing:T}}fitBounds(a,m,T){return this._fitInternal(this.cameraForBounds(a,m),m,T)}fitScreenCoordinates(a,m,T,A,L){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(i.pointGeometry.convert(a)),this.transform.pointLocation(i.pointGeometry.convert(m)),T,A),A,L)}_fitInternal(a,m,T){return a?(delete(m=i.extend(a,m)).padding,m.linear?this.easeTo(m,T):this.flyTo(m,T)):this}jumpTo(a,m){this.stop();const T=this.transform;let A=!1,L=!1,N=!1;return"zoom"in a&&T.zoom!==+a.zoom&&(A=!0,T.zoom=+a.zoom),a.center!==void 0&&(T.center=i.LngLat.convert(a.center)),"bearing"in a&&T.bearing!==+a.bearing&&(L=!0,T.bearing=+a.bearing),"pitch"in a&&T.pitch!==+a.pitch&&(N=!0,T.pitch=+a.pitch),a.padding==null||T.isPaddingEqual(a.padding)||(T.padding=a.padding),this.fire(new i.Event("movestart",m)).fire(new i.Event("move",m)),A&&this.fire(new i.Event("zoomstart",m)).fire(new i.Event("zoom",m)).fire(new i.Event("zoomend",m)),L&&this.fire(new i.Event("rotatestart",m)).fire(new i.Event("rotate",m)).fire(new i.Event("rotateend",m)),N&&this.fire(new i.Event("pitchstart",m)).fire(new i.Event("pitch",m)).fire(new i.Event("pitchend",m)),this.fire(new i.Event("moveend",m))}calculateCameraOptionsFromTo(a,m,T,A=0){const L=i.MercatorCoordinate.fromLngLat(a,m),N=i.MercatorCoordinate.fromLngLat(T,A),H=N.x-L.x,Q=N.y-L.y,se=N.z-L.z,pe=Math.hypot(H,Q,se);if(pe===0)throw new Error("Can't calculate camera options with same From and To");const xe=Math.hypot(H,Q),Ee=this.transform.scaleZoom(this.transform.cameraToCenterDistance/pe/this.transform.tileSize),Qe=180*Math.atan2(H,-Q)/Math.PI;let Ge=180*Math.acos(xe/pe)/Math.PI;return Ge=se<0?90-Ge:90+Ge,{center:N.toLngLat(),zoom:Ee,pitch:Ge,bearing:Qe}}easeTo(a,m){this._stop(!1,a.easeId),((a=i.extend({offset:[0,0],duration:500,easing:i.ease},a)).animate===!1||!a.essential&&i.exported.prefersReducedMotion)&&(a.duration=0);const T=this.transform,A=this.getZoom(),L=this.getBearing(),N=this.getPitch(),H=this.getPadding(),Q="zoom"in a?+a.zoom:A,se="bearing"in a?this._normalizeBearing(a.bearing,L):L,pe="pitch"in a?+a.pitch:N,xe="padding"in a?a.padding:T.padding,Ee=i.pointGeometry.convert(a.offset);let Qe=T.centerPoint.add(Ee);const Ge=T.pointLocation(Qe),We=i.LngLat.convert(a.center||Ge);this._normalizeCenter(We);const _t=T.project(Ge),Tt=T.project(We).sub(_t),kt=T.zoomScale(Q-A);let ot,ft;a.around&&(ot=i.LngLat.convert(a.around),ft=T.locationPoint(ot));const Rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Q!==A,this._rotating=this._rotating||L!==se,this._pitching=this._pitching||pe!==N,this._padding=!T.isPaddingEqual(xe),this._easeId=a.easeId,this._prepareEase(m,a.noMoveStart,Rt),this._ease(ii=>{if(this._zooming&&(T.zoom=i.number(A,Q,ii)),this._rotating&&(T.bearing=i.number(L,se,ii)),this._pitching&&(T.pitch=i.number(N,pe,ii)),this._padding&&(T.interpolatePadding(H,xe,ii),Qe=T.centerPoint.add(Ee)),ot)T.setLocationAtPoint(ot,ft);else{const Qt=T.zoomScale(T.zoom-A),_i=Q>A?Math.min(2,kt):Math.max(.5,kt),Jt=Math.pow(_i,1-ii),Ji=T.unproject(_t.add(Tt.mult(ii*Jt)).mult(Qt));T.setLocationAtPoint(T.renderWorldCopies?Ji.wrap():Ji,Qe)}this._fireMoveEvents(m)},ii=>{this._afterEase(m,ii)},a),this}_prepareEase(a,m,T={}){this._moving=!0,this.fire(new i.Event("freezeElevation",{freeze:!0})),m||T.moving||this.fire(new i.Event("movestart",a)),this._zooming&&!T.zooming&&this.fire(new i.Event("zoomstart",a)),this._rotating&&!T.rotating&&this.fire(new i.Event("rotatestart",a)),this._pitching&&!T.pitching&&this.fire(new i.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new i.Event("move",a)),this._zooming&&this.fire(new i.Event("zoom",a)),this._rotating&&this.fire(new i.Event("rotate",a)),this._pitching&&this.fire(new i.Event("pitch",a))}_afterEase(a,m){if(this._easeId&&m&&this._easeId===m)return;delete this._easeId,this.fire(new i.Event("freezeElevation",{freeze:!1}));const T=this._zooming,A=this._rotating,L=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,T&&this.fire(new i.Event("zoomend",a)),A&&this.fire(new i.Event("rotateend",a)),L&&this.fire(new i.Event("pitchend",a)),this.fire(new i.Event("moveend",a))}flyTo(a,m){if(!a.essential&&i.exported.prefersReducedMotion){const dn=i.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(dn,m)}this.stop(),a=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},a);const T=this.transform,A=this.getZoom(),L=this.getBearing(),N=this.getPitch(),H=this.getPadding(),Q="zoom"in a?i.clamp(+a.zoom,T.minZoom,T.maxZoom):A,se="bearing"in a?this._normalizeBearing(a.bearing,L):L,pe="pitch"in a?+a.pitch:N,xe="padding"in a?a.padding:T.padding,Ee=T.zoomScale(Q-A),Qe=i.pointGeometry.convert(a.offset);let Ge=T.centerPoint.add(Qe);const We=T.pointLocation(Ge),_t=i.LngLat.convert(a.center||We);this._normalizeCenter(_t);const Tt=T.project(We),kt=T.project(_t).sub(Tt);let ot=a.curve;const ft=Math.max(T.width,T.height),Rt=ft/Ee,ii=kt.mag();if("minZoom"in a){const dn=i.clamp(Math.min(a.minZoom,A,Q),T.minZoom,T.maxZoom),xr=ft/T.zoomScale(dn-A);ot=Math.sqrt(xr/ii*2)}const Qt=ot*ot;function _i(dn){const xr=(Rt*Rt-ft*ft+(dn?-1:1)*Qt*Qt*ii*ii)/(2*(dn?Rt:ft)*Qt*ii);return Math.log(Math.sqrt(xr*xr+1)-xr)}function Jt(dn){return(Math.exp(dn)-Math.exp(-dn))/2}function Ji(dn){return(Math.exp(dn)+Math.exp(-dn))/2}const Vi=_i(0);let en=function(dn){return Ji(Vi)/Ji(Vi+ot*dn)},Rn=function(dn){return ft*((Ji(Vi)*(Jt(xr=Vi+ot*dn)/Ji(xr))-Jt(Vi))/Qt)/ii;var xr},$n=(_i(1)-Vi)/ot;if(Math.abs(ii)<1e-6||!isFinite($n)){if(Math.abs(ft-Rt)<1e-6)return this.easeTo(a,m);const dn=Rt<ft?-1:1;$n=Math.abs(Math.log(Rt/ft))/ot,Rn=function(){return 0},en=function(xr){return Math.exp(dn*ot*xr)}}return a.duration="duration"in a?+a.duration:1e3*$n/("screenSpeed"in a?+a.screenSpeed/ot:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=L!==se,this._pitching=pe!==N,this._padding=!T.isPaddingEqual(xe),this._prepareEase(m,!1),this._ease(dn=>{const xr=dn*$n,Cr=1/en(xr);T.zoom=dn===1?Q:A+T.scaleZoom(Cr),this._rotating&&(T.bearing=i.number(L,se,dn)),this._pitching&&(T.pitch=i.number(N,pe,dn)),this._padding&&(T.interpolatePadding(H,xe,dn),Ge=T.centerPoint.add(Qe));const ur=dn===1?_t:T.unproject(Tt.add(kt.mult(Rn(xr))).mult(Cr));T.setLocationAtPoint(T.renderWorldCopies?ur.wrap():ur,Ge),this._fireMoveEvents(m)},()=>this._afterEase(m),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const T=this._onEaseEnd;delete this._onEaseEnd,T.call(this,m)}if(!a){const T=this.handlers;T&&T.stop(!1)}return this}_ease(a,m,T){T.animate===!1||T.duration===0?(a(1),m()):(this._easeStart=i.exported.now(),this._easeOptions=T,this._onEaseFrame=a,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,m){a=i.wrap(a,-180,180);const T=Math.abs(a-m);return Math.abs(a-360-m)<T&&(a-=360),Math.abs(a+360-m)<T&&(a+=360),a}_normalizeCenter(a){const m=this.transform;if(!m.renderWorldCopies||m.lngRange)return;const T=a.lng-m.center.lng;a.lng+=T>180?-360:T<-180?360:0}}class Wc{constructor(a={}){this.options=a,i.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options&&this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,m){const T=this._map._getUIString(`AttributionControl.${m}`);a.title=T,a.setAttribute("aria-label",T)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(A=>typeof A!="string"?"":A)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const A=this._map.style.stylesheet;this.styleOwner=A.owner,this.styleId=A.id}const m=this._map.style.sourceCaches;for(const A in m){const L=m[A];if(L.used||L.usedForTerrain){const N=L.getSource();N.attribution&&a.indexOf(N.attribution)<0&&a.push(N.attribution)}}a=a.filter(A=>String(A).trim()),a.sort((A,L)=>A.length-L.length),a=a.filter((A,L)=>{for(let N=L+1;N<a.length;N++)if(a[N].indexOf(A)>=0)return!1;return!0});const T=a.join(" | ");T!==this._attribHTML&&(this._attribHTML=T,a.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Nu{constructor(a={}){this.options=a,i.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl mapboxgl-ctrl");const m=q.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://maplibre.org/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const a=this._container.children;if(a.length){const m=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact","mapboxgl-compact"):m.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class hc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const m=++this._id;return this._queue.push({callback:a,id:m,cancelled:!1}),m}remove(a){const m=this._currentlyRunning,T=m?this._queue.concat(m):this._queue;for(const A of T)if(A.id===a)return void(A.cancelled=!0)}run(a=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const m=this._currentlyRunning=this._queue;this._queue=[];for(const T of m)if(!T.cancelled&&(T.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Jh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Uu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Xc={showCompass:!0,showZoom:!0,visualizePitch:!1};class gs{constructor(a,m,T=!1){this._clickTolerance=10,this.element=m,this.mouseRotate=new ha({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,T&&(this.mousePitch=new Zi({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),q.addEventListener(m,"mousedown",this.mousedown),q.addEventListener(m,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(m,"touchmove",this.touchmove),q.addEventListener(m,"touchend",this.touchend),q.addEventListener(m,"touchcancel",this.reset)}down(a,m){this.mouseRotate.mousedown(a,m),this.mousePitch&&this.mousePitch.mousedown(a,m),q.disableDrag()}move(a,m){const T=this.map,A=this.mouseRotate.mousemoveWindow(a,m);if(A&&A.bearingDelta&&T.setBearing(T.getBearing()+A.bearingDelta),this.mousePitch){const L=this.mousePitch.mousemoveWindow(a,m);L&&L.pitchDelta&&T.setPitch(T.getPitch()+L.pitchDelta)}}off(){const a=this.element;q.removeEventListener(a,"mousedown",this.mousedown),q.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(a,"touchmove",this.touchmove),q.removeEventListener(a,"touchend",this.touchend),q.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup)}mousedown(a){this.down(i.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),q.mousePos(this.element,a)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)}mousemove(a){this.move(a,q.mousePos(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function os(C,a,m){if(C=new i.LngLat(C.lng,C.lat),a){const T=new i.LngLat(C.lng-360,C.lat),A=new i.LngLat(C.lng+360,C.lat),L=m.locationPoint(C).distSqr(a);m.locationPoint(T).distSqr(a)<L?C=T:m.locationPoint(A).distSqr(a)<L&&(C=A)}for(;Math.abs(C.lng-m.center.lng)>180;){const T=m.locationPoint(C);if(T.x>=0&&T.y>=0&&T.x<=m.width&&T.y<=m.height)break;C.lng>m.center.lng?C.lng-=360:C.lng+=360}return C}const an={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yn(C,a,m){const T=C.classList;for(const A in an)T.remove(`maplibregl-${m}-anchor-${A}`,`mapboxgl-${m}-anchor-${A}`);T.add(`maplibregl-${m}-anchor-${a}`,`mapboxgl-${m}-anchor-${a}`)}class Hc extends i.Evented{constructor(a,m){if(super(),(a instanceof HTMLElement||m)&&(a=i.extend({element:a},m)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=i.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div"),this._element.setAttribute("aria-label","Map marker");const T=q.createNS("http://www.w3.org/2000/svg","svg"),A=41,L=27;T.setAttributeNS(null,"display","block"),T.setAttributeNS(null,"height",`${A}px`),T.setAttributeNS(null,"width",`${L}px`),T.setAttributeNS(null,"viewBox",`0 0 ${L} ${A}`);const N=q.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"stroke","none"),N.setAttributeNS(null,"stroke-width","1"),N.setAttributeNS(null,"fill","none"),N.setAttributeNS(null,"fill-rule","evenodd");const H=q.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill-rule","nonzero");const Q=q.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(3.0, 29.0)"),Q.setAttributeNS(null,"fill","#000000");const se=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const kt of se){const ot=q.createNS("http://www.w3.org/2000/svg","ellipse");ot.setAttributeNS(null,"opacity","0.04"),ot.setAttributeNS(null,"cx","10.5"),ot.setAttributeNS(null,"cy","5.80029008"),ot.setAttributeNS(null,"rx",kt.rx),ot.setAttributeNS(null,"ry",kt.ry),Q.appendChild(ot)}const pe=q.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);const xe=q.createNS("http://www.w3.org/2000/svg","path");xe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(xe);const Ee=q.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"fill","#000000");const Qe=q.createNS("http://www.w3.org/2000/svg","path");Qe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ee.appendChild(Qe);const Ge=q.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ge.setAttributeNS(null,"fill","#FFFFFF");const We=q.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _t=q.createNS("http://www.w3.org/2000/svg","circle");_t.setAttributeNS(null,"fill","#000000"),_t.setAttributeNS(null,"opacity","0.25"),_t.setAttributeNS(null,"cx","5.5"),_t.setAttributeNS(null,"cy","5.5"),_t.setAttributeNS(null,"r","5.4999962");const Tt=q.createNS("http://www.w3.org/2000/svg","circle");Tt.setAttributeNS(null,"fill","#FFFFFF"),Tt.setAttributeNS(null,"cx","5.5"),Tt.setAttributeNS(null,"cy","5.5"),Tt.setAttributeNS(null,"r","5.4999962"),We.appendChild(_t),We.appendChild(Tt),H.appendChild(Q),H.appendChild(pe),H.appendChild(Ee),H.appendChild(Ge),H.appendChild(We),T.appendChild(H),T.setAttributeNS(null,"height",A*this._scale+"px"),T.setAttributeNS(null,"width",L*this._scale+"px"),this._element.appendChild(T),this._offset=i.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()}),yn(this._element,this._anchor,"marker"),this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=i.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const A=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[A,-1*(38.1-13.5+A)],"bottom-right":[-A,-1*(38.1-13.5+A)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(a){const m=a.code,T=a.charCode||a.keyCode;m!=="Space"&&m!=="Enter"&&T!==32&&T!==13||this.togglePopup()}_onMapClick(a){const m=a.originalEvent.target,T=this._element;this._popup&&(m===T||T.contains(m))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this}_update(a){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=os(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${an[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${m}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const A=this._map.unproject(this._pos),L=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=A.distanceTo(this._lngLat)>20*L?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(a){return this._offset=i.pointGeometry.convert(a),this._update(),this}_onMove(a){if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Qh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let fl,Ao=0,Na=!1;const qs={maxWidth:100,unit:"metric"};function ed(C,a,m){const T=m&&m.maxWidth||100,A=C._container.clientHeight/2,L=C.unproject([0,A]),N=C.unproject([T,A]),H=L.distanceTo(N);if(m&&m.unit==="imperial"){const Q=3.2808*H;Q>5280?xa(a,T,Q/5280,C._getUIString("ScaleControl.Miles")):xa(a,T,Q,C._getUIString("ScaleControl.Feet"))}else m&&m.unit==="nautical"?xa(a,T,H/1852,C._getUIString("ScaleControl.NauticalMiles")):H>=1e3?xa(a,T,H/1e3,C._getUIString("ScaleControl.Kilometers")):xa(a,T,H,C._getUIString("ScaleControl.Meters"))}function xa(C,a,m,T){const A=function(L){const N=Math.pow(10,`${Math.floor(L)}`.length-1);let H=L/N;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(Q){const se=Math.pow(10,Math.ceil(-Math.log(Q)/Math.LN10));return Math.round(Q*se)/se}(H),N*H}(m);C.style.width=a*(A/m)+"px",C.innerHTML=`${A}&nbsp;${T}`}const to={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $u(C){if(C){if(typeof C=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(C,2)));return{center:new i.pointGeometry(0,0),top:new i.pointGeometry(0,C),"top-left":new i.pointGeometry(a,a),"top-right":new i.pointGeometry(-a,a),bottom:new i.pointGeometry(0,-C),"bottom-left":new i.pointGeometry(a,-a),"bottom-right":new i.pointGeometry(-a,-a),left:new i.pointGeometry(C,0),right:new i.pointGeometry(-C,0)}}if(C instanceof i.pointGeometry||Array.isArray(C)){const a=i.pointGeometry.convert(C);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:i.pointGeometry.convert(C.center||[0,0]),top:i.pointGeometry.convert(C.top||[0,0]),"top-left":i.pointGeometry.convert(C["top-left"]||[0,0]),"top-right":i.pointGeometry.convert(C["top-right"]||[0,0]),bottom:i.pointGeometry.convert(C.bottom||[0,0]),"bottom-left":i.pointGeometry.convert(C["bottom-left"]||[0,0]),"bottom-right":i.pointGeometry.convert(C["bottom-right"]||[0,0]),left:i.pointGeometry.convert(C.left||[0,0]),right:i.pointGeometry.convert(C.right||[0,0])}}return $u(new i.pointGeometry(0,0))}const pl={supported:F,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends Rr{constructor(C){var a;if(i.PerformanceUtils.mark(i.PerformanceMarkers.create),(C=i.extend({},Uu,C)).minZoom!=null&&C.maxZoom!=null&&C.minZoom>C.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(C.minPitch!=null&&C.maxPitch!=null&&C.minPitch>C.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(C.minPitch!=null&&C.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(C.maxPitch!=null&&C.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Uc(C.minZoom,C.maxZoom,C.minPitch,C.maxPitch,C.renderWorldCopies),{bearingSnap:C.bearingSnap}),this._interactive=C.interactive,this._cooperativeGestures=C.cooperativeGestures,this._maxTileCacheSize=C.maxTileCacheSize,this._failIfMajorPerformanceCaveat=C.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=C.preserveDrawingBuffer,this._antialias=C.antialias,this._trackResize=C.trackResize,this._bearingSnap=C.bearingSnap,this._refreshExpiredTiles=C.refreshExpiredTiles,this._fadeDuration=C.fadeDuration,this._crossSourceCollisions=C.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=C.collectResourceTiming,this._renderTaskQueue=new hc,this._controls=[],this._mapId=i.uniqueId(),this._locale=i.extend({},Jh,C.locale),this._clickTolerance=C.clickTolerance,this._pixelRatio=(a=C.pixelRatio)!==null&&a!==void 0?a:devicePixelRatio,this._requestManager=new re(C.transformRequest),typeof C.container=="string"){if(this._container=document.getElementById(C.container),!this._container)throw new Error(`Container '${C.container}' not found.`)}else{if(!(C.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=C.container}if(C.maxBounds&&this.setMaxBounds(C.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ji(this,C),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=C.hash&&new ku(typeof C.hash=="string"&&C.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}),C.bounds&&(this.resize(),this.fitBounds(C.bounds,i.extend({},C.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=C.localIdeographFontFamily,C.style&&this.setStyle(C.style,{localIdeographFontFamily:C.localIdeographFontFamily}),C.attributionControl&&this.addControl(new Wc({customAttribution:C.customAttribution})),C.maplibreLogo&&this.addControl(new Nu,C.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",m=>{this._update(m.dataType==="style"),this.fire(new i.Event(`${m.dataType}data`,m))}),this.on("dataloading",m=>{this.fire(new i.Event(`${m.dataType}dataloading`,m))}),this.on("dataabort",m=>{this.fire(new i.Event("sourcedataabort",m))})}_getMapId(){return this._mapId}addControl(C,a){if(a===void 0&&(a=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const m=C.onAdd(this);this._controls.push(C);const T=this._controlPositions[a];return a.indexOf("bottom")!==-1?T.insertBefore(m,T.firstChild):T.appendChild(m),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(C);return a>-1&&this._controls.splice(a,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}calculateCameraOptionsFromTo(C,a,m,T){return T==null&&this.style.terrain&&(T=this.transform.getElevation(m,this.style.terrain)),super.calculateCameraOptionsFromTo(C,a,m,T)}resize(C){const a=this._containerDimensions(),m=a[0],T=a[1];this._resizeCanvas(m,T,this.getPixelRatio()),this.transform.resize(m,T),this.painter.resize(m,T,this.getPixelRatio());const A=!this._moving;return A&&(this.stop(),this.fire(new i.Event("movestart",C)).fire(new i.Event("move",C))),this.fire(new i.Event("resize",C)),A&&this.fire(new i.Event("moveend",C)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(C){const[a,m]=this._containerDimensions();this._pixelRatio=C,this._resizeCanvas(a,m,C),this.painter.resize(a,m,C)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(i.LngLatBounds.convert(C)),this._update()}setMinZoom(C){if((C=C==null?-2:C)>=-2&&C<=this.transform.maxZoom)return this.transform.minZoom=C,this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C==null?22:C)>=this.transform.minZoom)return this.transform.maxZoom=C,this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C==null?0:C)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.minPitch=C,this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C==null?60:C)>85)throw new Error("maxPitch must be less than or equal to 85");if(C>=this.transform.minPitch)return this.transform.maxPitch=C,this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.renderWorldCopies=C,this._update()}project(C){return this.transform.locationPoint(i.LngLat.convert(C),this.style&&this.style.terrain)}unproject(C){return this.transform.pointLocation(i.pointGeometry.convert(C),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(C,a,m){if(C==="mouseenter"||C==="mouseover"){let T=!1;return{layer:a,listener:m,delegates:{mousemove:L=>{const N=this.getLayer(a)?this.queryRenderedFeatures(L.point,{layers:[a]}):[];N.length?T||(T=!0,m.call(this,new Ps(C,this,L.originalEvent,{features:N}))):T=!1},mouseout:()=>{T=!1}}}}if(C==="mouseleave"||C==="mouseout"){let T=!1;return{layer:a,listener:m,delegates:{mousemove:N=>{(this.getLayer(a)?this.queryRenderedFeatures(N.point,{layers:[a]}):[]).length?T=!0:T&&(T=!1,m.call(this,new Ps(C,this,N.originalEvent)))},mouseout:N=>{T&&(T=!1,m.call(this,new Ps(C,this,N.originalEvent)))}}}}{const T=A=>{const L=this.getLayer(a)?this.queryRenderedFeatures(A.point,{layers:[a]}):[];L.length&&(A.features=L,m.call(this,A),delete A.features)};return{layer:a,listener:m,delegates:{[C]:T}}}}on(C,a,m){if(m===void 0)return super.on(C,a);const T=this._createDelegatedListener(C,a,m);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(T);for(const A in T.delegates)this.on(A,T.delegates[A]);return this}once(C,a,m){if(m===void 0)return super.once(C,a);const T=this._createDelegatedListener(C,a,m);for(const A in T.delegates)this.once(A,T.delegates[A]);return this}off(C,a,m){return m===void 0?super.off(C,a):(this._delegatedListeners&&this._delegatedListeners[C]&&(T=>{const A=this._delegatedListeners[C];for(let L=0;L<A.length;L++){const N=A[L];if(N.layer===a&&N.listener===m){for(const H in N.delegates)this.off(H,N.delegates[H]);return A.splice(L,1),this}}})(),this)}queryRenderedFeatures(C,a){if(!this.style)return[];let m;if(a!==void 0||C===void 0||C instanceof i.pointGeometry||Array.isArray(C)||(a=C,C=void 0),a=a||{},(C=C||[[0,0],[this.transform.width,this.transform.height]])instanceof i.pointGeometry||typeof C[0]=="number")m=[i.pointGeometry.convert(C)];else{const T=i.pointGeometry.convert(C[0]),A=i.pointGeometry.convert(C[1]);m=[T,new i.pointGeometry(A.x,T.y),A,new i.pointGeometry(T.x,A.y),T]}return this.style.queryRenderedFeatures(m,a,this.transform)}querySourceFeatures(C,a){return this.style.querySourceFeatures(C,a)}setStyle(C,a){return(a=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(C,a))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){const a=this._locale[C];if(a==null)throw new Error(`Missing UI string '${C}'`);return a}_updateStyle(C,a){return this.style&&(this.style.setEventedParent(null),this.style._remove()),C?(this.style=new $r(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C):this.style.loadJSON(C),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $r(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,a){if(typeof C=="string"){const m=this._requestManager.transformRequest(C,i.ResourceType.Style);i.getJSON(m,(T,A)=>{T?this.fire(new i.ErrorEvent(T)):A&&this._updateDiff(A,a)})}else typeof C=="object"&&this._updateDiff(C,a)}_updateDiff(C,a){try{this.style.setState(C)&&this._update(!0)}catch(m){i.warnOnce(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(C,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():i.warnOnce("There is no style added to the map.")}addSource(C,a){return this._lazyInitEmptyStyle(),this.style.addSource(C,a),this._update(!0)}isSourceLoaded(C){const a=this.style&&this.style.sourceCaches[C];if(a!==void 0)return a.loaded();this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${C}'`)))}setTerrain(C){return this.style.setTerrain(C),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const C=this.style&&this.style.sourceCaches;for(const a in C){const m=C[a]._tiles;for(const T in m){const A=m[T];if(A.state!=="loaded"&&A.state!=="errored")return!1}}return!0}addSourceType(C,a,m){return this._lazyInitEmptyStyle(),this.style.addSourceType(C,a,m)}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,a,{pixelRatio:m=1,sdf:T=!1,stretchX:A,stretchY:L,content:N}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||i.isImageBitmap(a)){const{width:H,height:Q,data:se}=i.exported.getImageData(a);this.style.addImage(C,{data:new i.RGBAImage({width:H,height:Q},se),pixelRatio:m,stretchX:A,stretchY:L,content:N,sdf:T,version:0})}else{if(a.width===void 0||a.height===void 0)return this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:Q,data:se}=a,pe=a;this.style.addImage(C,{data:new i.RGBAImage({width:H,height:Q},new Uint8Array(se)),pixelRatio:m,stretchX:A,stretchY:L,content:N,sdf:T,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,C)}}}updateImage(C,a){const m=this.style.getImage(C);if(!m)return this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const T=a instanceof HTMLImageElement||i.isImageBitmap(a)?i.exported.getImageData(a):a,{width:A,height:L,data:N}=T;if(A===void 0||L===void 0)return this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(A!==m.data.width||L!==m.data.height)return this.fire(new i.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const H=!(a instanceof HTMLImageElement||i.isImageBitmap(a));m.data.replace(N,H),this.style.updateImage(C,m)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C,a){i.getImage(this._requestManager.transformRequest(C,i.ResourceType.Image),a)}listImages(){return this.style.listImages()}addLayer(C,a){return this._lazyInitEmptyStyle(),this.style.addLayer(C,a),this._update(!0)}moveLayer(C,a){return this.style.moveLayer(C,a),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}setLayerZoomRange(C,a,m){return this.style.setLayerZoomRange(C,a,m),this._update(!0)}setFilter(C,a,m={}){return this.style.setFilter(C,a,m),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,a,m,T={}){return this.style.setPaintProperty(C,a,m,T),this._update(!0)}getPaintProperty(C,a){return this.style.getPaintProperty(C,a)}setLayoutProperty(C,a,m,T={}){return this.style.setLayoutProperty(C,a,m,T),this._update(!0)}getLayoutProperty(C,a){return this.style.getLayoutProperty(C,a)}setLight(C,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(C,a){return this.style.setFeatureState(C,a),this._update()}removeFeatureState(C,a){return this.style.removeFeatureState(C,a),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,a=0;return this._container&&(C=this._container.clientWidth||400,a=this._container.clientHeight||300),[C,a]}_setupContainer(){const C=this._container;C.classList.add("maplibregl-map","mapboxgl-map");const a=this._canvasContainer=q.create("div","maplibregl-canvas-container mapboxgl-canvas-container",C);this._interactive&&a.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const m=this._containerDimensions();this._resizeCanvas(m[0],m[1],this.getPixelRatio());const T=this._controlContainer=q.create("div","maplibregl-control-container mapboxgl-control-container",C),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(L=>{A[L]=q.create("div",`maplibregl-ctrl-${L} mapboxgl-ctrl-${L}`,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const C=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=q.create("div","maplibregl-cooperative-gesture-screen",C);let a="Control",m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",a="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${m}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",T=>{T.key===a&&(this._metaPress=!0)}),document.addEventListener("keyup",T=>{T.key===a&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",T=>{this._onCooperativeGesture(T,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(C,a,m){this._canvas.width=m*C,this._canvas.height=m*a,this._canvas.style.width=`${C}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const C=i.extend({},F.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",C)||this._canvas.getContext("experimental-webgl",C);a?(this.painter=new mh(a,this.transform),i.exported$1.testSupport(a)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(C){C.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:C}))}_contextRestored(C){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:C}))}_onMapScroll(C){if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(C,a,m){return!a&&m<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){let a,m=0;const T=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(a=T.createQueryEXT(),T.beginQueryEXT(T.TIME_ELAPSED_EXT,a),m=i.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,H=i.exported.now();this.style.zoomHistory.update(N,H);const Q=new i.EvaluationParameters(N,{now:H,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=Q.crossFadingFactor();se===1&&se===this._crossFadingFactor||(A=!0,this._crossFadingFactor=se),this.style.update(Q)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,i.PerformanceUtils.mark(i.PerformanceMarkers.load),this.fire(new i.Event("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const N=i.exported.now()-m;T.endQueryEXT(T.TIME_ELAPSED_EXT,a),setTimeout(()=>{const H=T.getQueryObjectEXT(a,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(a),this.fire(new i.Event("gpu-timing-frame",{cpuTime:N,gpuTime:H}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(N);this.fire(new i.Event("gpu-timing-layer",{layerTimes:H}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new i.Event("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,i.PerformanceUtils.mark(i.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._cooperativeGestures&&q.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),i.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=i.exported.frame(C=>{i.PerformanceUtils.frame(C),this._frame=null,this._render(C)}))}_onWindowOnline(){this._update()}_onWindowResize(C){this._trackResize&&this.resize({originalEvent:C})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}_setCacheLimits(C,a){i.setCacheLimits(C,a)}get version(){return"2.4.0"}},NavigationControl:class{constructor(C){this.options=i.extend({},Xc,C),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const C=this._map.getZoom(),a=C===this._map.getMaxZoom(),m=C===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const C=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=C}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,a){const m=q.create("button",C,this._container);return m.type="button",m.addEventListener("click",a),m}_setButtonTitle(C,a){const m=this._map._getUIString(`NavigationControl.${a}`);C.title=m,C.setAttribute("aria-label",m)}},GeolocateControl:class extends i.Evented{constructor(C){super(),this.options=i.extend({},Qh,C),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(C){var a;return this._map=C,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),a=this._setupUI,fl!==void 0?a(fl):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(m=>{fl=m.state!=="denied",a(fl)}):(fl=!!window.navigator.geolocation,a(fl)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ao=0,Na=!1}_isOutOfMapMaxBounds(C){const a=this._map.getMaxBounds(),m=C.coords;return a&&(m.longitude<a.getWest()||m.longitude>a.getEast()||m.latitude<a.getSouth()||m.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(C){if(this._map){if(this._isOutOfMapMaxBounds(C))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",C)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=C,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(C),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(C),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",C)),this._finish()}}_updateCamera(C){const a=new i.LngLat(C.coords.longitude,C.coords.latitude),m=C.coords.accuracy,T=this._map.getBearing(),A=i.extend({bearing:T},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(m),A,{geolocateSource:!0})}_updateMarker(C){if(C){const a=new i.LngLat(C.coords.longitude,C.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=C.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const C=this._map._container.clientHeight/2,a=this._map.unproject([0,C]),m=this._map.unproject([1,C]),T=a.distanceTo(m),A=Math.ceil(2*this._accuracy/T);this._circleElement.style.width=`${A}px`,this._circleElement.style.height=`${A}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(C){if(this._map){if(this.options.trackUserLocation)if(C.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(C.code===3&&Na)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",C)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(C){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",C===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Hc(this._dotElement),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ao--,Na=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ao++,Ao>1?(C={maximumAge:6e5,timeout:0},Na=!0):(C=this.options.positionOptions,Na=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wc,LogoControl:Nu,ScaleControl:class{constructor(C){this.options=i.extend({},qs,C),i.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ed(this._map,this._container,this.options)}onAdd(C){return this._map=C,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(C){this.options.unit=C,ed(this._map,this._container,this.options)}},FullscreenControl:class{constructor(C){this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const C=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(C){this.options=C,i.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(C){return this._map=C,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends i.Evented{constructor(C){super(),this.options=i.extend(Object.create(to),C),i.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=i.LngLat.convert(C),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){const a=document.createDocumentFragment(),m=document.createElement("body");let T;for(m.innerHTML=C;T=m.firstChild,T;)a.appendChild(T);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){this._container&&this._container.classList.add(C)}removeClassName(C){this._container&&this._container.classList.remove(C)}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(C){this._update(C.point)}_onMouseMove(C){this._update(C.point)}_onDrag(C){this._update(C.point)}_update(C){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=q.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(L=>this._container.classList.add(L)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=os(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!C))return;const a=this._pos=this._trackPointer&&C?C:this._map.project(this._lngLat);let m=this.options.anchor;const T=$u(this.options.offset);if(!m){const L=this._container.offsetWidth,N=this._container.offsetHeight;let H;H=a.y+T.bottom.y<N?["top"]:a.y>this._map.transform.height-N?["bottom"]:[],a.x<L/2?H.push("left"):a.x>this._map.transform.width-L/2&&H.push("right"),m=H.length===0?"bottom":H.join("-")}const A=a.add(T[m]).round();q.setTransform(this._container,`${an[m]} translate(${A.x}px,${A.y}px)`),yn(this._container,m,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(zo);C&&C.focus()}_onClose(){this.remove()}},Marker:Hc,Style:$r,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.pointGeometry,MercatorCoordinate:i.MercatorCoordinate,Evented:i.Evented,AJAXError:i.AJAXError,config:i.config,CanvasSource:un,GeoJSONSource:Yt,ImageSource:cn,RasterDEMTileSource:zt,RasterTileSource:Nt,VectorTileSource:ti,VideoSource:di,prewarm:function(){gi().acquire(at)},clearPrewarmedResources:function(){const C=fi;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(at),fi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return bt.workerCount},set workerCount(C){bt.workerCount=C},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(C){i.config.MAX_PARALLEL_IMAGE_REQUESTS=C},clearStorage(C){i.clearTileCache(C)},workerUrl:"",addProtocol(C,a){i.config.REGISTERED_PROTOCOLS[C]=a},removeProtocol(C){delete i.config.REGISTERED_PROTOCOLS[C]}};return vo.extend(pl,{isSafari:i.isSafari,getPerformanceMetrics:i.PerformanceUtils.getPerformanceMetrics}),pl});var P=b;return P})})(VC);const cx=VC.exports;var UC={exports:{}};(function(e,l){(function(d,g){e.exports=g()})(fu,function(){var d,g,b;function E(i,F){if(!d)d=F;else if(!g)g=F;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",K={};d(K),b=F(K),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}E(["exports"],function(i){var F=typeof self<"u"?self:{},j="2.12.0";let K;const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(K==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):n}catch{K=n}}return K},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},q={supported:!1,testSupport:function(n){!we&&me&&(je?$e(n):re=n)}};let re,me,we=!1,je=!1;function $e(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,me),n.isContextLost())return;q.supported=!0}catch{}n.deleteTexture(t),we=!0}F.document&&(me=F.document.createElement("img"),me.onload=function(){re&&$e(re),re=null,je=!0},me.onerror=function(){we=!0,re=null},me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const tt="01";var Ae=mt;function mt(n,t,r,u){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=u}mt.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,u=0;u<8;u++){var p=this.sampleCurveX(r)-n;if(Math.abs(p)<t)return r;var y=this.sampleCurveDerivativeX(r);if(Math.abs(y)<1e-6)break;r-=p/y}var w=0,M=1;for(r=n,u=0;u<20&&(p=this.sampleCurveX(r),!(Math.abs(p-n)<t));u++)n>p?w=r:M=r,r=.5*(M-w)+w;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Me=Ye;function Ye(n,t){this.x=n,this.y=t}Ye.prototype={clone:function(){return new Ye(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),u=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=u,this},_rotateAround:function(n,t){var r=Math.cos(n),u=Math.sin(n),p=t.y+u*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-u*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ye.convert=function(n){return n instanceof Ye?n:Array.isArray(n)?new Ye(n[0],n[1]):n};const Ze=Math.PI/180,rt=180/Math.PI;function gt(n){return n*Ze}function vt(n){return n*rt}const Ut=[[0,0],[1,0],[1,1],[0,1]];function At(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function ti(n,t,r,u){const p=new Ae(n,t,r,u);return function(y){return p.solve(y)}}const Nt=ti(.25,.1,.25,1);function Wt(n,t,r){return Math.min(r,Math.max(t,n))}function zt(n,t,r){return(r=Wt((r-n)/(t-n),0,1))*r*(3-2*r)}function Yt(n,t,r){const u=r-t,p=((n-t)%u+u)%u+t;return p===t?r:p}function vi(n,t,r){if(!n.length)return r(null,[]);let u=n.length;const p=new Array(n.length);let y=null;n.forEach((w,M)=>{t(w,(D,R)=>{D&&(y=D),p[M]=R,--u==0&&r(y,p)})})}function cn(n){const t=[];for(const r in n)t.push(n[r]);return t}function di(n,...t){for(const r of t)for(const u in r)n[u]=r[u];return n}let un=1;function mn(){return un++}function Er(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Li(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function En(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function wn(n,t){n.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function vr(n,t){return n.indexOf(t,n.length-t.length)!==-1}function Fo(n,t,r){const u={};for(const p in n)u[p]=t.call(r||this,n[p],p,n);return u}function Xr(n,t,r){const u={};for(const p in n)t.call(r||this,n[p],p,n)&&(u[p]=n[p]);return u}function uo(n){return Array.isArray(n)?n.map(uo):typeof n=="object"&&n?Fo(n,uo):n}const ks={};function at(n){ks[n]||(typeof console<"u"&&console.warn(n),ks[n]=!0)}function bt(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Ft(n){let t=0;for(let r,u,p=0,y=n.length,w=y-1;p<y;w=p++)r=n[p],u=n[w],t+=(u.x-r.x)*(r.y+u.y);return t}function fi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gi(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,u,p,y)=>{const w=p||y;return t[u]=!w||w.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let Mi=null;function Ki(n){if(Mi==null){const t=n.navigator?n.navigator.userAgent:null;Mi=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Mi}function ci(n){try{const t=F[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Pi(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}const Si="mapbox-tiles";let tn,on,hn=500,Tn=50;function On(){try{return F.caches}catch{}}function qn(){On()&&!tn&&(tn=F.caches.open(Si))}function Ot(n){const t=n.indexOf("?");if(t<0)return n;const r=function(p){const y=p.indexOf("?");return y>0?p.slice(y+1).split("&"):[]}(n),u=r.filter(p=>{const y=p.split("=");return y[0]==="language"||y[0]==="worldview"});return u.length?`${n.slice(0,t)}?${u.join("&")}`:n.slice(0,t)}let yi=1/0;const Pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Pr);class Eo extends Error{constructor(t,r,u){r===401&&kn(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const jn=fi()?()=>self.worker&&self.worker.referrer:()=>(F.location.protocol==="blob:"?F.parent:F).location.href,ro=function(n,t){if(!(/^file:/.test(r=n.url)||/^file:/.test(jn())&&!/^\w+:/.test(r))){if(F.fetch&&F.Request&&F.AbortController&&F.Request.prototype.hasOwnProperty("signal"))return function(u,p){const y=new F.AbortController,w=new F.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:jn(),signal:y.signal});let M=!1,D=!1;const R=($=w.url).indexOf("sku=")>0&&kn($);var $;u.type==="json"&&w.headers.set("Accept","application/json");const W=(oe,ue,ye)=>{if(D)return;if(oe&&oe.message!=="SecurityError"&&at(oe),ue&&ye)return J(ue);const ke=Date.now();F.fetch(w).then(Ke=>{if(Ke.ok){const ct=R?Ke.clone():null;return J(Ke,ct,ke)}return p(new Eo(Ke.statusText,Ke.status,u.url))}).catch(Ke=>{Ke.code!==20&&p(new Error(Ke.message))})},J=(oe,ue,ye)=>{(u.type==="arrayBuffer"?oe.arrayBuffer():u.type==="json"?oe.json():oe.text()).then(ke=>{D||(ue&&ye&&function(Ke,ct,Xe){if(qn(),!tn)return;const nt={status:ct.status,statusText:ct.statusText,headers:new F.Headers};ct.headers.forEach((Vt,Lt)=>nt.headers.set(Lt,Vt));const pt=gi(ct.headers.get("Cache-Control")||"");if(pt["no-store"])return;pt["max-age"]&&nt.headers.set("Expires",new Date(Xe+1e3*pt["max-age"]).toUTCString());const ht=nt.headers.get("Expires");ht&&(new Date(ht).getTime()-Xe<42e4||function(Vt,Lt){if(on===void 0)try{new Response(new ReadableStream),on=!0}catch{on=!1}on?Lt(Vt.body):Vt.blob().then(Lt)}(ct,Vt=>{const Lt=new F.Response(Vt,nt);qn(),tn&&tn.then(ni=>ni.put(Ot(Ke.url),Lt)).catch(ni=>at(ni.message))}))}(w,ue,ye),M=!0,p(null,ke,oe.headers.get("Cache-Control"),oe.headers.get("Expires")))}).catch(ke=>{D||p(new Error(ke.message))})};return R?function(oe,ue){if(qn(),!tn)return ue(null);const ye=Ot(oe.url);tn.then(ke=>{ke.match(ye).then(Ke=>{const ct=function(Xe){if(!Xe)return!1;const nt=new Date(Xe.headers.get("Expires")||0),pt=gi(Xe.headers.get("Cache-Control")||"");return nt>Date.now()&&!pt["no-cache"]}(Ke);ke.delete(ye),ct&&ke.put(ye,Ke.clone()),ue(null,Ke,ct)}).catch(ue)}).catch(ue)}(w,W):W(null,null),{cancel:()=>{D=!0,M||y.abort()}}}(n,t);if(fi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var r;return function(u,p){const y=new F.XMLHttpRequest;y.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const w in u.headers)y.setRequestHeader(w,u.headers[w]);return u.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=u.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let w=y.response;if(u.type==="json")try{w=JSON.parse(y.response)}catch(M){return p(M)}p(null,w,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else p(new Eo(y.statusText,y.status,u.url))},y.send(u.body),{cancel:()=>y.abort()}}(n,t)},_o=function(n,t){return ro(di(n,{type:"arrayBuffer"}),t)};function zr(n){const t=F.document.createElement("a");return t.href=n,t.protocol===F.document.location.protocol&&t.host===F.document.location.host}const So="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let zi,Ln;zi=[],Ln=0;const Dn=function(n,t){if(q.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Ln>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return zi.push(y),y}Ln++;let r=!1;const u=()=>{if(!r)for(r=!0,Ln--;zi.length&&Ln<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const y=zi.shift(),{requestParameters:w,callback:M,cancelled:D}=y;D||(y.cancel=Dn(w,M).cancel)}},p=_o(n,(y,w,M,D)=>{u(),y?t(y):w&&(F.createImageBitmap?function(R,$){const W=new F.Blob([new Uint8Array(R)],{type:"image/png"});F.createImageBitmap(W).then(J=>{$(null,J)}).catch(J=>{$(new Error(`Could not load image because of ${J.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,(R,$)=>t(R,$,M,D)):function(R,$){const W=new F.Image,J=F.URL;W.onload=()=>{$(null,W),J.revokeObjectURL(W.src),W.onload=null,F.requestAnimationFrame(()=>{W.src=So})},W.onerror=()=>$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const oe=new F.Blob([new Uint8Array(R)],{type:"image/png"});W.src=R.byteLength?J.createObjectURL(oe):So}(w,(R,$)=>t(R,$,M,D)))});return{cancel:()=>{p.cancel(),u()}}},Co="NO_ACCESS_TOKEN";function is(n){return n.indexOf("mapbox:")===0}function kn(n){return Y.API_URL_REGEX.test(n)}function sa(n){return Y.API_CDN_URL_REGEX.test(n)}function yo(n){return Y.API_STYLE_REGEX.test(n)&&!aa(n)}function aa(n){return Y.API_SPRITE_REGEX.test(n)}const oo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function so(n){const t=n.match(oo);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function pr(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}function La(n){if(!n)return null;const t=n.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(F.atob(t[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ve{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=La(Y.ACCESS_TOKEN);let u="";return u=r&&r.u?F.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(p,y)=>String.fromCharCode(Number("0x"+y)))):Y.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const t=ci("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=F.localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));const y=F.localStorage.getItem(u);y&&(this.anonId=y)}catch{at("Unable to read from LocalStorage")}}saveEventData(){const t=ci("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{F.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&F.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{at("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,u,p){if(!Y.EVENTS_URL)return;const y=so(Y.EVENTS_URL);y.params.push(`access_token=${p||Y.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},M=r?di(w,r):w,D={url:pr(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=function(R,$){return ro(di(R,{method:"POST"}),$)}(D,R=>{this.pendingRequest=null,u(R),this.saveEventData(),this.processRequests(p)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const fe=new class extends Ve{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){Y.EVENTS_URL&&Y.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>is(r)||kn(r))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=La(Y.ACCESS_TOKEN),r=t?t.u:Y.ACCESS_TOKEN;let u=r!==this.eventData.tokenU;En(this.anonId)||(this.anonId=Er(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),w=new Date(p),M=(p-this.eventData.lastSuccess)/864e5;u=u||M>=1||M<-1||y.getDate()!==w.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:tt,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)},n):this.processRequests()}},ve=fe.postTurnstileEvent.bind(fe),Oe=new class extends Ve{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,r,u){this.skuToken=t,this.errorCb=u,Y.EVENTS_URL&&(r||Y.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Co)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),En(this.anonId)||(this.anonId=Er()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:tt,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},n))}},Je=Oe.postMapLoadEvent.bind(Oe),le=new class extends Ve{constructor(){super("gljs.performance")}postPerformanceEvent(n,t){Y.EVENTS_URL&&(n||Y.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),u=function(p){const y=F.performance.getEntriesByType("resource"),w=F.performance.getEntriesByType("mark"),M=function(J){const oe={};if(J){for(const ue in J)if(ue!=="other")for(const ye of J[ue]){const ke=`${ue}ResolveRangeMin`,Ke=`${ue}ResolveRangeMax`,ct=`${ue}RequestCount`,Xe=`${ue}RequestCachedCount`;oe[ke]=Math.min(oe[ke]||1/0,ye.startTime),oe[Ke]=Math.max(oe[Ke]||-1/0,ye.responseEnd);const nt=pt=>{oe[pt]===void 0&&(oe[pt]=0),++oe[pt]};ye.transferSize!==void 0&&ye.transferSize===0&&nt(Xe),nt(ct)}}return oe}(function(J,oe){const ue={};if(J)for(const ye of J){const ke=oe(ye);ue[ke]===void 0&&(ue[ke]=[]),ue[ke].push(ye)}return ue}(y,De)),D=F.devicePixelRatio,R=F.navigator.connection||F.navigator.mozConnection||F.navigator.webkitConnection,$={counters:[],metadata:[],attributes:[]},W=(J,oe,ue)=>{ue!=null&&J.push({name:oe,value:ue.toString()})};for(const J in M)W($.counters,J,M[J]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(W($.counters,"interactionRangeMin",p.interactionRange[0]),W($.counters,"interactionRangeMax",p.interactionRange[1])),w)for(const J of Object.keys(Se)){const oe=Se[J],ue=w.find(ye=>ye.name===oe);ue&&W($.counters,oe,ue.startTime)}return W($.counters,"visibilityHidden",p.visibilityHidden),W($.attributes,"style",function(J){if(J)for(const oe of J){const ue=oe.name.split("?")[0];if(yo(ue)){const ye=ue.split("/").slice(-2);if(ye.length===2)return`mapbox://styles/${ye[0]}/${ye[1]}`}}}(y)),W($.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),W($.attributes,"fogEnabled",p.fogEnabled?"true":"false"),W($.attributes,"projection",p.projection),W($.attributes,"zoom",p.zoom),W($.metadata,"devicePixelRatio",D),W($.metadata,"connectionEffectiveType",R?R.effectiveType:void 0),W($.metadata,"navigatorUserAgent",F.navigator.userAgent),W($.metadata,"screenWidth",F.screen.width),W($.metadata,"screenHeight",F.screen.height),W($.metadata,"windowWidth",F.innerWidth),W($.metadata,"windowHeight",F.innerHeight),W($.metadata,"mapWidth",p.width/D),W($.metadata,"mapHeight",p.height/D),W($.metadata,"webglRenderer",p.renderer),W($.metadata,"webglVendor",p.vendor),W($.metadata,"sdkVersion",j),W($.metadata,"sdkIdentifier","mapbox-gl-js"),$}(r);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},n)}},X=le.postPerformanceEvent.bind(le),ee=new class extends Ve{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,r,u){if(!Y.API_URL||!Y.SESSION_PATH)return;const p=so(Y.API_URL+Y.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||Y.ACCESS_TOKEN||""}`);const y={url:pr(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(w,M){return ro(di(w,{method:"GET"}),M)}(y,w=>{this.pendingRequest=null,r(w),this.saveEventData(),this.processRequests(u)})}getSessionAPI(n,t,r,u){this.skuToken=t,this.errorCb=u,Y.SESSION_PATH&&Y.API_URL&&(r||Y.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Co)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},n)}},ae=ee.getSessionAPI.bind(ee),he=new Set,Se={create:"create",load:"load",fullLoad:"fullLoad"},qe={mark(n){F.performance.mark(n)},measure(n,t,r){F.performance.measure(n,t,r)}};function De(n){const t=n.name.split("?")[0];return sa(t)&&t.includes("mapbox-gl.js")?"javascript":sa(t)&&t.includes("mapbox-gl.css")?"css":function(r){return Y.API_FONTS_REGEX.test(r)}(t)?"fontRange":aa(t)?"sprite":yo(t)?"style":function(r){return Y.API_TILEJSON_REGEX.test(r)}(t)?"tilejson":"other"}const Ue=F.performance;function it(n){const t=n?n.url.toString():void 0;return Ue.getEntriesByName(t)}let xt,Bt,It,Ci;const ri={now:()=>It!==void 0?It:F.performance.now(),setNow(n){It=n},restoreNow(){It=void 0},frame(n){const t=F.requestAnimationFrame(n);return{cancel:()=>F.cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:r,height:u}=n;Ci||(Ci=F.document.createElement("canvas"));const p=Ci.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(r>Ci.width||u>Ci.height)&&(Ci.width=r,Ci.height=u),p.clearRect(-t,-t,r+2*t,u+2*t),p.drawImage(n,0,0,r,u),p.getImageData(-t,-t,r+2*t,u+2*t)},resolveURL:n=>(xt||(xt=F.document.createElement("a")),xt.href=n,xt.href),get devicePixelRatio(){return F.devicePixelRatio},get prefersReducedMotion(){return!!F.matchMedia&&(Bt==null&&(Bt=F.matchMedia("(prefers-reduced-motion: reduce)")),Bt.matches)}};function xi(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Gi(n,t,r){if(r&&r[n]){const u=r[n].indexOf(t);u!==-1&&r[n].splice(u,1)}}class _n{constructor(t,r={}){di(this,r),this.type=t}}class Zn extends _n{constructor(t,r={}){super("error",di({error:t},r))}}class xn{on(t,r){return this._listeners=this._listeners||{},xi(t,r,this._listeners),this}off(t,r){return Gi(t,r,this._listeners),Gi(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},xi(t,r,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,r){typeof t=="string"&&(t=new _n(t,r||{}));const u=t.type;if(this.listens(u)){t.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const M of p)M.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const M of y)Gi(u,M,this._oneTimeListeners),M.call(this,t);const w=this._eventedParent;w&&(di(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(t))}else t instanceof Zn&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Mt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Gn(n,...t){for(const r of t)for(const u in r)n[u]=r[u];return n}function Fn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Qr(n){if(Array.isArray(n))return n.map(Qr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Qr(n[r]);return t}return Fn(n)}class ao extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}var $r=ao;class el{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[u,p]of r)this.bindings[u]=p}concat(t){return new el(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Sc=el;const Wn={kind:"null"},Fi={kind:"number"},Jn={kind:"string"},Xn={kind:"boolean"},la={kind:"color"},tl={kind:"object"},Hn={kind:"value"},Tl={kind:"collator"},El={kind:"formatted"},il={kind:"resolvedImage"};function ns(n,t){return{kind:"array",itemType:n,N:t}}function eo(n){if(n.kind==="array"){const t=eo(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const ms=[Wn,Fi,Jn,Xn,la,El,tl,ns(Hn),il];function nl(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!nl(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of ms)if(!nl(r,t))return null}}return`Expected ${eo(n)} but found ${eo(t)} instead.`}function Ba(n,t){return t.some(r=>r.kind===n.kind)}function Sl(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}var Cl,Il={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ra(n){return(n=Math.round(n))<0?0:n>255?255:n}function Al(n){return Ra(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function Ml(n){return(t=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:t>1?1:t;var t}function Hr(n,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(t-n)*r*6:2*r<1?t:3*r<2?n+(t-n)*(2/3-r)*6:n}try{Cl={}.parseCSSColor=function(n){var t,r=n.replace(/ /g,"").toLowerCase();if(r in Il)return Il[r].slice();if(r[0]==="#")return r.length===4?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:r.length===7&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var u=r.indexOf("("),p=r.indexOf(")");if(u!==-1&&p+1===r.length){var y=r.substr(0,u),w=r.substr(u+1,p-(u+1)).split(","),M=1;switch(y){case"rgba":if(w.length!==4)return null;M=Ml(w.pop());case"rgb":return w.length!==3?null:[Al(w[0]),Al(w[1]),Al(w[2]),M];case"hsla":if(w.length!==4)return null;M=Ml(w.pop());case"hsl":if(w.length!==3)return null;var D=(parseFloat(w[0])%360+360)%360/360,R=Ml(w[1]),$=Ml(w[2]),W=$<=.5?$*(R+1):$+R-$*R,J=2*$-W;return[Ra(255*Hr(J,W,D+1/3)),Ra(255*Hr(J,W,D)),Ra(255*Hr(J,W,D-1/3)),M];default:return null}}return null}}catch{}class rs{constructor(t,r,u,p=1){this.r=t,this.g=r,this.b=u,this.a=p}static parse(t){if(!t)return;if(t instanceof rs)return t;if(typeof t!="string")return;const r=Cl(t);return r?new rs(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,u,p]=this.toArray();return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(u)},${p})`}toArray(){const{r:t,g:r,b:u,a:p}=this;return p===0?[0,0,0,0]:[255*t/p,255*r/p,255*u/p,p]}toArray01(){const{r:t,g:r,b:u,a:p}=this;return p===0?[0,0,0,0]:[t/p,r/p,u/p,p]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:u,a:p}=this;return[t,r,u,p]}}rs.black=new rs(0,0,0,1),rs.white=new rs(1,1,1,1),rs.transparent=new rs(0,0,0,0),rs.red=new rs(1,0,0,1),rs.blue=new rs(0,0,1,1);var ho=rs;class Cc{constructor(t,r,u){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class bu{constructor(t,r,u,p,y){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=u,this.fontStack=p,this.textColor=y}}class Vo{constructor(t){this.sections=t}static fromString(t){return new Vo([new bu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Vo?t:Vo.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.name]);continue}t.push(r.text);const u={};r.fontStack&&(u["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(u["font-scale"]=r.scale),r.textColor&&(u["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(u)}return t}}class Us{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Us({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Rd(n,t,r,u){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[n,t,r,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[n,t,r,u]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lh(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ho||n instanceof Cc||n instanceof Vo||n instanceof Us)return!0;if(Array.isArray(n)){for(const t of n)if(!lh(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!lh(n[t]))return!1;return!0}return!1}function Io(n){if(n===null)return Wn;if(typeof n=="string")return Jn;if(typeof n=="boolean")return Xn;if(typeof n=="number")return Fi;if(n instanceof ho)return la;if(n instanceof Cc)return Tl;if(n instanceof Vo)return El;if(n instanceof Us)return il;if(Array.isArray(n)){const t=n.length;let r;for(const u of n){const p=Io(u);if(r){if(r===p)continue;r=Hn;break}r=p}return ns(r||Hn,t)}return tl}function Kl(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof ho||n instanceof Vo||n instanceof Us?n.toString():JSON.stringify(n)}class wu{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!lh(t[1]))return r.error("invalid value");const u=t[1];let p=Io(u);const y=r.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new wu(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ho?["rgba"].concat(this.value.toArray()):this.value instanceof Vo?this.value.serialize():this.value}}var Yl=wu,Bn=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Jl={string:Jn,number:Fi,boolean:Xn,object:tl};class Vh{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u,p=1;const y=t[0];if(y==="array"){let M,D;if(t.length>2){const R=t[1];if(typeof R!="string"||!(R in Jl)||R==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);M=Jl[R],p++}else M=Hn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);D=t[2],p++}u=ns(M,D)}else u=Jl[y];const w=[];for(;p<t.length;p++){const M=r.parse(t[p],p,Hn);if(!M)return null;w.push(M)}return new Vh(u,w)}evaluate(t){for(let r=0;r<this.args.length;r++){const u=this.args[r].evaluate(t);if(!nl(this.type,Io(u)))return u;if(r===this.args.length-1)throw new Bn(`Expected value to be of type ${eo(this.type)}, but found ${eo(Io(u))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if(t.kind==="array"){const u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){r.push(u.kind);const p=t.N;(typeof p=="number"||this.args.length>1)&&r.push(p)}}return r.concat(this.args.map(u=>u.serialize()))}}var $s=Vh;class rl{constructor(t){this.type=El,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return r.error("First argument must be an image or text section.");const p=[];let y=!1;for(let w=1;w<=t.length-1;++w){const M=t[w];if(y&&typeof M=="object"&&!Array.isArray(M)){y=!1;let D=null;if(M["font-scale"]&&(D=r.parse(M["font-scale"],1,Fi),!D))return null;let R=null;if(M["text-font"]&&(R=r.parse(M["text-font"],1,ns(Jn)),!R))return null;let $=null;if(M["text-color"]&&($=r.parse(M["text-color"],1,la),!$))return null;const W=p[p.length-1];W.scale=D,W.font=R,W.textColor=$}else{const D=r.parse(t[w],1,Hn);if(!D)return null;const R=D.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:D,scale:null,font:null,textColor:null})}}return new rl(p)}evaluate(t){return new Vo(this.sections.map(r=>{const u=r.content.evaluate(t);return Io(u)===il?new bu("",u,null,null,null):new bu(Kl(u),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const u={};r.scale&&(u["font-scale"]=r.scale.serialize()),r.font&&(u["text-font"]=r.font.serialize()),r.textColor&&(u["text-color"]=r.textColor.serialize()),t.push(u)}return t}}class Tu{constructor(t){this.type=il,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const u=r.parse(t[1],1,Jn);return u?new Tu(u):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),u=Us.fromString(r);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(r)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const js={"to-boolean":Xn,"to-color":la,"to-number":Fi,"to-string":Jn};class Eu{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return r.error("Expected one argument.");const p=js[u],y=[];for(let w=1;w<t.length;w++){const M=r.parse(t[w],w,Hn);if(!M)return null;y.push(M)}return new Eu(p,y)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let r,u;for(const p of this.args){if(r=p.evaluate(t),u=null,r instanceof ho)return r;if(typeof r=="string"){const y=t.parseColor(r);if(y)return y}else if(Array.isArray(r)&&(u=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Rd(r[0],r[1],r[2],r[3]),!u))return new ho(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Bn(u||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const u of this.args){if(r=u.evaluate(t),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new Bn(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Vo.fromString(Kl(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Us.fromString(Kl(this.args[0].evaluate(t))):Kl(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new rl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Tu(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}var Oa=Eu;const Ql=["Unknown","Point","LineString","Polygon"];var ch=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ql[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-n[0])+this.featureDistanceData.bearing[1]*(u*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=ho.parse(n)),t}};class kl{constructor(t,r,u,p){this.name=t,this.type=r,this._evaluate=u,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const u=t[0],p=kl.definitions[u];if(!p)return r.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,w=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,M=w.filter(([R])=>!Array.isArray(R)||R.length===t.length-1);let D=null;for(const[R,$]of M){D=new Un(r.registry,r.path,null,r.scope);const W=[];let J=!1;for(let oe=1;oe<t.length;oe++){const ue=t[oe],ye=Array.isArray(R)?R[oe-1]:R.type,ke=D.parse(ue,1+W.length,ye);if(!ke){J=!0;break}W.push(ke)}if(!J)if(Array.isArray(R)&&R.length!==W.length)D.error(`Expected ${R.length} arguments, but found ${W.length} instead.`);else{for(let oe=0;oe<W.length;oe++){const ue=Array.isArray(R)?R[oe]:R.type,ye=W[oe];D.concat(oe+1).checkSubtype(ue,ye.type)}if(D.errors.length===0)return new kl(u,y,$,W)}}if(M.length===1)r.errors.push(...D.errors);else{const R=(M.length?M:w).map(([W])=>{return J=W,Array.isArray(J)?`(${J.map(eo).join(", ")})`:`(${eo(J.type)}...)`;var J}).join(" | "),$=[];for(let W=1;W<t.length;W++){const J=r.parse(t[W],1+$.length);if(!J)return null;$.push(eo(J.type))}r.error(`Expected arguments of type ${R}, but found (${$.join(", ")}) instead.`)}return null}static register(t,r){kl.definitions=r;for(const u in r)t[u]=kl}}var ya=kl;class Ic{constructor(t,r,u){this.type=Tl,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return r.error("Collator options argument must be an object.");const p=r.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Xn);if(!p)return null;const y=r.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Xn);if(!y)return null;let w=null;return u.locale&&(w=r.parse(u.locale,1,Jn),!w)?null:new Ic(p,y,w)}evaluate(t){return new Cc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Zo=8192;function ec(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Ac(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Nh(n,t){const r=(180+n[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(r*p*Zo),Math.round(u*p*Zo)]}function tc(n,t,r){const u=n[0]-t[0],p=n[1]-t[1],y=n[0]-r[0],w=n[1]-r[1];return u*w-y*p==0&&u*y<=0&&p*w<=0}function uh(n,t){let r=!1;for(let w=0,M=t.length;w<M;w++){const D=t[w];for(let R=0,$=D.length;R<$-1;R++){if(tc(n,D[R],D[R+1]))return!1;(p=D[R])[1]>(u=n)[1]!=(y=D[R+1])[1]>u[1]&&u[0]<(y[0]-p[0])*(u[1]-p[1])/(y[1]-p[1])+p[0]&&(r=!r)}}var u,p,y;return r}function Od(n,t){for(let r=0;r<t.length;r++)if(uh(n,t[r]))return!0;return!1}function hh(n,t,r,u){const p=u[0]-r[0],y=u[1]-r[1],w=(n[0]-r[0])*y-p*(n[1]-r[1]),M=(t[0]-r[0])*y-p*(t[1]-r[1]);return w>0&&M<0||w<0&&M>0}function Su(n,t,r){for(const R of r)for(let $=0;$<R.length-1;++$)if((M=[(w=R[$+1])[0]-(y=R[$])[0],w[1]-y[1]])[0]*(D=[(p=t)[0]-(u=n)[0],p[1]-u[1]])[1]-M[1]*D[0]!=0&&hh(u,p,y,w)&&hh(y,w,u,p))return!0;var u,p,y,w,M,D;return!1}function Uh(n,t){for(let r=0;r<n.length;++r)if(!uh(n[r],t))return!1;for(let r=0;r<n.length-1;++r)if(Su(n[r],n[r+1],t))return!1;return!0}function Fd(n,t){for(let r=0;r<t.length;r++)if(Uh(n,t[r]))return!0;return!1}function ic(n,t,r){const u=[];for(let p=0;p<n.length;p++){const y=[];for(let w=0;w<n[p].length;w++){const M=Nh(n[p][w],r);ec(t,M),y.push(M)}u.push(y)}return u}function Mc(n,t,r){const u=[];for(let p=0;p<n.length;p++){const y=ic(n[p],t,r);u.push(y)}return u}function ol(n,t,r,u){if(n[0]<r[0]||n[0]>r[2]){const p=.5*u;let y=n[0]-r[0]>p?-u:r[0]-n[0]>p?u:0;y===0&&(y=n[0]-r[2]>p?-u:r[2]-n[0]>p?u:0),n[0]+=y}ec(t,n)}function gr(n,t,r,u){const p=Math.pow(2,u.z)*Zo,y=[u.x*Zo,u.y*Zo],w=[];if(!n)return w;for(const M of n)for(const D of M){const R=[D.x+y[0],D.y+y[1]];ol(R,t,r,p),w.push(R)}return w}function nc(n,t,r,u){const p=Math.pow(2,u.z)*Zo,y=[u.x*Zo,u.y*Zo],w=[];if(!n)return w;for(const D of n){const R=[];for(const $ of D){const W=[$.x+y[0],$.y+y[1]];ec(t,W),R.push(W)}w.push(R)}if(t[2]-t[0]<=p/2){(M=t)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const D of w)for(const R of D)ol(R,t,r,p)}var M;return w}class kc{constructor(t,r){this.type=Xn,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(lh(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let p=0;p<u.features.length;++p){const y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new kc(u,u.features[p].geometry)}else if(u.type==="Feature"){const p=u.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new kc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new kc(u,u)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=r.canonicalID();if(!w)return!1;if(u.type==="Polygon"){const M=ic(u.coordinates,y,w),D=gr(r.geometry(),p,y,w);if(!Ac(p,y))return!1;for(const R of D)if(!uh(R,M))return!1}if(u.type==="MultiPolygon"){const M=Mc(u.coordinates,y,w),D=gr(r.geometry(),p,y,w);if(!Ac(p,y))return!1;for(const R of D)if(!Od(R,M))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=r.canonicalID();if(!w)return!1;if(u.type==="Polygon"){const M=ic(u.coordinates,y,w),D=nc(r.geometry(),p,y,w);if(!Ac(p,y))return!1;for(const R of D)if(!Uh(R,M))return!1}if(u.type==="MultiPolygon"){const M=Mc(u.coordinates,y,w),D=nc(r.geometry(),p,y,w);if(!Ac(p,y))return!1;for(const R of D)if(!Fd(R,M))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var dh=kc;function sl(n){if(n instanceof ya&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof dh)return!1;let t=!0;return n.eachChild(r=>{t&&!sl(r)&&(t=!1)}),t}function Fa(n){if(n instanceof ya&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!Fa(r)&&(t=!1)}),t}function Pc(n,t){if(n instanceof ya&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(u=>{r&&!Pc(u,t)&&(r=!1)}),r}class al{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const u=t[1];return r.scope.has(u)?new al(u,r.scope.get(u)):r.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var jr=al;class Cu{constructor(t,r=[],u,p=new Sc,y=[]){this.registry=t,this.path=r,this.key=r.map(w=>`[${w}]`).join(""),this.scope=p,this.errors=y,this.expectedType=u}parse(t,r,u,p,y={}){return r?this.concat(r,u,p)._parse(t,y):this._parse(t,y)}_parse(t,r){function u(p,y,w){return w==="assert"?new $s(y,[p]):w==="coerce"?new Oa(y,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let w=y.parse(t,this);if(!w)return null;if(this.expectedType){const M=this.expectedType,D=w.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||D.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string"){if(this.checkSubtype(M,D))return null}else w=u(w,M,r.typeAnnotation||"coerce");else w=u(w,M,r.typeAnnotation||"assert")}if(!(w instanceof Yl)&&w.type.kind!=="resolvedImage"&&cr(w)){const M=new ch;try{w=new Yl(w.type,w.evaluate(M))}catch(D){return this.error(D.message),null}}return w}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,u){const p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Cu(this.registry,p,r||null,y,this.errors)}error(t,...r){const u=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new $r(u,t))}checkSubtype(t,r){const u=nl(t,r);return u&&this.error(u),u}}var Un=Cu;function cr(n){if(n instanceof jr)return cr(n.boundExpression);if(n instanceof ya&&n.name==="error"||n instanceof Ic||n instanceof dh)return!1;const t=n instanceof Oa||n instanceof $s;let r=!0;return n.eachChild(u=>{r=t?r&&cr(u):r&&u instanceof Yl}),!!r&&sl(n)&&Pc(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Lr(n,t){const r=n.length-1;let u,p,y=0,w=r,M=0;for(;y<=w;)if(M=Math.floor((y+w)/2),u=n[M],p=n[M+1],u<=t){if(M===r||t<p)return M;y=M+1}else{if(!(u>t))throw new Bn("Input is not a number.");w=M-1}return 0}class Br{constructor(t,r,u){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[p,y]of u)this.labels.push(p),this.outputs.push(y)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const u=r.parse(t[1],1,Fi);if(!u)return null;const p=[];let y=null;r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let w=1;w<t.length;w+=2){const M=w===1?-1/0:t[w],D=t[w+1],R=w,$=w+1;if(typeof M!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=M)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const W=r.parse(D,$,y);if(!W)return null;y=y||W.type,p.push([M,W])}return new Br(y,u,p)}evaluate(t){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);const p=this.input.evaluate(t);if(p<=r[0])return u[0].evaluate(t);const y=r.length;return p>=r[y-1]?u[y-1].evaluate(t):u[Lr(r,p)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}var Pl=Br;function Qn(n,t,r){return n*(1-r)+t*r}var fh=Object.freeze({__proto__:null,number:Qn,color:function(n,t,r){return new ho(Qn(n.r,t.r,r),Qn(n.g,t.g,r),Qn(n.b,t.b,r),Qn(n.a,t.a,r))},array:function(n,t,r){return n.map((u,p)=>Qn(u,t[p],r))}});const $h=.95047,jh=1.08883,Gh=4/29,rc=6/29,zc=3*rc*rc,Dc=Math.PI/180,Iu=180/Math.PI;function Lc(n){return n>.008856451679035631?Math.pow(n,1/3):n/zc+Gh}function Au(n){return n>rc?n*n*n:zc*(n-Gh)}function Bc(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Rc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ca(n){const t=Rc(n.r),r=Rc(n.g),u=Rc(n.b),p=Lc((.4124564*t+.3575761*r+.1804375*u)/$h),y=Lc((.2126729*t+.7151522*r+.072175*u)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-Lc((.0193339*t+.119192*r+.9503041*u)/jh)),alpha:n.a}}function qh(n){let t=(n.l+16)/116,r=isNaN(n.a)?t:t+n.a/500,u=isNaN(n.b)?t:t-n.b/200;return t=1*Au(t),r=$h*Au(r),u=jh*Au(u),new ho(Bc(3.2404542*r-1.5371385*t-.4985314*u),Bc(-.969266*r+1.8760108*t+.041556*u),Bc(.0556434*r-.2040259*t+1.0572252*u),n.alpha)}function Zh(n,t,r){const u=t-n;return n+r*(u>180||u<-180?u-360*Math.round(u/360):u)}const Oc={forward:ca,reverse:qh,interpolate:function(n,t,r){return{l:Qn(n.l,t.l,r),a:Qn(n.a,t.a,r),b:Qn(n.b,t.b,r),alpha:Qn(n.alpha,t.alpha,r)}}},ua={forward:function(n){const{l:t,a:r,b:u}=ca(n),p=Math.atan2(u,r)*Iu;return{h:p<0?p+360:p,c:Math.sqrt(r*r+u*u),l:t,alpha:n.a}},reverse:function(n){const t=n.h*Dc,r=n.c;return qh({l:n.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:n.alpha})},interpolate:function(n,t,r){return{h:Zh(n.h,t.h,r),c:Qn(n.c,t.c,r),l:Qn(n.l,t.l,r),alpha:Qn(n.alpha,t.alpha,r)}}};var Fc=Object.freeze({__proto__:null,lab:Oc,hcl:ua});class ll{constructor(t,r,u,p,y){this.type=t,this.operator=r,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[w,M]of y)this.labels.push(w),this.outputs.push(M)}static interpolationFactor(t,r,u,p){let y=0;if(t.name==="exponential")y=Wh(r,t.base,u,p);else if(t.name==="linear")y=Wh(r,1,u,p);else if(t.name==="cubic-bezier"){const w=t.controlPoints;y=new Ae(w[0],w[1],w[2],w[3]).solve(Wh(r,1,u,p))}return y}static parse(t,r){let[u,p,y,...w]=t;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some($=>typeof $!="number"||$<0||$>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(y=r.parse(y,2,Fi),!y)return null;const M=[];let D=null;u==="interpolate-hcl"||u==="interpolate-lab"?D=la:r.expectedType&&r.expectedType.kind!=="value"&&(D=r.expectedType);for(let R=0;R<w.length;R+=2){const $=w[R],W=w[R+1],J=R+3,oe=R+4;if(typeof $!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(M.length&&M[M.length-1][0]>=$)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);const ue=r.parse(W,oe,D);if(!ue)return null;D=D||ue.type,M.push([$,ue])}return D.kind==="number"||D.kind==="color"||D.kind==="array"&&D.itemType.kind==="number"&&typeof D.N=="number"?new ll(D,u,p,y,M):r.error(`Type ${eo(D)} is not interpolatable.`)}evaluate(t){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);const p=this.input.evaluate(t);if(p<=r[0])return u[0].evaluate(t);const y=r.length;if(p>=r[y-1])return u[y-1].evaluate(t);const w=Lr(r,p),M=ll.interpolationFactor(this.interpolation,p,r[w],r[w+1]),D=u[w].evaluate(t),R=u[w+1].evaluate(t);return this.operator==="interpolate"?fh[this.type.kind.toLowerCase()](D,R,M):this.operator==="interpolate-hcl"?ua.reverse(ua.interpolate(ua.forward(D),ua.forward(R),M)):Oc.reverse(Oc.interpolate(Oc.forward(D),Oc.forward(R),M))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)r.push(this.labels[u],this.outputs[u].serialize());return r}}function Wh(n,t,r,u){const p=u-r,y=n-r;return p===0?0:t===1?y/p:(Math.pow(t,y)-1)/(Math.pow(t,p)-1)}var Gs=ll;class Mu{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let u=null;const p=r.expectedType;p&&p.kind!=="value"&&(u=p);const y=[];for(const M of t.slice(1)){const D=r.parse(M,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!D)return null;u=u||D.type,y.push(D)}const w=p&&y.some(M=>nl(p,M.type));return new Mu(w?Hn:u,y)}evaluate(t){let r,u=null,p=0;for(const y of this.args){if(p++,u=y.evaluate(t),u&&u instanceof Us&&!u.available&&(r||(r=u),u=null,p===this.args.length))return r;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var ph=Mu;class zl{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let y=1;y<t.length-1;y+=2){const w=t[y];if(typeof w!="string")return r.error(`Expected string, but found ${typeof w} instead.`,y);if(/[^a-zA-Z0-9_]/.test(w))return r.error("Variable names must contain only alphanumeric characters or '_'.",y);const M=r.parse(t[y+1],y+1);if(!M)return null;u.push([w,M])}const p=r.parse(t[t.length-1],t.length-1,r.expectedType,u);return p?new zl(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,u]of this.bindings)t.push(r,u.serialize());return t.push(this.result.serialize()),t}}var mh=zl;class Vc{constructor(t,r,u){this.type=t,this.index=r,this.input=u}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,Fi),p=r.parse(t[2],2,ns(r.expectedType||Hn));return u&&p?new Vc(p.type.itemType,u,p):null}evaluate(t){const r=this.index.evaluate(t),u=this.input.evaluate(t);if(r<0)throw new Bn(`Array index out of bounds: ${r} < 0.`);if(r>=u.length)throw new Bn(`Array index out of bounds: ${r} > ${u.length-1}.`);if(r!==Math.floor(r))throw new Bn(`Array index must be an integer, but found ${r} instead.`);return u[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Nc=Vc;class cl{constructor(t,r){this.type=Xn,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,Hn),p=r.parse(t[2],2,Hn);return u&&p?Ba(u.type,[Xn,Jn,Fi,Wn,Hn])?new cl(u,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${eo(u.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!Sl(r,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${eo(Io(r))} instead.`);if(!Sl(u,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${eo(Io(u))} instead.`);return u.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Uc=cl;class ku{constructor(t,r,u){this.type=Fi,this.needle=t,this.haystack=r,this.fromIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,Hn),p=r.parse(t[2],2,Hn);if(!u||!p)return null;if(!Ba(u.type,[Xn,Jn,Fi,Wn,Hn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${eo(u.type)} instead`);if(t.length===4){const y=r.parse(t[3],3,Fi);return y?new ku(u,p,y):null}return new ku(u,p)}evaluate(t){const r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Sl(r,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${eo(Io(r))} instead.`);if(!Sl(u,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${eo(Io(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return u.indexOf(r,p)}return u.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Pu=ku;class gh{constructor(t,r,u,p,y,w){this.inputType=t,this.type=r,this.input=u,this.cases=p,this.outputs=y,this.otherwise=w}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let u,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const y={},w=[];for(let R=2;R<t.length-1;R+=2){let $=t[R];const W=t[R+1];Array.isArray($)||($=[$]);const J=r.concat(R);if($.length===0)return J.error("Expected at least one branch label.");for(const ue of $){if(typeof ue!="number"&&typeof ue!="string")return J.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return J.error("Numeric branch labels must be integer values.");if(u){if(J.checkSubtype(u,Io(ue)))return null}else u=Io(ue);if(y[String(ue)]!==void 0)return J.error("Branch labels must be unique.");y[String(ue)]=w.length}const oe=r.parse(W,R,p);if(!oe)return null;p=p||oe.type,w.push(oe)}const M=r.parse(t[1],1,Hn);if(!M)return null;const D=r.parse(t[t.length-1],t.length-1,p);return D?M.type.kind!=="value"&&r.concat(1).checkSubtype(u,M.type)?null:new gh(u,p,M,y,w,D):null}evaluate(t){const r=this.input.evaluate(t);return(Io(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),u=[],p={};for(const w of r){const M=p[this.cases[w]];M===void 0?(p[this.cases[w]]=u.length,u.push([this.cases[w],[w]])):u[M][1].push(w)}const y=w=>this.inputType.kind==="number"?Number(w):w;for(const[w,M]of u)t.push(M.length===1?y(M[0]):M.map(y)),t.push(this.outputs[w].serialize());return t.push(this.otherwise.serialize()),t}}var Vd=gh;class oc{constructor(t,r,u){this.type=t,this.branches=r,this.otherwise=u}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const p=[];for(let w=1;w<t.length-1;w+=2){const M=r.parse(t[w],w,Xn);if(!M)return null;const D=r.parse(t[w+1],w+1,u);if(!D)return null;p.push([M,D]),u=u||D.type}const y=r.parse(t[t.length-1],t.length-1,u);return y?new oc(u,p,y):null}evaluate(t){for(const[r,u]of this.branches)if(r.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,u]of this.branches)t(r),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var sc=oc;class $c{constructor(t,r,u,p){this.type=t,this.input=r,this.beginIndex=u,this.endIndex=p}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,Hn),p=r.parse(t[2],2,Fi);if(!u||!p)return null;if(!Ba(u.type,[ns(Hn),Jn,Hn]))return r.error(`Expected first argument to be of type array or string, but found ${eo(u.type)} instead`);if(t.length===4){const y=r.parse(t[3],3,Fi);return y?new $c(u.type,u,p,y):null}return new $c(u.type,u,p)}evaluate(t){const r=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Sl(r,["string","array"]))throw new Bn(`Expected first argument to be of type array or string, but found ${eo(Io(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return r.slice(u,p)}return r.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var zu=$c;function jc(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ps(n,t,r,u){return u.compare(t,r)===0}function va(n,t,r){const u=n!=="=="&&n!=="!=";return class $C{constructor(y,w,M){this.type=Xn,this.lhs=y,this.rhs=w,this.collator=M,this.hasUntypedArgument=y.type.kind==="value"||w.type.kind==="value"}static parse(y,w){if(y.length!==3&&y.length!==4)return w.error("Expected two or three arguments.");const M=y[0];let D=w.parse(y[1],1,Hn);if(!D)return null;if(!jc(M,D.type))return w.concat(1).error(`"${M}" comparisons are not supported for type '${eo(D.type)}'.`);let R=w.parse(y[2],2,Hn);if(!R)return null;if(!jc(M,R.type))return w.concat(2).error(`"${M}" comparisons are not supported for type '${eo(R.type)}'.`);if(D.type.kind!==R.type.kind&&D.type.kind!=="value"&&R.type.kind!=="value")return w.error(`Cannot compare types '${eo(D.type)}' and '${eo(R.type)}'.`);u&&(D.type.kind==="value"&&R.type.kind!=="value"?D=new $s(R.type,[D]):D.type.kind!=="value"&&R.type.kind==="value"&&(R=new $s(D.type,[R])));let $=null;if(y.length===4){if(D.type.kind!=="string"&&R.type.kind!=="string"&&D.type.kind!=="value"&&R.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if($=w.parse(y[3],3,Tl),!$)return null}return new $C(D,R,$)}evaluate(y){const w=this.lhs.evaluate(y),M=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const D=Io(w),R=Io(M);if(D.kind!==R.kind||D.kind!=="string"&&D.kind!=="number")throw new Bn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${D.kind}, ${R.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const D=Io(w),R=Io(M);if(D.kind!=="string"||R.kind!=="string")return t(y,w,M)}return this.collator?r(y,w,M,this.collator.evaluate(y)):t(y,w,M)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[n];return this.eachChild(w=>{y.push(w.serialize())}),y}}}const zs=va("==",function(n,t,r){return t===r},Ps),Nd=va("!=",function(n,t,r){return t!==r},function(n,t,r,u){return!Ps(0,t,r,u)}),Va=va("<",function(n,t,r){return t<r},function(n,t,r,u){return u.compare(t,r)<0}),Ud=va(">",function(n,t,r){return t>r},function(n,t,r,u){return u.compare(t,r)>0}),ul=va("<=",function(n,t,r){return t<=r},function(n,t,r,u){return u.compare(t,r)<=0}),Du=va(">=",function(n,t,r){return t>=r},function(n,t,r,u){return u.compare(t,r)>=0});class Lu{constructor(t,r,u,p,y,w){this.type=Jn,this.number=t,this.locale=r,this.currency=u,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=w}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const u=r.parse(t[1],1,Fi);if(!u)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=r.parse(p.locale,1,Jn),!y))return null;let w=null;if(p.currency&&(w=r.parse(p.currency,1,Jn),!w))return null;let M=null;if(p.unit&&(M=r.parse(p.unit,1,Jn),!M))return null;let D=null;if(p["min-fraction-digits"]&&(D=r.parse(p["min-fraction-digits"],1,Fi),!D))return null;let R=null;return p["max-fraction-digits"]&&(R=r.parse(p["max-fraction-digits"],1,Fi),!R)?null:new Lu(u,y,w,M,D,R)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Xh{constructor(t){this.type=Fi,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=r.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${eo(u.type)} instead.`):new Xh(u):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Bn(`Expected value to be of type string or array, but found ${eo(Io(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}const $d={"==":zs,"!=":Nd,">":Ud,"<":Va,">=":Du,"<=":ul,array:$s,at:Nc,boolean:$s,case:sc,coalesce:ph,collator:Ic,format:rl,image:Tu,in:Uc,"index-of":Pu,interpolate:Gs,"interpolate-hcl":Gs,"interpolate-lab":Gs,length:Xh,let:mh,literal:Yl,match:Vd,number:$s,"number-format":Lu,object:$s,slice:zu,step:Pl,string:$s,"to-boolean":Oa,"to-color":Oa,"to-number":Oa,"to-string":Oa,var:jr,within:dh};function Bu(n,[t,r,u,p]){t=t.evaluate(n),r=r.evaluate(n),u=u.evaluate(n);const y=p?p.evaluate(n):1,w=Rd(t,r,u,y);if(w)throw new Bn(w);return new ho(t/255*y,r/255*y,u/255*y,y)}function ac(n,t){return n in t}function ha(n,t){const r=t[n];return r===void 0?null:r}function Zi(n){return{type:n}}ya.register($d,{error:[{kind:"error"},[Jn],(n,[t])=>{throw new Bn(t.evaluate(n))}],typeof:[Jn,[Hn],(n,[t])=>eo(Io(t.evaluate(n)))],"to-rgba":[ns(Fi,4),[la],(n,[t])=>t.evaluate(n).toArray()],rgb:[la,[Fi,Fi,Fi],Bu],rgba:[la,[Fi,Fi,Fi,Fi],Bu],has:{type:Xn,overloads:[[[Jn],(n,[t])=>ac(t.evaluate(n),n.properties())],[[Jn,tl],(n,[t,r])=>ac(t.evaluate(n),r.evaluate(n))]]},get:{type:Hn,overloads:[[[Jn],(n,[t])=>ha(t.evaluate(n),n.properties())],[[Jn,tl],(n,[t,r])=>ha(t.evaluate(n),r.evaluate(n))]]},"feature-state":[Hn,[Jn],(n,[t])=>ha(t.evaluate(n),n.featureState||{})],properties:[tl,[],n=>n.properties()],"geometry-type":[Jn,[],n=>n.geometryType()],id:[Hn,[],n=>n.id()],zoom:[Fi,[],n=>n.globals.zoom],pitch:[Fi,[],n=>n.globals.pitch||0],"distance-from-center":[Fi,[],n=>n.distanceFromCenter()],"heatmap-density":[Fi,[],n=>n.globals.heatmapDensity||0],"line-progress":[Fi,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Fi,[],n=>n.globals.skyRadialProgress||0],accumulated:[Hn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Fi,Zi(Fi),(n,t)=>{let r=0;for(const u of t)r+=u.evaluate(n);return r}],"*":[Fi,Zi(Fi),(n,t)=>{let r=1;for(const u of t)r*=u.evaluate(n);return r}],"-":{type:Fi,overloads:[[[Fi,Fi],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Fi],(n,[t])=>-t.evaluate(n)]]},"/":[Fi,[Fi,Fi],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Fi,[Fi,Fi],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Fi,[],()=>Math.LN2],pi:[Fi,[],()=>Math.PI],e:[Fi,[],()=>Math.E],"^":[Fi,[Fi,Fi],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Fi,[Fi],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Fi,[Fi],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Fi,[Fi],(n,[t])=>Math.log(t.evaluate(n))],log2:[Fi,[Fi],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Fi,[Fi],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Fi,[Fi],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Fi,[Fi],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Fi,[Fi],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Fi,[Fi],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Fi,[Fi],(n,[t])=>Math.atan(t.evaluate(n))],min:[Fi,Zi(Fi),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Fi,Zi(Fi),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Fi,[Fi],(n,[t])=>Math.abs(t.evaluate(n))],round:[Fi,[Fi],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Fi,[Fi],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Fi,[Fi],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Xn,[Jn,Hn],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Xn,[Hn],(n,[t])=>n.id()===t.value],"filter-type-==":[Xn,[Jn],(n,[t])=>n.geometryType()===t.value],"filter-<":[Xn,[Jn,Hn],(n,[t,r])=>{const u=n.properties()[t.value],p=r.value;return typeof u==typeof p&&u<p}],"filter-id-<":[Xn,[Hn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r<u}],"filter->":[Xn,[Jn,Hn],(n,[t,r])=>{const u=n.properties()[t.value],p=r.value;return typeof u==typeof p&&u>p}],"filter-id->":[Xn,[Hn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r>u}],"filter-<=":[Xn,[Jn,Hn],(n,[t,r])=>{const u=n.properties()[t.value],p=r.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[Xn,[Hn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r<=u}],"filter->=":[Xn,[Jn,Hn],(n,[t,r])=>{const u=n.properties()[t.value],p=r.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[Xn,[Hn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r>=u}],"filter-has":[Xn,[Hn],(n,[t])=>t.value in n.properties()],"filter-has-id":[Xn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Xn,[ns(Jn)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Xn,[ns(Hn)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Xn,[Jn,ns(Hn)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Xn,[Jn,ns(Hn)],(n,[t,r])=>function(u,p,y,w){for(;y<=w;){const M=y+w>>1;if(p[M]===u)return!0;p[M]>u?w=M-1:y=M+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Xn,overloads:[[[Xn,Xn],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[Zi(Xn),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Xn,overloads:[[[Xn,Xn],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[Zi(Xn),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Xn,[Xn],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Xn,[Jn],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[Jn,[Jn],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[Jn,[Jn],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[Jn,Zi(Hn),(n,t)=>t.map(r=>Kl(r.evaluate(n))).join("")],"resolved-locale":[Jn,[Tl],(n,[t])=>t.evaluate(n).resolvedLocale()]});var Gc=$d;function Dl(n){return{result:"success",value:n}}function No(n){return{result:"error",value:n}}function hl(n){return n["property-type"]==="data-driven"}function Ni(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function qc(n){return!!n.expression&&n.expression.interpolated}function Sr(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function lc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Hh(n){return n}function Ru(n,t){const r=t.type==="color",u=n.stops&&typeof n.stops[0][0]=="object",p=u||!(u||n.property!==void 0),y=n.type||(qc(t)?"exponential":"interval");if(r&&((n=Gn({},n)).stops&&(n.stops=n.stops.map(R=>[R[0],ho.parse(R[1])])),n.default=ho.parse(n.default?n.default:t.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Fc[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let w,M,D;if(y==="exponential")w=Ou;else if(y==="interval")w=Yh;else if(y==="categorical"){w=Kh,M=Object.create(null);for(const R of n.stops)M[R[0]]=R[1];D=typeof n.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);w=Fu}if(u){const R={},$=[];for(let oe=0;oe<n.stops.length;oe++){const ue=n.stops[oe],ye=ue[0].zoom;R[ye]===void 0&&(R[ye]={zoom:ye,type:n.type,property:n.property,default:n.default,stops:[]},$.push(ye)),R[ye].stops.push([ue[0].value,ue[1]])}const W=[];for(const oe of $)W.push([R[oe].zoom,Ru(R[oe],t)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:Gs.interpolationFactor.bind(void 0,J),zoomStops:W.map(oe=>oe[0]),evaluate:({zoom:oe},ue)=>Ou({stops:W,base:n.base},t,oe).evaluate(oe,ue)}}if(p){const R=y==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Gs.interpolationFactor.bind(void 0,R),zoomStops:n.stops.map($=>$[0]),evaluate:({zoom:$})=>w(n,t,$,M,D)}}return{kind:"source",evaluate(R,$){const W=$&&$.properties?$.properties[n.property]:void 0;return W===void 0?cc(n.default,t.default):w(n,t,W,M,D)}}}function cc(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Kh(n,t,r,u,p){return cc(typeof r===p?u[r]:void 0,n.default,t.default)}function Yh(n,t,r){if(Sr(r)!=="number")return cc(n.default,t.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const p=Lr(n.stops.map(y=>y[0]),r);return n.stops[p][1]}function Ou(n,t,r){const u=n.base!==void 0?n.base:1;if(Sr(r)!=="number")return cc(n.default,t.default);const p=n.stops.length;if(p===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[p-1][0])return n.stops[p-1][1];const y=Lr(n.stops.map($=>$[0]),r),w=function($,W,J,oe){const ue=oe-J,ye=$-J;return ue===0?0:W===1?ye/ue:(Math.pow(W,ye)-1)/(Math.pow(W,ue)-1)}(r,u,n.stops[y][0],n.stops[y+1][0]),M=n.stops[y][1],D=n.stops[y+1][1];let R=fh[t.type]||Hh;if(n.colorSpace&&n.colorSpace!=="rgb"){const $=Fc[n.colorSpace];R=(W,J)=>$.reverse($.interpolate($.forward(W),$.forward(J),w))}return typeof M.evaluate=="function"?{evaluate(...$){const W=M.evaluate.apply(void 0,$),J=D.evaluate.apply(void 0,$);if(W!==void 0&&J!==void 0)return R(W,J,w)}}:R(M,D,w)}function Fu(n,t,r){return t.type==="color"?r=ho.parse(r):t.type==="formatted"?r=Vo.fromString(r.toString()):t.type==="resolvedImage"?r=Us.fromString(r.toString()):Sr(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),cc(r,n.default,t.default)}class Zc{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new ch,this._defaultValue=r?function(u){return u.type==="color"&&(lc(u.default)||Array.isArray(u.default))?new ho(0,0,0,0):u.type==="color"?ho.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,u,p,y,w,M,D){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,u,p,y,w,M,D){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=D||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Bn(`Expected value to be one of ${Object.keys(this._enumValues).map($=>JSON.stringify($)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function uc(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Gc}function Po(n,t){const r=new Un(Gc,[],t?function(p){const y={color:la,string:Jn,number:Fi,enum:Jn,boolean:Xn,formatted:El,resolvedImage:il};return p.type==="array"?ns(y[p.value]||Hn,p.length):y[p.type]}(t):void 0),u=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Dl(new Zc(u,t)):No(r.errors)}class bs{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Fa(r.expression)}evaluateWithoutErrorHandling(t,r,u,p,y,w){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,p,y,w)}evaluate(t,r,u,p,y,w){return this._styleExpression.evaluate(t,r,u,p,y,w)}}class Vu{constructor(t,r,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Fa(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,r,u,p,y,w){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,p,y,w)}evaluate(t,r,u,p,y,w){return this._styleExpression.evaluate(t,r,u,p,y,w)}interpolationFactor(t,r,u){return this.interpolationType?Gs.interpolationFactor(this.interpolationType,t,r,u):0}}function Ll(n,t){if((n=Po(n,t)).result==="error")return n;const r=n.value.expression,u=sl(r);if(!u&&!hl(t))return No([new $r("","data expressions not supported")]);const p=Pc(r,["zoom","pitch","distance-from-center"]);if(!p&&!Ni(t))return No([new $r("","zoom expressions not supported")]);const y=dl(r);return y||p?y instanceof $r?No([y]):y instanceof Gs&&!qc(t)?No([new $r("",'"interpolate" expressions cannot be used with this property')]):Dl(y?new Vu(u?"camera":"composite",n.value,y.labels,y instanceof Gs?y.interpolation:void 0):new bs(u?"constant":"source",n.value)):No([new $r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bl{constructor(t,r){this._parameters=t,this._specification=r,Gn(this,Ru(this._parameters,this._specification))}static deserialize(t){return new Bl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function dl(n){let t=null;if(n instanceof mh)t=dl(n.result);else if(n instanceof ph){for(const r of n.args)if(t=dl(r),t)break}else(n instanceof Pl||n instanceof Gs)&&n.input instanceof ya&&n.input.name==="zoom"&&(t=n);return t instanceof $r||n.eachChild(r=>{const u=dl(r);u instanceof $r?t=u:!t&&u?t=new $r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new $r("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class ji{constructor(t,r,u,p){this.message=(t?`${t}: `:"")+u,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function vo(n){const t=n.key,r=n.value,u=n.valueSpec||{},p=n.objectElementValidators||{},y=n.style,w=n.styleSpec;let M=[];const D=Sr(r);if(D!=="object")return[new ji(t,r,`object expected, ${D} found`)];for(const R in r){const $=R.split(".")[0],W=u[$]||u["*"];let J;p[$]?J=p[$]:u[$]?J=pe:p["*"]?J=p["*"]:u["*"]&&(J=pe),J?M=M.concat(J({key:(t&&`${t}.`)+R,value:r[R],valueSpec:W,style:y,styleSpec:w,object:r,objectKey:R},r)):M.push(new ji(t,r[R],`unknown property "${R}"`))}for(const R in u)p[R]||u[R].required&&u[R].default===void 0&&r[R]===void 0&&M.push(new ji(t,r,`missing required property "${R}"`));return M}function Rr(n){const t=n.value,r=n.valueSpec,u=n.style,p=n.styleSpec,y=n.key,w=n.arrayElementValidator||pe;if(Sr(t)!=="array")return[new ji(y,t,`array expected, ${Sr(t)} found`)];if(r.length&&t.length!==r.length)return[new ji(y,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ji(y,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let M={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(M.function=r.function),Sr(r.value)==="object"&&(M=r.value);let D=[];for(let R=0;R<t.length;R++)D=D.concat(w({array:t,arrayIndex:R,value:t[R],valueSpec:M,style:u,styleSpec:p,key:`${y}[${R}]`}));return D}function Wc(n){const t=n.key,r=n.value,u=n.valueSpec;let p=Sr(r);if(p==="number"&&r!=r&&(p="NaN"),p!=="number")return[new ji(t,r,`number expected, ${p} found`)];if("minimum"in u){let y=u.minimum;if(Sr(u.minimum)==="array"&&(y=u.minimum[n.arrayIndex]),r<y)return[new ji(t,r,`${r} is less than the minimum value ${y}`)]}if("maximum"in u){let y=u.maximum;if(Sr(u.maximum)==="array"&&(y=u.maximum[n.arrayIndex]),r>y)return[new ji(t,r,`${r} is greater than the maximum value ${y}`)]}return[]}function Nu(n){const t=n.valueSpec,r=Fn(n.value.type);let u,p,y,w={};const M=r!=="categorical"&&n.value.property===void 0,D=!M,R=Sr(n.value.stops)==="array"&&Sr(n.value.stops[0])==="array"&&Sr(n.value.stops[0][0])==="object",$=vo({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(oe){if(r==="identity")return[new ji(oe.key,oe.value,'identity function may not have a "stops" property')];let ue=[];const ye=oe.value;return ue=ue.concat(Rr({key:oe.key,value:ye,valueSpec:oe.valueSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:W})),Sr(ye)==="array"&&ye.length===0&&ue.push(new ji(oe.key,ye,"array must have at least one stop")),ue},default:function(oe){return pe({key:oe.key,value:oe.value,valueSpec:t,style:oe.style,styleSpec:oe.styleSpec})}}});return r==="identity"&&M&&$.push(new ji(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||$.push(new ji(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!qc(n.valueSpec)&&$.push(new ji(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(D&&!hl(n.valueSpec)?$.push(new ji(n.key,n.value,"property functions not supported")):M&&!Ni(n.valueSpec)&&$.push(new ji(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!R||n.value.property!==void 0||$.push(new ji(n.key,n.value,'"property" property is required')),$;function W(oe){let ue=[];const ye=oe.value,ke=oe.key;if(Sr(ye)!=="array")return[new ji(ke,ye,`array expected, ${Sr(ye)} found`)];if(ye.length!==2)return[new ji(ke,ye,`array length 2 expected, length ${ye.length} found`)];if(R){if(Sr(ye[0])!=="object")return[new ji(ke,ye,`object expected, ${Sr(ye[0])} found`)];if(ye[0].zoom===void 0)return[new ji(ke,ye,"object stop key must have zoom")];if(ye[0].value===void 0)return[new ji(ke,ye,"object stop key must have value")];const Ke=Fn(ye[0].zoom);if(typeof Ke!="number")return[new ji(ke,ye[0].zoom,"stop zoom values must be numbers")];if(y&&y>Ke)return[new ji(ke,ye[0].zoom,"stop zoom values must appear in ascending order")];Ke!==y&&(y=Ke,p=void 0,w={}),ue=ue.concat(vo({key:`${ke}[0]`,value:ye[0],valueSpec:{zoom:{}},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:Wc,value:J}}))}else ue=ue.concat(J({key:`${ke}[0]`,value:ye[0],valueSpec:{},style:oe.style,styleSpec:oe.styleSpec},ye));return uc(Qr(ye[1]))?ue.concat([new ji(`${ke}[1]`,ye[1],"expressions are not allowed in function stops.")]):ue.concat(pe({key:`${ke}[1]`,value:ye[1],valueSpec:t,style:oe.style,styleSpec:oe.styleSpec}))}function J(oe,ue){const ye=Sr(oe.value),ke=Fn(oe.value),Ke=oe.value!==null?oe.value:ue;if(u){if(ye!==u)return[new ji(oe.key,Ke,`${ye} stop domain type must match previous stop domain type ${u}`)]}else u=ye;if(ye!=="number"&&ye!=="string"&&ye!=="boolean"&&typeof ke!="number"&&typeof ke!="string"&&typeof ke!="boolean")return[new ji(oe.key,Ke,"stop domain value must be a number, string, or boolean")];if(ye!=="number"&&r!=="categorical"){let ct=`number expected, ${ye} found`;return hl(t)&&r===void 0&&(ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ji(oe.key,Ke,ct)]}return r!=="categorical"||ye!=="number"||typeof ke=="number"&&isFinite(ke)&&Math.floor(ke)===ke?r!=="categorical"&&ye==="number"&&typeof ke=="number"&&typeof p=="number"&&p!==void 0&&ke<p?[new ji(oe.key,Ke,"stop domain values must appear in ascending order")]:(p=ke,r==="categorical"&&ke in w?[new ji(oe.key,Ke,"stop domain values must be unique")]:(w[ke]=!0,[])):[new ji(oe.key,Ke,`integer expected, found ${String(ke)}`)]}}function hc(n){const t=(n.expressionContext==="property"?Ll:Po)(Qr(n.value),n.valueSpec);if(t.result==="error")return t.value.map(u=>new ji(`${n.key}${u.key}`,n.value,u.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new ji(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Fa(r))return[new ji(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return Jh(r,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Pc(r,["zoom","feature-state"]))return[new ji(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!sl(r))return[new ji(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jh(n,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];const u=[];return n instanceof ya&&r.has(n.name)?[new ji(t.key,t.value,`["${n.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(n.eachChild(p=>{u.push(...Jh(p,t))}),u)}function Uu(n){const t=n.key,r=n.value,u=n.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(Fn(r))===-1&&p.push(new ji(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(Fn(r))===-1&&p.push(new ji(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Xc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Xc(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function gs(n,t="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xc(n)||(n=Ao(n));const r=n;let u=!0;try{u=function(R){if(!yn(R))return R;let $=Qr(R);return an($),$=os($),$}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const p=Mt[`filter_${t}`],y=Po(u,p);let w=null;if(y.result==="error")throw new Error(y.value.map(R=>`${R.key}: ${R.message}`).join(", "));w=(R,$,W)=>y.value.evaluate(R,$,{},W);let M=null,D=null;if(u!==r){const R=Po(r,p);if(R.result==="error")throw new Error(R.value.map($=>`${$.key}: ${$.message}`).join(", "));M=($,W,J,oe,ue)=>R.value.evaluate($,W,{},J,void 0,void 0,oe,ue),D=!sl(R.value.expression)}return{filter:w,dynamicFilter:M||void 0,needGeometry:fl(u),needFeature:!!D}}function os(n){if(!Array.isArray(n))return n;const t=function(r){if(Hc.has(r[0])){for(let u=1;u<r.length;u++)if(yn(r[u]))return!0}return r}(n);return t===!0?t:t.map(r=>os(r))}function an(n){let t=!1;const r=[];if(n[0]==="case"){for(let u=1;u<n.length-1;u+=2)t=t||yn(n[u]),r.push(n[u+1]);r.push(n[n.length-1])}else if(n[0]==="match"){t=t||yn(n[1]);for(let u=2;u<n.length-1;u+=2)r.push(n[u+1]);r.push(n[n.length-1])}else if(n[0]==="step"){t=t||yn(n[1]);for(let u=1;u<n.length-1;u+=2)r.push(n[u+1])}t&&(n.length=0,n.push("any",...r));for(let u=1;u<n.length;u++)an(n[u])}function yn(n){if(!Array.isArray(n))return!1;if((t=n[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<n.length;r++)if(yn(n[r]))return!0;return!1}const Hc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qh(n,t){return n<t?-1:n>t?1:0}function fl(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(fl(n[t]))return!0;return!1}function Ao(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Na(n[1],n[2],"=="):t==="!="?xa(Na(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Na(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Ao))):t==="all"?["all"].concat(n.slice(1).map(Ao)):t==="none"?["all"].concat(n.slice(1).map(Ao).map(xa)):t==="in"?qs(n[1],n.slice(2)):t==="!in"?xa(qs(n[1],n.slice(2))):t==="has"?ed(n[1]):t==="!has"?xa(ed(n[1])):t!=="within"||n;var r}function Na(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function qs(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Qh)]]:["filter-in-small",n,["literal",t]]}}function ed(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function xa(n){return["!",n]}function to(n){return Xc(Qr(n.value))?hc(Gn({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):zo(n)}function zo(n){const t=n.value,r=n.key;if(Sr(t)!=="array")return[new ji(r,t,`array expected, ${Sr(t)} found`)];const u=n.styleSpec;let p,y=[];if(t.length<1)return[new ji(r,t,"filter array must have at least 1 element")];switch(y=y.concat(Uu({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:n.style,styleSpec:n.styleSpec})),Fn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Fn(t[1])==="$type"&&y.push(new ji(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new ji(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Sr(t[1]),p!=="string"&&y.push(new ji(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let w=2;w<t.length;w++)p=Sr(t[w]),Fn(t[1])==="$type"?y=y.concat(Uu({key:`${r}[${w}]`,value:t[w],valueSpec:u.geometry_type,style:n.style,styleSpec:n.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new ji(`${r}[${w}]`,t[w],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)y=y.concat(zo({key:`${r}[${w}]`,value:t[w],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":p=Sr(t[1]),t.length!==2?y.push(new ji(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new ji(`${r}[1]`,t[1],`string expected, ${p} found`));break;case"within":p=Sr(t[1]),t.length!==2?y.push(new ji(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="object"&&y.push(new ji(`${r}[1]`,t[1],`object expected, ${p} found`))}return y}function $u(n,t){const r=n.key,u=n.style,p=n.styleSpec,y=n.value,w=n.objectKey,M=p[`${t}_${n.layerType}`];if(!M)return[];const D=w.match(/^(.*)-transition$/);if(t==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return pe({key:r,value:y,valueSpec:p.transition,style:u,styleSpec:p});const R=n.valueSpec||M[w];if(!R)return[new ji(r,y,`unknown property "${w}"`)];let $;if(Sr(y)==="string"&&hl(R)&&!R.tokens&&($=/^{([^}]+)}$/.exec(y)))return[new ji(r,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const W=[];return n.layerType==="symbol"&&(w==="text-field"&&u&&!u.glyphs&&W.push(new ji(r,y,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&lc(Qr(y))&&Fn(y.type)==="identity"&&W.push(new ji(r,y,'"text-font" does not support identity functions'))),W.concat(pe({key:n.key,value:y,valueSpec:R,style:u,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:w}))}function pl(n){return $u(n,"paint")}function C(n){return $u(n,"layout")}function a(n){let t=[];const r=n.value,u=n.key,p=n.style,y=n.styleSpec;r.type||r.ref||t.push(new ji(u,r,'either "type" or "ref" is required'));let w=Fn(r.type);const M=Fn(r.ref);if(r.id){const D=Fn(r.id);for(let R=0;R<n.arrayIndex;R++){const $=p.layers[R];Fn($.id)===D&&t.push(new ji(u,r.id,`duplicate layer id "${r.id}", previously used at line ${$.id.__line__}`))}}if("ref"in r){let D;["type","source","source-layer","filter","layout"].forEach(R=>{R in r&&t.push(new ji(u,r[R],`"${R}" is prohibited for ref layers`))}),p.layers.forEach(R=>{Fn(R.id)===M&&(D=R)}),D?D.ref?t.push(new ji(u,r.ref,"ref cannot reference another ref layer")):w=Fn(D.type):typeof M=="string"&&t.push(new ji(u,r.ref,`ref layer "${M}" not found`))}else if(w!=="background"&&w!=="sky")if(r.source){const D=p.sources&&p.sources[r.source],R=D&&Fn(D.type);D?R==="vector"&&w==="raster"?t.push(new ji(u,r.source,`layer "${r.id}" requires a raster source`)):R==="raster"&&w!=="raster"?t.push(new ji(u,r.source,`layer "${r.id}" requires a vector source`)):R!=="vector"||r["source-layer"]?R==="raster-dem"&&w!=="hillshade"?t.push(new ji(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||R==="geojson"&&D.lineMetrics||t.push(new ji(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ji(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ji(u,r.source,`source "${r.source}" not found`))}else t.push(new ji(u,r,'missing required property "source"'));return t=t.concat(vo({key:u,value:r,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pe({key:`${u}.type`,value:r.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:D=>to(Gn({layerType:w},D)),layout:D=>vo({layer:r,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":R=>C(Gn({layerType:w},R))}}),paint:D=>vo({layer:r,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":R=>pl(Gn({layerType:w},R))}})}})),t}function m(n){const t=n.value,r=n.key,u=Sr(t);return u!=="string"?[new ji(r,t,`string expected, ${u} found`)]:[]}const T={promoteId:function({key:n,value:t}){if(Sr(t)==="string")return m({key:n,value:t});{const r=[];for(const u in t)r.push(...m({key:`${n}.${u}`,value:t[u]}));return r}}};function A(n){const t=n.value,r=n.key,u=n.styleSpec,p=n.style;if(!t.type)return[new ji(r,t,'"type" is required')];const y=Fn(t.type);let w;switch(y){case"vector":case"raster":case"raster-dem":return w=vo({key:r,value:t,valueSpec:u[`source_${y.replace("-","_")}`],style:n.style,styleSpec:u,objectElementValidators:T}),w;case"geojson":if(w=vo({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:T}),t.cluster)for(const M in t.clusterProperties){const[D,R]=t.clusterProperties[M],$=typeof D=="string"?[D,["accumulated"],["get",M]]:D;w.push(...hc({key:`${r}.${M}.map`,value:R,expressionContext:"cluster-map"})),w.push(...hc({key:`${r}.${M}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return w;case"video":return vo({key:r,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return vo({key:r,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new ji(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uu({key:`${r}.type`,value:t.type,valueSpec:{values:L(u)},style:p,styleSpec:u})}}function L(n){return n.source.reduce((t,r)=>{const u=n[r];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function N(n){const t=n.value,r=n.styleSpec,u=r.light,p=n.style;let y=[];const w=Sr(t);if(t===void 0)return y;if(w!=="object")return y=y.concat([new ji("light",t,`object expected, ${w} found`)]),y;for(const M in t){const D=M.match(/^(.*)-transition$/);y=y.concat(D&&u[D[1]]&&u[D[1]].transition?pe({key:M,value:t[M],valueSpec:r.transition,style:p,styleSpec:r}):u[M]?pe({key:M,value:t[M],valueSpec:u[M],style:p,styleSpec:r}):[new ji(M,t[M],`unknown property "${M}"`)])}return y}function H(n){const t=n.value,r=n.key,u=n.style,p=n.styleSpec,y=p.terrain;let w=[];const M=Sr(t);if(t===void 0)return w;if(M!=="object")return w=w.concat([new ji("terrain",t,`object expected, ${M} found`)]),w;for(const D in t){const R=D.match(/^(.*)-transition$/);w=w.concat(R&&y[R[1]]&&y[R[1]].transition?pe({key:D,value:t[D],valueSpec:p.transition,style:u,styleSpec:p}):y[D]?pe({key:D,value:t[D],valueSpec:y[D],style:u,styleSpec:p}):[new ji(D,t[D],`unknown property "${D}"`)])}if(t.source){const D=u.sources&&u.sources[t.source],R=D&&Fn(D.type);D?R!=="raster-dem"&&w.push(new ji(r,t.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):w.push(new ji(r,t.source,`source "${t.source}" not found`))}else w.push(new ji(r,t,'terrain is missing required property "source"'));return w}function Q(n){const t=n.value,r=n.style,u=n.styleSpec,p=u.fog;let y=[];const w=Sr(t);if(t===void 0)return y;if(w!=="object")return y=y.concat([new ji("fog",t,`object expected, ${w} found`)]),y;for(const M in t){const D=M.match(/^(.*)-transition$/);y=y.concat(D&&p[D[1]]&&p[D[1]].transition?pe({key:M,value:t[M],valueSpec:u.transition,style:r,styleSpec:u}):p[M]?pe({key:M,value:t[M],valueSpec:p[M],style:r,styleSpec:u}):[new ji(M,t[M],`unknown property "${M}"`)])}return y}const se={"*":()=>[],array:Rr,boolean:function(n){const t=n.value,r=n.key,u=Sr(t);return u!=="boolean"?[new ji(r,t,`boolean expected, ${u} found`)]:[]},number:Wc,color:function(n){const t=n.key,r=n.value,u=Sr(r);return u!=="string"?[new ji(t,r,`color expected, ${u} found`)]:Cl(r)===null?[new ji(t,r,`color expected, "${r}" found`)]:[]},enum:Uu,filter:to,function:Nu,layer:a,object:vo,source:A,light:N,terrain:H,fog:Q,string:m,formatted:function(n){return m(n).length===0?[]:hc(n)},resolvedImage:function(n){return m(n).length===0?[]:hc(n)},projection:function(n){const t=n.value,r=n.styleSpec,u=r.projection,p=n.style;let y=[];const w=Sr(t);if(w==="object")for(const M in t)y=y.concat(pe({key:M,value:t[M],valueSpec:u[M],style:p,styleSpec:r}));else w!=="string"&&(y=y.concat([new ji("projection",t,`object or string expected, ${w} found`)]));return y}};function pe(n){const t=n.value,r=n.valueSpec,u=n.styleSpec;return r.expression&&lc(Fn(t))?Nu(n):r.expression&&uc(Qr(t))?hc(n):r.type&&se[r.type]?se[r.type](n):vo(Gn({},n,{valueSpec:r.type?u[r.type]:r}))}function xe(n){const t=n.value,r=n.key,u=m(n);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new ji(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new ji(r,t,'"glyphs" url must include a "{range}" token'))),u}function Ee(n,t=Mt){return We(pe({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:xe,"*":()=>[]}}))}const Qe=n=>We(pl(n)),Ge=n=>We(C(n));function We(n){return n.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function _t(n,t){let r=!1;if(t&&t.length)for(const u of t)n.fire(new Zn(new Error(u.message))),r=!0;return r}var Tt=kt;function kt(n,t,r){var u=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var p=new Int32Array(this.arrayBuffer);n=p[0],this.d=(t=p[1])+2*(r=p[2]);for(var y=0;y<this.d*this.d;y++){var w=p[3+y],M=p[3+y+1];u.push(w===M?null:p.subarray(w,M))}var D=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],D),this.bboxes=p.subarray(D),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var R=0;R<this.d*this.d;R++)u.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=r,this.scale=t/n,this.uid=0;var $=r/t*n;this.min=-$,this.max=n+$}kt.prototype.insert=function(n,t,r,u,p){this._forEachCell(t,r,u,p,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p)},kt.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},kt.prototype._insertCell=function(n,t,r,u,p,y){this.cells[p].push(y)},kt.prototype.query=function(n,t,r,u,p){var y=this.min,w=this.max;if(n<=y&&t<=y&&w<=r&&w<=u&&!p)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(n,t,r,u,this._queryCell,M,{},p),M},kt.prototype._queryCell=function(n,t,r,u,p,y,w,M){var D=this.cells[p];if(D!==null)for(var R=this.keys,$=this.bboxes,W=0;W<D.length;W++){var J=D[W];if(w[J]===void 0){var oe=4*J;(M?M($[oe+0],$[oe+1],$[oe+2],$[oe+3]):n<=$[oe+2]&&t<=$[oe+3]&&r>=$[oe+0]&&u>=$[oe+1])?(w[J]=!0,y.push(R[J])):w[J]=!1}}},kt.prototype._forEachCell=function(n,t,r,u,p,y,w,M){for(var D=this._convertToCellCoord(n),R=this._convertToCellCoord(t),$=this._convertToCellCoord(r),W=this._convertToCellCoord(u),J=D;J<=$;J++)for(var oe=R;oe<=W;oe++){var ue=this.d*oe+J;if((!M||M(this._convertFromCellCoord(J),this._convertFromCellCoord(oe),this._convertFromCellCoord(J+1),this._convertFromCellCoord(oe+1)))&&p.call(this,n,t,r,u,ue,y,w,M))return}},kt.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},kt.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},kt.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=3+this.cells.length+1+1,r=0,u=0;u<this.cells.length;u++)r+=this.cells[u].length;var p=new Int32Array(t+r+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var y=t,w=0;w<n.length;w++){var M=n[w];p[3+w]=y,p.set(M,y),y+=M.length}return p[3+n.length]=y,p.set(this.keys,y),p[3+n.length+1]=y+=this.keys.length,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer};const ot={};function ft(n,t,r={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),ot[t]={klass:n,omit:r.omit||[]}}ft(Object,"Object"),Tt.serialize=function(n,t){const r=n.toArrayBuffer();return t&&t.push(r),{buffer:r}},Tt.deserialize=function(n){return new Tt(n.buffer)},Object.defineProperty(Tt,"name",{value:"Grid"}),ft(Tt,"Grid"),ft(ho,"Color"),ft(Error,"Error"),ft(Eo,"AJAXError"),ft(Us,"ResolvedImage"),ft(Bl,"StylePropertyFunction"),ft(Zc,"StyleExpression",{omit:["_evaluator"]}),ft(Vu,"ZoomDependentExpression"),ft(bs,"ZoomConstantExpression"),ft(ya,"CompoundExpression",{omit:["_evaluate"]});for(const n in Gc)ot[Gc[n]._classRegistryKey]||ft(Gc[n],`Expression${n}`);function Rt(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ii(n){return F.ImageBitmap&&n instanceof F.ImageBitmap}function Qt(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Rt(n)||ii(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return t&&t.push(r.buffer),r}if(n instanceof F.ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const u of n)r.push(Qt(u,t));return r}if(typeof n=="object"){const r=n.constructor,u=r._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const p=r.serialize?r.serialize(n,t):{};if(!r.serialize){for(const y in n)n.hasOwnProperty(y)&&(ot[u].omit.indexOf(y)>=0||(p[y]=Qt(n[y],t)));n instanceof Error&&(p.message=n.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof n)}function _i(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Rt(n)||ii(n)||ArrayBuffer.isView(n)||n instanceof F.ImageData)return n;if(Array.isArray(n))return n.map(_i);if(typeof n=="object"){const t=n.$name||"Object",{klass:r}=ot[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const u=Object.create(r.prototype);for(const p of Object.keys(n))p!=="$name"&&(u[p]=_i(n[p]));return u}throw new Error("can't deserialize object of type "+typeof n)}const Jt=n=>n>=1536&&n<=1791,Ji=n=>n>=1872&&n<=1919,Vi=n=>n>=2208&&n<=2303,en=n=>n>=11904&&n<=12031,Rn=n=>n>=12032&&n<=12255,$n=n=>n>=12272&&n<=12287,dn=n=>n>=12288&&n<=12351,xr=n=>n>=12352&&n<=12447,Cr=n=>n>=12448&&n<=12543,ur=n=>n>=12544&&n<=12591,hr=n=>n>=12704&&n<=12735,Dr=n=>n>=12736&&n<=12783,Wo=n=>n>=12784&&n<=12799,ba=n=>n>=12800&&n<=13055,da=n=>n>=13056&&n<=13311,wa=n=>n>=13312&&n<=19903,Ua=n=>n>=19968&&n<=40959,Zs=n=>n>=40960&&n<=42127,ws=n=>n>=42128&&n<=42191,Ta=n=>n>=44032&&n<=55215,Rl=n=>n>=63744&&n<=64255,_=n=>n>=64336&&n<=65023,o=n=>n>=65040&&n<=65055,f=n=>n>=65072&&n<=65103,x=n=>n>=65104&&n<=65135,S=n=>n>=65136&&n<=65279,k=n=>n>=65280&&n<=65519;function O(n){for(const t of n)if(te(t.charCodeAt(0)))return!0;return!1}function V(n){for(const t of n)if(!G(t.charCodeAt(0)))return!1;return!0}function G(n){return!(Jt(n)||Ji(n)||Vi(n)||_(n)||S(n))}function te(n){return!(n!==746&&n!==747&&(n<4352||!(hr(n)||ur(n)||f(n)&&!(n>=65097&&n<=65103)||Rl(n)||da(n)||en(n)||Dr(n)||!(!dn(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||wa(n)||Ua(n)||ba(n)||(t=>t>=12592&&t<=12687)(n)||(t=>t>=43360&&t<=43391)(n)||(t=>t>=55216&&t<=55295)(n)||(t=>t>=4352&&t<=4607)(n)||Ta(n)||xr(n)||$n(n)||(t=>t>=12688&&t<=12703)(n)||Rn(n)||Wo(n)||Cr(n)&&n!==12540||!(!k(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!x(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(t=>t>=5120&&t<=5759)(n)||(t=>t>=6320&&t<=6399)(n)||o(n)||(t=>t>=19904&&t<=19967)(n)||Zs(n)||ws(n))))}function ie(n){return!(te(n)||function(t){return!!((r=>r>=128&&r<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(r=>r>=8192&&r<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(r=>r>=8448&&r<=8527)(t)||(r=>r>=8528&&r<=8591)(t)||(r=>r>=8960&&r<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(r=>r>=9216&&r<=9279)(t)&&t!==9251||(r=>r>=9280&&r<=9311)(t)||(r=>r>=9312&&r<=9471)(t)||(r=>r>=9632&&r<=9727)(t)||(r=>r>=9728&&r<=9983)(t)&&!(t>=9754&&t<=9759)||(r=>r>=11008&&r<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||dn(t)||Cr(t)||(r=>r>=57344&&r<=63743)(t)||f(t)||x(t)||k(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function ge(n){return n>=1424&&n<=2303||_(n)||S(n)}function Te(n,t){return!(!t&&ge(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(r=>r>=6016&&r<=6143)(n))}function Be(n){for(const t of n)if(ge(t.charCodeAt(0)))return!0;return!1}const Le="deferred",Re="loading",Pe="loaded";let ze=null,Ne="unavailable",Fe=null;const et=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Ne="error"),ze&&ze(n)};function ut(){lt.fire(new _n("pluginStateChange",{pluginStatus:Ne,pluginURL:Fe}))}const lt=new xn,yt=function(){return Ne},$t=function(){if(Ne!==Le||!Fe)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ne=Re,ut(),Fe&&_o({url:Fe},n=>{n?et(n):(Ne=Pe,ut())})},Dt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ne===Pe||Dt.applyArabicShaping!=null,isLoading:()=>Ne===Re,setState(n){Ne=n.pluginStatus,Fe=n.pluginURL},isParsed:()=>Dt.applyArabicShaping!=null&&Dt.processBidirectionalText!=null&&Dt.processStyledBidirectionalText!=null,getPluginURL:()=>Fe};class Et{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(r,u){for(const p of r)if(!Te(p.charCodeAt(0),u))return!1;return!0}(t,Dt.isLoaded())}}class bi{constructor(t,r){this.property=t,this.value=r,this.expression=function(u,p){if(lc(u))return new Bl(u,p);if(uc(u)){const y=Ll(u,p);if(y.result==="error")throw new Error(y.value.map(w=>`${w.key}: ${w.message}`).join(", "));return y.value}{let y=u;return typeof u=="string"&&p.type==="color"&&(y=ho.parse(u)),{kind:"constant",evaluate:()=>y}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,u){return this.property.possiblyEvaluate(this,t,r,u)}}class wt{constructor(t){this.property=t,this.value=new bi(t,void 0)}transitioned(t,r){return new qt(this.property,this.value,r,di({},t.transition,this.transition),t.now)}untransitioned(){return new qt(this.property,this.value,null,{},0)}}class ei{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return uo(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new wt(this._values[t].property)),this._values[t].value=new bi(this._values[t].property,r===null?void 0:uo(r))}getTransition(t){return uo(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new wt(this._values[t].property)),this._values[t].transition=uo(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(t[r]=u);const p=this.getTransition(r);p!==void 0&&(t[`${r}-transition`]=p)}return t}transitioned(t,r){const u=new pi(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(t,r._values[p]);return u}untransitioned(){const t=new pi(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class qt{constructor(t,r,u,p,y){const w=p.delay||0,M=p.duration||0;y=y||0,this.property=t,this.value=r,this.begin=y+w,this.end=this.begin+M,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(t,r,u){const p=t.now||0,y=this.value.possiblyEvaluate(t,r,u),w=this.prior;if(w){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return w.possiblyEvaluate(t,r,u);{const M=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(t,r,u),y,At(M))}}return y}}class pi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,u){const p=new Ti(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,r,u);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Gt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return uo(this._values[t].value)}setValue(t,r){this._values[t]=new bi(this._values[t].property,r===null?void 0:uo(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(t[r]=u)}return t}possiblyEvaluate(t,r,u){const p=new Ti(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,r,u);return p}}class ai{constructor(t,r,u){this.property=t,this.value=r,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,u,p){return this.property.evaluate(this.value,this.parameters,t,r,u,p)}}class Ti{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class St{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,u){const p=fh[this.specification.type];return p?p(t,r,u):t}}class Zt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,u,p){return new ai(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},u,p)}:t.expression,r)}interpolate(t,r,u){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new ai(this,{kind:"constant",value:void 0},t.parameters);const p=fh[this.specification.type];return p?new ai(this,{kind:"constant",value:p(t.value.value,r.value.value,u)},t.parameters):t}evaluate(t,r,u,p,y,w){return t.kind==="constant"?t.value:t.evaluate(r,u,p,y,w)}}class sn{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,p){return!!t.expression.evaluate(r,null,{},u,p)}interpolate(){return!1}}class vn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Et(0,{});for(const u in t){const p=t[u];p.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new bi(p,void 0),w=this.defaultTransitionablePropertyValues[u]=new wt(p);this.defaultTransitioningPropertyValues[u]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate(r)}}}function rn(n,t){return 256*(n=Wt(Math.floor(n),0,255))+Wt(Math.floor(t),0,255)}ft(Zt,"DataDrivenProperty"),ft(St,"DataConstantProperty"),ft(sn,"ColorRampProperty");const Cn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nn{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yi(n,t=1){let r=0,u=0;return{members:n.map(p=>{const y=Cn[p.type].BYTES_PER_ELEMENT,w=r=br(r,Math.max(t,y)),M=p.components||1;return u=Math.max(u,y),r+=y*M,{name:p.name,type:p.type,components:M,offset:w}}),size:br(r,Math.max(u,t)),alignment:t}}function br(n,t){return Math.ceil(n/t)*t}class Ir extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const p=2*t;return this.int16[p+0]=r,this.int16[p+1]=u,t}}Ir.prototype.bytesPerElement=4,ft(Ir,"StructArrayLayout2i4");class Ar extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){const y=3*t;return this.int16[y+0]=r,this.int16[y+1]=u,this.int16[y+2]=p,t}}Ar.prototype.bytesPerElement=6,ft(Ar,"StructArrayLayout3i6");class Mr extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,u,p)}emplace(t,r,u,p,y){const w=4*t;return this.int16[w+0]=r,this.int16[w+1]=u,this.int16[w+2]=p,this.int16[w+3]=y,t}}Mr.prototype.bytesPerElement=8,ft(Mr,"StructArrayLayout4i8");class Ts extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w,M){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,u,p,y,w,M)}emplace(t,r,u,p,y,w,M,D){const R=6*t,$=12*t,W=3*t;return this.int16[R+0]=r,this.int16[R+1]=u,this.uint8[$+4]=p,this.uint8[$+5]=y,this.uint8[$+6]=w,this.uint8[$+7]=M,this.float32[W+2]=D,t}}Ts.prototype.bytesPerElement=12,ft(Ts,"StructArrayLayout2i4ub1f12");class Ea extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,u,p)}emplace(t,r,u,p,y){const w=4*t;return this.float32[w+0]=r,this.float32[w+1]=u,this.float32[w+2]=p,this.float32[w+3]=y,t}}Ea.prototype.bytesPerElement=16,ft(Ea,"StructArrayLayout4f16");class Ws extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,y)}emplace(t,r,u,p,y,w){const M=6*t,D=3*t;return this.uint16[M+0]=r,this.uint16[M+1]=u,this.uint16[M+2]=p,this.uint16[M+3]=y,this.float32[D+2]=w,t}}Ws.prototype.bytesPerElement=12,ft(Ws,"StructArrayLayout4ui1f12");class xo extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,u,p)}emplace(t,r,u,p,y){const w=4*t;return this.uint16[w+0]=r,this.uint16[w+1]=u,this.uint16[w+2]=p,this.uint16[w+3]=y,t}}xo.prototype.bytesPerElement=8,ft(xo,"StructArrayLayout4ui8");class er extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,u,p,y,w)}emplace(t,r,u,p,y,w,M){const D=6*t;return this.int16[D+0]=r,this.int16[D+1]=u,this.int16[D+2]=p,this.int16[D+3]=y,this.int16[D+4]=w,this.int16[D+5]=M,t}}er.prototype.bytesPerElement=12,ft(er,"StructArrayLayout6i12");class Or extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w,M,D,R,$,W,J){const oe=this.length;return this.resize(oe+1),this.emplace(oe,t,r,u,p,y,w,M,D,R,$,W,J)}emplace(t,r,u,p,y,w,M,D,R,$,W,J,oe){const ue=12*t;return this.int16[ue+0]=r,this.int16[ue+1]=u,this.int16[ue+2]=p,this.int16[ue+3]=y,this.uint16[ue+4]=w,this.uint16[ue+5]=M,this.uint16[ue+6]=D,this.uint16[ue+7]=R,this.int16[ue+8]=$,this.int16[ue+9]=W,this.int16[ue+10]=J,this.int16[ue+11]=oe,t}}Or.prototype.bytesPerElement=24,ft(Or,"StructArrayLayout4i4ui4i24");class _r extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,u,p,y,w)}emplace(t,r,u,p,y,w,M){const D=10*t,R=5*t;return this.int16[D+0]=r,this.int16[D+1]=u,this.int16[D+2]=p,this.float32[R+2]=y,this.float32[R+3]=w,this.float32[R+4]=M,t}}_r.prototype.bytesPerElement=20,ft(_r,"StructArrayLayout3i3f20");class Do extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Do.prototype.bytesPerElement=4,ft(Do,"StructArrayLayout1ul4");class ss extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w,M,D,R,$,W,J,oe){const ue=this.length;return this.resize(ue+1),this.emplace(ue,t,r,u,p,y,w,M,D,R,$,W,J,oe)}emplace(t,r,u,p,y,w,M,D,R,$,W,J,oe,ue){const ye=20*t,ke=10*t;return this.int16[ye+0]=r,this.int16[ye+1]=u,this.int16[ye+2]=p,this.int16[ye+3]=y,this.int16[ye+4]=w,this.float32[ke+3]=M,this.float32[ke+4]=D,this.float32[ke+5]=R,this.float32[ke+6]=$,this.int16[ye+14]=W,this.uint32[ke+8]=J,this.uint16[ye+18]=oe,this.uint16[ye+19]=ue,t}}ss.prototype.bytesPerElement=40,ft(ss,"StructArrayLayout5i4f1i1ul2ui40");class Kr extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w,M){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,u,p,y,w,M)}emplace(t,r,u,p,y,w,M,D){const R=8*t;return this.int16[R+0]=r,this.int16[R+1]=u,this.int16[R+2]=p,this.int16[R+4]=y,this.int16[R+5]=w,this.int16[R+6]=M,this.int16[R+7]=D,t}}Kr.prototype.bytesPerElement=16,ft(Kr,"StructArrayLayout3i2i2i16");class Ds extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,y)}emplace(t,r,u,p,y,w){const M=4*t,D=8*t;return this.float32[M+0]=r,this.float32[M+1]=u,this.float32[M+2]=p,this.int16[D+6]=y,this.int16[D+7]=w,t}}Ds.prototype.bytesPerElement=16,ft(Ds,"StructArrayLayout2f1f2i16");class _h extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,u,p)}emplace(t,r,u,p,y){const w=12*t,M=3*t;return this.uint8[w+0]=r,this.uint8[w+1]=u,this.float32[M+1]=p,this.float32[M+2]=y,t}}_h.prototype.bytesPerElement=12,ft(_h,"StructArrayLayout2ub2f12");class $a extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){const y=3*t;return this.float32[y+0]=r,this.float32[y+1]=u,this.float32[y+2]=p,t}}$a.prototype.bytesPerElement=12,ft($a,"StructArrayLayout3f12");class Es extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){const y=3*t;return this.uint16[y+0]=r,this.uint16[y+1]=u,this.uint16[y+2]=p,t}}Es.prototype.bytesPerElement=6,ft(Es,"StructArrayLayout3ui6");class Sa extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke,Ke,ct,Xe,nt,pt){const ht=this.length;return this.resize(ht+1),this.emplace(ht,t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke,Ke,ct,Xe,nt,pt)}emplace(t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke,Ke,ct,Xe,nt,pt,ht){const Vt=30*t,Lt=15*t,ni=60*t;return this.int16[Vt+0]=r,this.int16[Vt+1]=u,this.int16[Vt+2]=p,this.float32[Lt+2]=y,this.float32[Lt+3]=w,this.uint16[Vt+8]=M,this.uint16[Vt+9]=D,this.uint32[Lt+5]=R,this.uint32[Lt+6]=$,this.uint32[Lt+7]=W,this.uint16[Vt+16]=J,this.uint16[Vt+17]=oe,this.uint16[Vt+18]=ue,this.float32[Lt+10]=ye,this.float32[Lt+11]=ke,this.uint8[ni+48]=Ke,this.uint8[ni+49]=ct,this.uint8[ni+50]=Xe,this.uint32[Lt+13]=nt,this.int16[Vt+28]=pt,this.uint8[ni+58]=ht,t}}Sa.prototype.bytesPerElement=60,ft(Sa,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ml extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke,Ke,ct,Xe,nt,pt,ht,Vt,Lt,ni,wi,Ht,si,ui,mi){const Ei=this.length;return this.resize(Ei+1),this.emplace(Ei,t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke,Ke,ct,Xe,nt,pt,ht,Vt,Lt,ni,wi,Ht,si,ui,mi)}emplace(t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke,Ke,ct,Xe,nt,pt,ht,Vt,Lt,ni,wi,Ht,si,ui,mi,Ei){const Kt=38*t,Bi=19*t;return this.int16[Kt+0]=r,this.int16[Kt+1]=u,this.int16[Kt+2]=p,this.float32[Bi+2]=y,this.float32[Bi+3]=w,this.int16[Kt+8]=M,this.int16[Kt+9]=D,this.int16[Kt+10]=R,this.int16[Kt+11]=$,this.int16[Kt+12]=W,this.int16[Kt+13]=J,this.uint16[Kt+14]=oe,this.uint16[Kt+15]=ue,this.uint16[Kt+16]=ye,this.uint16[Kt+17]=ke,this.uint16[Kt+18]=Ke,this.uint16[Kt+19]=ct,this.uint16[Kt+20]=Xe,this.uint16[Kt+21]=nt,this.uint16[Kt+22]=pt,this.uint16[Kt+23]=ht,this.uint16[Kt+24]=Vt,this.uint16[Kt+25]=Lt,this.uint16[Kt+26]=ni,this.uint16[Kt+27]=wi,this.uint16[Kt+28]=Ht,this.uint32[Bi+15]=si,this.float32[Bi+16]=ui,this.float32[Bi+17]=mi,this.float32[Bi+18]=Ei,t}}ml.prototype.bytesPerElement=76,ft(ml,"StructArrayLayout3i2f6i15ui1ul3f76");class Ol extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Ol.prototype.bytesPerElement=4,ft(Ol,"StructArrayLayout1f4");class ju extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,y)}emplace(t,r,u,p,y,w){const M=5*t;return this.float32[M+0]=r,this.float32[M+1]=u,this.float32[M+2]=p,this.float32[M+3]=y,this.float32[M+4]=w,t}}ju.prototype.bytesPerElement=20,ft(ju,"StructArrayLayout5f20");class Gu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,u,p)}emplace(t,r,u,p,y){const w=6*t;return this.uint32[3*t+0]=r,this.uint16[w+2]=u,this.uint16[w+3]=p,this.uint16[w+4]=y,t}}Gu.prototype.bytesPerElement=12,ft(Gu,"StructArrayLayout1ul3ui12");class ja extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const p=2*t;return this.uint16[p+0]=r,this.uint16[p+1]=u,t}}ja.prototype.bytesPerElement=4,ft(ja,"StructArrayLayout2ui4");class qu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}qu.prototype.bytesPerElement=2,ft(qu,"StructArrayLayout1ui2");class fa extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const p=2*t;return this.float32[p+0]=r,this.float32[p+1]=u,t}}fa.prototype.bytesPerElement=8,ft(fa,"StructArrayLayout2f8");class Ym extends Nn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ym.prototype.size=40;class Jm extends ss{get(t){return new Ym(this,t)}}ft(Jm,"CollisionBoxArray");class P_ extends Nn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}P_.prototype.size=60;class z_ extends Sa{get(t){return new P_(this,t)}}ft(z_,"PlacedSymbolArray");class Bf extends Nn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Bf.prototype.size=76;class Rf extends ml{get(t){return new Bf(this,t)}}ft(Rf,"SymbolInstanceArray");class Qm extends Ol{getoffsetX(t){return this.float32[1*t+0]}}ft(Qm,"GlyphOffsetArray");class yh extends Ir{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}ft(yh,"SymbolLineVertexArray");class jd extends Nn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}jd.prototype.size=12;class D_ extends Gu{get(t){return new jd(this,t)}}ft(D_,"FeatureIndexArray");class L_ extends ja{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}ft(L_,"FillExtrusionCentroidArray");const Jv=Yi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Qv=Yi([{name:"a_dash",components:4,type:"Uint16"}]);var Gd={exports:{}},B_={exports:{}};B_.exports=function(n,t){var r,u,p,y,w,M,D,R;for(u=n.length-(r=3&n.length),p=t,w=3432918353,M=461845907,R=0;R<u;)D=255&n.charCodeAt(R)|(255&n.charCodeAt(++R))<<8|(255&n.charCodeAt(++R))<<16|(255&n.charCodeAt(++R))<<24,++R,p=27492+(65535&(y=5*(65535&(p=(p^=D=(65535&(D=(D=(65535&D)*w+(((D>>>16)*w&65535)<<16)&4294967295)<<15|D>>>17))*M+(((D>>>16)*M&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,r){case 3:D^=(255&n.charCodeAt(R+2))<<16;case 2:D^=(255&n.charCodeAt(R+1))<<8;case 1:p^=D=(65535&(D=(D=(65535&(D^=255&n.charCodeAt(R)))*w+(((D>>>16)*w&65535)<<16)&4294967295)<<15|D>>>17))*M+(((D>>>16)*M&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var R_={exports:{}};R_.exports=function(n,t){for(var r,u=n.length,p=t^u,y=0;u>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(y)|(255&n.charCodeAt(++y))<<8|(255&n.charCodeAt(++y))<<16|(255&n.charCodeAt(++y))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:p^=(255&n.charCodeAt(y+2))<<16;case 2:p^=(255&n.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Vp=B_.exports,e0=R_.exports;Gd.exports=Vp,Gd.exports.murmur3=Vp,Gd.exports.murmur2=e0;class Zu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,u,p){this.ids.push(O_(t)),this.positions.push(r,u,p)}getPositions(t){const r=O_(t);let u=0,p=this.ids.length-1;for(;u<p;){const w=u+p>>1;this.ids[w]>=r?p=w:u=w+1}const y=[];for(;this.ids[u]===r;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(t,r){const u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Lo(u,p,0,u.length-1),r&&r.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(t){const r=new Zu;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function O_(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Gd.exports(String(n))}function Lo(n,t,r,u){for(;r<u;){const p=n[r+u>>1];let y=r-1,w=u+1;for(;;){do y++;while(n[y]<p);do w--;while(n[w]>p);if(y>=w)break;td(n,y,w),td(t,3*y,3*w),td(t,3*y+1,3*w+1),td(t,3*y+2,3*w+2)}w-r<u-w?(Lo(n,t,r,w),r=w+1):(Lo(n,t,w+1,u),u=w)}}function td(n,t,r){const u=n[t];n[t]=n[r],n[r]=u}ft(Zu,"FeaturePositionMap");class Kc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}}class id extends Kc{constructor(t){super(t),this.current=0}set(t,r,u){this.fetchUniformLocation(t,r)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Of extends Kc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,u){this.fetchUniformLocation(t,r)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class qd extends Kc{constructor(t){super(t),this.current=ho.transparent}set(t,r,u){this.fetchUniformLocation(t,r)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const F_=new Float32Array(16),V_=new Float32Array(9),Ff=new Float32Array(4);function Vf(n){return[rn(255*n.r,255*n.g),rn(255*n.b,255*n.a)]}class nd{constructor(t,r,u){this.value=t,this.uniformNames=r.map(p=>`u_${p}`),this.type=u}setUniform(t,r,u,p,y){r.set(t,y,p.constantOr(this.value))}getBinding(t,r){return this.type==="color"?new qd(t):new id(t)}}class Zd{constructor(t,r){this.uniformNames=r.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,u,p,y){const w=y==="u_pattern"||y==="u_dash"?this.pattern:y==="u_pixel_ratio"?this.pixelRatio:null;w&&r.set(t,y,w)}getBinding(t,r){return r==="u_pattern"||r==="u_dash"?new Of(t):new id(t)}}class Yc{constructor(t,r,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,u,p,y,w){const M=this.paintVertexArray.length,D=this.expression.evaluate(new Et(0),r,{},y,p,w);this.paintVertexArray.resize(t),this._setPaintValue(M,t,D)}updatePaintArray(t,r,u,p,y){const w=this.expression.evaluate({zoom:0},u,p,void 0,y);this._setPaintValue(t,r,w)}_setPaintValue(t,r,u){if(this.type==="color"){const p=Vf(u);for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ca{constructor(t,r,u,p,y,w){this.expression=t,this.uniformNames=r.map(M=>`u_${M}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=r.map(M=>({name:`a_${M}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(t,r,u,p,y,w){const M=this.expression.evaluate(new Et(this.zoom),r,{},y,p,w),D=this.expression.evaluate(new Et(this.zoom+1),r,{},y,p,w),R=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(R,t,M,D)}updatePaintArray(t,r,u,p,y){const w=this.expression.evaluate({zoom:this.zoom},u,p,void 0,y),M=this.expression.evaluate({zoom:this.zoom+1},u,p,void 0,y);this._setPaintValue(t,r,w,M)}_setPaintValue(t,r,u,p){if(this.type==="color"){const y=Vf(u),w=Vf(p);for(let M=t;M<r;M++)this.paintVertexArray.emplace(M,y[0],y[1],w[0],w[1])}else{for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,u,p,y){const w=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,M=Wt(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);r.set(t,y,M)}getBinding(t,r){return new id(t)}}class vh{constructor(t,r,u,p,y){this.expression=t,this.layerId=y,this.paintVertexAttributes=(u==="array"?Qv:Jv).members;for(let w=0;w<r.length;++w);this.paintVertexArray=new p}populatePaintArray(t,r,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(p,t,r.patterns&&r.patterns[this.layerId],u)}updatePaintArray(t,r,u,p,y,w){this._setPaintValues(t,r,u.patterns&&u.patterns[this.layerId],w)}_setPaintValues(t,r,u,p){if(!p||!u)return;const y=p[u];if(!y)return;const{tl:w,br:M,pixelRatio:D}=y;for(let R=t;R<r;R++)this.paintVertexArray.emplace(R,w[0],w[1],M[0],M[1],D)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jc{constructor(t,r,u=()=>!0){this.binders={},this._buffers=[];const p=[];for(const y in t.paint._values){if(!u(y))continue;const w=t.paint.get(y);if(!(w instanceof ai&&hl(w.property.specification)))continue;const M=tg(y,t.type),D=w.value,R=w.property.specification.type,$=w.property.useIntegerZoom,W=y==="line-dasharray"||y.endsWith("pattern"),J=y==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(D.kind!=="constant"||J)if(D.kind==="source"||J||W){const oe=N_(y,R,"source");this.binders[y]=W?new vh(D,M,R,oe,t.id):new Yc(D,M,R,oe),p.push(`/a_${y}`)}else{const oe=N_(y,R,"composite");this.binders[y]=new Ca(D,M,R,$,r,oe),p.push(`/z_${y}`)}else this.binders[y]=W?new Zd(D.value,M):new nd(D.value,M,R),p.push(`/u_${y}`)}this.cacheKey=p.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Yc||r instanceof Ca?r.maxValue:0}populatePaintArrays(t,r,u,p,y,w){for(const M in this.binders){const D=this.binders[M];(D instanceof Yc||D instanceof Ca||D instanceof vh)&&D.populatePaintArray(t,r,u,p,y,w)}}setConstantPatternPositions(t){for(const r in this.binders){const u=this.binders[r];u instanceof Zd&&u.setConstantPatternPositions(t)}}updatePaintArrays(t,r,u,p,y,w){let M=!1;for(const D in t){const R=r.getPositions(D);for(const $ of R){const W=u.feature($.index);for(const J in this.binders){const oe=this.binders[J];if((oe instanceof Yc||oe instanceof Ca||oe instanceof vh)&&oe.expression.isStateDependent===!0){const ue=p.paint.get(J);oe.expression=ue.value,oe.updatePaintArray($.start,$.end,W,t[D],y,w),M=!0}}}}return M}defines(){const t=[];for(const r in this.binders){const u=this.binders[r];(u instanceof nd||u instanceof Zd)&&t.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof Yc||u instanceof Ca||u instanceof vh)for(let p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof nd||u instanceof Zd||u instanceof Ca)for(const p of u.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof nd||p instanceof Zd||p instanceof Ca)for(const y of p.uniformNames)r.push({name:y,property:u,binding:p.getBinding(t,y)})}return r}setUniforms(t,r,u,p,y){for(const{name:w,property:M,binding:D}of u)this.binders[M].setUniform(t,D,y,p.get(M),w)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Yc||r instanceof Ca||r instanceof vh)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const u=this.binders[r];(u instanceof Yc||u instanceof Ca||u instanceof vh)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Yc||r instanceof Ca||r instanceof vh)&&r.destroy()}}}class rd{constructor(t,r,u=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Jc(p,r,u);this.needsUpload=!1,this._featureMap=new Zu,this._bufferOffset=0}populatePaintArrays(t,r,u,p,y,w,M){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(t,r,p,y,w,M);r.id!==void 0&&this._featureMap.add(r.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,u,p,y){for(const w of u)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,r,w,p,y)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const eg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function tg(n,t){return eg[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const ig={"line-pattern":{source:Ws,composite:Ws},"fill-pattern":{source:Ws,composite:Ws},"fill-extrusion-pattern":{source:Ws,composite:Ws},"line-dasharray":{source:xo,composite:xo}},t0={color:{source:fa,composite:Ea},number:{source:Ol,composite:fa}};function N_(n,t,r){const u=ig[n];return u&&u[r]||t0[t][r]}ft(nd,"ConstantBinder"),ft(Zd,"PatternConstantBinder"),ft(Yc,"SourceExpressionBinder"),ft(vh,"PatternCompositeBinder"),ft(Ca,"CompositeExpressionBinder"),ft(Jc,"ProgramConfiguration",{omit:["_buffers"]}),ft(rd,"ProgramConfigurationSet");const Np="-transition";class dc extends xn{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Gt(r.layout)),r.paint)){this._transitionablePaint=new ei(r.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ti(r.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,u={}){r!=null&&this._validate(Ge,`layers.${this.id}.layout.${t}`,t,r,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return vr(t,Np)?this._transitionablePaint.getTransition(t.slice(0,-Np.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,u={}){if(r!=null&&this._validate(Qe,`layers.${this.id}.paint.${t}`,t,r,u))return!1;if(vr(t,Np))return this._transitionablePaint.setTransition(t.slice(0,-Np.length),r||void 0),!1;{const p=this._transitionablePaint._values[t],y=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value,D=M.isDataDriven(),R=vr(t,"pattern")||t==="line-dasharray";return D||y||R||this._handleOverridablePaintPropertyUpdate(t,w,M)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,r,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Xr(t,(r,u)=>!(r===void 0||u==="layout"&&!Object.keys(r).length||u==="paint"&&!Object.keys(r).length))}_validate(t,r,u,p,y={}){return(!y||y.validate!==!1)&&_t(this,t.call(Ee,{key:r,layerType:this.type,objectKey:u,value:p,styleSpec:Mt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof ai&&hl(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=gs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const i0=Yi([{name:"a_pos",components:2,type:"Int16"}],4),xh=Yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class as{constructor(t=[]){this.segments=t}prepareSegment(t,r,u,p){let y=this.segments[this.segments.length-1];return t>as.MAX_VERTEX_ARRAY_LENGTH&&at(`Max vertices per segment is ${as.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!y||y.vertexLength+t>as.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:r.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,u,p){return new as([{vertexOffset:t,primitiveOffset:r,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}as.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft(as,"SegmentVector");var In=8192;class gl{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof wr?new wr(t.lng,t.lat):wr.convert(t),this}setSouthWest(t){return this._sw=t instanceof wr?new wr(t.lng,t.lat):wr.convert(t),this}extend(t){const r=this._sw,u=this._ne;let p,y;if(t instanceof wr)p=t,y=t;else{if(!(t instanceof gl))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(gl.convert(t)):this.extend(wr.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&t.hasOwnProperty("lon")?this.extend(wr.convert(t)):this;if(p=t._sw,y=t._ne,!p||!y)return this}return r||u?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new wr(p.lng,p.lat),this._ne=new wr(y.lng,y.lat)),this}getCenter(){return new wr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new wr(this.getWest(),this.getNorth())}getSouthEast(){return new wr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:u}=wr.convert(t);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(t){return!t||t instanceof gl?t:new gl(t)}}const Up=63710088e-1;class wr{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wr(Yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,u=this.lat*r,p=t.lat*r,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*r);return Up*Math.acos(Math.min(y,1))}toBounds(t=0){const r=360*t/40075017,u=r/Math.cos(Math.PI/180*this.lat);return new gl(new wr(this.lng-u,this.lat-r),new wr(this.lng+u,this.lat+r))}static convert(t){if(t instanceof wr)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new wr(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new wr(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const U_=2*Math.PI*Up;function $p(n){return U_*Math.cos(n*Math.PI/180)}function fc(n){return(180+n)/360}function Qc(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Fl(n,t){return n/$p(t)}function _l(n){return 360*n-180}function Ls(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function jp(n,t){return n*$p(Ls(t))}const Ga=85.051129;function Gp(n){return 1/Math.cos(n*Math.PI/180)}class Wd{constructor(t,r,u=0){this.x=+t,this.y=+r,this.z=+u}static fromLngLat(t,r=0){const u=wr.convert(t);return new Wd(fc(u.lng),Qc(u.lat),Fl(r,u.lat))}toLngLat(){return new wr(_l(this.x),Ls(this.y))}toAltitude(){return jp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/U_*Gp(Ls(this.y))}}function ng(n,t,r,u,p,y,w,M,D){const R=(t+u)/2,$=(r+p)/2,W=new Me(R,$);M(W),function(J,oe,ue,ye,ke,Ke){const ct=ue-ke,Xe=ye-Ke;return Math.abs((ye-oe)*ct-(ue-J)*Xe)/Math.hypot(ct,Xe)}(W.x,W.y,y.x,y.y,w.x,w.y)>=D?(ng(n,t,r,R,$,y,W,M,D),ng(n,R,$,u,p,W,w,M,D)):n.push(w)}function $_(n,t,r){let u=n[0],p=u.x,y=u.y;t(u);const w=[u];for(let M=1;M<n.length;M++){const D=n[M],{x:R,y:$}=D;t(D),ng(w,p,y,R,$,u,D,t,r),p=R,y=$,u=D}return w}function od(n,t,r,u){if(u(t,r)){const p=t.add(r)._mult(.5);od(n,t,p,u),od(n,p,r,u)}else n.push(r)}function j_(n,t){let r=n[0];const u=[r];for(let p=1;p<n.length;p++){const y=n[p];od(u,r,y,t),r=y}return u}const rg=Math.pow(2,14)-1,G_=-rg-1;function n0(n,t){const r=Math.round(n.x*t),u=Math.round(n.y*t);return n.x=Wt(r,G_,rg),n.y=Wt(u,G_,rg),(r<n.x||r>n.x+1||u<n.y||u>n.y+1)&&at("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Wu(n,t,r){const u=n.loadGeometry(),p=n.extent,y=In/p;if(t&&r&&r.projection.isReprojectedInTileSpace){const w=1<<t.z,{scale:M,x:D,y:R,projection:$}=r,W=J=>{const oe=_l((t.x+J.x/p)/w),ue=Ls((t.y+J.y/p)/w),ye=$.project(oe,ue);J.x=(ye.x*M-D)*p,J.y=(ye.y*M-R)*p};for(let J=0;J<u.length;J++)if(n.type!==1)u[J]=$_(u[J],W,1);else{const oe=[];for(const ue of u[J])ue.x<0||ue.x>=p||ue.y<0||ue.y>=p||(W(ue),oe.push(ue));u[J]=oe}}for(const w of u)for(const M of w)n0(M,y);return u}function sd(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Wu(n):[]}}function qp(n,t,r,u,p){n.emplaceBack(2*t+(u+1)/2,2*r+(p+1)/2)}function Nf(n,t,r){n.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Uf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Ir,this.indexArray=new Es,this.segments=new as,this.programConfigurations=new rd(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,u,p){const y=this.layers[0],w=[];let M=null;y.type==="circle"&&(M=y.layout.get("circle-sort-key"));for(const{feature:R,id:$,index:W,sourceLayerIndex:J}of t){const oe=this.layers[0]._featureFilter.needGeometry,ue=sd(R,oe);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),ue,u))continue;const ye=M?M.evaluate(ue,{},u):void 0,ke={id:$,properties:R.properties,type:R.type,sourceLayerIndex:J,index:W,geometry:oe?ue.geometry:Wu(R,u,p),patterns:{},sortKey:ye};w.push(ke)}M&&w.sort((R,$)=>R.sortKey-$.sortKey);let D=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new er,D=p.projection);for(const R of w){const{geometry:$,index:W,sourceLayerIndex:J}=R,oe=t[W].feature;this.addFeature(R,$,W,r.availableImages,u,D),r.featureIndex.insert(oe,$,W,J,this.index)}}update(t,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,i0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,xh.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,u,p,y,w){for(const M of r)for(const D of M){const R=D.x,$=D.y;if(R<0||R>=In||$<0||$>=In)continue;if(w){const oe=w.projectTilePoint(R,$,y),ue=w.upVector(y,R,$),ye=this.globeExtVertexArray;Nf(ye,oe,ue),Nf(ye,oe,ue),Nf(ye,oe,ue),Nf(ye,oe,ue)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),J=W.vertexLength;qp(this.layoutVertexArray,R,$,-1,-1),qp(this.layoutVertexArray,R,$,1,-1),qp(this.layoutVertexArray,R,$,1,1),qp(this.layoutVertexArray,R,$,-1,1),this.indexArray.emplaceBack(J,J+1,J+2),this.indexArray.emplaceBack(J,J+2,J+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p,y)}}function q_(n,t){for(let r=0;r<n.length;r++)if(ad(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(ad(n,t[r]))return!0;return!!sg(n,t)}function Z_(n,t,r){return!!ad(n,t)||!!ag(t,n,r)}function og(n,t){if(n.length===1)return X_(t,n[0]);for(let r=0;r<t.length;r++){const u=t[r];for(let p=0;p<u.length;p++)if(ad(n,u[p]))return!0}for(let r=0;r<n.length;r++)if(X_(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(sg(n,t[r]))return!0;return!1}function W_(n,t,r){if(n.length>1){if(sg(n,t))return!0;for(let u=0;u<t.length;u++)if(ag(t[u],n,r))return!0}for(let u=0;u<n.length;u++)if(ag(n[u],t,r))return!0;return!1}function sg(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const u=n[r],p=n[r+1];for(let y=0;y<t.length-1;y++)if(r0(u,p,t[y],t[y+1]))return!0}return!1}function r0(n,t,r,u){return bt(n,r,u)!==bt(t,r,u)&&bt(n,t,r)!==bt(n,t,u)}function ag(n,t,r){const u=r*r;if(t.length===1)return n.distSqr(t[0])<u;for(let p=1;p<t.length;p++)if(lg(n,t[p-1],t[p])<u)return!0;return!1}function lg(n,t,r){const u=t.distSqr(r);if(u===0)return n.distSqr(t);const p=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/u;return n.distSqr(p<0?t:p>1?r:r.sub(t)._mult(p)._add(t))}function X_(n,t){let r,u,p,y=!1;for(let w=0;w<n.length;w++){r=n[w];for(let M=0,D=r.length-1;M<r.length;D=M++)u=r[M],p=r[D],u.y>t.y!=p.y>t.y&&t.x<(p.x-u.x)*(t.y-u.y)/(p.y-u.y)+u.x&&(y=!y)}return y}function ad(n,t){let r=!1;for(let u=0,p=n.length-1;u<n.length;p=u++){const y=n[u],w=n[p];y.y>t.y!=w.y>t.y&&t.x<(w.x-y.x)*(t.y-y.y)/(w.y-y.y)+y.x&&(r=!r)}return r}function Xd(n,t,r,u,p){for(const w of n)if(t<=w.x&&r<=w.y&&u>=w.x&&p>=w.y)return!0;const y=[new Me(t,r),new Me(t,p),new Me(u,p),new Me(u,r)];if(n.length>2){for(const w of y)if(ad(n,w))return!0}for(let w=0;w<n.length-1;w++)if(Ss(n[w],n[w+1],y))return!0;return!1}function Ss(n,t,r){const u=r[0],p=r[2];if(n.x<u.x&&t.x<u.x||n.x>p.x&&t.x>p.x||n.y<u.y&&t.y<u.y||n.y>p.y&&t.y>p.y)return!1;const y=bt(n,t,r[0]);return y!==bt(n,t,r[1])||y!==bt(n,t,r[2])||y!==bt(n,t,r[3])}function bh(n,t,r){const u=t.paint.get(n).value;return u.kind==="constant"?u.value:r.programConfigurations.get(t.id).getMaxValue(n)}function $f(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function cg(n,t,r,u,p){if(!t[0]&&!t[1])return n;const y=Me.convert(t)._mult(p);r==="viewport"&&y._rotate(-u);const w=[];for(let M=0;M<n.length;M++)w.push(n[M].sub(y));return w}function Gr(n,t,r,u){const p=Me.convert(n)._mult(u);return t==="viewport"&&p._rotate(-r),p}ft(Uf,"CircleBucket",{omit:["layers"]});const wh=new vn({"circle-sort-key":new Zt(Mt.layout_circle["circle-sort-key"])});var ug={paint:new vn({"circle-radius":new Zt(Mt.paint_circle["circle-radius"]),"circle-color":new Zt(Mt.paint_circle["circle-color"]),"circle-blur":new Zt(Mt.paint_circle["circle-blur"]),"circle-opacity":new Zt(Mt.paint_circle["circle-opacity"]),"circle-translate":new St(Mt.paint_circle["circle-translate"]),"circle-translate-anchor":new St(Mt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new St(Mt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new St(Mt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Zt(Mt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Zt(Mt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Zt(Mt.paint_circle["circle-stroke-opacity"])}),layout:wh},jf=1e-6,Ia=typeof Float32Array<"u"?Float32Array:Array;function eu(){var n=new Ia(9);return Ia!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ld(n,t,r){var u=t[0],p=t[1],y=t[2],w=t[3],M=t[4],D=t[5],R=t[6],$=t[7],W=t[8],J=r[0],oe=r[1],ue=r[2],ye=r[3],ke=r[4],Ke=r[5],ct=r[6],Xe=r[7],nt=r[8];return n[0]=J*u+oe*w+ue*R,n[1]=J*p+oe*M+ue*$,n[2]=J*y+oe*D+ue*W,n[3]=ye*u+ke*w+Ke*R,n[4]=ye*p+ke*M+Ke*$,n[5]=ye*y+ke*D+Ke*W,n[6]=ct*u+Xe*w+nt*R,n[7]=ct*p+Xe*M+nt*$,n[8]=ct*y+Xe*D+nt*W,n}function Vl(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function hg(n,t){var r=t[0],u=t[1],p=t[2],y=t[3],w=t[4],M=t[5],D=t[6],R=t[7],$=t[8],W=t[9],J=t[10],oe=t[11],ue=t[12],ye=t[13],ke=t[14],Ke=t[15],ct=r*M-u*w,Xe=r*D-p*w,nt=r*R-y*w,pt=u*D-p*M,ht=u*R-y*M,Vt=p*R-y*D,Lt=$*ye-W*ue,ni=$*ke-J*ue,wi=$*Ke-oe*ue,Ht=W*ke-J*ye,si=W*Ke-oe*ye,ui=J*Ke-oe*ke,mi=ct*ui-Xe*si+nt*Ht+pt*wi-ht*ni+Vt*Lt;return mi?(n[0]=(M*ui-D*si+R*Ht)*(mi=1/mi),n[1]=(p*si-u*ui-y*Ht)*mi,n[2]=(ye*Vt-ke*ht+Ke*pt)*mi,n[3]=(J*ht-W*Vt-oe*pt)*mi,n[4]=(D*wi-w*ui-R*ni)*mi,n[5]=(r*ui-p*wi+y*ni)*mi,n[6]=(ke*nt-ue*Vt-Ke*Xe)*mi,n[7]=($*Vt-J*nt+oe*Xe)*mi,n[8]=(w*si-M*wi+R*Lt)*mi,n[9]=(u*wi-r*si-y*Lt)*mi,n[10]=(ue*ht-ye*nt+Ke*ct)*mi,n[11]=(W*nt-$*ht-oe*ct)*mi,n[12]=(M*ni-w*Ht-D*Lt)*mi,n[13]=(r*Ht-u*ni+p*Lt)*mi,n[14]=(ye*Xe-ue*pt-ke*ct)*mi,n[15]=($*pt-W*Xe+J*ct)*mi,n):null}function cd(n,t,r){var u=t[0],p=t[1],y=t[2],w=t[3],M=t[4],D=t[5],R=t[6],$=t[7],W=t[8],J=t[9],oe=t[10],ue=t[11],ye=t[12],ke=t[13],Ke=t[14],ct=t[15],Xe=r[0],nt=r[1],pt=r[2],ht=r[3];return n[0]=Xe*u+nt*M+pt*W+ht*ye,n[1]=Xe*p+nt*D+pt*J+ht*ke,n[2]=Xe*y+nt*R+pt*oe+ht*Ke,n[3]=Xe*w+nt*$+pt*ue+ht*ct,n[4]=(Xe=r[4])*u+(nt=r[5])*M+(pt=r[6])*W+(ht=r[7])*ye,n[5]=Xe*p+nt*D+pt*J+ht*ke,n[6]=Xe*y+nt*R+pt*oe+ht*Ke,n[7]=Xe*w+nt*$+pt*ue+ht*ct,n[8]=(Xe=r[8])*u+(nt=r[9])*M+(pt=r[10])*W+(ht=r[11])*ye,n[9]=Xe*p+nt*D+pt*J+ht*ke,n[10]=Xe*y+nt*R+pt*oe+ht*Ke,n[11]=Xe*w+nt*$+pt*ue+ht*ct,n[12]=(Xe=r[12])*u+(nt=r[13])*M+(pt=r[14])*W+(ht=r[15])*ye,n[13]=Xe*p+nt*D+pt*J+ht*ke,n[14]=Xe*y+nt*R+pt*oe+ht*Ke,n[15]=Xe*w+nt*$+pt*ue+ht*ct,n}function Gf(n,t,r){var u,p,y,w,M,D,R,$,W,J,oe,ue,ye=r[0],ke=r[1],Ke=r[2];return t===n?(n[12]=t[0]*ye+t[4]*ke+t[8]*Ke+t[12],n[13]=t[1]*ye+t[5]*ke+t[9]*Ke+t[13],n[14]=t[2]*ye+t[6]*ke+t[10]*Ke+t[14],n[15]=t[3]*ye+t[7]*ke+t[11]*Ke+t[15]):(p=t[1],y=t[2],w=t[3],M=t[4],D=t[5],R=t[6],$=t[7],W=t[8],J=t[9],oe=t[10],ue=t[11],n[0]=u=t[0],n[1]=p,n[2]=y,n[3]=w,n[4]=M,n[5]=D,n[6]=R,n[7]=$,n[8]=W,n[9]=J,n[10]=oe,n[11]=ue,n[12]=u*ye+M*ke+W*Ke+t[12],n[13]=p*ye+D*ke+J*Ke+t[13],n[14]=y*ye+R*ke+oe*Ke+t[14],n[15]=w*ye+$*ke+ue*Ke+t[15]),n}function ud(n,t,r){var u=r[0],p=r[1],y=r[2];return n[0]=t[0]*u,n[1]=t[1]*u,n[2]=t[2]*u,n[3]=t[3]*u,n[4]=t[4]*p,n[5]=t[5]*p,n[6]=t[6]*p,n[7]=t[7]*p,n[8]=t[8]*y,n[9]=t[9]*y,n[10]=t[10]*y,n[11]=t[11]*y,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function dg(n,t,r){var u=Math.sin(r),p=Math.cos(r),y=t[4],w=t[5],M=t[6],D=t[7],R=t[8],$=t[9],W=t[10],J=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=y*p+R*u,n[5]=w*p+$*u,n[6]=M*p+W*u,n[7]=D*p+J*u,n[8]=R*p-y*u,n[9]=$*p-w*u,n[10]=W*p-M*u,n[11]=J*p-D*u,n}function Zp(n,t,r){var u=Math.sin(r),p=Math.cos(r),y=t[0],w=t[1],M=t[2],D=t[3],R=t[8],$=t[9],W=t[10],J=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=y*p-R*u,n[1]=w*p-$*u,n[2]=M*p-W*u,n[3]=D*p-J*u,n[8]=y*u+R*p,n[9]=w*u+$*p,n[10]=M*u+W*p,n[11]=D*u+J*p,n}function H_(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function K_(n,t,r){var u,p,y,w=r[0],M=r[1],D=r[2],R=Math.hypot(w,M,D);return R<jf?null:(w*=R=1/R,M*=R,D*=R,u=Math.sin(t),p=Math.cos(t),n[0]=w*w*(y=1-p)+p,n[1]=M*w*y+D*u,n[2]=D*w*y-M*u,n[3]=0,n[4]=w*M*y-D*u,n[5]=M*M*y+p,n[6]=D*M*y+w*u,n[7]=0,n[8]=w*D*y+M*u,n[9]=M*D*y-w*u,n[10]=D*D*y+p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var o0=cd;function Hd(){var n=new Ia(3);return Ia!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function hd(n){var t=new Ia(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Kd(n){return Math.hypot(n[0],n[1],n[2])}function Yd(n,t,r){var u=new Ia(3);return u[0]=n,u[1]=t,u[2]=r,u}function Xu(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function fg(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n}function pg(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n}function dd(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n}function Jd(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n}function pa(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function Hu(n,t,r,u){return n[0]=t[0]+r[0]*u,n[1]=t[1]+r[1]*u,n[2]=t[2]+r[2]*u,n}function hs(n,t){var r=t[0],u=t[1],p=t[2],y=r*r+u*u+p*p;return y>0&&(y=1/Math.sqrt(y)),n[0]=t[0]*y,n[1]=t[1]*y,n[2]=t[2]*y,n}function Aa(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Qd(n,t,r){var u=t[0],p=t[1],y=t[2],w=r[0],M=r[1],D=r[2];return n[0]=p*D-y*M,n[1]=y*w-u*D,n[2]=u*M-p*w,n}function Uo(n,t,r){var u=t[0],p=t[1],y=t[2],w=r[3]*u+r[7]*p+r[11]*y+r[15];return n[0]=(r[0]*u+r[4]*p+r[8]*y+r[12])/(w=w||1),n[1]=(r[1]*u+r[5]*p+r[9]*y+r[13])/w,n[2]=(r[2]*u+r[6]*p+r[10]*y+r[14])/w,n}function mg(n,t,r){var u=r[0],p=r[1],y=r[2],w=t[0],M=t[1],D=t[2],R=p*D-y*M,$=y*w-u*D,W=u*M-p*w,J=p*W-y*$,oe=y*R-u*W,ue=u*$-p*R,ye=2*r[3];return $*=ye,W*=ye,oe*=2,ue*=2,n[0]=w+(R*=ye)+(J*=2),n[1]=M+$+oe,n[2]=D+W+ue,n}var ef,pc=fg,Y_=pg,J_=Kd;function Wp(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n}function Xp(n,t){var r=t[0],u=t[1],p=t[2],y=t[3],w=r*r+u*u+p*p+y*y;return w>0&&(w=1/Math.sqrt(w)),n[0]=r*w,n[1]=u*w,n[2]=p*w,n[3]=y*w,n}function fd(n,t,r){var u=t[0],p=t[1],y=t[2],w=t[3];return n[0]=r[0]*u+r[4]*p+r[8]*y+r[12]*w,n[1]=r[1]*u+r[5]*p+r[9]*y+r[13]*w,n[2]=r[2]*u+r[6]*p+r[10]*y+r[14]*w,n[3]=r[3]*u+r[7]*p+r[11]*y+r[15]*w,n}function Q_(){var n=new Ia(4);return Ia!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function gg(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function tu(n,t,r){r*=.5;var u=t[0],p=t[1],y=t[2],w=t[3],M=Math.sin(r),D=Math.cos(r);return n[0]=u*D+w*M,n[1]=p*D+y*M,n[2]=y*D-p*M,n[3]=w*D-u*M,n}function _g(n,t,r){r*=.5;var u=t[0],p=t[1],y=t[2],w=t[3],M=Math.sin(r),D=Math.cos(r);return n[0]=u*D-y*M,n[1]=p*D+w*M,n[2]=y*D+u*M,n[3]=w*D-p*M,n}Hd(),ef=new Ia(4),Ia!=Float32Array&&(ef[0]=0,ef[1]=0,ef[2]=0,ef[3]=0);var Th=Xp;Hd(),Yd(1,0,0),Yd(0,1,0),Q_(),Q_(),eu();class Hp{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,u){const p=Aa(r,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/p;return u[0]=this.pos[0]+this.dir[0]*y,u[1]=this.pos[1]+this.dir[1]*y,u[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(t,r,u){if(function(oe,ue){var ye=oe[0],ke=oe[1],Ke=oe[2],ct=ue[0],Xe=ue[1],nt=ue[2];return Math.abs(ye-ct)<=jf*Math.max(1,Math.abs(ye),Math.abs(ct))&&Math.abs(ke-Xe)<=jf*Math.max(1,Math.abs(ke),Math.abs(Xe))&&Math.abs(Ke-nt)<=jf*Math.max(1,Math.abs(Ke),Math.abs(nt))}(this.pos,t)||r===0)return u[0]=u[1]=u[2]=0,!1;const[p,y,w]=this.dir,M=this.pos[0]-t[0],D=this.pos[1]-t[1],R=this.pos[2]-t[2],$=p*p+y*y+w*w,W=2*(M*p+D*y+R*w),J=W*W-4*$*(M*M+D*D+R*R-r*r);if(J<0){const oe=Math.max(-W/2,0),ue=M+p*oe,ye=D+y*oe,ke=R+w*oe,Ke=Math.hypot(ue,ye,ke);return u[0]=ue*r/Ke,u[1]=ye*r/Ke,u[2]=ke*r/Ke,!1}{const oe=(-W-Math.sqrt(J))/(2*$);if(oe<0){const ue=Math.hypot(M,D,R);return u[0]=M*r/ue,u[1]=D*r/ue,u[2]=R*r/ue,!1}return u[0]=M+p*oe,u[1]=D+y*oe,u[2]=R+w*oe,!0}}}class Kp{constructor(t,r,u,p,y){this.TL=t,this.TR=r,this.BR=u,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(t,r,u){const p=[-1,1,1],y=[1,1,1],w=[1,-1,1],M=[-1,-1,1],D=Uo(p,p,t),R=Uo(y,y,t),$=Uo(w,w,t),W=Uo(M,M,t);return new Kp(D,R,$,W,r/u)}}class Yp{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,u,p){const y=Math.pow(2,u),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const R=fd([],D,t),$=1/R[3]/r*y;return function(W,J,oe){return W[0]=J[0]*oe[0],W[1]=J[1]*oe[1],W[2]=J[2]*oe[2],W[3]=J[3]*oe[3],W}(R,R,[$,$,p?1/R[3]:$,$])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const R=hs([],Qd([],pc([],w[D[0]],w[D[1]]),pc([],w[D[2]],w[D[1]]))),$=-Aa(R,w[D[1]]);return R.concat($)});return new Yp(w,M)}}class Xs{static fromPoints(t){const r=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const p of t)dd(r,r,p),Jd(u,u,p);return new Xs(r,u)}static applyTransform(t,r){const u=t.getCorners();for(let p=0;p<u.length;++p)Uo(u[p],u[p],r);return Xs.fromPoints(u)}constructor(t,r){this.min=t,this.max=r,this.center=pa([],Xu([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],u=hd(this.min),p=hd(this.max);for(let y=0;y<r.length;y++)u[y]=r[y]?this.min[y]:this.center[y],p[y]=r[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Xs(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){const r=this.getCorners();let u=!0;for(let p=0;p<t.planes.length;p++){const y=t.planes[p];let w=0;for(let M=0;M<r.length;M++)w+=Aa(y,r[M])+y[3]>=0;if(w===0)return 0;w!==r.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let M=0;M<t.points.length;M++){const D=t.points[M][p]-this.min[p];y=Math.min(y,D),w=Math.max(w,D)}if(w<0||y>this.max[p]-this.min[p])return 0}return 1}}function ey(n,t,r,u,p,y,w,M,D){if(y&&n.queryGeometry.isAboveHorizon)return!1;y&&(D*=n.pixelToTileUnitsFactor);const R=n.tileID.canonical,$=r.projection.upVectorScale(R,r.center.lat,r.worldSize).metersToTile;for(const W of t)for(const J of W){const oe=J.add(M),ue=p&&r.elevation?r.elevation.exaggeration()*p.getElevationAt(oe.x,oe.y,!0):0,ye=r.projection.projectTilePoint(oe.x,oe.y,R);if(ue>0){const Xe=r.projection.upVector(R,oe.x,oe.y);ye.x+=Xe[0]*$*ue,ye.y+=Xe[1]*$*ue,ye.z+=Xe[2]*$*ue}const ke=y?oe:s0(ye.x,ye.y,ye.z,u),Ke=y?n.tilespaceRays.map(Xe=>iy(Xe,ue)):n.queryGeometry.screenGeometry,ct=fd([],[ye.x,ye.y,ye.z,1],u);if(!w&&y?D*=ct[3]/r.cameraToCenterDistance:w&&!y&&(D*=r.cameraToCenterDistance/ct[3]),y){const Xe=Ls((J.y/In+R.y)/(1<<R.z));D/=r.projection.pixelsPerMeter(Xe,1)/Fl(1,Xe)}if(Z_(Ke,ke,D))return!0}return!1}function s0(n,t,r,u){const p=fd([],[n,t,r,1],u);return new Me(p[0]/p[3],p[1]/p[3])}const yg=Yd(0,0,0),ty=Yd(0,0,1);function iy(n,t){const r=Hd();return yg[2]=t,n.intersectsPlane(yg,ty,r),new Me(r[0],r[1])}class qf extends Uf{}function vg(n,{width:t,height:r},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*r*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(t*r*u);return n.width=t,n.height=r,n.data=p,n}function Zf(n,t,r){const{width:u,height:p}=t;u===n.width&&p===n.height||(tf(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,u),height:Math.min(n.height,p)},r),n.width=u,n.height=p,n.data=t.data)}function tf(n,t,r,u,p,y){if(p.width===0||p.height===0)return t;if(p.width>n.width||p.height>n.height||r.x>n.width-p.width||r.y>n.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||u.x>t.width-p.width||u.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const w=n.data,M=t.data;for(let D=0;D<p.height;D++){const R=((r.y+D)*n.width+r.x)*y,$=((u.y+D)*t.width+u.x)*y;for(let W=0;W<p.width*y;W++)M[$+W]=w[R+W]}return t}ft(qf,"HeatmapBucket",{omit:["layers"]});class Nl{constructor(t,r){vg(this,t,1,r)}resize(t){Zf(this,new Nl(t),1)}clone(){return new Nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,p,y){tf(t,r,u,p,y,1)}}class qa{constructor(t,r){vg(this,t,4,r)}resize(t){Zf(this,new qa(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,p,y){tf(t,r,u,p,y,4)}}ft(Nl,"AlphaImage"),ft(qa,"RGBAImage");var a0={paint:new vn({"heatmap-radius":new Zt(Mt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Zt(Mt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new St(Mt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sn(Mt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new St(Mt.paint_heatmap["heatmap-opacity"])})};function xg(n){const t={},r=n.resolution||256,u=n.clips?n.clips.length:1,p=n.image||new qa({width:r,height:u}),y=(w,M,D)=>{t[n.evaluationKey]=D;const R=n.expression.evaluate(t);p.data[w+M+0]=Math.floor(255*R.r/R.a),p.data[w+M+1]=Math.floor(255*R.g/R.a),p.data[w+M+2]=Math.floor(255*R.b/R.a),p.data[w+M+3]=Math.floor(255*R.a)};if(n.clips)for(let w=0,M=0;w<u;++w,M+=4*r)for(let D=0,R=0;D<r;D++,R+=4){const $=D/(r-1),{start:W,end:J}=n.clips[w];y(M,R,W*(1-$)+J*$)}else for(let w=0,M=0;w<r;w++,M+=4)y(0,M,w/(r-1));return p}var l0={paint:new vn({"hillshade-illumination-direction":new St(Mt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new St(Mt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new St(Mt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new St(Mt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new St(Mt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new St(Mt.paint_hillshade["hillshade-accent-color"])})};const nf=Yi([{name:"a_pos",components:2,type:"Int16"}],4),{members:bg}=nf;var rf={exports:{}};function of(n,t,r){r=r||2;var u,p,y,w,M,D,R,$=t&&t.length,W=$?t[0]*r:n.length,J=ny(n,0,W,r,!0),oe=[];if(!J||J.next===J.prev)return oe;if($&&(J=function(ye,ke,Ke,ct){var Xe,nt,pt,ht=[];for(Xe=0,nt=ke.length;Xe<nt;Xe++)(pt=ny(ye,ke[Xe]*ct,Xe<nt-1?ke[Xe+1]*ct:ye.length,ct,!1))===pt.next&&(pt.steiner=!0),ht.push(Tg(pt));for(ht.sort(Jp),Xe=0;Xe<ht.length;Xe++)Ke=wg(ht[Xe],Ke);return Ke}(n,t,J,r)),n.length>80*r){u=y=n[0],p=w=n[1];for(var ue=r;ue<W;ue+=r)(M=n[ue])<u&&(u=M),(D=n[ue+1])<p&&(p=D),M>y&&(y=M),D>w&&(w=D);R=(R=Math.max(y-u,w-p))!==0?32767/R:0}return sf(J,oe,r,u,p,R,0),oe}function ny(n,t,r,u,p){var y,w;if(p===Mo(n,t,r,u)>0)for(y=t;y<r;y+=u)w=sy(y,n[y],n[y+1],w);else for(y=r-u;y>=t;y-=u)w=sy(y,n[y],n[y+1],w);return w&&Xf(w,w.next)&&(Yf(w),w=w.next),w}function Za(n,t){if(!n)return n;t||(t=n);var r,u=n;do if(r=!1,u.steiner||!Xf(u,u.next)&&Bo(u.prev,u,u.next)!==0)u=u.next;else{if(Yf(u),(u=t=u.prev)===u.next)break;r=!0}while(r||u!==t);return t}function sf(n,t,r,u,p,y,w){if(n){!w&&y&&function($,W,J,oe){var ue=$;do ue.z===0&&(ue.z=Wf(ue.x,ue.y,W,J,oe)),ue.prevZ=ue.prev,ue.nextZ=ue.next,ue=ue.next;while(ue!==$);ue.prevZ.nextZ=null,ue.prevZ=null,function(ye){var ke,Ke,ct,Xe,nt,pt,ht,Vt,Lt=1;do{for(Ke=ye,ye=null,nt=null,pt=0;Ke;){for(pt++,ct=Ke,ht=0,ke=0;ke<Lt&&(ht++,ct=ct.nextZ);ke++);for(Vt=Lt;ht>0||Vt>0&&ct;)ht!==0&&(Vt===0||!ct||Ke.z<=ct.z)?(Xe=Ke,Ke=Ke.nextZ,ht--):(Xe=ct,ct=ct.nextZ,Vt--),nt?nt.nextZ=Xe:ye=Xe,Xe.prevZ=nt,nt=Xe;Ke=ct}nt.nextZ=null,Lt*=2}while(pt>1)}(ue)}(n,u,p,y);for(var M,D,R=n;n.prev!==n.next;)if(M=n.prev,D=n.next,y?c0(n,u,p,y):ry(n))t.push(M.i/r|0),t.push(n.i/r|0),t.push(D.i/r|0),Yf(n),n=D.next,R=D.next;else if((n=D)===R){w?w===1?sf(n=u0(Za(n),t,r),t,r,u,p,y,2):w===2&&h0(n,t,r,u,p,y):sf(Za(n),t,r,u,p,y,1);break}}}function ry(n){var t=n.prev,r=n,u=n.next;if(Bo(t,r,u)>=0)return!1;for(var p=t.x,y=r.x,w=u.x,M=t.y,D=r.y,R=u.y,$=p<y?p<w?p:w:y<w?y:w,W=M<D?M<R?M:R:D<R?D:R,J=p>y?p>w?p:w:y>w?y:w,oe=M>D?M>R?M:R:D>R?D:R,ue=u.next;ue!==t;){if(ue.x>=$&&ue.x<=J&&ue.y>=W&&ue.y<=oe&&mc(p,M,y,D,w,R,ue.x,ue.y)&&Bo(ue.prev,ue,ue.next)>=0)return!1;ue=ue.next}return!0}function c0(n,t,r,u){var p=n.prev,y=n,w=n.next;if(Bo(p,y,w)>=0)return!1;for(var M=p.x,D=y.x,R=w.x,$=p.y,W=y.y,J=w.y,oe=M<D?M<R?M:R:D<R?D:R,ue=$<W?$<J?$:J:W<J?W:J,ye=M>D?M>R?M:R:D>R?D:R,ke=$>W?$>J?$:J:W>J?W:J,Ke=Wf(oe,ue,t,r,u),ct=Wf(ye,ke,t,r,u),Xe=n.prevZ,nt=n.nextZ;Xe&&Xe.z>=Ke&&nt&&nt.z<=ct;){if(Xe.x>=oe&&Xe.x<=ye&&Xe.y>=ue&&Xe.y<=ke&&Xe!==p&&Xe!==w&&mc(M,$,D,W,R,J,Xe.x,Xe.y)&&Bo(Xe.prev,Xe,Xe.next)>=0||(Xe=Xe.prevZ,nt.x>=oe&&nt.x<=ye&&nt.y>=ue&&nt.y<=ke&&nt!==p&&nt!==w&&mc(M,$,D,W,R,J,nt.x,nt.y)&&Bo(nt.prev,nt,nt.next)>=0))return!1;nt=nt.nextZ}for(;Xe&&Xe.z>=Ke;){if(Xe.x>=oe&&Xe.x<=ye&&Xe.y>=ue&&Xe.y<=ke&&Xe!==p&&Xe!==w&&mc(M,$,D,W,R,J,Xe.x,Xe.y)&&Bo(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.prevZ}for(;nt&&nt.z<=ct;){if(nt.x>=oe&&nt.x<=ye&&nt.y>=ue&&nt.y<=ke&&nt!==p&&nt!==w&&mc(M,$,D,W,R,J,nt.x,nt.y)&&Bo(nt.prev,nt,nt.next)>=0)return!1;nt=nt.nextZ}return!0}function u0(n,t,r){var u=n;do{var p=u.prev,y=u.next.next;!Xf(p,y)&&Hf(p,u,u.next,y)&&Kf(p,y)&&Kf(y,p)&&(t.push(p.i/r|0),t.push(u.i/r|0),t.push(y.i/r|0),Yf(u),Yf(u.next),u=n=y),u=u.next}while(u!==n);return Za(u)}function h0(n,t,r,u,p,y){var w=n;do{for(var M=w.next.next;M!==w.prev;){if(w.i!==M.i&&f0(w,M)){var D=oy(w,M);return w=Za(w,w.next),D=Za(D,D.next),sf(w,t,r,u,p,y,0),void sf(D,t,r,u,p,y,0)}M=M.next}w=w.next}while(w!==n)}function Jp(n,t){return n.x-t.x}function wg(n,t){var r=function(p,y){var w,M=y,D=p.x,R=p.y,$=-1/0;do{if(R<=M.y&&R>=M.next.y&&M.next.y!==M.y){var W=M.x+(R-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(W<=D&&W>$&&($=W,w=M.x<M.next.x?M:M.next,W===D))return w}M=M.next}while(M!==y);if(!w)return null;var J,oe=w,ue=w.x,ye=w.y,ke=1/0;M=w;do D>=M.x&&M.x>=ue&&D!==M.x&&mc(R<ye?D:$,R,ue,ye,R<ye?$:D,R,M.x,M.y)&&(J=Math.abs(R-M.y)/(D-M.x),Kf(M,p)&&(J<ke||J===ke&&(M.x>w.x||M.x===w.x&&d0(w,M)))&&(w=M,ke=J)),M=M.next;while(M!==oe);return w}(n,t);if(!r)return t;var u=oy(r,n);return Za(u,u.next),Za(r,r.next)}function d0(n,t){return Bo(n.prev,n,t.prev)<0&&Bo(t.next,n,n.next)<0}function Wf(n,t,r,u,p){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Tg(n){var t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function mc(n,t,r,u,p,y,w,M){return(p-w)*(t-M)>=(n-w)*(y-M)&&(n-w)*(u-M)>=(r-w)*(t-M)&&(r-w)*(y-M)>=(p-w)*(u-M)}function f0(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,u){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==u.i&&p.next.i!==u.i&&Hf(p,p.next,r,u))return!0;p=p.next}while(p!==r);return!1}(n,t)&&(Kf(n,t)&&Kf(t,n)&&function(r,u){var p=r,y=!1,w=(r.x+u.x)/2,M=(r.y+u.y)/2;do p.y>M!=p.next.y>M&&p.next.y!==p.y&&w<(p.next.x-p.x)*(M-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==r);return y}(n,t)&&(Bo(n.prev,n,t.prev)||Bo(n,t.prev,t))||Xf(n,t)&&Bo(n.prev,n,n.next)>0&&Bo(t.prev,t,t.next)>0)}function Bo(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function Xf(n,t){return n.x===t.x&&n.y===t.y}function Hf(n,t,r,u){var p=Qp(Bo(n,t,r)),y=Qp(Bo(n,t,u)),w=Qp(Bo(r,u,n)),M=Qp(Bo(r,u,t));return p!==y&&w!==M||!(p!==0||!af(n,r,t))||!(y!==0||!af(n,u,t))||!(w!==0||!af(r,n,u))||!(M!==0||!af(r,t,u))}function af(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Qp(n){return n>0?1:n<0?-1:0}function Kf(n,t){return Bo(n.prev,n,n.next)<0?Bo(n,t,n.next)>=0&&Bo(n,n.prev,t)>=0:Bo(n,t,n.prev)<0||Bo(n,n.next,t)<0}function oy(n,t){var r=new em(n.i,n.x,n.y),u=new em(t.i,t.x,t.y),p=n.next,y=t.prev;return n.next=t,t.prev=n,r.next=p,p.prev=r,u.next=r,r.prev=u,y.next=u,u.prev=y,u}function sy(n,t,r,u){var p=new em(n,t,r);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function Yf(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function em(n,t,r){this.i=n,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mo(n,t,r,u){for(var p=0,y=t,w=r-u;y<r;y+=u)p+=(n[w]-n[y])*(n[y+1]+n[w+1]),w=y;return p}function pd(n,t,r,u,p){Eg(n,t,r||0,u||n.length-1,p||ay)}function Eg(n,t,r,u,p){for(;u>r;){if(u-r>600){var y=u-r+1,w=t-r+1,M=Math.log(y),D=.5*Math.exp(2*M/3),R=.5*Math.sqrt(M*D*(y-D)/y)*(w-y/2<0?-1:1);Eg(n,t,Math.max(r,Math.floor(t-w*D/y+R)),Math.min(u,Math.floor(t+(y-w)*D/y+R)),p)}var $=n[t],W=r,J=u;for(lf(n,r,t),p(n[u],$)>0&&lf(n,r,u);W<J;){for(lf(n,W,J),W++,J--;p(n[W],$)<0;)W++;for(;p(n[J],$)>0;)J--}p(n[r],$)===0?lf(n,r,J):lf(n,++J,u),J<=t&&(r=J+1),t<=J&&(u=J-1)}}function lf(n,t,r){var u=n[t];n[t]=n[r],n[r]=u}function ay(n,t){return n<t?-1:n>t?1:0}function tm(n,t){const r=n.length;if(r<=1)return[n];const u=[];let p,y;for(let w=0;w<r;w++){const M=Ft(n[w]);M!==0&&(n[w].area=Math.abs(M),y===void 0&&(y=M<0),y===M<0?(p&&u.push(p),p=[n[w]]):p.push(n[w]))}if(p&&u.push(p),t>1)for(let w=0;w<u.length;w++)u[w].length<=t||(pd(u[w],t,1,u[w].length-1,ly),u[w]=u[w].slice(0,t));return u}function ly(n,t){return t.area-n.area}function Jf(n,t,r){const u=r.patternDependencies;let p=!1;for(const y of t){const w=y.paint.get(`${n}-pattern`);w.isConstant()||(p=!0);const M=w.constantOr(null);M&&(p=!0,u[M]=!0)}return p}function cf(n,t,r,u,p){const y=p.patternDependencies;for(const w of t){const M=w.paint.get(`${n}-pattern`).value;if(M.kind!=="constant"){let D=M.evaluate({zoom:u},r,{},p.availableImages);D=D&&D.name?D.name:D,y[D]=!0,r.patterns[w.id]=D}}return r}rf.exports=of,rf.exports.default=of,of.deviation=function(n,t,r,u){var p=t&&t.length,y=Math.abs(Mo(n,0,p?t[0]*r:n.length,r));if(p)for(var w=0,M=t.length;w<M;w++)y-=Math.abs(Mo(n,t[w]*r,w<M-1?t[w+1]*r:n.length,r));var D=0;for(w=0;w<u.length;w+=3){var R=u[w]*r,$=u[w+1]*r,W=u[w+2]*r;D+=Math.abs((n[R]-n[W])*(n[$+1]-n[R+1])-(n[R]-n[$])*(n[W+1]-n[R+1]))}return y===0&&D===0?0:Math.abs((D-y)/y)},of.flatten=function(n){for(var t=n[0][0].length,r={vertices:[],holes:[],dimensions:t},u=0,p=0;p<n.length;p++){for(var y=0;y<n[p].length;y++)for(var w=0;w<t;w++)r.vertices.push(n[p][y][w]);p>0&&r.holes.push(u+=n[p-1].length)}return r};class Qf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ir,this.indexArray=new Es,this.indexArray2=new ja,this.programConfigurations=new rd(t.layers,t.zoom),this.segments=new as,this.segments2=new as,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}populate(t,r,u,p){this.hasPattern=Jf("fill",this.layers,r);const y=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:M,id:D,index:R,sourceLayerIndex:$}of t){const W=this.layers[0]._featureFilter.needGeometry,J=sd(M,W);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),J,u))continue;const oe=y?y.evaluate(J,{},u,r.availableImages):void 0,ue={id:D,properties:M.properties,type:M.type,sourceLayerIndex:$,index:R,geometry:W?J.geometry:Wu(M,u,p),patterns:{},sortKey:oe};w.push(ue)}y&&w.sort((M,D)=>M.sortKey-D.sortKey);for(const M of w){const{geometry:D,index:R,sourceLayerIndex:$}=M;if(this.hasPattern){const W=cf("fill",this.layers,M,this.zoom,r);this.patternFeatures.push(W)}else this.addFeature(M,D,R,u,{},r.availableImages);r.featureIndex.insert(t[R].feature,D,R,$,this.index)}}update(t,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u,p)}addFeatures(t,r,u,p,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,r,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bg),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,u,p,y,w=[]){for(const M of tm(r,500)){let D=0;for(const ue of M)D+=ue.length;const R=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),$=R.vertexLength,W=[],J=[];for(const ue of M){if(ue.length===0)continue;ue!==M[0]&&J.push(W.length/2);const ye=this.segments2.prepareSegment(ue.length,this.layoutVertexArray,this.indexArray2),ke=ye.vertexLength;this.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),this.indexArray2.emplaceBack(ke+ue.length-1,ke),W.push(ue[0].x),W.push(ue[0].y);for(let Ke=1;Ke<ue.length;Ke++)this.layoutVertexArray.emplaceBack(ue[Ke].x,ue[Ke].y),this.indexArray2.emplaceBack(ke+Ke-1,ke+Ke),W.push(ue[Ke].x),W.push(ue[Ke].y);ye.vertexLength+=ue.length,ye.primitiveLength+=ue.length}const oe=rf.exports(W,J);for(let ue=0;ue<oe.length;ue+=3)this.indexArray.emplaceBack($+oe[ue],$+oe[ue+1],$+oe[ue+2]);R.vertexLength+=D,R.primitiveLength+=oe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,w,p)}}ft(Qf,"FillBucket",{omit:["layers","patternFeatures"]});const Sg=new vn({"fill-sort-key":new Zt(Mt.layout_fill["fill-sort-key"])});var cy={paint:new vn({"fill-antialias":new St(Mt.paint_fill["fill-antialias"]),"fill-opacity":new Zt(Mt.paint_fill["fill-opacity"]),"fill-color":new Zt(Mt.paint_fill["fill-color"]),"fill-outline-color":new Zt(Mt.paint_fill["fill-outline-color"]),"fill-translate":new St(Mt.paint_fill["fill-translate"]),"fill-translate-anchor":new St(Mt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zt(Mt.paint_fill["fill-pattern"])}),layout:Sg};const yl=Yi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ep=Yi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),uy=Yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:hy}=yl;var tp={},dy=Me,Cg=md;function md(n,t,r,u,p){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=u,this._values=p,n.readFields(p0,this,t)}function p0(n,t,r){n==1?t.id=r.readVarint():n==2?function(u,p){for(var y=u.readVarint()+u.pos;u.pos<y;){var w=p._keys[u.readVarint()],M=p._values[u.readVarint()];p.properties[w]=M}}(r,t):n==3?t.type=r.readVarint():n==4&&(t._geometry=r.pos)}function Ig(n){for(var t,r,u=0,p=0,y=n.length,w=y-1;p<y;w=p++)u+=((r=n[w]).x-(t=n[p]).x)*(t.y+r.y);return u}md.types=["Unknown","Point","LineString","Polygon"],md.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,u=1,p=0,y=0,w=0,M=[];n.pos<r;){if(p<=0){var D=n.readVarint();u=7&D,p=D>>3}if(p--,u===1||u===2)y+=n.readSVarint(),w+=n.readSVarint(),u===1&&(t&&M.push(t),t=[]),t.push(new dy(y,w));else{if(u!==7)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&M.push(t),M},md.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,u=0,p=0,y=0,w=1/0,M=-1/0,D=1/0,R=-1/0;n.pos<t;){if(u<=0){var $=n.readVarint();r=7&$,u=$>>3}if(u--,r===1||r===2)(p+=n.readSVarint())<w&&(w=p),p>M&&(M=p),(y+=n.readSVarint())<D&&(D=y),y>R&&(R=y);else if(r!==7)throw new Error("unknown command "+r)}return[w,D,M,R]},md.prototype.toGeoJSON=function(n,t,r){var u,p,y=this.extent*Math.pow(2,r),w=this.extent*n,M=this.extent*t,D=this.loadGeometry(),R=md.types[this.type];function $(oe){for(var ue=0;ue<oe.length;ue++){var ye=oe[ue];oe[ue]=[360*(ye.x+w)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ye.y+M)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(u=0;u<D.length;u++)W[u]=D[u][0];$(D=W);break;case 2:for(u=0;u<D.length;u++)$(D[u]);break;case 3:for(D=function(oe){var ue=oe.length;if(ue<=1)return[oe];for(var ye,ke,Ke=[],ct=0;ct<ue;ct++){var Xe=Ig(oe[ct]);Xe!==0&&(ke===void 0&&(ke=Xe<0),ke===Xe<0?(ye&&Ke.push(ye),ye=[oe[ct]]):ye.push(oe[ct]))}return ye&&Ke.push(ye),Ke}(D),u=0;u<D.length;u++)for(p=0;p<D[u].length;p++)$(D[u][p])}D.length===1?D=D[0]:R="Multi"+R;var J={type:"Feature",geometry:{type:R,coordinates:D},properties:this.properties};return"id"in this&&(J.id=this.id),J};var im=Cg,uf=nm;function nm(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(m0,this,t),this.length=this._features.length}function m0(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push(function(u){for(var p=null,y=u.readVarint()+u.pos;u.pos<y;){var w=u.readVarint()>>3;p=w===1?u.readString():w===2?u.readFloat():w===3?u.readDouble():w===4?u.readVarint64():w===5?u.readVarint():w===6?u.readSVarint():w===7?u.readBoolean():null}return p}(r))}nm.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new im(this._pbf,t,this.extent,this._keys,this._values)};var c=uf;function s(n,t,r){if(n===3){var u=new c(r,r.readVarint()+r.pos);u.length&&(t[u.name]=u)}}var h=tp.VectorTile=function(n,t){this.layers=n.readFields(s,{},t)},v=tp.VectorTileFeature=Cg;function I(n,t,r,u){const p=[],y=u===0?(w,M,D,R,$,W)=>{w.push(new Me(W,D+(W-M)/(R-M)*($-D)))}:(w,M,D,R,$,W)=>{w.push(new Me(M+(W-D)/($-D)*(R-M),W))};for(const w of n){const M=[];for(const D of w){if(D.length<=2)continue;const R=[];for(let J=0;J<D.length-1;J++){const oe=D[J].x,ue=D[J].y,ye=D[J+1].x,ke=D[J+1].y,Ke=u===0?oe:ue,ct=u===0?ye:ke;Ke<t?ct>t&&y(R,oe,ue,ye,ke,t):Ke>r?ct<r&&y(R,oe,ue,ye,ke,r):R.push(D[J]),ct<t&&Ke>=t&&y(R,oe,ue,ye,ke,t),ct>r&&Ke<=r&&y(R,oe,ue,ye,ke,r)}let $=D[D.length-1];const W=u===0?$.x:$.y;W>=t&&W<=r&&R.push($),R.length&&($=R[R.length-1],R[0].x===$.x&&R[0].y===$.y||R.push(R[0]),M.push(R))}M.length&&p.push(M)}return p}tp.VectorTileLayer=uf;const z=v.types,B=Math.pow(2,13);function U(n,t,r,u,p,y,w,M){n.emplaceBack((t<<1)+w,(r<<1)+y,(Math.floor(u*B)<<1)+p,Math.round(M))}function Z(n,t,r){n.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ne{constructor(){this.acc=new Me(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Me(t.x,t.y),this.max=new Me(t.x,t.y))}append(t,r){this.currentPolyCount.edges++,this.acc._add(t);const u=this.min,p=this.max;t.x<u.x?u.x=t.x:t.x>p.x&&(p.x=t.x),t.y<u.y?u.y=t.y:t.y>p.y&&(p.y=t.y),((t.x===0||t.x===In)&&t.x===r.x)!=((t.y===0||t.y===In)&&t.y===r.y)&&this.processBorderOverlap(t,r),r.x<0!=t.x<0&&this.addBorderIntersection(0,Qn(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>In!=t.x>In&&this.addBorderIntersection(1,Qn(r.y,t.y,(In-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,Qn(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>In!=t.y>In&&this.addBorderIntersection(3,Qn(r.x,t.x,(In-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[t];r<u[0]&&(u[0]=r),r>u[1]&&(u[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const u=t.x===0?0:1;this.addBorderIntersection(u,r.y),this.addBorderIntersection(u,t.y)}else{const u=t.y===0?2:3;this.addBorderIntersection(u,r.x),this.addBorderIntersection(u,t.x)}}centroid(){const t=this.polyCount.reduce((r,u)=>r+u.edges,0);return t!==0?this.acc.div(t)._round():new Me(0,0)}span(){return new Me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0)}}class de{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new Mr,this.centroidVertexArray=new L_,this.indexArray=new Es,this.programConfigurations=new rd(t.layers,t.zoom),this.segments=new as,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=t.enableTerrain}populate(t,r,u,p){this.features=[],this.hasPattern=Jf("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const w=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*w/(w*w+1)/In/(1<<y.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:w,index:M,sourceLayerIndex:D}of t){const R=this.layers[0]._featureFilter.needGeometry,$=sd(y,R);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),$,u))continue;const W={id:w,sourceLayerIndex:D,index:M,geometry:R?$.geometry:Wu(y,u,p),properties:y.properties,type:y.type,patterns:{}},J=this.layoutVertexArray.length;this.hasPattern?this.features.push(cf("fill-extrusion",this.layers,W,this.zoom,r)):this.addFeature(W,W.geometry,M,u,{},r.availableImages,p),r.featureIndex.insert(y,W.geometry,M,D,this.index,J)}this.sortBorders()}addFeatures(t,r,u,p,y){for(const w of this.features){const{geometry:M}=w;this.addFeature(w,M,w.index,r,u,p,y)}this.sortBorders()}update(t,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hy),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,uy.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ep.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,u,p,y,w,M){const D=[new Me(0,0),new Me(In,In)],R=M.projection,$=R.name==="globe",W=this.enableTerrain&&!$?new ne:null,J=z[t.type]==="Polygon";$&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new er);const oe=tm(r,500);for(let Ke=oe.length-1;Ke>=0;Ke--){const ct=oe[Ke];(ct.length===0||(ue=ct[0]).every(Xe=>Xe.x<=0)||ue.every(Xe=>Xe.x>=In)||ue.every(Xe=>Xe.y<=0)||ue.every(Xe=>Xe.y>=In))&&oe.splice(Ke,1)}var ue;let ye;if($)ye=Xt(oe,D,p);else{ye=[];for(const Ke of oe)ye.push({polygon:Ke,bounds:D})}const ke=J?this.edgeRadius:0;for(const{polygon:Ke,bounds:ct}of ye){let Xe=0,nt=0;for(const ht of Ke)J&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),nt+=J?ht.length-1:ht.length;const pt=this.segments.prepareSegment((J?5:4)*nt,this.layoutVertexArray,this.indexArray);if(J){const ht=[],Vt=[];Xe=pt.vertexLength;for(const ni of Ke){let wi,Ht;ni.length&&ni!==Ke[0]&&Vt.push(ht.length/2),wi=ni[1].sub(ni[0])._perp()._unit();for(let si=1;si<ni.length;si++){const ui=ni[si],mi=ni[si===ni.length-1?1:si+1];let{x:Ei,y:Kt}=ui;if(ke){Ht=mi.sub(ui)._perp()._unit();const Bi=wi.add(Ht)._unit(),Sn=ke*Math.min(4,1/(wi.x*Bi.x+wi.y*Bi.y));Ei+=Sn*Bi.x,Kt+=Sn*Bi.y,wi=Ht}U(this.layoutVertexArray,Ei,Kt,0,0,1,1,0),pt.vertexLength++,ht.push(ui.x,ui.y),$&&Z(this.layoutVertexExtArray,R.projectTilePoint(Ei,Kt,p),R.upVector(p,Ei,Kt))}}const Lt=rf.exports(ht,Vt);for(let ni=0;ni<Lt.length;ni+=3)this.indexArray.emplaceBack(Xe+Lt[ni],Xe+Lt[ni+2],Xe+Lt[ni+1]),pt.primitiveLength++}for(const ht of Ke){W&&ht.length&&W.startRing(ht[0]);let Vt,Lt,ni,wi=ht.length>4&&dt(ht[ht.length-2],ht[0],ht[1]),Ht=ke?be(ht[ht.length-2],ht[0],ht[1],ke):0;Lt=ht[1].sub(ht[0])._perp()._unit();let si=!0;for(let ui=1,mi=0;ui<ht.length;ui++){let Ei=ht[ui-1],Kt=ht[ui];const Bi=ht[ui===ht.length-1?1:ui+1];if(W&&J&&W.currentPolyCount.top++,Ie(Kt,Ei,ct)){ke&&(Lt=Bi.sub(Kt)._perp()._unit(),si=!si);continue}W&&W.append(Kt,Ei);const Sn=Kt.sub(Ei)._perp(),qi=Sn.x/(Math.abs(Sn.x)+Math.abs(Sn.y)),ln=Sn.y>0?1:0,Oi=Ei.dist(Kt);if(mi+Oi>32768&&(mi=0),ke){ni=Bi.sub(Kt)._perp()._unit();let rr=Ce(Ei,Kt,Bi,_e(Lt,ni),ke);isNaN(rr)&&(rr=0);const Pn=Kt.sub(Ei)._unit();Ei=Ei.add(Pn.mult(Ht))._round(),Kt=Kt.add(Pn.mult(-rr))._round(),Ht=rr,Lt=ni}const An=pt.vertexLength,dr=ht.length>4&&dt(Ei,Kt,Bi);let sr=st(mi,wi,si);if(U(this.layoutVertexArray,Ei.x,Ei.y,qi,ln,0,0,sr),U(this.layoutVertexArray,Ei.x,Ei.y,qi,ln,0,1,sr),mi+=Oi,sr=st(mi,dr,!si),wi=dr,U(this.layoutVertexArray,Kt.x,Kt.y,qi,ln,0,0,sr),U(this.layoutVertexArray,Kt.x,Kt.y,qi,ln,0,1,sr),pt.vertexLength+=4,this.indexArray.emplaceBack(An+0,An+1,An+2),this.indexArray.emplaceBack(An+1,An+3,An+2),pt.primitiveLength+=2,ke){const rr=Xe+(ui===1?ht.length-2:ui-2),Pn=ui===1?Xe:rr+1;if(this.indexArray.emplaceBack(An+1,rr,An+3),this.indexArray.emplaceBack(rr,Pn,An+3),pt.primitiveLength+=2,Vt===void 0&&(Vt=An),!Ie(Bi,ht[ui],ct)){const Zr=ui===ht.length-1?Vt:pt.vertexLength;this.indexArray.emplaceBack(An+2,An+3,Zr),this.indexArray.emplaceBack(An+3,Zr+1,Zr),this.indexArray.emplaceBack(An+3,Pn,Zr+1),pt.primitiveLength+=3}si=!si}if($){const rr=this.layoutVertexExtArray,Pn=R.projectTilePoint(Ei.x,Ei.y,p),Zr=R.projectTilePoint(Kt.x,Kt.y,p),Vn=R.upVector(p,Ei.x,Ei.y),fr=R.upVector(p,Kt.x,Kt.y);Z(rr,Pn,Vn),Z(rr,Pn,Vn),Z(rr,Zr,fr),Z(rr,Zr,fr)}}J&&(Xe+=ht.length-1)}}if(W&&W.polyCount.length>0){if(W.borders){W.vertexArrayOffset=this.centroidVertexArray.length;const Ke=W.borders,ct=this.featuresOnBorder.push(W)-1;for(let Xe=0;Xe<4;Xe++)Ke[Xe][0]!==Number.MAX_VALUE&&this.borders[Xe].push(ct)}this.encodeCentroid(W.borders?void 0:W.centroid(),W)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,w,p)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((r,u)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[u].borders[t][0])}encodeCentroid(t,r,u=!0){let p,y;if(t)if(t.y!==0){const M=r.span()._mult(this.tileToMeter);p=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(M.x/10)),y=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else p=Math.ceil(7*(t.x+450)),y=0;else p=0,y=+u;let w=u?this.centroidVertexArray.length:r.vertexArrayOffset;for(const M of r.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let D=0;D<M.top;D++)this.centroidVertexArray.emplace(w++,p,y);for(let D=0;D<2*M.edges;D++)this.centroidVertexArray.emplace(w++,0,y),this.centroidVertexArray.emplace(w++,p,y)}}}function _e(n,t){const r=n.add(t)._unit();return n.x*r.x+n.y*r.y}function be(n,t,r,u){const p=t.sub(n)._perp()._unit(),y=r.sub(t)._perp()._unit();return Ce(n,t,r,_e(p,y),u)}function Ce(n,t,r,u,p){const y=Math.sqrt(1-u*u);return Math.min(n.dist(t)/3,t.dist(r)/3,p*y/u)}function Ie(n,t,r){return n.x<r[0].x&&t.x<r[0].x||n.x>r[1].x&&t.x>r[1].x||n.y<r[0].y&&t.y<r[0].y||n.y>r[1].y&&t.y>r[1].y}function dt(n,t,r){if(n.x<0||n.x>=In||t.x<0||t.x>=In||r.x<0||r.x>=In)return!1;const u=r.sub(t),p=u.perp(),y=n.sub(t);return(u.x*y.x+u.y*y.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function st(n,t,r){const u=t?2|n:-3&n;return r?1|u:-2&u}function Pt(){const n=Math.PI/32,t=Math.tan(n),r=Up;return r*Math.sqrt(1+2*t*t)-r}function Xt(n,t,r){const u=1<<r.z,p=_l(r.x/u),y=_l((r.x+1)/u),w=Ls(r.y/u),M=Ls((r.y+1)/u);return function(D,R,$,W,J=0,oe){const ue=[];if(!D.length||!$||!W)return ue;const ye=(ht,Vt)=>{for(const Lt of ht)ue.push({polygon:Lt,bounds:Vt})},ke=Math.ceil(Math.log2($)),Ke=Math.ceil(Math.log2(W)),ct=ke-Ke,Xe=[];for(let ht=0;ht<Math.abs(ct);ht++)Xe.push(ct>0?0:1);for(let ht=0;ht<Math.min(ke,Ke);ht++)Xe.push(0),Xe.push(1);let nt=D;if(nt=I(nt,R[0].y-J,R[1].y+J,1),nt=I(nt,R[0].x-J,R[1].x+J,0),!nt.length)return ue;const pt=[];for(Xe.length?pt.push({polygons:nt,bounds:R,depth:0}):ye(nt,R);pt.length;){const ht=pt.pop(),Vt=ht.depth,Lt=Xe[Vt],ni=ht.bounds[0],wi=ht.bounds[1],Ht=Lt===0?ni.x:ni.y,si=Lt===0?wi.x:wi.y,ui=oe?oe(Lt,Ht,si):.5*(Ht+si),mi=I(ht.polygons,Ht-J,ui+J,Lt),Ei=I(ht.polygons,ui-J,si+J,Lt);if(mi.length){const Kt=[ni,new Me(Lt===0?ui:wi.x,Lt===1?ui:wi.y)];Xe.length>Vt+1?pt.push({polygons:mi,bounds:Kt,depth:Vt+1}):ye(mi,Kt)}if(Ei.length){const Kt=[new Me(Lt===0?ui:ni.x,Lt===1?ui:ni.y),wi];Xe.length>Vt+1?pt.push({polygons:Ei,bounds:Kt,depth:Vt+1}):ye(Ei,Kt)}}return ue}(n,t,Math.ceil((y-p)/11.25),Math.ceil((w-M)/11.25),1,(D,R,$)=>{if(D===0)return .5*(R+$);{const W=Ls((r.y+R/In)/u);return(Qc(.5*(Ls((r.y+$/In)/u)+W))*u-r.y)*In}})}ft(de,"FillExtrusionBucket",{omit:["layers","features"]}),ft(ne,"PartMetadata");const Ct=new vn({"fill-extrusion-edge-radius":new St(Mt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var jt={paint:new vn({"fill-extrusion-opacity":new St(Mt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Zt(Mt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new St(Mt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new St(Mt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zt(Mt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Zt(Mt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Zt(Mt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new St(Mt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new St(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new St(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Ct};function hi(n,t,r){var u=2*Math.PI*6378137/256/Math.pow(2,r);return[n*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class li{constructor(t,r,u){this.z=t,this.x=r,this.y=u,this.key=Xi(0,t,t,r,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const u=function(y,w,M){var D=hi(256*y,256*(w=Math.pow(2,M)-w-1),M),R=hi(256*(y+1),256*(w+1),M);return D[0]+","+D[1]+","+R[0]+","+R[1]}(this.x,this.y,this.z),p=function(y,w,M){let D,R="";for(let $=y;$>0;$--)D=1<<$-1,R+=(w&D?1:0)+(M&D?2:0);return R}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class nn{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Xi(t,r.z,r.z,r.x,r.y)}}class Wi{constructor(t,r,u,p,y){this.overscaledZ=t,this.wrap=r,this.canonical=new li(u,+p,+y),this.key=r===0&&t===u?this.canonical.key:Xi(r,t,u,p,y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new Wi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wi(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return Xi(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-t;return Xi(this.wrap*+r,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Wi(r,this.wrap,r,u,p),new Wi(r,this.wrap,r,u+1,p),new Wi(r,this.wrap,r,u,p+1),new Wi(r,this.wrap,r,u+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Wi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new nn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xi(n,t,r,u,p){const y=1<<Math.min(r,22);let w=y*(p%y)+u%y;return n&&r<22&&(w+=y*y*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*w+r)+(t-r)}ft(li,"CanonicalTileID"),ft(Wi,"OverscaledTileID",{omit:["projMatrix"]});class Ri extends Me{constructor(t,r,u){super(t,r),this.z=u}}function Di(n,t){return n.x*t.x+n.y*t.y}function Qi(n,t){if(n.length===1){let r=0;const u=t[r++];let p;for(;!p||u.equals(p);)if(p=t[r++],!p)return 1/0;for(;r<t.length;r++){const y=t[r],w=n[0],M=p.sub(u),D=y.sub(u),R=w.sub(u),$=Di(M,M),W=Di(M,D),J=Di(D,D),oe=Di(R,M),ue=Di(R,D),ye=$*J-W*W,ke=(J*oe-W*ue)/ye,Ke=($*ue-W*oe)/ye,ct=u.z*(1-ke-Ke)+p.z*ke+y.z*Ke;if(isFinite(ct))return ct}return 1/0}{let r=1/0;for(const u of t)r=Math.min(r,u.z);return r}}function Hi(n,t,r,u,p,y,w,M){const D=w*p.getElevationAt(n,t,!0,!0),R=y[0]!==0,$=R?y[1]===0?w*(y[0]/7-450):w*function(W,J,oe){const ue=Math.floor(J[0]/8),ye=Math.floor(J[1]/8),ke=10*(J[0]-8*ue),Ke=10*(J[1]-8*ye),ct=W.getElevationAt(ue,ye,!0,!0),Xe=W.getMeterToDEM(oe),nt=Math.floor(.5*(ke*Xe-1)),pt=Math.floor(.5*(Ke*Xe-1)),ht=W.tileCoordToPixel(ue,ye),Vt=2*nt+1,Lt=2*pt+1,ni=function(Ei,Kt,Bi,Sn,qi){return[Ei.getElevationAtPixel(Kt,Bi,!0),Ei.getElevationAtPixel(Kt+qi,Bi,!0),Ei.getElevationAtPixel(Kt,Bi+qi,!0),Ei.getElevationAtPixel(Kt+Sn,Bi+qi,!0)]}(W,ht.x-nt,ht.y-pt,Vt,Lt),wi=Math.abs(ni[0]-ni[1]),Ht=Math.abs(ni[2]-ni[3]),si=Math.abs(ni[0]-ni[2])+Math.abs(ni[1]-ni[3]),ui=Math.min(.25,.5*Xe*(wi+Ht)/Vt),mi=Math.min(.25,.5*Xe*si/Lt);return ct+Math.max(ui*ke,mi*Ke)}(p,y,M):D;return{base:D+(r===0)?-1:r,top:R?Math.max($+u,D+r+2):D+u}}const Ai=Yi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:bn}=Ai,fn=Yi([{name:"a_packed",components:4,type:"Float32"}]),{members:tr}=fn,fo=v.types,bo=Math.cos(Math.PI/180*37.5);class $o{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ts,this.layoutVertexArray2=new Ea,this.indexArray=new Es,this.programConfigurations=new rd(t.layers,t.zoom),this.segments=new as,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,u,p){this.hasPattern=Jf("line",this.layers,r);const y=this.layers[0].layout.get("line-sort-key"),w=[];for(const{feature:$,id:W,index:J,sourceLayerIndex:oe}of t){const ue=this.layers[0]._featureFilter.needGeometry,ye=sd($,ue);if(!this.layers[0]._featureFilter.filter(new Et(this.zoom),ye,u))continue;const ke=y?y.evaluate(ye,{},u):void 0,Ke={id:W,properties:$.properties,type:$.type,sourceLayerIndex:oe,index:J,geometry:ue?ye.geometry:Wu($,u,p),patterns:{},sortKey:ke};w.push(Ke)}y&&w.sort(($,W)=>$.sortKey-W.sortKey);const{lineAtlas:M,featureIndex:D}=r,R=this.addConstantDashes(M);for(const $ of w){const{geometry:W,index:J,sourceLayerIndex:oe}=$;if(R&&this.addFeatureDashes($,M),this.hasPattern){const ue=cf("line",this.layers,$,this.zoom,r);this.patternFeatures.push(ue)}else this.addFeature($,W,J,u,M.positions,r.availableImages);D.insert(t[J].feature,W,J,oe,this.index)}}addConstantDashes(t){let r=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if(p.kind!=="constant"||y.kind!=="constant")r=!0;else{const w=y.value,M=p.value;if(!M)continue;t.addDash(M,w)}}return r}addFeatureDashes(t,r){const u=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,w=p.layout.get("line-cap").value;if(y.kind==="constant"&&w.kind==="constant")continue;let M,D;if(y.kind==="constant"){if(M=y.value,!M)continue}else M=y.evaluate({zoom:u},t);D=w.kind==="constant"?w.value:w.evaluate({zoom:u},t),r.addDash(M,D),t.patterns[p.id]=r.getKey(M,D)}}update(t,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u,p)}addFeatures(t,r,u,p,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,r,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,tr)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,u,p,y,w){const M=this.layers[0].layout,D=M.get("line-join").evaluate(t,{}),R=M.get("line-cap").evaluate(t,{}),$=M.get("line-miter-limit"),W=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const J of r)this.addLine(J,t,D,R,$,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,w,p)}addLine(t,r,u,p,y,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<t.length-1;Ke++)this.totalDistance+=t[Ke].dist(t[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=fo[r.type]==="Polygon";let D=t.length;for(;D>=2&&t[D-1].equals(t[D-2]);)D--;let R=0;for(;R<D-1&&t[R].equals(t[R+1]);)R++;if(D<(M?3:2))return;u==="bevel"&&(y=1.05);const $=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let J,oe,ue,ye,ke;this.e1=this.e2=-1,M&&(J=t[D-2],ke=t[R].sub(J)._unit()._perp());for(let Ke=R;Ke<D;Ke++){if(ue=Ke===D-1?M?t[R+1]:void 0:t[Ke+1],ue&&t[Ke].equals(ue))continue;ke&&(ye=ke),J&&(oe=J),J=t[Ke],ke=ue?ue.sub(J)._unit()._perp():ye,ye=ye||ke;let ct=ye.add(ke);ct.x===0&&ct.y===0||ct._unit();const Xe=ye.x*ke.x+ye.y*ke.y,nt=ct.x*ke.x+ct.y*ke.y,pt=nt!==0?1/nt:1/0,ht=2*Math.sqrt(2-2*nt),Vt=nt<bo&&oe&&ue,Lt=ye.x*ke.y-ye.y*ke.x>0;if(Vt&&Ke>R){const Ht=J.dist(oe);if(Ht>2*$){const si=J.sub(J.sub(oe)._mult($/Ht)._round());this.updateDistance(oe,si),this.addCurrentVertex(si,ye,0,0,W),oe=si}}const ni=oe&&ue;let wi=ni?u:M?"butt":p;if(ni&&wi==="round"&&(pt<w?wi="miter":pt<=2&&(wi="fakeround")),wi==="miter"&&pt>y&&(wi="bevel"),wi==="bevel"&&(pt>2&&(wi="flipbevel"),pt<y&&(wi="miter")),oe&&this.updateDistance(oe,J),wi==="miter")ct._mult(pt),this.addCurrentVertex(J,ct,0,0,W);else if(wi==="flipbevel"){if(pt>100)ct=ke.mult(-1);else{const Ht=pt*ye.add(ke).mag()/ye.sub(ke).mag();ct._perp()._mult(Ht*(Lt?-1:1))}this.addCurrentVertex(J,ct,0,0,W),this.addCurrentVertex(J,ct.mult(-1),0,0,W)}else if(wi==="bevel"||wi==="fakeround"){const Ht=-Math.sqrt(pt*pt-1),si=Lt?Ht:0,ui=Lt?0:Ht;if(oe&&this.addCurrentVertex(J,ye,si,ui,W),wi==="fakeround"){const mi=Math.round(180*ht/Math.PI/20);for(let Ei=1;Ei<mi;Ei++){let Kt=Ei/mi;if(Kt!==.5){const Sn=Kt-.5;Kt+=Kt*Sn*(Kt-1)*((1.0904+Xe*(Xe*(3.55645-1.43519*Xe)-3.2452))*Sn*Sn+(.848013+Xe*(.215638*Xe-1.06021)))}const Bi=ke.sub(ye)._mult(Kt)._add(ye)._unit()._mult(Lt?-1:1);this.addHalfVertex(J,Bi.x,Bi.y,!1,Lt,0,W)}}ue&&this.addCurrentVertex(J,ke,-si,-ui,W)}else if(wi==="butt")this.addCurrentVertex(J,ct,0,0,W);else if(wi==="square"){const Ht=oe?1:-1;oe||this.addCurrentVertex(J,ct,Ht,Ht,W),this.addCurrentVertex(J,ct,0,0,W),oe&&this.addCurrentVertex(J,ct,Ht,Ht,W)}else wi==="round"&&(oe&&(this.addCurrentVertex(J,ye,0,0,W),this.addCurrentVertex(J,ye,1,1,W,!0)),ue&&(this.addCurrentVertex(J,ke,-1,-1,W,!0),this.addCurrentVertex(J,ke,0,0,W)));if(Vt&&Ke<D-1){const Ht=J.dist(ue);if(Ht>2*$){const si=J.add(ue.sub(J)._mult($/Ht)._round());this.updateDistance(J,si),this.addCurrentVertex(si,ke,0,0,W),J=si}}}}addCurrentVertex(t,r,u,p,y,w=!1){const M=r.y*p-r.x,D=-r.y-r.x*p;this.addHalfVertex(t,r.x+r.y*u,r.y-r.x*u,w,!1,u,y),this.addHalfVertex(t,M,D,w,!0,-p,y)}addHalfVertex({x:t,y:r},u,p,y,w,M,D){this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(r<<1)+(w?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(M===0?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const R=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),D.primitiveLength++),w?this.e2=R:this.e1=R}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}ft($o,"LineBucket",{omit:["layers","patternFeatures"]});const vl=new vn({"line-cap":new Zt(Mt.layout_line["line-cap"]),"line-join":new Zt(Mt.layout_line["line-join"]),"line-miter-limit":new St(Mt.layout_line["line-miter-limit"]),"line-round-limit":new St(Mt.layout_line["line-round-limit"]),"line-sort-key":new Zt(Mt.layout_line["line-sort-key"])});var Cs={paint:new vn({"line-opacity":new Zt(Mt.paint_line["line-opacity"]),"line-color":new Zt(Mt.paint_line["line-color"]),"line-translate":new St(Mt.paint_line["line-translate"]),"line-translate-anchor":new St(Mt.paint_line["line-translate-anchor"]),"line-width":new Zt(Mt.paint_line["line-width"]),"line-gap-width":new Zt(Mt.paint_line["line-gap-width"]),"line-offset":new Zt(Mt.paint_line["line-offset"]),"line-blur":new Zt(Mt.paint_line["line-blur"]),"line-dasharray":new Zt(Mt.paint_line["line-dasharray"]),"line-pattern":new Zt(Mt.paint_line["line-pattern"]),"line-gradient":new sn(Mt.paint_line["line-gradient"]),"line-trim-offset":new St(Mt.paint_line["line-trim-offset"])}),layout:vl};const Xo=new class extends Zt{possiblyEvaluate(n,t){return t=new Et(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,r,u){return t=di({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,r,u)}}(Cs.paint.properties["line-width"].specification);function ds(n,t){return t>0?t+2*n:n}Xo.useIntegerZoom=!0;const Bs=Yi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hs=Yi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ma=Yi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ls=Yi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Rs=Yi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Os=Yi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ma=Yi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yi([{name:"triangle",components:3,type:"Uint16"}]),Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Yi([{type:"Float32",name:"offsetX"}]),Yi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qr=24;const jo=128;function po(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Et(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=r;let y=0;for(;y<u.length&&u[y]<=n;)y++;y=Math.max(0,y-1);let w=y;for(;w<u.length&&u[w]<n+1;)w++;w=Math.min(u.length-1,w);const M=u[y],D=u[w];return r.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:D,interpolationType:p}:{kind:"camera",minZoom:M,maxZoom:D,minSize:r.evaluate(new Et(M)),maxSize:r.evaluate(new Et(D)),interpolationType:p}}}function Ho(n,{uSize:t,uSizeT:r},{lowerSize:u,upperSize:p}){return n.kind==="source"?u/jo:n.kind==="composite"?Qn(u/jo,p/jo,r):t}function Kn(n,t){let r=0,u=0;if(n.kind==="constant")u=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:w}=n,M=p?Wt(Gs.interpolationFactor(p,t,y,w),0,1):0;n.kind==="camera"?u=Qn(n.minSize,n.maxSize,M):r=M}return{uSizeT:r,uSize:u}}var Wa=Object.freeze({__proto__:null,getSizeData:po,evaluateSizeForFeature:Ho,evaluateSizeForZoom:Kn,SIZE_PACK_FACTOR:jo});function Fs(n,t,r){return n.sections.forEach(u=>{u.text=function(p,y,w){const M=y.layout.get("text-transform").evaluate(w,{});return M==="uppercase"?p=p.toLocaleUpperCase():M==="lowercase"&&(p=p.toLocaleLowerCase()),Dt.applyArabicShaping&&(p=Dt.applyArabicShaping(p)),p}(u.text,t,r)}),n}const fs={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Ul(n){return n==="\uFE36"||n==="\uFE48"||n==="\uFE38"||n==="\uFE44"||n==="\uFE42"||n==="\uFE3E"||n==="\uFE3C"||n==="\uFE3A"||n==="\uFE18"||n==="\uFE40"||n==="\uFE10"||n==="\uFE13"||n==="\uFE14"||n==="\uFF40"||n==="\uFFE3"||n==="\uFE11"||n==="\uFE12"}function gc(n){return n==="\uFE35"||n==="\uFE47"||n==="\uFE37"||n==="\uFE43"||n==="\uFE41"||n==="\uFE3D"||n==="\uFE3B"||n==="\uFE39"||n==="\uFE17"||n==="\uFE3F"}var ka=or,iu=function(n,t,r,u,p){var y,w,M=8*p-u-1,D=(1<<M)-1,R=D>>1,$=-7,W=r?p-1:0,J=r?-1:1,oe=n[t+W];for(W+=J,y=oe&(1<<-$)-1,oe>>=-$,$+=M;$>0;y=256*y+n[t+W],W+=J,$-=8);for(w=y&(1<<-$)-1,y>>=-$,$+=u;$>0;w=256*w+n[t+W],W+=J,$-=8);if(y===0)y=1-R;else{if(y===D)return w?NaN:1/0*(oe?-1:1);w+=Math.pow(2,u),y-=R}return(oe?-1:1)*w*Math.pow(2,y-u)},xl=function(n,t,r,u,p,y){var w,M,D,R=8*y-p-1,$=(1<<R)-1,W=$>>1,J=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,oe=u?0:y-1,ue=u?1:-1,ye=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,w=$):(w=Math.floor(Math.log(t)/Math.LN2),t*(D=Math.pow(2,-w))<1&&(w--,D*=2),(t+=w+W>=1?J/D:J*Math.pow(2,1-W))*D>=2&&(w++,D/=2),w+W>=$?(M=0,w=$):w+W>=1?(M=(t*D-1)*Math.pow(2,p),w+=W):(M=t*Math.pow(2,W-1)*Math.pow(2,p),w=0));p>=8;n[r+oe]=255&M,oe+=ue,M/=256,p-=8);for(w=w<<p|M,R+=p;R>0;n[r+oe]=255&w,oe+=ue,w/=256,R-=8);n[r+oe-ue]|=128*ye};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function or(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}or.Varint=0,or.Fixed64=1,or.Bytes=2,or.Fixed32=5;var Ks=4294967296,nu=1/Ks,hf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ru(n){return n.type===or.Bytes?n.readVarint()+n.pos:n.pos+1}function Eh(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function rm(n,t,r){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(u);for(var p=r.pos-1;p>=n;p--)r.buf[p+u]=r.buf[p]}function Ku(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function fy(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function Ag(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function Mg(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function py(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function g0(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function _0(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function y0(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function v0(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function om(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function df(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function my(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function x0(n,t,r){t.glyphs=[],n===1&&r.readMessage(_c,t)}function _c(n,t,r){if(n===3){const{id:u,bitmap:p,width:y,height:w,left:M,top:D,advance:R}=r.readMessage(sm,{});t.glyphs.push({id:u,bitmap:new Nl({width:y+6,height:w+6},p),metrics:{width:y,height:w,left:M,top:D,advance:R}})}else n===4?t.ascender=r.readSVarint():n===5&&(t.descender=r.readSVarint())}function sm(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}function am(n){let t=0,r=0;for(const w of n)t+=w.w*w.h,r=Math.max(r,w.w);n.sort((w,M)=>M.h-w.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let p=0,y=0;for(const w of n)for(let M=u.length-1;M>=0;M--){const D=u[M];if(!(w.w>D.w||w.h>D.h)){if(w.x=D.x,w.y=D.y,y=Math.max(y,w.y+w.h),p=Math.max(p,w.x+w.w),w.w===D.w&&w.h===D.h){const R=u.pop();M<u.length&&(u[M]=R)}else w.h===D.h?(D.x+=w.w,D.w-=w.w):w.w===D.w?(D.y+=w.h,D.h-=w.h):(u.push({x:D.x+w.w,y:D.y,w:D.w-w.w,h:w.h}),D.y+=w.h,D.h-=w.h);break}}return{w:p,h:y,fill:t/(p*y)||0}}or.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var u=this.readVarint(),p=u>>3,y=this.pos;this.type=7&u,n(p,t,this),this.pos===y&&this.skip(u)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=om(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=my(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=om(this.buf,this.pos)+om(this.buf,this.pos+4)*Ks;return this.pos+=8,n},readSFixed64:function(){var n=om(this.buf,this.pos)+my(this.buf,this.pos+4)*Ks;return this.pos+=8,n},readFloat:function(){var n=iu(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=iu(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,u=this.buf;return t=127&(r=u[this.pos++]),r<128?t:(t|=(127&(r=u[this.pos++]))<<7,r<128?t:(t|=(127&(r=u[this.pos++]))<<14,r<128?t:(t|=(127&(r=u[this.pos++]))<<21,r<128?t:function(p,y,w){var M,D,R=w.buf;if(M=(112&(D=R[w.pos++]))>>4,D<128||(M|=(127&(D=R[w.pos++]))<<3,D<128)||(M|=(127&(D=R[w.pos++]))<<10,D<128)||(M|=(127&(D=R[w.pos++]))<<17,D<128)||(M|=(127&(D=R[w.pos++]))<<24,D<128)||(M|=(1&(D=R[w.pos++]))<<31,D<128))return Eh(p,M,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=u[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&hf?function(r,u,p){return hf.decode(r.subarray(u,p))}(this.buf,t,n):function(r,u,p){for(var y="",w=u;w<p;){var M,D,R,$=r[w],W=null,J=$>239?4:$>223?3:$>191?2:1;if(w+J>p)break;J===1?$<128&&(W=$):J===2?(192&(M=r[w+1]))==128&&(W=(31&$)<<6|63&M)<=127&&(W=null):J===3?(D=r[w+2],(192&(M=r[w+1]))==128&&(192&D)==128&&((W=(15&$)<<12|(63&M)<<6|63&D)<=2047||W>=55296&&W<=57343)&&(W=null)):J===4&&(D=r[w+2],R=r[w+3],(192&(M=r[w+1]))==128&&(192&D)==128&&(192&R)==128&&((W=(15&$)<<18|(63&M)<<12|(63&D)<<6|63&R)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,J=1):W>65535&&(W-=65536,y+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),y+=String.fromCharCode(W),w+=J}return y}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==or.Bytes)return n.push(this.readVarint(t));var r=ru(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==or.Bytes)return n.push(this.readSVarint());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==or.Bytes)return n.push(this.readBoolean());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==or.Bytes)return n.push(this.readFloat());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==or.Bytes)return n.push(this.readDouble());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==or.Bytes)return n.push(this.readFixed32());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==or.Bytes)return n.push(this.readSFixed32());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==or.Bytes)return n.push(this.readFixed64());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==or.Bytes)return n.push(this.readSFixed64());var t=ru(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===or.Varint)for(;this.buf[this.pos++]>127;);else if(t===or.Bytes)this.pos=this.readVarint()+this.pos;else if(t===or.Fixed32)this.pos+=4;else{if(t!==or.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),df(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),df(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),df(this.buf,-1&n,this.pos),df(this.buf,Math.floor(n*nu),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),df(this.buf,-1&n,this.pos),df(this.buf,Math.floor(n*nu),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,r){var u,p;if(t>=0?(u=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,w,M){M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,M.buf[M.pos]=127&(y>>>=7)}(u,0,r),function(y,w){var M=(7&y)<<4;w.buf[w.pos++]|=M|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))}(p,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(u,p,y){for(var w,M,D=0;D<p.length;D++){if((w=p.charCodeAt(D))>55295&&w<57344){if(!M){w>56319||D+1===p.length?(u[y++]=239,u[y++]=191,u[y++]=189):M=w;continue}if(w<56320){u[y++]=239,u[y++]=191,u[y++]=189,M=w;continue}w=M-55296<<10|w-56320|65536,M=null}else M&&(u[y++]=239,u[y++]=191,u[y++]=189,M=null);w<128?u[y++]=w:(w<2048?u[y++]=w>>6|192:(w<65536?u[y++]=w>>12|224:(u[y++]=w>>18|240,u[y++]=w>>12&63|128),u[y++]=w>>6&63|128),u[y++]=63&w|128)}return y}(this.buf,n,this.pos);var r=this.pos-t;r>=128&&rm(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),xl(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),xl(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var u=this.pos-r;u>=128&&rm(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeMessage:function(n,t,r){this.writeTag(n,or.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Ku,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,fy,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,py,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Ag,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,Mg,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,g0,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,_0,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,y0,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,v0,t)},writeBytesField:function(n,t){this.writeTag(n,or.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,or.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,or.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,or.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,or.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,or.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,or.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,or.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,or.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,or.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,Boolean(t))}};class Ys{constructor(t,{pixelRatio:r,version:u,stretchX:p,stretchY:y,content:w}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=p,this.stretchY=y,this.content=w,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class yc{constructor(t,r){const u={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,u,y),this.addImages(r,p,y);const{w,h:M}=am(y),D=new qa({width:w||1,height:M||1});for(const R in t){const $=t[R],W=u[R].paddedRect;qa.copy($.data,D,{x:0,y:0},{x:W.x+1,y:W.y+1},$.data)}for(const R in r){const $=r[R],W=p[R].paddedRect,J=W.x+1,oe=W.y+1,ue=$.data.width,ye=$.data.height;qa.copy($.data,D,{x:0,y:0},{x:J,y:oe},$.data),qa.copy($.data,D,{x:0,y:ye-1},{x:J,y:oe-1},{width:ue,height:1}),qa.copy($.data,D,{x:0,y:0},{x:J,y:oe+ye},{width:ue,height:1}),qa.copy($.data,D,{x:ue-1,y:0},{x:J-1,y:oe},{width:1,height:ye}),qa.copy($.data,D,{x:0,y:0},{x:J+ue,y:oe},{width:1,height:ye})}this.image=D,this.iconPositions=u,this.patternPositions=p}addImages(t,r,u){for(const p in t){const y=t[p],w={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(w),r[p]=new Ys(w,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>t.hasImage(u)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),r),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),r)}patchUpdatedImage(t,r,u){if(!t||!r||t.version===r.version)return;t.version=r.version;const[p,y]=t.tl;u.update(r.data,void 0,{x:p,y})}}ft(Ys,"ImagePosition"),ft(yc,"ImageAtlas");const Js={horizontal:1,vertical:2,horizontalOnly:3};class Yu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const u=new Yu;return u.scale=t||1,u.fontStack=r,u}static forImage(t){const r=new Yu;return r.imageName=t,r}}class gd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const u=new gd;for(let p=0;p<t.sections.length;p++){const y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,r)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(r,u){let p="";for(let y=0;y<r.length;y++){const w=r.charCodeAt(y+1)||null,M=r.charCodeAt(y-1)||null;p+=!u&&(w&&ie(w)&&!fs[r[y+1]]||M&&ie(M)&&!fs[r[y-1]])||!fs[r[y]]?r[y]:fs[r[y]]}return p}(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&gy[this.text.charCodeAt(u)];u++)t++;let r=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&gy[this.text.charCodeAt(u)];u--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const u=new gd;return u.text=this.text.substring(t,r),u.sectionIndex=this.sectionIndex.slice(t,r),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Yu.forText(t.scale,t.fontStack||r));const u=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(u)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void at("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Yu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):at("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ju(n,t,r,u,p,y,w,M,D,R,$,W,J,oe,ue){const ye=gd.fromFeature(n,p);W===Js.vertical&&ye.verticalizePunctuation(J);let ke=[];const Ke=function(ht,Vt,Lt,ni,wi,Ht){if(!ht)return[];const si=[],ui=function(Bi,Sn,qi,ln,Oi,An){let dr=0;for(let sr=0;sr<Bi.length();sr++){const rr=Bi.getSection(sr);dr+=wb(Bi.getCharCode(sr),rr,ln,Oi,Sn,An)}return dr/Math.max(1,Math.ceil(dr/qi))}(ht,Vt,Lt,ni,wi,Ht),mi=ht.text.indexOf("\u200B")>=0;let Ei=0;for(let Bi=0;Bi<ht.length();Bi++){const Sn=ht.getSection(Bi),qi=ht.getCharCode(Bi);if(gy[qi]||(Ei+=wb(qi,Sn,ni,wi,Vt,Ht)),Bi<ht.length()-1){const ln=!((Kt=qi)<11904||!(hr(Kt)||ur(Kt)||f(Kt)||Rl(Kt)||da(Kt)||en(Kt)||Dr(Kt)||dn(Kt)||wa(Kt)||Ua(Kt)||ba(Kt)||k(Kt)||xr(Kt)||$n(Kt)||Rn(Kt)||Wo(Kt)||Cr(Kt)||o(Kt)||ws(Kt)||Zs(Kt)));(jI[qi]||ln||Sn.imageName)&&si.push(Eb(Bi+1,Ei,ui,si,GI(qi,ht.getCharCode(Bi+1),ln&&mi),!1))}}var Kt;return Sb(Eb(ht.length(),Ei,ui,si,0,!0))}(ye,R,y,t,u,oe),{processBidirectionalText:ct,processStyledBidirectionalText:Xe}=Dt;if(ct&&ye.sections.length===1){const ht=ct(ye.toString(),Ke);for(const Vt of ht){const Lt=new gd;Lt.text=Vt,Lt.sections=ye.sections;for(let ni=0;ni<Vt.length;ni++)Lt.sectionIndex.push(0);ke.push(Lt)}}else if(Xe){const ht=Xe(ye.text,ye.sectionIndex,Ke);for(const Vt of ht){const Lt=new gd;Lt.text=Vt[0],Lt.sectionIndex=Vt[1],Lt.sections=ye.sections,ke.push(Lt)}}else ke=function(ht,Vt){const Lt=[],ni=ht.text;let wi=0;for(const Ht of Vt)Lt.push(ht.substring(wi,Ht)),wi=Ht;return wi<ni.length&&Lt.push(ht.substring(wi,ni.length)),Lt}(ye,Ke);const nt=[],pt={positionedLines:nt,text:ye.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:W,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ht,Vt,Lt,ni,wi,Ht,si,ui,mi,Ei,Kt,Bi){let Sn=0,qi=0,ln=0;const Oi=ui==="right"?1:ui==="left"?0:.5;let An=!1;for(const Vn of wi){const fr=Vn.getSections();for(const Yr of fr){if(Yr.imageName)continue;const mo=Vt[Yr.fontStack];if(mo&&(An=mo.ascender!==void 0&&mo.descender!==void 0,!An))break}if(!An)break}let dr=0;for(const Vn of wi){Vn.trim();const fr=Vn.getMaxScale(),Yr=(fr-1)*qr,mo={positionedGlyphs:[],lineOffset:0};ht.positionedLines[dr]=mo;const lo=mo.positionedGlyphs;let go=0;if(!Vn.length()){qi+=Ht,++dr;continue}let wo=0,Ko=0;for(let Wr=0;Wr<Vn.length();Wr++){const _s=Vn.getSection(Wr),ps=Vn.getSectionIndex(Wr),kr=Vn.getCharCode(Wr);let Ro=_s.scale,Is=null,Jr=null,cs=null,Pa=qr,ea=0;const ta=!(mi===Js.horizontal||!Kt&&!te(kr)||Kt&&(gy[kr]||(sr=kr,Jt(sr)||Ji(sr)||Vi(sr)||_(sr)||S(sr))));if(_s.imageName){const Xa=ni[_s.imageName];if(!Xa)continue;cs=_s.imageName,ht.iconsInText=ht.iconsInText||!0,Jr=Xa.paddedRect;const ia=Xa.displaySize;Ro=Ro*qr/Bi,Is={width:ia[0],height:ia[1],left:1,top:-3,advance:ta?ia[1]:ia[0],localGlyph:!1},ea=An?-Is.height*Ro:fr*qr-17-ia[1]*Ro,Pa=Is.advance;const vd=(ta?ia[0]:ia[1])*Ro-qr*fr;vd>0&&vd>go&&(go=vd)}else{const Xa=Lt[_s.fontStack];if(!Xa)continue;Xa[kr]&&(Jr=Xa[kr]);const ia=Vt[_s.fontStack];if(!ia)continue;const vd=ia.glyphs[kr];if(!vd)continue;if(Is=vd.metrics,Pa=kr!==8203?qr:0,An){const gm=ia.ascender!==void 0?Math.abs(ia.ascender):0,Ug=ia.descender!==void 0?Math.abs(ia.descender):0,$g=(gm+Ug)*Ro;wo<$g&&(wo=$g,Ko=(gm-Ug)/2*Ro),ea=-gm*Ro}else ea=(fr-Ro)*qr-17}ta?(ht.verticalizable=!0,lo.push({glyph:kr,imageName:cs,x:Sn,y:qi+ea,vertical:ta,scale:Ro,localGlyph:Is.localGlyph,fontStack:_s.fontStack,sectionIndex:ps,metrics:Is,rect:Jr}),Sn+=Pa*Ro+Ei):(lo.push({glyph:kr,imageName:cs,x:Sn,y:qi+ea,vertical:ta,scale:Ro,localGlyph:Is.localGlyph,fontStack:_s.fontStack,sectionIndex:ps,metrics:Is,rect:Jr}),Sn+=Is.advance*Ro+Ei)}lo.length!==0&&(ln=Math.max(Sn-Ei,ln),An?Cb(lo,Oi,go,Ko,Ht*fr/2):Cb(lo,Oi,go,0,Ht/2)),Sn=0;const Qs=Ht*fr+go;mo.lineOffset=Math.max(go,Yr),qi+=Qs,++dr}var sr;const rr=qi,{horizontalAlign:Pn,verticalAlign:Zr}=b0(si);(function(Vn,fr,Yr,mo,lo,go){const wo=(fr-Yr)*lo,Ko=-go*mo;for(const Qs of Vn)for(const Wr of Qs.positionedGlyphs)Wr.x+=wo,Wr.y+=Ko})(ht.positionedLines,Oi,Pn,Zr,ln,rr),ht.top+=-Zr*rr,ht.bottom=ht.top+rr,ht.left+=-Pn*ln,ht.right=ht.left+ln,ht.hasBaseline=An}(pt,t,r,u,ke,w,M,D,W,R,J,ue),!function(ht){for(const Vt of ht)if(Vt.positionedGlyphs.length!==0)return!1;return!0}(nt)&&pt}const gy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wb(n,t,r,u,p,y){if(t.imageName){const w=u[t.imageName];return w?w.displaySize[0]*t.scale*qr/y+p:0}{const w=r[t.fontStack],M=w&&w.glyphs[n];return M?M.metrics.advance*t.scale+p:0}}function Tb(n,t,r,u){const p=Math.pow(n-t,2);return u?n<t?p/2:2*p:p+Math.abs(r)*r}function GI(n,t,r){let u=0;return n===10&&(u-=1e4),r&&(u+=150),n!==40&&n!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function Eb(n,t,r,u,p,y){let w=null,M=Tb(t,r,p,y);for(const D of u){const R=Tb(t-D.x,r,p,y)+D.badness;R<=M&&(w=D,M=R)}return{index:n,x:t,priorBreak:w,badness:M}}function Sb(n){return n?Sb(n.priorBreak).concat(n.index):[]}function b0(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Cb(n,t,r,u,p){if(!(t||r||u||p))return;const y=n.length-1,w=n[y],M=(w.x+w.metrics.advance*w.scale)*t;for(let D=0;D<=y;D++)n[D].x-=M,n[D].y+=r+u+p}function qI(n,t,r){const{horizontalAlign:u,verticalAlign:p}=b0(r),y=t[0]-n.displaySize[0]*u,w=t[1]-n.displaySize[1]*p;return{image:n,top:w,bottom:w+n.displaySize[1],left:y,right:y+n.displaySize[0]}}function Ib(n,t,r,u,p,y){const w=n.image;let M;if(w.content){const ke=w.content,Ke=w.pixelRatio||1;M=[ke[0]/Ke,ke[1]/Ke,w.displaySize[0]-ke[2]/Ke,w.displaySize[1]-ke[3]/Ke]}const D=t.left*y,R=t.right*y;let $,W,J,oe;r==="width"||r==="both"?(oe=p[0]+D-u[3],W=p[0]+R+u[1]):(oe=p[0]+(D+R-w.displaySize[0])/2,W=oe+w.displaySize[0]);const ue=t.top*y,ye=t.bottom*y;return r==="height"||r==="both"?($=p[1]+ue-u[0],J=p[1]+ye+u[2]):($=p[1]+(ue+ye-w.displaySize[1])/2,J=$+w.displaySize[1]),{image:w,top:$,right:W,bottom:J,left:oe,collisionPadding:M}}class _d extends Me{constructor(t,r,u,p,y){super(t,r),this.angle=p,this.z=u,y!==void 0&&(this.segment=y)}clone(){return new _d(this.x,this.y,this.z,this.angle,this.segment)}}function Ab(n,t,r,u,p){if(t.segment===void 0)return!0;let y=t,w=t.segment+1,M=0;for(;M>-r/2;){if(w--,w<0)return!1;M-=n[w].dist(y),y=n[w]}M+=n[w].dist(n[w+1]),w++;const D=[];let R=0;for(;M<r/2;){const $=n[w],W=n[w+1];if(!W)return!1;let J=n[w-1].angleTo($)-$.angleTo(W);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:M,angleDelta:J}),R+=J;M-D[0].distance>u;)R-=D.shift().angleDelta;if(R>p)return!1;w++,M+=$.dist(W)}return!0}function Mb(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function kb(n,t,r){return n?.6*t*r:0}function Pb(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function ZI(n,t,r,u,p,y){const w=kb(r,p,y),M=Pb(r,u)*y;let D=0;const R=Mb(n)/2;for(let $=0;$<n.length-1;$++){const W=n[$],J=n[$+1],oe=W.dist(J);if(D+oe>R){const ue=(R-D)/oe,ye=Qn(W.x,J.x,ue),ke=Qn(W.y,J.y,ue),Ke=new _d(ye,ke,0,J.angleTo(W),$);return!w||Ab(n,Ke,M,w,t)?Ke:void 0}D+=oe}}function WI(n,t,r,u,p,y,w,M,D){const R=kb(u,y,w),$=Pb(u,p),W=$*w,J=n[0].x===0||n[0].x===D||n[0].y===0||n[0].y===D;return t-W<t/4&&(t=W+t/4),zb(n,J?t/2*M%t:($/2+2*y)*w*M%t,t,R,r,W,J,!1,D)}function zb(n,t,r,u,p,y,w,M,D){const R=y/2,$=Mb(n);let W=0,J=t-r,oe=[];for(let ue=0;ue<n.length-1;ue++){const ye=n[ue],ke=n[ue+1],Ke=ye.dist(ke),ct=ke.angleTo(ye);for(;J+r<W+Ke;){J+=r;const Xe=(J-W)/Ke,nt=Qn(ye.x,ke.x,Xe),pt=Qn(ye.y,ke.y,Xe);if(nt>=0&&nt<D&&pt>=0&&pt<D&&J-R>=0&&J+R<=$){const ht=new _d(nt,pt,0,ct,ue);ht._round(),u&&!Ab(n,ht,y,u,p)||oe.push(ht)}}W+=Ke}return M||oe.length||w||(oe=zb(n,W/2,r,u,p,y,w,!0,D)),oe}function Db(n,t,r,u,p){const y=[];for(let w=0;w<n.length;w++){const M=n[w];let D;for(let R=0;R<M.length-1;R++){let $=M[R],W=M[R+1];$.x<t&&W.x<t||($.x<t?$=new Me(t,$.y+(t-$.x)/(W.x-$.x)*(W.y-$.y))._round():W.x<t&&(W=new Me(t,$.y+(t-$.x)/(W.x-$.x)*(W.y-$.y))._round()),$.y<r&&W.y<r||($.y<r?$=new Me($.x+(r-$.y)/(W.y-$.y)*(W.x-$.x),r)._round():W.y<r&&(W=new Me($.x+(r-$.y)/(W.y-$.y)*(W.x-$.x),r)._round()),$.x>=u&&W.x>=u||($.x>=u?$=new Me(u,$.y+(u-$.x)/(W.x-$.x)*(W.y-$.y))._round():W.x>=u&&(W=new Me(u,$.y+(u-$.x)/(W.x-$.x)*(W.y-$.y))._round()),$.y>=p&&W.y>=p||($.y>=p?$=new Me($.x+(p-$.y)/(W.y-$.y)*(W.x-$.x),p)._round():W.y>=p&&(W=new Me($.x+(p-$.y)/(W.y-$.y)*(W.x-$.x),p)._round()),D&&$.equals(D[D.length-1])||(D=[$],y.push(D)),D.push(W)))))}}return y}ft(_d,"Anchor");const kg=1e20;function Lb(n,t,r,u,p,y,w,M,D){for(let R=t;R<t+u;R++)Bb(n,r*y+R,y,p,w,M,D);for(let R=r;R<r+p;R++)Bb(n,R*y+t,1,u,w,M,D)}function Bb(n,t,r,u,p,y,w){y[0]=0,w[0]=-kg,w[1]=kg,p[0]=n[t];for(let M=1,D=0,R=0;M<u;M++){p[M]=n[t+M*r];const $=M*M;do{const W=y[D];R=(p[M]-p[W]+$-W*W)/(M-W)/2}while(R<=w[D]&&--D>-1);D++,y[D]=M,w[D]=R,w[D+1]=kg}for(let M=0,D=0;M<u;M++){for(;w[D+1]<M;)D++;const R=y[D],$=M-R;n[t+M*r]=p[R]+$*$}}const w0={none:0,ideographs:1,all:2};class lm{constructor(t,r,u){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,r){const u=[];for(const p in t)for(const y of t[p])u.push({stack:p,id:y});vi(u,({stack:p,id:y},w)=>{let M=this.entries[p];M||(M=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=M.glyphs[y];if(D!==void 0)return void w(null,{stack:p,id:y,glyph:D});if(D=this._tinySDF(M,p,y),D)return M.glyphs[y]=D,void w(null,{stack:p,id:y,glyph:D});const R=Math.floor(y/256);if(256*R>65535)return void w(new Error("glyphs > 65535 not supported"));if(M.ranges[R])return void w(null,{stack:p,id:y,glyph:D});let $=M.requests[R];$||($=M.requests[R]=[],lm.loadGlyphRange(p,R,this.url,this.requestManager,(W,J)=>{if(J){M.ascender=J.ascender,M.descender=J.descender;for(const oe in J.glyphs)this._doesCharSupportLocalGlyph(+oe)||(M.glyphs[+oe]=J.glyphs[+oe]);M.ranges[R]=!0}for(const oe of $)oe(W,J);delete M.requests[R]})),$.push((W,J)=>{W?w(W):J&&w(null,{stack:p,id:y,glyph:J.glyphs[y]||null})})},(p,y)=>{if(p)r(p);else if(y){const w={};for(const{stack:M,id:D,glyph:R}of y)w[M]===void 0&&(w[M]={}),w[M].glyphs===void 0&&(w[M].glyphs={}),w[M].glyphs[D]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},w[M].ascender=this.entries[M].ascender,w[M].descender=this.entries[M].descender;r(null,w)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==w0.none&&(this.localGlyphMode===w0.all?!!this.localFontFamily:!!this.localFontFamily&&(Ua(t)||Ta(t)||xr(t)||Cr(t)||dn(t)))}_tinySDF(t,r,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let y=t.tinySDF;if(!y){let ye="400";/bold/i.test(r)?ye="900":/medium/i.test(r)?ye="500":/light/i.test(r)&&(ye="200"),y=t.tinySDF=new lm.TinySDF({fontFamily:p,fontWeight:ye,fontSize:48,buffer:6,radius:16}),y.fontWeight=ye}if(this.localGlyphs[y.fontWeight][u])return this.localGlyphs[y.fontWeight][u];const w=String.fromCharCode(u),{data:M,width:D,height:R,glyphWidth:$,glyphHeight:W,glyphLeft:J,glyphTop:oe,glyphAdvance:ue}=y.draw(w);return this.localGlyphs[y.fontWeight][u]={id:u,bitmap:new Nl({width:D,height:R},M),metrics:{width:$/2,height:W/2,left:J/2,top:oe/2-27,advance:ue/2,localGlyph:!0}}}}function Rb(n,t,r,u){const p=[],y=n.image,w=y.pixelRatio,M=y.paddedRect.w-2,D=y.paddedRect.h-2,R=n.right-n.left,$=n.bottom-n.top,W=y.stretchX||[[0,M]],J=y.stretchY||[[0,D]],oe=(Ht,si)=>Ht+si[1]-si[0],ue=W.reduce(oe,0),ye=J.reduce(oe,0),ke=M-ue,Ke=D-ye;let ct=0,Xe=ue,nt=0,pt=ye,ht=0,Vt=ke,Lt=0,ni=Ke;if(y.content&&u){const Ht=y.content;ct=_y(W,0,Ht[0]),nt=_y(J,0,Ht[1]),Xe=_y(W,Ht[0],Ht[2]),pt=_y(J,Ht[1],Ht[3]),ht=Ht[0]-ct,Lt=Ht[1]-nt,Vt=Ht[2]-Ht[0]-Xe,ni=Ht[3]-Ht[1]-pt}const wi=(Ht,si,ui,mi)=>{const Ei=yy(Ht.stretch-ct,Xe,R,n.left),Kt=vy(Ht.fixed-ht,Vt,Ht.stretch,ue),Bi=yy(si.stretch-nt,pt,$,n.top),Sn=vy(si.fixed-Lt,ni,si.stretch,ye),qi=yy(ui.stretch-ct,Xe,R,n.left),ln=vy(ui.fixed-ht,Vt,ui.stretch,ue),Oi=yy(mi.stretch-nt,pt,$,n.top),An=vy(mi.fixed-Lt,ni,mi.stretch,ye),dr=new Me(Ei,Bi),sr=new Me(qi,Bi),rr=new Me(qi,Oi),Pn=new Me(Ei,Oi),Zr=new Me(Kt/w,Sn/w),Vn=new Me(ln/w,An/w),fr=t*Math.PI/180;if(fr){const lo=Math.sin(fr),go=Math.cos(fr),wo=[go,-lo,lo,go];dr._matMult(wo),sr._matMult(wo),Pn._matMult(wo),rr._matMult(wo)}const Yr=Ht.stretch+Ht.fixed,mo=si.stretch+si.fixed;return{tl:dr,tr:sr,bl:Pn,br:rr,tex:{x:y.paddedRect.x+1+Yr,y:y.paddedRect.y+1+mo,w:ui.stretch+ui.fixed-Yr,h:mi.stretch+mi.fixed-mo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:Vn,minFontScaleX:Vt/w/R,minFontScaleY:ni/w/$,isSDF:r}};if(u&&(y.stretchX||y.stretchY)){const Ht=Ob(W,ke,ue),si=Ob(J,Ke,ye);for(let ui=0;ui<Ht.length-1;ui++){const mi=Ht[ui],Ei=Ht[ui+1];for(let Kt=0;Kt<si.length-1;Kt++)p.push(wi(mi,si[Kt],Ei,si[Kt+1]))}}else p.push(wi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:D+1}));return p}function _y(n,t,r){let u=0;for(const p of n)u+=Math.max(t,Math.min(r,p[1]))-Math.max(t,Math.min(r,p[0]));return u}function Ob(n,t,r){const u=[{fixed:-1,stretch:0}];for(const[p,y]of n){const w=u[u.length-1];u.push({fixed:p-w.stretch,stretch:w.stretch}),u.push({fixed:p-w.stretch,stretch:w.stretch+(y-p)})}return u.push({fixed:t+1,stretch:r}),u}function yy(n,t,r,u){return n/t*r+u}function vy(n,t,r,u){return n-t*r/u}function XI(n,t,r,u){const p=t+n.positionedLines[u].lineOffset;return u===0?r+p/2:r+(p+(t+n.positionedLines[u-1].lineOffset))/2}lm.loadGlyphRange=function(n,t,r,u,p){const y=256*t,w=y+255,M=u.transformRequest(u.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${y}-${w}`),Pr.Glyphs);_o(M,(D,R)=>{if(D)p(D);else if(R){const $={},W=function(J){return new ka(J).readFields(x0,{})}(R);for(const J of W.glyphs)$[J.id]=J;p(null,{glyphs:$,ascender:W.ascender,descender:W.descender})}})},lm.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:r=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=r;const M=this.size=n+4*t,D=this._createCanvas(M),R=this.ctx=D.getContext("2d",{willReadFrequently:!0});R.font=`${w} ${y} ${n}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(n),w=Math.ceil(r),M=Math.min(this.size-this.buffer,Math.ceil(y-p)),D=Math.min(this.size-this.buffer,w+Math.ceil(u)),R=M+2*this.buffer,$=D+2*this.buffer,W=Math.max(R*$,0),J=new Uint8ClampedArray(W),oe={data:J,width:R,height:$,glyphWidth:M,glyphHeight:D,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(M===0||D===0)return oe;const{ctx:ue,buffer:ye,gridInner:ke,gridOuter:Ke}=this;ue.clearRect(ye,ye,M,D),ue.fillText(n,ye,ye+w);const ct=ue.getImageData(ye,ye,M,D);Ke.fill(kg,0,W),ke.fill(0,0,W);for(let Xe=0;Xe<D;Xe++)for(let nt=0;nt<M;nt++){const pt=ct.data[4*(Xe*M+nt)+3]/255;if(pt===0)continue;const ht=(Xe+ye)*R+nt+ye;if(pt===1)Ke[ht]=0,ke[ht]=kg;else{const Vt=.5-pt;Ke[ht]=Vt>0?Vt*Vt:0,ke[ht]=Vt<0?Vt*Vt:0}}Lb(Ke,0,0,R,$,R,this.f,this.v,this.z),Lb(ke,ye,ye,M,D,R,this.f,this.v,this.z);for(let Xe=0;Xe<W;Xe++){const nt=Math.sqrt(Ke[Xe])-Math.sqrt(ke[Xe]);J[Xe]=Math.round(255-255*(nt/this.radius+this.cutoff))}return oe}};class HI{constructor(t=[],r=KI){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:u}=this,p=r[t];for(;t>0;){const y=t-1>>1,w=r[y];if(u(p,w)>=0)break;r[t]=w,t=y}r[t]=p}_down(t){const{data:r,compare:u}=this,p=this.length>>1,y=r[t];for(;t<p;){let w=1+(t<<1),M=r[w];const D=w+1;if(D<this.length&&u(r[D],M)<0&&(w=D,M=r[D]),u(M,y)>=0)break;r[t]=M,t=w}r[t]=y}}function KI(n,t){return n<t?-1:n>t?1:0}function YI(n,t=1,r=!1){let u=1/0,p=1/0,y=-1/0,w=-1/0;const M=n[0];for(let oe=0;oe<M.length;oe++){const ue=M[oe];(!oe||ue.x<u)&&(u=ue.x),(!oe||ue.y<p)&&(p=ue.y),(!oe||ue.x>y)&&(y=ue.x),(!oe||ue.y>w)&&(w=ue.y)}const D=Math.min(y-u,w-p);let R=D/2;const $=new HI([],JI);if(D===0)return new Me(u,p);for(let oe=u;oe<y;oe+=D)for(let ue=p;ue<w;ue+=D)$.push(new cm(oe+R,ue+R,R,n));let W=function(oe){let ue=0,ye=0,ke=0;const Ke=oe[0];for(let ct=0,Xe=Ke.length,nt=Xe-1;ct<Xe;nt=ct++){const pt=Ke[ct],ht=Ke[nt],Vt=pt.x*ht.y-ht.x*pt.y;ye+=(pt.x+ht.x)*Vt,ke+=(pt.y+ht.y)*Vt,ue+=3*Vt}return new cm(ye/ue,ke/ue,0,oe)}(n),J=$.length;for(;$.length;){const oe=$.pop();(oe.d>W.d||!W.d)&&(W=oe,r&&console.log("found best %d after %d probes",Math.round(1e4*oe.d)/1e4,J)),oe.max-W.d<=t||(R=oe.h/2,$.push(new cm(oe.p.x-R,oe.p.y-R,R,n)),$.push(new cm(oe.p.x+R,oe.p.y-R,R,n)),$.push(new cm(oe.p.x-R,oe.p.y+R,R,n)),$.push(new cm(oe.p.x+R,oe.p.y+R,R,n)),J+=4)}return r&&(console.log(`num probes: ${J}`),console.log(`best distance: ${W.d}`)),W.p}function JI(n,t){return t.max-n.max}function cm(n,t,r,u){this.p=new Me(n,t),this.h=r,this.d=function(p,y){let w=!1,M=1/0;for(let D=0;D<y.length;D++){const R=y[D];for(let $=0,W=R.length,J=W-1;$<W;J=$++){const oe=R[$],ue=R[J];oe.y>p.y!=ue.y>p.y&&p.x<(ue.x-oe.x)*(p.y-oe.y)/(ue.y-oe.y)+oe.x&&(w=!w),M=Math.min(M,lg(p,oe,ue))}}return(w?1:-1)*Math.sqrt(M)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const T0=Number.POSITIVE_INFINITY,QI=Math.sqrt(2);function Fb(n,[t,r]){let u=0,p=0;if(r===T0){t<0&&(t=0);const y=t/QI;switch(n){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-t;break;case"top":p=t-7}switch(n){case"top-right":case"bottom-right":u=-y;break;case"top-left":case"bottom-left":u=y;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),n){case"top-right":case"top-left":case"top":p=r-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-r}switch(n){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,p]}function eA(n,t,r,u,p,y,w,M,D,R){n.createArrays(),n.tilePixelRatio=In/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const $=n.layers[0].layout,W=n.layers[0]._unevaluatedLayout._values,J={};if(n.textSizeData.kind==="composite"){const{minZoom:ye,maxZoom:ke}=n.textSizeData;J.compositeTextSizes=[W["text-size"].possiblyEvaluate(new Et(ye),M),W["text-size"].possiblyEvaluate(new Et(ke),M)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ye,maxZoom:ke}=n.iconSizeData;J.compositeIconSizes=[W["icon-size"].possiblyEvaluate(new Et(ye),M),W["icon-size"].possiblyEvaluate(new Et(ke),M)]}J.layoutTextSize=W["text-size"].possiblyEvaluate(new Et(D+1),M),J.layoutIconSize=W["icon-size"].possiblyEvaluate(new Et(D+1),M),J.textMaxSize=W["text-size"].possiblyEvaluate(new Et(18),M);const oe=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",ue=$.get("text-size");for(const ye of n.features){const ke=$.get("text-font").evaluate(ye,{},M).join(","),Ke=ue.evaluate(ye,{},M),ct=J.layoutTextSize.evaluate(ye,{},M),Xe=(J.layoutIconSize.evaluate(ye,{},M),{horizontal:{},vertical:void 0}),nt=ye.text;let pt,ht=[0,0];if(nt){const ni=nt.toString(),wi=$.get("text-letter-spacing").evaluate(ye,{},M)*qr,Ht=$.get("text-line-height").evaluate(ye,{},M)*qr,si=V(ni)?wi:0,ui=$.get("text-anchor").evaluate(ye,{},M),mi=$.get("text-variable-anchor");if(!mi){const qi=$.get("text-radial-offset").evaluate(ye,{},M);ht=qi?Fb(ui,[qi*qr,T0]):$.get("text-offset").evaluate(ye,{},M).map(ln=>ln*qr)}let Ei=oe?"center":$.get("text-justify").evaluate(ye,{},M);const Kt=$.get("symbol-placement")==="point",Bi=Kt?$.get("text-max-width").evaluate(ye,{},M)*qr:1/0,Sn=qi=>{n.allowVerticalPlacement&&O(ni)&&(Xe.vertical=Ju(nt,t,r,p,ke,Bi,Ht,ui,qi,si,ht,Js.vertical,!0,ct,Ke))};if(!oe&&mi){const qi=Ei==="auto"?mi.map(Oi=>E0(Oi)):[Ei];let ln=!1;for(let Oi=0;Oi<qi.length;Oi++){const An=qi[Oi];if(!Xe.horizontal[An])if(ln)Xe.horizontal[An]=Xe.horizontal[0];else{const dr=Ju(nt,t,r,p,ke,Bi,Ht,"center",An,si,ht,Js.horizontal,!1,ct,Ke);dr&&(Xe.horizontal[An]=dr,ln=dr.positionedLines.length===1)}}Sn("left")}else{if(Ei==="auto"&&(Ei=E0(ui)),Kt||$.get("text-writing-mode").indexOf("horizontal")>=0||!O(ni)){const qi=Ju(nt,t,r,p,ke,Bi,Ht,ui,Ei,si,ht,Js.horizontal,!1,ct,Ke);qi&&(Xe.horizontal[Ei]=qi)}Sn(Kt?"left":Ei)}}let Vt=!1;if(ye.icon&&ye.icon.name){const ni=u[ye.icon.name];ni&&(pt=qI(p[ye.icon.name],$.get("icon-offset").evaluate(ye,{},M),$.get("icon-anchor").evaluate(ye,{},M)),Vt=ni.sdf,n.sdfIcons===void 0?n.sdfIcons=ni.sdf:n.sdfIcons!==ni.sdf&&at("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ni.pixelRatio!==n.pixelRatio||$.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Lt=Nb(Xe.horizontal)||Xe.vertical;n.iconsInText||(n.iconsInText=!!Lt&&Lt.iconsInText),(Lt||pt)&&tA(n,ye,Xe,pt,u,J,ct,0,ht,Vt,w,M,R)}y&&n.generateCollisionDebugBuffers(D,n.collisionBoxArray)}function E0(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tA(n,t,r,u,p,y,w,M,D,R,$,W,J){let oe=y.textMaxSize.evaluate(t,{},W);oe===void 0&&(oe=w);const ue=n.layers[0].layout,ye=ue.get("icon-offset").evaluate(t,{},W),ke=Nb(r.horizontal)||r.vertical,Ke=J.name==="globe",ct=w/24,Xe=n.tilePixelRatio*oe/24,nt=(si=n.overscaling,n.zoom>18&&si>2&&(si>>=1),Math.max(In/(512*si),1)*ue.get("symbol-spacing")),pt=ue.get("text-padding")*n.tilePixelRatio,ht=ue.get("icon-padding")*n.tilePixelRatio,Vt=gt(ue.get("text-max-angle")),Lt=ue.get("text-rotation-alignment")==="map"&&ue.get("symbol-placement")!=="point",ni=ue.get("icon-rotation-alignment")==="map"&&ue.get("symbol-placement")!=="point",wi=ue.get("symbol-placement"),Ht=nt/2;var si;const ui=ue.get("icon-text-fit");let mi;u&&ui!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(mi=Ib(u,r.vertical,ui,ue.get("icon-text-fit-padding"),ye,ct)),ke&&(u=Ib(u,ke,ui,ue.get("icon-text-fit-padding"),ye,ct)));const Ei=(Kt,Bi,Sn)=>{if(Bi.x<0||Bi.x>=In||Bi.y<0||Bi.y>=In)return;let qi=null;if(Ke){const{x:ln,y:Oi,z:An}=J.projectTilePoint(Bi.x,Bi.y,Sn);qi={anchor:new _d(ln,Oi,An,0,void 0),up:J.upVector(Sn,Bi.x,Bi.y)}}(function(ln,Oi,An,dr,sr,rr,Pn,Zr,Vn,fr,Yr,mo,lo,go,wo,Ko,Qs,Wr,_s,ps,kr,Ro,Is,Jr,cs){const Pa=ln.addToLineVertexArray(Oi,dr);let ea,ta,Xa,ia,vd,gm,Ug,$g=0,Ew=0,Sw=0,Cw=0,U0=-1,$0=-1;const Mh={};let Iw=Gd.exports("");const op=An?An.anchor:Oi;let j0=0,G0=0;if(Vn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[j0,G0]=Vn.layout.get("text-offset").evaluate(kr,{},cs).map($l=>$l*qr):(j0=Vn.layout.get("text-radial-offset").evaluate(kr,{},cs)*qr,G0=T0),ln.allowVerticalPlacement&&sr.vertical){const $l=sr.vertical;if(wo)gm=S0($l),Zr&&(Ug=S0(Zr));else{const jl=Vn.layout.get("text-rotate").evaluate(kr,{},cs)+90;Xa=xy(fr,op,Oi,Yr,mo,lo,$l,go,jl,Ko),Zr&&(ia=xy(fr,op,Oi,Yr,mo,lo,Zr,Wr,jl))}}if(rr){const $l=Vn.layout.get("icon-rotate").evaluate(kr,{},cs),jl=Vn.layout.get("icon-text-fit")!=="none",jg=Rb(rr,$l,Is,jl),Z0=Zr?Rb(Zr,$l,Is,jl):void 0;ta=xy(fr,op,Oi,Yr,mo,lo,rr,Wr,$l),$g=4*jg.length;const Aw=ln.iconSizeData;let sp=null;Aw.kind==="source"?(sp=[jo*Vn.layout.get("icon-size").evaluate(kr,{},cs)],sp[0]>ff&&at(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Aw.kind==="composite"&&(sp=[jo*Ro.compositeIconSizes[0].evaluate(kr,{},cs),jo*Ro.compositeIconSizes[1].evaluate(kr,{},cs)],(sp[0]>ff||sp[1]>ff)&&at(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ln.addSymbols(ln.icon,jg,sp,ps,_s,kr,!1,An,Oi,Pa.lineStartIndex,Pa.lineLength,-1,Jr,cs),U0=ln.icon.placedSymbolArray.length-1,Z0&&(Ew=4*Z0.length,ln.addSymbols(ln.icon,Z0,sp,ps,_s,kr,Js.vertical,An,Oi,Pa.lineStartIndex,Pa.lineLength,-1,Jr,cs),$0=ln.icon.placedSymbolArray.length-1)}for(const $l in sr.horizontal){const jl=sr.horizontal[$l];ea||(Iw=Gd.exports(jl.text),wo?vd=S0(jl):ea=xy(fr,op,Oi,Yr,mo,lo,jl,go,Vn.layout.get("text-rotate").evaluate(kr,{},cs),Ko));const jg=jl.positionedLines.length===1;if(Sw+=Vb(ln,An,Oi,jl,Pn,Vn,wo,kr,Ko,Pa,sr.vertical?Js.horizontal:Js.horizontalOnly,jg?Object.keys(sr.horizontal):[$l],Mh,U0,Ro,Jr,cs),jg)break}sr.vertical&&(Cw+=Vb(ln,An,Oi,sr.vertical,Pn,Vn,wo,kr,Ko,Pa,Js.vertical,["vertical"],Mh,$0,Ro,Jr,cs));let vf=-1;const q0=($l,jl)=>$l?Math.max($l,jl):jl;vf=q0(vd,vf),vf=q0(gm,vf),vf=q0(Ug,vf);const DA=vf>-1?1:0;ln.glyphOffsetArray.length>=mf.MAX_GLYPHS&&at("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),kr.sortKey!==void 0&&ln.addToSortKeyRanges(ln.symbolInstances.length,kr.sortKey),ln.symbolInstances.emplaceBack(op.x,op.y,op.z,Oi.x,Oi.y,Mh.right>=0?Mh.right:-1,Mh.center>=0?Mh.center:-1,Mh.left>=0?Mh.left:-1,Mh.vertical>=0?Mh.vertical:-1,U0,$0,Iw,ea!==void 0?ea:ln.collisionBoxArray.length,ea!==void 0?ea+1:ln.collisionBoxArray.length,Xa!==void 0?Xa:ln.collisionBoxArray.length,Xa!==void 0?Xa+1:ln.collisionBoxArray.length,ta!==void 0?ta:ln.collisionBoxArray.length,ta!==void 0?ta+1:ln.collisionBoxArray.length,ia||ln.collisionBoxArray.length,ia?ia+1:ln.collisionBoxArray.length,Yr,Sw,Cw,$g,Ew,DA,0,j0,G0,vf)})(n,Bi,qi,Kt,r,u,p,mi,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,pt,Lt,D,0,ht,ni,ye,t,y,R,$,W)};if(wi==="line")for(const Kt of Db(t.geometry,0,0,In,In)){const Bi=WI(Kt,nt,Vt,r.vertical||ke,u,24,Xe,n.overscaling,In);for(const Sn of Bi){const qi=ke;qi&&iA(n,qi.text,Ht,Sn)||Ei(Kt,Sn,W)}}else if(wi==="line-center"){for(const Kt of t.geometry)if(Kt.length>1){const Bi=ZI(Kt,Vt,r.vertical||ke,u,24,Xe);Bi&&Ei(Kt,Bi,W)}}else if(t.type==="Polygon")for(const Kt of tm(t.geometry,0)){const Bi=YI(Kt,16);Ei(Kt[0],new _d(Bi.x,Bi.y,0,0,void 0),W)}else if(t.type==="LineString")for(const Kt of t.geometry)Ei(Kt,new _d(Kt[0].x,Kt[0].y,0,0,void 0),W);else if(t.type==="Point")for(const Kt of t.geometry)for(const Bi of Kt)Ei([Bi],new _d(Bi.x,Bi.y,0,0,void 0),W)}const ff=32640;function Vb(n,t,r,u,p,y,w,M,D,R,$,W,J,oe,ue,ye,ke){const Ke=function(nt,pt,ht,Vt,Lt,ni,wi,Ht){const si=[];if(pt.positionedLines.length===0)return si;const ui=Vt.layout.get("text-rotate").evaluate(ni,{})*Math.PI/180,mi=function(qi){const ln=qi[0],Oi=qi[1],An=ln*Oi;return An>0?[ln,-Oi]:An<0?[-ln,Oi]:ln===0?[Oi,ln]:[Oi,-ln]}(ht);let Ei=Math.abs(pt.top-pt.bottom);for(const qi of pt.positionedLines)Ei-=qi.lineOffset;const Kt=pt.positionedLines.length,Bi=Ei/Kt;let Sn=pt.top-ht[1];for(let qi=0;qi<Kt;++qi){const ln=pt.positionedLines[qi];Sn=XI(pt,Bi,Sn,qi);for(const Oi of ln.positionedGlyphs){if(!Oi.rect)continue;const An=Oi.rect||{};let dr=4,sr=!0,rr=1,Pn=0;if(Oi.imageName){const Jr=wi[Oi.imageName];if(!Jr)continue;if(Jr.sdf){at("SDF images are not supported in formatted text and will be ignored.");continue}sr=!1,rr=Jr.pixelRatio,dr=1/rr}const Zr=(Lt||Ht)&&Oi.vertical,Vn=Oi.metrics.advance*Oi.scale/2,fr=Oi.metrics,Yr=Oi.rect;if(Yr===null)continue;Ht&&pt.verticalizable&&(Pn=Oi.imageName?Vn-Oi.metrics.width*Oi.scale/2:0);const mo=Lt?[Oi.x+Vn,Oi.y]:[0,0];let lo=[0,0],go=[0,0],wo=!1;Lt||(Zr?(go=[Oi.x+Vn+mi[0],Oi.y+mi[1]-Pn],wo=!0):lo=[Oi.x+Vn+ht[0],Oi.y+ht[1]-Pn]);const Ko=Yr.w*Oi.scale/(rr*(Oi.localGlyph?2:1)),Qs=Yr.h*Oi.scale/(rr*(Oi.localGlyph?2:1));let Wr,_s,ps,kr;if(Zr){const Jr=Oi.y-Sn,cs=new Me(-Vn,Vn-Jr),Pa=-Math.PI/2,ea=new Me(...go);Wr=new Me(-Vn+lo[0],lo[1]),Wr._rotateAround(Pa,cs)._add(ea),Wr.x+=-Jr+Vn,Wr.y-=(fr.left-dr)*Oi.scale;const ta=Oi.imageName?fr.advance*Oi.scale:qr*Oi.scale,Xa=String.fromCharCode(Oi.glyph);Ul(Xa)?Wr.x+=(1-dr)*Oi.scale:gc(Xa)?Wr.x+=ta-fr.height*Oi.scale+(-dr-1)*Oi.scale:Wr.x+=Oi.imageName||fr.width+2*dr===Yr.w&&fr.height+2*dr===Yr.h?(ta-Qs)/2:(ta-(fr.height+2*dr)*Oi.scale)/2,_s=new Me(Wr.x,Wr.y-Ko),ps=new Me(Wr.x+Qs,Wr.y),kr=new Me(Wr.x+Qs,Wr.y-Ko)}else{const Jr=(fr.left-dr)*Oi.scale-Vn+lo[0],cs=(-fr.top-dr)*Oi.scale+lo[1],Pa=Jr+Ko,ea=cs+Qs;Wr=new Me(Jr,cs),_s=new Me(Pa,cs),ps=new Me(Jr,ea),kr=new Me(Pa,ea)}if(ui){let Jr;Jr=Lt?new Me(0,0):wo?new Me(mi[0],mi[1]):new Me(ht[0],ht[1]),Wr._rotateAround(ui,Jr),_s._rotateAround(ui,Jr),ps._rotateAround(ui,Jr),kr._rotateAround(ui,Jr)}const Ro=new Me(0,0),Is=new Me(0,0);si.push({tl:Wr,tr:_s,bl:ps,br:kr,tex:An,writingMode:pt.writingMode,glyphOffset:mo,sectionIndex:Oi.sectionIndex,isSDF:sr,pixelOffsetTL:Ro,pixelOffsetBR:Is,minFontScaleX:0,minFontScaleY:0})}}return si}(0,u,D,y,w,M,p,n.allowVerticalPlacement),ct=n.textSizeData;let Xe=null;ct.kind==="source"?(Xe=[jo*y.layout.get("text-size").evaluate(M,{},ke)],Xe[0]>ff&&at(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ct.kind==="composite"&&(Xe=[jo*ue.compositeTextSizes[0].evaluate(M,{},ke),jo*ue.compositeTextSizes[1].evaluate(M,{},ke)],(Xe[0]>ff||Xe[1]>ff)&&at(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,Ke,Xe,D,w,M,$,t,r,R.lineStartIndex,R.lineLength,oe,ye,ke);for(const nt of W)J[nt]=n.text.placedSymbolArray.length-1;return 4*Ke.length}function Nb(n){for(const t in n)return n[t];return null}function xy(n,t,r,u,p,y,w,M,D,R){let $=w.top,W=w.bottom,J=w.left,oe=w.right;const ue=w.collisionPadding;if(ue&&(J-=ue[0],$-=ue[1],oe+=ue[2],W+=ue[3]),D){const ye=new Me(J,$),ke=new Me(oe,$),Ke=new Me(J,W),ct=new Me(oe,W),Xe=gt(D);let nt=new Me(0,0);R&&(nt=new Me(R[0],R[1])),ye._rotateAround(Xe,nt),ke._rotateAround(Xe,nt),Ke._rotateAround(Xe,nt),ct._rotateAround(Xe,nt),J=Math.min(ye.x,ke.x,Ke.x,ct.x),oe=Math.max(ye.x,ke.x,Ke.x,ct.x),$=Math.min(ye.y,ke.y,Ke.y,ct.y),W=Math.max(ye.y,ke.y,Ke.y,ct.y)}return n.emplaceBack(t.x,t.y,t.z,r.x,r.y,J,$,oe,W,M,u,p,y),n.length-1}function S0(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function iA(n,t,r,u){const p=n.compareText;if(t in p){const y=p[t];for(let w=y.length-1;w>=0;w--)if(u.dist(y[w])<r)return!0}else p[t]=[];return p[t].push(u),!1}const nA=Yi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ub}=nA,$b=Yi([{name:"a_pos_3",components:3,type:"Int16"}]);var Pg=Yi([{name:"a_pos",type:"Int16",components:2}]);const yd=In/Math.PI/2,C0=2*Fl(1,0)*yd*Math.PI,um=64,hm=[um,32,16],ou=-yd,su=yd,rA=[new Xs([ou,ou,ou],[su,su,su]),new Xs([ou,ou,ou],[0,0,su]),new Xs([0,ou,ou],[su,0,su]),new Xs([ou,0,ou],[0,su,su]),new Xs([0,0,ou],[su,su,su])];function jb(n,t,r,u=!0){const p=pa([],n._camera.position,n.worldSize),y=[t,r,1,1];fd(y,y,n.pixelMatrixInverse),Wp(y,y,1/y[3]);const w=hs([],pc([],y,p)),M=n.globeMatrix,D=[M[12],M[13],M[14]],R=pc([],D,p),$=Kd(R),W=hs([],R),J=n.worldSize/(2*Math.PI),oe=Aa(W,w),ue=Math.asin(J/$);if(ue<Math.acos(oe)){if(!u)return null;const wi=[],Ht=[];pa(wi,w,$/oe),hs(Ht,pc(Ht,wi,R)),hs(w,Xu(w,R,pa(w,Ht,Math.tan(ue)*$)))}const ye=[];new Hp(p,w).closestPointOnSphere(D,J,ye);const ke=hs([],Pi(M,0)),Ke=hs([],Pi(M,1)),ct=hs([],Pi(M,2)),Xe=Aa(ke,ye),nt=Aa(Ke,ye),pt=Aa(ct,ye),ht=vt(Math.asin(-nt/J));let Vt=vt(Math.atan2(Xe,pt));Vt=n.center.lng+function(wi,Ht){const si=(Ht-wi+180)%360-180;return si<-180?si+360:si}(n.center.lng,Vt);const Lt=fc(Vt),ni=Wt(Qc(ht),0,1);return new Wd(Lt,ni)}class oA{constructor(t,r,u){this.a=pc([],t,u),this.b=pc([],r,u),this.center=u;const p=hs([],this.a),y=hs([],this.b);this.angle=Math.acos(Aa(p,y))}}function I0(n,t){if(n.angle===0)return null;let r;return r=n.a[t]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(u,p,y,w){const M=Math.sin(y);return u*(Math.sin((1-w)*y)/M)+p*(Math.sin(w*y)/M)}(n.a[t],n.b[t],n.angle,Wt(r,0,1))+n.center[t]}function Sh(n){if(n.z<=1)return rA[n.z+2*n.y+n.x];const t=A0(by(n));return Xs.fromPoints(t)}function ip(n,t,r){return pa(n,n,1-r),Hu(n,n,t,r)}function Gb(n,t){const r=fm(t.zoom);if(r===0)return Sh(n);const u=by(n),p=A0(u),y=fc(u.getWest())*t.worldSize,w=fc(u.getEast())*t.worldSize,M=Qc(u.getNorth())*t.worldSize,D=Qc(u.getSouth())*t.worldSize,R=[y,M,0],$=[w,M,0],W=[y,D,0],J=[w,D,0],oe=hg([],t.globeMatrix);return Uo(R,R,oe),Uo($,$,oe),Uo(W,W,oe),Uo(J,J,oe),p[0]=ip(p[0],W,r),p[1]=ip(p[1],J,r),p[2]=ip(p[2],$,r),p[3]=ip(p[3],R,r),Xs.fromPoints(p)}function qb(n,t,r){for(const u of n)Uo(u,u,t),pa(u,u,r)}function sA(n,t,r){const u=t/n.worldSize,p=n.globeMatrix;if(r.z<=1){const Lt=Sh(r).getCorners();return qb(Lt,p,u),Xs.fromPoints(Lt)}const y=by(r),w=A0(y);qb(w,p,u);const M=Number.MAX_VALUE,D=[-M,-M,-M],R=[M,M,M];if(y.contains(n.center)){for(const wi of w)dd(R,R,wi),Jd(D,D,wi);D[2]=0;const Lt=n.point,ni=[Lt.x*u,Lt.y*u,0];return dd(R,R,ni),Jd(D,D,ni),new Xs(R,D)}const $=[p[12]*u,p[13]*u,p[14]*u],W=y.getCenter(),J=Wt(n.center.lat,-85.051129,Ga),oe=Wt(W.lat,-85.051129,Ga),ue=fc(n.center.lng),ye=Qc(J);let ke=ue-fc(W.lng);const Ke=ye-Qc(oe);ke>.5?ke-=1:ke<-.5&&(ke+=1);let ct=0;Math.abs(ke)>Math.abs(Ke)?ct=ke>=0?1:3:(ct=Ke>=0?0:2,Hu($,$,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(gt(Ke>=0?y.getSouth():y.getNorth()))*yd));const Xe=w[ct],nt=w[(ct+1)%4],pt=new oA(Xe,nt,$),ht=[I0(pt,0)||Xe[0],I0(pt,1)||Xe[1],I0(pt,2)||Xe[2]],Vt=fm(n.zoom);if(Vt>0){const Lt=function({x:wi,y:Ht,z:si},ui,mi,Ei,Kt){const Bi=1/(1<<si);let Sn=wi*Bi,qi=Sn+Bi,ln=Ht*Bi,Oi=ln+Bi,An=0;const dr=(Sn+qi)/2-Ei;return dr>.5?An=-1:dr<-.5&&(An=1),Sn=((Sn+An)*ui-(Ei*=ui))*mi+Ei,qi=((qi+An)*ui-Ei)*mi+Ei,ln=(ln*ui-(Kt*=ui))*mi+Kt,Oi=(Oi*ui-Kt)*mi+Kt,[[Sn,Oi,0],[qi,Oi,0],[qi,ln,0],[Sn,ln,0]]}(r,t,n._pixelsPerMercatorPixel,ue,ye);for(let wi=0;wi<w.length;wi++)ip(w[wi],Lt[wi],Vt);const ni=Xu([],Lt[ct],Lt[(ct+1)%4]);pa(ni,ni,.5),ip(ht,ni,Vt)}for(const Lt of w)dd(R,R,Lt),Jd(D,D,Lt);return R[2]=Math.min(Xe[2],nt[2]),dd(R,R,ht),Jd(D,D,ht),new Xs(R,D)}function by({x:n,y:t,z:r}){const u=1/(1<<r),p=new wr(_l(n*u),Ls((t+1)*u)),y=new wr(_l((n+1)*u),Ls(t*u));return new gl(p,y)}function A0(n){const t=gt(n.getNorth()),r=gt(n.getSouth()),u=Math.cos(t),p=Math.cos(r),y=Math.sin(t),w=Math.sin(r),M=n.getWest(),D=n.getEast();return[dm(p,w,M),dm(p,w,D),dm(u,y,D),dm(u,y,M)]}function dm(n,t,r,u=yd){return r=gt(r),[n*Math.sin(r)*u,-t*u,n*Math.cos(r)*u]}function zg(n,t,r){return dm(Math.cos(gt(n)),Math.sin(gt(n)),t,r)}function Dg(n,t,r,u){const p=1<<r.z,y=(n/In+r.x)/p;return zg(Ls((t/In+r.y)/p),_l(y),u)}function wy({min:n,max:t}){return 16383/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const Zb=new Float64Array(16);function Lg(n){const t=wy(n),r=H_(Zb,[t,t,t]);return Gf(r,r,((u=[])[0]=-(p=n.min)[0],u[1]=-p[1],u[2]=-p[2],u));var u,p}function M0(n){const t=(u=n.min,(r=Zb)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=u[0],r[13]=u[1],r[14]=u[2],r[15]=1,r);var r,u;const p=1/wy(n);return ud(t,t,[p,p,p])}function Wb(n,t,r,u,p){const y=function(D){const R=In/(2*Math.PI);return D/(2*Math.PI)/R}(r),w=[n,t,-r/(2*Math.PI)],M=Vl(new Float64Array(16));return Gf(M,M,w),ud(M,M,[y,y,y]),dg(M,M,gt(-p)),Zp(M,M,gt(-u)),M}function fm(n){return zt(5,6,n)}function Xb(n,t){const r=zg(t.lat,t.lng),u=function(ue){const ye=zg(ue._center.lat,ue._center.lng);let ke=Qd([],Yd(0,1,0),ye);const Ke=K_([],-ue.angle,ye);ke=Uo(ke,ke,Ke),K_(Ke,-ue._pitch,ke);const ct=hs([],ye);return pa(ct,ct,ue.cameraToCenterDistance/ue.pixelsPerMeter*C0),Uo(ct,ct,Ke),Xu([],ye,ct)}(n);return w=(p=fg([],u,r))[0],M=p[1],D=p[2],R=(y=r)[0],$=y[1],W=y[2],oe=(J=Math.sqrt(w*w+M*M+D*D)*Math.sqrt(R*R+$*$+W*W))&&Aa(p,y)/J,Math.acos(Math.min(Math.max(oe,-1),1));var p,y,w,M,D,R,$,W,J,oe}function k0(n,t){return Xb(n,t)>Math.PI/2*1.01}const Hb=gt(85),aA=Math.cos(Hb),lA=Math.sin(Hb);function Kb(n,t){const r=n.fovAboveCenter,u=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,p=(n._camera.position[2]*n.worldSize-u)/Math.cos(n._pitch),y=Math.sin(r)*p/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),w=Math.sin(n._pitch)*y+p;return Math.min(1.01*w,p*(1/n._horizonShift))}function np(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const r=Math.pow(2,-n.z),u=n.x*r,p=(n.x+1)*r,y=n.y*r,w=(n.y+1)*r,M=_l(u),D=_l(p),R=Ls(y),$=Ls(w),W=t.project(M,R),J=t.project(D,R),oe=t.project(D,$),ue=t.project(M,$);let ye=Math.min(W.x,J.x,oe.x,ue.x),ke=Math.min(W.y,J.y,oe.y,ue.y),Ke=Math.max(W.x,J.x,oe.x,ue.x),ct=Math.max(W.y,J.y,oe.y,ue.y);const Xe=r/16;function nt(ht,Vt,Lt,ni,wi,Ht){const si=(Lt+wi)/2,ui=(ni+Ht)/2,mi=t.project(_l(si),Ls(ui)),Ei=Math.max(0,ye-mi.x,ke-mi.y,mi.x-Ke,mi.y-ct);ye=Math.min(ye,mi.x),Ke=Math.max(Ke,mi.x),ke=Math.min(ke,mi.y),ct=Math.max(ct,mi.y),Ei>Xe&&(nt(ht,mi,Lt,ni,si,ui),nt(mi,Vt,si,ui,wi,Ht))}nt(W,J,u,y,p,y),nt(J,oe,p,y,p,w),nt(oe,ue,p,w,u,w),nt(ue,W,u,w,u,y),ye-=Xe,ke-=Xe,Ke+=Xe,ct+=Xe;const pt=1/Math.max(Ke-ye,ct-ke);return{scale:pt,x:ye*pt,y:ke*pt,x2:Ke*pt,y2:ct*pt,projection:t}}const cA=Vl(new Float32Array(16));class pf{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new wr(0,0)}projectTilePoint(t,r,u){return{x:t,y:r,z:0}}locationPoint(t,r,u=!0){return t._coordinatePoint(t.locationCoordinate(r),u)}pixelsPerMeter(t,r){return Fl(1,t)*r}pixelSpaceConversion(t,r,u){return 1}farthestPixelDistance(t){return Kb(t,t.pixelsPerMeter)}pointCoordinate(t,r,u,p){const y=t.horizonLineFromTop(!1),w=new Me(r,Math.max(y,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(w,p))}pointCoordinate3D(t,r,u){const p=new Me(r,u);if(t.elevation)return t.elevation.pointCoordinate(p);{const y=this.pointCoordinate(t,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(t,r){if(t.elevation)return!this.pointCoordinate3D(t,r.x,r.y);const u=t.horizonLineFromTop();return r.y<u}createInversionMatrix(t,r){return cA}createTileMatrix(t,r,u){let p,y,w;const M=u.canonical,D=Vl(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=np(M,this);p=1,y=R.x+u.wrap*R.scale,w=R.y,ud(D,D,[p/R.scale,p/R.scale,t.pixelsPerMeter/r])}else p=r/t.zoomScale(M.z),y=(M.x+Math.pow(2,M.z)*u.wrap)*p,w=M.y*p;return Gf(D,D,[y,w,0]),ud(D,D,[p/In,p/In,1]),D}upVector(t,r,u){return[0,0,1]}upVectorScale(t,r,u){return{metersToTile:1}}}class uA extends pf{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,u]=this.parallels=t.parallels||[29.5,45.5],p=Math.sin(gt(r));this.n=(p+Math.sin(gt(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:u,c:p,r0:y}=this,w=gt(t-this.center[0]),M=gt(r),D=Math.sqrt(p-2*u*Math.sin(M))/u;return{x:D*Math.sin(w*u),y:D*Math.cos(w*u)-y,z:0}}unproject(t,r){const{n:u,c:p,r0:y}=this,w=y+r;let M=Math.atan2(t,Math.abs(w))*Math.sign(w);w*u<0&&(M-=Math.PI*Math.sign(t)*Math.sign(w));const D=gt(this.center[0])*u;M=Yt(M,-Math.PI-D,Math.PI-D);const R=Wt(vt(M/u)+this.center[0],-180,180),$=Math.asin(Wt((p-(t*t+w*w)*u*u)/(2*u),-1,1)),W=Wt(vt($),-85.051129,Ga);return new wr(R,W)}}const Bg=1.340264,Rg=-.081106,Og=893e-6,Fg=.003796,Ty=Math.sqrt(3)/2;class hA extends pf{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const u=Math.asin(Ty*Math.sin(r)),p=u*u,y=p*p*p;return{x:.5*(t*Math.cos(u)/(Ty*(Bg+3*Rg*p+y*(7*Og+9*Fg*p)))/Math.PI+.5),y:1-.5*(u*(Bg+Rg*p+y*(Og+Fg*p))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let u=r=(2*(1-r)-1)*Math.PI,p=u*u,y=p*p*p;for(let $,W,J,oe=0;oe<12&&(W=u*(Bg+Rg*p+y*(Og+Fg*p))-r,J=Bg+3*Rg*p+y*(7*Og+9*Fg*p),$=W/J,u=Wt(u-$,-Math.PI/3,Math.PI/3),p=u*u,y=p*p*p,!(Math.abs($)<1e-12));++oe);const w=Ty*t*(Bg+3*Rg*p+y*(7*Og+9*Fg*p))/Math.cos(u),M=Math.asin(Math.sin(u)/Ty),D=Wt(180*w/Math.PI,-180,180),R=Wt(180*M/Math.PI,-85.051129,Ga);return new wr(D,R)}}class dA extends pf{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const u=360*(t-.5),p=Wt(360*(.5-r),-85.051129,Ga);return new wr(u,p)}}const pm=Math.PI/2;function Ey(n){return Math.tan((pm+n)/2)}class fA extends pf{constructor(t){super(t),this.center=t.center||[0,30];const[r,u]=this.parallels=t.parallels||[30,30];let p=gt(r),y=gt(u);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const w=Math.cos(p),M=Ey(p);this.n=p===y?Math.sin(p):Math.log(w/Math.cos(y))/Math.log(Ey(y)/M),this.f=w*Math.pow(Ey(p),this.n)/this.n}project(t,r){r=gt(r),this.southernCenter&&(r=-r),t=gt(t-this.center[0]);const u=1e-6,{n:p,f:y}=this;y>0?r<-pm+u&&(r=-pm+u):r>pm-u&&(r=pm-u);const w=y/Math.pow(Ey(r),p);let M=w*Math.sin(p*t),D=y-w*Math.cos(p*t);return M=.5*(M/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:M,y:this.southernCenter?D:1-D,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:u,f:p}=this,y=p-r,w=Math.sign(y),M=Math.sign(u)*Math.sqrt(t*t+y*y);let D=Math.atan2(t,Math.abs(y))*w;y*u<0&&(D-=Math.PI*Math.sign(t)*w);const R=Wt(vt(D/u)+this.center[0],-180,180),$=Wt(vt(2*Math.atan(Math.pow(p/M,1/u))-pm),-85.051129,Ga);return new wr(R,this.southernCenter?-$:$)}}class Yb extends pf{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:fc(t),y:Qc(r),z:0}}unproject(t,r){const u=_l(t),p=Ls(r);return new wr(u,p)}}const Jb=gt(Ga);class pA extends pf{project(t,r){const u=(r=gt(r))*r,p=u*u;return{x:.5*((t=gt(t))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let u=r=(2*(1-r)-1)*Math.PI,p=25,y=0,w=u*u;do{w=u*u;const R=w*w;y=(u*(1.007226+w*(.015085+R*(.028874*w-.044475-.005916*R)))-r)/(1.007226+w*(.045255+R*(.259866*w-.311325-.005916*11*R))),u=Wt(u-y,-Jb,Jb)}while(Math.abs(y)>1e-6&&--p>0);w=u*u;const M=Wt(vt(t/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),D=vt(u);return new wr(M,D)}}const Qb=gt(Ga);class mA extends pf{project(t,r){r=gt(r),t=gt(t);const u=Math.cos(r),p=2/Math.PI,y=Math.acos(u*Math.cos(t/2)),w=Math.sin(y)/y,M=.5*(t*p+2*u*Math.sin(t/2)/w)||0,D=.5*(r+Math.sin(r)/w)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(t,r){let u=t=(2*t-.5)*Math.PI,p=r=(2*(1-r)-1)*Math.PI,y=25;const w=1e-6;let M=0,D=0;do{const R=Math.cos(p),$=Math.sin(p),W=2*$*R,J=$*$,oe=R*R,ue=Math.cos(u/2),ye=Math.sin(u/2),ke=2*ue*ye,Ke=ye*ye,ct=1-oe*ue*ue,Xe=ct?1/ct:0,nt=ct?Math.acos(R*ue)*Math.sqrt(1/ct):0,pt=.5*(2*nt*R*ye+2*u/Math.PI)-t,ht=.5*(nt*$+p)-r,Vt=.5*Xe*(oe*Ke+nt*R*ue*J)+1/Math.PI,Lt=Xe*(ke*W/4-nt*$*ye),ni=.125*Xe*(W*ye-nt*$*oe*ke),wi=.5*Xe*(J*ue+nt*Ke*R)+.5,Ht=Lt*ni-wi*Vt;M=(ht*Lt-pt*wi)/Ht,D=(pt*ni-ht*Vt)/Ht,u=Wt(u-M,-Math.PI,Math.PI),p=Wt(p-D,-Qb,Qb)}while((Math.abs(M)>w||Math.abs(D)>w)&&--y>0);return new wr(vt(u),vt(p))}}class ew extends pf{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:u,cosPhi:p}=this;return{x:gt(t)*p*u+.5,y:-Math.sin(gt(r))/p*u+.5,z:0}}unproject(t,r){const{scale:u,cosPhi:p}=this,y=-(r-.5)/u,w=Wt(vt((t-.5)/u)/p,-180,180),M=Math.asin(Wt(y*p,-1,1)),D=Wt(vt(M),-85.051129,Ga);return new wr(w,D)}}class gA extends Yb{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,r,u){const p=Dg(t,r,u);return Uo(p,p,Lg(Sh(u))),{x:p[0],y:p[1],z:p[2]}}locationPoint(t,r){const u=zg(r.lat,r.lng),p=hs([],u),y=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude;Hu(u,u,p,Fl(1,0)*In*y);const w=Vl(new Float64Array(16));return cd(w,t.pixelMatrix,t.globeMatrix),Uo(u,u,w),new Me(u[0],u[1])}pixelsPerMeter(t,r){return Fl(1,0)*r}pixelSpaceConversion(t,r,u){const p=Fl(1,t)*r,y=Qn(Fl(1,45)*r,p,u);return this.pixelsPerMeter(t,r)/y}createTileMatrix(t,r,u){const p=M0(Sh(u.canonical));return cd(new Float64Array(16),t.globeMatrix,p)}createInversionMatrix(t,r){const{center:u}=t,p=Lg(Sh(r));return Zp(p,p,gt(u.lng)),dg(p,p,gt(u.lat)),ud(p,p,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(t,r,u,p){return jb(t,r,u,!0)||new Wd(0,0)}pointCoordinate3D(t,r,u){const p=this.pointCoordinate(t,r,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(t,r){return!jb(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(p,y){const w=p.cameraToCenterDistance,M=p._centerAltitude*y,D=p._camera,R=p._camera.forward(),$=Xu([],pa([],R,-w),[0,0,M]),W=p.worldSize/(2*Math.PI),J=[0,0,-W],oe=p.width/p.height,ue=Math.tan(p.fovAboveCenter),ye=pa([],D.up(),ue),ke=pa([],D.right(),ue*oe),Ke=hs([],Xu([],Xu([],R,ye),ke)),ct=[];let Xe;if(new Hp($,Ke).closestPointOnSphere(J,W,ct)){const nt=Xu([],ct,J),pt=pc([],nt,$);Xe=Math.cos(p.fovAboveCenter)*Kd(pt)}else{const nt=pc([],$,J),pt=pc([],J,$);hs(pt,pt);const ht=Kd(nt)-W;Xe=Math.sqrt(ht*(ht+2*W));const Vt=Math.acos(Xe/(W+ht))-Math.acos(Aa(R,pt));Xe*=Math.cos(Vt)}return 1.01*Xe}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=fm(t.zoom);if(u>0){const p=Kb(t,Fl(1,t.center.lat)*t.worldSize),y=t.worldSize/(2*Math.PI),w=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Qn(r,p+y*(1-Math.cos(w)),Math.pow(u,10))}return r}upVector(t,r,u){return Dg(r,u,t,1)}upVectorScale(t){return{metersToTile:C0*wy(Sh(t))}}}function tw(n){const t=n.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new Yb(n);case"equirectangular":return new dA(n);case"naturalEarth":return new pA(n);case"equalEarth":return new hA(n);case"winkelTripel":return new mA(n);case"albers":return r?new ew(n):new uA(n);case"lambertConformalConic":return r?new ew(n):new fA(n);case"globe":return new gA(n)}throw new Error(`Invalid projection name: ${n.name}`)}const _A=v.types,yA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sy(n,t,r,u,p,y,w,M,D,R,$,W,J){const oe=M?Math.min(ff,Math.round(M[0])):0,ue=M?Math.min(ff,Math.round(M[1])):0;n.emplaceBack(t,r,Math.round(32*u),Math.round(32*p),y,w,(oe<<1)+(D?1:0),ue,16*R,16*$,256*W,256*J)}function Cy(n,t,r,u,p,y,w){n.emplaceBack(t,r,u,p,y,w)}function Iy(n,t,r,u,p){n.emplaceBack(t,r,u,p),n.emplaceBack(t,r,u,p),n.emplaceBack(t,r,u,p),n.emplaceBack(t,r,u,p)}function vA(n){for(const t of n.sections)if(Be(t.text))return!0;return!1}class P0{constructor(t){this.layoutVertexArray=new Or,this.indexArray=new Es,this.programConfigurations=t,this.segments=new as,this.dynamicLayoutVertexArray=new Ea,this.opacityVertexArray=new Do,this.placedSymbolArray=new z_,this.globeExtVertexArray=new _r}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bs.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ma.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,yA,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Hs.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ft(P0,"SymbolBuffers");class z0{constructor(t,r,u){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new u,this.segments=new as,this.collisionVertexArray=new _h,this.collisionVertexArrayExt=new $a}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ls.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Rs.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ft(z0,"CollisionBuffers");class mf{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(w=>w.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vl([]),this.placementViewportMatrix=Vl([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=po(this.zoom,r["text-size"]),this.iconSizeData=po(this.zoom,r["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(w=>Js[w]),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new P0(new rd(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new P0(new rd(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Qm,this.lineVertexArray=new yh,this.symbolInstances=new Rf}calculateGlyphDependencies(t,r,u,p,y){for(let w=0;w<t.length;w++)if(r[t.charCodeAt(w)]=!0,p&&y){const M=fs[t.charAt(w)];M&&(r[M.charCodeAt(0)]=!0)}}populate(t,r,u,p){const y=this.layers[0],w=y.layout,M=this.projection.name==="globe",D=w.get("text-font"),R=w.get("text-field"),$=w.get("icon-image"),W=(R.value.kind!=="constant"||R.value.value instanceof Vo&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(D.value.kind!=="constant"||D.value.value.length>0),J=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,oe=w.get("symbol-sort-key");if(this.features=[],!W&&!J)return;const ue=r.iconDependencies,ye=r.glyphDependencies,ke=r.availableImages,Ke=new Et(this.zoom);for(const{feature:ct,id:Xe,index:nt,sourceLayerIndex:pt}of t){const ht=y._featureFilter.needGeometry,Vt=sd(ct,ht);if(!y._featureFilter.filter(Ke,Vt,u))continue;if(ht||(Vt.geometry=Wu(ct,u,p)),M&&ct.type!==1&&u.z<=5){const Ht=Vt.geometry,si=.98078528056,ui=(mi,Ei)=>Aa(Dg(mi.x,mi.y,u,1),Dg(Ei.x,Ei.y,u,1))<si;for(let mi=0;mi<Ht.length;mi++)Ht[mi]=j_(Ht[mi],ui)}let Lt,ni;if(W){const Ht=y.getValueAndResolveTokens("text-field",Vt,u,ke),si=Vo.factory(Ht);vA(si)&&(this.hasRTLText=!0),(!this.hasRTLText||yt()==="unavailable"||this.hasRTLText&&Dt.isParsed())&&(Lt=Fs(si,y,Vt))}if(J){const Ht=y.getValueAndResolveTokens("icon-image",Vt,u,ke);ni=Ht instanceof Us?Ht:Us.fromString(Ht)}if(!Lt&&!ni)continue;const wi=this.sortFeaturesByKey?oe.evaluate(Vt,{},u):void 0;if(this.features.push({id:Xe,text:Lt,icon:ni,index:nt,sourceLayerIndex:pt,geometry:Vt.geometry,properties:ct.properties,type:_A[ct.type],sortKey:wi}),ni&&(ue[ni.name]=!0),Lt){const Ht=D.evaluate(Vt,{},u).join(","),si=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Js.vertical)>=0;for(const ui of Lt.sections)if(ui.image)ue[ui.image.name]=!0;else{const mi=O(Lt.toString()),Ei=ui.fontStack||Ht,Kt=ye[Ei]=ye[Ei]||{};this.calculateGlyphDependencies(ui.text,Kt,si,this.allowVerticalPlacement,mi)}}}w.get("symbol-placement")==="line"&&(this.features=function(ct){const Xe={},nt={},pt=[];let ht=0;function Vt(Ht){pt.push(ct[Ht]),ht++}function Lt(Ht,si,ui){const mi=nt[Ht];return delete nt[Ht],nt[si]=mi,pt[mi].geometry[0].pop(),pt[mi].geometry[0]=pt[mi].geometry[0].concat(ui[0]),mi}function ni(Ht,si,ui){const mi=Xe[si];return delete Xe[si],Xe[Ht]=mi,pt[mi].geometry[0].shift(),pt[mi].geometry[0]=ui[0].concat(pt[mi].geometry[0]),mi}function wi(Ht,si,ui){const mi=ui?si[0][si[0].length-1]:si[0][0];return`${Ht}:${mi.x}:${mi.y}`}for(let Ht=0;Ht<ct.length;Ht++){const si=ct[Ht],ui=si.geometry,mi=si.text?si.text.toString():null;if(!mi){Vt(Ht);continue}const Ei=wi(mi,ui),Kt=wi(mi,ui,!0);if(Ei in nt&&Kt in Xe&&nt[Ei]!==Xe[Kt]){const Bi=ni(Ei,Kt,ui),Sn=Lt(Ei,Kt,pt[Bi].geometry);delete Xe[Ei],delete nt[Kt],nt[wi(mi,pt[Sn].geometry,!0)]=Sn,pt[Bi].geometry=null}else Ei in nt?Lt(Ei,Kt,ui):Kt in Xe?ni(Ei,Kt,ui):(Vt(Ht),Xe[Ei]=ht-1,nt[Kt]=ht-1)}return pt.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ct,Xe)=>ct.sortKey-Xe.sortKey)}update(t,r,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,u,p),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,u,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const u=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:p,y}of r)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,r,u,p,y,w,M,D,R,$,W,J,oe,ue){const ye=t.indexArray,ke=t.layoutVertexArray,Ke=t.globeExtVertexArray,ct=t.segments.prepareSegment(4*r.length,ke,ye,this.canOverlap?w.sortKey:void 0),Xe=this.glyphOffsetArray.length,nt=ct.vertexLength,pt=this.allowVerticalPlacement&&M===Js.vertical?Math.PI/2:0,ht=w.text&&w.text.sections;for(let Lt=0;Lt<r.length;Lt++){const{tl:ni,tr:wi,bl:Ht,br:si,tex:ui,pixelOffsetTL:mi,pixelOffsetBR:Ei,minFontScaleX:Kt,minFontScaleY:Bi,glyphOffset:Sn,isSDF:qi,sectionIndex:ln}=r[Lt],Oi=ct.vertexLength,An=Sn[1];if(Sy(ke,R.x,R.y,ni.x,An+ni.y,ui.x,ui.y,u,qi,mi.x,mi.y,Kt,Bi),Sy(ke,R.x,R.y,wi.x,An+wi.y,ui.x+ui.w,ui.y,u,qi,Ei.x,mi.y,Kt,Bi),Sy(ke,R.x,R.y,Ht.x,An+Ht.y,ui.x,ui.y+ui.h,u,qi,mi.x,Ei.y,Kt,Bi),Sy(ke,R.x,R.y,si.x,An+si.y,ui.x+ui.w,ui.y+ui.h,u,qi,Ei.x,Ei.y,Kt,Bi),D){const{x:dr,y:sr,z:rr}=D.anchor,[Pn,Zr,Vn]=D.up;Cy(Ke,dr,sr,rr,Pn,Zr,Vn),Cy(Ke,dr,sr,rr,Pn,Zr,Vn),Cy(Ke,dr,sr,rr,Pn,Zr,Vn),Cy(Ke,dr,sr,rr,Pn,Zr,Vn),Iy(t.dynamicLayoutVertexArray,dr,sr,rr,pt)}else Iy(t.dynamicLayoutVertexArray,R.x,R.y,R.z,pt);ye.emplaceBack(Oi,Oi+1,Oi+2),ye.emplaceBack(Oi+1,Oi+2,Oi+3),ct.vertexLength+=4,ct.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Sn[0]),Lt!==r.length-1&&ln===r[Lt+1].sectionIndex||t.programConfigurations.populatePaintArrays(ke.length,w,w.index,{},oe,ue,ht&&ht[ln])}const Vt=D?D.anchor:R;t.placedSymbolArray.emplaceBack(Vt.x,Vt.y,Vt.z,R.x,R.y,Xe,this.glyphOffsetArray.length-Xe,nt,$,W,R.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],M,0,!1,0,J,0)}_commitLayoutVertex(t,r,u,p,y,w,M){t.emplaceBack(r,u,p,y,w,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(t,r,u,p,y,w,M){const D=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),R=D.vertexLength,$=M.tileAnchorX,W=M.tileAnchorY;for(let oe=0;oe<4;oe++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(r,-t.padding,-t.padding),u.collisionVertexArrayExt.emplaceBack(r,t.padding,-t.padding),u.collisionVertexArrayExt.emplaceBack(r,t.padding,t.padding),u.collisionVertexArrayExt.emplaceBack(r,-t.padding,t.padding),this._commitLayoutVertex(u.layoutVertexArray,p,y,w,$,W,new Me(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,y,w,$,W,new Me(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,y,w,$,W,new Me(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,y,w,$,W,new Me(t.x1,t.y2)),D.vertexLength+=4;const J=u.indexArray;J.emplaceBack(R,R+1),J.emplaceBack(R+1,R+2),J.emplaceBack(R+2,R+3),J.emplaceBack(R+3,R),D.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,u,p,y,w){for(let M=p;M<y;M++){const D=u.get(M),R=this.getSymbolInstanceTextSize(t,w,r,M);this._addCollisionDebugVertices(D,R,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(t,r,u,p,y,w){for(let M=p;M<y;M++){const D=u.get(M),R=this.getSymbolInstanceIconSize(t,r,w.placedIconSymbolIndex);this._addCollisionDebugVertices(D,R,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,w)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new z0(Kr,Os.members,ja),this.iconCollisionBox=new z0(Kr,Os.members,ja);const u=Kn(this.iconSizeData,t),p=Kn(this.textSizeData,t);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(p,t,r,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(p,t,r,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,t,r,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,t,r,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(t,r,u,p){const y=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:p),w=Ho(this.textSizeData,t,y)/qr;return this.tilePixelRatio*w}getSymbolInstanceIconSize(t,r,u){const p=this.icon.placedSymbolArray.get(u),y=Ho(this.iconSizeData,t,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(t,r,u){t.emplaceBack(r,-u,-u),t.emplaceBack(r,u,-u),t.emplaceBack(r,u,u),t.emplaceBack(r,-u,u)}_updateTextDebugCollisionBoxes(t,r,u,p,y,w){for(let M=p;M<y;M++){const D=u.get(M),R=this.getSymbolInstanceTextSize(t,w,r,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,D.padding)}}_updateIconDebugCollisionBoxes(t,r,u,p,y,w){for(let M=p;M<y;M++){const D=u.get(M),R=this.getSymbolInstanceIconSize(t,r,w);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,D.padding)}}updateCollisionDebugBuffers(t,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Kn(this.iconSizeData,t),p=Kn(this.textSizeData,t);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(p,t,r,w.textBoxStartIndex,w.textBoxEndIndex,w),this._updateTextDebugCollisionBoxes(p,t,r,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._updateIconDebugCollisionBoxes(u,t,r,w.iconBoxStartIndex,w.iconBoxEndIndex,w.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,t,r,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,u,p,y,w,M,D,R){const $={};if(r<u){const{x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt,featureIndex:pt}=t.get(r);$.textBox={x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt},$.textFeatureIndex=pt}if(p<y){const{x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt,featureIndex:pt}=t.get(p);$.verticalTextBox={x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt},$.verticalTextFeatureIndex=pt}if(w<M){const{x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt,featureIndex:pt}=t.get(w);$.iconBox={x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt},$.iconFeatureIndex=pt}if(D<R){const{x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt,featureIndex:pt}=t.get(D);$.verticalIconBox={x1:W,y1:J,x2:oe,y2:ue,padding:ye,projectedAnchorX:ke,projectedAnchorY:Ke,projectedAnchorZ:ct,tileAnchorX:Xe,tileAnchorY:nt},$.verticalIconFeatureIndex=pt}return $}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const u=t.placedSymbolArray.get(r),p=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),u=Math.cos(t),p=[],y=[],w=[];for(let M=0;M<this.symbolInstances.length;++M){w.push(M);const D=this.symbolInstances.get(M);p.push(0|Math.round(r*D.tileAnchorX+u*D.tileAnchorY)),y.push(D.featureIndex)}return w.sort((M,D)=>p[M]-p[D]||y[D]-y[M]),w}addToSortKeyRanges(t,r){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===r?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const u=this.symbolInstances.get(r);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:R}=u;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&w!==y&&w!==p&&this.addIndicesForPlacedSymbol(this.text,w),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ft(mf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),mf.MAX_GLYPHS=65535,mf.addDynamicAttributes=Iy;const xA=new vn({"symbol-placement":new St(Mt.layout_symbol["symbol-placement"]),"symbol-spacing":new St(Mt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new St(Mt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Zt(Mt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new St(Mt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new St(Mt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new St(Mt.layout_symbol["icon-ignore-placement"]),"icon-optional":new St(Mt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new St(Mt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Zt(Mt.layout_symbol["icon-size"]),"icon-text-fit":new St(Mt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Mt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Zt(Mt.layout_symbol["icon-image"]),"icon-rotate":new Zt(Mt.layout_symbol["icon-rotate"]),"icon-padding":new St(Mt.layout_symbol["icon-padding"]),"icon-keep-upright":new St(Mt.layout_symbol["icon-keep-upright"]),"icon-offset":new Zt(Mt.layout_symbol["icon-offset"]),"icon-anchor":new Zt(Mt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new St(Mt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new St(Mt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new St(Mt.layout_symbol["text-rotation-alignment"]),"text-field":new Zt(Mt.layout_symbol["text-field"]),"text-font":new Zt(Mt.layout_symbol["text-font"]),"text-size":new Zt(Mt.layout_symbol["text-size"]),"text-max-width":new Zt(Mt.layout_symbol["text-max-width"]),"text-line-height":new Zt(Mt.layout_symbol["text-line-height"]),"text-letter-spacing":new Zt(Mt.layout_symbol["text-letter-spacing"]),"text-justify":new Zt(Mt.layout_symbol["text-justify"]),"text-radial-offset":new Zt(Mt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new St(Mt.layout_symbol["text-variable-anchor"]),"text-anchor":new Zt(Mt.layout_symbol["text-anchor"]),"text-max-angle":new St(Mt.layout_symbol["text-max-angle"]),"text-writing-mode":new St(Mt.layout_symbol["text-writing-mode"]),"text-rotate":new Zt(Mt.layout_symbol["text-rotate"]),"text-padding":new St(Mt.layout_symbol["text-padding"]),"text-keep-upright":new St(Mt.layout_symbol["text-keep-upright"]),"text-transform":new Zt(Mt.layout_symbol["text-transform"]),"text-offset":new Zt(Mt.layout_symbol["text-offset"]),"text-allow-overlap":new St(Mt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new St(Mt.layout_symbol["text-ignore-placement"]),"text-optional":new St(Mt.layout_symbol["text-optional"])});var D0={paint:new vn({"icon-opacity":new Zt(Mt.paint_symbol["icon-opacity"]),"icon-color":new Zt(Mt.paint_symbol["icon-color"]),"icon-halo-color":new Zt(Mt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Zt(Mt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Zt(Mt.paint_symbol["icon-halo-blur"]),"icon-translate":new St(Mt.paint_symbol["icon-translate"]),"icon-translate-anchor":new St(Mt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Zt(Mt.paint_symbol["text-opacity"]),"text-color":new Zt(Mt.paint_symbol["text-color"],{runtimeType:la,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Zt(Mt.paint_symbol["text-halo-color"]),"text-halo-width":new Zt(Mt.paint_symbol["text-halo-width"]),"text-halo-blur":new Zt(Mt.paint_symbol["text-halo-blur"]),"text-translate":new St(Mt.paint_symbol["text-translate"]),"text-translate-anchor":new St(Mt.paint_symbol["text-translate-anchor"])}),layout:xA};class iw{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft(iw,"FormatSectionOverride",{omit:["defaultValue"]});class Ay extends dc{constructor(t){super(t,D0)}recalculate(t,r){super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const y of u)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,r,u,p){const y=this.layout.get(t).evaluate(r,{},u,p),w=this._unevaluatedLayout._values[t];return w.isDataDriven()||uc(w.value)||!y?y:function(M,D){return D.replace(/{([^{}]+)}/g,(R,$)=>$ in M?String(M[$]):"")}(r.properties,y)}createBucket(t){return new mf(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of D0.paint.overridableProperties){if(!Ay.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),u=new iw(r),p=new Zc(u,r.property.specification);let y=null;y=r.value.kind==="constant"||r.value.kind==="source"?new bs("source",p):new Vu("composite",p,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new ai(r.property,y,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,u){return!(!this.layout||r.isDataDriven()||u.isDataDriven())&&Ay.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const u=t.get("text-field"),p=D0.paint.properties[r];let y=!1;const w=M=>{for(const D of M)if(p.overrides&&p.overrides.hasOverride(D))return void(y=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Vo)w(u.value.value.sections);else if(u.value.kind==="source"){const M=R=>{y||(R instanceof Yl&&Io(R.value)===El?w(R.value.sections):R instanceof rl?w(R.sections):R.eachChild(M))},D=u.value;D._styleExpression&&M(D._styleExpression.expression)}return y}getProgramConfiguration(t){return new Jc(this,t)}}var bA={paint:new vn({"background-color":new St(Mt.paint_background["background-color"]),"background-pattern":new St(Mt.paint_background["background-pattern"]),"background-opacity":new St(Mt.paint_background["background-opacity"])})},wA={paint:new vn({"raster-opacity":new St(Mt.paint_raster["raster-opacity"]),"raster-hue-rotate":new St(Mt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new St(Mt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new St(Mt.paint_raster["raster-brightness-max"]),"raster-saturation":new St(Mt.paint_raster["raster-saturation"]),"raster-contrast":new St(Mt.paint_raster["raster-contrast"]),"raster-resampling":new St(Mt.paint_raster["raster-resampling"]),"raster-fade-duration":new St(Mt.paint_raster["raster-fade-duration"])})};class TA extends dc{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var EA={paint:new vn({"sky-type":new St(Mt.paint_sky["sky-type"]),"sky-atmosphere-sun":new St(Mt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new St(Mt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new St(Mt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new St(Mt.paint_sky["sky-gradient-radius"]),"sky-gradient":new sn(Mt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new St(Mt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new St(Mt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new St(Mt.paint_sky["sky-opacity"])})};function L0(n,t,r){const u=[0,0,1],p=gg([]);return _g(p,p,r?-gt(n)+Math.PI:gt(n)),tu(p,p,-gt(t)),mg(u,u,p),hs(u,u)}const SA={circle:class extends dc{constructor(n){super(n,ug)}createBucket(n){return new Uf(n)}queryRadius(n){const t=n;return bh("circle-radius",this,t)+bh("circle-stroke-width",this,t)+$f(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,r,u,p,y,w,M){const D=Gr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,n.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return ey(n,u,y,w,M,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",D,R)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Jc(this,n)}},heatmap:class extends dc{createBucket(n){return new qf(n)}constructor(n){super(n,a0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return bh("heatmap-radius",this,n)}queryIntersectsFeature(n,t,r,u,p,y,w,M){const D=this.paint.get("heatmap-radius").evaluate(t,r);return ey(n,u,y,w,M,!0,!0,new Me(0,0),D)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Jc(this,n)}},hillshade:class extends dc{constructor(n){super(n,l0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends dc{constructor(n){super(n,cy)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new Jc(this,n)}recalculate(n,t){super.recalculate(n,t);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Qf(n)}queryRadius(){return $f(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,r,u,p,y){return!n.queryGeometry.isAboveHorizon&&og(cg(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,n.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends dc{constructor(n){super(n,jt)}createBucket(n){return new de(n)}queryRadius(){return $f(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Jc(this,n)}queryIntersectsFeature(n,t,r,u,p,y,w,M,D){const R=Gr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,n.pixelToTileUnitsFactor),$=this.paint.get("fill-extrusion-height").evaluate(t,r),W=this.paint.get("fill-extrusion-base").evaluate(t,r),J=[0,0],oe=M&&y.elevation,ue=y.elevation?y.elevation.exaggeration():1,ye=n.tile.getBucket(this);if(oe&&ye instanceof de){const nt=ye.centroidVertexArray,pt=D+1;pt<nt.length&&(J[0]=nt.geta_centroid_pos0(pt),J[1]=nt.geta_centroid_pos1(pt))}if(J[0]===0&&J[1]===1)return!1;y.projection.name==="globe"&&(u=Xt([u],[new Me(0,0),new Me(In,In)],n.tileID.canonical).map(nt=>nt.polygon).flat());const ke=oe?M:null,[Ke,ct]=function(nt,pt,ht,Vt,Lt,ni,wi,Ht,si,ui,mi){return nt.projection.name==="globe"?function(Ei,Kt,Bi,Sn,qi,ln,Oi,An,dr,sr,rr){const Pn=[],Zr=[],Vn=Ei.projection.upVectorScale(rr,Ei.center.lat,Ei.worldSize).metersToTile,fr=[0,0,0,1],Yr=[0,0,0,1],mo=(go,wo,Ko,Qs)=>{go[0]=wo,go[1]=Ko,go[2]=Qs,go[3]=1},lo=Pt();Bi>0&&(Bi+=lo),Sn+=lo;for(const go of Kt){const wo=[],Ko=[];for(const Qs of go){const Wr=Qs.x+qi.x,_s=Qs.y+qi.y,ps=Ei.projection.projectTilePoint(Wr,_s,rr),kr=Ei.projection.upVector(rr,Qs.x,Qs.y);let Ro=Bi,Is=Sn;if(Oi){const Jr=Hi(Wr,_s,Bi,Sn,Oi,An,dr,sr);Ro+=Jr.base,Is+=Jr.top}Bi!==0?mo(fr,ps.x+kr[0]*Vn*Ro,ps.y+kr[1]*Vn*Ro,ps.z+kr[2]*Vn*Ro):mo(fr,ps.x,ps.y,ps.z),mo(Yr,ps.x+kr[0]*Vn*Is,ps.y+kr[1]*Vn*Is,ps.z+kr[2]*Vn*Is),Uo(fr,fr,ln),Uo(Yr,Yr,ln),wo.push(new Ri(fr[0],fr[1],fr[2])),Ko.push(new Ri(Yr[0],Yr[1],Yr[2]))}Pn.push(wo),Zr.push(Ko)}return[Pn,Zr]}(nt,pt,ht,Vt,Lt,ni,wi,Ht,si,ui,mi):wi?function(Ei,Kt,Bi,Sn,qi,ln,Oi,An,dr){const sr=[],rr=[],Pn=[0,0,0,1];for(const Zr of Ei){const Vn=[],fr=[];for(const Yr of Zr){const mo=Yr.x+Sn.x,lo=Yr.y+Sn.y,go=Hi(mo,lo,Kt,Bi,ln,Oi,An,dr);Pn[0]=mo,Pn[1]=lo,Pn[2]=go.base,Pn[3]=1,fd(Pn,Pn,qi),Pn[3]=Math.max(Pn[3],1e-5);const wo=new Ri(Pn[0]/Pn[3],Pn[1]/Pn[3],Pn[2]/Pn[3]);Pn[0]=mo,Pn[1]=lo,Pn[2]=go.top,Pn[3]=1,fd(Pn,Pn,qi),Pn[3]=Math.max(Pn[3],1e-5);const Ko=new Ri(Pn[0]/Pn[3],Pn[1]/Pn[3],Pn[2]/Pn[3]);Vn.push(wo),fr.push(Ko)}sr.push(Vn),rr.push(fr)}return[sr,rr]}(pt,ht,Vt,Lt,ni,wi,Ht,si,ui):function(Ei,Kt,Bi,Sn,qi){const ln=[],Oi=[],An=qi[8]*Kt,dr=qi[9]*Kt,sr=qi[10]*Kt,rr=qi[11]*Kt,Pn=qi[8]*Bi,Zr=qi[9]*Bi,Vn=qi[10]*Bi,fr=qi[11]*Bi;for(const Yr of Ei){const mo=[],lo=[];for(const go of Yr){const wo=go.x+Sn.x,Ko=go.y+Sn.y,Qs=qi[0]*wo+qi[4]*Ko+qi[12],Wr=qi[1]*wo+qi[5]*Ko+qi[13],_s=qi[2]*wo+qi[6]*Ko+qi[14],ps=qi[3]*wo+qi[7]*Ko+qi[15],kr=Qs+An,Ro=Wr+dr,Is=_s+sr,Jr=Math.max(ps+rr,1e-5),cs=Qs+Pn,Pa=Wr+Zr,ea=_s+Vn,ta=Math.max(ps+fr,1e-5);mo.push(new Ri(kr/Jr,Ro/Jr,Is/Jr)),lo.push(new Ri(cs/ta,Pa/ta,ea/ta))}ln.push(mo),Oi.push(lo)}return[ln,Oi]}(pt,ht,Vt,Lt,ni)}(y,u,W,$,R,w,ke,J,ue,y.center.lat,n.tileID.canonical),Xe=n.queryGeometry;return function(nt,pt,ht){let Vt=1/0;og(ht,pt)&&(Vt=Qi(ht,pt[0]));for(let Lt=0;Lt<pt.length;Lt++){const ni=pt[Lt],wi=nt[Lt];for(let Ht=0;Ht<ni.length-1;Ht++){const si=ni[Ht],ui=[si,ni[Ht+1],wi[Ht+1],wi[Ht],si];q_(ht,ui)&&(Vt=Math.min(Vt,Qi(ht,ui)))}}return Vt!==1/0&&Vt}(Ke,ct,Xe.isPointQuery()?Xe.screenBounds:Xe.screenGeometry)}},line:class extends dc{constructor(n){super(n,Cs),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Pl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=Xo.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new $o(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Jc(this,n)}queryRadius(n){const t=n,r=ds(bh("line-width",this,t),bh("line-gap-width",this,t)),u=bh("line-offset",this,t);return r/2+Math.abs(u)+$f(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,r,u,p,y){if(n.queryGeometry.isAboveHorizon)return!1;const w=cg(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,n.pixelToTileUnitsFactor),M=n.pixelToTileUnitsFactor/2*ds(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),D=this.paint.get("line-offset").evaluate(t,r);return D&&(u=function(R,$){const W=[],J=new Me(0,0);for(let oe=0;oe<R.length;oe++){const ue=R[oe],ye=[];for(let ke=0;ke<ue.length;ke++){const Ke=ue[ke-1],ct=ue[ke],Xe=ue[ke+1],nt=ke===0?J:ct.sub(Ke)._unit()._perp(),pt=ke===ue.length-1?J:Xe.sub(ct)._unit()._perp(),ht=nt._add(pt)._unit();ht._mult(1/(ht.x*pt.x+ht.y*pt.y)),ye.push(ht._mult($)._add(ct))}W.push(ye)}return W}(u,D*n.pixelToTileUnitsFactor)),function(R,$,W){for(let J=0;J<$.length;J++){const oe=$[J];if(R.length>=3){for(let ue=0;ue<oe.length;ue++)if(ad(R,oe[ue]))return!0}if(W_(R,oe,W))return!0}return!1}(w,u,M)}isTileClipped(){return!0}},symbol:Ay,background:class extends dc{constructor(n){super(n,bA)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends dc{constructor(n){super(n,wA)}getProgramIds(){return["raster"]}},sky:class extends dc{constructor(n){super(n,EA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),p=!u,y=n.style.light,w=y.properties.get("position");return p&&y.properties.get("anchor")==="viewport"&&at("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?L0(w.azimuthal,90-w.polar,t):L0(u[0],90-u[1],t)}const r=this.paint.get("sky-gradient-center");return L0(r[0],90-r[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class Vg{constructor(t,r,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(r,p)}update(t,r,u){const{width:p,height:y}=t,{context:w}=this,{gl:M}=w,{HTMLImageElement:D,HTMLCanvasElement:R,HTMLVideoElement:$,ImageData:W,ImageBitmap:J}=F;if(M.bindTexture(M.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!r||r.premultiply!==!1)),u||this.size&&this.size[0]===p&&this.size[1]===y){const{x:oe,y:ue}=u||{x:0,y:0};t instanceof D||t instanceof R||t instanceof $||t instanceof W||J&&t instanceof J?M.texSubImage2D(M.TEXTURE_2D,0,oe,ue,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,oe,ue,p,y,M.RGBA,M.UNSIGNED_BYTE,t.data)}else this.size=[p,y],t instanceof D||t instanceof R||t instanceof $||t instanceof W||J&&t instanceof J?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,p,y,0,this.format,M.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&M.generateMipmap(M.TEXTURE_2D)}bind(t,r){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?t===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:t),this.filter=t),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class CA{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class IA{constructor(){this.tasks={},this.taskQueue=[],wn(["process"],this),this.invoker=new CA(this.process),this.nextId=0}add(t,r){const u=this.nextId++,p=function({type:y,isSymbolTile:w,zoom:M}){return M=M||0,y==="message"?0:y!=="maybePrepare"||w?y!=="parseTile"||w?y==="parseTile"&&w?300-M:y==="maybePrepare"&&w?400-M:500:200-M:100-M}(r);if(p===0){fi();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:t,metadata:r,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){fi();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<r&&(r=y.priority,t=p)}if(t===null)return null;const u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class nw{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const u=t[r];this._stringToNumber[u]=r,this._numberToString[r]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const AA=["tile","layer","source","sourceLayer","state"];class rw{constructor(t,r,u,p,y){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=u,this._y=p,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const r of AA)this[r]!==void 0&&(t[r]=this[r]);return t}}const au=32,Ch=33,gf=new Uint16Array(8184);for(let n=0;n<2046;n++){let t=n+2,r=0,u=0,p=0,y=0,w=0,M=0;for(1&t?p=y=w=au:r=u=M=au;(t>>=1)>1;){const R=r+p>>1,$=u+y>>1;1&t?(p=r,y=u,r=w,u=M):(r=p,u=y,p=w,y=M),w=R,M=$}const D=4*n;gf[D+0]=r,gf[D+1]=u,gf[D+2]=p,gf[D+3]=y}const Ih=new Uint16Array(2178),_f=new Uint8Array(1089),My=new Uint16Array(1089);function ow(n){return n===0?-.03125:n===32?.03125:0}var sw=Yi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const aw={type:2,extent:In,loadGeometry:()=>[[new Me(0,0),new Me(8193,0),new Me(8193,8193),new Me(0,8193),new Me(0,0)]]};class B0{constructor(t,r,u,p,y){this.tileID=t,this.uid=mn(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<ri.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=np(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,y){const w={};if(!y)return w;for(const M of p){const D=M.layerIds.map(R=>y.getLayer(R)).filter(Boolean);if(D.length!==0){M.layers=D,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(R=>D.filter($=>$.id===R)[0]));for(const R of D)w[R.id]=M}}return w}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof mf){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof mf&&y.hasRTLText){this.hasRTLText=!0,Dt.isLoading()||Dt.isLoaded()||yt()!=="deferred"||$t();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(p).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Jm}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vg(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vg(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vg(t,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,u,p,y,w,M,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:M,transform:w,params:y,tileTransform:this.tileTransform},t,r,u):{}}querySourceFeatures(t,r){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),y=r?r.sourceLayer:"",w=p._geojsonTileLayer||p[y];if(!w)return;const M=gs(r&&r.filter),{z:D,x:R,y:$}=this.tileID.canonical,W={z:D,x:R,y:$};for(let J=0;J<w.length;J++){const oe=w.feature(J);if(M.needGeometry){const ke=sd(oe,!0);if(!M.filter(new Et(this.tileID.overscaledZ),ke,this.tileID.canonical))continue}else if(!M.filter(new Et(this.tileID.overscaledZ),oe))continue;const ue=u.getId(oe,y),ye=new rw(oe,D,R,$,ue);ye.tile=W,t.push(ye)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const u=gi(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const y=this.expirationTime-r;y?this.expirationTime=u+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!r)return;const u=this.latestFeatureIndex.loadVTLayers(),p=r.style.listImages();for(const y in this.buckets){if(!r.style.hasLayer(y))continue;const w=this.buckets[y],M=w.layers[0].sourceLayer||"_geojsonTileLayer",D=u[M],R=t[M];if(!D||!R||Object.keys(R).length===0)continue;if(w.update(R,D,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),w instanceof $o||w instanceof Qf){const W=r.style._getSourceCache(w.layers[0].source);r._terrain&&r._terrain.enabled&&W&&w.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(W.id,this.tileID)}const $=r&&r.style&&r.style.getLayer(y);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ri.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ri.now()+t}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Vg(u,t,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(t,r){const u={};for(const p of r)u[p]=!0;this.dependencies[t]=u}hasDependency(t,r){for(const u of t){const p=this.dependencies[u];if(p){for(const y of r)if(p[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const u=Wu(aw,this.tileID.canonical,this.tileTransform)[0],p=new Ir,y=new qu;for(let w=0;w<u.length;w++){const{x:M,y:D}=u[w];p.emplaceBack(M,D),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(p,Pg.members),this._tileDebugSegments=as.simpleSegment(0,0,p.length,y.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const u=Wu(aw,this.tileID.canonical,this.tileTransform)[0];let p,y;if(this.isRaster){const w=function(M,D){const R=np(M,D),$=Math.pow(2,M.z);for(let ke=0;ke<Ch;ke++)for(let Ke=0;Ke<Ch;Ke++){const ct=_l((M.x+(Ke+ow(Ke))/au)/$),Xe=Ls((M.y+(ke+ow(ke))/au)/$),nt=D.project(ct,Xe),pt=ke*Ch+Ke;Ih[2*pt+0]=Math.round((nt.x*R.scale-R.x)*In),Ih[2*pt+1]=Math.round((nt.y*R.scale-R.y)*In)}_f.fill(0),My.fill(0);for(let ke=2045;ke>=0;ke--){const Ke=4*ke,ct=gf[Ke+0],Xe=gf[Ke+1],nt=gf[Ke+2],pt=gf[Ke+3],ht=ct+nt>>1,Vt=Xe+pt>>1,Lt=ht+Vt-Xe,ni=Vt+ct-ht,wi=Xe*Ch+ct,Ht=pt*Ch+nt,si=Vt*Ch+ht,ui=Math.hypot((Ih[2*wi+0]+Ih[2*Ht+0])/2-Ih[2*si+0],(Ih[2*wi+1]+Ih[2*Ht+1])/2-Ih[2*si+1])>=16;if(_f[si]=_f[si]||(ui?1:0),ke<1022){const mi=(Xe+ni>>1)*Ch+(ct+Lt>>1),Ei=(pt+ni>>1)*Ch+(nt+Lt>>1);_f[si]=_f[si]||_f[mi]||_f[Ei]}}const W=new Mr,J=new Es;let oe=0;function ue(ke,Ke){const ct=Ke*Ch+ke;return My[ct]===0&&(W.emplaceBack(Ih[2*ct+0],Ih[2*ct+1],ke*In/au,Ke*In/au),My[ct]=++oe),My[ct]-1}function ye(ke,Ke,ct,Xe,nt,pt){const ht=ke+ct>>1,Vt=Ke+Xe>>1;if(Math.abs(ke-nt)+Math.abs(Ke-pt)>1&&_f[Vt*Ch+ht])ye(nt,pt,ke,Ke,ht,Vt),ye(ct,Xe,nt,pt,ht,Vt);else{const Lt=ue(ke,Ke),ni=ue(ct,Xe),wi=ue(nt,pt);J.emplaceBack(Lt,ni,wi)}}return ye(0,0,au,au,au,0),ye(au,au,0,0,0,au),{vertices:W,indices:J}}(this.tileID.canonical,r);p=w.vertices,y=w.indices}else{p=new Mr,y=new Es;for(const{x:M,y:D}of u)p.emplaceBack(M,D,0,0);const w=rf.exports(p.int16,void 0,4);for(let M=0;M<w.length;M+=3)y.emplaceBack(w[M],w[M+1],w[M+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,sw.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=as.simpleSegment(0,0,p.length,y.length)}_makeGlobeTileDebugBuffers(t,r){const u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;const p=this.tileID.canonical,y=Lg(Gb(p,r)),w=fm(r.zoom);let M;w>0&&(M=hg(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,r,y,M,w),this._makeGlobeTileDebugTextBuffer(t,p,r,y,M,w)}_globePoint(t,r,u,p,y,w,M){let D=Dg(t,r,u);if(w){const R=1<<u.z,$=fc(p.center.lng),W=Qc(p.center.lat),J=(u.x+.5)/R-$;let oe=0;J>.5?oe=-1:J<-.5&&(oe=1);let ue=(t/In+u.x)/R+oe,ye=(r/In+u.y)/R;ue=(ue-$)*p._pixelsPerMercatorPixel+$,ye=(ye-W)*p._pixelsPerMercatorPixel+W;const ke=[ue*p.worldSize,ye*p.worldSize,0];Uo(ke,ke,w),D=ip(D,ke,M)}return Uo(D,D,y)}_makeGlobeTileDebugBorderBuffer(t,r,u,p,y,w){const M=new Ir,D=new qu,R=new Ar,$=(J,oe,ue,ye,ke)=>{const Ke=(ue-J)/(ke-1),ct=(ye-oe)/(ke-1),Xe=M.length;for(let nt=0;nt<ke;nt++){const pt=J+nt*Ke,ht=oe+nt*ct;M.emplaceBack(pt,ht);const Vt=this._globePoint(pt,ht,r,u,p,y,w);R.emplaceBack(Vt[0],Vt[1],Vt[2]),D.emplaceBack(Xe+nt)}},W=In;$(0,0,W,0,16),$(W,0,W,W,16),$(W,W,0,W,16),$(0,W,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(D),this._tileDebugBuffer=t.createVertexBuffer(M,Pg.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(R,$b.members),this._tileDebugSegments=as.simpleSegment(0,0,M.length,D.length)}_makeGlobeTileDebugTextBuffer(t,r,u,p,y,w){const M=new Ir,D=new Es,R=new Ar,$=25;D.reserve(32),M.reserve($),R.reserve($);const W=(J,oe)=>$*J+oe;for(let J=0;J<$;J++){const oe=2048*J;for(let ue=0;ue<$;ue++){const ye=2048*ue;M.emplaceBack(ye,oe);const ke=this._globePoint(ye,oe,r,u,p,y,w);R.emplaceBack(ke[0],ke[1],ke[2])}}for(let J=0;J<4;J++)for(let oe=0;oe<4;oe++){const ue=W(J,oe),ye=W(J,oe+1),ke=W(J+1,oe),Ke=W(J+1,oe+1);D.emplaceBack(ue,ye,ke),D.emplaceBack(ke,ye,Ke)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(M,Pg.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(R,$b.members),this._tileDebugTextSegments=as.simpleSegment(0,0,$,32)}}class MA{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,u){const p=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},di(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==p&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const y in this.state[t][p])u[y]||(this.deletedStates[t][p][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][y]===null&&delete this.deletedStates[t][p][y]}removeFeatureState(t,r,u){if(this.deletedStates[t]===null)return;const p=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&r!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,r){const u=String(r),p=di({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][r];if(y===null)return{};for(const w in y)delete p[w]}return p}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const w in this.stateChanges[p])this.state[p][w]||(this.state[p][w]={}),di(this.state[p][w],this.stateChanges[p][w]),y[w]=this.state[p][w];u[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const w in this.state[p])y[w]={},this.state[p][w]={};else for(const w in this.deletedStates[p]){if(this.deletedStates[p][w]===null)this.state[p][w]={};else for(const M of Object.keys(this.deletedStates[p][w]))delete this.state[p][w][M];y[w]=this.state[p][w]}u[p]=u[p]||{},di(u[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].setFeatureState(u,r)}}class lw{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const u=this.toIdx(t,r);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function cw(n,t,r,u){let p=0,y=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(u[w])<1e-15){if(r[w]<n[w]||r[w]>t[w])return null}else{const M=1/u[w];let D=(n[w]-r[w])*M,R=(t[w]-r[w])*M;if(D>R){const $=D;D=R,R=$}if(D>p&&(p=D),R<y&&(y=R),p>y)return null}return p}function uw(n,t,r,u,p,y,w,M,D,R,$){const W=u-n,J=p-t,oe=y-r,ue=w-n,ye=M-t,ke=D-r,Ke=$[1]*ke-$[2]*ye,ct=$[2]*ue-$[0]*ke,Xe=$[0]*ye-$[1]*ue,nt=W*Ke+J*ct+oe*Xe;if(Math.abs(nt)<1e-15)return null;const pt=1/nt,ht=R[0]-n,Vt=R[1]-t,Lt=R[2]-r,ni=(ht*Ke+Vt*ct+Lt*Xe)*pt;if(ni<0||ni>1)return null;const wi=Vt*oe-Lt*J,Ht=Lt*W-ht*oe,si=ht*J-Vt*W,ui=($[0]*wi+$[1]*Ht+$[2]*si)*pt;return ui<0||ni+ui>1?null:(ue*wi+ye*Ht+ke*si)*pt}function hw(n,t,r){return(n-t)/(r-t)}function dw(n,t,r,u,p,y,w,M,D){const R=1<<r,$=y-u,W=w-p,J=(n+1)/R*$+u,oe=(t+0)/R*W+p,ue=(t+1)/R*W+p;M[0]=(n+0)/R*$+u,M[1]=oe,D[0]=J,D[1]=ue}class fw{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(y){const w=Math.ceil(Math.log2(y.dim/8)),M=[];let D=Math.ceil(Math.pow(2,w));const R=1/D,$=(oe,ue,ye,ke,Ke)=>{const ct=ke?1:0,Xe=(oe+1)*ye-ct,nt=ue*ye,pt=(ue+1)*ye-ct;Ke[0]=oe*ye,Ke[1]=nt,Ke[2]=Xe,Ke[3]=pt};let W=new lw(D);const J=[];for(let oe=0;oe<D*D;oe++){$(oe%D,Math.floor(oe/D),R,!1,J);const ue=yf(J[0],J[1],y),ye=yf(J[2],J[1],y),ke=yf(J[2],J[3],y),Ke=yf(J[0],J[3],y);W.minimums.push(Math.min(ue,ye,ke,Ke)),W.maximums.push(Math.max(ue,ye,ke,Ke)),W.leaves.push(1)}for(M.push(W),D/=2;D>=1;D/=2){const oe=M[M.length-1];W=new lw(D);for(let ue=0;ue<D*D;ue++){$(ue%D,Math.floor(ue/D),2,!0,J);const ye=oe.getElevation(J[0],J[1]),ke=oe.getElevation(J[2],J[1]),Ke=oe.getElevation(J[2],J[3]),ct=oe.getElevation(J[0],J[3]),Xe=oe.isLeaf(J[0],J[1]),nt=oe.isLeaf(J[2],J[1]),pt=oe.isLeaf(J[2],J[3]),ht=oe.isLeaf(J[0],J[3]),Vt=Math.min(ye.min,ke.min,Ke.min,ct.min),Lt=Math.max(ye.max,ke.max,Ke.max,ct.max),ni=Xe&&nt&&pt&&ht;W.maximums.push(Lt),W.minimums.push(Vt),W.leaves.push(Lt-Vt<=5&&ni?1:0)}M.push(W)}return M}(this.dem),u=r.length-1,p=r[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(r,0,0,u,0)}raycastRoot(t,r,u,p,y,w,M=1){return cw([t,r,-100],[u,p,this.maximums[0]*M],y,w)}raycast(t,r,u,p,y,w,M=1){if(!this.nodeCount)return null;const D=this.raycastRoot(t,r,u,p,y,w,M);if(D==null)return null;const R=[],$=[],W=[],J=[],oe=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;oe.length>0;){const{idx:ue,t:ye,nodex:ke,nodey:Ke,depth:ct}=oe.pop();if(this.leaves[ue]){dw(ke,Ke,ct,t,r,u,p,W,J);const nt=1<<ct,pt=(ke+0)/nt,ht=(ke+1)/nt,Vt=(Ke+0)/nt,Lt=(Ke+1)/nt,ni=yf(pt,Vt,this.dem)*M,wi=yf(ht,Vt,this.dem)*M,Ht=yf(ht,Lt,this.dem)*M,si=yf(pt,Lt,this.dem)*M,ui=uw(W[0],W[1],ni,J[0],W[1],wi,J[0],J[1],Ht,y,w),mi=uw(J[0],J[1],Ht,W[0],J[1],si,W[0],W[1],ni,y,w),Ei=Math.min(ui!==null?ui:Number.MAX_VALUE,mi!==null?mi:Number.MAX_VALUE);if(Ei!==Number.MAX_VALUE)return Ei;{const Kt=Hu([],y,w,ye);if(pw(ni,wi,si,Ht,hw(Kt[0],W[0],J[0]),hw(Kt[1],W[1],J[1]))>=Kt[2])return ye}continue}let Xe=0;for(let nt=0;nt<this._siblingOffset.length;nt++){dw((ke<<1)+this._siblingOffset[nt][0],(Ke<<1)+this._siblingOffset[nt][1],ct+1,t,r,u,p,W,J),W[2]=-100,J[2]=this.maximums[this.childOffsets[ue]+nt]*M;const pt=cw(W,J,y,w);if(pt!=null){const ht=pt;R[nt]=ht;let Vt=!1;for(let Lt=0;Lt<Xe&&!Vt;Lt++)ht>=R[$[Lt]]&&($.splice(Lt,0,nt),Vt=!0);Vt||($[Xe]=nt),Xe++}}for(let nt=0;nt<Xe;nt++){const pt=$[nt];oe.push({idx:this.childOffsets[ue]+pt,t:R[pt],nodex:(ke<<1)+this._siblingOffset[pt][0],nodey:(Ke<<1)+this._siblingOffset[pt][1],depth:ct+1})}}return null}_addNode(t,r,u){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,u,p,y){if(t[p].isLeaf(r,u)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const w=p-1,M=t[w];let D=0,R=0;for(let $=0;$<this._siblingOffset.length;$++){const W=2*r+this._siblingOffset[$][0],J=2*u+this._siblingOffset[$][1],oe=M.getElevation(W,J),ue=M.isLeaf(W,J),ye=this._addNode(oe.min,oe.max,ue);ue&&(D|=1<<$),R||(R=ye)}for(let $=0;$<this._siblingOffset.length;$++)D&1<<$||this._construct(t,2*r+this._siblingOffset[$][0],2*u+this._siblingOffset[$][1],w,R+$)}}function pw(n,t,r,u,p,y){return Qn(Qn(n,r,y),Qn(t,u,y),p)}function yf(n,t,r){const u=r.dim,p=Wt(n*u-.5,0,u-1),y=Wt(t*u-.5,0,u-1),w=Math.floor(p),M=Math.floor(y),D=Math.min(w+1,u-1),R=Math.min(M+1,u-1);return pw(r.get(w,M),r.get(D,M),r.get(w,R),r.get(D,R),p-w,y-M)}const mw={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ky{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,u,p=!1,y=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return at(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const w=this.dim=r.height-2,M=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let D=0;D<w;D++)M[this._idx(-1,D)]=M[this._idx(0,D)],M[this._idx(w,D)]=M[this._idx(w-1,D)],M[this._idx(D,-1)]=M[this._idx(D,0)],M[this._idx(D,w)]=M[this._idx(D,w-1)];M[this._idx(-1,-1)]=M[this._idx(0,0)],M[this._idx(w,-1)]=M[this._idx(w-1,0)],M[this._idx(-1,w)]=M[this._idx(0,w-1)],M[this._idx(w,w)]=M[this._idx(w-1,w-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new fw(this)}get(t,r,u=!1){u&&(t=Wt(t,-1,this.dim),r=Wt(r,-1,this.dim));const p=4*this._idx(t,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(t){return mw[t]}get unpackVector(){return mw[this.encoding]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}_unpackMapbox(t,r,u){return(256*t*256+256*r+u)/10-1e4}_unpackTerrarium(t,r,u){return 256*t+r+u/256-32768}static pack(t,r){const u=[0,0,0,0],p=ky.getUnpackVector(r);let y=Math.floor((t+p[3])/p[2]);return u[2]=y%256,y=Math.floor(y/256),u[1]=y%256,y=Math.floor(y/256),u[0]=y,u}getPixels(){return new qa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,y=r*this.dim+this.dim,w=u*this.dim,M=u*this.dim+this.dim;switch(r){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:w=M-1;break;case 1:M=w+1}const D=-r*this.dim,R=-u*this.dim;for(let $=w;$<M;$++)for(let W=p;W<y;W++){const J=4*this._idx(W,$),oe=4*this._idx(W+D,$+R);this.pixels[J+0]=t.pixels[oe+0],this.pixels[J+1]=t.pixels[oe+1],this.pixels[J+2]=t.pixels[oe+2],this.pixels[J+3]=t.pixels[oe+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ft(ky,"DEMData"),ft(fw,"DemMinMaxQuadTree",{omit:["dem"]});class kA{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:r,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},u)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const u=t.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),y=this.data[u][p];return this.data[u].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||r.push(p);for(const u of r)this.remove(u.value.tileID,u)}}class mm{constructor(t,r,u){this.func=t,this.mask=r,this.range=u}}mm.ReadOnly=!1,mm.ReadWrite=!0,mm.disabled=new mm(519,mm.ReadOnly,[0,1]);const R0=7680;class O0{constructor(t,r,u,p,y,w){this.test=t,this.ref=r,this.mask=u,this.fail=p,this.depthFail=y,this.pass=w}}O0.disabled=new O0({func:519,mask:0},0,0,R0,R0,R0);class Ah{constructor(t,r,u){this.blendFunction=t,this.blendColor=r,this.mask=u}}Ah.Replace=[1,0],Ah.disabled=new Ah(Ah.Replace,ho.transparent,[!1,!1,!1,!1]),Ah.unblended=new Ah(Ah.Replace,ho.transparent,[!0,!0,!0,!0]),Ah.alphaBlended=new Ah([1,771],ho.transparent,[!0,!0,!0,!0]);const F0=1029,V0=2305;class Qu{constructor(t,r,u){this.enable=t,this.mode=r,this.frontFace=u}}Qu.disabled=new Qu(!1,F0,V0),Qu.backCCW=new Qu(!0,F0,V0),Qu.backCW=new Qu(!0,F0,2304),Qu.frontCW=new Qu(!0,1028,2304),Qu.frontCCW=new Qu(!0,1028,V0);class rp extends xn{constructor(t,r,u){super(),this.id=t,this._onlySymbols=u,r.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new kA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new MA,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const u=this._tiles[r];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return cn(this._tiles).map(t=>t.tileID).sort(gw).map(t=>t.key)}getRenderableIds(t){const r=[];for(const u in this._tiles)this._isIdRenderable(+u,t)&&r.push(this._tiles[u]);return t?r.sort((u,p)=>{const y=u.tileID,w=p.tileID,M=new Me(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),D=new Me(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||D.y-M.y||D.x-M.x}).map(u=>u.tileID.key):r.map(u=>u.tileID).sort(gw).map(u=>u.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,t,r)))}_tileLoaded(t,r,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new Zn(p,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=ri.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new _n("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const y=r[p];if(t.neighboringTiles&&t.neighboringTiles[y]){const w=this.getTileByID(y);u(t,w),u(w,t)}}function u(p,y){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-p.tileID.canonical.x;const M=y.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),R=y.tileID.key;w===0&&M===0||Math.abs(M)>1||(Math.abs(w)>1&&(Math.abs(w+D)===1?w+=D:Math.abs(w-D)===1&&(w-=D)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,w,M),p.neighboringTiles&&p.neighboringTiles[R]&&(p.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,u,p){for(const y in this._tiles){let w=this._tiles[y];if(p[y]||!w.hasData()||w.tileID.overscaledZ<=r||w.tileID.overscaledZ>u)continue;let M=w.tileID;for(;w&&w.tileID.overscaledZ>r+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(M=R)}let D=M;for(;D.overscaledZ>r;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]){p[M.key]=M;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=t.overscaledZ-1;u>=r;u--){const p=t.scaledTo(u),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const u=Math.ceil(t.width/r)+1,p=Math.ceil(t.height/r)+1,y=Math.floor(u*p*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(M)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const u={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+r),u[y.tileID.key]=y}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,r,u){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new Wi(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(p=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(M=>this._source.hasTile(M)))):p=[];const y=this._updateRetainedTiles(p);if(_w(this._source.type)&&p.length!==0){const M={},D={},R=Object.keys(y);for(const W of R){const J=y[W],oe=this._tiles[W];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=ri.now())continue;const ue=this.findLoadedParent(J,Math.max(J.overscaledZ-rp.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),M[ue.tileID.key]=ue.tileID),D[W]=J}const $=p[p.length-1].overscaledZ;for(const W in this._tiles){const J=this._tiles[W];if(y[W]||!J.hasData())continue;let oe=J.tileID;for(;oe.overscaledZ>$;){oe=oe.scaledTo(oe.overscaledZ-1);const ue=this._tiles[oe.key];if(ue&&ue.hasData()&&D[oe.key]){y[W]=J.tileID;break}}}for(const W in M)y[W]||(this._coveredTiles[W]=!0,y[W]=M[W])}for(const M in y)this._tiles[M].clearFadeHold();const w=function(M,D){const R=[];for(const $ in M)$ in D||R.push($);return R}(this._tiles,y);for(const M of w){const D=this._tiles[M];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const u={},p=t.reduce((R,$)=>Math.min(R,$.overscaledZ),1/0),y=t[0].overscaledZ,w=Math.max(y-rp.maxOverzooming,this._source.minzoom),M=Math.max(y+rp.maxUnderzooming,this._source.minzoom),D={};for(const R of t){const $=this._addTile(R);r[R.key]=R,$.hasData()||p<this._source.maxzoom&&(D[R.key]=R)}this._retainLoadedChildren(D,p,M,r);for(const R of t){let $=this._tiles[R.key];if($.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const J=R.children(this._source.maxzoom)[0],oe=this.getTile(J);if(oe&&oe.hasData()){r[J.key]=J;continue}}else{const J=R.children(this._source.maxzoom);if(r[J[0].key]&&r[J[1].key]&&r[J[2].key]&&r[J[3].key])continue}let W=$.wasRequested();for(let J=R.overscaledZ-1;J>=w;--J){const oe=R.scaledTo(J);if(u[oe.key]||(u[oe.key]=!0,$=this.getTile(oe),!$&&W&&($=this._addTile(oe)),$&&(r[oe.key]=oe,W=$.wasRequested(),$.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;p=y}for(const y of r)this._loadedParentTiles[y]=u}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const u=Boolean(r);if(!u){const p=this.map?this.map.painter:null;r=new B0(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,u||this._source.fire(new _n("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=r.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,u){const p=[],y=this.transform;if(!y)return p;const w=y.projection.name==="globe",M=fc(y.center.lng);for(const D in this._tiles){const R=this._tiles[D];if(u&&R.clearQueryDebugViz(),R.holdingForFade())continue;let $;if(w){const W=R.tileID.canonical;if(W.z===0){const J=[Math.abs(Wt(M,...Ng(W,-1))-M),Math.abs(Wt(M,...Ng(W,1))-M)];$=[0,2*J.indexOf(Math.min(...J))-1]}else{const J=[Math.abs(Wt(M,...Ng(W,-1))-M),Math.abs(Wt(M,...Ng(W,0))-M),Math.abs(Wt(M,...Ng(W,1))-M)];$=[J.indexOf(Math.min(...J))-1]}}else $=[0];for(const W of $){const J=t.containsTile(R,y,r,W);J&&p.push(J)}}return p}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of r)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(_w(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=ri.now())return!0}return!1}setFeatureState(t,r,u){this._state.updateState(t=t||"_geojsonTileLayer",r,u)}removeFeatureState(t,r,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,u)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,u){const p=this._tiles[t];p&&p.setDependencies(r,u)}reloadTilesForDependencies(t,r){for(const u in this._tiles)this._tiles[u].hasDependency(t,r)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,r))}_preloadTiles(t,r){const u=new Map,p=Array.isArray(t)?t:[t],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const M of p){const D=M.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of D)u.set(R.key,R);this.usedForTerrain&&M.updateElevation(!1)}vi(Array.from(u.values()),(M,D)=>{const R=new B0(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,$=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),D($,R)})},r)}}function gw(n,t){const r=Math.abs(2*n.wrap)-+(n.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return n.overscaledZ-t.overscaledZ||u-r||t.canonical.y-n.canonical.y||t.canonical.x-n.canonical.x}function _w(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function Ng(n,t){const r=1<<n.z;return[n.x/r+t,(n.x+1)/r+t]}rp.maxOverzooming=10,rp.maxUnderzooming=3;class Py{constructor(t,r,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=u}static create(t,r,u){const p=u||t.findDEMTileFor(r);if(!p||!p.dem)return;const y=p.dem,w=p.tileID,M=1<<r.canonical.z-w.canonical.z;return new Py(p,p.tileSize/In/M,[(r.canonical.x/M-w.canonical.x)*y.dim,(r.canonical.y/M-w.canonical.y)*y.dim])}tileCoordToPixel(t,r){const u=r*this._scale+this._offset[1],p=Math.floor(t*this._scale+this._offset[0]),y=Math.floor(u);return new Me(p,y)}getElevationAt(t,r,u,p){const y=t*this._scale+this._offset[0],w=r*this._scale+this._offset[1],M=Math.floor(y),D=Math.floor(w),R=this._dem;return p=!!p,u?Qn(Qn(R.get(M,D,p),R.get(M,D+1,p),w-D),Qn(R.get(M+1,D,p),R.get(M+1,D+1,p),w-D),y-M):R.get(M,D,p)}getElevationAtPixel(t,r,u){return this._dem.get(t,r,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Fl(1,t)*this._dem.stride}}class yw{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Tt(In,16,0),this.featureIndexArray=new D_,this.promoteId=r}insert(t,r,u,p,y,w=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y,w);const D=this.grid;for(let R=0;R<r.length;R++){const $=r[R],W=[1/0,1/0,-1/0,-1/0];for(let J=0;J<$.length;J++){const oe=$[J];W[0]=Math.min(W[0],oe.x),W[1]=Math.min(W[1],oe.y),W[2]=Math.max(W[2],oe.x),W[3]=Math.max(W[3],oe.y)}W[0]<In&&W[1]<In&&W[2]>=0&&W[3]>=0&&D.insert(M,W[0],W[1],W[2],W[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new h(new ka(this.rawTileData)).layers,this.sourceLayerCoder=new nw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,u,p){this.loadVTLayers();const y=t.params||{},w=gs(y.filter),M=t.tileResult,D=t.transform,R=M.bufferedTilespaceBounds,$=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(ue,ye,ke,Ke)=>Xd(M.bufferedTilespaceGeometry,ue,ye,ke,Ke));$.sort(PA);let W=null;D.elevation&&$.length>0&&(W=Py.create(D.elevation,this.tileID));const J={};let oe;for(let ue=0;ue<$.length;ue++){const ye=$[ue];if(ye===oe)continue;oe=ye;const ke=this.featureIndexArray.get(ye);let Ke=null;this.loadMatchingFeature(J,ke,w,y.layers,y.availableImages,r,u,p,(ct,Xe,nt,pt=0)=>(Ke||(Ke=Wu(ct,this.tileID.canonical,t.tileTransform)),Xe.queryIntersectsFeature(M,ct,nt,Ke,this.z,t.transform,t.pixelPosMatrix,W,pt)))}return J}loadMatchingFeature(t,r,u,p,y,w,M,D,R){const{featureIndex:$,bucketIndex:W,sourceLayerIndex:J,layoutVertexArrayOffset:oe}=r,ue=this.bucketLayerIDs[W];if(p&&!function(ct,Xe){for(let nt=0;nt<ct.length;nt++)if(Xe.indexOf(ct[nt])>=0)return!0;return!1}(p,ue))return;const ye=this.sourceLayerCoder.decode(J),ke=this.vtLayers[ye].feature($);if(u.needGeometry){const ct=sd(ke,!0);if(!u.filter(new Et(this.tileID.overscaledZ),ct,this.tileID.canonical))return}else if(!u.filter(new Et(this.tileID.overscaledZ),ke))return;const Ke=this.getId(ke,ye);for(let ct=0;ct<ue.length;ct++){const Xe=ue[ct];if(p&&p.indexOf(Xe)<0)continue;const nt=w[Xe];if(!nt)continue;let pt={};Ke!==void 0&&D&&(pt=D.getState(nt.sourceLayer||"_geojsonTileLayer",Ke));const ht=di({},M[Xe]);ht.paint=vw(ht.paint,nt.paint,ke,pt,y),ht.layout=vw(ht.layout,nt.layout,ke,pt,y);const Vt=!R||R(ke,nt,pt,oe);if(!Vt)continue;const Lt=new rw(ke,this.z,this.x,this.y,Ke);Lt.layer=ht;let ni=t[Xe];ni===void 0&&(ni=t[Xe]=[]),ni.push({featureIndex:$,feature:Lt,intersectionZ:Vt})}}lookupSymbolFeatures(t,r,u,p,y,w,M,D){const R={};this.loadVTLayers();const $=gs(y);for(const W of t)this.loadMatchingFeature(R,{bucketIndex:u,sourceLayerIndex:p,featureIndex:W,layoutVertexArrayOffset:0},$,w,M,D,r);return R}loadFeature(t){const{featureIndex:r,sourceLayerIndex:u}=t;this.loadVTLayers();const p=this.sourceLayerCoder.decode(u),y=this.vtFeatures[p];if(y[r])return y[r];const w=this.vtLayers[p].feature(r);return y[r]=w,w}hasLayer(t){for(const r of this.bucketLayerIDs)for(const u of r)if(t===u)return!0;return!1}getId(t,r){let u=t.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];p!=null&&(u=t.properties[p]),typeof u=="boolean"&&(u=Number(u))}return u}}function vw(n,t,r,u,p){return Fo(n,(y,w)=>{const M=t instanceof Ti?t.get(w):null;return M&&M.evaluate?M.evaluate(r,u,p):M})}function PA(n,t){return t-n}ft(yw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class xw{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new Nl({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const u=this.getKey(t,r);return this.positions[u]}trim(){const t=this.width,r=this.height=Li(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,u){const p=[];let y=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,M=!0;p.push({left:y,right:w,isDash:M,zeroLength:t[0]===0});let D=t[0];for(let R=1;R<t.length;R++){M=!M;const $=t[R];y=D*u,D+=$,w=D*u,p.push({left:y,right:w,isDash:M,zeroLength:$===0})}return p}addRoundDash(t,r,u){const p=r/2;for(let y=-u;y<=u;y++){const w=this.width*(this.nextRow+u+y);let M=0,D=t[M];for(let R=0;R<this.width;R++){R/D.right>1&&(D=t[++M]);const $=Math.abs(R-D.left),W=Math.abs(R-D.right),J=Math.min($,W);let oe;const ue=y/u*(p+1);if(D.isDash){const ye=p-Math.abs(ue);oe=Math.sqrt(J*J+ye*ye)}else oe=p-Math.sqrt(J*J+ue*ue);this.image.data[w+R]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(t,r){for(let D=t.length-1;D>=0;--D){const R=t[D],$=t[D+1];R.zeroLength?t.splice(D,1):$&&$.isDash===R.isDash&&($.left=R.left,t.splice(D,1))}const u=t[0],p=t[t.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const y=this.width*this.nextRow;let w=0,M=t[w];for(let D=0;D<this.width;D++){D/M.right>1&&(M=t[++w]);const R=Math.abs(D-M.left),$=Math.abs(D-M.right),W=Math.min(R,$);this.image.data[y+D]=Math.max(0,Math.min(255,(M.isDash?W:-W)+r+128))}}addDash(t,r){const u=this.getKey(t,r);if(this.positions[u])return this.positions[u];const p=r==="round",y=p?7:0,w=2*y+1;if(this.nextRow+w>this.height)return at("LineAtlas out of space"),null;t.length===0&&t.push(1);let M=0;for(let $=0;$<t.length;$++)t[$]<0&&(at("Negative value is found in line dasharray, replacing values with 0"),t[$]=0),M+=t[$];if(M!==0){const $=this.width/M,W=this.getDashRanges(t,this.width,$);p?this.addRoundDash(W,$,y):this.addRegularDash(W,r==="square"?.5*$:0)}const D=this.nextRow+y;this.nextRow+=w;const R={tl:[D,y],br:[M,0]};return this.positions[u]=R,R}}ft(xw,"LineAtlas");class bw{constructor(t){const r={},u=[];for(const M in t){const D=t[M],R=r[M]={};for(const $ in D.glyphs){const W=D.glyphs[+$];if(!W||W.bitmap.width===0||W.bitmap.height===0)continue;const J=W.metrics.localGlyph?2:1,oe={x:0,y:0,w:W.bitmap.width+2*J,h:W.bitmap.height+2*J};u.push(oe),R[$]=oe}}const{w:p,h:y}=am(u),w=new Nl({width:p||1,height:y||1});for(const M in t){const D=t[M];for(const R in D.glyphs){const $=D.glyphs[+R];if(!$||$.bitmap.width===0||$.bitmap.height===0)continue;const W=r[M][R],J=$.metrics.localGlyph?2:1;Nl.copy($.bitmap,w,{x:0,y:0},{x:W.x+J,y:W.y+J},$.bitmap)}}this.image=w,this.positions=r}}ft(bw,"GlyphAtlas");class zA{constructor(t){this.tileID=new Wi(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=np(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,r,u,p,y){this.status="parsing",this.data=t,this.collisionBoxArray=new Jm;const w=new nw(Object.keys(t.layers).sort()),M=new yw(this.tileID,this.promoteId);M.bucketLayerIDs=[];const D={},R=new xw(256,256),$={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:R,availableImages:u},W=r.familiesBySource[this.source];for(const pt in W){const ht=t.layers[pt];if(!ht)continue;let Vt=!1,Lt=!1;for(const Ht of W[pt])Ht[0].type==="symbol"?Vt=!0:Lt=!0;if(this.isSymbolTile===!0&&!Vt||this.isSymbolTile===!1&&!Lt)continue;ht.version===1&&at(`Vector tile source "${this.source}" layer "${pt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ni=w.encode(pt),wi=[];for(let Ht=0;Ht<ht.length;Ht++){const si=ht.feature(Ht),ui=M.getId(si,pt);wi.push({feature:si,id:ui,index:Ht,sourceLayerIndex:ni})}for(const Ht of W[pt]){const si=Ht[0];this.isSymbolTile!==void 0&&si.type==="symbol"!==this.isSymbolTile||si.minzoom&&this.zoom<Math.floor(si.minzoom)||si.maxzoom&&this.zoom>=si.maxzoom||si.visibility!=="none"&&(N0(Ht,this.zoom,u),(D[si.id]=si.createBucket({index:M.bucketLayerIDs.length,layers:Ht,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ni,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(wi,$,this.tileID.canonical,this.tileTransform),M.bucketLayerIDs.push(Ht.map(ui=>ui.id)))}}let J,oe,ue,ye;R.trim();const ke={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ke=Fo($.glyphDependencies,pt=>Object.keys(pt).map(Number));Object.keys(Ke).length?p.send("getGlyphs",{uid:this.uid,stacks:Ke},(pt,ht)=>{J||(J=pt,oe=ht,nt.call(this))},void 0,!1,ke):oe={};const ct=Object.keys($.iconDependencies);ct.length?p.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"icons"},(pt,ht)=>{J||(J=pt,ue=ht,nt.call(this))},void 0,!1,ke):ue={};const Xe=Object.keys($.patternDependencies);function nt(){if(J)return y(J);if(oe&&ue&&ye){const pt=new bw(oe),ht=new yc(ue,ye);for(const Vt in D){const Lt=D[Vt];Lt instanceof mf?(N0(Lt.layers,this.zoom,u),eA(Lt,oe,pt.positions,ue,ht.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Lt.hasPattern&&(Lt instanceof $o||Lt instanceof Qf||Lt instanceof de)&&(N0(Lt.layers,this.zoom,u),Lt.addFeatures($,this.tileID.canonical,ht.patternPositions,u,this.tileTransform))}this.status="done",y(null,{buckets:cn(D).filter(Vt=>!Vt.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pt.image,lineAtlas:R,imageAtlas:ht,glyphMap:this.returnDependencies?oe:null,iconMap:this.returnDependencies?ue:null,glyphPositions:this.returnDependencies?pt.positions:null})}}Xe.length?p.send("getImages",{icons:Xe,source:this.source,tileID:this.tileID,type:"patterns"},(pt,ht)=>{J||(J=pt,ye=ht,nt.call(this))},void 0,!1,ke):ye={},nt.call(this)}}function N0(n,t,r){const u=new Et(t);for(const p of n)p.recalculate(u,r)}class ww{constructor(t){this.entries={},this.scheduler=t}request(t,r,u,p){const y=this.entries[t]=this.entries[t]||{callbacks:[]};if(y.result){const[w,M]=y.result;return this.scheduler?this.scheduler.add(()=>{p(w,M)},r):p(w,M),()=>{}}return y.callbacks.push(p),y.cancel||(y.cancel=u((w,M)=>{y.result=[w,M];for(const D of y.callbacks)this.scheduler?this.scheduler.add(()=>{D(w,M)},r):D(w,M);setTimeout(()=>delete this.entries[t],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(w=>w!==p),y.callbacks.length||(y.cancel(),delete this.entries[t]))}}}function Tw(n,t,r){const u=JSON.stringify(n.request);return n.data&&(this.deduped.entries[u]={result:[null,n.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},p=>{const y=_o(n.request,(w,M,D,R)=>{w?p(w):M&&p(null,{vectorTile:r?void 0:new h(new ka(M)),rawData:M,cacheControl:D,expires:R})});return()=>{y.cancel(),p()}},t)}i.ARRAY_TYPE=Ia,i.AUTH_ERR_MSG=Co,i.Aabb=Xs,i.Actor=class{constructor(n,t,r){this.target=n,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},wn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=fi()?n:F,this.scheduler=new IA}send(n,t,r,u,p=!1,y){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=y,this.callbacks[w]=r);const M=Ki(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:n,hasCallback:!!r,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:Qt(t,M)},M),{cancel:()=>{r&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(n){const t=n.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const u=this.cancelCallbacks[r];delete this.cancelCallbacks[r],u&&u.cancel()}else if(t.mustQueue||fi()){const u=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,t),u&&u.metadata||{type:"message"})}else this.processTask(r,t)}processTask(n,t){if(t.type==="<response>"){const r=this.callbacks[n];delete this.callbacks[n],r&&(t.error?r(_i(t.error)):r(null,_i(t.data)))}else{const r=Ki(this.globalScope)?void 0:[],u=t.hasCallback?(y,w)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:y?Qt(y):null,data:Qt(w,r)},r)}:y=>{},p=_i(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,p,u);else if(this.parent.getWorkerSource){const y=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,y[0],p.source)[y[1]](p,u)}else u(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.CanonicalTileID=li,i.Color=ho,i.ColorMode=Ah,i.CullFaceMode=Qu,i.DEMData=ky,i.DataConstantProperty=St,i.DedupedRequest=ww,i.DepthMode=mm,i.EXTENT=In,i.Elevation=class{isDataAvailableAtPoint(n){const t=this._source();if(this.isUsingMockSource()||!t||n.y<0||n.y>1)return!1;const r=t.getSource().maxzoom,u=1<<r,p=Math.floor(n.x),y=Math.floor((n.x-p)*u),w=Math.floor(n.y*u),M=this.findDEMTileFor(new Wi(r,p,r,y,w));return!(!M||!M.dem)}getAtPointOrZero(n,t=0){return this.getAtPoint(n,t)||0}getAtPoint(n,t,r=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const u=this._source();if(!u||n.y<0||n.y>1)return t;const p=u.getSource().maxzoom,y=1<<p,w=Math.floor(n.x),M=n.x-w,D=new Wi(p,w,p,Math.floor(M*y),Math.floor(n.y*y)),R=this.findDEMTileFor(D);if(!R||!R.dem)return t;const $=R.dem,W=1<<R.tileID.canonical.z,J=(M*W-R.tileID.canonical.x)*$.dim,oe=(n.y*W-R.tileID.canonical.y)*$.dim,ue=Math.floor(J),ye=Math.floor(oe);return(r?this.exaggeration():1)*Qn(Qn($.get(ue,ye),$.get(ue,ye+1),oe-ye),Qn($.get(ue+1,ye),$.get(ue+1,ye+1),oe-ye),J-ue)}getAtTileOffset(n,t,r){const u=1<<n.canonical.z;return this.getAtPointOrZero(new Wd(n.wrap+(n.canonical.x+t/In)/u,(n.canonical.y+r/In)/u))}getAtTileOffsetFunc(n,t,r,u){return p=>{const y=this.getAtTileOffset(n,p.x,p.y),w=u.upVector(n.canonical,p.x,p.y);return pa(w,w,y*u.upVectorScale(n.canonical,t,r).metersToTile),w}}getForTilePoints(n,t,r,u){if(this.isUsingMockSource())return!1;const p=Py.create(this,n,u);return!!p&&(t.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(n);if(!t||!t.dem)return null;const r=t.dem.tree,u=t.tileID,p=1<<n.canonical.z-u.canonical.z;let y=n.canonical.x/p-u.canonical.x,w=n.canonical.y/p-u.canonical.y,M=0;for(let D=0;D<n.canonical.z-u.canonical.z&&!r.leaves[M];D++){y*=2,w*=2;const R=2*Math.floor(w)+Math.floor(y);M=r.childOffsets[M]+R,y%=1,w%=1}return{min:this.exaggeration()*r.minimums[M],max:this.exaggeration()*r.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},i.ErrorEvent=Zn,i.EvaluationParameters=Et,i.Event=_n,i.Evented=xn,i.FillExtrusionBucket=de,i.Frustum=Yp,i.FrustumCorners=Kp,i.GLOBE_METERS_TO_ECEF=C0,i.GLOBE_RADIUS=yd,i.GLOBE_SCALE_MATCH_LATITUDE=45,i.GLOBE_ZOOM_THRESHOLD_MAX=6,i.GLOBE_ZOOM_THRESHOLD_MIN=5,i.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const t=new Ir,r=new Es,u=65;for(let p=0;p<u;p++)for(let y=0;y<u;y++)t.emplaceBack(y,p);this._gridSegments=[];for(let p=0,y=0;p<hm.length;p++){const w=hm[p];for(let D=0;D<w;D++)for(let R=0;R<64;R++){const $=D*u+R;r.emplaceBack($+1,$,$+u),r.emplaceBack($+u,$+u+1,$+1)}const M=64*w*2;this._gridSegments.push(as.simpleSegment(0,y,(w+1)*u,M)),y+=M}this._gridBuffer=n.createVertexBuffer(t,Pg.members),this._gridIndexBuffer=n.createIndexBuffer(r,!0)}_createPoles(n){const t=new Es;for(let p=0;p<=um;p++)t.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=n.createIndexBuffer(t,!0);const r=new ju,u=new ju;this._poleSegments=[];for(let p=0,y=0;p<5;p++){const w=360/(1<<p);r.emplaceBack(0,-yd,0,.5,0),u.emplaceBack(0,-yd,0,.5,1);for(let M=0;M<=um;M++){const D=M/um,R=Qn(0,w,D),[$,W,J]=dm(aA,lA,R,yd);r.emplaceBack($,W,J,D,0),u.emplaceBack($,W,J,D,1)}this._poleSegments.push(as.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,Ub,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(u,Ub,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,t){if(!this._wireframeSegments){const r=new ja,u=um,p=u+1;this._wireframeSegments=[];for(let y=0,w=0;y<hm.length;y++){const M=hm[y];for(let R=0;R<M;R++)for(let $=0;$<u;$++){const W=R*p+$;r.emplaceBack(W,W+1),r.emplaceBack(W,W+p),r.emplaceBack(W,W+p+1)}const D=M*u*3;this._wireframeSegments.push(as.simpleSegment(0,w,(M+1)*p,D)),w+=D}this._wireframeIndexBuffer=n.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},i.GlyphManager=lm,i.ImagePosition=Ys,i.LivePerformanceUtils=qe,i.LngLat=wr,i.LngLatBounds=gl,i.LocalGlyphMode=w0,i.MAX_MERCATOR_LATITUDE=Ga,i.MercatorCoordinate=Wd,i.ONE_EM=qr,i.OverscaledTileID=Wi,i.PerformanceMarkers=Se,i.Properties=vn,i.RGBAImage=qa,i.Ray=Hp,i.RequestManager=class{constructor(n,t,r){this._transformRequestFn=n,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let t="";for(let r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",tt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,t){return this._transformRequestFn&&this._transformRequestFn(n,t)||{url:n}}normalizeStyleURL(n,t){if(!is(n))return n;const r=so(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeGlyphsURL(n,t){if(!is(n))return n;const r=so(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(n,t,r,u){if(!is(n))return n;const p=so(n);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),r&&p.params.push(`language=${r}`),u&&p.params.push(`worldview=${u}`),this._makeAPIURL(p,this._customAccessToken||t)}normalizeSpriteURL(n,t,r,u){const p=so(n);return is(n)?(p.path=`/styles/v1${p.path}/sprite${t}${r}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${t}${r}`,pr(p))}normalizeTileURL(n,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!is(n))return n;const u=so(n);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&u.authority!=="raster"&&r===512?"@2x":""}${q.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${Y.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Y.TILE_URL_VERSION}${u.path}`);const p=this._customAccessToken||function(y){for(const w of y){const M=w.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||Y.ACCESS_TOKEN;return Y.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(n,t){const r=so(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let u="mapbox://";r.path.match(/^\/raster\/v1\//)?u+=`raster/${r.path.replace(`/${Y.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${r.path.replace(`/${Y.TILE_URL_VERSION}/`,"")}`;let p=r.params;return t&&(p=p.filter(y=>!y.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(n,t){const r=!!t&&is(t),u=[];for(const p of n.tiles||[])kn(p)?u.push(this.canonicalizeTileURL(p,r)):u.push(p);return u}_makeAPIURL(n,t){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=so(Y.API_URL);if(n.protocol=u.protocol,n.authority=u.authority,n.protocol==="http"){const p=n.params.indexOf("secure");p>=0&&n.params.splice(p,1)}if(u.path!=="/"&&(n.path=`${u.path}${n.path}`),!Y.REQUIRE_ACCESS_TOKEN)return pr(n);if(t=t||Y.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(p=>p.indexOf("access_token")===-1),n.params.push(`access_token=${t||""}`),pr(n)}},i.ResourceType=Pr,i.SegmentVector=as,i.SourceCache=rp,i.StencilMode=O0,i.StructArrayLayout1ui2=qu,i.StructArrayLayout2f1f2i16=Ds,i.StructArrayLayout2i4=Ir,i.StructArrayLayout2ui4=ja,i.StructArrayLayout3f12=$a,i.StructArrayLayout3ui6=Es,i.StructArrayLayout4i8=Mr,i.StructArrayLayout5f20=ju,i.Texture=Vg,i.Tile=B0,i.Transitionable=ei,i.Uniform1f=id,i.Uniform1i=class extends Kc{constructor(n){super(n),this.current=0}set(n,t,r){this.fetchUniformLocation(n,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},i.Uniform2f=class extends Kc{constructor(n){super(n),this.current=[0,0]}set(n,t,r){this.fetchUniformLocation(n,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},i.Uniform3f=class extends Kc{constructor(n){super(n),this.current=[0,0,0]}set(n,t,r){this.fetchUniformLocation(n,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},i.Uniform4f=Of,i.UniformColor=qd,i.UniformMatrix2f=class extends Kc{constructor(n){super(n),this.current=Ff}set(n,t,r){if(this.fetchUniformLocation(n,t)){for(let u=0;u<4;u++)if(r[u]!==this.current[u]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},i.UniformMatrix3f=class extends Kc{constructor(n){super(n),this.current=V_}set(n,t,r){if(this.fetchUniformLocation(n,t)){for(let u=0;u<9;u++)if(r[u]!==this.current[u]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},i.UniformMatrix4f=class extends Kc{constructor(n){super(n),this.current=F_}set(n,t,r){if(this.fetchUniformLocation(n,t)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let u=1;u<16;u++)if(r[u]!==this.current[u]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},i.UnwrappedTileID=nn,i.ValidationError=ji,i.VectorTileFeature=v,i.VectorTileWorkerSource=class extends xn{constructor(n,t,r,u,p){super(),this.actor=n,this.layerIndex=t,this.availableImages=r,this.loadVectorData=p||Tw,this.loading={},this.loaded={},this.deduped=new ww(n.scheduler),this.isSpriteLoaded=u,this.scheduler=n.scheduler}loadTile(n,t){const r=n.uid,u=n&&n.request,p=u&&u.collectResourceTiming,y=this.loading[r]=new zA(n);y.abort=this.loadVectorData(n,(w,M)=>{const D=!this.loading[r];if(delete this.loading[r],D||w||!M)return y.status="done",D||(this.loaded[r]=y),t(w);const R=M.rawData,$={};M.expires&&($.expires=M.expires),M.cacheControl&&($.cacheControl=M.cacheControl),y.vectorTile=M.vectorTile||new h(new ka(R));const W=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(J,oe)=>{if(J||!oe)return t(J);const ue={};if(p){const ye=it(u);ye.length>0&&(ue.resourceTiming=JSON.parse(JSON.stringify(ye)))}t(null,di({rawTileData:R.slice(0)},oe,$,ue))})};this.isSpriteLoaded?W():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(W,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):W()}),this.loaded=this.loaded||{},this.loaded[r]=y})}reloadTile(n,t){const r=this.loaded,u=n.uid,p=this;if(r&&r[u]){const y=r[u];y.showCollisionBoxes=n.showCollisionBoxes,y.enableTerrain=!!n.enableTerrain,y.projection=n.projection,y.tileTransform=np(n.tileID.canonical,n.projection);const w=(M,D)=>{const R=y.reloadCallback;R&&(delete y.reloadCallback,y.parse(y.vectorTile,p.layerIndex,this.availableImages,p.actor,R)),t(M,D)};y.status==="parsing"?y.reloadCallback=w:y.status==="done"&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,w):w())}}abortTile(n,t){const r=n.uid,u=this.loading[r];u&&(u.abort&&u.abort(),delete this.loading[r]),t()}removeTile(n,t){const r=this.loaded,u=n.uid;r&&r[u]&&delete r[u],t()}},i.WritingMode=Js,i.add=Xu,i.addDynamicAttributes=Iy,i.adjoint=function(n,t){var r=t[0],u=t[1],p=t[2],y=t[3],w=t[4],M=t[5],D=t[6],R=t[7],$=t[8];return n[0]=w*$-M*R,n[1]=p*R-u*$,n[2]=u*M-p*w,n[3]=M*D-y*$,n[4]=r*$-p*D,n[5]=p*y-r*M,n[6]=y*R-w*D,n[7]=u*D-r*R,n[8]=r*w-u*y,n},i.asyncAll=vi,i.bezier=ti,i.bindAll=wn,i.boundsAttributes=sw,i.bufferConvexPolygon=function(n,t){const r=[];for(let u=0;u<n.length;u++){const p=Yt(u-1,-1,n.length-1),y=Yt(u+1,-1,n.length-1),w=n[u],M=n[y],D=n[p].sub(w).unit(),R=M.sub(w).unit(),$=R.angleWithSep(D.x,D.y),W=D.add(R).unit().mult(-1*t/Math.sin($/2));r.push(w.add(W))}return r},i.cacheEntryPossiblyAdded=function(n){yi++,yi>Tn&&(n.getActor().send("enforceCacheSizeLimit",hn),yi=0)},i.calculateGlobeLabelMatrix=function(n,t){const{x:r,y:u}=n.point,p=Wb(r,u,n.worldSize/n._pixelsPerMercatorPixel,0,0);return cd(p,p,M0(Sh(t)))},i.calculateGlobeMatrix=function(n){const{x:t,y:r}=n.point,{lng:u,lat:p}=n._center;return Wb(t,r,n.worldSize,u,p)},i.calculateGlobeMercatorMatrix=function(n){const t=n.pixelsPerMeter,r=t/Fl(1,n.center.lat),u=Vl(new Float64Array(16));return Gf(u,u,[n.point.x,n.point.y,0]),ud(u,u,[r,r,t]),Float32Array.from(u)},i.circumferenceAtLatitude=$p,i.clamp=Wt,i.clearTileCache=function(n){if(!On())return;const t=F.caches.delete(Si);n&&t.catch(n).then(()=>n())},i.clipLine=Db,i.clone=function(n){var t=new Ia(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},i.clone$1=uo,i.collisionCircleLayout=ma,i.config=Y,i.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},i.create=function(){var n=new Ia(16);return Ia!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},i.create$1=eu,i.createExpression=Po,i.createLayout=Yi,i.createStyleLayer=function(n){return n.type==="custom"?new TA(n):new SA[n.type](n)},i.cross=Qd,i.degToRad=gt,i.distance=function(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])},i.div=function(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n},i.dot=Aa,i.earthRadius=Up,i.ease=Nt,i.easeCubicInOut=At,i.ecefToLatLng=function([n,t,r]){const u=Math.hypot(n,t,r),p=Math.atan2(n,r),y=.5*Math.PI-Math.acos(-t/u);return new wr(vt(p),vt(y))},i.emitValidationErrors=_t,i.endsWith=vr,i.enforceCacheSizeLimit=function(n){qn(),tn&&tn.then(t=>{t.keys().then(r=>{for(let u=0;u<r.length-n;u++)t.delete(r[u])})})},i.evaluateSizeForFeature=Ho,i.evaluateSizeForZoom=Kn,i.evaluateVariableOffset=Fb,i.evented=lt,i.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},i.exactEquals$1=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},i.exported=ri,i.exported$1=q,i.extend=di,i.extend$1=Gn,i.fillExtrusionHeightLift=Pt,i.filterObject=Xr,i.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},i.fromQuat=function(n,t){var r=t[0],u=t[1],p=t[2],y=t[3],w=r+r,M=u+u,D=p+p,R=r*w,$=u*w,W=u*M,J=p*w,oe=p*M,ue=p*D,ye=y*w,ke=y*M,Ke=y*D;return n[0]=1-W-ue,n[1]=$+Ke,n[2]=J-ke,n[3]=0,n[4]=$-Ke,n[5]=1-R-ue,n[6]=oe+ye,n[7]=0,n[8]=J+ke,n[9]=oe-ye,n[10]=1-R-W,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},i.fromRotation=function(n,t){var r=Math.sin(t),u=Math.cos(t);return n[0]=u,n[1]=r,n[2]=0,n[3]=-r,n[4]=u,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.fromScaling=H_,i.furthestTileCorner=function(n){const t=Math.round((n+45+360)%360/90)%4;return Ut[t]},i.getAABBPointSquareDist=function(n,t,r){let u=0;for(let p=0;p<2;++p){const y=r?r[p]:0;n[p]>y&&(u+=(n[p]-y)*(n[p]-y)),t[p]<y&&(u+=(y-t[p])*(y-t[p]))}return u},i.getAnchorAlignment=b0,i.getAnchorJustification=E0,i.getBounds=function(n){let t=1/0,r=1/0,u=-1/0,p=-1/0;for(const y of n)t=Math.min(t,y.x),r=Math.min(r,y.y),u=Math.max(u,y.x),p=Math.max(p,y.y);return{min:new Me(t,r),max:new Me(u,p)}},i.getColumn=Pi,i.getGridMatrix=function(n,t,r,u){const p=t.getNorth(),y=t.getSouth(),w=t.getWest(),M=t.getEast(),D=1<<n.z,R=M-w,$=p-y,W=R/um,J=-$/hm[r],oe=[0,W,0,J,0,0,p,w,0];if(n.z>0){const ue=180/u;ld(oe,oe,[ue/R+1,0,0,0,ue/$+1,0,-.5*ue/W,.5*ue/J,1])}return oe[2]=D,oe[5]=n.x,oe[8]=n.y,oe},i.getImage=Dn,i.getJSON=function(n,t){return ro(di(n,{type:"json"}),t)},i.getLatitudinalLod=function(n){const t=80.051129;n=Wt(n,-80.051129,t)/t*90;const r=Math.pow(Math.abs(Math.sin(gt(n))),3);return Math.round(r*(hm.length-1))},i.getMapSessionAPI=ae,i.getPerformanceMeasurement=it,i.getProjection=tw,i.getRTLTextPluginStatus=yt,i.getReferrer=jn,i.getTilePoint=function(n,{x:t,y:r},u=0){return new Me(((t-u)*n.scale-n.x)*In,(r*n.scale-n.y)*In)},i.getTileVec3=function(n,t,r=0){return Yd(((t.x-r)*n.scale-n.x)*In,(t.y*n.scale-n.y)*In,jp(t.z,t.y))},i.getVideo=function(n,t){const r=F.document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let u=0;u<n.length;u++){const p=F.document.createElement("source");zr(n[u])||(r.crossOrigin="Anonymous"),p.src=n[u],r.appendChild(p)}return{cancel:()=>{}}},i.globeCenterToScreenPoint=function(n){const t=[0,0,0],r=Vl(new Float64Array(16));return cd(r,n.pixelMatrix,n.globeMatrix),Uo(t,t,r),new Me(t[0],t[1])},i.globeDenormalizeECEF=M0,i.globeECEFOrigin=function(n,t){const r=[0,0,0];return Uo(r,r,Lg(Sh(t.canonical))),Uo(r,r,n),r},i.globeNormalizeECEF=Lg,i.globePixelsToTileUnits=function(n,t){return In/(512*Math.pow(2,n))*wy(Sh(t))},i.globePoleMatrixForTile=function(n,t,r){const u=Vl(new Float64Array(16)),p=(t/(1<<n)-.5)*Math.PI*2;return Zp(u,r.globeMatrix,p),Float32Array.from(u)},i.globeTileBounds=Sh,i.globeTiltAtLngLat=Xb,i.globeToMercatorTransition=fm,i.globeUseCustomAntiAliasing=function(n,t,r){const u=fm(r.zoom),p=n.style.map._antialias,y=!!t.extStandardDerivatives,w=t.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return u===0&&!p&&!w&&y},i.identity=Vl,i.identity$1=gg,i.invert=hg,i.isFullscreen=function(){return!!F.document.fullscreenElement||!!F.document.webkitFullscreenElement},i.isLngLatBehindGlobe=k0,i.isMapAuthenticated=function(n){return he.has(n)},i.isMapboxURL=is,i.isSafariWithAntialiasingBug=function(n){const t=n.navigator?n.navigator.userAgent:null;return!!Ki(n)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.latFromMercatorY=Ls,i.latLngToECEF=zg,i.len=J_,i.length=Kd,i.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},i.lngFromMercatorX=_l,i.loadVectorTile=Tw,i.makeRequest=ro,i.mapValue=function(n,t,r,u,p){return Wt((n-t)/(r-t)*(p-u)+u,u,p)},i.mercatorScale=Gp,i.mercatorXfromLng=fc,i.mercatorYfromLat=Qc,i.mercatorZfromAltitude=Fl,i.mul=o0,i.mul$1=Y_,i.multiply=cd,i.multiply$1=ld,i.multiply$2=pg,i.nextPowerOfTwo=Li,i.normalize=hs,i.normalize$1=Th,i.normalize$2=Xp,i.number=Qn,i.ortho=function(n,t,r,u,p,y,w){var M=1/(t-r),D=1/(u-p),R=1/(y-w);return n[0]=-2*M,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*D,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*R,n[11]=0,n[12]=(t+r)*M,n[13]=(p+u)*D,n[14]=(w+y)*R,n[15]=1,n},i.pbf=ka,i.perspective=function(n,t,r,u,p){var y,w=1/Math.tan(t/2);return n[0]=w/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,p!=null&&p!==1/0?(n[10]=(p+u)*(y=1/(u-p)),n[14]=2*p*u*y):(n[10]=-1,n[14]=-2*u),n},i.pick=function(n,t){const r={};for(let u=0;u<t.length;u++){const p=t[u];p in n&&(r[p]=n[p])}return r},i.plugin=Dt,i.pointGeometry=Me,i.polesInViewport=function(n){const t=Vl(new Float64Array(16));cd(t,n.pixelMatrix,n.globeMatrix);const r=[0,ou,0],u=[0,su,0];return Uo(r,r,t),Uo(u,u,t),[r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!k0(n,new wr(n.center.lat,90)),u[0]>0&&u[0]<=n.width&&u[1]>0&&u[1]<=n.height&&!k0(n,new wr(n.center.lat,-90))]},i.polygonContainsPoint=ad,i.polygonIntersectsBox=Xd,i.polygonIntersectsPolygon=q_,i.polygonizeBounds=function(n,t,r=0,u=!0){const p=new Me(r,r),y=n.sub(p),w=t.add(p),M=[y,new Me(w.x,y.y),w,new Me(y.x,w.y)];return u&&M.push(y.clone()),M},i.posAttributes=Pg,i.postMapLoadEvent=Je,i.postPerformanceEvent=X,i.postTurnstileEvent=ve,i.potpack=am,i.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},i.radToDeg=vt,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.registerForPluginStateChange=function(n){return n({pluginStatus:Ne,pluginURL:Fe}),lt.on("pluginStateChange",n),n},i.removeAuthState=function(n){he.delete(n)},i.renderColorRamp=xg,i.resample=$_,i.rotateX=dg,i.rotateX$1=tu,i.rotateY=Zp,i.rotateY$1=_g,i.rotateZ=function(n,t,r){var u=Math.sin(r),p=Math.cos(r),y=t[0],w=t[1],M=t[2],D=t[3],R=t[4],$=t[5],W=t[6],J=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=y*p+R*u,n[1]=w*p+$*u,n[2]=M*p+W*u,n[3]=D*p+J*u,n[4]=R*p-y*u,n[5]=$*p-w*u,n[6]=W*p-M*u,n[7]=J*p-D*u,n},i.rotateZ$1=function(n,t,r){r*=.5;var u=t[0],p=t[1],y=t[2],w=t[3],M=Math.sin(r),D=Math.cos(r);return n[0]=u*D+p*M,n[1]=p*D-u*M,n[2]=y*D+w*M,n[3]=w*D-y*M,n},i.scale=ud,i.scale$1=Wp,i.scale$2=pa,i.scaleAndAdd=Hu,i.set=function(n,t,r,u){return n[0]=t,n[1]=r,n[2]=u,n},i.setCacheLimits=function(n,t){hn=n,Tn=t},i.setColumn=function(n,t,r){n[4*t+0]=r[0],n[4*t+1]=r[1],n[4*t+2]=r[2],n[4*t+3]=r[3]},i.setRTLTextPlugin=function(n,t,r=!1){if(Ne===Le||Ne===Re||Ne===Pe)throw new Error("setRTLTextPlugin cannot be called multiple times.");Fe=ri.resolveURL(n),Ne=Le,ze=t,ut(),r||$t()},i.smoothstep=zt,i.spec=Mt,i.squaredLength=function(n){var t=n[0],r=n[1],u=n[2];return t*t+r*r+u*u},i.storeAuthState=function(n,t){t?he.add(n):he.delete(n)},i.sub=pc,i.subtract=fg,i.symbolSize=Wa,i.tileAABB=function(n,t,r,u,p,y,w,M,D){if(D.name==="globe")return sA(n,t,new li(r,u,p));const R=np({z:r,x:u,y:p},D);return new Xs([(y+R.x/R.scale)*t,t*(R.y/R.scale),w],[(y+R.x2/R.scale)*t,t*(R.y2/R.scale),M])},i.tileCornersToBounds=by,i.tileTransform=np,i.transformMat3=function(n,t,r){var u=t[0],p=t[1],y=t[2];return n[0]=u*r[0]+p*r[3]+y*r[6],n[1]=u*r[1]+p*r[4]+y*r[7],n[2]=u*r[2]+p*r[5]+y*r[8],n},i.transformMat4=Uo,i.transformMat4$1=fd,i.transformQuat=mg,i.transitionTileAABBinECEF=Gb,i.translate=Gf,i.transpose=function(n,t){if(n===t){var r=t[1],u=t[2],p=t[5];n[1]=t[3],n[2]=t[6],n[3]=r,n[5]=t[7],n[6]=u,n[7]=p}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},i.triggerPluginCompletionEvent=et,i.uniqueId=mn,i.updateGlobeVertexNormal=function(n,t,r,u,p){const y=5*t+2;n.float32[y+0]=r,n.float32[y+1]=u,n.float32[y+2]=p},i.validateCustomStyleLayer=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},i.validateFilter=n=>We(to(n)),i.validateFog=n=>We(Q(n)),i.validateLayer=n=>We(a(n)),i.validateLight=n=>We(N(n)),i.validateSource=n=>We(A(n)),i.validateStyle=Ee,i.validateTerrain=n=>We(H(n)),i.values=cn,i.vectorTile=tp,i.version=j,i.warnOnce=at,i.window=F,i.wrap=Yt}),E(["./shared"],function(i){function F(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let ve="[";for(const Oe of Ve)ve+=`${F(Oe)},`;return`${ve}]`}let fe="{";for(const ve of Object.keys(Ve).sort())fe+=`${ve}:${F(Ve[ve])},`;return`${fe}}`}function j(Ve){let fe="";for(const ve of i.refProperties)fe+=`/${F(Ve[ve])}`;return fe}class K{constructor(fe){this.keyCache={},fe&&this.replace(fe)}replace(fe){this._layerConfigs={},this._layers={},this.update(fe,[])}update(fe,ve){for(const Je of fe)this._layerConfigs[Je.id]=Je,(this._layers[Je.id]=i.createStyleLayer(Je)).compileFilter(),this.keyCache[Je.id]&&delete this.keyCache[Je.id];for(const Je of ve)delete this.keyCache[Je],delete this._layerConfigs[Je],delete this._layers[Je];this.familiesBySource={};const Oe=function(Je,le){const X={};for(let ae=0;ae<Je.length;ae++){const he=le&&le[Je[ae].id]||j(Je[ae]);le&&(le[Je[ae].id]=he);let Se=X[he];Se||(Se=X[he]=[]),Se.push(Je[ae])}const ee=[];for(const ae in X)ee.push(X[ae]);return ee}(i.values(this._layerConfigs),this.keyCache);for(const Je of Oe){const le=Je.map(qe=>this._layers[qe.id]),X=le[0];if(X.visibility==="none")continue;const ee=X.source||"";let ae=this.familiesBySource[ee];ae||(ae=this.familiesBySource[ee]={});const he=X.sourceLayer||"_geojsonTileLayer";let Se=ae[he];Se||(Se=ae[he]=[]),Se.push(le)}}}class Y{loadTile(fe,ve){const{uid:Oe,encoding:Je,rawImageData:le,padding:X,buildQuadTree:ee}=fe,ae=i.window.ImageBitmap&&le instanceof i.window.ImageBitmap?this.getImageData(le,X):le;ve(null,new i.DEMData(Oe,ae,Je,X<1,ee))}getImageData(fe,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(fe.width,fe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=fe.width,this.offscreenCanvas.height=fe.height,this.offscreenCanvasContext.drawImage(fe,0,0,fe.width,fe.height);const Oe=this.offscreenCanvasContext.getImageData(-ve,-ve,fe.width+2*ve,fe.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Oe}}var q=function Ve(fe,ve){var Oe,Je=fe&&fe.type;if(Je==="FeatureCollection")for(Oe=0;Oe<fe.features.length;Oe++)Ve(fe.features[Oe],ve);else if(Je==="GeometryCollection")for(Oe=0;Oe<fe.geometries.length;Oe++)Ve(fe.geometries[Oe],ve);else if(Je==="Feature")Ve(fe.geometry,ve);else if(Je==="Polygon")re(fe.coordinates,ve);else if(Je==="MultiPolygon")for(Oe=0;Oe<fe.coordinates.length;Oe++)re(fe.coordinates[Oe],ve);return fe};function re(Ve,fe){if(Ve.length!==0){me(Ve[0],fe);for(var ve=1;ve<Ve.length;ve++)me(Ve[ve],!fe)}}function me(Ve,fe){for(var ve=0,Oe=0,Je=0,le=Ve.length,X=le-1;Je<le;X=Je++){var ee=(Ve[Je][0]-Ve[X][0])*(Ve[X][1]+Ve[Je][1]),ae=ve+ee;Oe+=Math.abs(ve)>=Math.abs(ee)?ve-ae+ee:ee-ae+ve,ve=ae}ve+Oe>=0!=!!fe&&Ve.reverse()}const we=i.VectorTileFeature.prototype.toGeoJSON;class je{constructor(fe){this._feature=fe,this.extent=i.EXTENT,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const ve of this._feature.geometry)fe.push([new i.pointGeometry(ve[0],ve[1])]);return fe}{const fe=[];for(const ve of this._feature.geometry){const Oe=[];for(const Je of ve)Oe.push(new i.pointGeometry(Je[0],Je[1]));fe.push(Oe)}return fe}}toGeoJSON(fe,ve,Oe){return we.call(this,fe,ve,Oe)}}class $e{constructor(fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=fe.length,this._features=fe}feature(fe){return new je(this._features[fe])}}var tt={exports:{}},Ae=i.pointGeometry,mt=i.vectorTile.VectorTileFeature,Me=Ye;function Ye(Ve,fe){this.options=fe||{},this.features=Ve,this.length=Ve.length}function Ze(Ve,fe){this.id=typeof Ve.id=="number"?Ve.id:void 0,this.type=Ve.type,this.rawGeometry=Ve.type===1?[Ve.geometry]:Ve.geometry,this.properties=Ve.tags,this.extent=fe||4096}Ye.prototype.feature=function(Ve){return new Ze(this.features[Ve],this.options.extent)},Ze.prototype.loadGeometry=function(){var Ve=this.rawGeometry;this.geometry=[];for(var fe=0;fe<Ve.length;fe++){for(var ve=Ve[fe],Oe=[],Je=0;Je<ve.length;Je++)Oe.push(new Ae(ve[Je][0],ve[Je][1]));this.geometry.push(Oe)}return this.geometry},Ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ve=this.geometry,fe=1/0,ve=-1/0,Oe=1/0,Je=-1/0,le=0;le<Ve.length;le++)for(var X=Ve[le],ee=0;ee<X.length;ee++){var ae=X[ee];fe=Math.min(fe,ae.x),ve=Math.max(ve,ae.x),Oe=Math.min(Oe,ae.y),Je=Math.max(Je,ae.y)}return[fe,Oe,ve,Je]},Ze.prototype.toGeoJSON=mt.prototype.toGeoJSON;var rt=i.pbf,gt=Me;function vt(Ve){var fe=new rt;return function(ve,Oe){for(var Je in ve.layers)Oe.writeMessage(3,Ut,ve.layers[Je])}(Ve,fe),fe.finish()}function Ut(Ve,fe){var ve;fe.writeVarintField(15,Ve.version||1),fe.writeStringField(1,Ve.name||""),fe.writeVarintField(5,Ve.extent||4096);var Oe={keys:[],values:[],keycache:{},valuecache:{}};for(ve=0;ve<Ve.length;ve++)Oe.feature=Ve.feature(ve),fe.writeMessage(2,At,Oe);var Je=Oe.keys;for(ve=0;ve<Je.length;ve++)fe.writeStringField(3,Je[ve]);var le=Oe.values;for(ve=0;ve<le.length;ve++)fe.writeMessage(4,Yt,le[ve])}function At(Ve,fe){var ve=Ve.feature;ve.id!==void 0&&fe.writeVarintField(1,ve.id),fe.writeMessage(2,ti,Ve),fe.writeVarintField(3,ve.type),fe.writeMessage(4,zt,ve)}function ti(Ve,fe){var ve=Ve.feature,Oe=Ve.keys,Je=Ve.values,le=Ve.keycache,X=Ve.valuecache;for(var ee in ve.properties){var ae=ve.properties[ee],he=le[ee];if(ae!==null){he===void 0&&(Oe.push(ee),le[ee]=he=Oe.length-1),fe.writeVarint(he);var Se=typeof ae;Se!=="string"&&Se!=="boolean"&&Se!=="number"&&(ae=JSON.stringify(ae));var qe=Se+":"+ae,De=X[qe];De===void 0&&(Je.push(ae),X[qe]=De=Je.length-1),fe.writeVarint(De)}}}function Nt(Ve,fe){return(fe<<3)+(7&Ve)}function Wt(Ve){return Ve<<1^Ve>>31}function zt(Ve,fe){for(var ve=Ve.loadGeometry(),Oe=Ve.type,Je=0,le=0,X=ve.length,ee=0;ee<X;ee++){var ae=ve[ee],he=1;Oe===1&&(he=ae.length),fe.writeVarint(Nt(1,he));for(var Se=Oe===3?ae.length-1:ae.length,qe=0;qe<Se;qe++){qe===1&&Oe!==1&&fe.writeVarint(Nt(2,Se-1));var De=ae[qe].x-Je,Ue=ae[qe].y-le;fe.writeVarint(Wt(De)),fe.writeVarint(Wt(Ue)),Je+=De,le+=Ue}Oe===3&&fe.writeVarint(Nt(7,1))}}function Yt(Ve,fe){var ve=typeof Ve;ve==="string"?fe.writeStringField(1,Ve):ve==="boolean"?fe.writeBooleanField(7,Ve):ve==="number"&&(Ve%1!=0?fe.writeDoubleField(3,Ve):Ve<0?fe.writeSVarintField(6,Ve):fe.writeVarintField(5,Ve))}function vi(Ve,fe,ve,Oe,Je,le){if(Je-Oe<=ve)return;const X=Oe+Je>>1;cn(Ve,fe,X,Oe,Je,le%2),vi(Ve,fe,ve,Oe,X-1,le+1),vi(Ve,fe,ve,X+1,Je,le+1)}function cn(Ve,fe,ve,Oe,Je,le){for(;Je>Oe;){if(Je-Oe>600){const he=Je-Oe+1,Se=ve-Oe+1,qe=Math.log(he),De=.5*Math.exp(2*qe/3),Ue=.5*Math.sqrt(qe*De*(he-De)/he)*(Se-he/2<0?-1:1);cn(Ve,fe,ve,Math.max(Oe,Math.floor(ve-Se*De/he+Ue)),Math.min(Je,Math.floor(ve+(he-Se)*De/he+Ue)),le)}const X=fe[2*ve+le];let ee=Oe,ae=Je;for(di(Ve,fe,Oe,ve),fe[2*Je+le]>X&&di(Ve,fe,Oe,Je);ee<ae;){for(di(Ve,fe,ee,ae),ee++,ae--;fe[2*ee+le]<X;)ee++;for(;fe[2*ae+le]>X;)ae--}fe[2*Oe+le]===X?di(Ve,fe,Oe,ae):(ae++,di(Ve,fe,ae,Je)),ae<=ve&&(Oe=ae+1),ve<=ae&&(Je=ae-1)}}function di(Ve,fe,ve,Oe){un(Ve,ve,Oe),un(fe,2*ve,2*Oe),un(fe,2*ve+1,2*Oe+1)}function un(Ve,fe,ve){const Oe=Ve[fe];Ve[fe]=Ve[ve],Ve[ve]=Oe}function mn(Ve,fe,ve,Oe){const Je=Ve-ve,le=fe-Oe;return Je*Je+le*le}tt.exports=vt,tt.exports.fromVectorTileJs=vt,tt.exports.fromGeojsonVt=function(Ve,fe){fe=fe||{};var ve={};for(var Oe in Ve)ve[Oe]=new gt(Ve[Oe].features,fe),ve[Oe].name=Oe,ve[Oe].version=fe.version,ve[Oe].extent=fe.extent;return vt({layers:ve})},tt.exports.GeoJSONWrapper=gt;const Er=Ve=>Ve[0],Li=Ve=>Ve[1];class En{constructor(fe,ve=Er,Oe=Li,Je=64,le=Float64Array){this.nodeSize=Je,this.points=fe;const X=fe.length<65536?Uint16Array:Uint32Array,ee=this.ids=new X(fe.length),ae=this.coords=new le(2*fe.length);for(let he=0;he<fe.length;he++)ee[he]=he,ae[2*he]=ve(fe[he]),ae[2*he+1]=Oe(fe[he]);vi(ee,ae,Je,0,ee.length-1,0)}range(fe,ve,Oe,Je){return function(le,X,ee,ae,he,Se,qe){const De=[0,le.length-1,0],Ue=[];let it,xt;for(;De.length;){const Bt=De.pop(),It=De.pop(),Ci=De.pop();if(It-Ci<=qe){for(let Gi=Ci;Gi<=It;Gi++)it=X[2*Gi],xt=X[2*Gi+1],it>=ee&&it<=he&&xt>=ae&&xt<=Se&&Ue.push(le[Gi]);continue}const ri=Math.floor((Ci+It)/2);it=X[2*ri],xt=X[2*ri+1],it>=ee&&it<=he&&xt>=ae&&xt<=Se&&Ue.push(le[ri]);const xi=(Bt+1)%2;(Bt===0?ee<=it:ae<=xt)&&(De.push(Ci),De.push(ri-1),De.push(xi)),(Bt===0?he>=it:Se>=xt)&&(De.push(ri+1),De.push(It),De.push(xi))}return Ue}(this.ids,this.coords,fe,ve,Oe,Je,this.nodeSize)}within(fe,ve,Oe){return function(Je,le,X,ee,ae,he){const Se=[0,Je.length-1,0],qe=[],De=ae*ae;for(;Se.length;){const Ue=Se.pop(),it=Se.pop(),xt=Se.pop();if(it-xt<=he){for(let xi=xt;xi<=it;xi++)mn(le[2*xi],le[2*xi+1],X,ee)<=De&&qe.push(Je[xi]);continue}const Bt=Math.floor((xt+it)/2),It=le[2*Bt],Ci=le[2*Bt+1];mn(It,Ci,X,ee)<=De&&qe.push(Je[Bt]);const ri=(Ue+1)%2;(Ue===0?X-ae<=It:ee-ae<=Ci)&&(Se.push(xt),Se.push(Bt-1),Se.push(ri)),(Ue===0?X+ae>=It:ee+ae>=Ci)&&(Se.push(Bt+1),Se.push(it),Se.push(ri))}return qe}(this.ids,this.coords,fe,ve,Oe,this.nodeSize)}}const wn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},vr=Math.fround||(Fo=new Float32Array(1),Ve=>(Fo[0]=+Ve,Fo[0]));var Fo;class Xr{constructor(fe){this.options=Mi(Object.create(wn),fe),this.trees=new Array(this.options.maxZoom+1)}load(fe){const{log:ve,minZoom:Oe,maxZoom:Je,nodeSize:le}=this.options;ve&&console.time("total time");const X=`prepare ${fe.length} points`;ve&&console.time(X),this.points=fe;let ee=[];for(let ae=0;ae<fe.length;ae++)fe[ae].geometry&&ee.push(ks(fe[ae],ae));this.trees[Je+1]=new En(ee,Ki,ci,le,Float32Array),ve&&console.timeEnd(X);for(let ae=Je;ae>=Oe;ae--){const he=+Date.now();ee=this._cluster(ee,ae),this.trees[ae]=new En(ee,Ki,ci,le,Float32Array),ve&&console.log("z%d: %d clusters in %dms",ae,ee.length,+Date.now()-he)}return ve&&console.timeEnd("total time"),this}getClusters(fe,ve){let Oe=((fe[0]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,fe[1]));let le=fe[2]===180?180:((fe[2]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,fe[3]));if(fe[2]-fe[0]>=360)Oe=-180,le=180;else if(Oe>le){const Se=this.getClusters([Oe,Je,180,X],ve),qe=this.getClusters([-180,Je,le,X],ve);return Se.concat(qe)}const ee=this.trees[this._limitZoom(ve)],ae=ee.range(Ft(Oe),fi(X),Ft(le),fi(Je)),he=[];for(const Se of ae){const qe=ee.points[Se];he.push(qe.numPoints?at(qe):this.points[qe.index])}return he}getChildren(fe){const ve=this._getOriginId(fe),Oe=this._getOriginZoom(fe),Je="No cluster with the specified id.",le=this.trees[Oe];if(!le)throw new Error(Je);const X=le.points[ve];if(!X)throw new Error(Je);const ee=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),ae=le.within(X.x,X.y,ee),he=[];for(const Se of ae){const qe=le.points[Se];qe.parentId===fe&&he.push(qe.numPoints?at(qe):this.points[qe.index])}if(he.length===0)throw new Error(Je);return he}getLeaves(fe,ve,Oe){const Je=[];return this._appendLeaves(Je,fe,ve=ve||10,Oe=Oe||0,0),Je}getTile(fe,ve,Oe){const Je=this.trees[this._limitZoom(fe)],le=Math.pow(2,fe),{extent:X,radius:ee}=this.options,ae=ee/X,he=(Oe-ae)/le,Se=(Oe+1+ae)/le,qe={features:[]};return this._addTileFeatures(Je.range((ve-ae)/le,he,(ve+1+ae)/le,Se),Je.points,ve,Oe,le,qe),ve===0&&this._addTileFeatures(Je.range(1-ae/le,he,1,Se),Je.points,le,Oe,le,qe),ve===le-1&&this._addTileFeatures(Je.range(0,he,ae/le,Se),Je.points,-1,Oe,le,qe),qe.features.length?qe:null}getClusterExpansionZoom(fe){let ve=this._getOriginZoom(fe)-1;for(;ve<=this.options.maxZoom;){const Oe=this.getChildren(fe);if(ve++,Oe.length!==1)break;fe=Oe[0].properties.cluster_id}return ve}_appendLeaves(fe,ve,Oe,Je,le){const X=this.getChildren(ve);for(const ee of X){const ae=ee.properties;if(ae&&ae.cluster?le+ae.point_count<=Je?le+=ae.point_count:le=this._appendLeaves(fe,ae.cluster_id,Oe,Je,le):le<Je?le++:fe.push(ee),fe.length===Oe)break}return le}_addTileFeatures(fe,ve,Oe,Je,le,X){for(const ee of fe){const ae=ve[ee],he=ae.numPoints;let Se,qe,De;if(he)Se=bt(ae),qe=ae.x,De=ae.y;else{const xt=this.points[ae.index];Se=xt.properties,qe=Ft(xt.geometry.coordinates[0]),De=fi(xt.geometry.coordinates[1])}const Ue={type:1,geometry:[[Math.round(this.options.extent*(qe*le-Oe)),Math.round(this.options.extent*(De*le-Je))]],tags:Se};let it;he?it=ae.id:this.options.generateId?it=ae.index:this.points[ae.index].id&&(it=this.points[ae.index].id),it!==void 0&&(Ue.id=it),X.features.push(Ue)}}_limitZoom(fe){return Math.max(this.options.minZoom,Math.min(Math.floor(+fe),this.options.maxZoom+1))}_cluster(fe,ve){const Oe=[],{radius:Je,extent:le,reduce:X,minPoints:ee}=this.options,ae=Je/(le*Math.pow(2,ve));for(let he=0;he<fe.length;he++){const Se=fe[he];if(Se.zoom<=ve)continue;Se.zoom=ve;const qe=this.trees[ve+1],De=qe.within(Se.x,Se.y,ae),Ue=Se.numPoints||1;let it=Ue;for(const xt of De){const Bt=qe.points[xt];Bt.zoom>ve&&(it+=Bt.numPoints||1)}if(it>Ue&&it>=ee){let xt=Se.x*Ue,Bt=Se.y*Ue,It=X&&Ue>1?this._map(Se,!0):null;const Ci=(he<<5)+(ve+1)+this.points.length;for(const ri of De){const xi=qe.points[ri];if(xi.zoom<=ve)continue;xi.zoom=ve;const Gi=xi.numPoints||1;xt+=xi.x*Gi,Bt+=xi.y*Gi,xi.parentId=Ci,X&&(It||(It=this._map(Se,!0)),X(It,this._map(xi)))}Se.parentId=Ci,Oe.push(uo(xt/it,Bt/it,Ci,it,It))}else if(Oe.push(Se),it>1)for(const xt of De){const Bt=qe.points[xt];Bt.zoom<=ve||(Bt.zoom=ve,Oe.push(Bt))}}return Oe}_getOriginId(fe){return fe-this.points.length>>5}_getOriginZoom(fe){return(fe-this.points.length)%32}_map(fe,ve){if(fe.numPoints)return ve?Mi({},fe.properties):fe.properties;const Oe=this.points[fe.index].properties,Je=this.options.map(Oe);return ve&&Je===Oe?Mi({},Je):Je}}function uo(Ve,fe,ve,Oe,Je){return{x:vr(Ve),y:vr(fe),zoom:1/0,id:ve,parentId:-1,numPoints:Oe,properties:Je}}function ks(Ve,fe){const[ve,Oe]=Ve.geometry.coordinates;return{x:vr(Ft(ve)),y:vr(fi(Oe)),zoom:1/0,index:fe,parentId:-1}}function at(Ve){return{type:"Feature",id:Ve.id,properties:bt(Ve),geometry:{type:"Point",coordinates:[(fe=Ve.x,360*(fe-.5)),gi(Ve.y)]}};var fe}function bt(Ve){const fe=Ve.numPoints,ve=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe;return Mi(Mi({},Ve.properties),{cluster:!0,cluster_id:Ve.id,point_count:fe,point_count_abbreviated:ve})}function Ft(Ve){return Ve/360+.5}function fi(Ve){const fe=Math.sin(Ve*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function gi(Ve){const fe=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(fe))/Math.PI-90}function Mi(Ve,fe){for(const ve in fe)Ve[ve]=fe[ve];return Ve}function Ki(Ve){return Ve.x}function ci(Ve){return Ve.y}function Pi(Ve,fe,ve,Oe){for(var Je,le=Oe,X=ve-fe>>1,ee=ve-fe,ae=Ve[fe],he=Ve[fe+1],Se=Ve[ve],qe=Ve[ve+1],De=fe+3;De<ve;De+=3){var Ue=Si(Ve[De],Ve[De+1],ae,he,Se,qe);if(Ue>le)Je=De,le=Ue;else if(Ue===le){var it=Math.abs(De-X);it<ee&&(Je=De,ee=it)}}le>Oe&&(Je-fe>3&&Pi(Ve,fe,Je,Oe),Ve[Je+2]=le,ve-Je>3&&Pi(Ve,Je,ve,Oe))}function Si(Ve,fe,ve,Oe,Je,le){var X=Je-ve,ee=le-Oe;if(X!==0||ee!==0){var ae=((Ve-ve)*X+(fe-Oe)*ee)/(X*X+ee*ee);ae>1?(ve=Je,Oe=le):ae>0&&(ve+=X*ae,Oe+=ee*ae)}return(X=Ve-ve)*X+(ee=fe-Oe)*ee}function tn(Ve,fe,ve,Oe){var Je={id:Ve===void 0?null:Ve,type:fe,geometry:ve,tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var X=le.geometry,ee=le.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")on(le,X);else if(ee==="Polygon"||ee==="MultiLineString")for(var ae=0;ae<X.length;ae++)on(le,X[ae]);else if(ee==="MultiPolygon")for(ae=0;ae<X.length;ae++)for(var he=0;he<X[ae].length;he++)on(le,X[ae][he])}(Je),Je}function on(Ve,fe){for(var ve=0;ve<fe.length;ve+=3)Ve.minX=Math.min(Ve.minX,fe[ve]),Ve.minY=Math.min(Ve.minY,fe[ve+1]),Ve.maxX=Math.max(Ve.maxX,fe[ve]),Ve.maxY=Math.max(Ve.maxY,fe[ve+1])}function hn(Ve,fe,ve,Oe){if(fe.geometry){var Je=fe.geometry.coordinates,le=fe.geometry.type,X=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2),ee=[],ae=fe.id;if(ve.promoteId?ae=fe.properties[ve.promoteId]:ve.generateId&&(ae=Oe||0),le==="Point")Tn(Je,ee);else if(le==="MultiPoint")for(var he=0;he<Je.length;he++)Tn(Je[he],ee);else if(le==="LineString")On(Je,ee,X,!1);else if(le==="MultiLineString"){if(ve.lineMetrics){for(he=0;he<Je.length;he++)On(Je[he],ee=[],X,!1),Ve.push(tn(ae,"LineString",ee,fe.properties));return}qn(Je,ee,X,!1)}else if(le==="Polygon")qn(Je,ee,X,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(he=0;he<fe.geometry.geometries.length;he++)hn(Ve,{id:ae,geometry:fe.geometry.geometries[he],properties:fe.properties},ve,Oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(he=0;he<Je.length;he++){var Se=[];qn(Je[he],Se,X,!0),ee.push(Se)}}Ve.push(tn(ae,le,ee,fe.properties))}}function Tn(Ve,fe){fe.push(Ot(Ve[0])),fe.push(yi(Ve[1])),fe.push(0)}function On(Ve,fe,ve,Oe){for(var Je,le,X=0,ee=0;ee<Ve.length;ee++){var ae=Ot(Ve[ee][0]),he=yi(Ve[ee][1]);fe.push(ae),fe.push(he),fe.push(0),ee>0&&(X+=Oe?(Je*he-ae*le)/2:Math.sqrt(Math.pow(ae-Je,2)+Math.pow(he-le,2))),Je=ae,le=he}var Se=fe.length-3;fe[2]=1,Pi(fe,0,Se,ve),fe[Se+2]=1,fe.size=Math.abs(X),fe.start=0,fe.end=fe.size}function qn(Ve,fe,ve,Oe){for(var Je=0;Je<Ve.length;Je++){var le=[];On(Ve[Je],le,ve,Oe),fe.push(le)}}function Ot(Ve){return Ve/360+.5}function yi(Ve){var fe=Math.sin(Ve*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function Pr(Ve,fe,ve,Oe,Je,le,X,ee){if(Oe/=fe,le>=(ve/=fe)&&X<Oe)return Ve;if(X<ve||le>=Oe)return null;for(var ae=[],he=0;he<Ve.length;he++){var Se=Ve[he],qe=Se.geometry,De=Se.type,Ue=Je===0?Se.minX:Se.minY,it=Je===0?Se.maxX:Se.maxY;if(Ue>=ve&&it<Oe)ae.push(Se);else if(!(it<ve||Ue>=Oe)){var xt=[];if(De==="Point"||De==="MultiPoint")Eo(qe,xt,ve,Oe,Je);else if(De==="LineString")jn(qe,xt,ve,Oe,Je,!1,ee.lineMetrics);else if(De==="MultiLineString")_o(qe,xt,ve,Oe,Je,!1);else if(De==="Polygon")_o(qe,xt,ve,Oe,Je,!0);else if(De==="MultiPolygon")for(var Bt=0;Bt<qe.length;Bt++){var It=[];_o(qe[Bt],It,ve,Oe,Je,!0),It.length&&xt.push(It)}if(xt.length){if(ee.lineMetrics&&De==="LineString"){for(Bt=0;Bt<xt.length;Bt++)ae.push(tn(Se.id,De,xt[Bt],Se.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(xt.length===1?(De="LineString",xt=xt[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=xt.length===3?"Point":"MultiPoint"),ae.push(tn(Se.id,De,xt,Se.tags))}}}return ae.length?ae:null}function Eo(Ve,fe,ve,Oe,Je){for(var le=0;le<Ve.length;le+=3){var X=Ve[le+Je];X>=ve&&X<=Oe&&(fe.push(Ve[le]),fe.push(Ve[le+1]),fe.push(Ve[le+2]))}}function jn(Ve,fe,ve,Oe,Je,le,X){for(var ee,ae,he=ro(Ve),Se=Je===0?So:zi,qe=Ve.start,De=0;De<Ve.length-3;De+=3){var Ue=Ve[De],it=Ve[De+1],xt=Ve[De+2],Bt=Ve[De+3],It=Ve[De+4],Ci=Je===0?Ue:it,ri=Je===0?Bt:It,xi=!1;X&&(ee=Math.sqrt(Math.pow(Ue-Bt,2)+Math.pow(it-It,2))),Ci<ve?ri>ve&&(ae=Se(he,Ue,it,Bt,It,ve),X&&(he.start=qe+ee*ae)):Ci>Oe?ri<Oe&&(ae=Se(he,Ue,it,Bt,It,Oe),X&&(he.start=qe+ee*ae)):zr(he,Ue,it,xt),ri<ve&&Ci>=ve&&(ae=Se(he,Ue,it,Bt,It,ve),xi=!0),ri>Oe&&Ci<=Oe&&(ae=Se(he,Ue,it,Bt,It,Oe),xi=!0),!le&&xi&&(X&&(he.end=qe+ee*ae),fe.push(he),he=ro(Ve)),X&&(qe+=ee)}var Gi=Ve.length-3;Ue=Ve[Gi],it=Ve[Gi+1],xt=Ve[Gi+2],(Ci=Je===0?Ue:it)>=ve&&Ci<=Oe&&zr(he,Ue,it,xt),Gi=he.length-3,le&&Gi>=3&&(he[Gi]!==he[0]||he[Gi+1]!==he[1])&&zr(he,he[0],he[1],he[2]),he.length&&fe.push(he)}function ro(Ve){var fe=[];return fe.size=Ve.size,fe.start=Ve.start,fe.end=Ve.end,fe}function _o(Ve,fe,ve,Oe,Je,le){for(var X=0;X<Ve.length;X++)jn(Ve[X],fe,ve,Oe,Je,le,!1)}function zr(Ve,fe,ve,Oe){Ve.push(fe),Ve.push(ve),Ve.push(Oe)}function So(Ve,fe,ve,Oe,Je,le){var X=(le-fe)/(Oe-fe);return Ve.push(le),Ve.push(ve+(Je-ve)*X),Ve.push(1),X}function zi(Ve,fe,ve,Oe,Je,le){var X=(le-ve)/(Je-ve);return Ve.push(fe+(Oe-fe)*X),Ve.push(le),Ve.push(1),X}function Ln(Ve,fe){for(var ve=[],Oe=0;Oe<Ve.length;Oe++){var Je,le=Ve[Oe],X=le.type;if(X==="Point"||X==="MultiPoint"||X==="LineString")Je=Dn(le.geometry,fe);else if(X==="MultiLineString"||X==="Polygon"){Je=[];for(var ee=0;ee<le.geometry.length;ee++)Je.push(Dn(le.geometry[ee],fe))}else if(X==="MultiPolygon")for(Je=[],ee=0;ee<le.geometry.length;ee++){for(var ae=[],he=0;he<le.geometry[ee].length;he++)ae.push(Dn(le.geometry[ee][he],fe));Je.push(ae)}ve.push(tn(le.id,X,Je,le.tags))}return ve}function Dn(Ve,fe){var ve=[];ve.size=Ve.size,Ve.start!==void 0&&(ve.start=Ve.start,ve.end=Ve.end);for(var Oe=0;Oe<Ve.length;Oe+=3)ve.push(Ve[Oe]+fe,Ve[Oe+1],Ve[Oe+2]);return ve}function Co(Ve,fe){if(Ve.transformed)return Ve;var ve,Oe,Je,le=1<<Ve.z,X=Ve.x,ee=Ve.y;for(ve=0;ve<Ve.features.length;ve++){var ae=Ve.features[ve],he=ae.geometry,Se=ae.type;if(ae.geometry=[],Se===1)for(Oe=0;Oe<he.length;Oe+=2)ae.geometry.push(is(he[Oe],he[Oe+1],fe,le,X,ee));else for(Oe=0;Oe<he.length;Oe++){var qe=[];for(Je=0;Je<he[Oe].length;Je+=2)qe.push(is(he[Oe][Je],he[Oe][Je+1],fe,le,X,ee));ae.geometry.push(qe)}}return Ve.transformed=!0,Ve}function is(Ve,fe,ve,Oe,Je,le){return[Math.round(ve*(Ve*Oe-Je)),Math.round(ve*(fe*Oe-le))]}function kn(Ve,fe,ve,Oe,Je){for(var le=fe===Je.maxZoom?0:Je.tolerance/((1<<fe)*Je.extent),X={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ve,y:Oe,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ee=0;ee<Ve.length;ee++){X.numFeatures++,sa(X,Ve[ee],le,Je);var ae=Ve[ee].minX,he=Ve[ee].minY,Se=Ve[ee].maxX,qe=Ve[ee].maxY;ae<X.minX&&(X.minX=ae),he<X.minY&&(X.minY=he),Se>X.maxX&&(X.maxX=Se),qe>X.maxY&&(X.maxY=qe)}return X}function sa(Ve,fe,ve,Oe){var Je=fe.geometry,le=fe.type,X=[];if(le==="Point"||le==="MultiPoint")for(var ee=0;ee<Je.length;ee+=3)X.push(Je[ee]),X.push(Je[ee+1]),Ve.numPoints++,Ve.numSimplified++;else if(le==="LineString")yo(X,Je,Ve,ve,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(ee=0;ee<Je.length;ee++)yo(X,Je[ee],Ve,ve,le==="Polygon",ee===0);else if(le==="MultiPolygon")for(var ae=0;ae<Je.length;ae++){var he=Je[ae];for(ee=0;ee<he.length;ee++)yo(X,he[ee],Ve,ve,!0,ee===0)}if(X.length){var Se=fe.tags||null;if(le==="LineString"&&Oe.lineMetrics){for(var qe in Se={},fe.tags)Se[qe]=fe.tags[qe];Se.mapbox_clip_start=Je.start/Je.size,Se.mapbox_clip_end=Je.end/Je.size}var De={geometry:X,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Se};fe.id!==null&&(De.id=fe.id),Ve.features.push(De)}}function yo(Ve,fe,ve,Oe,Je,le){var X=Oe*Oe;if(Oe>0&&fe.size<(Je?X:Oe))ve.numPoints+=fe.length/3;else{for(var ee=[],ae=0;ae<fe.length;ae+=3)(Oe===0||fe[ae+2]>X)&&(ve.numSimplified++,ee.push(fe[ae]),ee.push(fe[ae+1])),ve.numPoints++;Je&&function(he,Se){for(var qe=0,De=0,Ue=he.length,it=Ue-2;De<Ue;it=De,De+=2)qe+=(he[De]-he[it])*(he[De+1]+he[it+1]);if(qe>0===Se)for(De=0,Ue=he.length;De<Ue/2;De+=2){var xt=he[De],Bt=he[De+1];he[De]=he[Ue-2-De],he[De+1]=he[Ue-1-De],he[Ue-2-De]=xt,he[Ue-1-De]=Bt}}(ee,le),Ve.push(ee)}}function aa(Ve,fe){var ve=(fe=this.options=function(Je,le){for(var X in le)Je[X]=le[X];return Je}(Object.create(this.options),fe)).debug;if(ve&&console.time("preprocess data"),fe.maxZoom<0||fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(fe.promoteId&&fe.generateId)throw new Error("promoteId and generateId cannot be used together.");var Oe=function(Je,le){var X=[];if(Je.type==="FeatureCollection")for(var ee=0;ee<Je.features.length;ee++)hn(X,Je.features[ee],le,ee);else hn(X,Je.type==="Feature"?Je:{geometry:Je},le);return X}(Ve,fe);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",fe.indexMaxZoom,fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(Je,le){var X=le.buffer/le.extent,ee=Je,ae=Pr(Je,1,-1-X,X,0,-1,2,le),he=Pr(Je,1,1-X,2+X,0,-1,2,le);return(ae||he)&&(ee=Pr(Je,1,-X,1+X,0,-1,2,le)||[],ae&&(ee=Ln(ae,1).concat(ee)),he&&(ee=ee.concat(Ln(he,-1)))),ee}(Oe,fe),Oe.length&&this.splitTile(Oe,0,0,0),ve&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oo(Ve,fe,ve){return 32*((1<<Ve)*ve+fe)+Ve}function so(Ve,fe){const ve=Ve.tileID.canonical;if(!this._geoJSONIndex)return fe(null,null);const Oe=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Oe)return fe(null,null);const Je=new $e(Oe.features);let le=tt.exports(Je);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),fe(null,{vectorTile:Je,rawData:le.buffer})}aa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},aa.prototype.splitTile=function(Ve,fe,ve,Oe,Je,le,X){for(var ee=[Ve,fe,ve,Oe],ae=this.options,he=ae.debug;ee.length;){Oe=ee.pop(),ve=ee.pop(),fe=ee.pop(),Ve=ee.pop();var Se=1<<fe,qe=oo(fe,ve,Oe),De=this.tiles[qe];if(!De&&(he>1&&console.time("creation"),De=this.tiles[qe]=kn(Ve,fe,ve,Oe,ae),this.tileCoords.push({z:fe,x:ve,y:Oe}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",fe,ve,Oe,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));var Ue="z"+fe;this.stats[Ue]=(this.stats[Ue]||0)+1,this.total++}if(De.source=Ve,Je){if(fe===ae.maxZoom||fe===Je)continue;var it=1<<Je-fe;if(ve!==Math.floor(le/it)||Oe!==Math.floor(X/it))continue}else if(fe===ae.indexMaxZoom||De.numPoints<=ae.indexMaxPoints)continue;if(De.source=null,Ve.length!==0){he>1&&console.time("clipping");var xt,Bt,It,Ci,ri,xi,Gi=.5*ae.buffer/ae.extent,_n=.5-Gi,Zn=.5+Gi,xn=1+Gi;xt=Bt=It=Ci=null,ri=Pr(Ve,Se,ve-Gi,ve+Zn,0,De.minX,De.maxX,ae),xi=Pr(Ve,Se,ve+_n,ve+xn,0,De.minX,De.maxX,ae),Ve=null,ri&&(xt=Pr(ri,Se,Oe-Gi,Oe+Zn,1,De.minY,De.maxY,ae),Bt=Pr(ri,Se,Oe+_n,Oe+xn,1,De.minY,De.maxY,ae),ri=null),xi&&(It=Pr(xi,Se,Oe-Gi,Oe+Zn,1,De.minY,De.maxY,ae),Ci=Pr(xi,Se,Oe+_n,Oe+xn,1,De.minY,De.maxY,ae),xi=null),he>1&&console.timeEnd("clipping"),ee.push(xt||[],fe+1,2*ve,2*Oe),ee.push(Bt||[],fe+1,2*ve,2*Oe+1),ee.push(It||[],fe+1,2*ve+1,2*Oe),ee.push(Ci||[],fe+1,2*ve+1,2*Oe+1)}}},aa.prototype.getTile=function(Ve,fe,ve){var Oe=this.options,Je=Oe.extent,le=Oe.debug;if(Ve<0||Ve>24)return null;var X=1<<Ve,ee=oo(Ve,fe=(fe%X+X)%X,ve);if(this.tiles[ee])return Co(this.tiles[ee],Je);le>1&&console.log("drilling down to z%d-%d-%d",Ve,fe,ve);for(var ae,he=Ve,Se=fe,qe=ve;!ae&&he>0;)he--,Se=Math.floor(Se/2),qe=Math.floor(qe/2),ae=this.tiles[oo(he,Se,qe)];return ae&&ae.source?(le>1&&console.log("found parent tile z%d-%d-%d",he,Se,qe),le>1&&console.time("drilling down"),this.splitTile(ae.source,he,Se,qe,Ve,fe,ve),le>1&&console.timeEnd("drilling down"),this.tiles[ee]?Co(this.tiles[ee],Je):null):null};class pr extends i.VectorTileWorkerSource{constructor(fe,ve,Oe,Je,le){super(fe,ve,Oe,Je,so),le&&(this.loadGeoJSON=le)}loadData(fe,ve){const Oe=fe&&fe.request,Je=Oe&&Oe.collectResourceTiming;this.loadGeoJSON(fe,(le,X)=>{if(le||!X)return ve(le);if(typeof X!="object")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));{q(X,!0);try{if(fe.filter){const ae=i.createExpression(fe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));X={type:"FeatureCollection",features:X.features.filter(Se=>ae.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=fe.cluster?new Xr(function({superclusterOptions:ae,clusterProperties:he}){if(!he||!ae)return ae;const Se={},qe={},De={accumulated:null,zoom:0},Ue={properties:null},it=Object.keys(he);for(const xt of it){const[Bt,It]=he[xt],Ci=i.createExpression(It),ri=i.createExpression(typeof Bt=="string"?[Bt,["accumulated"],["get",xt]]:Bt);Se[xt]=Ci.value,qe[xt]=ri.value}return ae.map=xt=>{Ue.properties=xt;const Bt={};for(const It of it)Bt[It]=Se[It].evaluate(De,Ue);return Bt},ae.reduce=(xt,Bt)=>{Ue.properties=Bt;for(const It of it)De.accumulated=xt[It],xt[It]=qe[It].evaluate(De,Ue)},ae}(fe)).load(X.features):function(ae,he){return new aa(ae,he)}(X,fe.geojsonVtOptions)}catch(ae){return ve(ae)}this.loaded={};const ee={};if(Je){const ae=i.getPerformanceMeasurement(Oe);ae&&(ee.resourceTiming={},ee.resourceTiming[fe.source]=JSON.parse(JSON.stringify(ae)))}ve(null,ee)}})}reloadTile(fe,ve){const Oe=this.loaded;return Oe&&Oe[fe.uid]?super.reloadTile(fe,ve):this.loadTile(fe,ve)}loadGeoJSON(fe,ve){if(fe.request)i.getJSON(fe.request,ve);else{if(typeof fe.data!="string")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));try{return ve(null,JSON.parse(fe.data))}catch{return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(fe,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(Oe){ve(Oe)}}getClusterChildren(fe,ve){try{ve(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(Oe){ve(Oe)}}getClusterLeaves(fe,ve){try{ve(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(Oe){ve(Oe)}}}class La{constructor(fe){this.self=fe,this.actor=new i.Actor(fe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.getProjection({name:"mercator"}),this.workerSourceTypes={vector:i.VectorTileWorkerSource,geojson:pr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ve,Oe)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=Oe},this.self.registerRTLTextPlugin=ve=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=ve.applyArabicShaping,i.plugin.processBidirectionalText=ve.processBidirectionalText,i.plugin.processStyledBidirectionalText=ve.processStyledBidirectionalText}}clearCaches(fe,ve,Oe){delete this.layerIndexes[fe],delete this.availableImages[fe],delete this.workerSources[fe],delete this.demWorkerSources[fe],Oe()}checkIfReady(fe,ve,Oe){Oe()}setReferrer(fe,ve){this.referrer=ve}spriteLoaded(fe,ve){this.isSpriteLoaded[fe]=ve;for(const Oe in this.workerSources[fe]){const Je=this.workerSources[fe][Oe];for(const le in Je)Je[le]instanceof i.VectorTileWorkerSource&&(Je[le].isSpriteLoaded=ve,Je[le].fire(new i.Event("isSpriteLoaded")))}}setImages(fe,ve,Oe){this.availableImages[fe]=ve;for(const Je in this.workerSources[fe]){const le=this.workerSources[fe][Je];for(const X in le)le[X].availableImages=ve}Oe()}enableTerrain(fe,ve,Oe){this.terrain=ve,Oe()}setProjection(fe,ve){this.projections[fe]=i.getProjection(ve)}setLayers(fe,ve,Oe){this.getLayerIndex(fe).replace(ve),Oe()}updateLayers(fe,ve,Oe){this.getLayerIndex(fe).update(ve.layers,ve.removedIds),Oe()}loadTile(fe,ve,Oe){const Je=this.enableTerrain?i.extend({enableTerrain:this.terrain},ve):ve;Je.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source).loadTile(Je,Oe)}loadDEMTile(fe,ve,Oe){const Je=this.enableTerrain?i.extend({buildQuadTree:this.terrain},ve):ve;this.getDEMWorkerSource(fe,ve.source).loadTile(Je,Oe)}reloadTile(fe,ve,Oe){const Je=this.enableTerrain?i.extend({enableTerrain:this.terrain},ve):ve;Je.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source).reloadTile(Je,Oe)}abortTile(fe,ve,Oe){this.getWorkerSource(fe,ve.type,ve.source).abortTile(ve,Oe)}removeTile(fe,ve,Oe){this.getWorkerSource(fe,ve.type,ve.source).removeTile(ve,Oe)}removeSource(fe,ve,Oe){if(!this.workerSources[fe]||!this.workerSources[fe][ve.type]||!this.workerSources[fe][ve.type][ve.source])return;const Je=this.workerSources[fe][ve.type][ve.source];delete this.workerSources[fe][ve.type][ve.source],Je.removeSource!==void 0?Je.removeSource(ve,Oe):Oe()}loadWorkerSource(fe,ve,Oe){try{this.self.importScripts(ve.url),Oe()}catch(Je){Oe(Je.toString())}}syncRTLPluginState(fe,ve,Oe){try{i.plugin.setState(ve);const Je=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&Je!=null){this.self.importScripts(Je);const le=i.plugin.isParsed();Oe(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Je}`),le)}}catch(Je){Oe(Je.toString())}}getAvailableImages(fe){let ve=this.availableImages[fe];return ve||(ve=[]),ve}getLayerIndex(fe){let ve=this.layerIndexes[fe];return ve||(ve=this.layerIndexes[fe]=new K),ve}getWorkerSource(fe,ve,Oe){if(this.workerSources[fe]||(this.workerSources[fe]={}),this.workerSources[fe][ve]||(this.workerSources[fe][ve]={}),!this.workerSources[fe][ve][Oe]){const Je={send:(le,X,ee,ae,he,Se)=>{this.actor.send(le,X,ee,fe,he,Se)},scheduler:this.actor.scheduler};this.workerSources[fe][ve][Oe]=new this.workerSourceTypes[ve](Je,this.getLayerIndex(fe),this.getAvailableImages(fe),this.isSpriteLoaded[fe])}return this.workerSources[fe][ve][Oe]}getDEMWorkerSource(fe,ve){return this.demWorkerSources[fe]||(this.demWorkerSources[fe]={}),this.demWorkerSources[fe][ve]||(this.demWorkerSources[fe][ve]=new Y),this.demWorkerSources[fe][ve]}enforceCacheSizeLimit(fe,ve){i.enforceCacheSizeLimit(ve)}getWorkerPerformanceMetrics(fe,ve,Oe){Oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new La(self)),La}),E(["./shared"],function(i){function F(_,o){if(Array.isArray(_)){if(!Array.isArray(o)||_.length!==o.length)return!1;for(let f=0;f<_.length;f++)if(!F(_[f],o[f]))return!1;return!0}if(typeof _=="object"&&_!==null&&o!==null){if(typeof o!="object"||Object.keys(_).length!==Object.keys(o).length)return!1;for(const f in _)if(!F(_[f],o[f]))return!1;return!0}return _===o}var j=K;function K(_){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,S,k=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(k);try{S=new Worker(O),x=!0}catch{x=!1}return S&&S.terminate(),URL.revokeObjectURL(O),x}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var x=document.createElement("canvas");x.width=x.height=1;var S=x.getContext("2d");if(!S)return!1;var k=S.getImageData(0,0,1,1);return k&&k.width===x.width}()?(Y[f=o&&o.failIfMajorPerformanceCaveat]===void 0&&(Y[f]=function(x){var S,k=function(O){var V=document.createElement("canvas"),G=Object.create(K.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=O,V.getContext("webgl",G)||V.getContext("experimental-webgl",G)}(x);if(!k)return!1;try{S=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!S||k.isContextLost())&&(k.shaderSource(S,"void main() {}"),k.compileShader(S),k.getShaderParameter(S,k.COMPILE_STATUS)===!0)}(f)),Y[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f}(_)}var Y={};function q(_,o,f){const x=i.window.document.createElement(_);return o!==void 0&&(x.className=o),f&&f.appendChild(x),x}function re(_,o,f){const x=i.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const S of Object.keys(o))x.setAttributeNS(null,S,o[S]);return f&&f.appendChild(x),x}K.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const me=i.window.document&&i.window.document.documentElement.style,we=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let je;function $e(){me&&we&&(je=me[we],me[we]="none")}function tt(){me&&we&&(me[we]=je)}function Ae(_){_.preventDefault(),_.stopPropagation(),i.window.removeEventListener("click",Ae,!0)}function mt(){i.window.addEventListener("click",Ae,!0),i.window.setTimeout(()=>{i.window.removeEventListener("click",Ae,!0)},0)}function Me(_,o){const f=_.getBoundingClientRect();return rt(_,f,o)}function Ye(_,o){const f=_.getBoundingClientRect(),x=[];for(let S=0;S<o.length;S++)x.push(rt(_,f,o[S]));return x}function Ze(_){return i.window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&i.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function rt(_,o,f){const x=_.offsetWidth===o.width?1:_.offsetWidth/o.width;return new i.pointGeometry((f.clientX-o.left)*x,(f.clientY-o.top)*x)}function gt(_,o){var f=o[0],x=o[1],S=o[2],k=o[3],O=f*k-S*x;return O?(_[0]=k*(O=1/O),_[1]=-x*O,_[2]=-S*O,_[3]=f*O,_):null}function vt(_){const{userImage:o}=_;return!!(o&&o.render&&o.render())&&(_.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ut extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:f,callback:x}of this.requestors)this._notify(f,x);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,f){this._validate(o,f)&&(this.images[o]=f)}_validate(o,f){let x=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),x=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),x=!1),this._validateContent(f.content,f)||(this.fire(new i.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),x=!1),x}_validateStretch(o,f){if(!o)return!0;let x=0;for(const S of o){if(S[0]<x||S[1]<S[0]||f<S[1])return!1;x=S[1]}return!0}_validateContent(o,f){return!(o&&(o.length!==4||o[0]<0||f.data.width<o[0]||o[1]<0||f.data.height<o[1]||o[2]<0||f.data.width<o[2]||o[3]<0||f.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,f){f.version=this.images[o].version+1,this.images[o]=f,this.updatedImages[o]=!0}removeImage(o){const f=this.images[o];delete this.images[o],delete this.patterns[o],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,f){let x=!0;if(!this.isLoaded())for(const S of o)this.images[S]||(x=!1);this.isLoaded()||x?this._notify(o,f):this.requestors.push({ids:o,callback:f})}_notify(o,f){const x={};for(const S of o){this.images[S]||this.fire(new i.Event("styleimagemissing",{id:S}));const k=this.images[S];k?x[S]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:Boolean(k.userImage&&k.userImage.render)}:i.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,x)}getPixelSize(){const{width:o,height:f}=this.atlasImage;return{width:o,height:f}}getPattern(o){const f=this.patterns[o],x=this.getImage(o);if(!x)return null;if(f&&f.position.version===x.version)return f.position;if(f)f.position.version=x.version;else{const S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new i.ImagePosition(S,x);this.patterns[o]={bin:S,position:k}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const f=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new i.Texture(o,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const k in this.patterns)o.push(this.patterns[k].bin);const{w:f,h:x}=i.potpack(o),S=this.atlasImage;S.resize({width:f||1,height:x||1});for(const k in this.patterns){const{bin:O}=this.patterns[k],V=O.x+1,G=O.y+1,te=this.images[k].data,ie=te.width,ge=te.height;i.RGBAImage.copy(te,S,{x:0,y:0},{x:V,y:G},{width:ie,height:ge}),i.RGBAImage.copy(te,S,{x:0,y:ge-1},{x:V,y:G-1},{width:ie,height:1}),i.RGBAImage.copy(te,S,{x:0,y:0},{x:V,y:G+ge},{width:ie,height:1}),i.RGBAImage.copy(te,S,{x:ie-1,y:0},{x:V-1,y:G},{width:1,height:ge}),i.RGBAImage.copy(te,S,{x:0,y:0},{x:V+ie,y:G},{width:1,height:ge})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const f of o){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const x=this.images[f];vt(x)&&this.updateImage(f,x)}}}const At=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(_,o){return function([f,x,S]){const k=i.degToRad(x+90),O=i.degToRad(S);return{x:f*Math.cos(k)*Math.sin(O),y:f*Math.sin(k)*Math.sin(O),z:f*Math.cos(O),azimuthal:x,polar:S}}(_.expression.evaluate(o))}interpolate(_,o,f){return{x:i.number(_.x,o.x,f),y:i.number(_.y,o.y,f),z:i.number(_.z,o.z,f),azimuthal:i.number(_.azimuthal,o.azimuthal,f),polar:i.number(_.polar,o.polar,f)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)}),ti="-transition";class Nt extends i.Evented{constructor(o){super(),this._transitionable=new i.Transitionable(At),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,f={}){if(!this._validate(i.validateLight,o,f))for(const x in o){const S=o[x];i.endsWith(x,ti)?this._transitionable.setTransition(x.slice(0,-ti.length),S):this._transitionable.setValue(x,S)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,x){return(!x||x.validate!==!1)&&i.emitValidationErrors(this,o.call(i.validateStyle,i.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}const Wt=new i.Properties({source:new i.DataConstantProperty(i.spec.terrain.source),exaggeration:new i.DataConstantProperty(i.spec.terrain.exaggeration)}),zt="-transition";class Yt extends i.Evented{constructor(o,f){super(),this._transitionable=new i.Transitionable(Wt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=f}get(){return this._transitionable.serialize()}set(o){for(const f in o){const x=o[f];i.endsWith(f,zt)?this._transitionable.setTransition(f.slice(0,-zt.length),x):this._transitionable.setValue(f,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function vi(_,o,f,x){const S=i.smoothstep(45,65,f),[k,O]=cn(_,x),V=i.length(o);let G=1-Math.min(1,Math.exp((V-k)/(O-k)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*S*_.alpha}function cn(_,o){const f=.5/Math.tan(.5*o);return[_.range[0]+f,_.range[1]+f]}const di=new i.Properties({range:new i.DataConstantProperty(i.spec.fog.range),color:new i.DataConstantProperty(i.spec.fog.color),"high-color":new i.DataConstantProperty(i.spec.fog["high-color"]),"space-color":new i.DataConstantProperty(i.spec.fog["space-color"]),"horizon-blend":new i.DataConstantProperty(i.spec.fog["horizon-blend"]),"star-intensity":new i.DataConstantProperty(i.spec.fog["star-intensity"])}),un="-transition";class mn extends i.Evented{constructor(o,f){super(),this._transitionable=new i.Transitionable(di),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const o=this._transform,f=o.projection.name==="globe",x=i.globeToMercatorTransition(o.zoom),S=this.properties.get("range"),k=[.5,3];return{range:f?[i.number(k[0],S[0],x),i.number(k[1],S[1],x)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,f={}){if(!this._validate(i.validateFog,o,f)){for(const x of Object.keys(i.spec.fog))o&&o[x]===void 0&&(o[x]=i.spec.fog[x].default);for(const x in o){const S=o[x];i.endsWith(x,un)?this._transitionable.setTransition(x.slice(0,-un.length),S):this._transitionable.setValue(x,S)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.smoothstep(45,65,o))*f.a}getOpacityAtLatLng(o,f){return this._transform.projection.supportsFog?function(x,S,k){const O=i.MercatorCoordinate.fromLngLat(S),V=k.elevation?k.elevation.getAtPointOrZero(O):0,G=[O.x,O.y,V];return i.transformMat4(G,G,k.mercatorFogMatrix),vi(x,G,k.pitch,k._fov)}(this.state,o,f):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?cn(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,x){return(!x||x.validate!==!1)&&i.emitValidationErrors(this,o.call(i.validateStyle,i.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class Er{constructor(o,f){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=i.uniqueId();const x=this.workerPool.acquire(this.id);for(let S=0;S<x.length;S++){const k=new Er.Actor(x[S],f,this.id);k.name=`Worker ${S}`,this.actors.push(k)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,f,x){i.asyncAll(this.actors,(S,k)=>{S.send(o,f,k)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Li(_,o,f){return o*(i.EXTENT/(_.tileSize*Math.pow(2,f-_.tileID.overscaledZ)))}Er.Actor=i.Actor;class En{constructor(o,f,x,S){this.screenBounds=o,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(o,f){let x,S;if(o instanceof i.pointGeometry||typeof o[0]=="number"){const k=i.pointGeometry.convert(o);x=[k],S=f.isPointAboveHorizon(k)}else{const k=i.pointGeometry.convert(o[0]),O=i.pointGeometry.convert(o[1]);x=[k,O],S=i.polygonizeBounds(k,O).every(V=>f.isPointAboveHorizon(V))}return new En(x,f.getCameraPoint(),S,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const f=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new i.pointGeometry(1,1)):this.screenBounds[1],S=i.polygonizeBounds(f,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<x.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?S[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(S[3]=this.cameraPoint)),i.bufferConvexPolygon(S,o)}bufferedCameraGeometryGlobe(o){const f=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new i.pointGeometry(1,1)):this.screenBounds[1],S=i.polygonizeBounds(f,x,o),k=this.cameraPoint.clone();switch(3*((k.y>f.y)+(k.y>x.y))+((k.x>f.x)+(k.x>x.x))){case 0:S[0]=k,S[4]=k.clone();break;case 1:S.splice(1,0,k);break;case 2:S[1]=k;break;case 3:S.splice(4,0,k);break;case 5:S.splice(2,0,k);break;case 6:S[3]=k;break;case 7:S.splice(3,0,k);break;case 8:S[2]=k}return S}containsTile(o,f,x,S=0){const k=o.queryPadding/f._pixelsPerMercatorPixel+1,O=x?this._bufferedCameraMercator(k,f):this._bufferedScreenMercator(k,f);let V=o.tileID.wrap+(O.unwrapped?S:0);const G=O.polygon.map(Pe=>i.getTilePoint(o.tileTransform,Pe,V));if(!i.polygonIntersectsBox(G,0,0,i.EXTENT,i.EXTENT))return;V=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const te=this.screenGeometryMercator.polygon.map(Pe=>i.getTileVec3(o.tileTransform,Pe,V)),ie=te.map(Pe=>new i.pointGeometry(Pe[0],Pe[1])),ge=f.getFreeCameraOptions().position||new i.MercatorCoordinate(0,0,0),Te=i.getTileVec3(o.tileTransform,ge,V),Be=te.map(Pe=>{const ze=i.sub(Pe,Pe,Te);return i.normalize(ze,ze),new i.Ray(Te,ze)}),Le=Li(o,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ie,tilespaceRays:Be,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(Re=i.getBounds(G),Re.min.x=i.clamp(Re.min.x,0,i.EXTENT),Re.min.y=i.clamp(Re.min.y,0,i.EXTENT),Re.max.x=i.clamp(Re.max.x,0,i.EXTENT),Re.max.y=i.clamp(Re.max.y,0,i.EXTENT),Re),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Le};var Re}_bufferedScreenMercator(o,f){const x=Fo(o);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),f):{polygon:this.bufferedScreenGeometry(o).map(k=>f.pointCoordinate3D(k)),unwrapped:!0},this._screenRaycastCache[x]=S,S}}_bufferedCameraMercator(o,f){const x=Fo(o);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),f):{polygon:this.bufferedCameraGeometry(o).map(k=>f.pointCoordinate3D(k)),unwrapped:!0},this._cameraRaycastCache[x]=S,S}}_projectAndResample(o,f){const x=function(k,O){const V=i.multiply([],O.pixelMatrix,O.globeMatrix),G=[0,-i.GLOBE_RADIUS,0,1],te=[0,i.GLOBE_RADIUS,0,1],ie=[0,0,0,1];i.transformMat4$1(G,G,V),i.transformMat4$1(te,te,V),i.transformMat4$1(ie,ie,V);const ge=new i.pointGeometry(G[0]/G[3],G[1]/G[3]),Te=new i.pointGeometry(te[0]/te[3],te[1]/te[3]),Be=i.polygonContainsPoint(k,ge)&&G[3]<ie[3],Le=i.polygonContainsPoint(k,Te)&&te[3]<ie[3];if(!Be&&!Le)return null;const Re=function(yt,$t,Dt){for(let Et=1;Et<yt.length;Et++){const bi=vr($t.pointCoordinate3D(yt[Et-1]).x),wt=vr($t.pointCoordinate3D(yt[Et]).x);if(Dt<0){if(bi<wt)return{idx:Et,t:-bi/(wt-1-bi)}}else if(wt<bi)return{idx:Et,t:(1-bi)/(wt+1-bi)}}return null}(k,O,Be?-1:1);if(!Re)return null;const{idx:Pe,t:ze}=Re;let Ne=Pe>1?wn(k.slice(0,Pe),O):[],Fe=Pe<k.length?wn(k.slice(Pe),O):[];Ne=Ne.map(yt=>new i.pointGeometry(vr(yt.x),yt.y)),Fe=Fe.map(yt=>new i.pointGeometry(vr(yt.x),yt.y));const et=[...Ne];et.length===0&&et.push(Fe[Fe.length-1]);const ut=i.number(et[et.length-1].y,(Fe.length===0?Ne[0]:Fe[0]).y,ze);let lt;return lt=Be?[new i.pointGeometry(0,ut),new i.pointGeometry(0,0),new i.pointGeometry(1,0),new i.pointGeometry(1,ut)]:[new i.pointGeometry(1,ut),new i.pointGeometry(1,1),new i.pointGeometry(0,1),new i.pointGeometry(0,ut)],et.push(...lt),Fe.length===0?et.push(Ne[0]):et.push(...Fe),{polygon:et.map(yt=>new i.MercatorCoordinate(yt.x,yt.y)),unwrapped:!1}}(o,f);if(x)return x;const S=function(k,O){let V=!1,G=-1/0,te=0;for(let ge=0;ge<k.length-1;ge++)k[ge].x>G&&(G=k[ge].x,te=ge);for(let ge=0;ge<k.length-1;ge++){const Te=(te+ge)%(k.length-1),Be=k[Te],Le=k[Te+1];Math.abs(Be.x-Le.x)>.5&&(Be.x<Le.x?(Be.x+=1,Te===0&&(k[k.length-1].x+=1)):(Le.x+=1,Te+1===k.length-1&&(k[0].x+=1)),V=!0)}const ie=i.mercatorXfromLng(O.center.lng);return V&&ie<Math.abs(ie-1)&&k.forEach(ge=>{ge.x-=1}),{polygon:k,unwrapped:V}}(wn(o,f).map(k=>new i.pointGeometry(vr(k.x),k.y)),f);return{polygon:S.polygon.map(k=>new i.MercatorCoordinate(k.x,k.y)),unwrapped:S.unwrapped}}}function wn(_,o){return i.resample(_,f=>{const x=o.pointCoordinate3D(f);f.x=x.x,f.y=x.y},1/256)}function vr(_){return _<0?1+_%1:_%1}function Fo(_){return 100*_|0}function Xr(_,o,f,x,S){const k=function(O,V){if(O)return S(O);if(V){_.url&&V.tiles&&_.tiles&&delete _.tiles;const G=i.pick(i.extend(V,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);V.vector_layers&&(G.vectorLayers=V.vector_layers,G.vectorLayerIds=G.vectorLayers.map(te=>te.id)),G.tiles=o.canonicalizeTileset(G,_.url),S(null,G)}};return _.url?i.getJSON(o.transformRequest(o.normalizeSourceURL(_.url,null,f,x),i.ResourceType.Source),k):i.exported.frame(()=>k(null,_))}class uo{constructor(o,f,x){this.bounds=i.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=f||0,this.maxzoom=x||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const f=Math.pow(2,o.z),x=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*f),S=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*f),k=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*f),O=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*f);return o.x>=x&&o.x<k&&o.y>=S&&o.y<O}}class ks{constructor(o,f,x){this.context=o;const S=o.gl;this.buffer=S.createBuffer(),this.dynamicDraw=Boolean(x),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const at={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bt{constructor(o,f,x,S){this.length=f.length,this.attributes=x,this.itemSize=f.bytesPerElement,this.dynamicDraw=S,this.context=o;const k=o.gl;this.buffer=k.createBuffer(),o.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,f){for(let x=0;x<this.attributes.length;x++){const S=f.attributes[this.attributes[x].name];S!==void 0&&o.enableVertexAttribArray(S)}}setVertexAttribPointers(o,f,x){for(let S=0;S<this.attributes.length;S++){const k=this.attributes[S],O=f.attributes[k.name];O!==void 0&&o.vertexAttribPointer(O,k.components,o[at[k.type]],!1,this.itemSize,k.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ft{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fi extends Ft{getDefault(){return i.Color.transparent}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class gi extends Ft{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Mi extends Ft{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ki extends Ft{getDefault(){return[!0,!0,!0,!0]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ci extends Ft{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Pi extends Ft{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Si extends Ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const f=this.current;(o.func!==f.func||o.ref!==f.ref||o.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class tn extends Ft{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class on extends Ft{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=o,this.dirty=!1}}class hn extends Ft{getDefault(){return[0,1]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Tn extends Ft{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=o,this.dirty=!1}}class On extends Ft{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class qn extends Ft{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.BLEND):f.disable(f.BLEND),this.current=o,this.dirty=!1}}class Ot extends Ft{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class yi extends Ft{getDefault(){return i.Color.transparent}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Pr extends Ft{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Eo extends Ft{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=o,this.dirty=!1}}class jn extends Ft{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ro extends Ft{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class _o extends Ft{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class zr extends Ft{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class So extends Ft{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class zi extends Ft{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Ln extends Ft{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Dn extends Ft{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Co extends Ft{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class is extends Ft{getDefault(){return null}set(o){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class kn extends Ft{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class sa extends Ft{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class yo extends Ft{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class aa extends Ft{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class oo extends Ft{constructor(o,f){super(o),this.context=o,this.parent=f}getDefault(){return null}}class so extends oo{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class pr extends oo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class La extends pr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ve{constructor(o,f,x,S){this.context=o,this.width=f,this.height=x;const k=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new so(o,k),S&&(this.depthAttachment=new pr(o,k))}destroy(){const o=this.context.gl,f=this.colorAttachment.get();if(f&&o.deleteTexture(f),this.depthAttachment){const x=this.depthAttachment.get();x&&o.deleteRenderbuffer(x)}o.deleteFramebuffer(this.framebuffer)}}class fe{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new fi(this),this.clearDepth=new gi(this),this.clearStencil=new Mi(this),this.colorMask=new Ki(this),this.depthMask=new ci(this),this.stencilMask=new Pi(this),this.stencilFunc=new Si(this),this.stencilOp=new tn(this),this.stencilTest=new on(this),this.depthRange=new hn(this),this.depthTest=new Tn(this),this.depthFunc=new On(this),this.blend=new qn(this),this.blendFunc=new Ot(this),this.blendColor=new yi(this),this.blendEquation=new Pr(this),this.cullFace=new Eo(this),this.cullFaceSide=new jn(this),this.frontFace=new ro(this),this.program=new _o(this),this.activeTexture=new zr(this),this.viewport=new So(this),this.bindFramebuffer=new zi(this),this.bindRenderbuffer=new Ln(this),this.bindTexture=new Dn(this),this.bindVertexBuffer=new Co(this),this.bindElementBuffer=new is(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new kn(this),this.pixelStoreUnpack=new sa(this),this.pixelStoreUnpackPremultiplyAlpha=new yo(this),this.pixelStoreUnpackFlipY=new aa(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,f){return new ks(this,o,f)}createVertexBuffer(o,f,x){return new bt(this,o,f,x)}createRenderbuffer(o,f,x){const S=this.gl,k=S.createRenderbuffer();return this.bindRenderbuffer.set(k),S.renderbufferStorage(S.RENDERBUFFER,o,f,x),this.bindRenderbuffer.set(null),k}createFramebuffer(o,f,x){return new Ve(this,o,f,x)}clear({color:o,depth:f,stencil:x}){const S=this.gl;let k=0;o&&(k|=S.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(k|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),x!==void 0&&(k|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),S.clear(k)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){F(o.blendFunction,i.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ve extends i.Evented{constructor(o,f,x,S){super(),this.id=o,this.dispatcher=x,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},f),i.extend(this,i.pick(f,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Xr(this._options,this.map._requestManager,null,null,(o,f)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new i.ErrorEvent(o)):f&&(i.extend(this,f),f.bounds&&(this.tileBounds=new uo(f.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(f.tiles),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,f){const x=i.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);o.request=i.getImage(this.map._requestManager.transformRequest(S,i.ResourceType.Tile),(k,O,V,G)=>(delete o.request,o.aborted?(o.state="unloaded",f(null)):k?(o.state="errored",f(k)):O?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:V,expires:G}),o.setTexture(O,this.map.painter),o.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(o,f,x){o.setTexture(f,x)}static unloadTileData(o,f){o.texture&&f.saveTileTexture(o.texture)}abortTile(o,f){o.request&&(o.request.cancel(),delete o.request),f()}unloadTile(o,f){o.texture&&this.map.painter.saveTileTexture(o.texture),f()}hasTransition(){return!1}}let Oe;function Je(_,o,f,x,S,k,O,V){const G=[_,f,S,o,x,k,1,1,1],te=[O,V,1],ie=i.adjoint([],G),[ge,Te,Be]=i.transformMat3(te,te,i.transpose(ie,ie));return i.multiply$1(G,[ge,0,0,0,Te,0,0,0,Be],G)}class le extends i.Evented{constructor(o,f,x,S){super(),this.id=o,this.dispatcher=x,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=f,this._dirty=!1}load(o,f){this._loaded=f||!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(x,S)=>{if(this._imageRequest=null,this._loaded=!0,x)this.fire(new i.ErrorEvent(x));else if(S){const{HTMLImageElement:k}=i.window;this.image=S instanceof k?i.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const f=o.map(i.MercatorCoordinate.fromLngLat);return this.tileID=function(x){let S=1/0,k=1/0,O=-1/0,V=-1/0;for(const ge of x)S=Math.min(S,ge.x),k=Math.min(k,ge.y),O=Math.max(O,ge.x),V=Math.max(V,ge.y);const G=Math.max(O-S,V-k),te=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),ie=Math.pow(2,te);return new i.CanonicalTileID(te,Math.floor((S+O)/2*ie),Math.floor((k+V)/2*ie))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const G in this.tiles){const te=this.tiles[G];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray)return;const f=i.tileTransform(this.tileID,this.map.transform.projection),[x,S,k,O]=this.coordinates.map(G=>{const te=f.projection.project(G[0],G[1]);return i.getTilePoint(f,te)._round()});this.perspectiveTransform=function(G,te,ie,ge,Te,Be,Le,Re,Pe,ze){const Ne=Je(0,0,G,0,0,te,G,te),Fe=Je(ie,ge,Te,Be,Le,Re,Pe,ze);return i.multiply$1(Fe,i.adjoint(Ne,Ne),Fe),[Fe[6]/Fe[8]*G/i.EXTENT,Fe[7]/Fe[8]*te/i.EXTENT]}(this.width,this.height,x.x,x.y,S.x,S.y,O.x,O.y,k.x,k.y);const V=this._boundsArray=new i.StructArrayLayout4i8;V.emplaceBack(x.x,x.y,0,0),V.emplaceBack(S.x,S.y,i.EXTENT,0),V.emplaceBack(O.x,O.y,0,i.EXTENT),V.emplaceBack(k.x,k.y,i.EXTENT,i.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(V,i.boundsAttributes.members),this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,f=o.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new i.Texture(o,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(o)}loadTile(o,f){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},f(null)):(o.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const X={vector:class extends i.Evented{constructor(_,o,f,x){if(super(),this.id=_,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(o,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.DedupedRequest}load(_){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Xr(this._options,this.map._requestManager,o,f,(x,S)=>{this._tileJSONRequest=null,this._loaded=!0,x?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.ErrorEvent(x))):S&&(i.extend(this,S),S.bounds&&(this.tileBounds=new uo(S.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),_&&_(x)})}loaded(){return this._loaded}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}onAdd(_){this.map=_,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const _=this.map.style._getSourceCaches(this.id);for(const o of _)o.clearTiles()})}setSourceProperty(_){_(),this.reload()}setTiles(_){return this._options.tiles=_,this.reload(),this}setUrl(_){return this.url=_,this._options.url=_,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}loadTile(_,o){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(f,i.ResourceType.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:_.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,_.actor&&_.state!=="expired")_.state==="loading"?_.reloadCallback=o:_.request=_.actor.send("reloadTile",x,S.bind(this));else if(_.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)_.request=_.actor.send("loadTile",x,S.bind(this),void 0,!0);else{const k=i.loadVectorTile.call({deduped:this._deduped},x,(O,V)=>{O||!V?S.call(this,O):(x.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},_.actor&&_.actor.send("loadTile",x,S.bind(this),void 0,!0))},!0);_.request={cancel:k}}function S(k,O){return delete _.request,_.aborted?o(null):k&&k.status!==404?o(k):(O&&O.resourceTiming&&(_.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&_.setExpiryData(O),_.loadVectorData(O,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id})}unloadTile(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:ve,"raster-dem":class extends ve{constructor(_,o,f,x){super(_,o,f,x),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(_,o){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(S,k){S&&(_.state="errored",o(S)),k&&(_.dem=k,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",o(null))}_.request=i.getImage(this.map._requestManager.transformRequest(f,i.ResourceType.Tile),function(S,k,O,V){if(delete _.request,_.aborted)_.state="unloaded",o(null);else if(S)_.state="errored",o(S);else if(k){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:O,expires:V});const G=i.window.ImageBitmap&&k instanceof i.window.ImageBitmap&&(Oe==null&&(Oe=i.window.OffscreenCanvas&&new i.window.OffscreenCanvas(1,1).getContext("2d")&&typeof i.window.createImageBitmap=="function"),Oe),te=1-(k.width-i.prevPowerOfTwo(k.width))/2;te<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const ie=G?k:i.exported.getImageData(k,te),ge={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:ie,encoding:this.encoding,padding:te};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",ge,x.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const o=_.canonical,f=Math.pow(2,o.z),x=(o.x-1+f)%f,S=o.x===0?_.wrap-1:_.wrap,k=(o.x+1+f)%f,O=o.x+1===f?_.wrap+1:_.wrap,V={};return V[new i.OverscaledTileID(_.overscaledZ,S,o.z,x,o.y).key]={backfilled:!1},V[new i.OverscaledTileID(_.overscaledZ,O,o.z,k,o.y).key]={backfilled:!1},o.y>0&&(V[new i.OverscaledTileID(_.overscaledZ,S,o.z,x,o.y-1).key]={backfilled:!1},V[new i.OverscaledTileID(_.overscaledZ,_.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},V[new i.OverscaledTileID(_.overscaledZ,O,o.z,k,o.y-1).key]={backfilled:!1}),o.y+1<f&&(V[new i.OverscaledTileID(_.overscaledZ,S,o.z,x,o.y+1).key]={backfilled:!1},V[new i.OverscaledTileID(_.overscaledZ,_.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},V[new i.OverscaledTileID(_.overscaledZ,O,o.z,k,o.y+1).key]={backfilled:!1}),V}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends i.Evented{constructor(_,o,f,x){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(x),this._data=o.data,this._options=i.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const S=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*S,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*S,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*S,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},o),this}getClusterChildren(_,o){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},o),this}getClusterLeaves(_,o,f,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:o,offset:f},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=i.extend({},this.workerOptions),o=this._data;typeof o=="string"?(_.request=this.map._requestManager.transformRequest(i.exported.resolveURL(o),i.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(f,x)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new i.ErrorEvent(f));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(S.resourceTiming=x.resourceTiming[this.id]),this.fire(new i.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,o){const f=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(f,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(x,S)=>(delete _.request,_.unloadVectorData(),_.aborted?o(null):x?o(x):(_.loadVectorData(S,this.map.painter,f==="reloadTile"),o(null))),void 0,f==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends le{constructor(_,o,f,x){super(_,o,f,x),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const o of _.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.ResourceType.Source).url);i.getVideo(this.urls,(o,f)=>{this._loaded=!0,o?this.fire(new i.ErrorEvent(o)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const o=this.video.seekable;_<o.start(0)||_>o.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,o=_.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.Texture(_,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:le,canvas:class extends le{constructor(_,o,f,x){super(_,o,f,x),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(k=>typeof k!="number"))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof i.window.HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.window.HTMLCanvasElement?this.options.canvas:i.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends i.Evented{constructor(_,o,f,x){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=o,this.setEventedParent(x),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new uo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),i.extend(this,i.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:o,y:f,z:x}=_.canonical;return this._implementation.hasTile({x:o,y:f,z:x})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,o){const{x:f,y:x,z:S}=_.tileID.canonical,k=new i.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:f,y:x,z:S},{signal:k.signal})).then(function(O){return delete _.request,_.aborted?(_.state="unloaded",o(null)):O===void 0?(_.state="errored",o(null)):O===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",o(null)):function(V){return V instanceof i.window.ImageData||V instanceof i.window.HTMLCanvasElement||V instanceof i.window.ImageBitmap||V instanceof i.window.HTMLImageElement}(O)?(this.loadTileData(_,O),_.state="loaded",void o(null)):(_.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(O=>{O.code!==20&&(_.state="errored",o(O))}),_.request.cancel=()=>k.abort()}loadTileData(_,o){ve.loadTileData(_,o,this._map.painter)}unloadTileData(_){ve.unloadTileData(_,this._map.painter)}unloadTile(_,o){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:f,y:x,z:S}=_.tileID.canonical;this._implementation.unloadTile({x:f,y:x,z:S})}o()}abortTile(_,o){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ee=function(_,o,f,x){const S=new X[o.type](_,o,f,x);if(S.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${S.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],S),S};function ae(_,o){const f=i.identity([]);return i.scale(f,f,[.5*_.width,.5*-_.height,1]),i.translate(f,f,[1,-1,0]),i.multiply(f,f,_.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(f)}function he(_,o,f,x,S,k,O,V=!1){const G=_.tilesIn(x,O,V);G.sort(qe);const te=[];for(const ge of G)te.push({wrappedTileID:ge.tile.tileID.wrapped().key,queryResults:ge.tile.queryRenderedFeatures(o,f,_._state,ge,S,k,ae(_.transform,ge.tile.tileID),V)});const ie=function(ge){const Te={},Be={};for(const Le of ge){const Re=Le.queryResults,Pe=Le.wrappedTileID,ze=Be[Pe]=Be[Pe]||{};for(const Ne in Re){const Fe=Re[Ne],et=ze[Ne]=ze[Ne]||{},ut=Te[Ne]=Te[Ne]||[];for(const lt of Fe)et[lt.featureIndex]||(et[lt.featureIndex]=!0,ut.push(lt))}}return Te}(te);for(const ge in ie)ie[ge].forEach(Te=>{const Be=Te.feature,Le=Be.layer;Le&&Le.type!=="background"&&Le.type!=="sky"&&(Be.source=Le.source,Le["source-layer"]&&(Be.sourceLayer=Le["source-layer"]),Be.state=Be.id!==void 0?_.getFeatureState(Le["source-layer"],Be.id):{})});return ie}function Se(_,o){const f=_.getRenderableIds().map(k=>_.getTileByID(k)),x=[],S={};for(let k=0;k<f.length;k++){const O=f[k],V=O.tileID.canonical.key;S[V]||(S[V]=!0,O.querySourceFeatures(x,o))}return x}function qe(_,o){const f=_.tileID,x=o.tileID;return f.overscaledZ-x.overscaledZ||f.canonical.y-x.canonical.y||f.wrap-x.wrap||f.canonical.x-x.canonical.x}function De(){return Rl.workerClass!=null?new Rl.workerClass:new i.window.Worker(Rl.workerUrl)}const Ue="mapboxgl_preloaded_worker_pool";class it{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<it.workerCount;)this.workers.push(new De);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ue]}numActive(){return Object.keys(this.active).length}}let xt;function Bt(){return xt||(xt=new it),xt}function It(_,o){const f={};for(const x in _)x!=="ref"&&(f[x]=_[x]);return i.refProperties.forEach(x=>{x in o&&(f[x]=o[x])}),f}function Ci(_){_=_.slice();const o=Object.create(null);for(let f=0;f<_.length;f++)o[_[f].id]=_[f];for(let f=0;f<_.length;f++)"ref"in _[f]&&(_[f]=It(_[f],o[_[f].ref]));return _}it.workerCount=2;const ri={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function xi(_,o,f){f.push({command:ri.addSource,args:[_,o[_]]})}function Gi(_,o,f){o.push({command:ri.removeSource,args:[_]}),f[_]=!0}function _n(_,o,f,x){Gi(_,f,x),xi(_,o,f)}function Zn(_,o,f){let x;for(x in _[f])if(_[f].hasOwnProperty(x)&&x!=="data"&&!F(_[f][x],o[f][x]))return!1;for(x in o[f])if(o[f].hasOwnProperty(x)&&x!=="data"&&!F(_[f][x],o[f][x]))return!1;return!0}function xn(_,o,f,x,S,k){let O;for(O in o=o||{},_=_||{})_.hasOwnProperty(O)&&(F(_[O],o[O])||f.push({command:k,args:[x,O,o[O],S]}));for(O in o)o.hasOwnProperty(O)&&!_.hasOwnProperty(O)&&(F(_[O],o[O])||f.push({command:k,args:[x,O,o[O],S]}))}function Mt(_){return _.id}function Gn(_,o){return _[o.id]=o,_}class Fn{constructor(o,f){this.reset(o,f)}reset(o,f){this.points=o||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.clamp(o,0,1);let f=1,x=this._distances[f];const S=o*this.paddedLength+this.padding;for(;x<S&&f<this._distances.length;)x=this._distances[++f];const k=f-1,O=this._distances[k],V=x-O,G=V>0?(S-O)/V:0;return this.points[k].mult(1-G).add(this.points[f].mult(G))}}class Qr{constructor(o,f,x){const S=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(o/x),this.yCellCount=Math.ceil(f/x);for(let O=0;O<this.xCellCount*this.yCellCount;O++)S.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=f,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,f,x,S,k){this._forEachCell(f,x,S,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(f),this.bboxes.push(x),this.bboxes.push(S),this.bboxes.push(k)}insertCircle(o,f,x,S){this._forEachCell(f-S,x-S,f+S,x+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(f),this.circles.push(x),this.circles.push(S)}_insertBoxCell(o,f,x,S,k,O){this.boxCells[k].push(O)}_insertCircleCell(o,f,x,S,k,O){this.circleCells[k].push(O)}_query(o,f,x,S,k,O){if(x<0||o>this.width||S<0||f>this.height)return!k&&[];const V=[];if(o<=0&&f<=0&&this.width<=x&&this.height<=S){if(k)return!0;for(let G=0;G<this.boxKeys.length;G++)V.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const te=this.circles[3*G],ie=this.circles[3*G+1],ge=this.circles[3*G+2];V.push({key:this.circleKeys[G],x1:te-ge,y1:ie-ge,x2:te+ge,y2:ie+ge})}return O?V.filter(O):V}return this._forEachCell(o,f,x,S,this._queryCell,V,{hitTest:k,seenUids:{box:{},circle:{}}},O),k?V.length>0:V}_queryCircle(o,f,x,S,k){const O=o-x,V=o+x,G=f-x,te=f+x;if(V<0||O>this.width||te<0||G>this.height)return!S&&[];const ie=[];return this._forEachCell(O,G,V,te,this._queryCellCircle,ie,{hitTest:S,circle:{x:o,y:f,radius:x},seenUids:{box:{},circle:{}}},k),S?ie.length>0:ie}query(o,f,x,S,k){return this._query(o,f,x,S,!1,k)}hitTest(o,f,x,S,k){return this._query(o,f,x,S,!0,k)}hitTestCircle(o,f,x,S){return this._queryCircle(o,f,x,!0,S)}_queryCell(o,f,x,S,k,O,V,G){const te=V.seenUids,ie=this.boxCells[k];if(ie!==null){const Te=this.bboxes;for(const Be of ie)if(!te.box[Be]){te.box[Be]=!0;const Le=4*Be;if(o<=Te[Le+2]&&f<=Te[Le+3]&&x>=Te[Le+0]&&S>=Te[Le+1]&&(!G||G(this.boxKeys[Be]))){if(V.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[Be],x1:Te[Le],y1:Te[Le+1],x2:Te[Le+2],y2:Te[Le+3]})}}}const ge=this.circleCells[k];if(ge!==null){const Te=this.circles;for(const Be of ge)if(!te.circle[Be]){te.circle[Be]=!0;const Le=3*Be;if(this._circleAndRectCollide(Te[Le],Te[Le+1],Te[Le+2],o,f,x,S)&&(!G||G(this.circleKeys[Be]))){if(V.hitTest)return O.push(!0),!0;{const Re=Te[Le],Pe=Te[Le+1],ze=Te[Le+2];O.push({key:this.circleKeys[Be],x1:Re-ze,y1:Pe-ze,x2:Re+ze,y2:Pe+ze})}}}}}_queryCellCircle(o,f,x,S,k,O,V,G){const te=V.circle,ie=V.seenUids,ge=this.boxCells[k];if(ge!==null){const Be=this.bboxes;for(const Le of ge)if(!ie.box[Le]){ie.box[Le]=!0;const Re=4*Le;if(this._circleAndRectCollide(te.x,te.y,te.radius,Be[Re+0],Be[Re+1],Be[Re+2],Be[Re+3])&&(!G||G(this.boxKeys[Le])))return O.push(!0),!0}}const Te=this.circleCells[k];if(Te!==null){const Be=this.circles;for(const Le of Te)if(!ie.circle[Le]){ie.circle[Le]=!0;const Re=3*Le;if(this._circlesCollide(Be[Re],Be[Re+1],Be[Re+2],te.x,te.y,te.radius)&&(!G||G(this.circleKeys[Le])))return O.push(!0),!0}}}_forEachCell(o,f,x,S,k,O,V,G){const te=this._convertToXCellCoord(o),ie=this._convertToYCellCoord(f),ge=this._convertToXCellCoord(x),Te=this._convertToYCellCoord(S);for(let Be=te;Be<=ge;Be++)for(let Le=ie;Le<=Te;Le++)if(k.call(this,o,f,x,S,this.xCellCount*Le+Be,O,V,G))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,f,x,S,k,O){const V=S-o,G=k-f,te=x+O;return te*te>V*V+G*G}_circleAndRectCollide(o,f,x,S,k,O,V){const G=(O-S)/2,te=Math.abs(o-(S+G));if(te>G+x)return!1;const ie=(V-k)/2,ge=Math.abs(f-(k+ie));if(ge>ie+x)return!1;if(te<=G||ge<=ie)return!0;const Te=te-G,Be=ge-ie;return Te*Te+Be*Be<=x*x}}const ao=Math.tan(85*Math.PI/180);function $r(_,o,f,x,S,k,O){const V=i.create();if(f)if(k.name==="globe"){const G=i.calculateGlobeLabelMatrix(S,o);i.multiply(V,V,G)}else{const G=gt([],O);V[0]=G[0],V[1]=G[1],V[4]=G[2],V[5]=G[3],x||i.rotateZ(V,V,S.angle)}else i.multiply(V,S.labelPlaneMatrix,_);return V}function el(_,o,f,x,S,k,O){const V=$r(_,o,f,x,S,k,O);return k.name==="globe"&&f||(V[2]=V[6]=V[10]=V[14]=0),V}function Sc(_,o,f,x,S,k,O){if(f){if(k.name==="globe"){const V=$r(_,o,f,x,S,k,O);return i.invert(V,V),i.multiply(V,_,V),V}{const V=i.clone(_),G=i.identity([]);return G[0]=O[0],G[1]=O[1],G[4]=O[2],G[5]=O[3],i.multiply(V,V,G),x||i.rotateZ(V,V,-S.angle),V}}return S.glCoordMatrix}function Wn(_,o,f,x){const S=[_,o,f,1];f?i.transformMat4$1(S,S,x):eo(S,S,x);const k=S[3];return S[0]/=k,S[1]/=k,S[2]/=k,S}function Fi(_,o){return Math.min(.5+_/o*.5,1.5)}function Jn(_,o){const f=_[0]/_[3],x=_[1]/_[3];return f>=-o[0]&&f<=o[0]&&x>=-o[1]&&x<=o[1]}function Xn(_,o,f,x,S,k,O,V,G,te){const ie=f.transform,ge=x?_.textSizeData:_.iconSizeData,Te=i.evaluateSizeForZoom(ge,f.transform.zoom),Be=ie.projection.name==="globe",Le=[256/f.width*2+1,256/f.height*2+1],Re=x?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;Re.clear();let Pe=null;Be&&(Pe=x?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const ze=_.lineVertexArray,Ne=x?_.text.placedSymbolArray:_.icon.placedSymbolArray,Fe=f.transform.width/f.transform.height;let et,ut=!1;for(let lt=0;lt<Ne.length;lt++){const yt=Ne.get(lt),{numGlyphs:$t,writingMode:Dt}=yt;if(Dt!==i.WritingMode.vertical||ut||et===i.WritingMode.horizontal||(ut=!0),et=Dt,(yt.hidden||Dt===i.WritingMode.vertical)&&!ut){ns($t,Re);continue}ut=!1;const Et=new i.pointGeometry(yt.tileAnchorX,yt.tileAnchorY);let{x:bi,y:wt,z:ei}=ie.projection.projectTilePoint(Et.x,Et.y,te.canonical);if(G){const[vn,rn,Cn]=G(Et);bi+=vn,wt+=rn,ei+=Cn}const qt=[bi,wt,ei,1];if(i.transformMat4$1(qt,qt,o),!Jn(qt,Le)){ns($t,Re);continue}const pi=Fi(f.transform.cameraToCenterDistance,qt[3]),Gt=i.evaluateSizeForFeature(ge,Te,yt),ai=O?Gt/pi:Gt*pi,Ti=Wn(bi,wt,ei,S);if(Ti[3]<=0){ns($t,Re);continue}let St={};const Zt=O?null:G,sn=Hn(yt,ai,!1,V,o,S,k,_.glyphOffsetArray,ze,Re,Pe,Ti,Et,St,Fe,Zt,ie.projection,te,O);ut=sn.useVertical,Zt&&sn.needsFlipping&&(St={}),(sn.notEnoughRoom||ut||sn.needsFlipping&&Hn(yt,ai,!0,V,o,S,k,_.glyphOffsetArray,ze,Re,Pe,Ti,Et,St,Fe,Zt,ie.projection,te,O).notEnoughRoom)&&ns($t,Re)}x?(_.text.dynamicLayoutVertexBuffer.updateData(Re),Pe&&_.text.globeExtVertexBuffer.updateData(Pe)):(_.icon.dynamicLayoutVertexBuffer.updateData(Re),Pe&&_.icon.globeExtVertexBuffer.updateData(Pe))}function la(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re){const{lineStartIndex:Pe,glyphStartIndex:ze,segment:Ne}=V,Fe=ze+V.numGlyphs,et=Pe+V.lineLength,ut=o.getoffsetX(ze),lt=o.getoffsetX(Fe-1),yt=il(_*ut,f,x,S,k,O,Ne,Pe,et,G,te,ie,ge,Te,!0,Be,Le,Re);if(!yt)return null;const $t=il(_*lt,f,x,S,k,O,Ne,Pe,et,G,te,ie,ge,Te,!0,Be,Le,Re);return $t?{first:yt,last:$t}:null}function tl(_,o,f,x){return _===i.WritingMode.horizontal&&Math.abs(x)>Math.abs(f)?{useVertical:!0}:_===i.WritingMode.vertical?x>0?{needsFlipping:!0}:null:o!==0&&function(S,k){return S===0||Math.abs(k/S)>ao}(f,x)?o===1?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function Hn(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re,Pe,ze,Ne){const Fe=o/24,et=_.lineOffsetX*Fe,ut=_.lineOffsetY*Fe,{lineStartIndex:lt,glyphStartIndex:yt,numGlyphs:$t,segment:Dt,writingMode:Et,flipState:bi}=_,wt=lt+_.lineLength,ei=qt=>{if(ie){const[Ti,St,Zt]=qt.up,sn=te.length;i.updateGlobeVertexNormal(ie,sn+0,Ti,St,Zt),i.updateGlobeVertexNormal(ie,sn+1,Ti,St,Zt),i.updateGlobeVertexNormal(ie,sn+2,Ti,St,Zt),i.updateGlobeVertexNormal(ie,sn+3,Ti,St,Zt)}const[pi,Gt,ai]=qt.point;i.addDynamicAttributes(te,pi,Gt,ai,qt.angle)};if($t>1){const qt=la(Fe,V,et,ut,f,ge,Te,_,G,k,Be,Re,!1,Pe,ze,Ne);if(!qt)return{notEnoughRoom:!0};if(x&&!f){let[pi,Gt,ai]=qt.first.point,[Ti,St,Zt]=qt.last.point;[pi,Gt]=Wn(pi,Gt,ai,O),[Ti,St]=Wn(Ti,St,Zt,O);const sn=tl(Et,bi,(Ti-pi)*Le,St-Gt);if(_.flipState=sn&&sn.needsFlipping?1:2,sn)return sn}ei(qt.first);for(let pi=yt+1;pi<yt+$t-1;pi++){const Gt=il(Fe*V.getoffsetX(pi),et,ut,f,ge,Te,Dt,lt,wt,G,k,Be,Re,!1,!1,Pe,ze,Ne);if(!Gt)return te.length-=4*(pi-yt),{notEnoughRoom:!0};ei(Gt)}ei(qt.last)}else{if(x&&!f){const pi=Wn(Te.x,Te.y,0,S),Gt=lt+Dt+1,ai=new i.pointGeometry(G.getx(Gt),G.gety(Gt)),Ti=Wn(ai.x,ai.y,0,S),St=Ti[3]>0?Ti:El(Te,ai,pi,1,S,void 0,Pe,ze.canonical),Zt=tl(Et,bi,(St[0]-pi[0])*Le,St[1]-pi[1]);if(_.flipState=Zt&&Zt.needsFlipping?1:2,Zt)return Zt}const qt=il(Fe*V.getoffsetX(yt),et,ut,f,ge,Te,Dt,lt,wt,G,k,Be,Re,!1,!1,Pe,ze,Ne);if(!qt)return{notEnoughRoom:!0};ei(qt)}return{}}function Tl(_,o,f,x,S){const{x:k,y:O,z:V}=x.projectTilePoint(_.x,_.y,o);if(!S)return Wn(k,O,V,f);const[G,te,ie]=S(_);return Wn(k+G,O+te,V+ie,f)}function El(_,o,f,x,S,k,O,V){const G=Tl(_.sub(o)._unit()._add(_),V,S,O,k);return i.sub(G,f,G),i.normalize(G,G),i.scaleAndAdd(G,f,G,x)}function il(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re,Pe,ze){const Ne=x?_-o:_+o;let Fe=Ne>0?1:-1,et=0;x&&(Fe*=-1,et=Math.PI),Fe<0&&(et+=Math.PI);let ut=V+O+(Fe>0?0:1)|0,lt=S,yt=S,$t=0,Dt=0;const Et=Math.abs(Ne),bi=[],wt=[];let ei=k,qt=ei;const pi=()=>El(qt,ei,yt,Et-$t+1,ie,Te,Re,Pe.canonical);for(;$t+Dt<=Et;){if(ut+=Fe,ut<V||ut>=G)return null;if(yt=lt,qt=ei,bi.push(yt),Be&&wt.push(qt),ei=new i.pointGeometry(te.getx(ut),te.gety(ut)),lt=ge[ut],!lt){const Cn=Tl(ei,Pe.canonical,ie,Re,Te);lt=Cn[3]>0?ge[ut]=Cn:pi()}$t+=Dt,Dt=i.distance(yt,lt)}Le&&Te&&(ge[ut]&&(lt=pi(),Dt=i.distance(yt,lt)),ge[ut]=lt);const Gt=(Et-$t)/Dt,ai=ei.sub(qt)._mult(Gt)._add(qt),Ti=i.sub([],lt,yt),St=i.scaleAndAdd([],yt,Ti,Gt);let Zt=[0,0,1],sn=Ti[0],vn=Ti[1];if(ze&&(Zt=Re.upVector(Pe.canonical,ai.x,ai.y),Zt[0]!==0||Zt[1]!==0||Zt[2]!==1)){const Cn=[Zt[2],0,-Zt[0]],Nn=i.cross([],Zt,Cn);i.normalize(Cn,Cn),i.normalize(Nn,Nn),sn=i.dot(Ti,Cn),vn=i.dot(Ti,Nn)}if(f){const Cn=i.cross([],Zt,Ti);i.normalize(Cn,Cn),i.scaleAndAdd(St,St,Cn,f*Fe)}const rn=et+Math.atan2(vn,sn);return bi.push(St),Be&&wt.push(ai),{point:St,angle:rn,path:bi,tilePath:wt,up:Zt}}function ns(_,o){const f=o.length,x=f+4*_;o.resize(x),o.float32.fill(-1/0,4*f,4*x)}function eo(_,o,f){const x=o[0],S=o[1];return _[0]=f[0]*x+f[4]*S+f[12],_[1]=f[1]*x+f[5]*S+f[13],_[3]=f[3]*x+f[7]*S+f[15],_}const ms=100;class nl{constructor(o,f,x=new Qr(o.width+200,o.height+200,25),S=new Qr(o.width+200,o.height+200,25)){this.transform=o,this.grid=x,this.ignoredGrid=S,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ms,this.screenBottomBoundary=o.height+ms,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=f}placeCollisionBox(o,f,x,S,k,O,V,G){let te=x.projectedAnchorX,ie=x.projectedAnchorY,ge=x.projectedAnchorZ;const Te=x.elevation,Be=x.tileID,Le=o.getProjection();if(Te&&Be){const[lt,yt,$t]=Le.upVector(Be.canonical,x.tileAnchorX,x.tileAnchorY),Dt=Le.upVectorScale(Be.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;te+=lt*Te*Dt,ie+=yt*Te*Dt,ge+=$t*Te*Dt}const Re=this.projectAndGetPerspectiveRatio(V,te,ie,ge,x.tileID,Le.name==="globe"||!!Te||this.transform.pitch>0,Le),Pe=O*Re.perspectiveRatio,ze=(x.x1*f+S.x-x.padding)*Pe+Re.point.x,Ne=(x.y1*f+S.y-x.padding)*Pe+Re.point.y,Fe=(x.x2*f+S.x+x.padding)*Pe+Re.point.x,et=(x.y2*f+S.y+x.padding)*Pe+Re.point.y,ut=Re.perspectiveRatio<=.55||Re.occluded;return!this.isInsideGrid(ze,Ne,Fe,et)||!k&&this.grid.hitTest(ze,Ne,Fe,et,G)||ut?{box:[],offscreen:!1,occluded:Re.occluded}:{box:[ze,Ne,Fe,et],offscreen:this.isOffscreen(ze,Ne,Fe,et),occluded:!1}}placeCollisionCircles(o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re){const Pe=[],ze=this.transform.elevation,Ne=o.getProjection(),Fe=ze?ze.getAtTileOffsetFunc(Re,this.transform.center.lat,this.transform.worldSize,Ne):null,et=new i.pointGeometry(x.tileAnchorX,x.tileAnchorY);let{x:ut,y:lt,z:yt}=Ne.projectTilePoint(et.x,et.y,Re.canonical);if(Fe){const[ai,Ti,St]=Fe(et);ut+=ai,lt+=Ti,yt+=St}const $t=Ne.name==="globe",Dt=this.projectAndGetPerspectiveRatio(V,ut,lt,yt,Re,$t||!!ze||this.transform.pitch>0,Ne),{perspectiveRatio:Et}=Dt,bi=(ge?O/Et:O*Et)/i.ONE_EM,wt=Wn(ut,lt,yt,G),ei=Dt.signedDistanceFromCamera>0?la(bi,k,x.lineOffsetX*bi,x.lineOffsetY*bi,!1,wt,et,x,S,G,{},ze&&!ge?Fe:null,ge&&!!ze,Ne,Re,ge):null;let qt=!1,pi=!1,Gt=!0;if(ei&&!Dt.occluded){const ai=.5*Be*Et+Le,Ti=new i.pointGeometry(-100,-100),St=new i.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Zt=new Fn,{first:sn,last:vn}=ei,rn=sn.path.length;let Cn=[];for(let Yi=rn-1;Yi>=1;Yi--)Cn.push(sn.path[Yi]);for(let Yi=1;Yi<vn.path.length;Yi++)Cn.push(vn.path[Yi]);const Nn=2.5*ai;te&&(Cn=Cn.map(([Yi,br,Ir],Ar)=>(Fe&&!$t&&(Ir=Fe(Ar<rn-1?sn.tilePath[rn-1-Ar]:vn.tilePath[Ar-rn+2])[2]),Wn(Yi,br,Ir,te))),Cn.some(Yi=>Yi[3]<=0)&&(Cn=[]));let gn=[];if(Cn.length>0){let Yi=1/0,br=-1/0,Ir=1/0,Ar=-1/0;for(const Mr of Cn)Yi=Math.min(Yi,Mr[0]),Ir=Math.min(Ir,Mr[1]),br=Math.max(br,Mr[0]),Ar=Math.max(Ar,Mr[1]);br>=Ti.x&&Yi<=St.x&&Ar>=Ti.y&&Ir<=St.y&&(gn=[Cn.map(Mr=>new i.pointGeometry(Mr[0],Mr[1]))],(Yi<Ti.x||br>St.x||Ir<Ti.y||Ar>St.y)&&(gn=i.clipLine(gn,Ti.x,Ti.y,St.x,St.y)))}for(const Yi of gn){Zt.reset(Yi,.25*ai);let br=0;br=Zt.length<=.5*ai?1:Math.ceil(Zt.paddedLength/Nn)+1;for(let Ir=0;Ir<br;Ir++){const Ar=Ir/Math.max(br-1,1),Mr=Zt.lerp(Ar),Ts=Mr.x+ms,Ea=Mr.y+ms;Pe.push(Ts,Ea,ai,0);const Ws=Ts-ai,xo=Ea-ai,er=Ts+ai,Or=Ea+ai;if(Gt=Gt&&this.isOffscreen(Ws,xo,er,Or),pi=pi||this.isInsideGrid(Ws,xo,er,Or),!f&&this.grid.hitTestCircle(Ts,Ea,ai,Te)&&(qt=!0,!ie))return{circles:[],offscreen:!1,collisionDetected:qt,occluded:!1}}}}return{circles:!ie&&qt||!pi?[]:Pe,offscreen:Gt,collisionDetected:qt,occluded:Dt.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let x=1/0,S=1/0,k=-1/0,O=-1/0;for(const ie of o){const ge=new i.pointGeometry(ie.x+ms,ie.y+ms);x=Math.min(x,ge.x),S=Math.min(S,ge.y),k=Math.max(k,ge.x),O=Math.max(O,ge.y),f.push(ge)}const V=this.grid.query(x,S,k,O).concat(this.ignoredGrid.query(x,S,k,O)),G={},te={};for(const ie of V){const ge=ie.key;if(G[ge.bucketInstanceId]===void 0&&(G[ge.bucketInstanceId]={}),G[ge.bucketInstanceId][ge.featureIndex])continue;const Te=[new i.pointGeometry(ie.x1,ie.y1),new i.pointGeometry(ie.x2,ie.y1),new i.pointGeometry(ie.x2,ie.y2),new i.pointGeometry(ie.x1,ie.y2)];i.polygonIntersectsPolygon(f,Te)&&(G[ge.bucketInstanceId][ge.featureIndex]=!0,te[ge.bucketInstanceId]===void 0&&(te[ge.bucketInstanceId]=[]),te[ge.bucketInstanceId].push(ge.featureIndex))}return te}insertCollisionBox(o,f,x,S,k){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:S,collisionGroupID:k},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,f,x,S,k){const O=f?this.ignoredGrid:this.grid,V={bucketInstanceId:x,featureIndex:S,collisionGroupID:k};for(let G=0;G<o.length;G+=4)O.insertCircle(V,o[G],o[G+1],o[G+2])}projectAndGetPerspectiveRatio(o,f,x,S,k,O,V){const G=[f,x,S,1];let te=!1;if(S||this.transform.pitch>0){i.transformMat4$1(G,G,o);const ge=V.name==="globe";this.fogState&&k&&!ge&&(te=function(Be,Le,Re,Pe,ze,Ne){const Fe=Ne.calculateFogTileMatrix(ze),et=[Le,Re,Pe];return i.transformMat4(et,et,Fe),vi(Be,et,Ne.pitch,Ne._fov)}(this.fogState,f,x,S,k.toUnwrapped(),this.transform)>.9)}else eo(G,G,o);const ie=G[3];return{point:new i.pointGeometry((G[0]/ie+1)/2*this.transform.width+ms,(-G[1]/ie+1)/2*this.transform.height+ms),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(V)/ie*.5,1.5),signedDistanceFromCamera:ie,occluded:O&&G[2]>ie||te}}isOffscreen(o,f,x,S){return x<ms||o>=this.screenRightBoundary||S<ms||f>this.screenBottomBoundary}isInsideGrid(o,f,x,S){return x>=0&&o<this.gridRightBoundary&&S>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const o=i.identity([]);return i.translate(o,o,[-100,-100,0]),o}}function Ba(_,o,f){const x=o.createTileMatrix(_,_.worldSize,f.toUnwrapped());return i.multiply(new Float32Array(16),_.projMatrix,x)}function Sl(_,o,f){if(o.projection.name===f.projection.name)return _.projMatrix;const x=f.clone();return x.setProjection(o.projection),Ba(x,o.getProjection(),_)}function Cl(_,o,f){return o.name===f.projection.name?_.projMatrix:Ba(f,o,_)}class Il{constructor(o,f,x,S){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?f:-f))):S&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Ra{constructor(o,f,x,S,k,O=!1){this.text=new Il(o?o.text:null,f,x,k),this.icon=new Il(o?o.icon:null,f,S,k),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Al{constructor(o,f,x,S=!1){this.text=o,this.icon=f,this.skipFade=x,this.clipped=S}}class Ml{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class Hr{constructor(o,f,x,S,k){this.bucketInstanceId=o,this.featureIndex=f,this.sourceLayerIndex=x,this.bucketIndex=S,this.tileID=k}}class rs{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const f=++this.maxGroupID;this.collisionGroups[o]={ID:f,predicate:x=>x.collisionGroupID===f}}return this.collisionGroups[o]}}function ho(_,o,f,x,S){const{horizontalAlign:k,verticalAlign:O}=i.getAnchorAlignment(_),V=-(k-.5)*o,G=-(O-.5)*f,te=i.evaluateVariableOffset(_,x);return new i.pointGeometry(V+te[0]*S,G+te[1]*S)}function Cc(_,o,f,x,S){const k=new i.pointGeometry(_,o);return f&&k._rotate(x?S:-S),k}class bu{constructor(o,f,x,S,k){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new nl(this.transform,k),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new rs(x),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,f,x,S){const k=x.getBucket(f),O=x.latestFeatureIndex;if(!k||!O||f.id!==k.layerIds[0])return;const V=k.layers[0].layout,G=x.collisionBoxArray,te=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),ie=x.tileSize/i.EXTENT,ge=x.tileID.toUnwrapped();this.transform.setProjection(k.projection);const Te=(Be=x.tileID,Le=k.getProjection(),Re=this.transform,Le.name===this.projection?Re.calculateProjMatrix(Be.toUnwrapped()):Ba(Re,Le,Be));var Be,Le,Re;const Pe=V.get("text-pitch-alignment")==="map",ze=V.get("text-rotation-alignment")==="map";f.compileFilter();const Ne=f.dynamicFilter(),Fe=f.dynamicFilterNeedsFeature(),et=this.transform.calculatePixelsToTileUnitsMatrix(x),ut=el(Te,x.tileID.canonical,Pe,ze,this.transform,k.getProjection(),et);let lt=null;if(Pe){const Dt=Sc(Te,x.tileID.canonical,Pe,ze,this.transform,k.getProjection(),et);lt=i.multiply([],this.transform.labelPlaneMatrix,Dt)}let yt=null;Ne&&x.latestFeatureIndex&&(yt={unwrappedTileID:ge,dynamicFilter:Ne,dynamicFilterNeedsFeature:Fe,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[k.bucketInstanceId]=new Hr(k.bucketInstanceId,O,k.sourceLayerIndex,k.index,x.tileID);const $t={bucket:k,layout:V,posMatrix:Te,textLabelPlaneMatrix:ut,labelToScreenMatrix:lt,clippingData:yt,scale:te,textPixelRatio:ie,holdingForFade:x.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(k.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.evaluateSizeForZoom(k.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(S)for(const Dt of k.sortKeyRanges){const{sortKey:Et,symbolInstanceStart:bi,symbolInstanceEnd:wt}=Dt;o.push({sortKey:Et,symbolInstanceStart:bi,symbolInstanceEnd:wt,parameters:$t})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:$t})}attemptAnchorPlacement(o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re,Pe,ze,Ne){const{textOffset0:Fe,textOffset1:et,crossTileID:ut}=Te,lt=[Fe,et],yt=ho(o,x,S,lt,k),$t=this.collisionIndex.placeCollisionBox(Le,k,f,Cc(yt.x,yt.y,O,V,this.transform.angle),ge,G,te,ie.predicate);if(Pe){const Dt=Le.getSymbolInstanceIconSize(Ne,this.transform.zoom,Te.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Le,Dt,Pe,Cc(yt.x,yt.y,O,V,this.transform.angle),ge,G,te,ie.predicate).box.length===0)return}if($t.box.length>0){let Dt;return this.prevPlacement&&this.prevPlacement.variableOffsets[ut]&&this.prevPlacement.placements[ut]&&this.prevPlacement.placements[ut].text&&(Dt=this.prevPlacement.variableOffsets[ut].anchor),this.variableOffsets[ut]={textOffset:lt,width:x,height:S,anchor:o,textScale:k,prevAnchor:Dt},this.markUsedJustification(Le,o,Te,Re),Le.allowVerticalPlacement&&(this.markUsedOrientation(Le,Re,Te),this.placedOrientations[ut]=Re),{shift:yt,placedGlyphBoxes:$t}}}placeLayerBucketPart(o,f,x,S){const{bucket:k,layout:O,posMatrix:V,textLabelPlaneMatrix:G,labelToScreenMatrix:te,clippingData:ie,textPixelRatio:ge,holdingForFade:Te,collisionBoxArray:Be,partiallyEvaluatedTextSize:Le,partiallyEvaluatedIconSize:Re,collisionGroup:Pe}=o.parameters,ze=O.get("text-optional"),Ne=O.get("icon-optional"),Fe=O.get("text-allow-overlap"),et=O.get("icon-allow-overlap"),ut=O.get("text-rotation-alignment")==="map",lt=O.get("text-pitch-alignment")==="map",yt=O.get("icon-text-fit")!=="none",$t=O.get("symbol-z-order")==="viewport-y";this.transform.setProjection(k.projection);let Dt=Fe&&(et||!k.hasIconData()||Ne),Et=et&&(Fe||!k.hasTextData()||ze);!k.collisionArrays&&Be&&k.deserializeCollisionBoxes(Be),x&&S&&k.updateCollisionDebugBuffers(this.transform.zoom,Be);const bi=(wt,ei,qt)=>{const{crossTileID:pi,numVerticalGlyphVertices:Gt}=wt;if(ie){const er={zoom:this.transform.zoom,pitch:this.transform.pitch};let Or=null;if(ie.dynamicFilterNeedsFeature){const _r=this.retainedQueryData[k.bucketInstanceId];Or=ie.featureIndex.loadFeature({featureIndex:wt.featureIndex,bucketIndex:_r.bucketIndex,sourceLayerIndex:_r.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,ie.dynamicFilter)(er,Or,this.retainedQueryData[k.bucketInstanceId].tileID.canonical,new i.pointGeometry(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(ie.unwrappedTileID)))return this.placements[pi]=new Al(!1,!1,!1,!0),void(f[pi]=!0)}if(f[pi])return;if(Te)return void(this.placements[pi]=new Al(!1,!1,!1));let ai=!1,Ti=!1,St=!0,Zt=!1,sn=!1,vn=null,rn={box:null,offscreen:null,occluded:null},Cn={box:null,offscreen:null,occluded:null},Nn=null,gn=null,Yi=null,br=0,Ir=0,Ar=0;qt.textFeatureIndex?br=qt.textFeatureIndex:wt.useRuntimeCollisionCircles&&(br=wt.featureIndex),qt.verticalTextFeatureIndex&&(Ir=qt.verticalTextFeatureIndex);const Mr=er=>{er.tileID=this.retainedQueryData[k.bucketInstanceId].tileID;const Or=this.transform.elevation;(Or||er.elevation)&&(er.elevation=Or?Or.getAtTileOffset(er.tileID,er.tileAnchorX,er.tileAnchorY):0)},Ts=qt.textBox;if(Ts){Mr(Ts);const er=_r=>{let Do=i.WritingMode.horizontal;if(k.allowVerticalPlacement&&!_r&&this.prevPlacement){const ss=this.prevPlacement.placedOrientations[pi];ss&&(this.placedOrientations[pi]=ss,Do=ss,this.markUsedOrientation(k,Do,wt))}return Do},Or=(_r,Do)=>{if(k.allowVerticalPlacement&&Gt>0&&qt.verticalTextBox){for(const ss of k.writingModes)if(ss===i.WritingMode.vertical?(rn=Do(),Cn=rn):rn=_r(),rn&&rn.box&&rn.box.length)break}else rn=_r()};if(O.get("text-variable-anchor")){let _r=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pi]){const Kr=this.prevPlacement.variableOffsets[pi];_r.indexOf(Kr.anchor)>0&&(_r=_r.filter(Ds=>Ds!==Kr.anchor),_r.unshift(Kr.anchor))}const Do=(Kr,Ds,_h)=>{const $a=k.getSymbolInstanceTextSize(Le,wt,this.transform.zoom,ei),Es=(Kr.x2-Kr.x1)*$a+2*Kr.padding,Sa=(Kr.y2-Kr.y1)*$a+2*Kr.padding,ml=yt&&!et?Ds:null;ml&&Mr(ml);let Ol={box:[],offscreen:!1,occluded:!1};const ju=Fe?2*_r.length:_r.length;for(let Gu=0;Gu<ju;++Gu){const ja=this.attemptAnchorPlacement(_r[Gu%_r.length],Kr,Es,Sa,$a,ut,lt,ge,V,Pe,Gu>=_r.length,wt,ei,k,_h,ml,Le,Re);if(ja&&(Ol=ja.placedGlyphBoxes,Ol&&Ol.box&&Ol.box.length)){ai=!0,vn=ja.shift;break}}return Ol};Or(()=>Do(Ts,qt.iconBox,i.WritingMode.horizontal),()=>{const Kr=qt.verticalTextBox;return Kr&&Mr(Kr),k.allowVerticalPlacement&&!(rn&&rn.box&&rn.box.length)&&Gt>0&&Kr?Do(Kr,qt.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),rn&&(ai=rn.box,St=rn.offscreen,Zt=rn.occluded);const ss=er(rn&&rn.box);if(!ai&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[pi];Kr&&(this.variableOffsets[pi]=Kr,this.markUsedJustification(k,Kr.anchor,wt,ss))}}else{const _r=(Do,ss)=>{const Kr=k.getSymbolInstanceTextSize(Le,wt,this.transform.zoom,ei),Ds=this.collisionIndex.placeCollisionBox(k,Kr,Do,new i.pointGeometry(0,0),Fe,ge,V,Pe.predicate);return Ds&&Ds.box&&Ds.box.length&&(this.markUsedOrientation(k,ss,wt),this.placedOrientations[pi]=ss),Ds};Or(()=>_r(Ts,i.WritingMode.horizontal),()=>{const Do=qt.verticalTextBox;return k.allowVerticalPlacement&&Gt>0&&Do?(Mr(Do),_r(Do,i.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),er(rn&&rn.box&&rn.box.length)}}if(Nn=rn,ai=Nn&&Nn.box&&Nn.box.length>0,St=Nn&&Nn.offscreen,Zt=Nn&&Nn.occluded,wt.useRuntimeCollisionCircles){const er=k.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),Or=i.evaluateSizeForFeature(k.textSizeData,Le,er),_r=O.get("text-padding");gn=this.collisionIndex.placeCollisionCircles(k,Fe,er,k.lineVertexArray,k.glyphOffsetArray,Or,V,G,te,x,lt,Pe.predicate,wt.collisionCircleDiameter*Or/i.ONE_EM,_r,this.retainedQueryData[k.bucketInstanceId].tileID),ai=Fe||gn.circles.length>0&&!gn.collisionDetected,St=St&&gn.offscreen,Zt=gn.occluded}if(qt.iconFeatureIndex&&(Ar=qt.iconFeatureIndex),qt.iconBox){const er=Or=>{Mr(Or);const _r=yt&&vn?Cc(vn.x,vn.y,ut,lt,this.transform.angle):new i.pointGeometry(0,0),Do=k.getSymbolInstanceIconSize(Re,this.transform.zoom,wt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(k,Do,Or,_r,et,ge,V,Pe.predicate)};Cn&&Cn.box&&Cn.box.length&&qt.verticalIconBox?(Yi=er(qt.verticalIconBox),Ti=Yi.box.length>0):(Yi=er(qt.iconBox),Ti=Yi.box.length>0),St=St&&Yi.offscreen,sn=Yi.occluded}const Ea=ze||wt.numHorizontalGlyphVertices===0&&Gt===0,Ws=Ne||wt.numIconVertices===0;if(Ea||Ws?Ws?Ea||(Ti=Ti&&ai):ai=Ti&&ai:Ti=ai=Ti&&ai,ai&&Nn&&Nn.box&&this.collisionIndex.insertCollisionBox(Nn.box,O.get("text-ignore-placement"),k.bucketInstanceId,Cn&&Cn.box&&Ir?Ir:br,Pe.ID),Ti&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,O.get("icon-ignore-placement"),k.bucketInstanceId,Ar,Pe.ID),gn&&(ai&&this.collisionIndex.insertCollisionCircles(gn.circles,O.get("text-ignore-placement"),k.bucketInstanceId,br,Pe.ID),x)){const er=k.bucketInstanceId;let Or=this.collisionCircleArrays[er];Or===void 0&&(Or=this.collisionCircleArrays[er]=new Ml);for(let _r=0;_r<gn.circles.length;_r+=4)Or.circles.push(gn.circles[_r+0]),Or.circles.push(gn.circles[_r+1]),Or.circles.push(gn.circles[_r+2]),Or.circles.push(gn.collisionDetected?1:0)}const xo=k.projection.name!=="globe";Dt=Dt&&(xo||!Zt),Et=Et&&(xo||!sn),this.placements[pi]=new Al(ai||Dt,Ti||Et,St||k.justReloaded),f[pi]=!0};if($t){const wt=k.getSortedSymbolIndexes(this.transform.angle);for(let ei=wt.length-1;ei>=0;--ei){const qt=wt[ei];bi(k.symbolInstances.get(qt),qt,k.collisionArrays[qt])}}else for(let wt=o.symbolInstanceStart;wt<o.symbolInstanceEnd;wt++)bi(k.symbolInstances.get(wt),wt,k.collisionArrays[wt]);if(x&&k.bucketInstanceId in this.collisionCircleArrays){const wt=this.collisionCircleArrays[k.bucketInstanceId];i.invert(wt.invProjMatrix,V),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(o,f,x,S){const{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:V,verticalPlacedTextSymbolIndex:G,crossTileID:te}=x,ie=i.getAnchorJustification(f),ge=S===i.WritingMode.vertical?G:ie==="left"?k:ie==="center"?O:ie==="right"?V:-1;k>=0&&(o.text.placedSymbolArray.get(k).crossTileID=ge>=0&&k!==ge?0:te),O>=0&&(o.text.placedSymbolArray.get(O).crossTileID=ge>=0&&O!==ge?0:te),V>=0&&(o.text.placedSymbolArray.get(V).crossTileID=ge>=0&&V!==ge?0:te),G>=0&&(o.text.placedSymbolArray.get(G).crossTileID=ge>=0&&G!==ge?0:te)}markUsedOrientation(o,f,x){const S=f===i.WritingMode.horizontal||f===i.WritingMode.horizontalOnly?f:0,k=f===i.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:V,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:te}=x,ie=o.text.placedSymbolArray;O>=0&&(ie.get(O).placedOrientation=S),V>=0&&(ie.get(V).placedOrientation=S),G>=0&&(ie.get(G).placedOrientation=S),te>=0&&(ie.get(te).placedOrientation=k)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let x=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const S=f?f.symbolFadeChange(o):1,k=f?f.opacities:{},O=f?f.variableOffsets:{},V=f?f.placedOrientations:{};for(const G in this.placements){const te=this.placements[G],ie=k[G];ie?(this.opacities[G]=new Ra(ie,S,te.text,te.icon,null,te.clipped),x=x||te.text!==ie.text.placed||te.icon!==ie.icon.placed):(this.opacities[G]=new Ra(null,S,te.text,te.icon,te.skipFade,te.clipped),x=x||te.text||te.icon)}for(const G in k){const te=k[G];if(!this.opacities[G]){const ie=new Ra(te,S,!1,!1);ie.isHidden()||(this.opacities[G]=ie,x=x||te.text.placed||te.icon.placed)}}for(const G in O)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=O[G]);for(const G in V)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=V[G]);x?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:o)}updateLayerOpacities(o,f){const x={};for(const S of f){const k=S.getBucket(o);k&&S.latestFeatureIndex&&o.id===k.layerIds[0]&&this.updateBucketOpacities(k,x,S.collisionBoxArray)}}updateBucketOpacities(o,f,x){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const S=o.layers[0].layout,k=!!o.layers[0].dynamicFilter(),O=new Ra(null,0,!1,!1,!0),V=S.get("text-allow-overlap"),G=S.get("icon-allow-overlap"),te=S.get("text-variable-anchor"),ie=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",Te=S.get("icon-text-fit")!=="none",Be=new Ra(null,0,V&&(G||!o.hasIconData()||S.get("icon-optional")),G&&(V||!o.hasTextData()||S.get("text-optional")),!0);!o.collisionArrays&&x&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(x);const Le=(Pe,ze,Ne)=>{for(let Fe=0;Fe<ze/4;Fe++)Pe.opacityVertexArray.emplaceBack(Ne)};let Re=0;for(let Pe=0;Pe<o.symbolInstances.length;Pe++){const ze=o.symbolInstances.get(Pe),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:Fe,crossTileID:et,numIconVertices:ut}=ze;let lt=this.opacities[et];f[et]?lt=O:lt||(lt=Be,this.opacities[et]=lt),f[et]=!0;const yt=Ne>0||Fe>0,$t=ut>0,Dt=this.placedOrientations[et],Et=Dt===i.WritingMode.vertical,bi=Dt===i.WritingMode.horizontal||Dt===i.WritingMode.horizontalOnly;if(!yt&&!$t||lt.isHidden()||Re++,yt){const wt=Bn(lt.text);Le(o.text,Ne,Et?Jl:wt),Le(o.text,Fe,bi?Jl:wt);const ei=lt.text.isHidden(),{leftJustifiedTextSymbolIndex:qt,centerJustifiedTextSymbolIndex:pi,rightJustifiedTextSymbolIndex:Gt,verticalPlacedTextSymbolIndex:ai}=ze,Ti=o.text.placedSymbolArray,St=ei||Et?1:0;qt>=0&&(Ti.get(qt).hidden=St),pi>=0&&(Ti.get(pi).hidden=St),Gt>=0&&(Ti.get(Gt).hidden=St),ai>=0&&(Ti.get(ai).hidden=ei||bi?1:0);const Zt=this.variableOffsets[et];Zt&&this.markUsedJustification(o,Zt.anchor,ze,Dt);const sn=this.placedOrientations[et];sn&&(this.markUsedJustification(o,"left",ze,sn),this.markUsedOrientation(o,sn,ze))}if($t){const wt=Bn(lt.icon),{placedIconSymbolIndex:ei,verticalPlacedIconSymbolIndex:qt}=ze,pi=o.icon.placedSymbolArray,Gt=lt.icon.isHidden()?1:0;ei>=0&&(Le(o.icon,ut,Et?Jl:wt),pi.get(ei).hidden=Gt),qt>=0&&(Le(o.icon,ze.numVerticalIconVertices,bi?Jl:wt),pi.get(qt).hidden=Gt)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const wt=o.collisionArrays[Pe];if(wt){let ei=new i.pointGeometry(0,0),qt=!0;if(wt.textBox||wt.verticalTextBox){if(te){const Gt=this.variableOffsets[et];Gt?(ei=ho(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textScale),ie&&ei._rotate(ge?this.transform.angle:-this.transform.angle)):qt=!1}k&&(qt=!lt.clipped),wt.textBox&&Vo(o.textCollisionBox.collisionVertexArray,lt.text.placed,!qt||Et,ei.x,ei.y),wt.verticalTextBox&&Vo(o.textCollisionBox.collisionVertexArray,lt.text.placed,!qt||bi,ei.x,ei.y)}const pi=qt&&Boolean(!bi&&wt.verticalIconBox);wt.iconBox&&Vo(o.iconCollisionBox.collisionVertexArray,lt.icon.placed,pi,Te?ei.x:0,Te?ei.y:0),wt.verticalIconBox&&Vo(o.iconCollisionBox.collisionVertexArray,lt.icon.placed,!pi,Te?ei.x:0,Te?ei.y:0)}}}if(o.fullyClipped=Re===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Pe.invProjMatrix,o.placementViewportMatrix=Pe.viewportMatrix,o.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,f){const x=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*x>o}setStale(){this.stale=!0}}function Vo(_,o,f,x,S){_.emplaceBack(o?1:0,f?1:0,x||0,S||0),_.emplaceBack(o?1:0,f?1:0,x||0,S||0),_.emplaceBack(o?1:0,f?1:0,x||0,S||0),_.emplaceBack(o?1:0,f?1:0,x||0,S||0)}const Us=Math.pow(2,25),Rd=Math.pow(2,24),lh=Math.pow(2,17),Io=Math.pow(2,16),Kl=Math.pow(2,9),wu=Math.pow(2,8),Yl=Math.pow(2,1);function Bn(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const o=_.placed?1:0,f=Math.floor(127*_.opacity);return f*Us+o*Rd+f*lh+o*Io+f*Kl+o*wu+f*Yl+o}const Jl=0;class Vh{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,f,x,S,k){const O=this._bucketParts;for(;this._currentTileIndex<o.length;)if(f.getBucketParts(O,S,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((V,G)=>V.sortKey-G.sortKey));this._currentPartIndex<O.length;){const V=O[this._currentPartIndex];if(f.placeLayerBucketPart(V,this._seenCrossTileIDs,x,V.symbolInstanceStart===0),this._currentPartIndex++,k())return!0}return!1}}class $s{constructor(o,f,x,S,k,O,V,G){this.placement=new bu(o,k,O,V,G),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(o,f,x){const S=i.exported.now(),k=()=>{const O=i.exported.now()-S;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=f[o[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=V)&&(!O.maxzoom||O.maxzoom>V)){if(this._inProgressLayer||(this._inProgressLayer=new Vh(O)),this._inProgressLayer.continuePlacement(x[O.source],this.placement,this._showCollisionBoxes,O,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const rl=512/i.EXTENT/2;class Tu{constructor(o,f,x){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let S=0;S<f.length;S++){const k=f.get(S),O=k.key;this.indexedSymbolInstances[O]||(this.indexedSymbolInstances[O]=[]),this.indexedSymbolInstances[O].push({crossTileID:k.crossTileID,coord:this.getScaledCoordinates(k,o)})}}getScaledCoordinates(o,f){const x=rl/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*i.EXTENT+o.tileAnchorX)*x),y:Math.floor((f.canonical.y*i.EXTENT+o.tileAnchorY)*x)}}findMatches(o,f,x){const S=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let k=0;k<o.length;k++){const O=o.get(k);if(O.crossTileID)continue;const V=this.indexedSymbolInstances[O.key];if(!V)continue;const G=this.getScaledCoordinates(O,f);for(const te of V)if(Math.abs(te.coord.x-G.x)<=S&&Math.abs(te.coord.y-G.y)<=S&&!x[te.crossTileID]){x[te.crossTileID]=!0,O.crossTileID=te.crossTileID;break}}}}class js{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Eu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const f=Math.round((o-this.lng)/360);if(f!==0)for(const x in this.indexes){const S=this.indexes[x],k={};for(const O in S){const V=S[O];V.tileID=V.tileID.unwrapTo(V.tileID.wrap+f),k[V.tileID.key]=V}this.indexes[x]=k}this.lng=o}addBucket(o,f,x){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let k=0;k<f.symbolInstances.length;k++)f.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const S=this.usedCrossTileIDs[o.overscaledZ];for(const k in this.indexes){const O=this.indexes[k];if(Number(k)>o.overscaledZ)for(const V in O){const G=O[V];G.tileID.isChildOf(o)&&G.findMatches(f.symbolInstances,o,S)}else{const V=O[o.scaledTo(Number(k)).key];V&&V.findMatches(f.symbolInstances,o,S)}}for(let k=0;k<f.symbolInstances.length;k++){const O=f.symbolInstances.get(k);O.crossTileID||(O.crossTileID=x.generate(),S[O.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Tu(o,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(o,f){for(const x in f.indexedSymbolInstances)for(const S of f.indexedSymbolInstances[x])delete this.usedCrossTileIDs[o][S.crossTileID]}removeStaleBuckets(o){let f=!1;for(const x in this.indexes){const S=this.indexes[x];for(const k in S)o[S[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,S[k]),delete S[k],f=!0)}return f}}class Oa{constructor(){this.layerIndexes={},this.crossTileIDs=new js,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,f,x,S){let k=this.layerIndexes[o.id];k===void 0&&(k=this.layerIndexes[o.id]=new Eu);let O=!1;const V={};S.name!=="globe"&&k.handleWrapJump(x);for(const G of f){const te=G.getBucket(o);te&&o.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),k.addBucket(G.tileID,te,this.crossTileIDs)&&(O=!0),V[te.bucketInstanceId]=!0)}return k.removeStaleBuckets(V)&&(O=!0),O}pruneUnusedLayers(o){const f={};o.forEach(x=>{f[x]=!0});for(const x in this.layerIndexes)f[x]||delete this.layerIndexes[x]}}const Ql=(_,o)=>i.emitValidationErrors(_,o&&o.filter(f=>f.identifier!=="source.canvas")),ch=i.pick(ri,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),kl=i.pick(ri,["setCenter","setZoom","setBearing","setPitch"]),ya={version:8,layers:[],sources:{}},Ic={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Zo extends i.Evented{constructor(o,f={}){super(),this.map=o,this.dispatcher=new Er(Bt(),this),this.imageManager=new Ut,this.imageManager.setEventedParent(this),this.glyphManager=new i.GlyphManager(o._requestManager,f.localFontFamily?i.LocalGlyphMode.all:f.localIdeographFontFamily?i.LocalGlyphMode.ideographs:i.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Oa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());const x=this;this._rtlTextPluginCallback=Zo.registerForPluginStateChange(S=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},(k,O)=>{if(i.triggerPluginCompletionEvent(k),O&&O.every(V=>V))for(const V in x._sourceCaches){const G=x._sourceCaches[V],te=G.getSource().type;te!=="vector"&&te!=="geojson"||G.reload()}})}),this.on("data",S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const k=this.getSource(S.sourceId);if(k&&k.vectorLayerIds)for(const O in this._layers){const V=this._layers[O];V.source===k.id&&this._validateLayer(V)}})}loadURL(o,f={}){this.fire(new i.Event("dataloading",{dataType:"style"}));const x=typeof f.validate=="boolean"?f.validate:!i.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,f.accessToken);const S=this.map._requestManager.transformRequest(o,i.ResourceType.Style);this._request=i.getJSON(S,(k,O)=>{this._request=null,k?this.fire(new i.ErrorEvent(k)):O&&this._load(O,x)})}loadJSON(o,f={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(o,f.validate!==!1)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(ya,!1)}_updateLayerCount(o,f){const x=f?1:-1;o.is3D()&&(this._num3DLayers+=x),o.type==="circle"&&(this._numCircleLayers+=x),o.type==="symbol"&&(this._numSymbolLayers+=x)}_load(o,f){if(f&&Ql(this,i.validateStyle(o)))return;this._loaded=!0,this.stylesheet=i.clone$1(o),this._updateMapProjection();for(const S in o.sources)this.addSource(S,o.sources[S],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const x=Ci(this.stylesheet.layers);this._order=x.map(S=>S.id),this._layers={},this._serializedLayers={};for(let S of x)S=i.createStyleLayer(S),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Nt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(o){this._spriteRequest=function(f,x,S){let k,O,V;const G=i.exported.devicePixelRatio>1?"@2x":"";let te=i.getJSON(x.transformRequest(x.normalizeSpriteURL(f,G,".json"),i.ResourceType.SpriteJSON),(Te,Be)=>{te=null,V||(V=Te,k=Be,ge())}),ie=i.getImage(x.transformRequest(x.normalizeSpriteURL(f,G,".png"),i.ResourceType.SpriteImage),(Te,Be)=>{ie=null,V||(V=Te,O=Be,ge())});function ge(){if(V)S(V);else if(k&&O){const Te=i.exported.getImageData(O),Be={};for(const Le in k){const{width:Re,height:Pe,x:ze,y:Ne,sdf:Fe,pixelRatio:et,stretchX:ut,stretchY:lt,content:yt}=k[Le],$t=new i.RGBAImage({width:Re,height:Pe});i.RGBAImage.copy(Te,$t,{x:ze,y:Ne},{x:0,y:0},{width:Re,height:Pe}),Be[Le]={data:$t,pixelRatio:et,sdf:Fe,stretchX:ut,stretchY:lt,content:yt}}S(null,Be)}}return{cancel(){te&&(te.cancel(),te=null),ie&&(ie.cancel(),ie=null)}}}(o,this.map._requestManager,(f,x)=>{if(this._spriteRequest=null,f)this.fire(new i.ErrorEvent(f));else if(x)for(const S in x)this.imageManager.addImage(S,x[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(o){const f=this.getSource(o.source);if(!f)return;const x=o.sourceLayer;x&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(x)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${f.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const f=[];for(const x of o){const S=this._layers[x];S.type!=="custom"&&f.push(S.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&Ic[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const f=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(S.length||k.length)&&this._updateWorkerLayers(S,k);for(const O in this._updatedSources){const V=this._updatedSources[O];V==="reload"?this._reloadSource(O):V==="clear"&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const x={};for(const S in this._sourceCaches){const k=this._sourceCaches[S];x[S]=k.used,k.used=!1}for(const S of this._order){const k=this._layers[S];if(k.recalculate(o,this._availableImages),!k.isHidden(o.zoom)){const V=this._getLayerSourceCache(k);V&&(V.used=!0)}const O=this.map.painter;if(O){const V=k.getProgramIds();if(!V)continue;const G=k.getProgramConfiguration(o.zoom);for(const te of V)O.useProgram(te,G)}}for(const S in x){const k=this._sourceCaches[S];x[S]!==k.used&&k.getSource().fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Ql(this,i.validateStyle(o)))return!1;(o=i.clone$1(o)).layers=Ci(o.layers);const f=function(S,k){if(!S)return[{command:ri.setStyle,args:[k]}];let O=[];try{if(!F(S.version,k.version))return[{command:ri.setStyle,args:[k]}];F(S.center,k.center)||O.push({command:ri.setCenter,args:[k.center]}),F(S.zoom,k.zoom)||O.push({command:ri.setZoom,args:[k.zoom]}),F(S.bearing,k.bearing)||O.push({command:ri.setBearing,args:[k.bearing]}),F(S.pitch,k.pitch)||O.push({command:ri.setPitch,args:[k.pitch]}),F(S.sprite,k.sprite)||O.push({command:ri.setSprite,args:[k.sprite]}),F(S.glyphs,k.glyphs)||O.push({command:ri.setGlyphs,args:[k.glyphs]}),F(S.transition,k.transition)||O.push({command:ri.setTransition,args:[k.transition]}),F(S.light,k.light)||O.push({command:ri.setLight,args:[k.light]}),F(S.fog,k.fog)||O.push({command:ri.setFog,args:[k.fog]}),F(S.projection,k.projection)||O.push({command:ri.setProjection,args:[k.projection]});const V={},G=[];(function(ge,Te,Be,Le){let Re;for(Re in Te=Te||{},ge=ge||{})ge.hasOwnProperty(Re)&&(Te.hasOwnProperty(Re)||Gi(Re,Be,Le));for(Re in Te)Te.hasOwnProperty(Re)&&(ge.hasOwnProperty(Re)?F(ge[Re],Te[Re])||(ge[Re].type==="geojson"&&Te[Re].type==="geojson"&&Zn(ge,Te,Re)?Be.push({command:ri.setGeoJSONSourceData,args:[Re,Te[Re].data]}):_n(Re,Te,Be,Le)):xi(Re,Te,Be))})(S.sources,k.sources,G,V);const te=[];S.layers&&S.layers.forEach(ge=>{ge.source&&V[ge.source]?O.push({command:ri.removeLayer,args:[ge.id]}):te.push(ge)});let ie=S.terrain;ie&&V[ie.source]&&(O.push({command:ri.setTerrain,args:[void 0]}),ie=void 0),O=O.concat(G),F(ie,k.terrain)||O.push({command:ri.setTerrain,args:[k.terrain]}),function(ge,Te,Be){Te=Te||[];const Le=(ge=ge||[]).map(Mt),Re=Te.map(Mt),Pe=ge.reduce(Gn,{}),ze=Te.reduce(Gn,{}),Ne=Le.slice(),Fe=Object.create(null);let et,ut,lt,yt,$t,Dt,Et;for(et=0,ut=0;et<Le.length;et++)lt=Le[et],ze.hasOwnProperty(lt)?ut++:(Be.push({command:ri.removeLayer,args:[lt]}),Ne.splice(Ne.indexOf(lt,ut),1));for(et=0,ut=0;et<Re.length;et++)lt=Re[Re.length-1-et],Ne[Ne.length-1-et]!==lt&&(Pe.hasOwnProperty(lt)?(Be.push({command:ri.removeLayer,args:[lt]}),Ne.splice(Ne.lastIndexOf(lt,Ne.length-ut),1)):ut++,Dt=Ne[Ne.length-et],Be.push({command:ri.addLayer,args:[ze[lt],Dt]}),Ne.splice(Ne.length-et,0,lt),Fe[lt]=!0);for(et=0;et<Re.length;et++)if(lt=Re[et],yt=Pe[lt],$t=ze[lt],!Fe[lt]&&!F(yt,$t))if(F(yt.source,$t.source)&&F(yt["source-layer"],$t["source-layer"])&&F(yt.type,$t.type)){for(Et in xn(yt.layout,$t.layout,Be,lt,null,ri.setLayoutProperty),xn(yt.paint,$t.paint,Be,lt,null,ri.setPaintProperty),F(yt.filter,$t.filter)||Be.push({command:ri.setFilter,args:[lt,$t.filter]}),F(yt.minzoom,$t.minzoom)&&F(yt.maxzoom,$t.maxzoom)||Be.push({command:ri.setLayerZoomRange,args:[lt,$t.minzoom,$t.maxzoom]}),yt)yt.hasOwnProperty(Et)&&Et!=="layout"&&Et!=="paint"&&Et!=="filter"&&Et!=="metadata"&&Et!=="minzoom"&&Et!=="maxzoom"&&(Et.indexOf("paint.")===0?xn(yt[Et],$t[Et],Be,lt,Et.slice(6),ri.setPaintProperty):F(yt[Et],$t[Et])||Be.push({command:ri.setLayerProperty,args:[lt,Et,$t[Et]]}));for(Et in $t)$t.hasOwnProperty(Et)&&!yt.hasOwnProperty(Et)&&Et!=="layout"&&Et!=="paint"&&Et!=="filter"&&Et!=="metadata"&&Et!=="minzoom"&&Et!=="maxzoom"&&(Et.indexOf("paint.")===0?xn(yt[Et],$t[Et],Be,lt,Et.slice(6),ri.setPaintProperty):F(yt[Et],$t[Et])||Be.push({command:ri.setLayerProperty,args:[lt,Et,$t[Et]]}))}else Be.push({command:ri.removeLayer,args:[lt]}),Dt=Ne[Ne.lastIndexOf(lt)+1],Be.push({command:ri.addLayer,args:[$t,Dt]})}(te,k.layers,O)}catch(V){console.warn("Unable to compute style diff:",V),O=[{command:ri.setStyle,args:[k]}]}return O}(this.serialize(),o).filter(S=>!(S.command in kl));if(f.length===0)return!1;const x=f.filter(S=>!(S.command in ch));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);return f.forEach(S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,f){return this.getImage(o)?this.fire(new i.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,f),this._afterImageUpdated(o),this)}updateImage(o,f){this.imageManager.updateImage(o,f)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new i.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,f,x={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(i.validateSource,`sources.${o}`,f,null,x))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const S=ee(o,f,this.dispatcher,this);S.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:S.serialize(),sourceId:o}));const k=O=>{const V=(O?"symbol:":"other:")+o,G=this._sourceCaches[V]=new i.SourceCache(V,S,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[o]=G,G.style=this,G.onAdd(this.map)};k(!1),f.type!=="vector"&&f.type!=="geojson"||k(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const f=this.getSource(o);if(!f)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===o)return this.fire(new i.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new i.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const x=this._getSourceCaches(o);for(const S of x)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,f){this._checkLoaded(),this.getSource(o).setData(f),this._changed=!0}getSource(o){const f=this._getSourceCache(o);return f&&f.getSource()}_getSources(){const o=[];for(const f in this._otherSourceCaches){const x=this._getSourceCache(f);x&&o.push(x.getSource())}return o}addLayer(o,f,x={}){this._checkLoaded();const S=o.id;if(this.getLayer(S))return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let k;if(o.type==="custom"){if(Ql(this,i.validateCustomStyleLayer(o)))return;k=i.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(S,o.source),o=i.clone$1(o),o=i.extend(o,{source:S})),this._validate(i.validateLayer,`layers.${S}`,o,{arrayIndex:-1},x))return;k=i.createStyleLayer(o),this._validateLayer(k),k.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[k.id]=k.serialize(),this._updateLayerCount(k,!0)}const O=f?this._order.indexOf(f):this._order.length;if(f&&O===-1)return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(O,0,S),this._layerOrderChanged=!0,this._layers[S]=k;const V=this._getLayerSourceCache(k);if(this._removedLayers[S]&&k.source&&V&&k.type!=="custom"){const G=this._removedLayers[S];delete this._removedLayers[S],G.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",V.pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,f){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===f)return;const x=this._order.indexOf(o);this._order.splice(x,1);const S=f?this._order.indexOf(f):this._order.length;f&&S===-1?this.fire(new i.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(S,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const f=this._layers[o];if(!f)return void this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const x=this._order.indexOf(o);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=f,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const f in this._layers)if(this._layers[f].type===o)return!0;return!1}setLayerZoomRange(o,f,x){this._checkLoaded();const S=this.getLayer(o);S?S.minzoom===f&&S.maxzoom===x||(f!=null&&(S.minzoom=f),x!=null&&(S.maxzoom=x),this._updateLayer(S)):this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,f,x={}){this._checkLoaded();const S=this.getLayer(o);if(S){if(!F(S.filter,f))return f==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(i.validateFilter,`layers.${S.id}.filter`,f,{layerType:S.type},x)||(S.filter=i.clone$1(f),this._updateLayer(S)))}else this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const f=this.getLayer(o);return f&&i.clone$1(f.filter)}setLayoutProperty(o,f,x,S={}){this._checkLoaded();const k=this.getLayer(o);k?F(k.getLayoutProperty(f),x)||(k.setLayoutProperty(f,x,S),this._updateLayer(k)):this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,f){const x=this.getLayer(o);if(x)return x.getLayoutProperty(f);this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,f,x,S={}){this._checkLoaded();const k=this.getLayer(o);k?F(k.getPaintProperty(f),x)||(k.setPaintProperty(f,x,S)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new i.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,f){const x=this.getLayer(o);return x&&x.getPaintProperty(f)}setFeatureState(o,f){this._checkLoaded();const x=o.source,S=o.sourceLayer,k=this.getSource(x);if(!k)return void this.fire(new i.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const O=k.type;if(O==="geojson"&&S)return void this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(O==="vector"&&!S)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided.")));const V=this._getSourceCaches(x);for(const G of V)G.setFeatureState(S,o.id,f)}removeFeatureState(o,f){this._checkLoaded();const x=o.source,S=this.getSource(x);if(!S)return void this.fire(new i.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const k=S.type,O=k==="vector"?o.sourceLayer:void 0;if(k==="vector"&&!O)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const V=this._getSourceCaches(x);for(const G of V)G.removeFeatureState(O,o.id,f)}getFeatureState(o){this._checkLoaded();const f=o.source,x=o.sourceLayer,S=this.getSource(f);if(S){if(S.type!=="vector"||x)return o.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(x,o.id);this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new i.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const f in this._sourceCaches){const x=this._sourceCaches[f].getSource();o[x.id]||(o[x.id]=x.serialize())}return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const f=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",f.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const f=O=>this._layers[O].type==="fill-extrusion",x={},S=[];for(let O=this._order.length-1;O>=0;O--){const V=this._order[O];if(f(V)){x[V]=O;for(const G of o){const te=G[V];if(te)for(const ie of te)S.push(ie)}}}S.sort((O,V)=>V.intersectionZ-O.intersectionZ);const k=[];for(let O=this._order.length-1;O>=0;O--){const V=this._order[O];if(f(V))for(let G=S.length-1;G>=0;G--){const te=S[G].feature;if(x[te.layer.id]<O)break;k.push(te),S.pop()}else for(const G of o){const te=G[V];if(te)for(const ie of te)k.push(ie.feature)}}return k}queryRenderedFeatures(o,f,x){f&&f.filter&&this._validate(i.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const S={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of f.layers){const te=this._layers[G];if(!te)return this.fire(new i.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];S[te.source]=!0}}const k=[];f.availableImages=this._availableImages;const O=f&&f.layers?f.layers.some(G=>{const te=this.getLayer(G);return te&&te.is3D()}):this.has3DLayers(),V=En.createFromScreenPoints(o,x);for(const G in this._sourceCaches){const te=this._sourceCaches[G].getSource().id;f.layers&&!S[te]||k.push(he(this._sourceCaches[G],this._layers,this._serializedLayers,V,f,x,O,!!this.map._showQueryGeometry))}return this.placement&&k.push(function(G,te,ie,ge,Te,Be,Le){const Re={},Pe=Be.queryRenderedSymbols(ge),ze=[];for(const Ne of Object.keys(Pe).map(Number))ze.push(Le[Ne]);ze.sort(qe);for(const Ne of ze){const Fe=Ne.featureIndex.lookupSymbolFeatures(Pe[Ne.bucketInstanceId],te,Ne.bucketIndex,Ne.sourceLayerIndex,Te.filter,Te.layers,Te.availableImages,G);for(const et in Fe){const ut=Re[et]=Re[et]||[],lt=Fe[et];lt.sort((yt,$t)=>{const Dt=Ne.featureSortOrder;if(Dt){const Et=Dt.indexOf(yt.featureIndex);return Dt.indexOf($t.featureIndex)-Et}return $t.featureIndex-yt.featureIndex});for(const yt of lt)ut.push(yt)}}for(const Ne in Re)Re[Ne].forEach(Fe=>{const et=Fe.feature,ut=ie(G[Ne]).getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=ut});return Re}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),V.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(o,f){f&&f.filter&&this._validate(i.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const x=this._getSourceCaches(o);let S=[];for(const k of x)S=S.concat(Se(k,f));return S}addSourceType(o,f,x){return Zo.getSourceType(o)?x(new Error(`A source type called "${o}" already exists.`)):(Zo.setSourceType(o,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:f.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(o,f={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const O in o)if(!F(o[O],x[O])){S=!0;break}if(!S)return;const k=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,f),this.light.updateTransitions(k)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,f=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(f===1){if(typeof o.source=="object"){const x="terrain-dem-src";this.addSource(x,o.source),o=i.clone$1(o),o=i.extend(o,{source:x})}if(this._validate(i.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode)this._createTerrain(o,f);else{const x=this.terrain,S=x.get();for(const k of Object.keys(i.spec.terrain))!o.hasOwnProperty(k)&&i.spec.terrain[k].default&&(o[k]=i.spec.terrain[k].default);for(const k in o)if(!F(o[k],S[k])){x.set(o),this.stylesheet.terrain=o;const O=this._setTransitionParameters({duration:0});x.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const f=this.fog=new mn(o,this.map.transform);this.stylesheet.fog=o;const x=this._setTransitionParameters({duration:0});f.updateTransitions(x)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,x=f.get();Object.keys(o).length===0&&f.set(o);for(const S in o)if(!F(o[S],x[S])){f.set(o),this.stylesheet.fog=o;const k=this._setTransitionParameters({duration:0});f.updateTransitions(k);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:i.exported.now(),transition:i.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(x=>this.isLayerDraped(this._layers[x])),f=this._order.filter(x=>!this.isLayerDraped(this._layers[x]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...f)}_createTerrain(o,f){const x=this.terrain=new Yt(o,f);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});x.updateTransitions(S)}_force3DLayerUpdate(){for(const o in this._layers){const f=this._layers[o];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const f=this._layers[o];f.type==="symbol"&&this._updateLayer(f)}}_validate(o,f,x,S,k={}){return(!k||k.validate!==!1)&&Ql(this,o.call(i.validateStyle,i.extend({key:f,style:this.serialize(),value:x,styleSpec:i.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const f=this._getSourceCaches(o);for(const x of f)x.clearTiles()}_reloadSource(o){const f=this._getSourceCaches(o);for(const x of f)x.resume(),x.reload()}_reloadSources(){for(const o of this._getSources())o.reload&&o.reload()}_updateSources(o){for(const f in this._sourceCaches)this._sourceCaches[f].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const f=this._sourceCaches[o];f.resume(),f.reload()}}_updatePlacement(o,f,x,S,k=!1){let O=!1,V=!1;const G={};for(const te of this._order){const ie=this._layers[te];if(ie.type!=="symbol")continue;if(!G[ie.source]){const Te=this._getLayerSourceCache(ie);if(!Te)continue;G[ie.source]=Te.getRenderableIds(!0).map(Be=>Te.getTileByID(Be)).sort((Be,Le)=>Le.tileID.overscaledZ-Be.tileID.overscaledZ||(Be.tileID.isLessThan(Le.tileID)?-1:1))}const ge=this.crossTileSymbolIndex.addLayer(ie,G[ie.source],o.center.lng,o.projection);O=O||ge}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),k=k||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new i.Event("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),o.zoom))&&(this.pauseablePlacement=new $s(o,this._order,k,f,x,S,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),V=!0),O&&this.pauseablePlacement.placement.setStale()),V||O)for(const te of this._order){const ie=this._layers[te];ie.type==="symbol"&&this.placement.updateLayerOpacities(ie,G[ie.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,f,x){this.imageManager.getImages(f.icons,x),this._updateTilesForChangedImages();const S=k=>{k&&k.setDependencies(f.tileID.key,f.type,f.icons)};S(this._otherSourceCaches[f.source]),S(this._symbolSourceCaches[f.source])}getGlyphs(o,f,x){this.glyphManager.getGlyphs(f.stacks,x)}getResource(o,f,x){return i.makeRequest(f,x)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const f=[];return this._otherSourceCaches[o]&&f.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&f.push(this._symbolSourceCaches[o]),f}_isSourceCacheLoaded(o){const f=this._getSourceCaches(o);return f.length===0?(this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):f.every(x=>x.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zo.getSourceType=function(_){return X[_]},Zo.setSourceType=function(_,o){X[_]=o},Zo.registerForPluginStateChange=i.registerForPluginStateChange;var ec=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ac="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Nh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,tc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,uh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Od={},hh={};const Su=[];ol(ec,Su),ol(Nh,Su),ol(tc,Su),ol(uh,Su),Od=gr("",Nh),hh=gr(uh,tc);const Uh=gr(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Fd=ec,ic=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Mc={background:gr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:gr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:gr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:gr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:gr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:gr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:gr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:gr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:gr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:gr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:gr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:gr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ac),skyboxGradient:gr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ac),skyboxCapture:gr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ol(_,o){const f=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let x of f)if(x=x.trim(),x[0]==="#"&&x.includes("if")&&!x.includes("endif")){x=x.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=x.split(" ");for(const k of S)o.includes(k)||o.push(k)}}function gr(_,o){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},k=[...Su];return ol(_,k),ol(o,k),{fragmentSource:_=_.replace(f,(O,V,G,te,ie)=>(S[ie]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
varying ${G} ${te} ${ie};
#else
uniform ${G} ${te} u_${ie};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ie}
    ${G} ${te} ${ie} = u_${ie};
#endif
`)),vertexSource:o=o.replace(f,(O,V,G,te,ie)=>{const ge=te==="float"?"vec2":"vec4",Te=ie.match(/color/)?"color":ge;return S[ie]?V==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
attribute ${G} ${ge} a_${ie};
varying ${G} ${te} ${ie};
#else
uniform ${G} ${te} u_${ie};
#endif
`:Te==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = a_${ie};
#else
    ${G} ${te} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = unpack_mix_${Te}(a_${ie}, u_${ie}_t);
#else
    ${G} ${te} ${ie} = u_${ie};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
attribute ${G} ${ge} a_${ie};
#else
uniform ${G} ${te} u_${ie};
#endif
`:Te==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${G} ${te} ${ie} = a_${ie};
#else
    ${G} ${te} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${G} ${te} ${ie} = unpack_mix_${Te}(a_${ie}, u_${ie}_t);
#else
    ${G} ${te} ${ie} = u_${ie};
#endif
`}),staticAttributes:x,usedDefines:k}}class nc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,f,x,S,k,O,V){this.context=o;let G=this.boundPaintVertexBuffers.length!==S.length;for(let ie=0;!G&&ie<S.length;ie++)this.boundPaintVertexBuffers[ie]!==S[ie]&&(G=!0);let te=this.boundDynamicVertexBuffers.length!==V.length;for(let ie=0;!te&&ie<V.length;ie++)this.boundDynamicVertexBuffers[ie]!==V[ie]&&(te=!0);if(!o.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==x||G||te||this.boundIndexBuffer!==k||this.boundVertexOffset!==O)this.freshBind(f,x,S,k,O,V);else{o.bindVertexArrayOES.set(this.vao);for(const ie of V)ie&&ie.bind();k&&k.dynamicDraw&&k.bind()}}freshBind(o,f,x,S,k,O){let V;const G=o.numAttributes,te=this.context,ie=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),V=0,this.boundProgram=o,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=S,this.boundVertexOffset=k,this.boundDynamicVertexBuffers=O;else{V=te.currentNumAttributes||0;for(let ge=G;ge<V;ge++)ie.disableVertexAttribArray(ge)}f.enableAttributes(ie,o),f.bind(),f.setVertexAttribPointers(ie,o,k);for(const ge of x)ge.enableAttributes(ie,o),ge.bind(),ge.setVertexAttribPointers(ie,o,k);for(const ge of O)ge&&(ge.enableAttributes(ie,o),ge.bind(),ge.setVertexAttribPointers(ie,o,k));S&&S.bind(),te.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function kc(_,o){const f=Math.pow(2,o.canonical.z),x=o.canonical.y;return[new i.MercatorCoordinate(0,x/f).toLngLat().lat,new i.MercatorCoordinate(0,(x+1)/f).toLngLat().lat]}function dh(_,o,f,x,S,k,O){const V=_.context,G=V.gl,te=f.fbo;if(!te)return;_.prepareDrawTile();const ie=_.useProgram("hillshade");V.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,te.colorAttachment.get());const ge=((Re,Pe,ze,Ne)=>{const Fe=ze.paint.get("hillshade-shadow-color"),et=ze.paint.get("hillshade-highlight-color"),ut=ze.paint.get("hillshade-accent-color");let lt=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);ze.paint.get("hillshade-illumination-anchor")==="viewport"&&(lt-=Re.transform.angle);const yt=!Re.options.moving;return{u_matrix:Ne||Re.transform.calculateProjMatrix(Pe.tileID.toUnwrapped(),yt),u_image:0,u_latrange:kc(0,Pe.tileID),u_light:[ze.paint.get("hillshade-exaggeration"),lt],u_shadow:Fe,u_highlight:et,u_accent:ut}})(_,f,x,_.terrain?o.projMatrix:null);_.prepareDrawProgram(V,ie,o.toUnwrapped());const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Be,tileBoundsSegments:Le}=_.getTileBoundsBuffers(f);ie.draw(V,G.TRIANGLES,S,k,O,i.CullFaceMode.disabled,ge,x.id,Te,Be,Le)}function sl(_,o,f){if(!o.needsDEMTextureUpload)return;const x=_.context,S=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||_.getTileTexture(f.stride);const k=f.getPixels();o.demTexture?o.demTexture.update(k,{premultiply:!1}):o.demTexture=new i.Texture(x,k,S.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Fa(_,o,f,x,S,k){const O=_.context,V=O.gl;if(!o.dem)return;const G=o.dem;if(O.activeTexture.set(V.TEXTURE1),sl(_,o,G),!o.demTexture)return;o.demTexture.bind(V.NEAREST,V.CLAMP_TO_EDGE);const te=G.dim;O.activeTexture.set(V.TEXTURE0);let ie=o.fbo;if(!ie){const Le=new i.Texture(O,{width:te,height:te,data:null},V.RGBA);Le.bind(V.LINEAR,V.CLAMP_TO_EDGE),ie=o.fbo=O.createFramebuffer(te,te,!0),ie.colorAttachment.set(Le.texture)}O.bindFramebuffer.set(ie.framebuffer),O.viewport.set([0,0,te,te]);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Te,tileBoundsSegments:Be}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(O,V.TRIANGLES,x,S,k,i.CullFaceMode.disabled,((Le,Re)=>{const Pe=Re.stride,ze=i.create();return i.ortho(ze,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(ze,ze,[0,-i.EXTENT,0]),{u_matrix:ze,u_image:1,u_dimension:[Pe,Pe],u_zoom:Le.overscaledZ,u_unpack:Re.unpackVector}})(o.tileID,G),f.id,ge,Te,Be),o.needsHillshadePrepare=!1}const Pc=_=>({u_matrix:new i.UniformMatrix4f(_),u_image0:new i.Uniform1i(_),u_skirt_height:new i.Uniform1f(_)}),al=(_,o)=>({u_matrix:_,u_image0:0,u_skirt_height:o}),jr=(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(x),u_merc_matrix:f,u_zoom_transition:S,u_merc_center:k,u_image0:0,u_frustum_tl:O,u_frustum_tr:V,u_frustum_br:G,u_frustum_bl:te,u_globe_pos:ie,u_globe_radius:ge,u_viewport:Te,u_grid_matrix:Be?Float32Array.from(Be):new Float32Array(9)});function Cu(_,o){return _!=null&&o!=null&&!(!_.hasData()||!o.hasData())&&_.demTexture!=null&&o.demTexture!=null&&_.tileID.key!==o.tileID.key}const Un=new class{constructor(){this.operations={}}newMorphing(_,o,f,x,S){if(_ in this.operations){const k=this.operations[_];k.to.tileID.key!==f.tileID.key&&(k.queued=f)}else this.operations[_]={startTime:x,phase:0,duration:S,from:o,to:f,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const o=this.operations[_];return{from:o.from,to:o.to,phase:o.phase}}update(_){for(const o in this.operations){const f=this.operations[o];for(f.phase=(_-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,_)){delete this.operations[o];break}}}_nextOp(_,o){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=o,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},cr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Lr(_,o){const f=1<<_.z;return!o&&(_.x===0||_.x===f-1)||_.y===0||_.y===f-1}const Br=_=>({u_matrix:_});function Pl(_,o,f,x,S){if(S>0){const k=i.exported.now(),O=(k-_.timeAdded)/S,V=o?(k-o.timeAdded)/S:-1,G=f.getSource(),te=x.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),ie=!o||Math.abs(o.tileID.overscaledZ-te)>Math.abs(_.tileID.overscaledZ-te),ge=ie&&_.refreshedUponExpiration?1:i.clamp(ie?O:1-V,0,1);return _.refreshedUponExpiration&&O>=1&&(_.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}class Qn extends i.SourceCache{constructor(o){const f={type:"raster-dem",maxzoom:o.transform.maxZoom},x=new Er(Bt(),null),S=ee("mock-dem",f,x,o.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,f){o.state="loaded",f(null)}}class fh extends i.SourceCache{constructor(o){const f=ee("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Er(Bt(),null),o.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,f,x){if(o.freezeTileCoverage)return;this.transform=o;const S=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((k,O)=>{if(k[O.key]="",!this._tiles[O.key]){const V=new i.Tile(O,this._source.tileSize*O.overscaleFactor(),o.tileZoom);V.state="loaded",this._tiles[O.key]=V}return k},{});for(const k in this._tiles)k in S||(this.freeFBO(k),this._tiles[k].unloadVectorData(),delete this._tiles[k])}freeFBO(o){const f=this.proxyCachedFBO[o];if(f!==void 0){const x=Object.values(f);this.renderCachePool.push(...x),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class $h extends i.OverscaledTileID{constructor(o,f,x){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=f,this.projMatrix=x}}class jh extends i.Elevation{constructor(o,f){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,S,k]=function(G){const te=new i.StructArrayLayout4i8,ie=new i.StructArrayLayout3ui6,ge=131;te.reserve(17161),ie.reserve(33800);const Te=i.EXTENT/128,Be=i.EXTENT+Te/2,Le=Be+Te;for(let Pe=-Te;Pe<Le;Pe+=Te)for(let ze=-Te;ze<Le;ze+=Te){const Ne=ze<0||ze>Be||Pe<0||Pe>Be?24575:0,Fe=i.clamp(Math.round(ze),0,i.EXTENT),et=i.clamp(Math.round(Pe),0,i.EXTENT);te.emplaceBack(Fe+Ne,et,Fe,et)}const Re=(Pe,ze)=>{const Ne=ze*ge+Pe;ie.emplaceBack(Ne+1,Ne,Ne+ge),ie.emplaceBack(Ne+ge,Ne+ge+1,Ne+1)};for(let Pe=1;Pe<129;Pe++)for(let ze=1;ze<129;ze++)Re(ze,Pe);return[0,129].forEach(Pe=>{for(let ze=0;ze<130;ze++)Re(ze,Pe),Re(Pe,ze)}),[te,ie,32768]}(),O=o.context;this.gridBuffer=O.createVertexBuffer(x,i.boundsAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(S),this.gridSegments=i.SegmentVector.simpleSegment(0,0,x.length,S.length),this.gridNoSkirtSegments=i.SegmentVector.simpleSegment(0,0,x.length,k),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fh(f.map),this.orthoMatrix=i.create(),i.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.EXTENT,0,i.EXTENT,0,1);const V=O.gl;this._overlapStencilMode=new i.StencilMode({func:V.GEQUAL,mask:255},0,255,V.KEEP,V.KEEP,V.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qn(f.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,f,x){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const S=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const k=()=>{this.sourceCache.used&&i.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(f,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),f.updateElevation(!0,x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&i.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=x._centerAltitude===0&&this.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(x.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=f.getIds().map(G=>{const te=f.getTileByID(G).tileID;return te.projMatrix=x.calculateProjMatrix(te.toUnwrapped()),te});(function(G,te){const ie=te.transform.pointCoordinate(te.transform.getCameraPoint()),ge=new i.pointGeometry(ie.x,ie.y);G.sort((Te,Be)=>{if(Be.overscaledZ-Te.overscaledZ)return Be.overscaledZ-Te.overscaledZ;const Le=new i.pointGeometry(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),Re=new i.pointGeometry(Be.canonical.x+(1<<Be.canonical.z)*Be.wrap,Be.canonical.y),Pe=ge.mult(1<<Te.canonical.z);return Pe.x-=.5,Pe.y-=.5,Pe.distSqr(Le)-Pe.distSqr(Re)})})(S,this.painter),this._previousZoom=x.zoom;const k=this.proxyToSource||{};this.proxyToSource={},S.forEach(G=>{this.proxyToSource[G.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const G in O){const te=O[G];if(!te.used||(te!==this.sourceCache&&this.resetTileLookupCache(te.id),this._setupProxiedCoordsForOrtho(te,o[G],k),te.usedForTerrain))continue;const ie=o[G];te.getSource().reparseOverscaled&&this._assignTerrainTiles(ie)}this.proxiedCoords[f.id]=S.map(G=>new $h(G,G.key,this.orthoMatrix)),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(k),this.renderingToTexture=!1,this._updateTimestamp=i.exported.now();const V={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const te=this.terrainTileForTile[G.key];if(!te)continue;const ie=te.tileID.key;ie in V||(this._visibleDemTiles.push(te),V[ie]=ie)}}_assignTerrainTiles(o){this._initializing||o.forEach(f=>{if(this.terrainTileForTile[f.key])return;const x=this._findTileCoveringTileID(f,this.sourceCache);x&&(this.terrainTileForTile[f.key]=x)})}_prepareDEMTextures(){const o=this.painter.context,f=o.gl;for(const x in this.terrainTileForTile){const S=this.terrainTileForTile[x],k=S.dem;!k||S.demTexture&&!S.needsDEMTextureUpload||(o.activeTexture.set(f.TEXTURE1),sl(this.painter,S,k))}}_prepareDemTileUniforms(o,f,x,S){if(!f||f.demTexture==null)return!1;const k=o.tileID.canonical,O=Math.pow(2,f.tileID.canonical.z-k.z),V=S||"";return x[`u_dem_tl${V}`]=[k.x*O%1,k.y*O%1],x[`u_dem_scale${V}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,f=o.gl;if(!this._emptyDepthBufferTexture){const x=new i.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.Texture(o,x,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const f=this._visibleDemTiles.reduce((x,S)=>{if(!S.dem)return x;const k=S.dem.tree.minimums[0];return k>0&&o++,x+k},0);return o?f/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,f=o.gl;o.activeTexture.set(f.TEXTURE2);const x=this._getLoadedAreaMinimum(),S=new i.RGBAImage({width:1,height:1},new Uint8Array(i.DEMData.pack(x,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let k=this._emptyDEMTexture;return k?k.update(S,{premultiply:!1}):k=this._emptyDEMTexture=new i.Texture(o,S,f.RGBA,{premultiply:!1}),k}setupElevationDraw(o,f,x){const S=this.painter.context,k=S.gl,O=(V=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:i.DEMData.getUnpackVector(V),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var V;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let G=null,te=null,ie=1;if(x&&x.morphing&&this._useVertexMorphing){const ge=x.morphing.srcDemTile,Te=x.morphing.dstDemTile;ie=x.morphing.phase,ge&&Te&&(this._prepareDemTileUniforms(o,ge,O,"_prev")&&(te=ge),this._prepareDemTileUniforms(o,Te,O)&&(G=Te))}if(te&&G?(S.activeTexture.set(k.TEXTURE2),G.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE,k.NEAREST),S.activeTexture.set(k.TEXTURE4),te.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE,k.NEAREST),O.u_dem_lerp=ie):(G=this.terrainTileForTile[o.tileID.key],S.activeTexture.set(k.TEXTURE2),(this._prepareDemTileUniforms(o,G,O)?G.demTexture:this.emptyDEMTexture).bind(k.NEAREST,k.CLAMP_TO_EDGE)),S.activeTexture.set(k.TEXTURE3),x&&x.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),x&&x.useMeterToDem&&G){const ge=(1<<G.tileID.canonical.z)*i.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=ge}if(x&&x.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),f.setTerrainUniformValues(S,O),this.painter.transform.projection.name==="globe"){const ge=this.globeUniformValues(this.painter.transform,o.tileID.canonical,x&&x.useDenormalizedUpVectorScale);f.setGlobeUniformValues(S,ge)}}globeUniformValues(o,f,x){const S=o.projection;return{u_tile_tl_up:S.upVector(f,0,0),u_tile_tr_up:S.upVector(f,i.EXTENT,0),u_tile_br_up:S.upVector(f,i.EXTENT,i.EXTENT),u_tile_bl_up:S.upVector(f,0,i.EXTENT),u_tile_up_scale:x?i.GLOBE_METERS_TO_ECEF:S.upVectorScale(f,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const f=this.painter,x=this.painter.context;o.length!==0&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(S,k,O,V,G){if(S.transform.projection.name==="globe")(function(te,ie,ge,Te,Be){const Le=te.context,Re=Le.gl;let Pe,ze;const Ne=te.options.showTerrainWireframe?2:0,Fe=te.transform,et=i.globeUseCustomAntiAliasing(te,Le,Fe),ut=(pi,Gt)=>{if(ze===pi)return;const ai=[cr[pi],"PROJECTION_GLOBE_VIEW"];et&&ai.push("CUSTOM_ANTIALIASING"),Gt&&ai.push(cr[Ne]),Pe=te.useProgram("globeRaster",null,ai),ze=pi},lt=te.colorModeForRenderPass(),yt=new i.DepthMode(Re.LEQUAL,i.DepthMode.ReadWrite,te.depthRangeFor3D);Un.update(Be);const $t=i.calculateGlobeMercatorMatrix(Fe),Dt=[i.mercatorXfromLng(Fe.center.lng),i.mercatorYfromLat(Fe.center.lat)],Et=Ne?[!1,!0]:[!1],bi=te.globeSharedBuffers,wt=[Fe.width*i.exported.devicePixelRatio,Fe.height*i.exported.devicePixelRatio],ei=Float32Array.from(Fe.globeMatrix),qt={useDenormalizedUpVectorScale:!0};if(Et.forEach(pi=>{ze=-1;const Gt=pi?Re.LINES:Re.TRIANGLES;for(const ai of Te){const Ti=ge.getTile(ai),St=i.StencilMode.disabled,Zt=ie.prevTerrainTileForTile[ai.key],sn=ie.terrainTileForTile[ai.key];Cu(Zt,sn)&&Un.newMorphing(ai.key,Zt,sn,Be,250),Le.activeTexture.set(Re.TEXTURE0),Ti.texture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE);const vn=Un.getMorphValuesForProxy(ai.key),rn=vn?1:0;vn&&i.extend$1(qt,{morphing:{srcDemTile:vn.from,dstDemTile:vn.to,phase:i.easeCubicInOut(vn.phase)}});const Cn=i.tileCornersToBounds(ai.canonical),Nn=i.getLatitudinalLod(Cn.getCenter().lat),gn=i.getGridMatrix(ai.canonical,Cn,Nn,Fe.worldSize/Fe._pixelsPerMercatorPixel),Yi=i.globeNormalizeECEF(i.globeTileBounds(ai.canonical)),br=jr(Fe.projMatrix,ei,$t,Yi,i.globeToMercatorTransition(Fe.zoom),Dt,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,wt,gn);if(ut(rn,pi),ie.setupElevationDraw(Ti,Pe,qt),te.prepareDrawProgram(Le,Pe,ai.toUnwrapped()),bi){const[Ir,Ar,Mr]=pi?bi.getWirefameBuffers(te.context,Nn):bi.getGridBuffers(Nn);Pe.draw(Le,Gt,yt,St,lt,i.CullFaceMode.backCCW,br,"globe_raster",Ir,Ar,Mr)}}}),bi){const pi=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];et&&pi.push("CUSTOM_ANTIALIASING"),Pe=te.useProgram("globeRaster",null,pi);for(const Gt of Te){const{x:ai,y:Ti,z:St}=Gt.canonical,Zt=Ti===0,sn=Ti===(1<<St)-1,[vn,rn,Cn,Nn]=bi.getPoleBuffers(St);if(Nn&&(Zt||sn)){const gn=ge.getTile(Gt);Le.activeTexture.set(Re.TEXTURE0),gn.texture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE);let Yi=i.globePoleMatrixForTile(St,ai,Fe);const br=i.globeNormalizeECEF(i.globeTileBounds(Gt.canonical)),Ir=(Ar,Mr)=>Ar.draw(Le,Re.TRIANGLES,yt,i.StencilMode.disabled,lt,i.CullFaceMode.disabled,jr(Fe.projMatrix,Yi,Yi,br,0,Dt,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,wt),"globe_pole_raster",Mr,Cn,Nn);ie.setupElevationDraw(gn,Pe,qt),te.prepareDrawProgram(Le,Pe,Gt.toUnwrapped()),Zt&&Ir(Pe,vn),sn&&(Yi=i.scale(i.create(),Yi,[1,-1,1]),Ir(Pe,rn))}}}})(S,k,O,V,G);else{const te=S.context,ie=te.gl;let ge,Te;const Be=S.options.showTerrainWireframe?2:0,Le=(Fe,et)=>{if(Te===Fe)return;const ut=[cr[Fe]];et&&ut.push(cr[Be]),ge=S.useProgram("terrainRaster",null,ut),Te=Fe},Re=S.colorModeForRenderPass(),Pe=new i.DepthMode(ie.LEQUAL,i.DepthMode.ReadWrite,S.depthRangeFor3D);Un.update(G);const ze=S.transform,Ne=6*Math.pow(1.5,22-ze.zoom)*k.exaggeration();(Be?[!1,!0]:[!1]).forEach(Fe=>{Te=-1;const et=Fe?ie.LINES:ie.TRIANGLES,[ut,lt]=Fe?k.getWirefameBuffer():[k.gridIndexBuffer,k.gridSegments];for(const yt of V){const $t=O.getTile(yt),Dt=i.StencilMode.disabled,Et=k.prevTerrainTileForTile[yt.key],bi=k.terrainTileForTile[yt.key];Cu(Et,bi)&&Un.newMorphing(yt.key,Et,bi,G,250),te.activeTexture.set(ie.TEXTURE0),$t.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST);const wt=Un.getMorphValuesForProxy(yt.key),ei=wt?1:0;let qt;wt&&(qt={morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:i.easeCubicInOut(wt.phase)}});const pi=al(yt.projMatrix,Lr(yt.canonical,ze.renderWorldCopies)?Ne/10:Ne);Le(ei,Fe),k.setupElevationDraw($t,ge,qt),S.prepareDrawProgram(te,ge,yt.toUnwrapped()),ge.draw(te,et,Pe,Dt,Re,i.CullFaceMode.backCCW,pi,"terrain_raster",k.gridBuffer,ut,lt)}})}}(f,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const f=this.painter,x=this.painter.context,S=this.proxySourceCache,k=this.proxiedCoords[S.id],O=this._drapedRenderBatches.shift(),V=[],G=f.style.order;let te=0;for(const ie of k){const ge=S.getTileByID(ie.proxyTileKey),Te=S.proxyCachedFBO[ie.key]?S.proxyCachedFBO[ie.key][o]:void 0,Be=Te!==void 0?S.renderCache[Te]:this.pool[te++],Le=Te!==void 0;if(ge.texture=Be.tex,Le&&!Be.dirty){V.push(ge.tileID);continue}let Re;x.bindFramebuffer.set(Be.fb.framebuffer),this.renderedToTile=!1,Be.dirty&&(x.clear({color:i.Color.transparent,stencil:0}),Be.dirty=!1);for(let Pe=O.start;Pe<=O.end;++Pe){const ze=f.style._layers[G[Pe]];if(ze.isHidden(f.transform.zoom))continue;const Ne=f.style._getLayerSourceCache(ze),Fe=Ne?this.proxyToSource[ie.key][Ne.id]:[ie];if(!Fe)continue;const et=Fe;x.viewport.set([0,0,Be.fb.width,Be.fb.height]),Re!==(Ne?Ne.id:null)&&(this._setupStencil(Be,Fe,ze,Ne),Re=Ne?Ne.id:null),f.renderLayer(f,Ne,ze,et)}this.renderedToTile?(Be.dirty=!0,V.push(ge.tileID)):Le||--te,te===5&&(te=0,this.renderToBackBuffer(V))}return this.renderToBackBuffer(V),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,f.width,f.height]),O.end+1}postRender(){}renderCacheEfficiency(o){const f=o.order.length;if(f===0)return{efficiency:100};let x,S=0,k=0,O=!1;for(let V=0;V<f;++V){const G=o._layers[o.order[V]];this._style.isLayerDraped(G)?(O&&++S,++k):O||(O=!0,x=G.id)}return k===0?{efficiency:100}:{efficiency:100*(1-S/k),firstUndrapedLayer:x}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{o=Math.min(o,f.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,f,x){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter(k=>k.dem).map(k=>{const O=k.tileID,V=1<<O.overscaledZ,{x:G,y:te}=O.canonical,ie=G/V,ge=(G+1)/V,Te=te/V,Be=(te+1)/V;return{minx:ie,miny:Te,maxx:ge,maxy:Be,t:k.dem.tree.raycastRoot(ie,Te,ge,Be,o,f,x),tile:k}});S.sort((k,O)=>(k.t!==null?k.t:Number.MAX_VALUE)-(O.t!==null?O.t:Number.MAX_VALUE));for(const k of S){if(k.t==null)return null;const O=k.tile.dem.tree.raycast(k.minx,k.miny,k.maxx,k.maxy,o,f,x);if(O!=null)return O}return null}_createFBO(){const o=this.painter.context,f=o.gl,x=this.drapeBufferSize;o.activeTexture.set(f.TEXTURE0);const S=new i.Texture(o,{width:x[0],height:x[1],data:null},f.RGBA);S.bind(f.LINEAR,f.CLAMP_TO_EDGE);const k=o.createFramebuffer(x[0],x[1],!1);return k.colorAttachment.set(S.texture),k.depthAttachment=new La(o,k.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,k.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):k.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:k,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const f=this._style._layers[o],x=f.isHidden(this.painter.transform.zoom);return f.type!=="custom"&&!x&&f.hasTransition()})}_clearRasterFadeFromRenderCache(){let o=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof ve){o=!0;break}if(o)for(let f=0;f<this._style.order.length;++f){const x=this._style._layers[this._style.order[f]],S=x.isHidden(this.painter.transform.zoom),k=this._style._getLayerSourceCache(x);if(x.type!=="raster"||S||!k)continue;const O=x.paint.get("raster-fade-duration");for(const V of this.proxyCoords){const G=this.proxyToSource[V.key][k.id];if(G)for(const te of G){const ie=Pl(k.getTile(te),k.findLoadedParent(te,0),k,this.painter.transform,O);(ie.opacity!==1||ie.mix!==0)&&this._clearRenderCacheForTile(k.id,te)}}}}_setupDrapedRenderBatches(){const o=this._style.order,f=o.length;if(f===0)return;const x=[];let S,k=0,O=this._style._layers[o[k]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++k<f;)O=this._style._layers[o[k]];for(;k<f;++k){const V=this._style._layers[o[k]];V.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(V)?S===void 0&&(S=k):S!==void 0&&(x.push({start:S,end:k-1}),S=void 0))}S!==void 0&&x.push({start:S,end:k-1}),this._drapedRenderBatches=x}_setupRenderCache(o){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const O=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let V=0;V<O.length;++V){const G=Object.values(O[V]);f.renderCachePool.push(...G)}}return}this._clearRasterFadeFromRenderCache();const x=this.proxyCoords,S=this._tilesDirty;for(let O=x.length-1;O>=0;O--){const V=x[O];if(f.getTileByID(V.key),f.proxyCachedFBO[V.key]!==void 0){const G=o[V.key],te=this.proxyToSource[V.key];let ie=0;for(const ge in te){const Te=te[ge],Be=G[ge];if(!Be||Be.length!==Te.length||Te.some((Le,Re)=>Le!==Be[Re]||S[ge]&&S[ge].hasOwnProperty(Le.key))){ie=-1;break}++ie}for(const ge in f.proxyCachedFBO[V.key])f.renderCache[f.proxyCachedFBO[V.key][ge]].dirty=ie<0||ie!==Object.values(G).length}}const k=[...this._drapedRenderBatches];k.sort((O,V)=>V.end-V.start-(O.end-O.start));for(const O of k)for(const V of x){if(f.proxyCachedFBO[V.key])continue;let G=f.renderCachePool.pop();G===void 0&&f.renderCache.length<50&&(G=f.renderCache.length,f.renderCache.push(this._createFBO())),G!==void 0&&(f.proxyCachedFBO[V.key]={},f.proxyCachedFBO[V.key][O.start]=G,f.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(o,f,x,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const k=this.painter.context,O=k.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let V;if(x.isTileClipped())V=f.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);V=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+V>255&&(k.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=V,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):i.StencilMode.disabled}_renderTileClippingMasks(o,f){const x=this.painter,S=this.painter.context,k=S.gl;x._tileClippingMaskIDs={},S.setColorMode(i.ColorMode.disabled),S.setDepthMode(i.DepthMode.disabled);const O=x.useProgram("clippingMask");for(const V of o){const G=x._tileClippingMaskIDs[V.key]=--f;O.draw(S,k.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:k.ALWAYS,mask:0},G,255,k.KEEP,k.KEEP,k.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,Br(V.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(o){const f=this.painter.transform;if(o.x<0||o.x>f.width||o.y<0||o.y>f.height)return null;const x=[o.x,o.y,1,1];i.transformMat4$1(x,x,f.pixelMatrixInverse),i.scale$1(x,x,1/x[3]),x[0]/=f.worldSize,x[1]/=f.worldSize;const S=f._camera.position,k=i.mercatorZfromAltitude(1,f.center.lat),O=[S[0],S[1],S[2]/k,0],V=i.subtract([],x.slice(0,3),O);i.normalize(V,V);const G=this.raycast(O,V,this._exaggeration);return G!==null&&G?(i.scaleAndAdd(O,O,V,G),O[3]=O[2],O[2]*=k,O):null}drawDepth(){const o=this.painter,f=o.context,x=this.proxySourceCache,S=Math.ceil(o.width),k=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===k||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=f.gl,V=f.createFramebuffer(S,k,!0);f.activeTexture.set(O.TEXTURE0);const G=new i.Texture(f,{width:S,height:k,data:null},O.RGBA);G.bind(O.NEAREST,O.CLAMP_TO_EDGE),V.colorAttachment.set(G.texture);const te=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,S,k);V.depthAttachment.set(te),this._depthFBO=V,this._depthTexture=G}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,S,k]),function(O,V,G,te){if(O.transform.projection.name==="globe")return;const ie=O.context,ge=ie.gl;ie.clear({depth:1});const Te=O.useProgram("terrainDepth"),Be=new i.DepthMode(ge.LESS,i.DepthMode.ReadWrite,O.depthRangeFor3D);for(const Le of te){const Re=G.getTile(Le),Pe=al(Le.projMatrix,0);V.setupElevationDraw(Re,Te),Te.draw(ie,ge.TRIANGLES,Be,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.backCCW,Pe,"terrain_depth",V.gridBuffer,V.gridIndexBuffer,V.gridNoSkirtSegments)}}(o,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,f,x){if(o.getSource()instanceof le)return this._setupProxiedCoordsForImageSource(o,f,x);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const S=this.proxiedCoords[o.id]=[],k=this.proxyCoords;for(let V=0;V<k.length;V++){const G=k[V],te=this._findTileCoveringTileID(G,o);if(te){const ie=this._createProxiedId(G,te,x[G.key]&&x[G.key][o.id]);S.push(ie),this.proxyToSource[G.key][o.id]=[ie]}}let O=!1;for(let V=0;V<f.length;V++){const G=o.getTile(f[V]);if(!G||!G.hasData())continue;const te=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(te&&te.tileID.canonical.z!==G.tileID.canonical.z){const ie=this.proxyToSource[te.tileID.key][o.id],ge=this._createProxiedId(te.tileID,G,x[te.tileID.key]&&x[te.tileID.key][o.id]);ie?ie.splice(ie.length-1,0,ge):this.proxyToSource[te.tileID.key][o.id]=[ge],S.push(ge),O=!0}}this._sourceTilesOverlap[o.id]=O}_setupProxiedCoordsForImageSource(o,f,x){if(!o.getSource().loaded())return;const S=this.proxiedCoords[o.id]=[],k=this.proxyCoords,O=o.getSource(),V=new i.pointGeometry(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),G=O.coordinates.map(i.MercatorCoordinate.fromLngLat).reduce((ie,ge)=>(ie.min.x=Math.min(ie.min.x,ge.x-V.x),ie.min.y=Math.min(ie.min.y,ge.y-V.y),ie.max.x=Math.max(ie.max.x,ge.x-V.x),ie.max.y=Math.max(ie.max.y,ge.y-V.y),ie),{min:new i.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),te=(ie,ge)=>{const Te=ie.wrap+ie.canonical.x/(1<<ie.canonical.z),Be=ie.canonical.y/(1<<ie.canonical.z),Le=i.EXTENT/(1<<ie.canonical.z),Re=ge.wrap+ge.canonical.x/(1<<ge.canonical.z),Pe=ge.canonical.y/(1<<ge.canonical.z);return Te+Le<Re+G.min.x||Te>Re+G.max.x||Be+Le<Pe+G.min.y||Be>Pe+G.max.y};for(let ie=0;ie<k.length;ie++){const ge=k[ie];for(let Te=0;Te<f.length;Te++){const Be=o.getTile(f[Te]);if(!Be||!Be.hasData()||te(ge,Be.tileID))continue;const Le=this._createProxiedId(ge,Be,x[ge.key]&&x[ge.key][o.id]),Re=this.proxyToSource[ge.key][o.id];Re?Re.push(Le):this.proxyToSource[ge.key][o.id]=[Le],S.push(Le)}}}_createProxiedId(o,f,x){let S=this.orthoMatrix;if(x){const k=x.find(O=>O.key===f.tileID.key);if(k)return k}if(f.tileID.key!==o.key){const k=o.canonical.z-f.tileID.canonical.z;let O,V,G;S=i.create();const te=f.tileID.wrap-o.wrap<<o.overscaledZ;k>0?(O=i.EXTENT>>k,V=O*((f.tileID.canonical.x<<k)-o.canonical.x+te),G=O*((f.tileID.canonical.y<<k)-o.canonical.y)):(O=i.EXTENT<<-k,V=i.EXTENT*(f.tileID.canonical.x-(o.canonical.x+te<<-k)),G=i.EXTENT*(f.tileID.canonical.y-(o.canonical.y<<-k))),i.ortho(S,0,O,0,O,0,1),i.translate(S,S,[V,G,0])}return new $h(f.tileID,o.key,S)}_findTileCoveringTileID(o,f){let x=f.getTile(o);if(x&&x.hasData())return x;const S=this._findCoveringTileCache[f.id],k=S[o.key];if(x=k?f.getTileByID(k):null,x&&x.hasData()||k===null)return x;let O=x?x.tileID:o,V=O.overscaledZ;const G=f.getSource().minzoom,te=[];if(!k){const ge=f.getSource().maxzoom;if(o.canonical.z>=ge){const Te=o.canonical.z-ge;f.getSource().reparseOverscaled?(V=Math.max(o.canonical.z+2,f.transform.tileZoom),O=new i.OverscaledTileID(V,o.wrap,ge,o.canonical.x>>Te,o.canonical.y>>Te)):Te!==0&&(V=ge,O=new i.OverscaledTileID(V,o.wrap,ge,o.canonical.x>>Te,o.canonical.y>>Te))}O.key!==o.key&&(te.push(O.key),x=f.getTile(O))}const ie=ge=>{te.forEach(Te=>{S[Te]=ge}),te.length=0};for(V-=1;V>=G&&(!x||!x.hasData());V--){x&&ie(x.tileID.key);const ge=O.calculateScaledKey(V);if(x=f.getTileByID(ge),x&&x.hasData())break;const Te=S[ge];if(Te===null)break;Te===void 0?te.push(ge):x=f.getTileByID(Te)}return ie(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,f){let x=this._tilesDirty[o];x||(x=this._tilesDirty[o]={}),x[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(f){let x=0;const S=new i.StructArrayLayout2ui4,k=131;for(let O=1;O<129;O++){for(let V=1;V<129;V++)x=O*k+V,S.emplaceBack(x,x+1),S.emplaceBack(x,x+k),S.emplaceBack(x+1,x+k),O===128&&S.emplaceBack(x+k,x+k+1);S.emplaceBack(x+1,x+1+k)}return S}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=i.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Gh{static cacheKey(o,f,x,S){let k=`${f}${S?S.cacheKey:""}`;for(const O of x)o.usedDefines.includes(O)&&(k+=`/${O}`);return k}constructor(o,f,x,S,k,O){const V=o.gl;this.program=V.createProgram();const G=function(Pe){const ze=[];for(let Ne=0;Ne<Pe.length;Ne++){if(Pe[Ne]===null)continue;const Fe=Pe[Ne].split(" ");ze.push(Fe.pop())}return ze}(x.staticAttributes),te=S?S.getBinderAttributes():[],ie=G.concat(te);let ge=S?S.defines():[];ge=ge.concat(O.map(Pe=>`#define ${Pe}`));const Te=ge.concat(o.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(ic):ic,ic,Fd,Uh.fragmentSource,hh.fragmentSource,x.fragmentSource).join(`
`),Be=ge.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Fd,Uh.vertexSource,hh.vertexSource,Od.vertexSource,x.vertexSource).join(`
`),Le=V.createShader(V.FRAGMENT_SHADER);if(V.isContextLost())return void(this.failedToCreate=!0);V.shaderSource(Le,Te),V.compileShader(Le),V.attachShader(this.program,Le);const Re=V.createShader(V.VERTEX_SHADER);if(V.isContextLost())this.failedToCreate=!0;else{V.shaderSource(Re,Be),V.compileShader(Re),V.attachShader(this.program,Re),this.attributes={},this.numAttributes=ie.length;for(let Pe=0;Pe<this.numAttributes;Pe++)ie[Pe]&&(V.bindAttribLocation(this.program,Pe,ie[Pe]),this.attributes[ie[Pe]]=Pe);V.linkProgram(this.program),V.deleteShader(Re),V.deleteShader(Le),this.fixedUniforms=k(o),this.binderUniforms=S?S.getUniforms(o):[],O.includes("TERRAIN")&&(this.terrainUniforms=(Pe=>({u_dem:new i.Uniform1i(Pe),u_dem_prev:new i.Uniform1i(Pe),u_dem_unpack:new i.Uniform4f(Pe),u_dem_tl:new i.Uniform2f(Pe),u_dem_scale:new i.Uniform1f(Pe),u_dem_tl_prev:new i.Uniform2f(Pe),u_dem_scale_prev:new i.Uniform1f(Pe),u_dem_size:new i.Uniform1f(Pe),u_dem_lerp:new i.Uniform1f(Pe),u_exaggeration:new i.Uniform1f(Pe),u_depth:new i.Uniform1i(Pe),u_depth_size_inv:new i.Uniform2f(Pe),u_meter_to_dem:new i.Uniform1f(Pe),u_label_plane_matrix_inv:new i.UniformMatrix4f(Pe)}))(o)),O.includes("GLOBE")&&(this.globeUniforms=(Pe=>({u_tile_tl_up:new i.Uniform3f(Pe),u_tile_tr_up:new i.Uniform3f(Pe),u_tile_br_up:new i.Uniform3f(Pe),u_tile_bl_up:new i.Uniform3f(Pe),u_tile_up_scale:new i.Uniform1f(Pe)}))(o)),O.includes("FOG")&&(this.fogUniforms=(Pe=>({u_fog_matrix:new i.UniformMatrix4f(Pe),u_fog_range:new i.Uniform2f(Pe),u_fog_color:new i.Uniform4f(Pe),u_fog_horizon_blend:new i.Uniform1f(Pe),u_fog_temporal_offset:new i.Uniform1f(Pe),u_frustum_tl:new i.Uniform3f(Pe),u_frustum_tr:new i.Uniform3f(Pe),u_frustum_br:new i.Uniform3f(Pe),u_frustum_bl:new i.Uniform3f(Pe),u_globe_pos:new i.Uniform3f(Pe),u_globe_radius:new i.Uniform1f(Pe),u_globe_transition:new i.Uniform1f(Pe),u_is_globe:new i.Uniform1i(Pe),u_viewport:new i.Uniform2f(Pe)}))(o))}}setTerrainUniformValues(o,f){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in f)x[S]&&x[S].set(this.program,S,f[S])}}setGlobeUniformValues(o,f){if(!this.globeUniforms)return;const x=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in f)x[S]&&x[S].set(this.program,S,f[S])}}setFogUniformValues(o,f){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const S in f)x[S].set(this.program,S,f[S])}}draw(o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re){const Pe=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(x),o.setStencilMode(S),o.setColorMode(k),o.setCullFace(O);for(const Ne of Object.keys(this.fixedUniforms))this.fixedUniforms[Ne].set(this.program,Ne,V[Ne]);Le&&Le.setUniforms(this.program,o,this.binderUniforms,Te,{zoom:Be});const ze={[Pe.LINES]:2,[Pe.TRIANGLES]:3,[Pe.LINE_STRIP]:1}[f];for(const Ne of ge.get()){const Fe=Ne.vaos||(Ne.vaos={});(Fe[G]||(Fe[G]=new nc)).bind(o,this,te,Le?Le.getPaintVertexBuffers():[],ie,Ne.vertexOffset,Re||[]),Pe.drawElements(f,Ne.primitiveLength*ze,Pe.UNSIGNED_SHORT,Ne.primitiveOffset*ze*2)}}}function rc(_,o){const f=Math.pow(2,o.tileID.overscaledZ),x=o.tileSize*Math.pow(2,_.transform.tileZoom)/f,S=x*(o.tileID.canonical.x+o.tileID.wrap*f),k=x*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_tile_units_to_pixels:1/Li(o,1,_.transform.tileZoom),u_pixel_coord_upper:[S>>16,k>>16],u_pixel_coord_lower:[65535&S,65535&k]}}const zc=i.create(),Dc=(_,o,f,x,S,k,O,V,G,te,ie)=>{const ge=o.style.light,Te=ge.properties.get("position"),Be=[Te.x,Te.y,Te.z],Le=i.create$1();ge.properties.get("anchor")==="viewport"&&(i.fromRotation(Le,-o.transform.angle),i.transformMat3(Be,Be,Le));const Re=ge.properties.get("color"),Pe=o.transform,ze={u_matrix:_,u_lightpos:Be,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Re.r,Re.g,Re.b],u_vertical_gradient:+f,u_opacity:x,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:k};return Pe.projection.name==="globe"&&(ze.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],ze.u_zoom_transition=G,ze.u_inv_rot_matrix=ie,ze.u_merc_center=te,ze.u_up_dir=Pe.projection.upVector(new i.CanonicalTileID(0,0,0),te[0]*i.EXTENT,te[1]*i.EXTENT),ze.u_height_lift=V),ze},Iu=(_,o,f,x,S,k,O,V,G,te,ie,ge)=>{const Te=Dc(_,o,f,x,S,k,O,G,te,ie,ge),Be={u_height_factor:-Math.pow(2,O.overscaledZ)/V.tileSize/8};return i.extend(Te,rc(o,V),Be)},Lc=_=>({u_matrix:_}),Au=(_,o,f)=>i.extend(Lc(_),rc(o,f)),Bc=(_,o)=>({u_matrix:_,u_world:o}),Rc=(_,o,f,x)=>i.extend(Au(_,o,f),{u_world:x}),ca=i.create(),qh=(_,o,f,x,S,k)=>{const O=_.transform,V=O.projection.name==="globe";let G;if(k.paint.get("circle-pitch-alignment")==="map")if(V){const ie=i.globePixelsToTileUnits(O.zoom,o.canonical)*O._pixelsPerMercatorPixel;G=Float32Array.from([ie,0,0,ie])}else G=O.calculatePixelsToTileUnitsMatrix(f);else G=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const te={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:_.translatePosMatrix(o.projMatrix,f,k.paint.get("circle-translate"),k.paint.get("circle-translate-anchor")),u_device_pixel_ratio:i.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(V){te.u_inv_rot_matrix=x,te.u_merc_center=S,te.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],te.u_zoom_transition=i.globeToMercatorTransition(O.zoom);const ie=S[0]*i.EXTENT,ge=S[1]*i.EXTENT;te.u_up_dir=O.projection.upVector(new i.CanonicalTileID(0,0,0),ie,ge)}return te},Zh=_=>{const o=[];return _.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),_.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},Oc=(_,o,f,x)=>{const S=i.EXTENT/f.tileSize;return{u_matrix:_,u_camera_to_center_distance:o.getCameraToCenterDistance(x),u_extrude_scale:[o.pixelsToGLUnits[0]/S,o.pixelsToGLUnits[1]/S]}},ua=(_,o,f=1)=>({u_matrix:_,u_color:o,u_overlay:0,u_overlay_scale:f}),Fc=i.create(),ll=(_,o,f,x,S,k,O)=>{const V=_.transform,G=V.projection.name==="globe",te=G?i.globePixelsToTileUnits(V.zoom,o.canonical)*V._pixelsPerMercatorPixel:Li(f,1,k),ie={u_matrix:o.projMatrix,u_extrude_scale:te,u_intensity:O,u_inv_rot_matrix:Fc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){ie.u_inv_rot_matrix=x,ie.u_merc_center=S,ie.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],ie.u_zoom_transition=i.globeToMercatorTransition(V.zoom);const ge=S[0]*i.EXTENT,Te=S[1]*i.EXTENT;ie.u_up_dir=V.projection.upVector(new i.CanonicalTileID(0,0,0),ge,Te)}return ie},Wh=(_,o,f,x,S,k,O)=>{const V=_.transform,G=V.calculatePixelsToTileUnitsMatrix(o);return{u_matrix:ph(_,o,f,x),u_pixels_to_tile_units:G,u_device_pixel_ratio:k,u_units_to_pixels:[1/V.pixelsToGLUnits[0],1/V.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:zl(f)?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Mu(o,_.transform),u_alpha_discard_threshold:0,u_trim_offset:O}},Gs=(_,o,f,x,S)=>{const k=_.transform;return{u_matrix:ph(_,o,f,x),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:Mu(o,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Mu(_,o){return 1/Li(_,1,o.tileZoom)}function ph(_,o,f,x){return _.translatePosMatrix(x||o.tileID.projMatrix,o,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function zl(_){const o=_.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const mh=(_,o,f,x,S,k)=>{return{u_matrix:_,u_tl_parent:o,u_scale_parent:f,u_fade_t:x.mix,u_opacity:x.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(V=S.paint.get("raster-saturation"),V>0?1-1/(1.001-V):-V),u_contrast_factor:(O=S.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:Vc(S.paint.get("raster-hue-rotate")),u_perspective_transform:k};var O,V};function Vc(_){_*=Math.PI/180;const o=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*o-f+1)/3,(Math.sqrt(3)*o-f+1)/3]}const Nc=i.create(),cl=(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re)=>{const Pe=S.transform,ze={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Pe.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:Pe.width/Pe.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:O,u_coord_matrix:V,u_is_text:+G,u_pitch_with_map:+x,u_texsize:te,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nc,u_up_vector:[0,-1,0]};return Re.name==="globe"&&(ze.u_tile_id=[ie.canonical.x,ie.canonical.y,1<<ie.canonical.z],ze.u_zoom_transition=ge,ze.u_inv_rot_matrix=Be,ze.u_merc_center=Te,ze.u_camera_forward=Pe._camera.forward(),ze.u_ecef_origin=i.globeECEFOrigin(Pe.globeMatrix,ie.toUnwrapped()),ze.u_tile_matrix=Float32Array.from(Pe.globeMatrix),ze.u_up_vector=Le),ze},Uc=(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re,Pe)=>i.extend(cl(_,o,f,x,S,k,O,V,G,te,ge,Te,Be,Le,Re,Pe),{u_gamma_scale:x?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:i.exported.devicePixelRatio,u_is_halo:+ie}),ku=(_,o,f,x,S,k,O,V,G,te,ie,ge,Te,Be,Le,Re)=>i.extend(Uc(_,o,f,x,S,k,O,V,!0,G,!0,ie,ge,Te,Be,Le,Re),{u_texsize_icon:te,u_texture_icon:1}),Pu=(_,o,f)=>({u_matrix:_,u_opacity:o,u_color:f}),gh=(_,o,f,x,S)=>i.extend(function(k,O,V){const G=O.imageManager.getPattern(k.toString()),{width:te,height:ie}=O.imageManager.getPixelSize(),ge=Math.pow(2,V.tileID.overscaledZ),Te=V.tileSize*Math.pow(2,O.transform.tileZoom)/ge,Be=Te*(V.tileID.canonical.x+V.tileID.wrap*ge),Le=Te*V.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[te,ie],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/Li(V,1,O.transform.tileZoom),u_pixel_coord_upper:[Be>>16,Le>>16],u_pixel_coord_lower:[65535&Be,65535&Le]}}(x,f,S),{u_matrix:_,u_opacity:o}),Vd={fillExtrusion:_=>({u_matrix:new i.UniformMatrix4f(_),u_lightpos:new i.Uniform3f(_),u_lightintensity:new i.Uniform1f(_),u_lightcolor:new i.Uniform3f(_),u_vertical_gradient:new i.Uniform1f(_),u_opacity:new i.Uniform1f(_),u_edge_radius:new i.Uniform1f(_),u_ao:new i.Uniform2f(_),u_tile_id:new i.Uniform3f(_),u_zoom_transition:new i.Uniform1f(_),u_inv_rot_matrix:new i.UniformMatrix4f(_),u_merc_center:new i.Uniform2f(_),u_up_dir:new i.Uniform3f(_),u_height_lift:new i.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new i.UniformMatrix4f(_),u_lightpos:new i.Uniform3f(_),u_lightintensity:new i.Uniform1f(_),u_lightcolor:new i.Uniform3f(_),u_vertical_gradient:new i.Uniform1f(_),u_height_factor:new i.Uniform1f(_),u_edge_radius:new i.Uniform1f(_),u_ao:new i.Uniform2f(_),u_tile_id:new i.Uniform3f(_),u_zoom_transition:new i.Uniform1f(_),u_inv_rot_matrix:new i.UniformMatrix4f(_),u_merc_center:new i.Uniform2f(_),u_up_dir:new i.Uniform3f(_),u_height_lift:new i.Uniform1f(_),u_image:new i.Uniform1i(_),u_texsize:new i.Uniform2f(_),u_pixel_coord_upper:new i.Uniform2f(_),u_pixel_coord_lower:new i.Uniform2f(_),u_tile_units_to_pixels:new i.Uniform1f(_),u_opacity:new i.Uniform1f(_)}),fill:_=>({u_matrix:new i.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new i.UniformMatrix4f(_),u_image:new i.Uniform1i(_),u_texsize:new i.Uniform2f(_),u_pixel_coord_upper:new i.Uniform2f(_),u_pixel_coord_lower:new i.Uniform2f(_),u_tile_units_to_pixels:new i.Uniform1f(_)}),fillOutline:_=>({u_matrix:new i.UniformMatrix4f(_),u_world:new i.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new i.UniformMatrix4f(_),u_world:new i.Uniform2f(_),u_image:new i.Uniform1i(_),u_texsize:new i.Uniform2f(_),u_pixel_coord_upper:new i.Uniform2f(_),u_pixel_coord_lower:new i.Uniform2f(_),u_tile_units_to_pixels:new i.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new i.Uniform1f(_),u_extrude_scale:new i.UniformMatrix2f(_),u_device_pixel_ratio:new i.Uniform1f(_),u_matrix:new i.UniformMatrix4f(_),u_inv_rot_matrix:new i.UniformMatrix4f(_),u_merc_center:new i.Uniform2f(_),u_tile_id:new i.Uniform3f(_),u_zoom_transition:new i.Uniform1f(_),u_up_dir:new i.Uniform3f(_)}),collisionBox:_=>({u_matrix:new i.UniformMatrix4f(_),u_camera_to_center_distance:new i.Uniform1f(_),u_extrude_scale:new i.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new i.UniformMatrix4f(_),u_inv_matrix:new i.UniformMatrix4f(_),u_camera_to_center_distance:new i.Uniform1f(_),u_viewport_size:new i.Uniform2f(_)}),debug:_=>({u_color:new i.UniformColor(_),u_matrix:new i.UniformMatrix4f(_),u_overlay:new i.Uniform1i(_),u_overlay_scale:new i.Uniform1f(_)}),clippingMask:_=>({u_matrix:new i.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new i.Uniform1f(_),u_intensity:new i.Uniform1f(_),u_matrix:new i.UniformMatrix4f(_),u_inv_rot_matrix:new i.UniformMatrix4f(_),u_merc_center:new i.Uniform2f(_),u_tile_id:new i.Uniform3f(_),u_zoom_transition:new i.Uniform1f(_),u_up_dir:new i.Uniform3f(_)}),heatmapTexture:_=>({u_image:new i.Uniform1i(_),u_color_ramp:new i.Uniform1i(_),u_opacity:new i.Uniform1f(_)}),hillshade:_=>({u_matrix:new i.UniformMatrix4f(_),u_image:new i.Uniform1i(_),u_latrange:new i.Uniform2f(_),u_light:new i.Uniform2f(_),u_shadow:new i.UniformColor(_),u_highlight:new i.UniformColor(_),u_accent:new i.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new i.UniformMatrix4f(_),u_image:new i.Uniform1i(_),u_dimension:new i.Uniform2f(_),u_zoom:new i.Uniform1f(_),u_unpack:new i.Uniform4f(_)}),line:_=>({u_matrix:new i.UniformMatrix4f(_),u_pixels_to_tile_units:new i.UniformMatrix2f(_),u_device_pixel_ratio:new i.Uniform1f(_),u_units_to_pixels:new i.Uniform2f(_),u_dash_image:new i.Uniform1i(_),u_gradient_image:new i.Uniform1i(_),u_image_height:new i.Uniform1f(_),u_texsize:new i.Uniform2f(_),u_tile_units_to_pixels:new i.Uniform1f(_),u_alpha_discard_threshold:new i.Uniform1f(_),u_trim_offset:new i.Uniform2f(_)}),linePattern:_=>({u_matrix:new i.UniformMatrix4f(_),u_texsize:new i.Uniform2f(_),u_pixels_to_tile_units:new i.UniformMatrix2f(_),u_device_pixel_ratio:new i.Uniform1f(_),u_image:new i.Uniform1i(_),u_units_to_pixels:new i.Uniform2f(_),u_tile_units_to_pixels:new i.Uniform1f(_),u_alpha_discard_threshold:new i.Uniform1f(_)}),raster:_=>({u_matrix:new i.UniformMatrix4f(_),u_tl_parent:new i.Uniform2f(_),u_scale_parent:new i.Uniform1f(_),u_fade_t:new i.Uniform1f(_),u_opacity:new i.Uniform1f(_),u_image0:new i.Uniform1i(_),u_image1:new i.Uniform1i(_),u_brightness_low:new i.Uniform1f(_),u_brightness_high:new i.Uniform1f(_),u_saturation_factor:new i.Uniform1f(_),u_contrast_factor:new i.Uniform1f(_),u_spin_weights:new i.Uniform3f(_),u_perspective_transform:new i.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new i.Uniform1i(_),u_is_size_feature_constant:new i.Uniform1i(_),u_size_t:new i.Uniform1f(_),u_size:new i.Uniform1f(_),u_camera_to_center_distance:new i.Uniform1f(_),u_rotate_symbol:new i.Uniform1i(_),u_aspect_ratio:new i.Uniform1f(_),u_fade_change:new i.Uniform1f(_),u_matrix:new i.UniformMatrix4f(_),u_label_plane_matrix:new i.UniformMatrix4f(_),u_coord_matrix:new i.UniformMatrix4f(_),u_is_text:new i.Uniform1i(_),u_pitch_with_map:new i.Uniform1i(_),u_texsize:new i.Uniform2f(_),u_tile_id:new i.Uniform3f(_),u_zoom_transition:new i.Uniform1f(_),u_inv_rot_matrix:new i.UniformMatrix4f(_),u_merc_center:new i.Uniform2f(_),u_camera_forward:new i.Uniform3f(_),u_tile_matrix:new i.UniformMatrix4f(_),u_up_vector:new i.Uniform3f(_),u_ecef_origin:new i.Uniform3f(_),u_texture:new i.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new i.Uniform1i(_),u_is_size_feature_constant:new i.Uniform1i(_),u_size_t:new i.Uniform1f(_),u_size:new i.Uniform1f(_),u_camera_to_center_distance:new i.Uniform1f(_),u_rotate_symbol:new i.Uniform1i(_),u_aspect_ratio:new i.Uniform1f(_),u_fade_change:new i.Uniform1f(_),u_matrix:new i.UniformMatrix4f(_),u_label_plane_matrix:new i.UniformMatrix4f(_),u_coord_matrix:new i.UniformMatrix4f(_),u_is_text:new i.Uniform1i(_),u_pitch_with_map:new i.Uniform1i(_),u_texsize:new i.Uniform2f(_),u_texture:new i.Uniform1i(_),u_gamma_scale:new i.Uniform1f(_),u_device_pixel_ratio:new i.Uniform1f(_),u_tile_id:new i.Uniform3f(_),u_zoom_transition:new i.Uniform1f(_),u_inv_rot_matrix:new i.UniformMatrix4f(_),u_merc_center:new i.Uniform2f(_),u_camera_forward:new i.Uniform3f(_),u_tile_matrix:new i.UniformMatrix4f(_),u_up_vector:new i.Uniform3f(_),u_ecef_origin:new i.Uniform3f(_),u_is_halo:new i.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new i.Uniform1i(_),u_is_size_feature_constant:new i.Uniform1i(_),u_size_t:new i.Uniform1f(_),u_size:new i.Uniform1f(_),u_camera_to_center_distance:new i.Uniform1f(_),u_rotate_symbol:new i.Uniform1i(_),u_aspect_ratio:new i.Uniform1f(_),u_fade_change:new i.Uniform1f(_),u_matrix:new i.UniformMatrix4f(_),u_label_plane_matrix:new i.UniformMatrix4f(_),u_coord_matrix:new i.UniformMatrix4f(_),u_is_text:new i.Uniform1i(_),u_pitch_with_map:new i.Uniform1i(_),u_texsize:new i.Uniform2f(_),u_texsize_icon:new i.Uniform2f(_),u_texture:new i.Uniform1i(_),u_texture_icon:new i.Uniform1i(_),u_gamma_scale:new i.Uniform1f(_),u_device_pixel_ratio:new i.Uniform1f(_),u_is_halo:new i.Uniform1i(_)}),background:_=>({u_matrix:new i.UniformMatrix4f(_),u_opacity:new i.Uniform1f(_),u_color:new i.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new i.UniformMatrix4f(_),u_opacity:new i.Uniform1f(_),u_image:new i.Uniform1i(_),u_pattern_tl:new i.Uniform2f(_),u_pattern_br:new i.Uniform2f(_),u_texsize:new i.Uniform2f(_),u_pattern_size:new i.Uniform2f(_),u_pixel_coord_upper:new i.Uniform2f(_),u_pixel_coord_lower:new i.Uniform2f(_),u_tile_units_to_pixels:new i.Uniform1f(_)}),terrainRaster:Pc,terrainDepth:Pc,skybox:_=>({u_matrix:new i.UniformMatrix4f(_),u_sun_direction:new i.Uniform3f(_),u_cubemap:new i.Uniform1i(_),u_opacity:new i.Uniform1f(_),u_temporal_offset:new i.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new i.UniformMatrix4f(_),u_color_ramp:new i.Uniform1i(_),u_center_direction:new i.Uniform3f(_),u_radius:new i.Uniform1f(_),u_opacity:new i.Uniform1f(_),u_temporal_offset:new i.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new i.UniformMatrix3f(_),u_sun_direction:new i.Uniform3f(_),u_sun_intensity:new i.Uniform1f(_),u_color_tint_r:new i.Uniform4f(_),u_color_tint_m:new i.Uniform4f(_),u_luminance:new i.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new i.UniformMatrix4f(_),u_globe_matrix:new i.UniformMatrix4f(_),u_normalize_matrix:new i.UniformMatrix4f(_),u_merc_matrix:new i.UniformMatrix4f(_),u_zoom_transition:new i.Uniform1f(_),u_merc_center:new i.Uniform2f(_),u_image0:new i.Uniform1i(_),u_grid_matrix:new i.UniformMatrix3f(_),u_frustum_tl:new i.Uniform3f(_),u_frustum_tr:new i.Uniform3f(_),u_frustum_br:new i.Uniform3f(_),u_frustum_bl:new i.Uniform3f(_),u_globe_pos:new i.Uniform3f(_),u_globe_radius:new i.Uniform1f(_),u_viewport:new i.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new i.Uniform3f(_),u_frustum_tr:new i.Uniform3f(_),u_frustum_br:new i.Uniform3f(_),u_frustum_bl:new i.Uniform3f(_),u_horizon:new i.Uniform1f(_),u_transition:new i.Uniform1f(_),u_fadeout_range:new i.Uniform1f(_),u_color:new i.Uniform4f(_),u_high_color:new i.Uniform4f(_),u_space_color:new i.Uniform4f(_),u_star_intensity:new i.Uniform1f(_),u_star_density:new i.Uniform1f(_),u_star_size:new i.Uniform1f(_),u_temporal_offset:new i.Uniform1f(_),u_horizon_angle:new i.Uniform1f(_),u_rotation_matrix:new i.UniformMatrix4f(_)})};let oc;function sc(_,o,f,x,S,k,O){const V=_.context,G=V.gl,te=_.transform,ie=_.useProgram("collisionBox"),ge=[];let Te=0,Be=0;for(let et=0;et<x.length;et++){const ut=x[et],lt=o.getTile(ut),yt=lt.getBucket(f);if(!yt)continue;const $t=Sl(ut,yt,te);let Dt=$t;S[0]===0&&S[1]===0||(Dt=_.translatePosMatrix($t,lt,S,k));const Et=O?yt.textCollisionBox:yt.iconCollisionBox,bi=yt.collisionCircleArray;if(bi.length>0){const wt=i.create(),ei=Dt;i.mul(wt,yt.placementInvProjMatrix,te.glCoordMatrix),i.mul(wt,wt,yt.placementViewportMatrix),ge.push({circleArray:bi,circleOffset:Be,transform:ei,invTransform:wt,projection:yt.getProjection()}),Te+=bi.length/4,Be=Te}Et&&(_.terrain&&_.terrain.setupElevationDraw(lt,ie),ie.draw(V,G.LINES,i.DepthMode.disabled,i.StencilMode.disabled,_.colorModeForRenderPass(),i.CullFaceMode.disabled,Oc(Dt,te,lt,yt.getProjection()),f.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,te.zoom,null,[Et.collisionVertexBuffer,Et.collisionVertexBufferExt]))}if(!O||!ge.length)return;const Le=_.useProgram("collisionCircle"),Re=new i.StructArrayLayout2f1f2i16;Re.resize(4*Te),Re._trim();let Pe=0;for(const et of ge)for(let ut=0;ut<et.circleArray.length/4;ut++){const lt=4*ut,yt=et.circleArray[lt+0],$t=et.circleArray[lt+1],Dt=et.circleArray[lt+2],Et=et.circleArray[lt+3];Re.emplace(Pe++,yt,$t,Dt,Et,0),Re.emplace(Pe++,yt,$t,Dt,Et,1),Re.emplace(Pe++,yt,$t,Dt,Et,2),Re.emplace(Pe++,yt,$t,Dt,Et,3)}(!oc||oc.length<2*Te)&&(oc=function(et){const ut=2*et,lt=new i.StructArrayLayout3ui6;lt.resize(ut),lt._trim();for(let yt=0;yt<ut;yt++){const $t=6*yt;lt.uint16[$t+0]=4*yt+0,lt.uint16[$t+1]=4*yt+1,lt.uint16[$t+2]=4*yt+2,lt.uint16[$t+3]=4*yt+2,lt.uint16[$t+4]=4*yt+3,lt.uint16[$t+5]=4*yt+0}return lt}(Te));const ze=V.createIndexBuffer(oc,!0),Ne=V.createVertexBuffer(Re,i.collisionCircleLayout.members,!0);for(const et of ge){const ut={u_matrix:et.transform,u_inv_matrix:et.invTransform,u_camera_to_center_distance:(Fe=te).getCameraToCenterDistance(et.projection),u_viewport_size:[Fe.width,Fe.height]};Le.draw(V,G.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,_.colorModeForRenderPass(),i.CullFaceMode.disabled,ut,f.id,Ne,ze,i.SegmentVector.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,te.zoom)}var Fe;Ne.destroy(),ze.destroy()}const $c=i.create();function zu({width:_,height:o,anchor:f,textOffset:x,textScale:S},k){const{horizontalAlign:O,verticalAlign:V}=i.getAnchorAlignment(f),G=-(O-.5)*_,te=-(V-.5)*o,ie=i.evaluateVariableOffset(f,x);return new i.pointGeometry((G/S+ie[0])*k,(te/S+ie[1])*k)}function jc(_,o,f,x,S,k,O,V,G,te,ie){const ge=_.text.placedSymbolArray,Te=_.text.dynamicLayoutVertexArray,Be=_.icon.dynamicLayoutVertexArray,Le={},Re=_.getProjection(),Pe=Cl(V,Re,k),ze=k.elevation,Ne=Re.upVectorScale(V.canonical,k.center.lat,k.worldSize).metersToTile;Te.clear();for(let Fe=0;Fe<ge.length;Fe++){const et=ge.get(Fe),{tileAnchorX:ut,tileAnchorY:lt,numGlyphs:yt}=et,$t=_.allowVerticalPlacement&&!et.placedOrientation,Dt=et.hidden||!et.crossTileID||$t?null:x[et.crossTileID];if(Dt){let Et=0,bi=0,wt=0;if(ze){const sn=ze?ze.getAtTileOffset(V,ut,lt):0,[vn,rn,Cn]=Re.upVector(V.canonical,ut,lt);Et=sn*vn*Ne,bi=sn*rn*Ne,wt=sn*Cn*Ne}let[ei,qt,pi,Gt]=Wn(et.projectedAnchorX+Et,et.projectedAnchorY+bi,et.projectedAnchorZ+wt,f?Pe:O);const ai=Fi(k.getCameraToCenterDistance(Re),Gt);let Ti=S.evaluateSizeForFeature(_.textSizeData,te,et)*ai/i.ONE_EM;f&&(Ti*=_.tilePixelRatio/G);const St=zu(Dt,Ti);f?({x:ei,y:qt,z:pi}=Re.projectTilePoint(ut+St.x,lt+St.y,V.canonical),[ei,qt,pi]=Wn(ei+Et,qt+bi,pi+wt,O)):(o&&St._rotate(-k.angle),ei+=St.x,qt+=St.y,pi=0);const Zt=_.allowVerticalPlacement&&et.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let sn=0;sn<yt;sn++)i.addDynamicAttributes(Te,ei,qt,pi,Zt);ie&&et.associatedIconIndex>=0&&(Le[et.associatedIconIndex]={x:ei,y:qt,z:pi,angle:Zt})}else ns(yt,Te)}if(ie){Be.clear();const Fe=_.icon.placedSymbolArray;for(let et=0;et<Fe.length;et++){const ut=Fe.get(et),{numGlyphs:lt}=ut,yt=Le[et];if(ut.hidden||!yt)ns(lt,Be);else{const{x:$t,y:Dt,z:Et,angle:bi}=yt;for(let wt=0;wt<lt;wt++)i.addDynamicAttributes(Be,$t,Dt,Et,bi)}}_.icon.dynamicLayoutVertexBuffer.updateData(Be)}_.text.dynamicLayoutVertexBuffer.updateData(Te)}function Ps(_,o,f){return f.iconsInText&&o?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function va(_,o,f,x,S,k,O,V,G,te,ie,ge){const Te=_.context,Be=Te.gl,Le=_.transform,Re=V==="map",Pe=G==="map",ze=Re&&f.layout.get("symbol-placement")!=="point",Ne=Re&&!Pe&&!ze,Fe=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let et=!1;const ut=_.depthModeForSublayer(0,i.DepthMode.ReadOnly),lt=[i.mercatorXfromLng(Le.center.lng),i.mercatorYfromLat(Le.center.lat)],yt=f.layout.get("text-variable-anchor"),$t=Le.projection.name==="globe",Dt=[],Et=[0,-1,0];let bi=Et;!$t&&!Le.mercatorFromTransition||Re||(bi=function(wt){const ei=wt._camera.getWorldToCamera(wt.worldSize,1),qt=i.multiply([],ei,wt.globeMatrix);i.invert(qt,qt);const pi=[0,0,0],Gt=[0,1,0,0];return i.transformMat4$1(Gt,Gt,qt),pi[0]=Gt[0],pi[1]=Gt[1],pi[2]=Gt[2],i.normalize(pi,pi),pi}(Le));for(const wt of x){const ei=o.getTile(wt),qt=ei.getBucket(f);if(!qt||qt.projection.name==="mercator"&&$t)continue;const pi=S?qt.text:qt.icon;if(!pi||qt.fullyClipped||!pi.segments.get().length)continue;const Gt=pi.programConfigurations.get(f.id),ai=S||qt.sdfIcons,Ti=S?qt.textSizeData:qt.iconSizeData,St=Pe||Le.pitch!==0,Zt=i.evaluateSizeForZoom(Ti,Le.zoom);let sn,vn,rn,Cn,Nn=[0,0],gn=null;if(S){if(vn=ei.glyphAtlasTexture,rn=Be.LINEAR,sn=ei.glyphAtlasTexture.size,qt.iconsInText){Nn=ei.imageAtlasTexture.size,gn=ei.imageAtlasTexture;const Sa=Ti.kind==="composite"||Ti.kind==="camera";Cn=St||_.options.rotating||_.options.zooming||Sa?Be.LINEAR:Be.NEAREST}}else{const Sa=f.layout.get("icon-size").constantOr(0)!==1||qt.iconsNeedLinear;vn=ei.imageAtlasTexture,rn=ai||_.options.rotating||_.options.zooming||Sa||St?Be.LINEAR:Be.NEAREST,sn=ei.imageAtlasTexture.size}const Yi=qt.projection.name==="globe",br=Yi?bi:Et,Ir=Yi?i.globeToMercatorTransition(Le.zoom):0,Ar=Cl(wt,qt.getProjection(),Le),Mr=Le.calculatePixelsToTileUnitsMatrix(ei),Ts=$r(Ar,ei.tileID.canonical,Pe,Re,Le,qt.getProjection(),Mr),Ea=_.terrain&&Pe&&ze?i.invert(i.create(),Ts):$c,Ws=Sc(Ar,ei.tileID.canonical,Pe,Re,Le,qt.getProjection(),Mr),xo=yt&&qt.hasTextData(),er=f.layout.get("icon-text-fit")!=="none"&&xo&&qt.hasIconData();if(ze){const Sa=Le.elevation,ml=Sa?Sa.getAtTileOffsetFunc(wt,Le.center.lat,Le.worldSize,qt.getProjection()):null,Ol=el(Ar,ei.tileID.canonical,Pe,Re,Le,qt.getProjection(),Mr);Xn(qt,Ar,_,S,Ol,Ws,Pe,te,ml,wt)}const Or=ze||S&&yt||er,_r=_.translatePosMatrix(Ar,ei,k,O),Do=Or?$c:Ts,ss=_.translatePosMatrix(Ws,ei,k,O,!0),Kr=qt.getProjection().createInversionMatrix(Le,wt.canonical),Ds=[];_.terrainRenderModeElevated()&&Pe&&Ds.push("PITCH_WITH_MAP_TERRAIN"),Yi&&Ds.push("PROJECTION_GLOBE_VIEW"),Or&&Ds.push("PROJECTED_POS_ON_VIEWPORT");const _h=ai&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $a;$a=ai?qt.iconsInText?ku(Ti.kind,Zt,Ne,Pe,_,_r,Do,ss,sn,Nn,wt,Ir,lt,Kr,br,qt.getProjection()):Uc(Ti.kind,Zt,Ne,Pe,_,_r,Do,ss,S,sn,!0,wt,Ir,lt,Kr,br,qt.getProjection()):cl(Ti.kind,Zt,Ne,Pe,_,_r,Do,ss,S,sn,wt,Ir,lt,Kr,br,qt.getProjection());const Es={program:_.useProgram(Ps(ai,S,qt),Gt,Ds),buffers:pi,uniformValues:$a,atlasTexture:vn,atlasTextureIcon:gn,atlasInterpolation:rn,atlasInterpolationIcon:Cn,isSDF:ai,hasHalo:_h,tile:ei,labelPlaneMatrixInv:Ea};if(Fe&&qt.canOverlap){et=!0;const Sa=pi.segments.get();for(const ml of Sa)Dt.push({segments:new i.SegmentVector([ml]),sortKey:ml.sortKey,state:Es})}else Dt.push({segments:pi.segments,sortKey:0,state:Es})}et&&Dt.sort((wt,ei)=>wt.sortKey-ei.sortKey);for(const wt of Dt){const ei=wt.state;if(_.terrain&&_.terrain.setupElevationDraw(ei.tile,ei.program,{useDepthForOcclusion:!$t,labelPlaneMatrixInv:ei.labelPlaneMatrixInv}),Te.activeTexture.set(Be.TEXTURE0),ei.atlasTexture.bind(ei.atlasInterpolation,Be.CLAMP_TO_EDGE),ei.atlasTextureIcon&&(Te.activeTexture.set(Be.TEXTURE1),ei.atlasTextureIcon&&ei.atlasTextureIcon.bind(ei.atlasInterpolationIcon,Be.CLAMP_TO_EDGE)),ei.isSDF){const qt=ei.uniformValues;ei.hasHalo&&(qt.u_is_halo=1,zs(ei.buffers,wt.segments,f,_,ei.program,ut,ie,ge,qt)),qt.u_is_halo=0}zs(ei.buffers,wt.segments,f,_,ei.program,ut,ie,ge,ei.uniformValues)}}function zs(_,o,f,x,S,k,O,V,G){const te=x.context,ie=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];S.draw(te,te.gl.TRIANGLES,k,O,V,i.CullFaceMode.disabled,G,f.id,_.layoutVertexBuffer,_.indexBuffer,o,f.paint,x.transform.zoom,_.programConfigurations.get(f.id),ie)}function Nd(_,o,f,x,S,k,O){const V=_.context.gl,G=f.paint.get("fill-pattern"),te=G&&G.constantOr(1);let ie,ge,Te,Be,Le;O?(ge=te&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ie=V.LINES):(ge=te?"fillPattern":"fill",ie=V.TRIANGLES);for(const Re of x){const Pe=o.getTile(Re);if(te&&!Pe.patternsLoaded())continue;const ze=Pe.getBucket(f);if(!ze)continue;_.prepareDrawTile();const Ne=ze.programConfigurations.get(f.id),Fe=_.useProgram(ge,Ne);te&&(_.context.activeTexture.set(V.TEXTURE0),Pe.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Ne.updatePaintBuffers());const et=G.constantOr(null);if(et&&Pe.imageAtlas){const lt=Pe.imageAtlas.patternPositions[et.toString()];lt&&Ne.setConstantPatternPositions(lt)}const ut=_.translatePosMatrix(Re.projMatrix,Pe,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(O){Be=ze.indexBuffer2,Le=ze.segments2;const lt=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];Te=ge==="fillOutlinePattern"&&te?Rc(ut,_,Pe,lt):Bc(ut,lt)}else Be=ze.indexBuffer,Le=ze.segments,Te=te?Au(ut,_,Pe):Lc(ut);_.prepareDrawProgram(_.context,Fe,Re.toUnwrapped()),Fe.draw(_.context,ie,S,_.stencilModeForClipping(Re),k,i.CullFaceMode.disabled,Te,f.id,ze.layoutVertexBuffer,Be,Le,f.paint,_.transform.zoom,Ne)}}function Va(_,o,f,x,S,k,O){const V=_.context,G=V.gl,te=_.transform,ie=f.paint.get("fill-extrusion-pattern"),ge=ie.constantOr(1),Te=f.paint.get("fill-extrusion-opacity"),Be=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],Le=f.layout.get("fill-extrusion-edge-radius"),Re=te.projection.name==="globe"?i.fillExtrusionHeightLift():0,Pe=te.projection.name==="globe",ze=Pe?i.globeToMercatorTransition(te.zoom):0,Ne=[i.mercatorXfromLng(te.center.lng),i.mercatorYfromLat(te.center.lat)],Fe=[];Pe&&(Fe.push("PROJECTION_GLOBE_VIEW"),_.style.terrainSetForDrapingOnly()&&Fe.push("TERRAIN")),Be[0]>0&&Fe.push("FAUX_AO");for(const et of x){const ut=o.getTile(et),lt=ut.getBucket(f);if(!lt||lt.projection.name!==te.projection.name)continue;const yt=lt.programConfigurations.get(f.id),$t=_.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",yt,Fe);if(_.terrain){const pi=_.terrain;if(_.style.terrainSetForDrapingOnly())pi.setupElevationDraw(ut,$t,{useMeterToDem:!0});else{if(!lt.enableTerrain)continue;if(pi.setupElevationDraw(ut,$t,{useMeterToDem:!0}),Ud(V,o,et,lt,f,pi),!lt.centroidVertexBuffer){const Gt=$t.attributes.a_centroid_pos;Gt!==void 0&&G.vertexAttrib2f(Gt,0,0)}}}ge&&(_.context.activeTexture.set(G.TEXTURE0),ut.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),yt.updatePaintBuffers());const Dt=ie.constantOr(null);if(Dt&&ut.imageAtlas){const pi=ut.imageAtlas.patternPositions[Dt.toString()];pi&&yt.setConstantPatternPositions(pi)}const Et=_.translatePosMatrix(et.projMatrix,ut,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),bi=te.projection.createInversionMatrix(te,et.canonical),wt=f.paint.get("fill-extrusion-vertical-gradient"),ei=ge?Iu(Et,_,wt,Te,Be,Le,et,ut,Re,ze,Ne,bi):Dc(Et,_,wt,Te,Be,Le,et,Re,ze,Ne,bi);_.prepareDrawProgram(V,$t,et.toUnwrapped());const qt=[];_.terrain&&qt.push(lt.centroidVertexBuffer),Pe&&qt.push(lt.layoutVertexExtBuffer),$t.draw(V,V.gl.TRIANGLES,S,k,O,i.CullFaceMode.backCCW,ei,f.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,f.paint,_.transform.zoom,yt,qt)}}function Ud(_,o,f,x,S,k){const O=[ze=>{let Ne=ze.canonical.x-1,Fe=ze.wrap;return Ne<0&&(Ne=(1<<ze.canonical.z)-1,Fe--),new i.OverscaledTileID(ze.overscaledZ,Fe,ze.canonical.z,Ne,ze.canonical.y)},ze=>{let Ne=ze.canonical.x+1,Fe=ze.wrap;return Ne===1<<ze.canonical.z&&(Ne=0,Fe++),new i.OverscaledTileID(ze.overscaledZ,Fe,ze.canonical.z,Ne,ze.canonical.y)},ze=>new i.OverscaledTileID(ze.overscaledZ,ze.wrap,ze.canonical.z,ze.canonical.x,(ze.canonical.y===0?1<<ze.canonical.z:ze.canonical.y)-1),ze=>new i.OverscaledTileID(ze.overscaledZ,ze.wrap,ze.canonical.z,ze.canonical.x,ze.canonical.y===(1<<ze.canonical.z)-1?0:ze.canonical.y+1)],V=ze=>{const Ne=o.getSource().minzoom,Fe=ut=>{const lt=o.getTileByID(ut);if(lt&&lt.hasData())return lt.getBucket(S)},et=[0,-1,1];for(const ut of et){if(ze.overscaledZ+ut<Ne)continue;const lt=Fe(ze.calculateScaledKey(ze.overscaledZ+ut));if(lt)return lt}},G=[0,0,0],te=(ze,Ne)=>(G[0]=Math.min(ze.min.y,Ne.min.y),G[1]=Math.max(ze.max.y,Ne.max.y),G[2]=i.EXTENT-Ne.min.x>ze.max.x?Ne.min.x-i.EXTENT:ze.max.x,G),ie=(ze,Ne)=>(G[0]=Math.min(ze.min.x,Ne.min.x),G[1]=Math.max(ze.max.x,Ne.max.x),G[2]=i.EXTENT-Ne.min.y>ze.max.y?Ne.min.y-i.EXTENT:ze.max.y,G),ge=[(ze,Ne)=>te(ze,Ne),(ze,Ne)=>te(Ne,ze),(ze,Ne)=>ie(ze,Ne),(ze,Ne)=>ie(Ne,ze)],Te=new i.pointGeometry(0,0);let Be,Le,Re;const Pe=(ze,Ne,Fe,et,ut)=>{const lt=[[et?Fe:ze,et?ze:Fe,0],[et?Fe:Ne,et?Ne:Fe,0]],yt=ut<0?i.EXTENT+ut:ut,$t=[et?yt:(ze+Ne)/2,et?(ze+Ne)/2:yt,0];return Fe===0&&ut<0||Fe!==0&&ut>0?k.getForTilePoints(Re,[$t],!0,Le):lt.push($t),k.getForTilePoints(f,lt,!0,Be),Math.max(lt[0][2],lt[1][2],$t[2])/k.exaggeration()};for(let ze=0;ze<4;ze++){const Ne=(ze<2?1:5)-ze,Fe=x.borders[ze];if(Fe.length===0)continue;const et=Re=O[ze](f),ut=V(et);if(!(ut&&ut instanceof i.FillExtrusionBucket&&ut.enableTerrain)||x.borderDoneWithNeighborZ[ze]===ut.canonical.z&&ut.borderDoneWithNeighborZ[Ne]===x.canonical.z||(Le=k.findDEMTileFor(et),!Le||!Le.dem))continue;if(!Be){const Dt=k.findDEMTileFor(f);if(!Dt||!Dt.dem)return;Be=Dt}const lt=ut.borders[Ne];let yt=0;const $t=ut.borderDoneWithNeighborZ[Ne]!==x.canonical.z;if(x.canonical.z===ut.canonical.z){for(let Dt=0;Dt<Fe.length;Dt++){const Et=x.featuresOnBorder[Fe[Dt]],bi=Et.borders[ze];let wt;for(;yt<lt.length&&(wt=ut.featuresOnBorder[lt[yt]],!(wt.borders[Ne][1]>bi[0]+3));)$t&&ut.encodeCentroid(void 0,wt,!1),yt++;if(wt&&yt<lt.length){const ei=yt;let qt=0;for(;!(wt.borders[Ne][0]>bi[1]-3)&&(qt++,++yt!==lt.length);)wt=ut.featuresOnBorder[lt[yt]];if(wt=ut.featuresOnBorder[lt[ei]],Et.intersectsCount()>1||wt.intersectsCount()>1||qt!==1){qt!==1&&(yt=ei),x.encodeCentroid(void 0,Et,!1),$t&&ut.encodeCentroid(void 0,wt,!1);continue}const pi=ge[ze](Et,wt),Gt=ze%2?i.EXTENT-1:0;Te.x=Pe(pi[0],Math.min(i.EXTENT-1,pi[1]),Gt,ze<2,pi[2]),Te.y=0,x.encodeCentroid(Te,Et,!1),$t&&ut.encodeCentroid(Te,wt,!1)}else x.encodeCentroid(void 0,Et,!1)}x.borderDoneWithNeighborZ[ze]=ut.canonical.z,x.needsCentroidUpdate=!0,$t&&(ut.borderDoneWithNeighborZ[Ne]=x.canonical.z,ut.needsCentroidUpdate=!0)}else{for(const Dt of Fe)x.encodeCentroid(void 0,x.featuresOnBorder[Dt],!1);if($t){for(const Dt of lt)ut.encodeCentroid(void 0,ut.featuresOnBorder[Dt],!1);ut.borderDoneWithNeighborZ[Ne]=x.canonical.z,ut.needsCentroidUpdate=!0}x.borderDoneWithNeighborZ[ze]=ut.canonical.z,x.needsCentroidUpdate=!0}}(x.needsCentroidUpdate||!x.centroidVertexBuffer&&x.centroidVertexArray.length!==0)&&x.uploadCentroid(_)}const ul=new i.Color(1,0,0,1),Du=new i.Color(0,1,0,1),Lu=new i.Color(0,0,1,1),Xh=new i.Color(1,0,1,1),$d=new i.Color(0,1,1,1);function Bu(_,o,f){const x=_.context,S=_.transform,k=x.gl,O=S.projection.name==="globe",V=O?["PROJECTION_GLOBE_VIEW"]:null;let G=f.projMatrix;if(O&&i.globeToMercatorTransition(S.zoom)>0){const Et=i.transitionTileAABBinECEF(f.canonical,S),bi=i.globeDenormalizeECEF(Et);G=i.multiply(new Float32Array(16),S.globeMatrix,bi),i.multiply(G,S.projMatrix,G)}const te=_.useProgram("debug",null,V),ie=o.getTileByID(f.key);_.terrain&&_.terrain.setupElevationDraw(ie,te);const ge=i.DepthMode.disabled,Te=i.StencilMode.disabled,Be=_.colorModeForRenderPass(),Le="$debug";x.activeTexture.set(k.TEXTURE0),_.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),O?ie._makeGlobeTileDebugBuffers(_.context,S):ie._makeDebugTileBoundsBuffers(_.context,S.projection);const Re=ie._tileDebugBuffer||_.debugBuffer,Pe=ie._tileDebugIndexBuffer||_.debugIndexBuffer,ze=ie._tileDebugSegments||_.debugSegments;te.draw(x,k.LINE_STRIP,ge,Te,Be,i.CullFaceMode.disabled,ua(G,i.Color.red),Le,Re,Pe,ze,null,null,null,[ie._globeTileDebugBorderBuffer]);const Ne=ie.latestRawTileData,Fe=Math.floor((Ne&&Ne.byteLength||0)/1024),et=o.getTile(f).tileSize,ut=512/Math.min(et,512)*(f.overscaledZ/S.zoom)*.5;let lt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(lt+=` => ${f.overscaledZ}`),lt+=` ${Fe}kb`,function(Et,bi){Et.initDebugOverlayCanvas();const wt=Et.debugOverlayCanvas,ei=Et.context.gl,qt=Et.debugOverlayCanvas.getContext("2d");qt.clearRect(0,0,wt.width,wt.height),qt.shadowColor="white",qt.shadowBlur=2,qt.lineWidth=1.5,qt.strokeStyle="white",qt.textBaseline="top",qt.font="bold 36px Open Sans, sans-serif",qt.fillText(bi,5,5),qt.strokeText(bi,5,5),Et.debugOverlayTexture.update(wt),Et.debugOverlayTexture.bind(ei.LINEAR,ei.CLAMP_TO_EDGE)}(_,lt);const yt=ie._tileDebugTextBuffer||_.debugBuffer,$t=ie._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Dt=ie._tileDebugTextSegments||_.debugSegments;te.draw(x,k.TRIANGLES,ge,Te,i.ColorMode.alphaBlended,i.CullFaceMode.disabled,ua(G,i.Color.transparent,ut),Le,yt,$t,Dt,null,null,null,[ie._globeTileDebugTextBuffer])}function ac(_,o,f,x){Zi(_,0,o+f/2,_.transform.width,f,x)}function ha(_,o,f,x){Zi(_,o-f/2,0,f,_.transform.height,x)}function Zi(_,o,f,x,S,k){const O=_.context,V=O.gl;V.enable(V.SCISSOR_TEST),V.scissor(o*i.exported.devicePixelRatio,f*i.exported.devicePixelRatio,x*i.exported.devicePixelRatio,S*i.exported.devicePixelRatio),O.clear({color:k}),V.disable(V.SCISSOR_TEST)}const Gc=i.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Dl}=Gc;function No(_,o,f,x){_.emplaceBack(o,f,x)}class hl{constructor(o){this.vertexArray=new i.StructArrayLayout3f12,this.indices=new i.StructArrayLayout3ui6,No(this.vertexArray,-1,-1,1),No(this.vertexArray,1,-1,1),No(this.vertexArray,-1,1,1),No(this.vertexArray,1,1,1),No(this.vertexArray,-1,-1,-1),No(this.vertexArray,1,-1,-1),No(this.vertexArray,-1,1,-1),No(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Dl),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.SegmentVector.simpleSegment(0,0,36,12)}}function Ni(_,o,f,x,S,k){const O=_.gl,V=o.paint.get("sky-atmosphere-color"),G=o.paint.get("sky-atmosphere-halo-color"),te=o.paint.get("sky-atmosphere-sun-intensity"),ie=((ge,Te,Be,Le,Re)=>({u_matrix_3f:ge,u_sun_direction:Te,u_sun_intensity:Be,u_color_tint_r:[Le.r,Le.g,Le.b,Le.a],u_color_tint_m:[Re.r,Re.g,Re.b,Re.a],u_luminance:5e-5}))(i.fromMat4(i.create$1(),x),S,te,V,G);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+k,o.skyboxTexture,0),f.draw(_,O.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.frontCW,ie,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const qc=i.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Sr{constructor(o){const f=new i.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const x=new i.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(f,qc.members),this.indexBuffer=o.createIndexBuffer(x),this.segments=i.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const lc={symbol:function(_,o,f,x,S){if(_.renderPass!=="translucent")return;const k=i.StencilMode.disabled,O=_.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(V,G,te,ie,ge,Te,Be){const Le=G.transform,Re=ge==="map",Pe=Te==="map";for(const ze of V){const Ne=ie.getTile(ze),Fe=Ne.getBucket(te);if(!Fe||!Fe.text||!Fe.text.segments.get().length)continue;const et=i.evaluateSizeForZoom(Fe.textSizeData,Le.zoom),ut=Cl(ze,Fe.getProjection(),Le),lt=Le.calculatePixelsToTileUnitsMatrix(Ne),yt=$r(ut,Ne.tileID.canonical,Pe,Re,Le,Fe.getProjection(),lt),$t=te.layout.get("icon-text-fit")!=="none"&&Fe.hasIconData();if(et){const Dt=Math.pow(2,Le.zoom-Ne.tileID.overscaledZ);jc(Fe,Re,Pe,Be,i.symbolSize,Le,yt,ze,Dt,et,$t)}}}(x,_,f,o,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&va(_,o,f,x,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),k,O),f.paint.get("text-opacity").constantOr(1)!==0&&va(_,o,f,x,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),k,O),o.map.showCollisionBoxes&&(sc(_,o,f,x,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),sc(_,o,f,x,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(_,o,f,x){if(_.renderPass!=="translucent")return;const S=f.paint.get("circle-opacity"),k=f.paint.get("circle-stroke-width"),O=f.paint.get("circle-stroke-opacity"),V=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(k.constantOr(1)===0||O.constantOr(1)===0))return;const G=_.context,te=G.gl,ie=_.transform,ge=_.depthModeForSublayer(0,i.DepthMode.ReadOnly),Te=i.StencilMode.disabled,Be=_.colorModeForRenderPass(),Le=ie.projection.name==="globe",Re=[i.mercatorXfromLng(ie.center.lng),i.mercatorYfromLat(ie.center.lat)],Pe=[];for(let Ne=0;Ne<x.length;Ne++){const Fe=x[Ne],et=o.getTile(Fe),ut=et.getBucket(f);if(!ut||ut.projection.name!==ie.projection.name)continue;const lt=ut.programConfigurations.get(f.id),yt=Zh(f);Le&&yt.push("PROJECTION_GLOBE_VIEW");const $t=_.useProgram("circle",lt,yt),Dt=ut.layoutVertexBuffer,Et=ut.globeExtVertexBuffer,bi=ut.indexBuffer,wt=ie.projection.createInversionMatrix(ie,Fe.canonical),ei={programConfiguration:lt,program:$t,layoutVertexBuffer:Dt,globeExtVertexBuffer:Et,indexBuffer:bi,uniformValues:qh(_,Fe,et,wt,Re,f),tile:et};if(V){const qt=ut.segments.get();for(const pi of qt)Pe.push({segments:new i.SegmentVector([pi]),sortKey:pi.sortKey,state:ei})}else Pe.push({segments:ut.segments,sortKey:0,state:ei})}V&&Pe.sort((Ne,Fe)=>Ne.sortKey-Fe.sortKey);const ze={useDepthForOcclusion:!Le};for(const Ne of Pe){const{programConfiguration:Fe,program:et,layoutVertexBuffer:ut,globeExtVertexBuffer:lt,indexBuffer:yt,uniformValues:$t,tile:Dt}=Ne.state,Et=Ne.segments;_.terrain&&_.terrain.setupElevationDraw(Dt,et,ze),_.prepareDrawProgram(G,et,Dt.tileID.toUnwrapped()),et.draw(G,te.TRIANGLES,ge,Te,Be,i.CullFaceMode.disabled,$t,f.id,ut,yt,Et,f.paint,ie.zoom,Fe,[lt])}},heatmap:function(_,o,f,x){if(f.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const S=_.context,k=S.gl,O=i.StencilMode.disabled,V=new i.ColorMode([k.ONE,k.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(Be,Le,Re,Pe){const ze=Be.gl,Ne=Le.width*Pe,Fe=Le.height*Pe;Be.activeTexture.set(ze.TEXTURE1),Be.viewport.set([0,0,Ne,Fe]);let et=Re.heatmapFbo;if(!et||et&&(et.width!==Ne||et.height!==Fe)){et&&et.destroy();const ut=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,ut),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),et=Re.heatmapFbo=Be.createFramebuffer(Ne,Fe,!1),function(lt,yt,$t,Dt,Et,bi){const wt=lt.gl;wt.texImage2D(wt.TEXTURE_2D,0,wt.RGBA,Et,bi,0,wt.RGBA,lt.extRenderToTextureHalfFloat?lt.extTextureHalfFloat.HALF_FLOAT_OES:wt.UNSIGNED_BYTE,null),Dt.colorAttachment.set($t)}(Be,0,ut,et,Ne,Fe)}else ze.bindTexture(ze.TEXTURE_2D,et.colorAttachment.get()),Be.bindFramebuffer.set(et.framebuffer)})(S,_,f,_.transform.projection.name==="globe"?.5:.25),S.clear({color:i.Color.transparent});const G=_.transform,te=G.projection.name==="globe",ie=te?["PROJECTION_GLOBE_VIEW"]:null,ge=te?i.CullFaceMode.frontCCW:i.CullFaceMode.disabled,Te=[i.mercatorXfromLng(G.center.lng),i.mercatorYfromLat(G.center.lat)];for(let Be=0;Be<x.length;Be++){const Le=x[Be];if(o.hasRenderableParent(Le))continue;const Re=o.getTile(Le),Pe=Re.getBucket(f);if(!Pe||Pe.projection.name!==G.projection.name)continue;const ze=Pe.programConfigurations.get(f.id),Ne=_.useProgram("heatmap",ze,ie),{zoom:Fe}=_.transform;_.terrain&&_.terrain.setupElevationDraw(Re,Ne),_.prepareDrawProgram(S,Ne,Le.toUnwrapped());const et=G.projection.createInversionMatrix(G,Le.canonical);Ne.draw(S,k.TRIANGLES,i.DepthMode.disabled,O,V,ge,ll(_,Le,Re,et,Te,Fe,f.paint.get("heatmap-intensity")),f.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,f.paint,_.transform.zoom,ze,te?[Pe.globeExtVertexBuffer]:null)}S.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(S,k){const O=S.context,V=O.gl,G=k.heatmapFbo;if(!G)return;O.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,G.colorAttachment.get()),O.activeTexture.set(V.TEXTURE1);let te=k.colorRampTexture;te||(te=k.colorRampTexture=new i.Texture(O,k.colorRamp,V.RGBA)),te.bind(V.LINEAR,V.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(O,V.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,S.colorModeForRenderPass(),i.CullFaceMode.disabled,((ie,ge,Te,Be)=>({u_image:0,u_color_ramp:1,u_opacity:ge.paint.get("heatmap-opacity")}))(0,k),k.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,k.paint,S.transform.zoom)}(_,f))},line:function(_,o,f,x){if(_.renderPass!=="translucent")return;const S=f.paint.get("line-opacity"),k=f.paint.get("line-width");if(S.constantOr(1)===0||k.constantOr(1)===0)return;const O=_.depthModeForSublayer(0,i.DepthMode.ReadOnly),V=_.colorModeForRenderPass(),G=_.terrain&&_.terrain.renderingToTexture?1:i.exported.devicePixelRatio,te=f.paint.get("line-dasharray"),ie=te.constantOr(1),ge=f.layout.get("line-cap"),Te=f.paint.get("line-pattern"),Be=Te.constantOr(1),Le=f.paint.get("line-gradient"),Re=Be?"linePattern":"line",Pe=_.context,ze=Pe.gl,Ne=(et=>{const ut=[];zl(et)&&ut.push("RENDER_LINE_DASH"),et.paint.get("line-gradient")&&ut.push("RENDER_LINE_GRADIENT");const lt=et.paint.get("line-trim-offset");lt[0]===0&&lt[1]===0||ut.push("RENDER_LINE_TRIM_OFFSET");const yt=et.paint.get("line-pattern").constantOr(1),$t=et.paint.get("line-opacity").constantOr(1)!==1;return!yt&&$t&&ut.push("RENDER_LINE_ALPHA_DISCARD"),ut})(f);let Fe=Ne.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(Fe=!1);for(const et of x){const ut=o.getTile(et);if(Be&&!ut.patternsLoaded())continue;const lt=ut.getBucket(f);if(!lt)continue;_.prepareDrawTile();const yt=lt.programConfigurations.get(f.id),$t=_.useProgram(Re,yt,Ne),Dt=Te.constantOr(null);if(Dt&&ut.imageAtlas){const ai=ut.imageAtlas.patternPositions[Dt.toString()];ai&&yt.setConstantPatternPositions(ai)}const Et=te.constantOr(null),bi=ge.constantOr(null);if(!Be&&Et&&bi&&ut.lineAtlas){const ai=ut.lineAtlas.getDash(Et,bi);ai&&yt.setConstantPatternPositions(ai)}let[wt,ei]=f.paint.get("line-trim-offset");(bi==="round"||bi==="square")&&wt!==ei&&(wt===0&&(wt-=1),ei===1&&(ei+=1));const qt=_.terrain?et.projMatrix:null,pi=Be?Gs(_,ut,f,qt,G):Wh(_,ut,f,qt,lt.lineClipsArray.length,G,[wt,ei]);if(Le){const ai=lt.gradients[f.id];let Ti=ai.texture;if(f.gradientVersion!==ai.version){let St=256;if(f.stepInterpolant){const Zt=o.getSource().maxzoom,sn=et.canonical.z===Zt?Math.ceil(1<<_.transform.maxZoom-et.canonical.z):1;St=i.clamp(i.nextPowerOfTwo(lt.maxLineLength/i.EXTENT*1024*sn),256,Pe.maxTextureSize)}ai.gradient=i.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:ai.gradient||void 0,clips:lt.lineClipsArray}),ai.texture?ai.texture.update(ai.gradient):ai.texture=new i.Texture(Pe,ai.gradient,ze.RGBA),ai.version=f.gradientVersion,Ti=ai.texture}Pe.activeTexture.set(ze.TEXTURE1),Ti.bind(f.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}ie&&(Pe.activeTexture.set(ze.TEXTURE0),ut.lineAtlasTexture.bind(ze.LINEAR,ze.REPEAT),yt.updatePaintBuffers()),Be&&(Pe.activeTexture.set(ze.TEXTURE0),ut.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),yt.updatePaintBuffers()),_.prepareDrawProgram(Pe,$t,et.toUnwrapped());const Gt=ai=>{$t.draw(Pe,ze.TRIANGLES,O,ai,V,i.CullFaceMode.disabled,pi,f.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,f.paint,_.transform.zoom,yt,[lt.layoutVertexBuffer2])};if(Fe){const ai=_.stencilModeForClipping(et).ref;ai===0&&_.terrain&&Pe.clear({stencil:0});const Ti={func:ze.EQUAL,mask:255};pi.u_alpha_discard_threshold=.8,Gt(new i.StencilMode(Ti,ai,255,ze.KEEP,ze.KEEP,ze.INVERT)),pi.u_alpha_discard_threshold=0,Gt(new i.StencilMode(Ti,ai,255,ze.KEEP,ze.KEEP,ze.KEEP))}else Gt(_.stencilModeForClipping(et))}Fe&&(_.resetStencilClippingMasks(),_.terrain&&Pe.clear({stencil:0}))},fill:function(_,o,f,x){const S=f.paint.get("fill-color"),k=f.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const O=_.colorModeForRenderPass(),V=f.paint.get("fill-pattern"),G=_.opaquePassEnabledForLayer()&&!V.constantOr(1)&&S.constantOr(i.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===G){const te=_.depthModeForSublayer(1,_.renderPass==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly);Nd(_,o,f,x,te,O,!1)}if(_.renderPass==="translucent"&&f.paint.get("fill-antialias")){const te=_.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,i.DepthMode.ReadOnly);Nd(_,o,f,x,te,O,!0)}},"fill-extrusion":function(_,o,f,x){const S=f.paint.get("fill-extrusion-opacity");if(S!==0&&_.renderPass==="translucent"){const k=new i.DepthMode(_.context.gl.LEQUAL,i.DepthMode.ReadWrite,_.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Va(_,o,f,x,k,i.StencilMode.disabled,i.ColorMode.disabled),Va(_,o,f,x,k,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const O=_.colorModeForRenderPass();Va(_,o,f,x,k,i.StencilMode.disabled,O)}}},hillshade:function(_,o,f,x){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const S=_.context,k=_.depthModeForSublayer(0,i.DepthMode.ReadOnly),O=_.colorModeForRenderPass(),V=_.terrain&&_.terrain.renderingToTexture,[G,te]=_.renderPass!=="translucent"||V?[{},x]:_.stencilConfigForOverlap(x);for(const ie of te){const ge=o.getTile(ie);if(ge.needsHillshadePrepare&&_.renderPass==="offscreen")Fa(_,ge,f,k,i.StencilMode.disabled,O);else if(_.renderPass==="translucent"){const Te=V&&_.terrain?_.terrain.stencilModeForRTTOverlap(ie):G[ie.overscaledZ];dh(_,ie,ge,f,k,Te,O)}}S.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,o,f,x,S,k){if(_.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!x.length)return;const O=_.context,V=O.gl,G=o.getSource(),te=_.useProgram("raster"),ie=_.colorModeForRenderPass(),ge=_.terrain&&_.terrain.renderingToTexture,[Te,Be]=G instanceof le||ge?[{},x]:_.stencilConfigForOverlap(x),Le=Be[Be.length-1].overscaledZ,Re=!_.options.moving;for(const Pe of Be){const ze=ge?i.DepthMode.disabled:_.depthModeForSublayer(Pe.overscaledZ-Le,f.paint.get("raster-opacity")===1?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly,V.LESS),Ne=Pe.toUnwrapped(),Fe=o.getTile(Pe);if(ge&&(!Fe||!Fe.hasData()))continue;const et=ge?Pe.projMatrix:_.transform.calculateProjMatrix(Ne,Re),ut=_.terrain&&ge?_.terrain.stencilModeForRTTOverlap(Pe):Te[Pe.overscaledZ],lt=k?0:f.paint.get("raster-fade-duration");Fe.registerFadeDuration(lt);const yt=o.findLoadedParent(Pe,0),$t=Pl(Fe,yt,o,_.transform,lt);let Dt,Et;_.terrain&&_.terrain.prepareDrawTile();const bi=f.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;O.activeTexture.set(V.TEXTURE0),Fe.texture.bind(bi,V.CLAMP_TO_EDGE),O.activeTexture.set(V.TEXTURE1),yt?(yt.texture.bind(bi,V.CLAMP_TO_EDGE),Dt=Math.pow(2,yt.tileID.overscaledZ-Fe.tileID.overscaledZ),Et=[Fe.tileID.canonical.x*Dt%1,Fe.tileID.canonical.y*Dt%1]):Fe.texture.bind(bi,V.CLAMP_TO_EDGE);const wt=mh(et,Et||[0,0],Dt||1,$t,f,G instanceof le?G.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(O,te,Ne),G instanceof le)G.boundsBuffer&&G.boundsSegments&&te.draw(O,V.TRIANGLES,ze,i.StencilMode.disabled,ie,i.CullFaceMode.disabled,wt,f.id,G.boundsBuffer,_.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:ei,tileBoundsIndexBuffer:qt,tileBoundsSegments:pi}=_.getTileBoundsBuffers(Fe);te.draw(O,V.TRIANGLES,ze,ut,ie,i.CullFaceMode.disabled,wt,f.id,ei,qt,pi)}}_.resetStencilClippingMasks()},background:function(_,o,f,x){const S=f.paint.get("background-color"),k=f.paint.get("background-opacity");if(k===0)return;const O=_.context,V=O.gl,G=_.transform,te=G.tileSize,ie=f.paint.get("background-pattern");if(_.isPatternMissing(ie))return;const ge=!ie&&S.a===1&&k===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==ge)return;const Te=i.StencilMode.disabled,Be=_.depthModeForSublayer(0,ge==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly),Le=_.colorModeForRenderPass(),Re=_.useProgram(ie?"backgroundPattern":"background");let Pe,ze=x;ze||(Pe=_.getBackgroundTiles(),ze=Object.values(Pe).map(Ne=>Ne.tileID)),ie&&(O.activeTexture.set(V.TEXTURE0),_.imageManager.bind(_.context));for(const Ne of ze){const Fe=Ne.toUnwrapped(),et=x?Ne.projMatrix:_.transform.calculateProjMatrix(Fe);_.prepareDrawTile();const ut=o?o.getTile(Ne):Pe?Pe[Ne.key]:new i.Tile(Ne,te,G.zoom,_),lt=ie?gh(et,k,_,ie,{tileID:Ne,tileSize:te}):Pu(et,k,S);_.prepareDrawProgram(O,Re,Fe);const{tileBoundsBuffer:yt,tileBoundsIndexBuffer:$t,tileBoundsSegments:Dt}=_.getTileBoundsBuffers(ut);Re.draw(O,V.TRIANGLES,Be,Te,Le,i.CullFaceMode.disabled,lt,f.id,yt,$t,Dt)}},sky:function(_,o,f){const x=_.transform,S=x.projection.name==="mercator"||x.projection.name==="globe"?1:i.smoothstep(7,8,x.zoom),k=f.paint.get("sky-opacity")*S;if(k===0)return;const O=_.context,V=f.paint.get("sky-type"),G=new i.DepthMode(O.gl.LEQUAL,i.DepthMode.ReadOnly,[0,1]),te=_.frameCounter/1e3%1;V==="atmosphere"?_.renderPass==="offscreen"?f.needsSkyboxCapture(_)&&(function(ie,ge,Te,Be){const Le=ie.context,Re=Le.gl;let Pe=ge.skyboxFbo;if(!Pe){Pe=ge.skyboxFbo=Le.createFramebuffer(32,32,!1),ge.skyboxGeometry=new hl(Le),ge.skyboxTexture=Le.gl.createTexture(),Re.bindTexture(Re.TEXTURE_CUBE_MAP,ge.skyboxTexture),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_WRAP_S,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_WRAP_T,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_MIN_FILTER,Re.LINEAR),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_MAG_FILTER,Re.LINEAR);for(let et=0;et<6;++et)Re.texImage2D(Re.TEXTURE_CUBE_MAP_POSITIVE_X+et,0,Re.RGBA,32,32,0,Re.RGBA,Re.UNSIGNED_BYTE,null)}Le.bindFramebuffer.set(Pe.framebuffer),Le.viewport.set([0,0,32,32]);const ze=ge.getCenter(ie,!0),Ne=ie.useProgram("skyboxCapture"),Fe=new Float64Array(16);i.identity(Fe),i.rotateY(Fe,Fe,.5*-Math.PI),Ni(Le,ge,Ne,Fe,ze,0),i.identity(Fe),i.rotateY(Fe,Fe,.5*Math.PI),Ni(Le,ge,Ne,Fe,ze,1),i.identity(Fe),i.rotateX(Fe,Fe,.5*-Math.PI),Ni(Le,ge,Ne,Fe,ze,2),i.identity(Fe),i.rotateX(Fe,Fe,.5*Math.PI),Ni(Le,ge,Ne,Fe,ze,3),i.identity(Fe),Ni(Le,ge,Ne,Fe,ze,4),i.identity(Fe),i.rotateY(Fe,Fe,Math.PI),Ni(Le,ge,Ne,Fe,ze,5),Le.viewport.set([0,0,ie.width,ie.height])}(_,f),f.markSkyboxValid(_)):_.renderPass==="sky"&&function(ie,ge,Te,Be,Le){const Re=ie.context,Pe=Re.gl,ze=ie.transform,Ne=ie.useProgram("skybox");Re.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,ge.skyboxTexture);const Fe=((et,ut,lt,yt,$t)=>({u_matrix:et,u_sun_direction:ut,u_cubemap:0,u_opacity:yt,u_temporal_offset:$t}))(ze.skyboxMatrix,ge.getCenter(ie,!1),0,Be,Le);ie.prepareDrawProgram(Re,Ne),Ne.draw(Re,Pe.TRIANGLES,Te,i.StencilMode.disabled,ie.colorModeForRenderPass(),i.CullFaceMode.backCW,Fe,"skybox",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)}(_,f,G,k,te):V==="gradient"&&_.renderPass==="sky"&&function(ie,ge,Te,Be,Le){const Re=ie.context,Pe=Re.gl,ze=ie.transform,Ne=ie.useProgram("skyboxGradient");ge.skyboxGeometry||(ge.skyboxGeometry=new hl(Re)),Re.activeTexture.set(Pe.TEXTURE0);let Fe=ge.colorRampTexture;Fe||(Fe=ge.colorRampTexture=new i.Texture(Re,ge.colorRamp,Pe.RGBA)),Fe.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);const et=((ut,lt,yt,$t,Dt)=>({u_matrix:ut,u_color_ramp:0,u_center_direction:lt,u_radius:i.degToRad(yt),u_opacity:$t,u_temporal_offset:Dt}))(ze.skyboxMatrix,ge.getCenter(ie,!1),ge.paint.get("sky-gradient-radius"),Be,Le);ie.prepareDrawProgram(Re,Ne),Ne.draw(Re,Pe.TRIANGLES,Te,i.StencilMode.disabled,ie.colorModeForRenderPass(),i.CullFaceMode.backCW,et,"skyboxGradient",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)}(_,f,G,k,te)},debug:function(_,o,f){for(let x=0;x<f.length;x++)Bu(_,o,f[x])},custom:function(_,o,f){const x=_.context,S=f.implementation;if(_.transform.projection.unsupportedLayers&&_.transform.projection.unsupportedLayers.includes("custom"))i.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(_.renderPass==="offscreen"){const k=S.prerender;k&&(_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),k.call(S,x.gl,_.transform.customLayerMatrix()),x.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),x.setStencilMode(i.StencilMode.disabled);const k=S.renderingMode==="3d"?new i.DepthMode(_.context.gl.LEQUAL,i.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,i.DepthMode.ReadOnly);x.setDepthMode(k),S.render(x.gl,_.transform.customLayerMatrix()),x.setDirty(),_.setBaseState(),x.bindFramebuffer.set(null)}}};class Hh{constructor(o,f){this.context=new fe(o),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=i.SourceCache.maxUnderzooming+i.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Oa,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,f){const x=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jh(this,o));const S=this._terrain;this.transform.elevation=x?S:null,S.update(o,this.transform,f)}_updateFog(o){const f=o.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,S]=f.getFovAdjustedRange(this.transform._fov);if(x>S)return void(this.transform.fogCullDistSq=null);const k=x+.78*(S-x);this.transform.fogCullDistSq=k*k}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,f){if(this.width=o*i.exported.devicePixelRatio,this.height=f*i.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._layers[x].resize()}setup(){const o=this.context,f=new i.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(i.EXTENT,0),f.emplaceBack(0,i.EXTENT),f.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(f,i.posAttributes.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);const x=new i.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(i.EXTENT,0),x.emplaceBack(0,i.EXTENT),x.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=o.createVertexBuffer(x,i.posAttributes.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);const S=new i.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(S,i.posAttributes.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);const k=new i.StructArrayLayout4i8;k.emplaceBack(0,0,0,0),k.emplaceBack(i.EXTENT,0,i.EXTENT,0),k.emplaceBack(0,i.EXTENT,0,i.EXTENT),k.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(k,i.boundsAttributes.members),this.mercatorBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);const O=new i.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(O);const V=new i.StructArrayLayout1ui2;for(const te of[0,1,3,2,0])V.emplaceBack(te);this.debugIndexBuffer=o.createIndexBuffer(V),this.emptyTexture=new i.Texture(o,new i.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=i.create();const G=this.context.gl;this.stencilClearMode=new i.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(i.window.performance.now()),this.atmosphereBuffer=new Sr(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,f=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,f.TRIANGLES,i.DepthMode.disabled,this.stencilClearMode,i.ColorMode.disabled,i.CullFaceMode.disabled,Br(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,f,x){if(!f||this.currentStencilSource===f.id||!o.isTileClipped()||!x||x.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let V=!1;for(const G of x)if(this._tileClippingMaskIDs[G.key]===void 0){V=!0;break}if(!V)return}this.currentStencilSource=f.id;const S=this.context,k=S.gl;this.nextStencilID+x.length>256&&this.clearStencil(),S.setColorMode(i.ColorMode.disabled),S.setDepthMode(i.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const V of x){const G=f.getTile(V),te=this._tileClippingMaskIDs[V.key]=this.nextStencilID++,{tileBoundsBuffer:ie,tileBoundsIndexBuffer:ge,tileBoundsSegments:Te}=this.getTileBoundsBuffers(G);O.draw(S,k.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:k.ALWAYS,mask:0},te,255,k.KEEP,k.KEEP,k.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,Br(V.projMatrix),"$clipping",ie,ge,Te)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,f=this.context.gl;return new i.StencilMode({func:f.NOTEQUAL,mask:255},o,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const f=this.context.gl;return new i.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(o){const f=this.context.gl,x=o.sort((O,V)=>V.overscaledZ-O.overscaledZ),S=x[x.length-1].overscaledZ,k=x[0].overscaledZ-S+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const O={};for(let V=0;V<k;V++)O[V+S]=new i.StencilMode({func:f.GEQUAL,mask:255},V+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=k,[O,x]}return[{[S]:i.StencilMode.disabled},x]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new i.ColorMode([o.CONSTANT_COLOR,o.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.ColorMode.unblended:i.ColorMode.alphaBlended}depthModeForSublayer(o,f,x){if(!this.opaquePassEnabledForLayer())return i.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new i.DepthMode(x||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,f){this.style=o,this.options=f,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();const x=this.style.order,S=this.style._sourceCaches;for(const G in S){const te=S[G];te.used&&te.prepare(this.context)}const k={},O={},V={};for(const G in S){const te=S[G];k[G]=te.getVisibleCoordinates(),O[G]=k[G].slice().reverse(),V[G]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<x.length;G++)if(this.style._layers[x[G]].is3D()){this.opaquePassCutoff=G;break}if(this.terrain&&(this.terrain.updateTileBinding(V),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.GlobeSharedBuffers(this.context)),i.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const G of x){const te=this.style._layers[G],ie=o._getLayerSourceCache(te);if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const ge=ie?O[ie.id]:void 0;(te.type==="custom"||te.isSky()||ge&&ge.length)&&this.renderLayer(this,ie,te,ge)}if(this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[x[this.currentLayer]],te=o._getLayerSourceCache(G);if(G.isSky())continue;const ie=te?O[te.id]:void 0;this._renderTileClippingMasks(G,te,ie),this.renderLayer(this,te,G,ie)}if(this.style.fog&&this.transform.projection.supportsFog&&function(G,te){const ie=G.context,ge=ie.gl,Te=G.transform,Be=new i.DepthMode(ge.LEQUAL,i.DepthMode.ReadOnly,[0,1]),Le=G.useProgram("globeAtmosphere",null,Te.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Re=i.globeToMercatorTransition(Te.zoom),Pe=te.properties.get("color").toArray01(),ze=te.properties.get("high-color").toArray01(),Ne=te.properties.get("space-color").toArray01PremultipliedAlpha(),Fe=i.identity$1([]);i.rotateY$1(Fe,Fe,-i.degToRad(Te._center.lng)),i.rotateX$1(Fe,Fe,i.degToRad(Te._center.lat)),i.rotateZ$1(Fe,Fe,Te.angle),i.rotateX$1(Fe,Fe,-Te._pitch);const et=i.fromQuat(new Float32Array(16),Fe),ut=i.mapValue(te.properties.get("star-intensity"),0,1,0,.25),lt=5e-4,yt=i.mapValue(te.properties.get("horizon-blend"),0,1,lt,.25),$t=i.globeUseCustomAntiAliasing(G,ie,Te)&&yt===lt?Te.worldSize/(2*Math.PI*1.025)-1:Te.globeRadius,Dt=G.frameCounter/1e3%1,Et=i.length(Te.globeCenterInViewSpace),bi=Math.sqrt(Math.pow(Et,2)-Math.pow($t,2)),wt=Math.acos(bi/Et),ei=((pi,Gt,ai,Ti,St,Zt,sn,vn,rn,Cn,Nn,gn,Yi,br)=>({u_frustum_tl:pi,u_frustum_tr:Gt,u_frustum_br:ai,u_frustum_bl:Ti,u_horizon:St,u_transition:Zt,u_fadeout_range:sn,u_color:vn,u_high_color:rn,u_space_color:Cn,u_star_intensity:Nn,u_star_size:5*i.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:gn,u_horizon_angle:Yi,u_rotation_matrix:br}))(Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.frustumCorners.horizon,Re,yt,Pe,ze,Ne,ut,Dt,wt,et);G.prepareDrawProgram(ie,Le);const qt=G.atmosphereBuffer;qt&&Le.draw(ie,ge.TRIANGLES,Be,i.StencilMode.disabled,i.ColorMode.alphaBlended,i.CullFaceMode.backCW,ei,"skybox",qt.vertexBuffer,qt.indexBuffer,qt.segments)}(this,this.style.fog),this.renderPass="sky",(i.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const G=this.style._layers[x[this.currentLayer]],te=o._getLayerSourceCache(G);G.isSky()&&this.renderLayer(this,te,G,te?O[te.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;){const G=this.style._layers[x[this.currentLayer]],te=o._getLayerSourceCache(G);if(G.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(G)){if(G.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ie=te?(G.type==="symbol"?V:O)[te.id]:void 0;this._renderTileClippingMasks(G,te,te?k[te.id]:void 0),this.renderLayer(this,te,G,ie),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let G=null;i.values(this.style._layers).forEach(te=>{const ie=o._getLayerSourceCache(te);ie&&!te.isHidden(this.transform.zoom)&&(!G||G.getSource().maxzoom<ie.getSource().maxzoom)&&(G=ie)}),G&&this.options.showTileBoundaries&&lc.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const te=G.transform.padding;ac(G,G.transform.height-(te.top||0),3,ul),ac(G,te.bottom||0,3,Du),ha(G,te.left||0,3,Lu),ha(G,G.transform.width-(te.right||0),3,Xh);const ie=G.transform.centerPoint;(function(ge,Te,Be,Le){Zi(ge,Te-1,Be-10,2,20,Le),Zi(ge,Te-10,Be-1,20,2,Le)})(G,ie.x,G.transform.height-ie.y,$d)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.window.performance.now()),this.saveCanvasCopy())}}renderLayer(o,f,x,S){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="sky"||x.type==="custom"||S&&S.length)&&(this.id=x.id,this.gpuTimingStart(x),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(x.type)||lc[x.type](o,f,x,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let x=this.gpuTimers[o.id];x||(x=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),x.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,f=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),o.beginQueryEXT(o.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const f={};for(const x in o){const S=o[x],k=this.context.extTimerQuery,O=k.getQueryObjectEXT(S.query,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(S.query),f[x]=O}return f}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let x=0;for(const S of o)x+=f.getQueryObjectEXT(S,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(S);return x}translatePosMatrix(o,f,x,S,k){if(!x[0]&&!x[1])return o;const O=k?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(O){const te=Math.sin(O),ie=Math.cos(O);x=[x[0]*ie-x[1]*te,x[0]*te+x[1]*ie]}const V=[k?x[0]:Li(f,x[0],this.transform.zoom),k?x[1]:Li(f,x[1],this.transform.zoom),0],G=new Float32Array(16);return i.translate(G,o,V),G}saveTileTexture(o){const f=this._tileTextures[o.size[0]];f?f.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const f=this._tileTextures[o];return f&&f.length>0?f.pop():null}isPatternMissing(o){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,x=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),f&&S.push("ZERO_EXAGGERATION"),x&&!o&&x.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),o&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(o,f,x){this.cache=this.cache||{};const S=x||[],k=this.currentGlobalDefines().concat(S),O=Gh.cacheKey(Mc[o],o,k,f);return this.cache[O]||(this.cache[O]=new Gh(this.context,o,Mc[o],f,Vd[o],k)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=i.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,f,x){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const k=S.getOpacity(this.transform.pitch),O=((V,G,te,ie,ge,Te,Be,Le,Re,Pe,ze)=>{const Ne=V.transform,Fe=G.properties.get("color").toArray01();Fe[3]=ie;const et=V.frameCounter/1e3%1;return{u_fog_matrix:te?Ne.calculateFogTileMatrix(te):V.identityMat,u_fog_range:G.getFovAdjustedRange(Ne._fov),u_fog_color:Fe,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:et,u_frustum_tl:ge,u_frustum_tr:Te,u_frustum_br:Be,u_frustum_bl:Le,u_globe_pos:Re,u_globe_radius:Pe,u_viewport:ze,u_globe_transition:i.globeToMercatorTransition(Ne.zoom),u_is_globe:+(Ne.projection.name==="globe")}})(this,S,x,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.exported.devicePixelRatio,this.transform.height*i.exported.devicePixelRatio]);f.setFogUniformValues(o,O)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,f=o.createTexture();return o.bindTexture(o.TEXTURE_2D,f),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,f=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const S of x)f[S.key]=o[S.key]||new i.Tile(S,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Ru{constructor(o=0,f=0,x=0,S=0){if(isNaN(o)||o<0||isNaN(f)||f<0||isNaN(x)||x<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=f,this.left=x,this.right=S}interpolate(o,f,x){return f.top!=null&&o.top!=null&&(this.top=i.number(o.top,f.top,x)),f.bottom!=null&&o.bottom!=null&&(this.bottom=i.number(o.bottom,f.bottom,x)),f.left!=null&&o.left!=null&&(this.left=i.number(o.left,f.left,x)),f.right!=null&&o.right!=null&&(this.right=i.number(o.right,f.right,x)),this}getCenter(o,f){const x=i.clamp((this.left+o-this.right)/2,0,o),S=i.clamp((this.top+f-this.bottom)/2,0,f);return new i.pointGeometry(x,S)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ru(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cc(_,o){const f=i.getColumn(_,3);i.fromQuat(_,o),i.setColumn(_,3,f)}function Kh(_,o){const f=i.identity$1([]);return i.rotateZ$1(f,f,-o),i.rotateX$1(f,f,-_),f}function Yh(_,o){const f=[_[0],_[1],0],x=[o[0],o[1],0];if(i.length(f)>=1e-15){const O=i.normalize([],f);i.scale$2(x,O,i.dot(x,O)),o[0]=x[0],o[1]=x[1]}const S=i.cross([],o,_);if(i.len(S)<1e-15)return null;const k=Math.atan2(-S[1],S[0]);return Kh(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),k)}class Ou{constructor(o,f){this.position=o,this.orientation=f}get position(){return this._position}set position(o){if(o){const f=o instanceof i.MercatorCoordinate?o:new i.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(f.x=i.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(o,f){if(this.orientation=null,!this.position)return;const x=this._elevation?this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(o)):0,S=this.position,k=i.MercatorCoordinate.fromLngLat(o,x),O=[k.x-S.x,k.y-S.y,k.z-S.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Yh(O,f)}setPitchBearing(o,f){this.orientation=Kh(i.degToRad(o),i.degToRad(-f))}}class Fu{constructor(o,f){this._transform=i.identity([]),this.orientation=f,this.position=o}get mercatorPosition(){const o=this.position;return new i.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=i.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var f;o&&i.setColumn(this._transform,3,[(f=o)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.identity$1([]),o&&cc(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,f){this._orientation=Kh(o,f),cc(this._transform,this._orientation)}forward(){const o=i.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,f){const x=new Float64Array(16);return i.invert(x,this.getWorldToCamera(o,f)),x}getWorldToCameraPosition(o,f,x){const S=this.position;i.scale$2(S,S,-o);const k=new Float64Array(16);return i.fromScaling(k,[x,x,x]),i.translate(k,k,S),k[10]*=f,k}getWorldToCamera(o,f){const x=new Float64Array(16),S=new Float64Array(4),k=this.position;return i.conjugate(S,this._orientation),i.scale$2(k,k,-o),i.fromQuat(x,S),i.translate(x,x,k),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=f,x[9]*=f,x[10]*=f,x[11]*=f,x}getCameraToClipPerspective(o,f,x,S){const k=new Float64Array(16);return i.perspective(k,o,f,x,S),k}getDistanceToElevation(o,f=!1){const x=o===0?0:i.mercatorZfromAltitude(o,f?i.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(x-this.position[2])/S[2]}clone(){return new Fu([...this.position],[...this.orientation])}}function Zc(_,o){const f=Po(_.projection,_.zoom,_.width,_.height),x=function(k,O,V,G,te){const ie=new i.LngLat(V.lng-180*bs,V.lat),ge=new i.LngLat(V.lng+180*bs,V.lat),Te=k.project(ie.lng,ie.lat),Be=k.project(ge.lng,ge.lat),Le=-Math.atan2(Be.y-Te.y,Be.x-Te.x),Re=i.MercatorCoordinate.fromLngLat(V);Re.y=i.clamp(Re.y,-.999975,.999975);const Pe=Re.toLngLat(),ze=k.project(Pe.lng,Pe.lat),Ne=i.MercatorCoordinate.fromLngLat(Pe);Ne.x+=bs;const Fe=Ne.toLngLat(),et=k.project(Fe.lng,Fe.lat),ut=Ll(et.x-ze.x,et.y-ze.y,Le),lt=i.MercatorCoordinate.fromLngLat(Pe);lt.y+=bs;const yt=lt.toLngLat(),$t=k.project(yt.lng,yt.lat),Dt=Ll($t.x-ze.x,$t.y-ze.y,Le),Et=Math.abs(ut.x)/Math.abs(Dt.y),bi=i.identity([]);i.rotateZ(bi,bi,-Le*(1-(te?0:G)));const wt=i.identity([]);return i.scale(wt,wt,[1,1-(1-Et)*G,1]),wt[4]=-Dt.x/Dt.y*G,i.rotateZ(wt,wt,Le),i.multiply(wt,bi,wt),wt}(_.projection,0,_.center,f,o),S=uc(_);return i.scale(x,x,[S,S,1]),x}function uc(_){const o=_.projection,f=Po(_.projection,_.zoom,_.width,_.height),x=Vu(o,_.center),S=Vu(o,i.LngLat.convert(o.center));return Math.pow(2,x*f+(1-f)*S)}function Po(_,o,f,x,S=1/0){const k=_.range;if(!k)return 0;const O=Math.min(S,Math.max(f,x)),V=Math.log(O/1024)/Math.LN2;return i.smoothstep(k[0]+V,k[1]+V,o)}const bs=1/4e4;function Vu(_,o){const f=i.clamp(o.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),x=new i.LngLat(o.lng-180*bs,f),S=new i.LngLat(o.lng+180*bs,f),k=_.project(x.lng,f),O=_.project(S.lng,f),V=i.MercatorCoordinate.fromLngLat(x),G=i.MercatorCoordinate.fromLngLat(S),te=O.x-k.x,ie=O.y-k.y,ge=G.x-V.x,Te=G.y-V.y,Be=Math.sqrt((ge*ge+Te*Te)/(te*te+ie*ie));return Math.log(Be)/Math.LN2}function Ll(_,o,f){const x=Math.cos(f),S=Math.sin(f);return{x:_*x-o*S,y:_*S+o*x}}class Bl{constructor(o,f,x,S,k,O,V){this.tileSize=512,this._renderWorldCopies=k===void 0||k,this._minZoom=o||0,this._maxZoom=f||22,this._minPitch=x==null?0:x,this._maxPitch=S==null?60:S,this.setProjection(O),this.setMaxBounds(V),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ru,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Fu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new Bl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o,f=!1){const x=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||x)&&this._updateCameraOnTerrain(),(o||x)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return i.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=i.getProjection(this.projectionOptions);const x=!F(f,this.getProjection());return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.getProjection({name:"mercator"});const f=o!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.pointGeometry(this.width,this.height)}get bearing(){return i.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const f=-o*Math.PI/180;var x;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(x=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x),function(S,k,O){var V=k[0],G=k[1],te=k[2],ie=k[3],ge=Math.sin(O),Te=Math.cos(O);S[0]=V*Te+te*ge,S[1]=G*Te+ie*ge,S[2]=V*-ge+te*Te,S[3]=G*-ge+ie*Te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const f=i.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.degToRad(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const f=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let S=0,k=0;for(let O=0;O<f.length;O++){const V=new i.pointGeometry(f[O][0]*this.width,x+f[O][1]*(this.height-x)),G=o.pointCoordinate(V);if(!G)continue;const te=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);S+=G[3]*te,k+=te}return k===0?NaN:S/k}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*f,S=this._mercatorZfromZoom(o),k=this._mercatorZfromZoom(this._maxZoom),O=Math.max(S-x,k);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let x;x=o.z<this._camera.position[2]?[f.x,f.y,f.z]:[o.x,o.y,o.z];const S=i.length(i.sub([],this._camera.position,x));return i.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let f=!1;if(o.orientation&&!i.exactEquals(o.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(o.orientation)),o.position){const x=[o.position.x,o.position.y,o.position.z];i.exactEquals$1(x,this._camera.position)||(this._setCameraPosition(x),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,f=new Ou;return f.position=new i.MercatorCoordinate(o[0],o[1],o[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(o){if(!i.length$1(o))return!1;i.normalize$1(o,o);const f=i.transformQuat([],[0,0,-1],o),x=i.transformQuat([],[0,-1,0],o);if(x[2]<0)return!1;const S=Yh(f,x);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(o){const f=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;o[2]=i.clamp(o[2],S/x,S/f),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,f,x){this._unmodified=!1,this._edgeInsets.interpolate(o,f,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const f=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(o){const f=[new i.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const x=this.pointCoordinate(new i.pointGeometry(0,0)),S=this.pointCoordinate(new i.pointGeometry(this.width,0)),k=this.pointCoordinate(new i.pointGeometry(this.width,this.height)),O=this.pointCoordinate(new i.pointGeometry(0,this.height)),V=Math.floor(Math.min(x.x,S.x,k.x,O.x)),G=Math.floor(Math.max(x.x,S.x,k.x,O.x)),te=1;for(let ie=V-te;ie<=G+te;ie++)ie!==0&&f.push(new i.UnwrappedTileID(ie,o))}return f}coveringTiles(o){let f=this.coveringZoomLevel(o);const x=f,S=this.elevation&&!o.isTerrainDEM,k=this.projection.name==="mercator";if(o.minzoom!==void 0&&f<o.minzoom)return[];o.maxzoom!==void 0&&f>o.maxzoom&&(f=o.maxzoom);const O=this.locationCoordinate(this.center),V=this.center.lat,G=1<<f,te=[G*O.x,G*O.y,0],ie=this.projection.name==="globe",ge=!ie,Te=i.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,ge),Be=ie?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Le=G*i.mercatorZfromAltitude(1,this.center.lat),Re=this._camera.position[2]/i.mercatorZfromAltitude(1,this.center.lat),Pe=[G*Be.x,G*Be.y,Re*(ge?1:Le)],ze=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,Fe=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,et=o.isTerrainDEM?-Fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ut=this.projection.isReprojectedInTileSpace?uc(this):1,lt=Gt=>{const Ti=new i.MercatorCoordinate(Gt.x+25e-6,Gt.y,Gt.z),St=new i.MercatorCoordinate(Gt.x,Gt.y+25e-6,Gt.z),Zt=Gt.toLngLat(),sn=Ti.toLngLat(),vn=St.toLngLat(),rn=this.locationCoordinate(Zt),Cn=this.locationCoordinate(sn),Nn=this.locationCoordinate(vn),gn=Math.hypot(Cn.x-rn.x,Cn.y-rn.y),Yi=Math.hypot(Nn.x-rn.x,Nn.y-rn.y);return Math.sqrt(gn*Yi)*ut/25e-6},yt=Gt=>{const ai=Fe,Ti=et;return{aabb:i.tileAABB(this,G,0,0,0,Gt,Ti,ai,this.projection),zoom:0,x:0,y:0,minZ:Ti,maxZ:ai,wrap:Gt,fullyVisible:!1}},$t=[];let Dt=[];const Et=f,bi=o.reparseOverscaled?x:f,wt=Gt=>Gt*Gt,ei=wt((Re-this._centerAltitude)*Le),qt=Gt=>{if(!this._elevation||!Gt.tileID||!k)return;const ai=this._elevation.getMinMaxForTile(Gt.tileID),Ti=Gt.aabb;ai?(Ti.min[2]=ai.min,Ti.max[2]=ai.max,Ti.center[2]=(Ti.min[2]+Ti.max[2])/2):(Gt.shouldSplit=pi(Gt),Gt.shouldSplit||(Ti.min[2]=Ti.max[2]=Ti.center[2]=this._centerAltitude))},pi=Gt=>{if(Gt.zoom<Ne)return!0;if(Gt.zoom===Et)return!1;if(Gt.shouldSplit!=null)return Gt.shouldSplit;const ai=Gt.aabb.distanceX(Pe),Ti=Gt.aabb.distanceY(Pe);let St=ei,Zt=1;if(ie){St=wt(Gt.aabb.distanceZ(Pe));const rn=Math.pow(2,Gt.zoom),Cn=i.latFromMercatorY((Gt.y+1)/rn),Nn=i.latFromMercatorY(Gt.y/rn),gn=Math.min(Math.max(V,Cn),Nn),Yi=i.circumferenceAtLatitude(gn)/i.circumferenceAtLatitude(V);if(Zt=gn===V?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yi/this._mercatorScaleRatio),this.zoom<=i.GLOBE_ZOOM_THRESHOLD_MIN&&Gt.zoom===Et-1&&Yi>=.9)return!0}else if(S&&(St=wt(Gt.aabb.distanceZ(Pe)*Le)),this.projection.isReprojectedInTileSpace&&x<=5){const rn=Math.pow(2,Gt.zoom),Cn=lt(new i.MercatorCoordinate((Gt.x+.5)/rn,(Gt.y+.5)/rn));Zt=Cn>.85?1:Cn}const sn=ai*ai+Ti*Ti+St,vn=wt((1<<Et-Gt.zoom)*ze*Zt*((rn,Cn)=>{if(Cn*wt(.707)<rn)return 1;const Nn=Math.sqrt(Cn/rn);return Nn/(1.4144271570014144+(Math.pow(1.1,Nn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(St,ei),sn));return sn<vn};if(this.renderWorldCopies)for(let Gt=1;Gt<=3;Gt++)$t.push(yt(-Gt)),$t.push(yt(Gt));for($t.push(yt(0));$t.length>0;){const Gt=$t.pop(),ai=Gt.x,Ti=Gt.y;let St=Gt.fullyVisible;if(!St){const Zt=Gt.aabb.intersects(Te);if(Zt===0)continue;St=Zt===2}if(Gt.zoom!==Et&&pi(Gt))for(let Zt=0;Zt<4;Zt++){const sn=(ai<<1)+Zt%2,vn=(Ti<<1)+(Zt>>1),rn={aabb:k?Gt.aabb.quadrant(Zt):i.tileAABB(this,G,Gt.zoom+1,sn,vn,Gt.wrap,Gt.minZ,Gt.maxZ,this.projection),zoom:Gt.zoom+1,x:sn,y:vn,wrap:Gt.wrap,fullyVisible:St,tileID:void 0,shouldSplit:void 0,minZ:Gt.minZ,maxZ:Gt.maxZ};S&&!ie&&(rn.tileID=new i.OverscaledTileID(Gt.zoom+1===Et?bi:Gt.zoom+1,Gt.wrap,Gt.zoom+1,sn,vn),qt(rn)),$t.push(rn)}else{const Zt=Gt.zoom===Et?bi:Gt.zoom;if(o.minzoom&&o.minzoom>Zt)continue;const sn=te[0]-(.5+ai+(Gt.wrap<<Gt.zoom))*(1<<f-Gt.zoom),vn=te[1]-.5-Ti,rn=Gt.tileID?Gt.tileID:new i.OverscaledTileID(Zt,Gt.wrap,Gt.zoom,ai,Ti);Dt.push({tileID:rn,distanceSq:sn*sn+vn*vn})}}if(this.fogCullDistSq){const Gt=this.fogCullDistSq,ai=this.horizonLineFromTop();Dt=Dt.filter(Ti=>{const St=[0,0,0,1],Zt=[i.EXTENT,i.EXTENT,0,1],sn=this.calculateFogTileMatrix(Ti.tileID.toUnwrapped());i.transformMat4$1(St,St,sn),i.transformMat4$1(Zt,Zt,sn);const vn=i.getAABBPointSquareDist(St,Zt);if(vn===0)return!0;let rn=!1;const Cn=this._elevation;if(Cn&&vn>Gt&&ai!==0){const Nn=this.calculateProjMatrix(Ti.tileID.toUnwrapped());let gn;o.isTerrainDEM||(gn=Cn.getMinMaxForTile(Ti.tileID)),gn||(gn={min:et,max:Fe});const Yi=i.furthestTileCorner(this.rotation),br=[Yi[0]*i.EXTENT,Yi[1]*i.EXTENT,gn.max];i.transformMat4(br,br,Nn),rn=(1-br[1])*this.height*.5<ai}return vn<Gt||rn})}return Dt.sort((Gt,ai)=>Gt.distanceSq-ai.distanceSq).map(Gt=>Gt.tileID)}resize(o,f){this.width=o,this.height=f,this.pixelsToGLUnits=[2/o,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const f=i.clamp(o.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),x=this.projection.project(o.lng,f);return new i.pointGeometry(x.x*this.worldSize,x.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,f){let x,S;const k=this.centerPoint;if(this.projection.name==="globe"){const V=this.worldSize;x=(f.x-k.x)/V,S=(f.y-k.y)/V}else{const V=this.pointCoordinate(f),G=this.pointCoordinate(k);x=V.x-G.x,S=V.y-G.y}const O=this.locationCoordinate(o);this.setLocation(new i.MercatorCoordinate(O.x-x,O.y-S))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,f){const x=f?i.mercatorZfromAltitude(f,o.lat):void 0,S=this.projection.project(o.lng,o.lat);return new i.MercatorCoordinate(S.x,S.y,x)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,f){const x=f!=null?f:this._centerAltitude,S=[o.x,o.y,0,1],k=[o.x,o.y,1,1];i.transformMat4$1(S,S,this.pixelMatrixInverse),i.transformMat4$1(k,k,this.pixelMatrixInverse);const O=k[3];i.scale$1(S,S,1/S[3]),i.scale$1(k,k,1/O);const V=S[2],G=k[2];return{p0:S,p1:k,t:V===G?0:(x-V)/(G-V)}}screenPointToMercatorRay(o){const f=[o.x,o.y,0,1],x=[o.x,o.y,1,1];return i.transformMat4$1(f,f,this.pixelMatrixInverse),i.transformMat4$1(x,x,this.pixelMatrixInverse),i.scale$1(f,f,1/f[3]),i.scale$1(x,x,1/x[3]),f[2]=i.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,x[2]=i.mercatorZfromAltitude(x[2],this._center.lat)*this.worldSize,i.scale$1(f,f,1/this.worldSize),i.scale$1(x,x,1/this.worldSize),new i.Ray([f[0],f[1],f[2]],i.normalize([],i.sub([],x,f)))}rayIntersectionCoordinate(o){const{p0:f,p1:x,t:S}=o,k=i.mercatorZfromAltitude(f[2],this._center.lat),O=i.mercatorZfromAltitude(x[2],this._center.lat);return new i.MercatorCoordinate(i.number(f[0],x[0],S)/this.worldSize,i.number(f[1],x[1],S)/this.worldSize,i.number(k,O,S))}pointCoordinate(o,f=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,f)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let f=this.projection.pointCoordinate3D(this,o.x,o.y);if(f)return new i.MercatorCoordinate(f[0],f[1],f[2]);let x=0,S=this.horizonLineFromTop();if(o.y>S)return this.pointCoordinate(o);const k=.02*S,O=o.clone();for(let V=0;V<10&&S-x>k;V++){O.y=i.number(x,S,.66);const G=this.projection.pointCoordinate3D(this,O.x,O.y);G?(S=O.y,f=G):x=O.y}return f?new i.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}_coordinatePoint(o,f){const x=f&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,S=[o.x*this.worldSize,o.y*this.worldSize,x+o.toAltitude(),1];return i.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new i.pointGeometry(S[0]/S[3],S[1]/S[3]):new i.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:o,left:f}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,k=this.pointCoordinate3D(new i.pointGeometry(f,o)),O=this.pointCoordinate3D(new i.pointGeometry(S,o)),V=this.pointCoordinate3D(new i.pointGeometry(S,x)),G=this.pointCoordinate3D(new i.pointGeometry(f,x));let te=Math.min(k.x,G.x),ie=Math.max(O.x,V.x),ge=Math.min(k.y,O.y),Te=Math.max(G.y,V.y);const Be=Math.pow(2,-this.zoom)/16,Le=(lt,yt,$t,Dt)=>{const Et=(lt+$t)/2,bi=(yt+Dt)/2,wt=new i.pointGeometry(Et,bi),ei=this.pointCoordinate3D(wt),qt=Math.max(0,te-ei.x,ge-ei.y,ei.x-ie,ei.y-Te);te=Math.min(te,ei.x),ie=Math.max(ie,ei.x),ge=Math.min(ge,ei.y),Te=Math.max(Te,ei.y),qt>Be&&(Le(lt,yt,Et,bi),Le(Et,bi,$t,Dt))};Le(f,o,S,o),Le(S,o,S,x),Le(S,x,f,x),Le(f,x,f,o);const[Re,Pe]=i.polesInViewport(this),ze=Re||Pe,Ne=Re?90:i.latFromMercatorY(ge),Fe=ze?180:i.lngFromMercatorX(ie),et=Pe?-90:i.latFromMercatorY(Te),ut=ze?-180:i.lngFromMercatorX(te);return new i.LngLatBounds(new i.LngLat(ut,et),new i.LngLat(Fe,Ne))}_getBounds(o,f){if(this.projection.name==="globe")return this._getGlobeBounds();const x=new i.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),S=new i.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),k=new i.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),O=new i.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let V=this.pointCoordinate(x,o),G=this.pointCoordinate(S,o);const te=this.pointCoordinate(k,f),ie=this.pointCoordinate(O,f),ge=(Te,Be)=>(Be.y-Te.y)/(Be.x-Te.x);return V.y>1&&G.y>=0?V=new i.MercatorCoordinate((1-ie.y)/ge(ie,V)+ie.x,1):V.y<0&&G.y<=1&&(V=new i.MercatorCoordinate(-ie.y/ge(ie,V)+ie.x,0)),G.y>1&&V.y>=0?G=new i.MercatorCoordinate((1-te.y)/ge(te,G)+te.x,1):G.y<0&&V.y<=1&&(G=new i.MercatorCoordinate(-te.y/ge(te,G)+te.x,0)),new i.LngLatBounds().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(te))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBounds(0,0);const f=o.visibleDemTiles.reduce((x,S)=>{if(S.dem){const k=S.dem.tree;x.min=Math.min(x.min,k.minimums[0]),x.max=Math.max(x.max,k.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});return this._getBounds(f.min*o.exaggeration(),f.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,x=this.height/2-f*(1-this._horizonShift);return o?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.MAX_MERCATOR_LATITUDE,this.maxLat=i.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=i.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=i.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=i.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,f){return this.projection.createTileMatrix(this,f,o)}calculateDistanceTileData(o){const f=o.key,x=this._distanceTileDataCache;if(x[f])return x[f];const S=o.canonical,k=1/this.height,O=this.cameraWorldSize,V=O/this.zoomScale(S.z),G=(S.x+Math.pow(2,S.z)*o.wrap)*V,te=S.y*V,ie=this.point;ie.x*=O/this.worldSize,ie.y*=O/this.worldSize;const ge=this.angle,Te=Math.sin(-ge),Be=-Math.cos(-ge);return x[f]={bearing:[Te,Be],center:[(ie.x-G)*k,(ie.y-te)*k],scale:V/i.EXTENT*k},x[f]}calculateFogTileMatrix(o){const f=o.key,x=this._fogTileMatrixCache;if(x[f])return x[f];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.multiply(S,this.worldToFogMatrix,S),x[f]=new Float32Array(S),x[f]}calculateProjMatrix(o,f=!1){const x=o.key,S=f?this._alignedProjMatrixCache:this._projMatrixCache;if(S[x])return S[x];const k=this.calculatePosMatrix(o,this.worldSize);return i.multiply(k,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,k),S[x]=new Float32Array(k),S[x]}calculatePixelsToTileUnitsMatrix(o){const f=o.tileID.key,x=this._pixelsToTileUnitsCache;if(x[f])return x[f];const S=function(k,O){const{scale:V}=k.tileTransform,G=V*i.EXTENT/(k.tileSize*Math.pow(2,O.zoom-k.tileID.overscaledZ+k.tileID.canonical.z));return te=new Float32Array(4),Te=(ie=O.inverseAdjustmentMatrix)[1],Be=ie[2],Le=ie[3],Pe=(ge=[G,G])[1],te[0]=ie[0]*(Re=ge[0]),te[1]=Te*Re,te[2]=Be*Pe,te[3]=Le*Pe,te;var te,ie,ge,Te,Be,Le,Re,Pe}(o,this);return x[f]=S,x[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const f=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(f),S=this._camera.forward(),k=i.mercatorZfromAltitude(1,this._center.lat);x[2]/=k,S[2]/=k,i.normalize(S,S);const O=o.raycast(x,S,o.exaggeration());if(O){const V=i.scaleAndAdd([],x,S,O),G=new i.MercatorCoordinate(V[0],V[1],i.mercatorZfromAltitude(V[2],i.latFromMercatorY(V[1]))),te=(G.z+i.length([G.x-x[0],G.y-x[1],G.z-x[2]*k]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(te),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const f=this._elevation,x=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(x),k=f.getAtPointOrZero(new i.MercatorCoordinate(...S)),O=this.pixelsPerMeter/this.worldSize*k,V=this._minimumHeightOverTerrain(),G=S[2]-O;if(G<=V)if(G<0||o){const te=this.locationCoordinate(this._center,this._centerAltitude),ie=[S[0],S[1],te.z-S[2]],ge=i.length(ie);ie[2]-=(V-G)/this._pixelsPerMercatorPixel;const Te=i.length(ie);if(Te===0)return;i.scale$2(ie,ie,ge/Te*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],te.z*this._pixelsPerMercatorPixel-ie[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Te=this.center;return Te.lat=i.clamp(Te.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Te.lng=i.clamp(Te.lng,this.minLng,this.maxLng)),this.center=Te,void(this._constraining=!1)}const f=this._unmodified,{x,y:S}=this.point;let k=0,O=x,V=S;const G=this.width/2,te=this.height/2,ie=this.worldMinY*this.scale,ge=this.worldMaxY*this.scale;if(S-te<ie&&(V=ie+te),S+te>ge&&(V=ge-te),ge-ie<this.height&&(k=Math.max(k,this.height/(ge-ie)),V=(ge+ie)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Te=this.worldMinX*this.scale,Be=this.worldMaxX*this.scale,Le=this.worldSize/2-(Te+Be)/2;O=(x+Le+this.worldSize)%this.worldSize-Le,O-G<Te&&(O=Te+G),O+G>Be&&(O=Be-G),Be-Te<this.width&&(k=Math.max(k,this.width/(Be-Te)),O=(Be+Te)/2)}O===x&&V===S||(this.center=this.unproject(new i.pointGeometry(O,V))),k&&(this.zoom+=this.scaleZoom(k)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.mercatorZfromAltitude(1,this.center.lat)/i.mercatorZfromAltitude(1,i.GLOBE_SCALE_MATCH_LATITUDE));const x=Po(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?f:1),k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);k[8]=2*-o.x/this.width,k[9]=2*o.y/this.height;let O=i.mul([],k,S);if(this.projection.isReprojectedInTileSpace){const ut=this.locationCoordinate(this.center),lt=i.identity([]);i.translate(lt,lt,[ut.x*this.worldSize,ut.y*this.worldSize,0]),i.multiply(lt,lt,Zc(this)),i.translate(lt,lt,[-ut.x*this.worldSize,-ut.y*this.worldSize,0]),i.multiply(O,O,lt),this.inverseAdjustmentMatrix=function(yt){const $t=Zc(yt,!0);return gt([],[$t[0],$t[1],$t[4],$t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=i.scale([],O,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=O,this.invProjMatrix=i.invert(new Float64Array(16),this.projMatrix);const V=i.invert([],k);this.frustumCorners=i.FrustumCorners.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height);const G=new Float32Array(16);i.identity(G),i.scale(G,G,[1,-1,1]),i.rotateX(G,G,this._pitch),i.rotateZ(G,G,this.angle);const te=i.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ie=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;te[8]=2*-o.x/this.width,te[9]=2*(o.y+ie)/this.height,this.skyboxMatrix=i.multiply(G,te,G);const ge=this.point,Te=ge.x,Be=ge.y,Le=this.width%2/2,Re=this.height%2/2,Pe=Math.cos(this.angle),ze=Math.sin(this.angle),Ne=Te-Math.round(Te)+Pe*Le+ze*Re,Fe=Be-Math.round(Be)+Pe*Re+ze*Le,et=new Float64Array(O);if(i.translate(et,et,[Ne>.5?Ne-1:Ne,Fe>.5?Fe-1:Fe,0]),this.alignedProjMatrix=et,O=i.create(),i.scale(O,O,[this.width/2,-this.height/2,1]),i.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=i.create(),i.scale(O,O,[1,-1,1]),i.translate(O,O,[-1,-1,0]),i.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=i.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.calculateGlobeMatrix(this);const ut=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.transformMat4(ut,ut,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,x=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,k=[o,o,f];i.scale$2(k,k,S),i.scale$2(x,x,-1),i.multiply$2(x,x,k);const O=i.create();i.translate(O,O,x),i.scale(O,O,k),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,f,S)}_computeCameraPosition(o){const f=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),S=this.point,k=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-o/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-x[0]*k,S.y/this.worldSize-x[1]*k,o/this.worldSize*this._centerAltitude-x[2]*k]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=this._camera.position[2],S=o[2];let k=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(k=Math.min((f-x)/S,1)),this._camera.position=i.scaleAndAdd([],this._camera.position,o,k),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,f=this._camera.forward(),{pitch:x,bearing:S}=this._camera.getPitchBearing(),k=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.degToRad(this._maxPitch)),V=Math.max((o[2]-k)/Math.cos(x),O),G=this._zoomFromMercatorZ(V);i.scaleAndAdd(o,o,f,V),this._pitch=i.clamp(x,i.degToRad(this.minPitch),i.degToRad(this.maxPitch)),this.angle=i.wrap(S,-Math.PI,Math.PI),this._setZoom(i.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){const f=O=>{const V=this.getCameraToCenterDistance(this.projection,O);return this.scaleZoom(V/(o*this.tileSize))};let x,S=f(this.zoom),k=Math.abs(S-f(S));for(;x!==k;)S=f(S),x=k,k=Math.abs(S-f(S));return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,f){const x=Math.min(o.x,f.x),S=Math.max(o.x,f.x),k=Math.min(o.y,f.y),O=Math.max(o.y,f.y);if(k<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const V=[new i.pointGeometry(x,k),new i.pointGeometry(S,O),new i.pointGeometry(x,O),new i.pointGeometry(S,k)],G=this.renderWorldCopies?-3:0,te=this.renderWorldCopies?4:1;for(const ie of V){const ge=this.pointRayIntersection(ie);if(ge.t<0)return!0;const Te=this.rayIntersectionCoordinate(ge);if(Te.x<G||Te.y<0||Te.x>te||Te.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.pointGeometry(0,0),new i.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,f){const x=i.length(i.sub([],this._camera.position,o)),S=this._zoomFromMercatorZ(x)+f;return x-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([f,x,S],k){const O=[f,x,S,1];i.transformMat4$1(O,O,k);const V=O[3]=Math.max(O[3],1e-6);return O[0]/=V,O[1]/=V,O[2]/=V,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.pointGeometry(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.pointGeometry(0,o))}}getCameraToCenterDistance(o,f=this.zoom){const x=Po(o,f,this.width,this.height,1024),S=o.pixelSpaceConversion(this.center.lat,this.worldSize,x);return .5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.multiply(o,o,this.globeMatrix),o}}function dl(_,o){let f=!1,x=null;const S=()=>{x=null,f&&(_(),x=setTimeout(S,o),f=!1)};return()=>(f=!0,x||S(),x)}class ji{constructor(o){this._hashName=o&&encodeURIComponent(o),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=dl(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,i.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),i.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const f=vo(o);if(this._hashName){const x=this._hashName;let S=!1;const k=i.window.location.hash.slice(1).split("&").map(O=>{const V=O.split("=")[0];return V===x?(S=!0,`${V}=${f}`):O}).filter(O=>O);return S||k.push(`${x}=${f}`),`#${k.join("&")}`}return`#${f}`}_getCurrentHash(){const o=i.window.location.hash.replace("#","");if(this._hashName){let f;return o.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(f=x)}),(f&&f[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(x=>isNaN(x))){const x=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(f[3]||0):o.getBearing();return o.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:x,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=i.window.location.href.replace(/(#.+)?$/,this.getHashString());i.window.history.replaceState(i.window.history.state,null,o)}}function vo(_,o){const f=_.getCenter(),x=Math.round(100*_.getZoom())/100,S=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,S),O=Math.round(f.lng*k)/k,V=Math.round(f.lat*k)/k,G=_.getBearing(),te=_.getPitch();let ie=o?`/${O}/${V}/${x}`:`${x}/${V}/${O}`;return(G||te)&&(ie+="/"+Math.round(10*G)/10),te&&(ie+=`/${Math.round(te)}`),ie}const Rr={linearity:.3,easing:i.bezier(0,0,.3,1)},Wc=i.extend({deceleration:2500,maxSpeed:1400},Rr),Nu=i.extend({deceleration:20,maxSpeed:1400},Rr),hc=i.extend({deceleration:1e3,maxSpeed:360},Rr),Jh=i.extend({deceleration:1e3,maxSpeed:90},Rr);class Uu{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,f=i.exported.now();for(;o.length>0&&f-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new i.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)f.zoom+=k.zoomDelta||0,f.bearing+=k.bearingDelta||0,f.pitch+=k.pitchDelta||0,k.panDelta&&f.pan._add(k.panDelta),k.around&&(f.around=k.around),k.pinchAround&&(f.pinchAround=k.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(f.pan.mag()){const k=gs(f.pan.mag(),x,i.extend({},Wc,o||{}));S.offset=f.pan.mult(k.amount/f.pan.mag()),S.center=this._map.transform.center,Xc(S,k)}if(f.zoom){const k=gs(f.zoom,x,Nu);S.zoom=this._map.transform.zoom+k.amount,Xc(S,k)}if(f.bearing){const k=gs(f.bearing,x,hc);S.bearing=this._map.transform.bearing+i.clamp(k.amount,-179,179),Xc(S,k)}if(f.pitch){const k=gs(f.pitch,x,Jh);S.pitch=this._map.transform.pitch+k.amount,Xc(S,k)}if(S.zoom||S.bearing){const k=f.pinchAround===void 0?f.around:f.pinchAround;S.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function Xc(_,o){(!_.duration||_.duration<o.duration)&&(_.duration=o.duration,_.easing=o.easing)}function gs(_,o,f){const{maxSpeed:x,linearity:S,deceleration:k}=f,O=i.clamp(_*S/(o/1e3),-x,x),V=Math.abs(O)/(k*S);return{easing:f.easing,duration:1e3*V,amount:O*(V/2)}}class os extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,x,S={}){const k=Me(f.getCanvasContainer(),x),O=f.unproject(k);super(o,i.extend({point:k,lngLat:O,originalEvent:x},S)),this._defaultPrevented=!1,this.target=f}}class an extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,x){const S=o==="touchend"?x.changedTouches:x.touches,k=Ye(f.getCanvasContainer(),S),O=k.map(G=>f.unproject(G)),V=k.reduce((G,te,ie,ge)=>G.add(te.div(ge.length)),new i.pointGeometry(0,0));super(o,{points:k,point:V,lngLats:O,lngLat:f.unproject(V),originalEvent:x}),this._defaultPrevented=!1}}class yn extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,x){super(o,{originalEvent:x}),this._defaultPrevented=!1}}class Hc{constructor(o,f){this._map=o,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new yn(o.type,this._map,o))}mousedown(o,f){return this._mousedownPos=f,this._firePreventable(new os(o.type,this._map,o))}mouseup(o){this._map.fire(new os(o.type,this._map,o))}preclick(o){const f=i.extend({},o);f.type="preclick",this._map.fire(new os(f.type,this._map,f))}click(o,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(o),this._map.fire(new os(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new os(o.type,this._map,o))}mouseover(o){this._map.fire(new os(o.type,this._map,o))}mouseout(o){this._map.fire(new os(o.type,this._map,o))}touchstart(o){return this._firePreventable(new an(o.type,this._map,o))}touchmove(o){this._map.fire(new an(o.type,this._map,o))}touchend(o){this._map.fire(new an(o.type,this._map,o))}touchcancel(o){this._map.fire(new an(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qh{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new os(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new os("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new os(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fl{constructor(o,f){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,f){this.isEnabled()&&o.shiftKey&&o.button===0&&($e(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(o,f){if(!this._active)return;const x=f,S=this._startPos,k=this._lastPos;if(!S||!k||k.equals(x)||!this._box&&x.dist(S)<this._clickTolerance)return;this._lastPos=x,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const O=Math.min(S.x,x.x),V=Math.max(S.x,x.x),G=Math.min(S.y,x.y),te=Math.max(S.y,x.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${G}px)`,this._box.style.width=V-O+"px",this._box.style.height=te-G+"px")})}mouseupWindow(o,f){if(!this._active)return;const x=this._startPos,S=f;if(x&&o.button===0){if(this.reset(),mt(),x.x!==S.x||x.y!==S.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:k=>k.fitScreenCoordinates(x,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tt(),delete this._startPos,delete this._lastPos}_fireEvent(o,f){return this._map.fire(new i.Event(o,{originalEvent:f}))}}function Ao(_,o){const f={};for(let x=0;x<_.length;x++)f[_[x].identifier]=o[x];return f}class Na{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,f,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),x.length===this.numTouches&&(this.centroid=function(S){const k=new i.pointGeometry(0,0);for(const O of S)k._add(O);return k.div(S.length)}(f),this.touches=Ao(x,f)))}touchmove(o,f,x){if(this.aborted||!this.centroid)return;const S=Ao(x,f);for(const k in this.touches){const O=this.touches[k],V=S[k];(!V||V.dist(O)>30)&&(this.aborted=!0)}}touchend(o,f,x){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class qs{constructor(o){this.singleTap=new Na(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,f,x){this.singleTap.touchstart(o,f,x)}touchmove(o,f,x){this.singleTap.touchmove(o,f,x)}touchend(o,f,x){const S=this.singleTap.touchend(o,f,x);if(S){const k=o.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(S)<30;if(k&&O||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class ed{constructor(){this._zoomIn=new qs({numTouches:1,numTaps:2}),this._zoomOut=new qs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,f,x){this._zoomIn.touchstart(o,f,x),this._zoomOut.touchstart(o,f,x)}touchmove(o,f,x){this._zoomIn.touchmove(o,f,x),this._zoomOut.touchmove(o,f,x)}touchend(o,f,x){const S=this._zoomIn.touchend(o,f,x),k=this._zoomOut.touchend(o,f,x);return S?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(S)},{originalEvent:o})}):k?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(k)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xa={0:1,2:2};class to{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,f){return!1}_move(o,f){return{}}mousedown(o,f){if(this._lastPoint)return;const x=Ze(o);this._correctButton(o,x)&&(this._lastPoint=f,this._eventButton=x)}mousemoveWindow(o,f){const x=this._lastPoint;if(x){if(o.preventDefault(),this._eventButton!=null&&function(S,k){const O=xa[k];return S.buttons===void 0||(S.buttons&O)!==O}(o,this._eventButton))this.reset();else if(this._moved||!(f.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(x,f)}}mouseupWindow(o){this._lastPoint&&Ze(o)===this._eventButton&&(this._moved&&mt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zo extends to{mousedown(o,f){super.mousedown(o,f),this._lastPoint&&(this._active=!0)}_correctButton(o,f){return f===0&&!o.ctrlKey}_move(o,f){return{around:f,panDelta:f.sub(o)}}}class $u extends to{_correctButton(o,f){return f===0&&o.ctrlKey||f===2}_move(o,f){const x=.8*(f.x-o.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(o){o.preventDefault()}}class pl extends to{_correctButton(o,f){return f===0&&o.ctrlKey||f===2}_move(o,f){const x=-.5*(f.y-o.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(o){o.preventDefault()}}class C{constructor(o,f){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),i.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.pointGeometry(0,0)}touchstart(o,f,x){return this._calculateTransform(o,f,x)}touchmove(o,f,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(x.length===1&&!i.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,f,x)}}touchend(o,f,x){this._calculateTransform(o,f,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,f,x){x.length>0&&(this._active=!0);const S=Ao(x,f),k=new i.pointGeometry(0,0),O=new i.pointGeometry(0,0);let V=0;for(const te in S){const ie=S[te],ge=this._touches[te];ge&&(k._add(ie),O._add(ie.sub(ge)),V++,S[te]=ie)}if(this._touches=S,V<this._minTouches||!O.mag())return;const G=O.div(V);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(V),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class a{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,f,x){return{}}touchstart(o,f,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([f[0],f[1]]))}touchmove(o,f,x){const S=this._firstTwoTouches;if(!S)return;o.preventDefault();const[k,O]=S,V=m(x,f,k),G=m(x,f,O);if(!V||!G)return;const te=this._aroundCenter?null:V.add(G).div(2);return this._move([V,G],te,o)}touchend(o,f,x){if(!this._firstTwoTouches)return;const[S,k]=this._firstTwoTouches,O=m(x,f,S),V=m(x,f,k);O&&V||(this._active&&mt(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function m(_,o,f){for(let x=0;x<_.length;x++)if(_[x].identifier===f)return o[x]}function T(_,o){return Math.log(_/o)/Math.LN2}class A extends a{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,f){const x=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(T(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:T(this._distance,x),pinchAround:f}}}function L(_,o){return 180*_.angleWith(o)/Math.PI}class N extends a{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,f){const x=this._vector;if(this._vector=o[0].sub(o[1]),x&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:L(this._vector,x),pinchAround:f}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const f=25/(Math.PI*this._minDiameter)*360,x=this._startVector;if(!x)return!1;const S=L(o,x);return Math.abs(S)<f}}function H(_){return Math.abs(_.y)>Math.abs(_.x)}class Q extends a{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,H(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,f,x){const S=this._lastPoints;if(!S)return;const k=o[0].sub(S[0]),O=o[1].sub(S[1]);return this._map._cooperativeGestures&&!i.isFullscreen()&&x.touches.length<3||(this._valid=this.gestureBeginsVertically(k,O,x.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(k.y+O.y)/2*-.5})}gestureBeginsVertically(o,f,x){if(this._valid!==void 0)return this._valid;const S=o.mag()>=2,k=f.mag()>=2;if(!S&&!k)return;if(!S||!k)return this._firstMove==null&&(this._firstMove=x),x-this._firstMove<100&&void 0;const O=o.y>0==f.y>0;return H(o)&&H(f)&&O}}const se={panStep:100,bearingStep:15,pitchStep:10};class pe{constructor(){const o=se;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let f=0,x=0,S=0,k=0,O=0;switch(o.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:o.shiftKey?x=-1:(o.preventDefault(),k=-1);break;case 39:o.shiftKey?x=1:(o.preventDefault(),k=1);break;case 38:o.shiftKey?S=1:(o.preventDefault(),O=-1);break;case 40:o.shiftKey?S=-1:(o.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(x=0,S=0),{cameraAnimation:V=>{const G=V.getZoom();V.easeTo({duration:300,easeId:"keyboardHandler",easing:xe,zoom:f?Math.round(G)+f*(o.shiftKey?2:1):G,bearing:V.getBearing()+x*this._bearingStep,pitch:V.getPitch()+S*this._pitchStep,offset:[-k*this._panStep,-O*this._panStep],center:V.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xe(_){return _*(2-_)}const Ee=4.000244140625;class Qe{constructor(o,f){this._map=o,this._el=o.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=o.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const x=i.exported.now(),S=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,f!==0&&f%Ee==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(S*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),o.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=o,this._delta-=f,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Me(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>Ee?this._wheelZoomRate:this._defaultZoomRate;let te=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&te!==0&&(te=1/te);const ie=f(),ge=Math.pow(2,ie),Te=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):ge;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Te*te))),this._type==="wheel"&&(this._startZoom=ie,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:f(),S=this._startZoom,k=this._easing;let O,V=!1;if(this._type==="wheel"&&S&&k){const G=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),te=k(G);O=i.number(S,x,te),G<1?this._frameId||(this._frameId=!0):V=!0}else O=x,V=!0;return this._active=!0,V&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!V,zoomDelta:O-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let f=i.ease;if(this._prevEase){const x=this._prevEase,S=(i.exported.now()-x.start)/x.duration,k=x.easing(S+.01)-x.easing(S),O=.27/Math.sqrt(k*k+1e-4)*.01,V=Math.sqrt(.0729-O*O);f=i.bezier(O,V,.25,1)}return this._prevEase={start:i.exported.now(),duration:o,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(i.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ge{constructor(o,f){this._clickZoom=o,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class We{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,f){return o.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(o.shiftKey?-1:1),around:x.unproject(f)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _t{constructor(){this._tap=new qs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,f,x){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=f[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(o,f,x))}touchmove(o,f,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const S=f[0],k=S.y-this._swipePoint.y;return this._swipePoint=S,o.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(o,f,x)}touchend(o,f,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(o,f,x)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tt{constructor(o,f,x){this._el=o,this._mousePan=f,this._touchPan=x}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class kt{constructor(o,f,x){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=f,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ot{constructor(o,f,x,S){this._el=o,this._touchZoom=f,this._touchRotate=x,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ft=_=>_.zoom||_.drag||_.pitch||_.rotate;class Rt extends i.Event{}class ii{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,f){const x=i.sub([],f,o);this.radius=i.length(x[2]<0?i.div([],x,this.constants):[x[0],x[1],0])}projectRay(o){i.div(o,o,this.constants),i.normalize(o,o),i.mul$1(o,o,this.constants);const f=i.scale$2([],o,this.radius);if(f[2]>0){const x=i.scale$2([],[0,0,1],i.dot(f,[0,0,1])),S=i.scale$2([],i.normalize([],[f[0],f[1],0]),this.radius),k=i.add([],f,i.scale$2([],i.sub([],i.add([],S,x),f),2));f[0]=k[0],f[1]=k[1]}return f}}function Qt(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class _i{constructor(o,f){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uu(o),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ii,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),i.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[i.window.document,"mousemove",{capture:!0}],[i.window.document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[i.window,"blur",void 0]];for(const[S,k,O]of this._listeners)S.addEventListener(k,S===i.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[o,f,x]of this._listeners)o.removeEventListener(f,o===i.window.document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(o){const f=this._map,x=f.getCanvasContainer();this._add("mapEvent",new Hc(f,o));const S=f.boxZoom=new fl(f,o);this._add("boxZoom",S);const k=new ed,O=new We;f.doubleClickZoom=new Ge(O,k),this._add("tapZoom",k),this._add("clickZoom",O);const V=new _t;this._add("tapDragZoom",V);const G=f.touchPitch=new Q(f);this._add("touchPitch",G);const te=new $u(o),ie=new pl(o);f.dragRotate=new kt(o,te,ie),this._add("mouseRotate",te,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate"]);const ge=new zo(o),Te=new C(f,o);f.dragPan=new Tt(x,ge,Te),this._add("mousePan",ge),this._add("touchPan",Te,["touchZoom","touchRotate"]);const Be=new N,Le=new A;f.touchZoomRotate=new ot(x,Le,Be,V),this._add("touchRotate",Be,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qh(f));const Re=f.scrollZoom=new Qe(f,this);this._add("scrollZoom",Re,["mousePan"]);const Pe=f.keyboard=new pe;this._add("keyboard",Pe);for(const ze of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ze]&&f[ze].enable(o[ze])}_add(o,f,x){this._handlers.push({handlerName:o,handler:f,allowed:x}),this._handlersById[o]=f}stop(o){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ft(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,f,x){for(const S in o)if(S!==x&&(!f||f.indexOf(S)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const f=[];for(const x of o)this._el.contains(x.target)&&f.push(x);return f}handleEvent(o,f){this._updatingCamera=!0;const x=o.type==="renderFrame",S=x?void 0:o,k={needsRenderFrame:!1},O={},V={},G=o.touches?this._getMapTouches(o.touches):void 0,te=G?Ye(this._el,G):x?void 0:Me(this._el,o);for(const{handlerName:Te,handler:Be,allowed:Le}of this._handlers){if(!Be.isEnabled())continue;let Re;this._blockedByActive(V,Le,Te)?Be.reset():Be[f||o.type]&&(Re=Be[f||o.type](o,te,G),this.mergeHandlerResult(k,O,Re,Te,S),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||Be.isActive())&&(V[Te]=Be)}const ie={};for(const Te in this._previousActiveHandlers)V[Te]||(ie[Te]=S);this._previousActiveHandlers=V,(Object.keys(ie).length||Qt(k))&&(this._changes.push([k,O,ie]),this._triggerRenderFrame()),(Object.keys(V).length||Qt(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ge}=k;ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ge(this._map))}mergeHandlerResult(o,f,x,S,k){if(!x)return;i.extend(o,x);const O={handlerName:S,originalEvent:x.originalEvent||k};x.zoomDelta!==void 0&&(f.zoom=O),x.panDelta!==void 0&&(f.drag=O),x.pitchDelta!==void 0&&(f.pitch=O),x.bearingDelta!==void 0&&(f.rotate=O)}_applyChanges(){const o={},f={},x={};for(const[S,k,O]of this._changes)S.panDelta&&(o.panDelta=(o.panDelta||new i.pointGeometry(0,0))._add(S.panDelta)),S.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(o.around=S.around),S.aroundCoord!==void 0&&(o.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(o.pinchAround=S.pinchAround),S.noInertia&&(o.noInertia=S.noInertia),i.extend(f,k),i.extend(x,O);this._updateMapTransform(o,f,x),this._changes=[]}_updateMapTransform(o,f,x){const S=this._map,k=S.transform,O=Ne=>[Ne.x,Ne.y,Ne.z];if((Ne=>{const Fe=this._eventsInProgress.drag;return Fe&&!this._handlersById[Fe.handlerName].isActive()})()&&!Qt(o)){const Ne=k.zoom;k.cameraElevationReference="sea",k.recenterOnTerrain(),k.cameraElevationReference="ground",Ne!==k.zoom&&this._map._update(!0)}if(k._isCameraConstrained&&S._stop(!0),!Qt(o))return void this._fireEvents(f,x,!0);let{panDelta:V,zoomDelta:G,bearingDelta:te,pitchDelta:ie,around:ge,aroundCoord:Te,pinchAround:Be}=o;k._isCameraConstrained&&(G>0&&(G=0),k._isCameraConstrained=!1),Be!==void 0&&(ge=Be),(Ne=>f.drag&&!this._eventsInProgress.drag)()&&ge&&(this._dragOrigin=O(k.pointCoordinate3D(ge)),this._trackingEllipsoid.setup(k._camera.position,this._dragOrigin)),k.cameraElevationReference="sea",S._stop(!0),ge=ge||S.transform.centerPoint,te&&(k.bearing+=te),ie&&(k.pitch+=ie),k._updateCameraState();const Le=[0,0,0];if(V)if(k.projection.name==="mercator"){const Ne=this._trackingEllipsoid.projectRay(k.screenPointToMercatorRay(ge).dir),Fe=this._trackingEllipsoid.projectRay(k.screenPointToMercatorRay(ge.sub(V)).dir);Le[0]=Fe[0]-Ne[0],Le[1]=Fe[1]-Ne[1]}else{const Ne=k.pointCoordinate(ge);if(k.projection.name==="globe"){V=V.rotate(-k.angle);const Fe=k._pixelsPerMercatorPixel/k.worldSize;Le[0]=-V.x*i.mercatorScale(i.latFromMercatorY(Ne.y))*Fe,Le[1]=-V.y*i.mercatorScale(k.center.lat)*Fe}else{const Fe=k.pointCoordinate(ge.sub(V));Ne&&Fe&&(Le[0]=Fe.x-Ne.x,Le[1]=Fe.y-Ne.y)}}const Re=k.zoom,Pe=[0,0,0];if(G){const Ne=O(Te||k.pointCoordinate3D(ge)),Fe={dir:i.normalize([],i.sub([],Ne,k._camera.position))};if(Fe.dir[2]<0){const et=k.zoomDeltaToMovement(Ne,G);i.scale$2(Pe,Fe.dir,et)}}const ze=i.add(Le,Le,Pe);k._translateCameraConstrained(ze),G&&Math.abs(k.zoom-Re)>1e-4&&k.recenterOnTerrain(),k.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(f,x,!0)}_fireEvents(o,f,x){const S=ft(this._eventsInProgress),k=ft(o),O={};for(const ie in o){const{originalEvent:ge}=o[ie];this._eventsInProgress[ie]||(O[`${ie}start`]=ge),this._eventsInProgress[ie]=o[ie]}!S&&k&&this._fireEvent("movestart",k.originalEvent);for(const ie in O)this._fireEvent(ie,O[ie]);k&&this._fireEvent("move",k.originalEvent);for(const ie in o){const{originalEvent:ge}=o[ie];this._fireEvent(ie,ge)}const V={};let G;for(const ie in this._eventsInProgress){const{handlerName:ge,originalEvent:Te}=this._eventsInProgress[ie];this._handlersById[ge].isActive()||(delete this._eventsInProgress[ie],G=f[ge]||Te,V[`${ie}end`]=G)}for(const ie in V)this._fireEvent(ie,V[ie]);const te=ft(this._eventsInProgress);if(x&&(S||k)&&!te){this._updatingCamera=!0;const ie=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ge=Te=>Te!==0&&-this._bearingSnap<Te&&Te<this._bearingSnap;ie?(ge(ie.bearing||this._map.getBearing())&&(ie.bearing=0),this._map.easeTo(ie,{originalEvent:G})):(this._map.fire(new i.Event("moveend",{originalEvent:G})),ge(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,f){this._map.fire(new i.Event(o,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Rt("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Jt="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ji extends i.Evented{constructor(o,f){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=f.bearingSnap,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,f){return this.jumpTo({center:o},f)}panBy(o,f,x){return o=i.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,i.extend({offset:o},f),x)}panTo(o,f,x){return this.easeTo(i.extend({center:o},f),x)}getZoom(){return this.transform.zoom}setZoom(o,f){return this.jumpTo({zoom:o},f),this}zoomTo(o,f,x){return this.easeTo(i.extend({zoom:o},f),x)}zoomIn(o,f){return this.zoomTo(this.getZoom()+1,o,f),this}zoomOut(o,f){return this.zoomTo(this.getZoom()-1,o,f),this}getBearing(){return this.transform.bearing}setBearing(o,f){return this.jumpTo({bearing:o},f),this}getPadding(){return this.transform.padding}setPadding(o,f){return this.jumpTo({padding:o},f),this}rotateTo(o,f,x){return this.easeTo(i.extend({bearing:o},f),x)}resetNorth(o,f){return this.rotateTo(0,i.extend({duration:1e3},o),f),this}resetNorthPitch(o,f){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},o),f),this}snapToNorth(o,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,f):this}getPitch(){return this.transform.pitch}setPitch(o,f){return this.jumpTo({pitch:o},f),this}cameraForBounds(o,f){o=i.LngLatBounds.convert(o);const x=f&&f.bearing||0,S=f&&f.pitch||0,k=o.getNorthWest(),O=o.getSouthEast();return this._cameraForBounds(this.transform,k,O,x,S,f)}_extendCameraOptions(o){const f={top:0,bottom:0,right:0,left:0};if(typeof(o=i.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const x=o.padding;o.padding={top:x,bottom:x,right:x,left:x}}return o.padding=i.extend(f,o.padding),o}_minimumAABBFrustumDistance(o,f){const x=f.max[0]-f.min[0],S=f.max[1]-f.min[1];return x/S>o.aspect?x/(2*Math.tan(.5*o.fovX)*o.aspect):S/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,f,x,S,k,O){const V=o.clone(),G=this._extendCameraOptions(O);V.bearing=S,V.pitch=k;const te=i.LngLat.convert(f),ie=i.LngLat.convert(x),ge=.5*(te.lat+ie.lat),Te=.5*(te.lng+ie.lng),Be=i.latLngToECEF(ge,Te),Le=i.normalize([],Be),Re=i.normalize([],i.cross([],Le,[0,1,0])),Pe=i.cross([],Re,Le),ze=[Re[0],Re[1],Re[2],0,Pe[0],Pe[1],Pe[2],0,Le[0],Le[1],Le[2],0,0,0,0,1],Ne=[Be,i.latLngToECEF(te.lat,te.lng),i.latLngToECEF(ie.lat,te.lng),i.latLngToECEF(ie.lat,ie.lng),i.latLngToECEF(te.lat,ie.lng),i.latLngToECEF(ge,te.lng),i.latLngToECEF(ge,ie.lng),i.latLngToECEF(te.lat,Te),i.latLngToECEF(ie.lat,Te)];let Fe=i.Aabb.fromPoints(Ne.map(St=>[i.dot(Re,St),i.dot(Pe,St),i.dot(Le,St)]));const et=i.transformMat4([],Fe.center,ze);i.squaredLength(et)===0&&i.set(et,0,0,1),i.normalize(et,et),i.scale$2(et,et,i.GLOBE_RADIUS),V.center=i.ecefToLatLng(et);const ut=V.getWorldToCameraMatrix(),lt=i.invert(new Float64Array(16),ut);Fe=i.Aabb.applyTransform(Fe,i.multiply([],ut,ze)),i.transformMat4(et,et,ut);const yt=.5*(Fe.max[2]-Fe.min[2]),$t=this._minimumAABBFrustumDistance(V,Fe),Dt=i.scale$2([],[0,0,1],yt),Et=i.add(Dt,et,Dt),bi=$t+(V.pitch===0?0:i.distance(et,Et)),wt=V.globeCenterInViewSpace,ei=i.sub([],et,[wt[0],wt[1],wt[2]]);i.normalize(ei,ei),i.scale$2(ei,ei,bi);const qt=i.add([],et,ei);i.transformMat4(qt,qt,lt);const pi=i.earthRadius/i.GLOBE_RADIUS,Gt=i.length(qt),ai=i.mercatorZfromAltitude(Gt*pi-i.earthRadius,0),Ti=Math.min(V.zoomFromMercatorZAdjusted(ai),G.maxZoom);return Ti>.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(V.setProjection({name:"mercator"}),V.zoom=Ti,this._cameraForBounds(V,f,x,S,k,O)):{center:V.center,zoom:Ti,bearing:S,pitch:k}}queryTerrainElevation(o,f){const x=this.transform.elevation;return x?(f=i.extend({},{exaggerated:!0},f),x.getAtPoint(i.MercatorCoordinate.fromLngLat(o),null,f.exaggerated)):null}_cameraForBounds(o,f,x,S,k,O){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,f,x,S,k,O);const V=o.clone(),G=this._extendCameraOptions(O),te=V.padding;V.bearing=S,V.pitch=k;const ie=i.LngLat.convert(f),ge=i.LngLat.convert(x),Te=new i.LngLat(ie.lng,ge.lat),Be=new i.LngLat(ge.lng,ie.lat),Le=V.project(ie),Re=V.project(ge),Pe=this.queryTerrainElevation(ie),ze=this.queryTerrainElevation(ge),Ne=this.queryTerrainElevation(Te),Fe=this.queryTerrainElevation(Be),et=[[Le.x,Le.y,Math.min(Pe||0,ze||0,Ne||0,Fe||0)],[Re.x,Re.y,Math.max(Pe||0,ze||0,Ne||0,Fe||0)]];let ut=i.Aabb.fromPoints(et);const lt=V.getWorldToCameraMatrix(),yt=i.invert(new Float64Array(16),lt);ut=i.Aabb.applyTransform(ut,lt);const $t=i.sub([],ut.max,ut.min),Dt=te.left||0,Et=te.right||0,bi=te.bottom||0,wt=te.top||0,{left:ei,right:qt,top:pi,bottom:Gt}=G.padding,ai=.5*(Dt+Et),Ti=.5*(wt+bi),St=Math.min(V.scaleZoom(V.scale*Math.min((V.width-(Dt+Et+ei+qt))/$t[0],(V.height-(bi+wt+Gt+pi))/$t[1])),G.maxZoom),Zt=V.scale/V.zoomScale(St);ut=new i.Aabb([ut.min[0]-(ei+ai)*Zt,ut.min[1]-(Gt+Ti)*Zt,ut.min[2]],[ut.max[0]+(qt+ai)*Zt,ut.max[1]+(pi+Ti)*Zt,ut.max[2]]);const sn=.5*$t[2],vn=this._minimumAABBFrustumDistance(V,ut),rn=[0,0,1,0];i.transformMat4$1(rn,rn,lt),i.normalize$2(rn,rn);const Cn=i.scale$2([],rn,vn+sn),Nn=i.add([],ut.center,Cn),gn=(typeof G.offset.x=="number"&&typeof G.offset.y=="number"?new i.pointGeometry(G.offset.x,G.offset.y):i.pointGeometry.convert(G.offset)).rotate(-i.degToRad(S));ut.center[0]-=gn.x*Zt,ut.center[1]+=gn.y*Zt,i.transformMat4(ut.center,ut.center,yt),i.transformMat4(Nn,Nn,yt);const Yi=[ut.center[0],ut.center[1],Nn[2]*V.pixelsPerMeter];i.scale$2(Yi,Yi,1/V.worldSize);const br=i.lngFromMercatorX(Yi[0]),Ir=i.latFromMercatorY(Yi[1]),Ar=Math.min(V._zoomFromMercatorZ(Yi[2]),G.maxZoom),Mr=new i.LngLat(br,Ir);return V.mercatorFromTransition&&Ar<.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(V.setProjection({name:"globe"}),V.zoom=Ar,this._cameraForBounds(V,f,x,S,k,O)):{center:Mr,zoom:Ar,bearing:S,pitch:k}}fitBounds(o,f,x){const S=this.cameraForBounds(o,f);return this._fitInternal(S,f,x)}fitScreenCoordinates(o,f,x,S,k){const O=i.pointGeometry.convert(o),V=i.pointGeometry.convert(f),G=new i.pointGeometry(Math.min(O.x,V.x),Math.min(O.y,V.y)),te=new i.pointGeometry(Math.max(O.x,V.x),Math.max(O.y,V.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(O,V))return this;const ie=this.transform.pointLocation3D(G),ge=this.transform.pointLocation3D(te),Te=this.transform.pointLocation3D(new i.pointGeometry(G.x,te.y)),Be=this.transform.pointLocation3D(new i.pointGeometry(te.x,G.y)),Le=[Math.min(ie.lng,ge.lng,Te.lng,Be.lng),Math.min(ie.lat,ge.lat,Te.lat,Be.lat)],Re=[Math.max(ie.lng,ge.lng,Te.lng,Be.lng),Math.max(ie.lat,ge.lat,Te.lat,Be.lat)],Pe=S&&S.pitch?S.pitch:this.getPitch(),ze=this._cameraForBounds(this.transform,Le,Re,x,Pe,S);return this._fitInternal(ze,S,k)}_fitInternal(o,f,x){return o?(delete(f=i.extend(o,f)).padding,f.linear?this.easeTo(f,x):this.flyTo(f,x)):this}jumpTo(o,f){this.stop();const x=o.preloadOnly?this.transform.clone():this.transform;let S=!1,k=!1,O=!1;return"zoom"in o&&x.zoom!==+o.zoom&&(S=!0,x.zoom=+o.zoom),o.center!==void 0&&(x.center=i.LngLat.convert(o.center)),"bearing"in o&&x.bearing!==+o.bearing&&(k=!0,x.bearing=+o.bearing),"pitch"in o&&x.pitch!==+o.pitch&&(O=!0,x.pitch=+o.pitch),o.padding==null||x.isPaddingEqual(o.padding)||(x.padding=o.padding),o.preloadOnly?(this._preloadTiles(x),this):(this.fire(new i.Event("movestart",f)).fire(new i.Event("move",f)),S&&this.fire(new i.Event("zoomstart",f)).fire(new i.Event("zoom",f)).fire(new i.Event("zoomend",f)),k&&this.fire(new i.Event("rotatestart",f)).fire(new i.Event("rotate",f)).fire(new i.Event("rotateend",f)),O&&this.fire(new i.Event("pitchstart",f)).fire(new i.Event("pitch",f)).fire(new i.Event("pitchend",f)),this.fire(new i.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.warnOnce(Jt),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,f){const x=this.transform;if(!x.projection.supportsFreeCamera)return i.warnOnce(Jt),this;this.stop();const S=x.zoom,k=x.pitch,O=x.bearing;x.setFreeCameraOptions(o);const V=S!==x.zoom,G=k!==x.pitch,te=O!==x.bearing;return this.fire(new i.Event("movestart",f)).fire(new i.Event("move",f)),V&&this.fire(new i.Event("zoomstart",f)).fire(new i.Event("zoom",f)).fire(new i.Event("zoomend",f)),te&&this.fire(new i.Event("rotatestart",f)).fire(new i.Event("rotate",f)).fire(new i.Event("rotateend",f)),G&&this.fire(new i.Event("pitchstart",f)).fire(new i.Event("pitch",f)).fire(new i.Event("pitchend",f)),this.fire(new i.Event("moveend",f)),this}easeTo(o,f){this._stop(!1,o.easeId),((o=i.extend({offset:[0,0],duration:500,easing:i.ease},o)).animate===!1||!o.essential&&i.exported.prefersReducedMotion)&&(o.duration=0);const x=this.transform,S=this.getZoom(),k=this.getBearing(),O=this.getPitch(),V=this.getPadding(),G="zoom"in o?+o.zoom:S,te="bearing"in o?this._normalizeBearing(o.bearing,k):k,ie="pitch"in o?+o.pitch:O,ge="padding"in o?o.padding:x.padding,Te=i.pointGeometry.convert(o.offset);let Be,Le,Re;if(x.projection.name==="globe"){const Dt=i.MercatorCoordinate.fromLngLat(x.center),Et=Te.rotate(-x.angle);Dt.x+=Et.x/x.worldSize,Dt.y+=Et.y/x.worldSize;const bi=Dt.toLngLat(),wt=i.LngLat.convert(o.center||bi);this._normalizeCenter(wt),Be=x.centerPoint.add(Et),Le=new i.pointGeometry(Dt.x,Dt.y).mult(x.worldSize),Re=new i.pointGeometry(i.mercatorXfromLng(wt.lng),i.mercatorYfromLat(wt.lat)).mult(x.worldSize).sub(Le)}else{Be=x.centerPoint.add(Te);const Dt=x.pointLocation(Be),Et=i.LngLat.convert(o.center||Dt);this._normalizeCenter(Et),Le=x.project(Dt),Re=x.project(Et).sub(Le)}const Pe=x.zoomScale(G-S);let ze,Ne;o.around&&(ze=i.LngLat.convert(o.around),Ne=x.locationPoint(ze));const Fe=this._zooming||G!==S,et=this._rotating||k!==te,ut=this._pitching||ie!==O,lt=!x.isPaddingEqual(ge),yt=Dt=>Et=>{if(Fe&&(Dt.zoom=i.number(S,G,Et)),et&&(Dt.bearing=i.number(k,te,Et)),ut&&(Dt.pitch=i.number(O,ie,Et)),lt&&(Dt.interpolatePadding(V,ge,Et),Be=Dt.centerPoint.add(Te)),ze)Dt.setLocationAtPoint(ze,Ne);else{const bi=Dt.zoomScale(Dt.zoom-S),wt=G>S?Math.min(2,Pe):Math.max(.5,Pe),ei=Math.pow(wt,1-Et),qt=Dt.unproject(Le.add(Re.mult(Et*ei)).mult(bi));Dt.setLocationAtPoint(Dt.renderWorldCopies?qt.wrap():qt,Be)}return o.preloadOnly||this._fireMoveEvents(f),Dt};if(o.preloadOnly){const Dt=this._emulate(yt,o.duration,x);return this._preloadTiles(Dt),this}const $t={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Fe,this._rotating=et,this._pitching=ut,this._padding=lt,this._easeId=o.easeId,this._prepareEase(f,o.noMoveStart,$t),this._ease(yt(x),Dt=>{x.recenterOnTerrain(),this._afterEase(f,Dt)},o),this}_prepareEase(o,f,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||x.moving||this.fire(new i.Event("movestart",o)),this._zooming&&!x.zooming&&this.fire(new i.Event("zoomstart",o)),this._rotating&&!x.rotating&&this.fire(new i.Event("rotatestart",o)),this._pitching&&!x.pitching&&this.fire(new i.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.Event("move",o)),this._zooming&&this.fire(new i.Event("zoom",o)),this._rotating&&this.fire(new i.Event("rotate",o)),this._pitching&&this.fire(new i.Event("pitch",o))}_afterEase(o,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const x=this._zooming,S=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new i.Event("zoomend",o)),S&&this.fire(new i.Event("rotateend",o)),k&&this.fire(new i.Event("pitchend",o)),this.fire(new i.Event("moveend",o))}flyTo(o,f){if(!o.essential&&i.exported.prefersReducedMotion){const St=i.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(St,f)}this.stop(),o=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},o);const x=this.transform,S=this.getZoom(),k=this.getBearing(),O=this.getPitch(),V=this.getPadding(),G="zoom"in o?i.clamp(+o.zoom,x.minZoom,x.maxZoom):S,te="bearing"in o?this._normalizeBearing(o.bearing,k):k,ie="pitch"in o?+o.pitch:O,ge="padding"in o?o.padding:x.padding,Te=x.zoomScale(G-S),Be=i.pointGeometry.convert(o.offset);let Le=x.centerPoint.add(Be);const Re=x.pointLocation(Le),Pe=i.LngLat.convert(o.center||Re);this._normalizeCenter(Pe);const ze=x.project(Re),Ne=x.project(Pe).sub(ze);let Fe=o.curve;const et=Math.max(x.width,x.height),ut=et/Te,lt=Ne.mag();if("minZoom"in o){const St=i.clamp(Math.min(o.minZoom,S,G),x.minZoom,x.maxZoom),Zt=et/x.zoomScale(St-S);Fe=Math.sqrt(Zt/lt*2)}const yt=Fe*Fe;function $t(St){const Zt=(ut*ut-et*et+(St?-1:1)*yt*yt*lt*lt)/(2*(St?ut:et)*yt*lt);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function Dt(St){return(Math.exp(St)-Math.exp(-St))/2}function Et(St){return(Math.exp(St)+Math.exp(-St))/2}const bi=$t(0);let wt=function(St){return Et(bi)/Et(bi+Fe*St)},ei=function(St){return et*((Et(bi)*(Dt(Zt=bi+Fe*St)/Et(Zt))-Dt(bi))/yt)/lt;var Zt},qt=($t(1)-bi)/Fe;if(Math.abs(lt)<1e-6||!isFinite(qt)){if(Math.abs(et-ut)<1e-6)return this.easeTo(o,f);const St=ut<et?-1:1;qt=Math.abs(Math.log(ut/et))/Fe,ei=function(){return 0},wt=function(Zt){return Math.exp(St*Fe*Zt)}}o.duration="duration"in o?+o.duration:1e3*qt/("screenSpeed"in o?+o.screenSpeed/Fe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const pi=k!==te,Gt=ie!==O,ai=!x.isPaddingEqual(ge),Ti=St=>Zt=>{const sn=Zt*qt,vn=1/wt(sn);St.zoom=Zt===1?G:S+St.scaleZoom(vn),pi&&(St.bearing=i.number(k,te,Zt)),Gt&&(St.pitch=i.number(O,ie,Zt)),ai&&(St.interpolatePadding(V,ge,Zt),Le=St.centerPoint.add(Be));const rn=Zt===1?Pe:St.unproject(ze.add(Ne.mult(ei(sn))).mult(vn));return St.setLocationAtPoint(St.renderWorldCopies?rn.wrap():rn,Le),St._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(f),St};if(o.preloadOnly){const St=this._emulate(Ti,o.duration,x);return this._preloadTiles(St),this}return this._zooming=!0,this._rotating=pi,this._pitching=Gt,this._padding=ai,this._prepareEase(f,!1),this._ease(Ti(x),()=>this._afterEase(f),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const x=this._onEaseEnd;this._onEaseEnd=void 0,x.call(this,f)}if(!o){const x=this.handlers;x&&x.stop(!1)}return this}_ease(o,f,x){x.animate===!1||x.duration===0?(o(1),f()):(this._easeStart=i.exported.now(),this._easeOptions=x,this._onEaseFrame=o,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,f){o=i.wrap(o,-180,180);const x=Math.abs(o-f);return Math.abs(o-360-f)<x&&(o-=360),Math.abs(o+360-f)<x&&(o+=360),o}_normalizeCenter(o){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const x=o.lng-f.center.lng;o.lng+=x>180?-360:x<-180?360:0}_emulate(o,f,x){const S=Math.ceil(15*f/1e3),k=[],O=o(x.clone());for(let V=0;V<=S;V++){const G=O(V/S);k.push(G.clone())}return k}}class Vi{constructor(o={}){this.options=o,i.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const f=this.options&&this.options.compact;return this._map=o,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),q("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,f){const x=this._map._getUIString(`AttributionControl.${f}`);o.setAttribute("aria-label",x),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.config.ACCESS_TOKEN}];if(o){const x=f.reduce((S,k,O)=>(k.value&&(S+=`${k.key}=${k.value}${O<f.length-1?"&":""}`),S),"?");o.href=`${i.config.FEEDBACK_URL}/${x}#${vo(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const f=this._map.style._sourceCaches;for(const S in f){const k=f[S];if(k.used){const O=k.getSource();O.attribution&&o.indexOf(O.attribution)<0&&o.push(O.attribution)}}o.sort((S,k)=>S.length-k.length),o=o.filter((S,k)=>{for(let O=k+1;O<o.length;O++)if(o[O].indexOf(S)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const x=o.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,o.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class en{constructor(){i.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=q("div","mapboxgl-ctrl");const f=q("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const f in o){const x=o[f].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const f=o[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Rn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const f=++this._id;return this._queue.push({callback:o,id:f,cancelled:!1}),f}remove(o){const f=this._currentlyRunning,x=f?this._queue.concat(f):this._queue;for(const S of x)if(S.id===o)return void(S.cancelled=!0)}run(o=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const x of f)if(!x.cancelled&&(x.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function $n(_,o,f){if(_=new i.LngLat(_.lng,_.lat),o){const x=new i.LngLat(_.lng-360,_.lat),S=new i.LngLat(_.lng+360,_.lat),k=360*Math.ceil(Math.abs(_.lng-f.center.lng)/360),O=f.locationPoint(_).distSqr(o),V=o.x<0||o.y<0||o.x>f.width||o.y>f.height;f.locationPoint(x).distSqr(o)<O&&(V||Math.abs(x.lng-f.center.lng)<k)?_=x:f.locationPoint(S).distSqr(o)<O&&(V||Math.abs(S.lng-f.center.lng)<k)&&(_=S)}for(;Math.abs(_.lng-f.center.lng)>180;){const x=f.locationPoint(_);if(x.x>=0&&x.y>=0&&x.x<=f.width&&x.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _}const dn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class xr extends i.Evented{constructor(o,f){if(super(),(o instanceof i.window.HTMLElement||f)&&(o=i.extend({element:o},f)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=i.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=q("div");const S=41,k=27,O=re("svg",{display:"block",height:S*this._scale+"px",width:k*this._scale+"px",viewBox:`0 0 ${k} ${S}`},this._element),V=re("radialGradient",{id:"shadowGradient"},re("defs",{},O));re("stop",{offset:"10%","stop-opacity":.4},V),re("stop",{offset:"100%","stop-opacity":.05},V),re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=i.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const x=this._element.classList;for(const S in dn)x.remove(`mapboxgl-marker-anchor-${S}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const f=o.code,x=o.charCode||o.keyCode;f!=="Space"&&f!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(o){const f=o.originalEvent.target,x=this._element;this._popup&&(f===x||x.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,f=this._pos;if(!o||!f)return!1;const x=o.unproject(f),S=o.getFreeCameraOptions();if(!S.position)return!1;const k=S.position.toLngLat();return k.distanceTo(x)<.9*k.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const f=this._pos;if(!f||f.x<0||f.x>o.transform.width||f.y<0||f.y>o.transform.height)return void this._clearFadeTimer();const x=o.unproject(f);let S;o._showingGlobe()&&i.isLngLatBehindGlobe(o.transform,this._lngLat)?S=0:(S=1-o._queryFogOpacity(x),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${dn[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const o=this._pos,f=this._map,x=this.getPitchAlignment();if(!f||!o||x!=="map")return"";if(!f._showingGlobe()){const G=f.getPitch();return G?`rotateX(${G}deg)`:""}const S=i.radToDeg(i.globeTiltAtLngLat(f.transform,this._lngLat)),k=o.sub(i.globeCenterToScreenPoint(f.transform)),O=Math.abs(k.x)+Math.abs(k.y);if(O===0)return"";const V=S/O;return`rotateX(${-k.y*V}deg) rotateY(${k.x*V}deg)`}_calculateZTransform(){const o=this._pos,f=this._map;if(!f||!o)return"";let x=0;const S=this.getRotationAlignment();if(S==="map")if(f._showingGlobe()){const k=f.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=f.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(k);x=i.radToDeg(Math.atan2(O.y,O.x))-90}else x=-f.getBearing();else if(S==="horizon"){const k=i.smoothstep(4,6,f.getZoom()),O=i.globeCenterToScreenPoint(f.transform);O.y+=k*f.transform.height;const V=o.sub(O),G=i.radToDeg(Math.atan2(V.y,V.x));x=(G>90?G-270:G+90)*(1-k)}return x+=this._rotation,x?`rotateZ(${x}deg)`:""}_update(o){i.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=$n(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),o===!0?this._updateFrameId=i.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.pointGeometry.convert(o),this._update(),this}_onMove(o){const f=this._map;if(!f)return;const x=this._pointerdownPos,S=this._positionDelta;if(x&&S){if(!this._isDragging){const k=this._clickTolerance||f._clickTolerance;if(o.point.dist(x)<k)return;this._isDragging=!0}this._pos=o.point.sub(S),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(o){const f=this._map,x=this._pos;f&&x&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(x),this._pointerdownPos=o.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const f=this._map;return f&&(o?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Cr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ur=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hr(_=new i.pointGeometry(0,0),o="bottom"){if(typeof _=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(o){case"top":return new i.pointGeometry(0,_);case"top-left":return new i.pointGeometry(f,f);case"top-right":return new i.pointGeometry(-f,f);case"bottom":return new i.pointGeometry(0,-_);case"bottom-left":return new i.pointGeometry(f,-f);case"bottom-right":return new i.pointGeometry(-f,-f);case"left":return new i.pointGeometry(_,0);case"right":return new i.pointGeometry(-_,0)}return new i.pointGeometry(0,0)}return _ instanceof i.pointGeometry||Array.isArray(_)?i.pointGeometry.convert(_):i.pointGeometry.convert(_[o]||[0,0])}class Dr{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const f=i.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,f,x){this._start=this.getValue(f),this._end=o,this._startTime=f,this._endTime=f+x}}const Wo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ba={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},da={showCompass:!0,showZoom:!0,visualizePitch:!1};class wa{constructor(o,f,x=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new $u({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,x&&(this.mousePitch=new pl({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(o,f){this.mouseRotate.mousedown(o,f),this.mousePitch&&this.mousePitch.mousedown(o,f),$e()}move(o,f){const x=this.map,S=this.mouseRotate.mousemoveWindow(o,f),k=S&&S.bearingDelta;if(k&&x.setBearing(x.getBearing()+k),this.mousePitch){const O=this.mousePitch.mousemoveWindow(o,f),V=O&&O.pitchDelta;V&&x.setPitch(x.getPitch()+V)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tt(),i.window.removeEventListener("mousemove",this.mousemove),i.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(i.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Me(this.element,o)),i.window.addEventListener("mousemove",this.mousemove),i.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Me(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ye(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Ye(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ua={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Zs={maxWidth:100,unit:"metric"};function ws(_,o,f){const x=Ta(o),S=x/o,k={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[f];this._map._requestDomTask(()=>{this._container.style.width=_*S+"px",this._container.innerHTML=`${x}&nbsp;${k}`})}function Ta(_){const o=Math.pow(10,`${Math.floor(_)}`.length-1);let f=_/o;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:f>=1?1:function(x){const S=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*S)/S}(f),o*f}const Rl={version:i.version,supported:j,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends Ji{constructor(_){if(i.LivePerformanceUtils.mark(i.PerformanceMarkers.create),(_=i.extend({},ba,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&i.isSafariWithAntialiasingBug(i.window)&&(_.antialias=!1,i.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bl(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Rn,this._domRenderTaskQueue=new Rn,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.uniqueId(),this._locale=i.extend({},Wo,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Dr(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,typeof _.container=="string"){if(this._container=i.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof i.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&i.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),i.window!==void 0&&(i.window.addEventListener("online",this._onWindowOnline,!1),i.window.addEventListener("resize",this._onWindowResize,!1),i.window.addEventListener("orientationchange",this._onWindowResize,!1),i.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new _i(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new ji(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,i.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new Vi({customAttribution:_.customAttribution})),this._logoControl=new en,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new i.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new i.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(_,o){if(o===void 0&&(o=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const x=this._controlPositions[o];return o.indexOf("bottom")!==-1?x.insertBefore(f,x.firstChild):x.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(_);return o>-1&&this._controls.splice(o,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.Event("movestart",_)).fire(new i.Event("move",_)),this.fire(new i.Event("resize",_)),o&&this.fire(new i.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(i.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_==null?-2:_)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_==null?22:_)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_==null?0:_)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_==null?85:_)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?i.window.navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(o=>o==="auto"?i.window.navigator.language:o):_}setLanguage(_){const o=this._parseLanguage(_);if(!this.style||o===this._language)return this;this._language=o,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const _=this.transform,o=_.projection.name;let f;o==="globe"&&_.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),f=!0):o==="mercator"&&_.zoom<i.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,o){return this._updateProjection(_||o||{name:"mercator"})}_updateProjection(_){let o;if(o=_.name==="globe"&&this.transform.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),o){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(i.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(i.pointGeometry.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,o,f){if(_==="mouseenter"||_==="mouseover"){let x=!1;const S=O=>{const V=o.filter(te=>this.getLayer(te)),G=V.length?this.queryRenderedFeatures(O.point,{layers:V}):[];G.length?x||(x=!0,f.call(this,new os(_,this,O.originalEvent,{features:G}))):x=!1},k=()=>{x=!1};return{layers:new Set(o),listener:f,delegates:{mousemove:S,mouseout:k}}}if(_==="mouseleave"||_==="mouseout"){let x=!1;const S=O=>{const V=o.filter(G=>this.getLayer(G));(V.length?this.queryRenderedFeatures(O.point,{layers:V}):[]).length?x=!0:x&&(x=!1,f.call(this,new os(_,this,O.originalEvent)))},k=O=>{x&&(x=!1,f.call(this,new os(_,this,O.originalEvent)))};return{layers:new Set(o),listener:f,delegates:{mousemove:S,mouseout:k}}}{const x=S=>{const k=o.filter(V=>this.getLayer(V)),O=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];O.length&&(S.features=O,f.call(this,S),delete S.features)};return{layers:new Set(o),listener:f,delegates:{[_]:x}}}}on(_,o,f){if(f===void 0)return super.on(_,o);Array.isArray(o)||(o=[o]);const x=this._createDelegatedListener(_,o,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(x);for(const S in x.delegates)this.on(S,x.delegates[S]);return this}once(_,o,f){if(f===void 0)return super.once(_,o);Array.isArray(o)||(o=[o]);const x=this._createDelegatedListener(_,o,f);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(_,o,f){if(f===void 0)return super.off(_,o);o=new Set(Array.isArray(o)?o:[o]);const x=(k,O)=>{if(k.size!==O.size)return!1;for(const V of k)if(!O.has(V))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[_]:void 0;return S&&(k=>{for(let O=0;O<k.length;O++){const V=k[O];if(V.listener===f&&x(V.layers,o)){for(const G in V.delegates)this.off(G,V.delegates[G]);return k.splice(O,1),this}}})(S),this}queryRenderedFeatures(_,o){return this.style?(o!==void 0||_===void 0||_ instanceof i.pointGeometry||Array.isArray(_)||(o=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(_,o){return this.style.querySourceFeatures(_,o)}setStyle(_,o){return(o=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(_,o))}_getUIString(_){const o=this._locale[_];if(o==null)throw new Error(`Missing UI string '${_}'`);return o}_updateStyle(_,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Zo(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,o){if(typeof _=="string"){const f=this._requestManager.normalizeStyleURL(_),x=this._requestManager.transformRequest(f,i.ResourceType.Style);i.getJSON(x,(S,k)=>{S?this.fire(new i.ErrorEvent(S)):k&&this._updateDiff(k,o)})}else typeof _=="object"&&this._updateDiff(_,o)}_updateDiff(_,o){try{this.style.setState(_)&&this._update(!0)}catch(f){i.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.warnOnce("There is no style added to the map."),!1)}addSource(_,o){return this._lazyInitEmptyStyle(),this.style.addSource(_,o),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const o in _){const f=_[o]._tiles;for(const x in f){const S=f[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(_,o,f){this._lazyInitEmptyStyle(),this.style.addSourceType(_,o,f)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,o,{pixelRatio:f=1,sdf:x=!1,stretchX:S,stretchY:k,content:O}={}){if(this._lazyInitEmptyStyle(),o instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&o instanceof i.window.ImageBitmap){const{width:V,height:G,data:te}=i.exported.getImageData(o);this.style.addImage(_,{data:new i.RGBAImage({width:V,height:G},te),pixelRatio:f,stretchX:S,stretchY:k,content:O,sdf:x,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:V,height:G}=o,te=o;this.style.addImage(_,{data:new i.RGBAImage({width:V,height:G},new Uint8Array(te.data)),pixelRatio:f,stretchX:S,stretchY:k,content:O,sdf:x,version:0,userImage:te}),te.onAdd&&te.onAdd(this,_)}}updateImage(_,o){const f=this.style.getImage(_);if(!f)return void this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=o instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&o instanceof i.window.ImageBitmap?i.exported.getImageData(o):o,{width:S,height:k}=x;S!==void 0&&k!==void 0?S===f.data.width&&k===f.data.height?(f.data.replace(x.data,!(o instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&o instanceof i.window.ImageBitmap)),this.style.updateImage(_,f)):this.fire(new i.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${k})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,o){i.getImage(this._requestManager.transformRequest(_,i.ResourceType.Image),(f,x)=>{o(f,x instanceof i.window.HTMLImageElement?i.exported.getImageData(x):x)})}listImages(){return this.style.listImages()}addLayer(_,o){return this._lazyInitEmptyStyle(),this.style.addLayer(_,o),this._update(!0)}moveLayer(_,o){return this.style.moveLayer(_,o),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,o,f){return this.style.setLayerZoomRange(_,o,f),this._update(!0)}setFilter(_,o,f={}){return this.style.setFilter(_,o,f),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,o,f,x={}){return this.style.setPaintProperty(_,o,f,x),this._update(!0)}getPaintProperty(_,o){return this.style.getPaintProperty(_,o)}setLayoutProperty(_,o,f,x={}){return this.style.setLayoutProperty(_,o,f,x),this._update(!0)}getLayoutProperty(_,o){return this.style.getLayoutProperty(_,o)}setLight(_,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.LngLat.convert(_),this.transform):0}setFeatureState(_,o){return this.style.setFeatureState(_,o),this._update()}removeFeatureState(_,o){return this.style.removeFeatureState(_,o),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let f,x,S,k=this._container;for(;k&&(!x||!S);){const O=i.window.getComputedStyle(k).transform;O&&O!=="none"&&(f=O.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(x=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(S=f[3])),k=k.parentElement}this._containerWidth=x?Math.abs(_/x):_,this._containerHeight=S?Math.abs(o/S):o}_detectMissingCSS(){i.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=q("div","mapboxgl-canvas-container",_);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=q("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=q("div","mapboxgl-control-container",_),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{x[S]=q("div",`mapboxgl-ctrl-${S}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,o){const f=i.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(_),this._canvas.height=f*Math.ceil(o),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${o}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const o=this._markers.indexOf(_);o!==-1&&this._markers.splice(o,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const o=this._popups.indexOf(_);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const _=i.extend({},j.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);o?(i.storeAuthState(o,!0),this.painter=new Hh(o,this.transform),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.exported$1.testSupport(o)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let o;const f=this.painter.context.extTimerQuery,x=i.exported.now();if(this.listens("gpu-timing-frame")&&(o=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],i.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],i.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,G=this.transform.pitch,te=i.exported.now(),ie=new i.EvaluationParameters(V,{now:te,fadeDuration:S,pitch:G,transition:this.style.getTransition()});this.style.update(ie)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let k=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),k=this._updateAverageElevation(x),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):k=this._updateAverageElevation(x),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const V=i.exported.now()-x;f.endQueryEXT(f.TIME_ELAPSED_EXT,o),setTimeout(()=>{const G=f.getQueryObjectEXT(o,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(o),this.fire(new i.Event("gpu-timing-frame",{cpuTime:V,gpuTime:G})),i.window.performance.mark("frame-gpu",{startTime:x,detail:{gpuTime:G}})},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const G=this.painter.queryGpuTimers(V);this.fire(new i.Event("gpu-timing-layer",{layerTimes:G}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const G=this.painter.queryGpuTimeDeferredRender(V);this.fire(new i.Event("gpu-timing-deferred-render",{gpuTime:G}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||k;if(O||this._repaint)this.triggerRepaint();else{const V=!this.isMoving()&&this.loaded();if(V&&(k=this._updateAverageElevation(x,!0)),k)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new i.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new i.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,i.LivePerformanceUtils.mark(i.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&i.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const o of this._markers)_&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!_||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(_,o=!1){const f=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((o||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const x=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),k=!1;this.transform.elevation&&(k=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=_;const O=Math.abs(x-S);if(O>1){if(this._isInitialLoad||k)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,_,300)}else if(O>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(_)&&f(this._averageElevation.getValue(_))}_authenticate(){i.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===i.AUTH_ERR_MSG||_.status===401)){const o=this.painter.context.gl;i.storeAuthState(o,!1),this._logoControl instanceof en&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const f=this.painter.context.gl,x=f.createFramebuffer();function S(k){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,k,0);const O=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,O),O}return f.bindFramebuffer(f.FRAMEBUFFER,x),this._canvasPixelComparison(S(_),o.canvasCopies.map(S),o.timeStamps)}_canvasPixelComparison(_,o,f){let x=f[1]-f[0];const S=_.length/4;for(let k=0;k<o.length;k++){const O=o[k];let V=0;for(let G=0;G<O.length;G+=4)O[G]===_[G]&&O[G+1]===_[G+1]&&O[G+2]===_[G+2]&&O[G+3]===_[G+3]&&(V+=1);x+=(f[k+2]-f[k+1])*(1-V/S)}return x}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),i.window!==void 0&&(i.window.removeEventListener("resize",this._onWindowResize,!1),i.window.removeEventListener("orientationchange",this._onWindowResize,!1),i.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.removeEventListener("online",this._onWindowOnline,!1),i.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=i.exported.frame(o=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(o)}))}_preloadTiles(_){const o=this.style?Object.values(this.style._sourceCaches):[];return i.asyncAll(o,(f,x)=>f._preloadTiles(_,x),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){i.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,o){i.setCacheLimits(_,o)}get version(){return i.version}},NavigationControl:class{constructor(_){this.options=i.extend({},da,_),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:o}):f.resetNorth({},{originalEvent:o}))}),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const o=_.getZoom(),f=o===_.getMaxZoom(),x=o===_.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wa(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,o){const f=q("button",_,this._container);return f.type="button",f.addEventListener("click",o),f}_setButtonTitle(_,o){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${o}`);_.setAttribute("aria-label",f),_.firstElementChild&&_.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends i.Evented{constructor(_){super(),this.options=i.extend({geolocation:i.window.navigator.geolocation},Ua,_),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=dl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const o=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,_(f)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):i.window.navigator.permissions!==void 0?i.window.navigator.permissions.query({name:"geolocation"}).then(f=>o(f.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(_){const o=this._map.getMaxBounds(),f=_.coords;return!!o&&(f.longitude<o.getWest()||f.longitude>o.getEast()||f.latitude<o.getSouth()||f.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",_)),this._finish()}}_updateCamera(_){const o=new i.LngLat(_.coords.longitude,_.coords.latitude),f=_.coords.accuracy,x=this._map.getBearing(),S=i.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(f),S,{geolocateSource:!0})}_updateMarker(_){if(_){const o=new i.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,o=i.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,f=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{i.window.addEventListener("ondeviceorientationabsolute"in i.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};i.window.DeviceMotionEvent!==void 0&&typeof i.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),i.window.removeEventListener("deviceorientation",this._onDeviceOrientation),i.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vi,ScaleControl:class{constructor(_){this.options=i.extend({},Zs,_),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=ws.bind(this)),i.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,o=this._map,f=o._containerHeight/2,x=o._containerWidth/2-_/2,S=o.unproject([x,f]),k=o.unproject([x+_,f]),O=S.distanceTo(k);if(this.options.unit==="imperial"){const V=3.2808*O;V>5280?this._setScale(_,V/5280,"mile"):this._setScale(_,V,"foot")}else this.options.unit==="nautical"?this._setScale(_,O/1852,"nautical-mile"):O>=1e3?this._setScale(_,O/1e3,"kilometer"):this._setScale(_,O,"meter")}_setScale(_,o,f){const x=Ta(o),S=x/o;this._map._requestDomTask(()=>{this._container.style.width=_*S+"px",this._container.innerHTML=f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:f}).format(x):`${x}&nbsp;nm`})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof i.window.HTMLElement?this._container=_.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,i.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.window.document.fullscreenEnabled&&!i.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.window.document.fullscreenElement||i.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.window.document.exitFullscreen?i.window.document.exitFullscreen():i.window.document.webkitCancelFullScreen&&i.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.Evented{constructor(_){super(),this.options=i.extend(Object.create(Cr),_),i.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=i.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(i.window.document.createTextNode(_))}setHTML(_){const o=i.window.document.createDocumentFragment(),f=i.window.document.createElement("body");let x;for(f.innerHTML=_;x=f.firstChild,x;)o.appendChild(x);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(_),this.options.closeButton){const f=this._closeButton=q("button","mapboxgl-popup-close-button",o);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let o;return this._classList.delete(_)?o=!1:(this._classList.add(_),o=!0),this._updateClassList(),o}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const o=this._map,f=this._container,x=this._pos;if(!o||!f||!x)return"bottom";const S=f.offsetWidth,k=f.offsetHeight,O=x.x<S/2,V=x.x>o.transform.width-S/2;if(x.y+_<k)return O?"top-left":V?"top-right":"top";if(x.y>o.transform.height-k){if(O)return"bottom-left";if(V)return"bottom-right"}return O?"left":V?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),_.className=o.join(" ")}_update(_){const o=this._map,f=this._content;if(!o||!this._lngLat&&!this._trackPointer||!f)return;let x=this._container;if(x||(x=this._container=q("div","mapboxgl-popup",o.getContainer()),this._tip=q("div","mapboxgl-popup-tip",x),x.appendChild(f)),this.options.maxWidth&&x.style.maxWidth!==this.options.maxWidth&&(x.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$n(this._lngLat,this._pos,o.transform)),!this._trackPointer||_){const S=this._pos=this._trackPointer&&_?_:o.project(this._lngLat),k=hr(this.options.offset),O=this._anchor=this._getAnchor(k.y),V=hr(this.options.offset,O),G=S.add(V).round();o._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${dn[O]} translate(${G.x}px,${G.y}px)`)})}if(!this._marker&&o._showingGlobe()){const S=i.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(ur);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:xr,Style:Zo,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.pointGeometry,MercatorCoordinate:i.MercatorCoordinate,FreeCameraOptions:Ou,Evented:i.Evented,config:i.config,prewarm:function(){Bt().acquire(Ue)},clearPrewarmedResources:function(){const _=xt;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Ue),xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.config.ACCESS_TOKEN},set accessToken(_){i.config.ACCESS_TOKEN=_},get baseApiUrl(){return i.config.API_URL},set baseApiUrl(_){i.config.API_URL=_},get workerCount(){return it.workerCount},set workerCount(_){it.workerCount=_},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){i.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){i.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:i.exported.setNow,restoreNow:i.exported.restoreNow};return Rl});var P=b;return P})})(UC);const sL=UC.exports;var Xm=lL,aL=Object.prototype.hasOwnProperty;function lL(){for(var e={},l=0;l<arguments.length;l++){var d=arguments[l];for(var g in d)aL.call(d,g)&&(e[g]=d[g])}return e}var jC={exports:{}};(function(e,l){(function(){var d={};e.exports=d,d.simpleFilter=function(g,b){return b.filter(function(E){return d.test(g,E)})},d.test=function(g,b){return d.match(g,b)!==null},d.match=function(g,b,E){E=E||{};var P=0,i=[],F=b.length,j=0,K=0,Y=E.pre||"",q=E.post||"",re=E.caseSensitive&&b||b.toLowerCase(),me;g=E.caseSensitive&&g||g.toLowerCase();for(var we=0;we<F;we++)me=b[we],re[we]===g[P]?(me=Y+me+q,P+=1,K+=1+K):K=0,j+=K,i[i.length]=me;return P===g.length?(j=re===g?1/0:j,{rendered:i.join(""),score:j}):null},d.filter=function(g,b,E){return!b||b.length===0?[]:typeof g!="string"?b:(E=E||{},b.reduce(function(P,i,F,j){var K=i;E.extract&&(K=E.extract(i));var Y=d.match(g,K,E);return Y!=null&&(P[P.length]={string:Y.rendered,score:Y.score,index:F,original:i}),P},[]).sort(function(P,i){var F=i.score-P.score;return F||P.index-i.index}))}})()})(jC);var Hl=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};Hl.prototype.show=function(){this.element.style.display="block"};Hl.prototype.hide=function(){this.element.style.display="none"};Hl.prototype.add=function(e){this.items.push(e)};Hl.prototype.clear=function(){this.items=[],this.active=0};Hl.prototype.isEmpty=function(){return!this.items.length};Hl.prototype.isVisible=function(){return this.element.style.display==="block"};Hl.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};Hl.prototype.drawItem=function(e,l){var d=document.createElement("li"),g=document.createElement("a");l&&(d.className+=" active"),g.innerHTML=e.string,d.appendChild(g),this.element.appendChild(d),d.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),d.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};Hl.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};Hl.prototype.move=function(e){this.active=e,this.draw()};Hl.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Hl.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Hl.prototype.drawError=function(e){var l=document.createElement("li");l.innerHTML=e,this.element.appendChild(l),this.show()};var cL=Hl,uL=Xm,hL=jC.exports,dL=cL,Qa=function(e,l,d){return d=d||{},this.options=uL({minLength:2,limit:5,filter:!0,hideOnBlur:!0},d),this.el=e,this.data=l||[],this.list=new dL(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(g){this.handleKeyUp(g.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(g){this.handleKeyDown(g)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(g){this.handlePaste(g)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Qa.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Qa.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Qa.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Qa.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var l=this;setTimeout(function(){l.handleInputChange(e.target.value)},100)}};Qa.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(l){for(var d=0;d<l.length&&(this.list.add(l[d]),d!==this.options.limit-1);d++);this.list.draw()}.bind(this))};Qa.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Qa.prototype.update=function(e){this.data=e,this.handleKeyUp()};Qa.prototype.clear=function(){this.data=[],this.list.clear()};Qa.prototype.normalize=function(e){return e=e.toLowerCase(),e};Qa.prototype.match=function(e,l){return e.indexOf(l)>-1};Qa.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var l=document.createEvent("HTMLEvents");l.initEvent("change",!0,!1),this.el.dispatchEvent(l)}else this.el.fireEvent("onchange")};Qa.prototype.getCandidates=function(e){var l={pre:"<strong>",post:"</strong>",extract:function(g){return this.getItemValue(g)}.bind(this)},d;this.options.filter?(d=hL.filter(this.query,this.data,l),d=d.map(function(g){return{original:g.original,string:this.render(g.original,g.string)}}.bind(this))):d=this.data.map(function(g){var b=this.render(g);return{original:g,string:b}}.bind(this)),e(d)};Qa.prototype.getItemValue=function(e){return e};Qa.prototype.render=function(e,l){if(l)return l;for(var d=e.original?this.getItemValue(e.original):this.getItemValue(e),g=this.normalize(d),b=g.lastIndexOf(this.query);b>-1;){var E=b+this.query.length;d=d.slice(0,b)+"<strong>"+d.slice(b,E)+"</strong>"+d.slice(E),b=g.slice(0,b).lastIndexOf(this.query)}return d};Qa.prototype.renderError=function(e){this.list.drawError(e)};var fL=Qa,GC=fL,pL=GC;typeof window<"u"&&(window.Suggestions=GC);var mL="Expected a function",J2=0/0,gL="[object Symbol]",_L=/^\s+|\s+$/g,yL=/^[-+]0x[0-9a-f]+$/i,vL=/^0b[01]+$/i,xL=/^0o[0-7]+$/i,bL=parseInt,wL=typeof fu=="object"&&fu&&fu.Object===Object&&fu,TL=typeof self=="object"&&self&&self.Object===Object&&self,EL=wL||TL||Function("return this")(),SL=Object.prototype,CL=SL.toString,IL=Math.max,AL=Math.min,ux=function(){return EL.Date.now()};function ML(e,l,d){var g,b,E,P,i,F,j=0,K=!1,Y=!1,q=!0;if(typeof e!="function")throw new TypeError(mL);l=Q2(l)||0,e1(d)&&(K=!!d.leading,Y="maxWait"in d,E=Y?IL(Q2(d.maxWait)||0,l):E,q="trailing"in d?!!d.trailing:q);function re(Ye){var Ze=g,rt=b;return g=b=void 0,j=Ye,P=e.apply(rt,Ze),P}function me(Ye){return j=Ye,i=setTimeout($e,l),K?re(Ye):P}function we(Ye){var Ze=Ye-F,rt=Ye-j,gt=l-Ze;return Y?AL(gt,E-rt):gt}function je(Ye){var Ze=Ye-F,rt=Ye-j;return F===void 0||Ze>=l||Ze<0||Y&&rt>=E}function $e(){var Ye=ux();if(je(Ye))return tt(Ye);i=setTimeout($e,we(Ye))}function tt(Ye){return i=void 0,q&&g?re(Ye):(g=b=void 0,P)}function Ae(){i!==void 0&&clearTimeout(i),j=0,g=F=b=i=void 0}function mt(){return i===void 0?P:tt(ux())}function Me(){var Ye=ux(),Ze=je(Ye);if(g=arguments,b=this,F=Ye,Ze){if(i===void 0)return me(F);if(Y)return i=setTimeout($e,l),re(F)}return i===void 0&&(i=setTimeout($e,l)),P}return Me.cancel=Ae,Me.flush=mt,Me}function e1(e){var l=typeof e;return!!e&&(l=="object"||l=="function")}function kL(e){return!!e&&typeof e=="object"}function PL(e){return typeof e=="symbol"||kL(e)&&CL.call(e)==gL}function Q2(e){if(typeof e=="number")return e;if(PL(e))return J2;if(e1(e)){var l=typeof e.valueOf=="function"?e.valueOf():e;e=e1(l)?l+"":l}if(typeof e!="string")return e===0?e:+e;e=e.replace(_L,"");var d=vL.test(e);return d||xL.test(e)?bL(e.slice(2),d?2:8):yL.test(e)?J2:+e}var zL=ML,hb={exports:{}},km=typeof Reflect=="object"?Reflect:null,eT=km&&typeof km.apply=="function"?km.apply:function(l,d,g){return Function.prototype.apply.call(l,d,g)},Hy;km&&typeof km.ownKeys=="function"?Hy=km.ownKeys:Object.getOwnPropertySymbols?Hy=function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:Hy=function(l){return Object.getOwnPropertyNames(l)};function DL(e){console&&console.warn&&console.warn(e)}var qC=Number.isNaN||function(l){return l!==l};function ko(){ko.init.call(this)}hb.exports=ko;hb.exports.once=OL;ko.EventEmitter=ko;ko.prototype._events=void 0;ko.prototype._eventsCount=0;ko.prototype._maxListeners=void 0;var tT=10;function qv(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ko,"defaultMaxListeners",{enumerable:!0,get:function(){return tT},set:function(e){if(typeof e!="number"||e<0||qC(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");tT=e}});ko.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ko.prototype.setMaxListeners=function(l){if(typeof l!="number"||l<0||qC(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this};function ZC(e){return e._maxListeners===void 0?ko.defaultMaxListeners:e._maxListeners}ko.prototype.getMaxListeners=function(){return ZC(this)};ko.prototype.emit=function(l){for(var d=[],g=1;g<arguments.length;g++)d.push(arguments[g]);var b=l==="error",E=this._events;if(E!==void 0)b=b&&E.error===void 0;else if(!b)return!1;if(b){var P;if(d.length>0&&(P=d[0]),P instanceof Error)throw P;var i=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw i.context=P,i}var F=E[l];if(F===void 0)return!1;if(typeof F=="function")eT(F,this,d);else for(var j=F.length,K=YC(F,j),g=0;g<j;++g)eT(K[g],this,d);return!0};function WC(e,l,d,g){var b,E,P;if(qv(d),E=e._events,E===void 0?(E=e._events=Object.create(null),e._eventsCount=0):(E.newListener!==void 0&&(e.emit("newListener",l,d.listener?d.listener:d),E=e._events),P=E[l]),P===void 0)P=E[l]=d,++e._eventsCount;else if(typeof P=="function"?P=E[l]=g?[d,P]:[P,d]:g?P.unshift(d):P.push(d),b=ZC(e),b>0&&P.length>b&&!P.warned){P.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.emitter=e,i.type=l,i.count=P.length,DL(i)}return e}ko.prototype.addListener=function(l,d){return WC(this,l,d,!1)};ko.prototype.on=ko.prototype.addListener;ko.prototype.prependListener=function(l,d){return WC(this,l,d,!0)};function LL(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function XC(e,l,d){var g={fired:!1,wrapFn:void 0,target:e,type:l,listener:d},b=LL.bind(g);return b.listener=d,g.wrapFn=b,b}ko.prototype.once=function(l,d){return qv(d),this.on(l,XC(this,l,d)),this};ko.prototype.prependOnceListener=function(l,d){return qv(d),this.prependListener(l,XC(this,l,d)),this};ko.prototype.removeListener=function(l,d){var g,b,E,P,i;if(qv(d),b=this._events,b===void 0)return this;if(g=b[l],g===void 0)return this;if(g===d||g.listener===d)--this._eventsCount===0?this._events=Object.create(null):(delete b[l],b.removeListener&&this.emit("removeListener",l,g.listener||d));else if(typeof g!="function"){for(E=-1,P=g.length-1;P>=0;P--)if(g[P]===d||g[P].listener===d){i=g[P].listener,E=P;break}if(E<0)return this;E===0?g.shift():BL(g,E),g.length===1&&(b[l]=g[0]),b.removeListener!==void 0&&this.emit("removeListener",l,i||d)}return this};ko.prototype.off=ko.prototype.removeListener;ko.prototype.removeAllListeners=function(l){var d,g,b;if(g=this._events,g===void 0)return this;if(g.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):g[l]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete g[l]),this;if(arguments.length===0){var E=Object.keys(g),P;for(b=0;b<E.length;++b)P=E[b],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(d=g[l],typeof d=="function")this.removeListener(l,d);else if(d!==void 0)for(b=d.length-1;b>=0;b--)this.removeListener(l,d[b]);return this};function HC(e,l,d){var g=e._events;if(g===void 0)return[];var b=g[l];return b===void 0?[]:typeof b=="function"?d?[b.listener||b]:[b]:d?RL(b):YC(b,b.length)}ko.prototype.listeners=function(l){return HC(this,l,!0)};ko.prototype.rawListeners=function(l){return HC(this,l,!1)};ko.listenerCount=function(e,l){return typeof e.listenerCount=="function"?e.listenerCount(l):KC.call(e,l)};ko.prototype.listenerCount=KC;function KC(e){var l=this._events;if(l!==void 0){var d=l[e];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}ko.prototype.eventNames=function(){return this._eventsCount>0?Hy(this._events):[]};function YC(e,l){for(var d=new Array(l),g=0;g<l;++g)d[g]=e[g];return d}function BL(e,l){for(;l+1<e.length;l++)e[l]=e[l+1];e.pop()}function RL(e){for(var l=new Array(e.length),d=0;d<l.length;++d)l[d]=e[d].listener||e[d];return l}function OL(e,l){return new Promise(function(d,g){function b(P){e.removeListener(l,E),g(P)}function E(){typeof e.removeListener=="function"&&e.removeListener("error",b),d([].slice.call(arguments))}JC(e,l,E,{once:!0}),l!=="error"&&FL(e,b,{once:!0})})}function FL(e,l,d){typeof e.on=="function"&&JC(e,"error",l,d)}function JC(e,l,d,g){if(typeof e.on=="function")g.once?e.once(l,d):e.on(l,d);else if(typeof e.addEventListener=="function")e.addEventListener(l,function b(E){g.once&&e.removeEventListener(l,b),d(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var VL={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function NL(e){var l=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return l?{key:l[1],value:l[2]}:null}function UL(e){var l=e.match(/<?([^>]*)>(.*)/);if(!l)return null;var d=l[1],g=l[2].split(";"),b=null,E=g.reduce(function(P,i){var F=NL(i);return F?F.key==="rel"?(b||(b=F.value),P):(P[F.key]=F.value,P):P},{});return b?{url:d,rel:b,params:E}:null}function $L(e){return e?e.split(/,\s*</).reduce(function(l,d){var g=UL(d);if(!g)return l;var b=g.rel.split(/\s+/);return b.forEach(function(E){l[E]||(l[E]={url:g.url,params:g.params})}),l},{}):{}}var jL=$L,GL=jL;function db(e,l){this.request=e,this.headers=l.headers,this.rawBody=l.body,this.statusCode=l.statusCode;try{this.body=JSON.parse(l.body||"{}")}catch{this.body=l.body}this.links=GL(this.headers.link)}db.prototype.hasNextPage=function(){return!!this.links.next};db.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var qL=db,Zv={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},iT=Zv;function ZL(e){var l=e.type||iT.ERROR_HTTP,d;if(e.body)try{d=JSON.parse(e.body)}catch{d=e.body}else d=null;var g=e.message||null;g||(typeof d=="string"?g=d:d&&typeof d.message=="string"?g=d.message:l===iT.ERROR_REQUEST_ABORTED&&(g="Request aborted")),this.message=g,this.type=l,this.statusCode=e.statusCode||null,this.request=e.request,this.body=d}var WL=ZL;function XL(e){var l=e.indexOf(":"),d=e.substring(0,l).trim().toLowerCase(),g=e.substring(l+1).trim();return{name:d,value:g}}function HL(e){var l={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(d){var g=XL(d);l[g.name]=g.value}),l}var KL=HL,YL=qL,nT=WL,hx=Zv,JL=KL,gv={};function QL(e){var l=gv[e.id];!l||(l.abort(),delete gv[e.id])}function e5(e,l){return new YL(e,{body:l.response,headers:JL(l.getAllResponseHeaders()),statusCode:l.status})}function rT(e){var l=e.total,d=e.loaded,g=100*d/l;return{total:l,transferred:d,percent:g}}function QC(e,l){return new Promise(function(d,g){l.onprogress=function(P){e.emitter.emit(hx.EVENT_PROGRESS_DOWNLOAD,rT(P))};var b=e.file;b&&(l.upload.onprogress=function(P){e.emitter.emit(hx.EVENT_PROGRESS_UPLOAD,rT(P))}),l.onerror=function(P){g(P)},l.onabort=function(){var P=new nT({request:e,type:hx.ERROR_REQUEST_ABORTED});g(P)},l.onload=function(){if(delete gv[e.id],l.status<200||l.status>=400){var P=new nT({request:e,body:l.response,statusCode:l.status});g(P);return}d(l)};var E=e.body;typeof E=="string"?l.send(E):E?l.send(JSON.stringify(E)):b?l.send(b):l.send(),gv[e.id]=l}).then(function(d){return e5(e,d)})}function eI(e,l){var d=e.url(l),g=new window.XMLHttpRequest;return g.open(e.method,d),Object.keys(e.headers).forEach(function(b){g.setRequestHeader(b,e.headers[b])}),g}function t5(e){return Promise.resolve().then(function(){var l=eI(e,e.client.accessToken);return QC(e,l)})}var i5={browserAbort:QL,sendRequestXhr:QC,browserSend:t5,createRequestXhr:eI},t1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(e,l){(function(d){var g=l,b=e&&e.exports==g&&e,E=typeof fu=="object"&&fu;(E.global===E||E.window===E)&&(d=E);var P=function(me){this.message=me};P.prototype=new Error,P.prototype.name="InvalidCharacterError";var i=function(me){throw new P(me)},F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",j=/[\t\n\f\r ]/g,K=function(me){me=String(me).replace(j,"");var we=me.length;we%4==0&&(me=me.replace(/==?$/,""),we=me.length),(we%4==1||/[^+a-zA-Z0-9/]/.test(me))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var je=0,$e,tt,Ae="",mt=-1;++mt<we;)tt=F.indexOf(me.charAt(mt)),$e=je%4?$e*64+tt:tt,je++%4&&(Ae+=String.fromCharCode(255&$e>>(-2*je&6)));return Ae},Y=function(me){me=String(me),/[^\0-\xFF]/.test(me)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var we=me.length%3,je="",$e=-1,tt,Ae,mt,Me,Ye=me.length-we;++$e<Ye;)tt=me.charCodeAt($e)<<16,Ae=me.charCodeAt(++$e)<<8,mt=me.charCodeAt(++$e),Me=tt+Ae+mt,je+=F.charAt(Me>>18&63)+F.charAt(Me>>12&63)+F.charAt(Me>>6&63)+F.charAt(Me&63);return we==2?(tt=me.charCodeAt($e)<<8,Ae=me.charCodeAt(++$e),Me=tt+Ae,je+=F.charAt(Me>>10)+F.charAt(Me>>4&63)+F.charAt(Me<<2&63)+"="):we==1&&(Me=me.charCodeAt($e),je+=F.charAt(Me>>2)+F.charAt(Me<<4&63)+"=="),je},q={encode:Y,decode:K,version:"0.1.0"};if(g&&!g.nodeType)if(b)b.exports=q;else for(var re in q)q.hasOwnProperty(re)&&(g[re]=q[re]);else d.base64=q})(fu)})(t1,t1.exports);var n5=t1.exports,dx={};function r5(e){if(dx[e])return dx[e];var l=e.split("."),d=l[0],g=l[1];if(!g)throw new Error("Invalid token");var b=o5(g),E={usage:d,user:b.u};return dp(b,"a")&&(E.authorization=b.a),dp(b,"exp")&&(E.expires=b.exp*1e3),dp(b,"iat")&&(E.created=b.iat*1e3),dp(b,"scopes")&&(E.scopes=b.scopes),dp(b,"client")&&(E.client=b.client),dp(b,"ll")&&(E.lastLogin=b.ll),dp(b,"iu")&&(E.impersonator=b.iu),dx[e]=E,E}function o5(e){try{return JSON.parse(n5.decode(e))}catch{throw new Error("Invalid token")}}function dp(e,l){return Object.prototype.hasOwnProperty.call(e,l)}var tI=r5,iI={exports:{}};(function(e){var l=Object.prototype.hasOwnProperty,d="~";function g(){}Object.create&&(g.prototype=Object.create(null),new g().__proto__||(d=!1));function b(F,j,K){this.fn=F,this.context=j,this.once=K||!1}function E(F,j,K,Y,q){if(typeof K!="function")throw new TypeError("The listener must be a function");var re=new b(K,Y||F,q),me=d?d+j:j;return F._events[me]?F._events[me].fn?F._events[me]=[F._events[me],re]:F._events[me].push(re):(F._events[me]=re,F._eventsCount++),F}function P(F,j){--F._eventsCount===0?F._events=new g:delete F._events[j]}function i(){this._events=new g,this._eventsCount=0}i.prototype.eventNames=function(){var j=[],K,Y;if(this._eventsCount===0)return j;for(Y in K=this._events)l.call(K,Y)&&j.push(d?Y.slice(1):Y);return Object.getOwnPropertySymbols?j.concat(Object.getOwnPropertySymbols(K)):j},i.prototype.listeners=function(j){var K=d?d+j:j,Y=this._events[K];if(!Y)return[];if(Y.fn)return[Y.fn];for(var q=0,re=Y.length,me=new Array(re);q<re;q++)me[q]=Y[q].fn;return me},i.prototype.listenerCount=function(j){var K=d?d+j:j,Y=this._events[K];return Y?Y.fn?1:Y.length:0},i.prototype.emit=function(j,K,Y,q,re,me){var we=d?d+j:j;if(!this._events[we])return!1;var je=this._events[we],$e=arguments.length,tt,Ae;if(je.fn){switch(je.once&&this.removeListener(j,je.fn,void 0,!0),$e){case 1:return je.fn.call(je.context),!0;case 2:return je.fn.call(je.context,K),!0;case 3:return je.fn.call(je.context,K,Y),!0;case 4:return je.fn.call(je.context,K,Y,q),!0;case 5:return je.fn.call(je.context,K,Y,q,re),!0;case 6:return je.fn.call(je.context,K,Y,q,re,me),!0}for(Ae=1,tt=new Array($e-1);Ae<$e;Ae++)tt[Ae-1]=arguments[Ae];je.fn.apply(je.context,tt)}else{var mt=je.length,Me;for(Ae=0;Ae<mt;Ae++)switch(je[Ae].once&&this.removeListener(j,je[Ae].fn,void 0,!0),$e){case 1:je[Ae].fn.call(je[Ae].context);break;case 2:je[Ae].fn.call(je[Ae].context,K);break;case 3:je[Ae].fn.call(je[Ae].context,K,Y);break;case 4:je[Ae].fn.call(je[Ae].context,K,Y,q);break;default:if(!tt)for(Me=1,tt=new Array($e-1);Me<$e;Me++)tt[Me-1]=arguments[Me];je[Ae].fn.apply(je[Ae].context,tt)}}return!0},i.prototype.on=function(j,K,Y){return E(this,j,K,Y,!1)},i.prototype.once=function(j,K,Y){return E(this,j,K,Y,!0)},i.prototype.removeListener=function(j,K,Y,q){var re=d?d+j:j;if(!this._events[re])return this;if(!K)return P(this,re),this;var me=this._events[re];if(me.fn)me.fn===K&&(!q||me.once)&&(!Y||me.context===Y)&&P(this,re);else{for(var we=0,je=[],$e=me.length;we<$e;we++)(me[we].fn!==K||q&&!me[we].once||Y&&me[we].context!==Y)&&je.push(me[we]);je.length?this._events[re]=je.length===1?je[0]:je:P(this,re)}return this},i.prototype.removeAllListeners=function(j){var K;return j?(K=d?d+j:j,this._events[K]&&P(this,K)):(this._events=new g,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=d,i.EventEmitter=i,e.exports=i})(iI);function s5(e){return e.map(encodeURIComponent).join(",")}function nI(e){return Array.isArray(e)?s5(e):encodeURIComponent(String(e))}function rI(e,l,d){if(d===!1||d===null)return e;var g=/\?/.test(e)?"&":"?",b=encodeURIComponent(l);return d!==void 0&&d!==""&&d!==!0&&(b+="="+nI(d)),""+e+g+b}function a5(e,l){if(!l)return e;var d=e;return Object.keys(l).forEach(function(g){var b=l[g];b!==void 0&&(Array.isArray(b)&&(b=b.filter(function(E){return E!=null}).join(",")),d=rI(d,g,b))}),d}function l5(e,l){if(!l||e.slice(0,4)==="http")return e;var d=e[0]==="/"?"":"/";return""+l.replace(/\/$/,"")+d+e}function c5(e,l){return l?e.replace(/\/:([a-zA-Z0-9]+)/g,function(d,g){var b=l[g];if(b===void 0)throw new Error("Unspecified route parameter "+g);var E=nI(b);return"/"+E}):e}var u5={appendQueryObject:a5,appendQueryParam:rI,prependOrigin:l5,interpolateRouteParams:c5},h5=tI,fb=Xm,d5=iI.exports,Uy=u5,oT=Zv,f5=1;function kf(e,l){if(!e)throw new Error("MapiRequest requires a client");if(!l||!l.path||!l.method)throw new Error("MapiRequest requires an options object with path and method properties");var d={};l.body&&(d["content-type"]="application/json");var g=fb(d,l.headers),b=Object.keys(g).reduce(function(E,P){return E[P.toLowerCase()]=g[P],E},{});this.id=f5++,this._options=l,this.emitter=new d5,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=l.path,this.method=l.method,this.origin=l.origin||e.origin,this.query=l.query||{},this.params=l.params||{},this.body=l.body||null,this.file=l.file||null,this.encoding=l.encoding||"utf8",this.sendFileAs=l.sendFileAs||null,this.headers=b}kf.prototype.url=function(l){var d=Uy.prependOrigin(this.path,this.origin);d=Uy.appendQueryObject(d,this.query);var g=this.params,b=l==null?this.client.accessToken:l;if(b){d=Uy.appendQueryParam(d,"access_token",b);var E=h5(b).user;g=fb({ownerId:E},g)}return d=Uy.interpolateRouteParams(d,g),d};kf.prototype.send=function(){var l=this;if(l.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return l.sent=!0,l.client.sendRequest(l).then(function(d){return l.response=d,l.emitter.emit(oT.EVENT_RESPONSE,d),d},function(d){throw l.error=d,l.emitter.emit(oT.EVENT_ERROR,d),d})};kf.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};kf.prototype.eachPage=function(l){var d=this;function g(P){function i(){delete d._nextPageRequest;var F=P.nextPage();F&&(d._nextPageRequest=F,E(F))}l(null,P,i)}function b(P){l(P,null,function(){})}function E(P){P.send().then(g,b)}E(this)};kf.prototype.clone=function(){return this._extend()};kf.prototype._extend=function(l){var d=fb(this._options,l);return new kf(this.client,d)};var p5=kf,m5=tI,g5=p5,_5=Zv;function oI(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");m5(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||_5.API_ORIGIN}oI.prototype.createRequest=function(l){return new g5(this,l)};var sI=oI,aI=i5,lI=sI;function Bm(e){lI.call(this,e)}Bm.prototype=Object.create(lI.prototype);Bm.prototype.constructor=Bm;Bm.prototype.sendRequest=aI.browserSend;Bm.prototype.abortRequest=aI.browserAbort;function y5(e){return new Bm(e)}var cI=y5,v5=cI,x5=v5,b5=Object.prototype.toString,w5=function(e){var l;return b5.call(e)==="[object Object]"&&(l=Object.getPrototypeOf(e),l===null||l===Object.getPrototypeOf({}))},T5=w5,E5=Xm,uI="value",fx=`
  `,qo={};qo.assert=function(e,l){return l=l||{},function(d){var g=Pf(e,d);if(!!g){var b=pb(g,l);throw l.apiName&&(b=l.apiName+": "+b),new Error(b)}}};qo.shape=function(l){var d=A5(l);return function(b){var E=Pf(qo.plainObject,b);if(E)return E;for(var P,i,F=[],j=0;j<d.length;j++)P=d[j].key,i=d[j].value,E=Pf(i,b[P]),E&&F.push([P].concat(E));return F.length<2?F[0]:function(K){F=F.map(function(re){var me=re[0],we=pb(re,K).split(`
`).join(fx);return"- "+me+": "+we});var Y=K.path.join("."),q=Y===uI?"":" of "+Y;return"The following properties"+q+" have invalid values:"+fx+F.join(fx)}}};qo.strictShape=function(l){var d=qo.shape(l);return function(b){var E=d(b);if(E)return E;var P=Object.keys(b).reduce(function(i,F){return l[F]===void 0&&i.push(F),i},[]);if(P.length!==0)return function(){return"The following keys are invalid: "+P.join(", ")}}};qo.arrayOf=function(l){return hI(l)};qo.tuple=function(){var l=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return hI(l)};function hI(e){var l=Array.isArray(e),d=function(g){return l?e[g]:e};return function(b){var E=Pf(qo.plainArray,b);if(E)return E;if(l&&b.length!==e.length)return"an array with "+e.length+" items";for(var P=0;P<b.length;P++)if(E=Pf(d(P),b[P]),E)return[P].concat(E)}}qo.required=function(l){function d(g){return g==null?function(b){return dI(b,fI(b.path)?"cannot be undefined/null.":"is required.")}:l.apply(this,arguments)}return d.__required=!0,d};qo.oneOfType=function(){var l=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(g){var b=l.map(function(E){return Pf(E,g)}).filter(Boolean);if(b.length===l.length)return b.every(function(E){return E.length===1&&typeof E[0]=="string"})?S5(b.map(function(E){return E[0]})):b.reduce(function(E,P){return P.length>E.length?P:E})}};qo.equal=function(l){return function(g){if(g!==l)return JSON.stringify(l)}};qo.oneOf=function(){var l=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),d=l.map(function(g){return qo.equal(g)});return qo.oneOfType.apply(this,d)};qo.range=function(l){var d=l[0],g=l[1];return function(E){var P=Pf(qo.number,E);if(P||E<d||E>g)return"number between "+d+" & "+g+" (inclusive)"}};qo.any=function(){};qo.boolean=function(l){if(typeof l!="boolean")return"boolean"};qo.number=function(l){if(typeof l!="number")return"number"};qo.plainArray=function(l){if(!Array.isArray(l))return"array"};qo.plainObject=function(l){if(!T5(l))return"object"};qo.string=function(l){if(typeof l!="string")return"string"};qo.func=function(l){if(typeof l!="function")return"function"};function Pf(e,l){if(!(l==null&&!e.hasOwnProperty("__required"))){var d=e(l);if(d)return Array.isArray(d)?d:[d]}}function pb(e,l){var d=e.length,g=e[d-1],b=e.slice(0,d-1);return b.length===0&&(b=[uI]),l=E5(l,{path:b}),typeof g=="function"?g(l):dI(l,C5(g))}function S5(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function C5(e){return"must be "+I5(e)+"."}function I5(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function dI(e,l){var d=fI(e.path),g=e.path.join(".")+" "+l,b=d?"Item at position ":"";return b+g}function fI(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function A5(e){return Object.keys(e||{}).map(function(l){return{key:l,value:e[l]}})}qo.validate=Pf;qo.processMessage=pb;var M5=qo,k5=Xm,Pm=M5;function P5(e){if(typeof window<"u")return e instanceof fu.Blob||e instanceof fu.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function z5(e,l){return Pm.assert(Pm.strictShape(e),l)}function D5(e){var l="date";if(typeof e=="boolean")return l;try{var d=new Date(e);if(d.getTime&&isNaN(d.getTime()))return l}catch{return l}}function L5(e){return Pm.tuple(Pm.number,Pm.number)(e)}var B5=k5(Pm,{file:P5,date:D5,coordinates:L5,assertShape:z5});function R5(e,l){var d=function(g,b){return l.indexOf(g)!==-1&&b!==void 0};return typeof l=="function"&&(d=l),Object.keys(e).filter(function(g){return d(g,e[g])}).reduce(function(g,b){return g[b]=e[b],g},{})}var O5=R5;function F5(e,l){return Object.keys(e).reduce(function(d,g){return d[g]=l(g,e[g]),d},{})}var V5=F5,N5=V5;function U5(e){return N5(e,function(l,d){return typeof d=="boolean"?JSON.stringify(d):d})}var $5=U5,j5=sI,G5=cI;function q5(e){return function(l){var d;j5.prototype.isPrototypeOf(l)?d=l:d=G5(l);var g=Object.create(e);return g.client=d,g}}var Z5=q5,pI=Xm,Fr=B5,_v=O5,mI=$5,W5=Z5,mb={},gI=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];mb.forwardGeocode=function(e){Fr.assertShape({query:Fr.required(Fr.string),mode:Fr.oneOf("mapbox.places","mapbox.places-permanent"),countries:Fr.arrayOf(Fr.string),proximity:Fr.oneOf(Fr.coordinates,"ip"),types:Fr.arrayOf(Fr.oneOf(gI)),autocomplete:Fr.boolean,bbox:Fr.arrayOf(Fr.number),limit:Fr.number,language:Fr.arrayOf(Fr.string),routing:Fr.boolean,fuzzyMatch:Fr.boolean,worldview:Fr.string})(e),e.mode=e.mode||"mapbox.places";var l=mI(pI({country:e.countries},_v(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:_v(e,["mode","query"]),query:l})};mb.reverseGeocode=function(e){Fr.assertShape({query:Fr.required(Fr.coordinates),mode:Fr.oneOf("mapbox.places","mapbox.places-permanent"),countries:Fr.arrayOf(Fr.string),types:Fr.arrayOf(Fr.oneOf(gI)),bbox:Fr.arrayOf(Fr.number),limit:Fr.number,language:Fr.arrayOf(Fr.string),reverseMode:Fr.oneOf("distance","score"),routing:Fr.boolean,worldview:Fr.string})(e),e.mode=e.mode||"mapbox.places";var l=mI(pI({country:e.countries},_v(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:_v(e,["mode","query"]),query:l})};var X5=W5(mb);let H5="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",_I=e=>crypto.getRandomValues(new Uint8Array(e)),yI=(e,l,d)=>{let g=(2<<Math.log(e.length-1)/Math.LN2)-1,b=-~(1.6*g*l/e.length);return(E=l)=>{let P="";for(;;){let i=d(b),F=b;for(;F--;)if(P+=e[i[F]&g]||"",P.length===E)return P}}},K5=(e,l=21)=>yI(e,l,_I),Y5=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((l,d)=>(d&=63,d<36?l+=d.toString(36):d<62?l+=(d-26).toString(36).toUpperCase():d>62?l+="-":l+="_",l),"");const J5=Object.freeze(Object.defineProperty({__proto__:null,nanoid:Y5,customAlphabet:K5,customRandom:yI,urlAlphabet:H5,random:_I},Symbol.toStringTag,{value:"Module"})),Q5=oL(J5);var eB=Q5.nanoid;function vI(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}vI.prototype={select:function(e,l){var d=this.getSelectedIndex(e,l),g=this.getEventPayload("search.select",l);if(g.resultIndex=d,g.resultPlaceName=e.place_name,g.resultId=e.id,!(d===this.lastSentIndex&&g.queryString===this.lastSentInput||d==-1)&&(this.lastSentIndex=d,this.lastSentInput=g.queryString,!!g.queryString))return this.push(g)},start:function(e){var l=this.getEventPayload("search.start",e);if(!!l.queryString)return this.push(l)},keyevent:function(e,l){if(!!e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var d=this.getEventPayload("search.keystroke",l);if(d.lastAction=e.key,!!d.queryString)return this.push(d)}},send:function(e,l){if(!this.enableEventLogging)return l?l():void 0;var d=this.getRequestOptions(e);this.request(d,function(g){if(g)return this.handleError(g,l);if(l)return l()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var l={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return l},getEventPayload:function(e,l){var d;l.options.proximity?typeof l.options.proximity=="object"?d=[l.options.proximity.longitude,l.options.proximity.latitude]:l.options.proximity==="ip"?d=[999,999]:d=l.options.proximity:d=null;var g=l._map?l._map.getZoom():void 0,b={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:l.options.autocomplete,fuzzyMatch:l.options.fuzzyMatch,proximity:d,limit:l.options.limit,routing:l.options.routing,worldview:l.options.worldview,mapZoom:g,keyboardLocale:this.locale};return e==="search.select"?b.queryString=l.inputString:e!="search.select"&&l._inputEl?b.queryString=l._inputEl.value:b.queryString=l.inputString,b},request:function(e,l){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(this.readyState==4)return this.status==204?l(null):l(this.statusText)},d.open(e.method,e.host+"/"+e.path,!0);for(var g in e.headers){var b=e.headers[g];d.setRequestHeader(g,b)}d.send(e.body)},handleError:function(e,l){if(l)return l(e)},generateSessionID:function(){return eB()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,l){if(!!l._typeahead){var d=l._typeahead.data,g=e.id,b=d.map(function(P){return P.id}),E=b.indexOf(g);return E}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,l){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||l)&&this.flush()},remove:function(){this.flush()}};var tB=vI,iB={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},nB={placeholder:iB},xI={exports:{}};(function(e){(function(l,d,g){e.exports?e.exports=g():l[d]=g()})(fu,"subtag",function(){var l="",d=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function g(F){return F.match(d)||[]}function b(F){return g(F).filter(function(j,K){return j&&K})}function E(F){return F=g(F),{language:F[1]||l,extlang:F[2]||l,script:F[3]||l,region:F[4]||l}}function P(F,j,K){Object.defineProperty(F,j,{value:K,enumerable:!0})}function i(F,j,K){function Y(q){return g(q)[F]||l}P(Y,"pattern",j),P(E,K,Y)}return i(1,/^[a-zA-Z]{2,3}$/,"language"),i(2,/^[a-zA-Z]{3}$/,"extlang"),i(3,/^[a-zA-Z]{4}$/,"script"),i(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),P(E,"split",b),E})})(xI);function bI(){}bI.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(l,d){window.navigator.geolocation.getCurrentPosition(l,d,e)})}};var rB=bI;function oB(e,l){const d=wI(e),g=["address","street","place","country"];var b;if(typeof l=="function")return l(d);const E=g.indexOf(l);return E===-1?b=g:b=g.slice(E),b.reduce(function(P,i){return d[i]?(P!==""&&(P=P+", "),P+d[i]):P},"")}function wI(e){const l=e.address||"",d=e.text||"",g=e.place_name||"",E={address:g.split(",")[0],houseNumber:l,street:d,placeName:g};return e.context.forEach(function(P){const i=P.id.split(".")[0];E[i]=P.text}),E}const sB=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var aB={transformFeatureToGeolocationText:oB,getAddressInfo:wI,REVERSE_GEOCODE_COORD_RGX:sB},lB=pL,cB=zL,pp=Xm,uB=hb.exports.EventEmitter,sT=VL,px=x5,mx=X5,hB=tB,dB=nB,fB=xI.exports,pB=rB,aT=aB;const wf={FORWARD:0,LOCAL:1,REVERSE:2};function mB(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function TI(e){this._eventEmitter=new uB,this.options=pp({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new pB}TI.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var l=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+l[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+l.splice(1,l.length).join(",")+"</div></div>"}},addTo:function(e){function l(d,g){if(!document.body.contains(g))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const b=d.onAdd();g.appendChild(b)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)l(this,e);else if(typeof e=="string"){const d=document.querySelectorAll(e);if(d.length===0)throw new Error("Element ",e,"not found.");if(d.length>1)throw new Error("Geocoder can only be added to a single html element");l(this,d[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mx(px({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new hB(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var l=this.container=document.createElement("div");l.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var d=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",cB(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(j){this.eventManager.keyevent(j,this)}.bind(this));var g=document.createElement("div");g.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var b=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(b),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),g.appendChild(this._clearEl),g.appendChild(this._loadingEl),l.appendChild(d),l.appendChild(this._inputEl),l.appendChild(g),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var E=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(E),g.appendChild(this._geolocateEl),this._showGeolocateButton()}var P=this._typeahead=new lB(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),P.getItemValue=this.options.getItemValue;var i=P.list.draw,F=this._footerNode=mB();return P.list.draw=function(){i.call(this),F.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),F.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(F)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),l},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const l={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(l),this._fly(l),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(l),this._showClearButton(),this.fresh=!1;const d={limit:1,language:[this.options.language],query:l.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const g=l.geometry.coordinates[0]+","+l.geometry.coordinates[1];this._setInputValue(g),this._eventEmitter.emit("result",{result:l})}else this.geocoderService.reverseGeocode(d).send().then(function(g){const b=g.body.features[0];if(b){const E=aT.transformFeatureToGeolocationText(b,this.options.addressAccuracy);this._setInputValue(E),b.user_coordinates=l.geometry.coordinates,this._eventEmitter.emit("result",{result:b})}else this._eventEmitter.emit("result",{result:{user_coordinates:l.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,l){var d=document.createElementNS("http://www.w3.org/2000/svg","svg");return d.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),d.setAttribute("viewBox","0 0 18 18"),d.setAttribute("xml:space","preserve"),d.setAttribute("width",18),d.setAttribute("height",18),d.innerHTML=l,d},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var l=(e.clipboardData||window.clipboardData).getData("text");l.length>=this.options.minLength&&this._geocode(l)},_onKeyDown:function(e){var l=27,d=9;if(e.keyCode===l&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var g=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,b=g?g.value:"";if(!b)return this.fresh=!0,e.keyCode!==d&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[d,l,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&g.value.length>=this.options.minLength&&this._geocode(g.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var l;if(e.properties&&sT[e.properties.short_code])l=pp({},this.options.flyTo),this._map&&this._map.fitBounds(sT[e.properties.short_code].bbox,l);else if(e.bbox){var d=e.bbox;l=pp({},this.options.flyTo),this._map&&this._map.fitBounds([[d[0],d[1]],[d[2],d[3]]],l)}else{var g={zoom:this.options.zoom};l=pp({},g,this.options.flyTo),e.center?l.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(l.center=e.geometry.coordinates),this._map&&this._map.flyTo(l)}},_requestType:function(e,l){var d;return e.localGeocoderOnly?d=wf.LOCAL:e.reverseGeocode&&aT.REVERSE_GEOCODE_COORD_RGX.test(l)?d=wf.REVERSE:d=wf.FORWARD,d},_setupConfig:function(e,l){const d=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],g=/[\s,]+/;var b=this,E=d.reduce(function(i,F){if(b.options[F]===void 0||b.options[F]===null)return i;["countries","types","language"].indexOf(F)>-1?i[F]=b.options[F].split(g):i[F]=b.options[F];const j=typeof b.options[F].longitude=="number"&&typeof b.options[F].latitude=="number";if(F==="proximity"&&j){const K=b.options[F].longitude,Y=b.options[F].latitude;i[F]=[K,Y]}return i},{});switch(e){case wf.REVERSE:{var P=l.split(g).map(function(i){return parseFloat(i,10)});b.options.flipCoordinates||P.reverse(),E.types&&E.types[0],E=pp(E,{query:P,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(i){i in E&&delete E[i]})}break;case wf.FORWARD:{const i=l.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(i)&&(l=l.replace(/,/g," ")),E=pp(E,{query:l})}break}return E},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const l=this._requestType(this.options,e),d=this._setupConfig(l,e);var g;switch(l){case wf.LOCAL:g=Promise.resolve();break;case wf.FORWARD:g=this.geocoderService.forwardGeocode(d).send();break;case wf.REVERSE:g=this.geocoderService.reverseGeocode(d).send();break}var b=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],E=[],P=null;return g.catch(function(i){P=i}.bind(this)).then(function(i){this._hideLoadingIcon();var F={};return i?i.statusCode=="200"&&(F=i.body,F.request=i.request,F.headers=i.headers):F={type:"FeatureCollection",features:[]},F.config=d,this.fresh&&(this.eventManager.start(this),this.fresh=!1),F.features=F.features?b.concat(F.features):b,this.options.externalGeocoder?(E=this.options.externalGeocoder(e,F.features)||Promise.resolve([]),E.then(function(j){return F.features=F.features?j.concat(F.features):j,F},function(){return F})):F}.bind(this)).then(function(i){if(P)throw P;this.options.filter&&i.features.length&&(i.features=i.features.filter(this.options.filter)),i.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",i),this._typeahead.update(i.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",i))}.bind(this)).catch(function(i){this._hideLoadingIcon(),this._hideAttribution(),b.length&&this.options.localGeocoder||E.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(b)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:b}),this._eventEmitter.emit("error",{error:i})}.bind(this)),g},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var l=this;e.relatedTarget&&l._clear(e)},_onQueryResult:function(e){var l=e.body;if(!!l.features.length){var d=l.features[0];this._typeahead.selected=d,this._inputEl.value=d.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],l=fB.language(e),d=dB.placeholder[l];if(d)return d}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,l=!0){return this.options.proximity=e,l&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var l=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||l,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=mx(px({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=mx(px({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(!!this._map){this._removeMarker();var l={color:"#4668F2"},d=pp({},l,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(d),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,l){return this._eventEmitter.on(e,l),this},off:function(e,l){return this._eventEmitter.removeListener(e,l),this.eventManager.remove(),this}};var gB=TI;function _B(e,l,d){d===void 0&&(d={});var g={type:"Feature"};return(d.id===0||d.id)&&(g.id=d.id),d.bbox&&(g.bbox=d.bbox),g.properties=l||{},g.geometry=e,g}function yB(e,l,d){d===void 0&&(d={});for(var g=0,b=e;g<b.length;g++){var E=b[g];if(E.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var P=0;P<E[E.length-1].length;P++)if(E[E.length-1][P]!==E[0][P])throw new Error("First and last Position are not equivalent.")}var i={type:"Polygon",coordinates:e};return _B(i,l,d)}function vB(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function xB(e){return e.type==="Feature"?e.geometry:e}function bB(e,l,d){if(d===void 0&&(d={}),!e)throw new Error("point is required");if(!l)throw new Error("polygon is required");var g=vB(e),b=xB(l),E=b.type,P=l.bbox,i=b.coordinates;if(P&&wB(g,P)===!1)return!1;E==="Polygon"&&(i=[i]);for(var F=!1,j=0;j<i.length&&!F;j++)if(lT(g,i[j][0],d.ignoreBoundary)){for(var K=!1,Y=1;Y<i[j].length&&!K;)lT(g,i[j][Y],!d.ignoreBoundary)&&(K=!0),Y++;K||(F=!0)}return F}function lT(e,l,d){var g=!1;l[0][0]===l[l.length-1][0]&&l[0][1]===l[l.length-1][1]&&(l=l.slice(0,l.length-1));for(var b=0,E=l.length-1;b<l.length;E=b++){var P=l[b][0],i=l[b][1],F=l[E][0],j=l[E][1],K=e[1]*(P-F)+i*(F-e[0])+j*(e[0]-P)===0&&(P-e[0])*(F-e[0])<=0&&(i-e[1])*(j-e[1])<=0;if(K)return!d;var Y=i>e[1]!=j>e[1]&&e[0]<(F-P)*(e[1]-i)/(j-i)+P;Y&&(g=!g)}return g}function wB(e,l){return l[0]<=e[0]&&l[1]<=e[1]&&l[2]>=e[0]&&l[3]>=e[1]}function wd(e){if(e===null||e===!0||e===!1)return NaN;var l=Number(e);return isNaN(l)?l:l<0?Math.ceil(l):Math.floor(l)}function Wv(e,l){if(l.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+l.length+" present")}function Ky(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ky=function(d){return typeof d}:Ky=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},Ky(e)}function gb(e){Wv(1,arguments);var l=Object.prototype.toString.call(e);return e instanceof Date||Ky(e)==="object"&&l==="[object Date]"?new Date(e.getTime()):typeof e=="number"||l==="[object Number]"?new Date(e):((typeof e=="string"||l==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function TB(e,l){Wv(2,arguments);var d=gb(e),g=wd(l);return isNaN(g)?new Date(NaN):(g&&d.setDate(d.getDate()+g),d)}function EB(e,l){Wv(2,arguments);var d=gb(e),g=wd(l);if(isNaN(g))return new Date(NaN);if(!g)return d;var b=d.getDate(),E=new Date(d.getTime());E.setMonth(d.getMonth()+g+1,0);var P=E.getDate();return b>=P?E:(d.setFullYear(E.getFullYear(),E.getMonth(),b),d)}function Yy(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Yy=function(d){return typeof d}:Yy=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},Yy(e)}function SB(e,l){if(Wv(2,arguments),!l||Yy(l)!=="object")return new Date(NaN);var d=l.years?wd(l.years):0,g=l.months?wd(l.months):0,b=l.weeks?wd(l.weeks):0,E=l.days?wd(l.days):0,P=l.hours?wd(l.hours):0,i=l.minutes?wd(l.minutes):0,F=l.seconds?wd(l.seconds):0,j=gb(e),K=g||d?EB(j,g+d*12):j,Y=E||b?TB(K,E+b*7):K,q=i+P*60,re=F+q*60,me=re*1e3,we=new Date(Y.getTime()+me);return we}const EI=(e,l)=>{const d=e.__vccOpts||e;for(const[g,b]of l)d[g]=b;return d},CB={data(){return{dialog:!0}}},IB={class:"text-center"},AB=ir("p",null,[Yo("This is an independent site not affiliated with Maplewood DPW. If you notice and errors or have comments please email "),ir("a",{href:"mailto:wijfi@duck.com"},"wijfi@duck.com")],-1),MB=ir("p",null,[Yo("This does "),ir("b",null,"NOT"),Yo(" take into account changes to the regular schedule (holidays, inclement weather, etc.) "),ir("a",{href:"https://www.maplewoodnj.gov/government/public-works/recycling-and-waste-disposal",target:"_blank"},"Please check the DPW website for updates.")],-1);function kB(e,l,d,g,b,E){const P=Dh("v-card-text"),i=Dh("v-btn"),F=Dh("v-card-actions"),j=Dh("v-card"),K=Dh("v-dialog");return bm(),wm("div",IB,[ce(K,{modelValue:b.dialog,"onUpdate:modelValue":l[1]||(l[1]=Y=>b.dialog=Y)},{default:uu(()=>[ce(j,null,{default:uu(()=>[ce(P,null,{default:uu(()=>[AB]),_:1}),ce(P,null,{default:uu(()=>[MB]),_:1}),ce(F,null,{default:uu(()=>[ce(i,{color:"primary",block:"",onClick:l[0]||(l[0]=Y=>b.dialog=!1)},{default:uu(()=>[Yo("OK")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const PB=EI(CB,[["render",kB]]),zB="FeatureCollection",DB="Maplewood_zones",LB={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},BB=[{type:"Feature",properties:{id:6},geometry:{type:"MultiPolygon",coordinates:[[[[-74.27957739843878,40.74593083246578],[-74.27885119661524,40.74558369497519],[-74.279214297527,40.74523655567262],[-74.28053702227703,40.744981112387094],[-74.28085689688974,40.74494836317695],[-74.28108167364466,40.74475186757754],[-74.28130645039957,40.74428027577033],[-74.28172142287015,40.74319298191695],[-74.28227471949761,40.742249772851515],[-74.28329486015451,40.74137205240105],[-74.28398648093884,40.74048121980238],[-74.28364931580649,40.74028471100537],[-74.28404699775747,40.73992444336971],[-74.28508442893397,40.73954452265833],[-74.28523139835063,40.739452817333934],[-74.28534378672808,40.73924975509428],[-74.2864763157624,40.73905324265925],[-74.28645037998301,40.73879122517618],[-74.28620831270847,40.73831304060909],[-74.28571553289964,40.7381427274674],[-74.28501526685551,40.73792000962413],[-74.2849633952967,40.737703841592634],[-74.28460893964474,40.737461470540154],[-74.28512765523297,40.737579380892186],[-74.28524868887024,40.737854504234214],[-74.2857933402379,40.73799206547854],[-74.28613050537025,40.73803136863896],[-74.28650225154182,40.737854504234214],[-74.28668380199773,40.73777589768119],[-74.28678754511536,40.737585931461155],[-74.2868999334928,40.73748112228],[-74.28763478057616,40.73685226372528],[-74.28797194570852,40.736564034901015],[-74.28811891512518,40.73663609222416],[-74.28833504662029,40.736433021386276],[-74.28819672246343,40.73633476118408],[-74.28885376220852,40.73586802264839],[-74.28871543805164,40.73643957206812],[-74.28901802214479,40.73754007746472],[-74.28932925149773,40.73881087652317],[-74.29272683860071,40.75156992542992],[-74.29279600067917,40.75518498084675],[-74.29255393340466,40.75628517608932],[-74.29141275911053,40.757542519786504],[-74.29016784169873,40.75762110297797],[-74.28048515071818,40.75974281403394],[-74.28010475928681,40.75934990968834],[-74.27955146265936,40.75559100740127],[-74.27987998253191,40.7551587855],[-74.28190297332605,40.75045655355732],[-74.28183381124762,40.74930386656576],[-74.28335537697313,40.74802016889942],[-74.28211045956137,40.746605452972624],[-74.28145341981624,40.74597668067809],[-74.28064076539468,40.74576708859217],[-74.2800701782476,40.74578018811689],[-74.27956875317896,40.74593738221229],[-74.27957739843878,40.74593083246578]]]]}},{type:"Feature",properties:{id:6},geometry:{type:"MultiPolygon",coordinates:[[[[-74.27851673312635,40.74632217869044],[-74.27351977295959,40.743066893979645],[-74.27399526224882,40.74263459066546],[-74.27316531730762,40.742182634196325],[-74.2758885741459,40.73960183842185],[-74.276900069543,40.73818694342107],[-74.27791156494007,40.73642483303303],[-74.27856860468519,40.735232598045215],[-74.27916512761168,40.734669226826576],[-74.27993455573426,40.733693142143444],[-74.28031494716562,40.73314285990259],[-74.28095469639113,40.73238948993039],[-74.28169818873431,40.731695071792274],[-74.28375576056769,40.72961177389427],[-74.2850093232393,40.72857665194183],[-74.28681618253835,40.72699773238303],[-74.28768070851878,40.73001140527648],[-74.28768070851878,40.73022104700901],[-74.28805893863522,40.733110923739936],[-74.28860304967414,40.73430565333295],[-74.28842149921825,40.73526453318947],[-74.2888537622085,40.73586802264837],[-74.28819672246341,40.73633476118407],[-74.28819672246343,40.73633476118408],[-74.28833504662029,40.736433021386276],[-74.28811891512518,40.73663609222416],[-74.28797194570852,40.736564034901015],[-74.28763478057616,40.73685226372528],[-74.2868999334928,40.73748112228],[-74.28678754511536,40.737585931461155],[-74.28668380199773,40.73777589768119],[-74.28650225154182,40.737854504234214],[-74.28613050537227,40.73803136863799],[-74.28613050537025,40.73803136863893],[-74.28524868887024,40.737854504234214],[-74.28512765523297,40.737579380892186],[-74.28460893964474,40.737461470540154],[-74.2849633952967,40.737703841592634],[-74.28501526685551,40.73792000962413],[-74.28620831270845,40.73831304060909],[-74.28645037998301,40.73879122517618],[-74.2864763157624,40.73905324265925],[-74.28534378672808,40.73924975509428],[-74.28523139835063,40.739452817333934],[-74.28508442893397,40.73954452265833],[-74.28404699775747,40.73992444336971],[-74.28364931580649,40.74028471100537],[-74.28398648093884,40.74048121980238],[-74.28329486015451,40.74137205240105],[-74.28227471949761,40.742249772851494],[-74.28172142287015,40.74319298191693],[-74.28108167364466,40.74475186757754],[-74.28085689688974,40.74494836317695],[-74.28053702227703,40.744981112387094],[-74.279214297527,40.74523655567262],[-74.27885119661524,40.74558369497519],[-74.27957739843878,40.74593083246578],[-74.27851673312635,40.74632217869044]]]]}},{type:"Feature",properties:{id:5},geometry:{type:"MultiPolygon",coordinates:[[[[-74.27254718123159,40.72947255748019],[-74.27396500383948,40.72653092845063],[-74.27418113533457,40.72622955154086],[-74.27450965520713,40.725882311235324],[-74.27506295183458,40.72555472438055],[-74.27573728209931,40.725200928766306],[-74.27727613834446,40.72442781328611],[-74.27818389062391,40.723739863994126],[-74.27929912913865,40.72299293956865],[-74.28052675603082,40.72244256883888],[-74.28235090584951,40.722062548298034],[-74.28342291806521,40.721839776627405],[-74.28392434313386,40.721649764907404],[-74.28586952658978,40.722219798440136],[-74.2856966213937,40.72258671399369],[-74.28546319937898,40.72261292217012],[-74.28681618253835,40.72699773238303],[-74.28375576056769,40.72961177389427],[-74.28169818873431,40.731695071792274],[-74.28095469639113,40.73238948993039],[-74.28031494716562,40.73314285990259],[-74.27993455573426,40.733693142143444],[-74.27916512761168,40.734669226826576],[-74.27859467071018,40.73520798063721],[-74.27856860468519,40.735232598045215],[-74.27791156494007,40.73642483303303],[-74.276900069543,40.73818694342107],[-74.2758679289952,40.73962140356787],[-74.27316531730762,40.742182634196325],[-74.26960347026828,40.740199557013014],[-74.26938301614328,40.740389515769344],[-74.26572607124612,40.73790363328269],[-74.26792196723636,40.73545368719096],[-74.2692360467266,40.73423523121033],[-74.26997953906977,40.733442567758836],[-74.27064522407468,40.732721956426204],[-74.271336844859,40.73221097275203],[-74.27159620265311,40.731896519309714],[-74.27180368888844,40.731601717857856],[-74.27180368888844,40.73120209602672],[-74.2719333677855,40.73076316436441],[-74.27254718123159,40.72947255748019]]]]}},{type:"Feature",properties:{id:4},geometry:{type:"MultiPolygon",coordinates:[[[[-74.28342291806521,40.721839776627405],[-74.28235090584951,40.722062548298034],[-74.28052675603082,40.72244256883888],[-74.27929912913865,40.72299293956865],[-74.27818389062391,40.723739863994126],[-74.27727613834446,40.72442781328611],[-74.2757372820993,40.725200928766306],[-74.27573728209906,40.72520092876644],[-74.27506295183458,40.72555472438055],[-74.27450965520713,40.725882311235324],[-74.27418113533457,40.72622955154086],[-74.27396500383948,40.72653092845063],[-74.27254718123159,40.72947255748019],[-74.27193336778696,40.730763164361335],[-74.2719333677855,40.73076316436438],[-74.27180368888844,40.73120209602672],[-74.27180368888844,40.731601717857856],[-74.271336844859,40.73221097275203],[-74.27064522407468,40.732721956426204],[-74.26792196723636,40.73545368719096],[-74.26572607124612,40.73790363328269],[-74.2623781943869,40.73562728259782],[-74.26223122497024,40.7356764132911],[-74.26325568825702,40.734392452590704],[-74.26412021423742,40.73285952828333],[-74.26527867905119,40.73140518283094],[-74.26903072180617,40.726661961463904],[-74.27082893584546,40.72408056357984],[-74.27184907650235,40.722691546637435],[-74.27172804286508,40.72242946471839],[-74.27039667285524,40.721223874599005],[-74.27025834869836,40.72060796687166],[-74.2771356528726,40.71965133293143],[-74.2773344938481,40.71971685624262],[-74.27787049995595,40.71994946347649],[-74.2786356054486,40.72035898127917],[-74.27933587149275,40.72036225741146],[-74.27969464977461,40.72050313094624],[-74.28052027208591,40.72071607874681],[-74.28118595709083,40.721001100121434],[-74.28190783628447,40.721001100121434],[-74.28205480570114,40.72104368941744],[-74.28227958245604,40.72110593526259],[-74.28392434313386,40.721649764907404],[-74.28342291806521,40.721839776627405]]]]}},{type:"Feature",properties:{id:1},geometry:{type:"MultiPolygon",coordinates:[[[[-74.24956808067208,40.723513821960296],[-74.24949891859366,40.72336312684464],[-74.24992253632404,40.72287172735813],[-74.25015595833877,40.722937247499274],[-74.25033750879464,40.722622750233526],[-74.25004356996132,40.72251791748137],[-74.25018189411817,40.72227549110961],[-74.24879000728971,40.72149578949492],[-74.25085622438293,40.71915007746676],[-74.25137493997117,40.71892074364278],[-74.2516775240643,40.71891419123621],[-74.25115016321628,40.71837689170178],[-74.25175533140255,40.7179182179363],[-74.25277547205944,40.71724985907761],[-74.25228269225062,40.7168206643117],[-74.25199739867708,40.7165257960751],[-74.25277547205947,40.715991753610815],[-74.25253340478493,40.715778790697165],[-74.25302186196387,40.71546753598256],[-74.2528489567678,40.715306993508264],[-74.25344980232418,40.714917103030416],[-74.2545391050595,40.71417663247572],[-74.25545334128378,40.713604891833576],[-74.25567379540878,40.71349021546895],[-74.25606715472985,40.71341158013333],[-74.25630057674458,40.71330345639521],[-74.2578005293206,40.713709738622704],[-74.25831924490886,40.713703185703224],[-74.26023849258537,40.714594376832125],[-74.26253813169328,40.71517757633392],[-74.26331620507564,40.71551831974586],[-74.2659011377571,40.71625877537845],[-74.26737947718361,40.716697802705156],[-74.26839961784049,40.717117169388196],[-74.26894426920815,40.7172154580724],[-74.26943704901697,40.717326851739074],[-74.27061280435035,40.71773310941447],[-74.27203927221802,40.718080392235976],[-74.27400174619356,40.718755295179164],[-74.27509969418867,40.71912222983031],[-74.27548008562007,40.71919430604194],[-74.27586912231125,40.719299144028696],[-74.27679416511029,40.7196333140095],[-74.2771356528726,40.71965133293143],[-74.27025834869836,40.72060796687166],[-74.27025986070556,40.720614699295965],[-74.24956808067208,40.723513821960296]]]]}},{type:"Feature",properties:{id:2},geometry:{type:"MultiPolygon",coordinates:[[[[-74.27184907650235,40.722691546637435],[-74.27082893584546,40.72408056357984],[-74.26903072180617,40.726661961463904],[-74.26527867905119,40.73140518283094],[-74.2652332914372,40.73124467879498],[-74.26374630675087,40.73073368377577],[-74.26076369211846,40.7298099520517],[-74.25661396741243,40.72852587814053],[-74.25533446896144,40.72833588550857],[-74.25217894913291,40.727346604762744],[-74.25155649042699,40.727267985794505],[-74.25104642009856,40.726953508992864],[-74.2499052458044,40.726750408602],[-74.24833180852006,40.72630489589614],[-74.24777851189258,40.726180413871695],[-74.24789954552986,40.7259248974079],[-74.24818483910339,40.725951104269825],[-74.24956808067208,40.723513821960296],[-74.27025986070556,40.720614699295965],[-74.27039667285524,40.721223874599005],[-74.27172804286508,40.72242946471839],[-74.27184907650235,40.722691546637435]]]]}},{type:"Feature",properties:{id:3},geometry:{type:"MultiPolygon",coordinates:[[[[-74.26527867905119,40.73140518283094],[-74.26412021423742,40.73285952828333],[-74.26325568825702,40.734392452590704],[-74.26223122497024,40.7356764132911],[-74.26148340999715,40.73658696223946],[-74.26030765466379,40.73603670393329],[-74.25959874335985,40.73691449478466],[-74.25849215010491,40.736390441938305],[-74.25775081907672,40.73707170983357],[-74.25703326251298,40.73671797545103],[-74.25560247201541,40.73750404930237],[-74.25449155613057,40.737749695476055],[-74.25202765708639,40.73842112372272],[-74.25175100877264,40.738087048076345],[-74.25143113415987,40.73761213373055],[-74.25131010052263,40.73720272209052],[-74.2510593879883,40.73632493504223],[-74.25090377331183,40.73602687785076],[-74.25050609136085,40.7355290211023],[-74.24984905161573,40.73488704242722],[-74.24907962349316,40.73452674555893],[-74.24807677335586,40.73424833300609],[-74.24440253793912,40.733314823591634],[-74.2443938926793,40.733006926386025],[-74.24372388504447,40.732813671029156],[-74.24393569390968,40.7322830347898],[-74.24383195079203,40.73225683042143],[-74.24384059605181,40.73220114610433],[-74.24310574896847,40.731952203881626],[-74.2435725929979,40.731159513230956],[-74.243788724493,40.731231576407616],[-74.24385356394154,40.73108744997627],[-74.24368065874545,40.73104486710725],[-74.24373685293419,40.73085160605158],[-74.24324407312533,40.73071075442007],[-74.24348181776993,40.73019647965252],[-74.24406105017681,40.73060265877973],[-74.24554803486315,40.72868966445684],[-74.24575552109843,40.72855863543602],[-74.24582468317686,40.72832278254842],[-74.24598894311315,40.72836209142105],[-74.24617913882884,40.72765452816066],[-74.24668920915727,40.727733146672215],[-74.24681024279454,40.72730729529024],[-74.24723386052494,40.727385914212014],[-74.24777851189258,40.726180413871695],[-74.24833180852006,40.72630489589614],[-74.2499052458044,40.726750408602],[-74.25104642009856,40.726953508992864],[-74.25155649042699,40.727267985794505],[-74.25217894913291,40.727346604762744],[-74.25533446896144,40.72833588550857],[-74.25661396741243,40.72852587814053],[-74.25661396741599,40.72852587814163],[-74.2652332914372,40.73124467879498],[-74.26527867905119,40.73140518283094]]]]}}],RB={type:zB,name:DB,crs:LB,features:BB};const OB={components:{Modal:PB},data(){return{data:null,items:[],model:null,map:null,type:"",geoidHover:-1,clickedId:"",selectedData:null,_keys:null,searching:!1,hoverActive:!0,geocoder:null,selectedAddress:{},fiber:["Corrugated Cardboard (Flattened no packing materials)","Boxboard (Flattened cereal boxes etc)","Paper Bags","Junk Mail (Including window envelopes)","Office Paper","Newspapers & Magazines","Only Corrugated Brown Pizza Boxes (No grease. Food & liner removed)"],mixed:["#1, 2, & 5 Plastic Containers & Bottles with Caps","Glass Bottles (Any Color) & Jars with Lids","Aluminum cans, pie tins, & catering trays","Steel/tin Food Cans","Gable Top cartons (OJ, Milk, aseptic packaging)","Juice Boxes (TetraPak)"],collectionType:"",nextCollectionWeek:"",collectionIsToday:!1,zone:-1,daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],collectionDays:[-1,1,1,2,2,3,3]}},created(){this.dataManager=co("dataManager"),this.mitt=co("mitt"),this.env=this.dataManager.env;const e=new Proxy(new URLSearchParams(window.location.search),{get:(l,d)=>l.get(d)});this.now,e.year&&e.week&&e.day?this.now=new Date(e.year,e.week,e.day):this.now=new Date,this.today=this.now.getDay(),this.thisWeek=this.now.getWeek(),this.nextWeek=SB(this.now,{weeks:1}).getWeek()},computed:{},mounted(){let e=this,l=this.dataManager.mainConfig.mapConfig;l.transformRequest=(g,b)=>{let E;E=g.replace("{key}",this.dataManager.mainConfig.api.keys.maptiler);const P=Object.fromEntries(this.dataManager.mainConfig.environments);switch(e.env){case"PROD":E=E.replace(P.DEV,P.PROD);case"DEV":case"LOCAL":default:E=E.replace(P.PROD,P.DEV)}return{url:E}},this.map=new cx.Map(l);const d={accessToken:this.dataManager.mainConfig.api.keys.mapbox,mapboxgl:sL,bbox:[-74.3031128519256,40.71514165,-74.237198398,40.764057727],types:"address",enableGeolocation:!0,placeholder:"Enter address or click arrow to geolocate"};this.geocoder=new gB(d).on("result",g=>{this.selectedAddress=g.result}).on("clear",()=>{this.selectedAddress={}}).addTo("#geocoder"),this.map.addControl(new cx.NavigationControl,"bottom-left"),this.hoverActive&&(this.map.on("mousemove","maplewood-zones",g=>{g.features&&g.features.length>0&&e.geoidHover!==g.features[0].properties.id&&(e.geoidHover=g.features[0].properties.id,e.map.setPaintProperty("maplewood-zones","fill-opacity",["case",["==",["get","id"],e.geoidHover],.85,["==",["get","id"],e.clickedId],.85,.5]),e.map.setPaintProperty("maplewood-zone-outline","line-width",["case",["==",["get","id"],e.geoidHover],4,["==",["get","id"],e.clickedId],4,2]))}),this.map.on("mouseleave","maplewood-zones",g=>{e.geoidHover=-1,e.map.setPaintProperty("maplewood-zone-outline","line-width",2),e.map.setPaintProperty("maplewood-zones","fill-opacity",.75)})),this.map.on("click","maplewood-zones",g=>{g.features&&g.features.length>0?(this.marker&&(this.marker.remove(),this.marker=null),e.setFromLngLat(g.lngLat.lng,g.lngLat.lat),e.map.setPaintProperty("maplewood-zones","fill-opacity",["case",["==",["get","id"],e.clickedId],.85,.5]),e.map.setPaintProperty("maplewood-zone-outline","line-width",["case",["==",["get","id"],e.clickedId],4,2])):(e.clickedId="",e.map.setPaintProperty("maplewood-zone-outline","line-width",2),e.map.setPaintProperty("maplewood-zones","fill-opacity",.75))})},methods:{reset(){this.zone=-1,this.nextCollectionWeek=!1,this.collectionIsToday=!1,this.collectionType="",this.marker&&(this.marker.remove(),this.marker=null)},getColor(e,l){const d=this.dataManager.colorConfig[l];for(let g=0;g<d.length;g++)if(e<d[g].stop)return d[g].color;return d[d.length-1].color},styleTractsLayer(e,l){const d=["match",["get","geoid20"]];for(const g of e)if(g.val){let b=this.getColor(g.val,l);d.push(g.geoid20,b)}d.push("rgba(0, 0, 0, 0)"),this.map.setPaintProperty("tracts","fill-color",d)},setFromLngLat(e,l){RB.features.forEach(d=>{let g=yB(d.geometry.coordinates[0]);bB([e,l],g)&&(this.zone=d.properties.id)}),this.nextCollectionWeek=this.today>this.collectionDays[this.zone]?this.nextWeek:this.thisWeek,console.log(this.nextCollectionWeek),this.collectionIsToday=this.today===this.collectionDays[this.zone],this.collectionType=this.nextCollectionWeek%2===0?"C":"F",this.marker=new cx.Marker({color:"#FFFFFF",draggable:!0}).setLngLat([e,l]).addTo(this.map),this.map.flyTo({center:[e,l],zoom:16})}},watch:{model(e){},selectedAddress(e){this.marker&&(this.marker.remove(),this.marker=null),this.setFromLngLat(e.center[0],e.center[1])}}},FB=ir("div",{class:"title"},[ir("h2",{style:{color:"#44744c"}},"Maplewood Recycling")],-1),VB={id:"main-map"},NB={id:"hover-popup"},UB={class:"hover-note"},$B=ir("br",null,null,-1),jB=ir("div",{class:"small-hover-note"},"Click the map, enter address in the box, or geolocate for more info",-1),GB=ir("div",{id:"geocoder",class:"geocoder-container mx-auto"},null,-1),qB=ir("p",{class:"disclaimer"},[Yo("This is an independent site not affiliated with Maplewood DPW. If you notice and errors or have comments please email "),ir("a",{href:"mailto:wijfi@duck.com"},"wijfi@duck.com")],-1),ZB=ir("p",{class:"disclaimer"},[Yo("This does "),ir("b",null,"NOT"),Yo(" take into account changes to the regular schedule (holidays, inclement weather, etc.) "),ir("a",{href:"https://www.maplewoodnj.gov/government/public-works/recycling-and-waste-disposal",target:"_blank"},"Please check the DPW website for updates.")],-1),WB=ir("b",null,[Yo(" Check your recycling schedule by: "),ir("br"),ir("ul",null,[ir("li",null,"Clicking the map"),ir("li",null,"Entering your address in the box on the right"),ir("li",null,[Yo("Clicking the geolocate icon ("),ir("svg",{class:"mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-geolocate",viewBox:"0 0 18 18","xml:space":"preserve",width:"18",height:"18"},[ir("path",{d:"M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z",fill:"#4264fb"})]),Yo(") in the box on the right ")])])],-1),XB=ir("br",null,null,-1),HB=ir("a",{href:"https://www.maplewoodnj.gov/home/showpublisheddocument/984/638059490986930000"},"click here",-1),KB=ir("br",null,null,-1),YB=ir("div",{class:"type-of-week"},[Yo(" It is a "),ir("b",null,"FIBER"),Yo(" week "),ir("h4",null,"(Cardboard & Paper)")],-1),JB={class:"item-list"},QB=ir("div",{class:"type-of-week"},[Yo(" It is a "),ir("b",null,"COMMINGLED"),Yo(" week "),ir("h4",null,"(Glass, Metal & Plastic)")],-1),eR={class:"item-list"};function tR(e,l,d,g,b,E){const P=Dh("Modal"),i=Dh("v-sheet"),F=Dh("v-divider"),j=Dh("v-btn"),K=Dh("v-card");return bm(),wm(Tr,null,[ce(P),FB,ir("div",null,[ir("div",VB,[io(ir("div",NB,[ir("span",UB," You're hovered over zone "+ap(b.geoidHover),1),$B,Yo(" Regular Pickup Day: "+ap(b.daysOfWeek[b.collectionDays[b.geoidHover]])+" ",1),jB],512),[[na,b.geoidHover>-1]])]),ce(i,null,{default:uu(()=>[GB]),_:1}),ce(i,{class:"side-info"},{default:uu(()=>[qB,ZB,ce(F),io(ir("div",null,[WB,XB,Yo(" Starting in January 2023, recycling materials will need to be separated into two categories for two distinct pickups on alternating weeks. One week\u2019s pickup will be exclusively for Fibers (cardboard, paper) and the following week\u2019s pickup will be for Commingled (plastic, glass, and metal containers). Cross-contaminated recycling loads or materials put out on the wrong week will not be picked up. For more information on what materials can and cannot be recycled, please reference the FAQ section at the bottom of this page. To download a copy of the recycling guide, "),HB,Yo(". ")],512),[[na,b.zone<0]]),io(ce(K,{variant:"flat"},{default:uu(()=>[ce(j,{class:"reset-btn",flat:"",variant:"outlined","append-icon":"mdi-restart",rounded:"",onClick:l[0]||(l[0]=Y=>E.reset())},{default:uu(()=>[Yo(" Reset")]),_:1}),io(ce(K,{variant:"flat",class:"outer-info-card"},{default:uu(()=>[Yo(" The location you selected is in "),ir("b",null,"Zone "+ap(b.zone),1),KB,Yo(" Your next collection is "),io(ir("span",{style:{"font-weight":"bold"}}," next week on "+ap(b.daysOfWeek[b.collectionDays[b.zone]]),513),[[na,b.nextCollectionWeek===e.nextWeek&&!b.collectionIsToday]]),io(ir("span",{style:{"font-weight":"bold"}}," this week on "+ap(b.daysOfWeek[b.collectionDays[b.zone]]),513),[[na,b.nextCollectionWeek===e.thisWeek&&!b.collectionIsToday]]),io(ir("span",null,"today.",512),[[na,b.collectionIsToday]]),io(ir("div",null,[YB,ir("ul",JB,[(bm(!0),wm(Tr,null,$w(b.fiber,Y=>(bm(),wm("li",{key:Y}," - "+ap(Y),1))),128))])],512),[[na,b.collectionType==="F"]]),io(ir("div",null,[QB,ir("ul",eR,[(bm(!0),wm(Tr,null,$w(b.mixed,Y=>(bm(),wm("li",{key:Y}," - "+ap(Y),1))),128))])],512),[[na,b.collectionType==="C"]])]),_:1},512),[[na,b.zone>0]])]),_:1},512),[[na,b.zone>0]])]),_:1})])],64)}const iR=EI(OB,[["render",tR]]);function nR(e){return{all:e=e||new Map,on:function(l,d){var g=e.get(l);g?g.push(d):e.set(l,[d])},off:function(l,d){var g=e.get(l);g&&(d?g.splice(g.indexOf(d)>>>0,1):e.set(l,[]))},emit:function(l,d){var g=e.get(l);g&&g.slice().map(function(b){b(d)}),(g=e.get("*"))&&g.slice().map(function(b){b(l,d)})}}}function SI(e,l){return function(){return e.apply(l,arguments)}}const{toString:CI}=Object.prototype,{getPrototypeOf:_b}=Object,yb=(e=>l=>{const d=CI.call(l);return e[d]||(e[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),Bd=e=>(e=e.toLowerCase(),l=>yb(l)===e),Xv=e=>l=>typeof l===e,{isArray:M_}=Array,i1=Xv("undefined");function rR(e){return e!==null&&!i1(e)&&e.constructor!==null&&!i1(e.constructor)&&Hm(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const II=Bd("ArrayBuffer");function oR(e){let l;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?l=ArrayBuffer.isView(e):l=e&&e.buffer&&II(e.buffer),l}const sR=Xv("string"),Hm=Xv("function"),AI=Xv("number"),MI=e=>e!==null&&typeof e=="object",aR=e=>e===!0||e===!1,Jy=e=>{if(yb(e)!=="object")return!1;const l=_b(e);return(l===null||l===Object.prototype||Object.getPrototypeOf(l)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},lR=Bd("Date"),cR=Bd("File"),uR=Bd("Blob"),hR=Bd("FileList"),dR=e=>MI(e)&&Hm(e.pipe),fR=e=>{const l="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||CI.call(e)===l||Hm(e.toString)&&e.toString()===l)},pR=Bd("URLSearchParams"),mR=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Hv(e,l,{allOwnKeys:d=!1}={}){if(e===null||typeof e>"u")return;let g,b;if(typeof e!="object"&&(e=[e]),M_(e))for(g=0,b=e.length;g<b;g++)l.call(null,e[g],g,e);else{const E=d?Object.getOwnPropertyNames(e):Object.keys(e),P=E.length;let i;for(g=0;g<P;g++)i=E[g],l.call(null,e[i],i,e)}}function n1(){const e={},l=(d,g)=>{Jy(e[g])&&Jy(d)?e[g]=n1(e[g],d):Jy(d)?e[g]=n1({},d):M_(d)?e[g]=d.slice():e[g]=d};for(let d=0,g=arguments.length;d<g;d++)arguments[d]&&Hv(arguments[d],l);return e}const gR=(e,l,d,{allOwnKeys:g}={})=>(Hv(l,(b,E)=>{d&&Hm(b)?e[E]=SI(b,d):e[E]=b},{allOwnKeys:g}),e),_R=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),yR=(e,l,d,g)=>{e.prototype=Object.create(l.prototype,g),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:l.prototype}),d&&Object.assign(e.prototype,d)},vR=(e,l,d,g)=>{let b,E,P;const i={};if(l=l||{},e==null)return l;do{for(b=Object.getOwnPropertyNames(e),E=b.length;E-- >0;)P=b[E],(!g||g(P,e,l))&&!i[P]&&(l[P]=e[P],i[P]=!0);e=d!==!1&&_b(e)}while(e&&(!d||d(e,l))&&e!==Object.prototype);return l},xR=(e,l,d)=>{e=String(e),(d===void 0||d>e.length)&&(d=e.length),d-=l.length;const g=e.indexOf(l,d);return g!==-1&&g===d},bR=e=>{if(!e)return null;if(M_(e))return e;let l=e.length;if(!AI(l))return null;const d=new Array(l);for(;l-- >0;)d[l]=e[l];return d},wR=(e=>l=>e&&l instanceof e)(typeof Uint8Array<"u"&&_b(Uint8Array)),TR=(e,l)=>{const g=(e&&e[Symbol.iterator]).call(e);let b;for(;(b=g.next())&&!b.done;){const E=b.value;l.call(e,E[0],E[1])}},ER=(e,l)=>{let d;const g=[];for(;(d=e.exec(l))!==null;)g.push(d);return g},SR=Bd("HTMLFormElement"),CR=e=>e.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(d,g,b){return g.toUpperCase()+b}),cT=(({hasOwnProperty:e})=>(l,d)=>e.call(l,d))(Object.prototype),IR=Bd("RegExp"),kI=(e,l)=>{const d=Object.getOwnPropertyDescriptors(e),g={};Hv(d,(b,E)=>{l(b,E,e)!==!1&&(g[E]=b)}),Object.defineProperties(e,g)},AR=e=>{kI(e,(l,d)=>{const g=e[d];if(!!Hm(g)){if(l.enumerable=!1,"writable"in l){l.writable=!1;return}l.set||(l.set=()=>{throw Error("Can not read-only method '"+d+"'")})}})},MR=(e,l)=>{const d={},g=b=>{b.forEach(E=>{d[E]=!0})};return M_(e)?g(e):g(String(e).split(l)),d},kR=()=>{},PR=(e,l)=>(e=+e,Number.isFinite(e)?e:l),Ii={isArray:M_,isArrayBuffer:II,isBuffer:rR,isFormData:fR,isArrayBufferView:oR,isString:sR,isNumber:AI,isBoolean:aR,isObject:MI,isPlainObject:Jy,isUndefined:i1,isDate:lR,isFile:cR,isBlob:uR,isRegExp:IR,isFunction:Hm,isStream:dR,isURLSearchParams:pR,isTypedArray:wR,isFileList:hR,forEach:Hv,merge:n1,extend:gR,trim:mR,stripBOM:_R,inherits:yR,toFlatObject:vR,kindOf:yb,kindOfTest:Bd,endsWith:xR,toArray:bR,forEachEntry:TR,matchAll:ER,isHTMLForm:SR,hasOwnProperty:cT,hasOwnProp:cT,reduceDescriptors:kI,freezeMethods:AR,toObjectSet:MR,toCamelCase:CR,noop:kR,toFiniteNumber:PR};function no(e,l,d,g,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",l&&(this.code=l),d&&(this.config=d),g&&(this.request=g),b&&(this.response=b)}Ii.inherits(no,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const PI=no.prototype,zI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{zI[e]={value:e}});Object.defineProperties(no,zI);Object.defineProperty(PI,"isAxiosError",{value:!0});no.from=(e,l,d,g,b,E)=>{const P=Object.create(PI);return Ii.toFlatObject(e,P,function(F){return F!==Error.prototype},i=>i!=="isAxiosError"),no.call(P,e.message,l,d,g,b),P.cause=e,P.name=e.name,E&&Object.assign(P,E),P};var zR=typeof self=="object"?self.FormData:window.FormData;function r1(e){return Ii.isPlainObject(e)||Ii.isArray(e)}function DI(e){return Ii.endsWith(e,"[]")?e.slice(0,-2):e}function uT(e,l,d){return e?e.concat(l).map(function(b,E){return b=DI(b),!d&&E?"["+b+"]":b}).join(d?".":""):l}function DR(e){return Ii.isArray(e)&&!e.some(r1)}const LR=Ii.toFlatObject(Ii,{},null,function(l){return/^is[A-Z]/.test(l)});function BR(e){return e&&Ii.isFunction(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator]}function Kv(e,l,d){if(!Ii.isObject(e))throw new TypeError("target must be an object");l=l||new(zR||FormData),d=Ii.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(we,je){return!Ii.isUndefined(je[we])});const g=d.metaTokens,b=d.visitor||K,E=d.dots,P=d.indexes,F=(d.Blob||typeof Blob<"u"&&Blob)&&BR(l);if(!Ii.isFunction(b))throw new TypeError("visitor must be a function");function j(me){if(me===null)return"";if(Ii.isDate(me))return me.toISOString();if(!F&&Ii.isBlob(me))throw new no("Blob is not supported. Use a Buffer instead.");return Ii.isArrayBuffer(me)||Ii.isTypedArray(me)?F&&typeof Blob=="function"?new Blob([me]):Buffer.from(me):me}function K(me,we,je){let $e=me;if(me&&!je&&typeof me=="object"){if(Ii.endsWith(we,"{}"))we=g?we:we.slice(0,-2),me=JSON.stringify(me);else if(Ii.isArray(me)&&DR(me)||Ii.isFileList(me)||Ii.endsWith(we,"[]")&&($e=Ii.toArray(me)))return we=DI(we),$e.forEach(function(Ae,mt){!(Ii.isUndefined(Ae)||Ae===null)&&l.append(P===!0?uT([we],mt,E):P===null?we:we+"[]",j(Ae))}),!1}return r1(me)?!0:(l.append(uT(je,we,E),j(me)),!1)}const Y=[],q=Object.assign(LR,{defaultVisitor:K,convertValue:j,isVisitable:r1});function re(me,we){if(!Ii.isUndefined(me)){if(Y.indexOf(me)!==-1)throw Error("Circular reference detected in "+we.join("."));Y.push(me),Ii.forEach(me,function($e,tt){(!(Ii.isUndefined($e)||$e===null)&&b.call(l,$e,Ii.isString(tt)?tt.trim():tt,we,q))===!0&&re($e,we?we.concat(tt):[tt])}),Y.pop()}}if(!Ii.isObject(e))throw new TypeError("data must be an object");return re(e),l}function hT(e){const l={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(g){return l[g]})}function vb(e,l){this._pairs=[],e&&Kv(e,this,l)}const LI=vb.prototype;LI.append=function(l,d){this._pairs.push([l,d])};LI.toString=function(l){const d=l?function(g){return l.call(this,g,hT)}:hT;return this._pairs.map(function(b){return d(b[0])+"="+d(b[1])},"").join("&")};function RR(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function BI(e,l,d){if(!l)return e;const g=d&&d.encode||RR,b=d&&d.serialize;let E;if(b?E=b(l,d):E=Ii.isURLSearchParams(l)?l.toString():new vb(l,d).toString(g),E){const P=e.indexOf("#");P!==-1&&(e=e.slice(0,P)),e+=(e.indexOf("?")===-1?"?":"&")+E}return e}class dT{constructor(){this.handlers=[]}use(l,d,g){return this.handlers.push({fulfilled:l,rejected:d,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(l){this.handlers[l]&&(this.handlers[l]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(l){Ii.forEach(this.handlers,function(g){g!==null&&l(g)})}}const RI={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},OR=typeof URLSearchParams<"u"?URLSearchParams:vb,FR=FormData,VR=(()=>{let e;return typeof navigator<"u"&&((e=navigator.product)==="ReactNative"||e==="NativeScript"||e==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),Sd={isBrowser:!0,classes:{URLSearchParams:OR,FormData:FR,Blob},isStandardBrowserEnv:VR,protocols:["http","https","file","blob","url","data"]};function NR(e,l){return Kv(e,new Sd.classes.URLSearchParams,Object.assign({visitor:function(d,g,b,E){return Sd.isNode&&Ii.isBuffer(d)?(this.append(g,d.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},l))}function UR(e){return Ii.matchAll(/\w+|\[(\w*)]/g,e).map(l=>l[0]==="[]"?"":l[1]||l[0])}function $R(e){const l={},d=Object.keys(e);let g;const b=d.length;let E;for(g=0;g<b;g++)E=d[g],l[E]=e[E];return l}function OI(e){function l(d,g,b,E){let P=d[E++];const i=Number.isFinite(+P),F=E>=d.length;return P=!P&&Ii.isArray(b)?b.length:P,F?(Ii.hasOwnProp(b,P)?b[P]=[b[P],g]:b[P]=g,!i):((!b[P]||!Ii.isObject(b[P]))&&(b[P]=[]),l(d,g,b[P],E)&&Ii.isArray(b[P])&&(b[P]=$R(b[P])),!i)}if(Ii.isFormData(e)&&Ii.isFunction(e.entries)){const d={};return Ii.forEachEntry(e,(g,b)=>{l(UR(g),b,d,0)}),d}return null}function jR(e,l,d){const g=d.config.validateStatus;!d.status||!g||g(d.status)?e(d):l(new no("Request failed with status code "+d.status,[no.ERR_BAD_REQUEST,no.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}const GR=Sd.isStandardBrowserEnv?function(){return{write:function(d,g,b,E,P,i){const F=[];F.push(d+"="+encodeURIComponent(g)),Ii.isNumber(b)&&F.push("expires="+new Date(b).toGMTString()),Ii.isString(E)&&F.push("path="+E),Ii.isString(P)&&F.push("domain="+P),i===!0&&F.push("secure"),document.cookie=F.join("; ")},read:function(d){const g=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove:function(d){this.write(d,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function qR(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function ZR(e,l){return l?e.replace(/\/+$/,"")+"/"+l.replace(/^\/+/,""):e}function FI(e,l){return e&&!qR(l)?ZR(e,l):l}const WR=Sd.isStandardBrowserEnv?function(){const l=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let g;function b(E){let P=E;return l&&(d.setAttribute("href",P),P=d.href),d.setAttribute("href",P),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return g=b(window.location.href),function(P){const i=Ii.isString(P)?b(P):P;return i.protocol===g.protocol&&i.host===g.host}}():function(){return function(){return!0}}();function k_(e,l,d){no.call(this,e==null?"canceled":e,no.ERR_CANCELED,l,d),this.name="CanceledError"}Ii.inherits(k_,no,{__CANCEL__:!0});function XR(e){const l=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return l&&l[1]||""}const HR=Ii.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),KR=e=>{const l={};let d,g,b;return e&&e.split(`
`).forEach(function(P){b=P.indexOf(":"),d=P.substring(0,b).trim().toLowerCase(),g=P.substring(b+1).trim(),!(!d||l[d]&&HR[d])&&(d==="set-cookie"?l[d]?l[d].push(g):l[d]=[g]:l[d]=l[d]?l[d]+", "+g:g)}),l},fT=Symbol("internals"),VI=Symbol("defaults");function Jg(e){return e&&String(e).trim().toLowerCase()}function Qy(e){return e===!1||e==null?e:Ii.isArray(e)?e.map(Qy):String(e)}function YR(e){const l=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=d.exec(e);)l[g[1]]=g[2];return l}function pT(e,l,d,g){if(Ii.isFunction(g))return g.call(this,l,d);if(!!Ii.isString(l)){if(Ii.isString(g))return l.indexOf(g)!==-1;if(Ii.isRegExp(g))return g.test(l)}}function JR(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(l,d,g)=>d.toUpperCase()+g)}function QR(e,l){const d=Ii.toCamelCase(" "+l);["get","set","has"].forEach(g=>{Object.defineProperty(e,g+d,{value:function(b,E,P){return this[g].call(this,l,b,E,P)},configurable:!0})})}function Hg(e,l){l=l.toLowerCase();const d=Object.keys(e);let g=d.length,b;for(;g-- >0;)if(b=d[g],l===b.toLowerCase())return b;return null}function gu(e,l){e&&this.set(e),this[VI]=l||null}Object.assign(gu.prototype,{set:function(e,l,d){const g=this;function b(E,P,i){const F=Jg(P);if(!F)throw new Error("header name must be a non-empty string");const j=Hg(g,F);j&&i!==!0&&(g[j]===!1||i===!1)||(g[j||P]=Qy(E))}return Ii.isPlainObject(e)?Ii.forEach(e,(E,P)=>{b(E,P,l)}):b(l,e,d),this},get:function(e,l){if(e=Jg(e),!e)return;const d=Hg(this,e);if(d){const g=this[d];if(!l)return g;if(l===!0)return YR(g);if(Ii.isFunction(l))return l.call(this,g,d);if(Ii.isRegExp(l))return l.exec(g);throw new TypeError("parser must be boolean|regexp|function")}},has:function(e,l){if(e=Jg(e),e){const d=Hg(this,e);return!!(d&&(!l||pT(this,this[d],d,l)))}return!1},delete:function(e,l){const d=this;let g=!1;function b(E){if(E=Jg(E),E){const P=Hg(d,E);P&&(!l||pT(d,d[P],P,l))&&(delete d[P],g=!0)}}return Ii.isArray(e)?e.forEach(b):b(e),g},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(e){const l=this,d={};return Ii.forEach(this,(g,b)=>{const E=Hg(d,b);if(E){l[E]=Qy(g),delete l[b];return}const P=e?JR(b):String(b).trim();P!==b&&delete l[b],l[P]=Qy(g),d[P]=!0}),this},toJSON:function(e){const l=Object.create(null);return Ii.forEach(Object.assign({},this[VI]||null,this),(d,g)=>{d==null||d===!1||(l[g]=e&&Ii.isArray(d)?d.join(", "):d)}),l}});Object.assign(gu,{from:function(e){return Ii.isString(e)?new this(KR(e)):e instanceof this?e:new this(e)},accessor:function(e){const d=(this[fT]=this[fT]={accessors:{}}).accessors,g=this.prototype;function b(E){const P=Jg(E);d[P]||(QR(g,E),d[P]=!0)}return Ii.isArray(e)?e.forEach(b):b(e),this}});gu.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);Ii.freezeMethods(gu.prototype);Ii.freezeMethods(gu);function eO(e,l){e=e||10;const d=new Array(e),g=new Array(e);let b=0,E=0,P;return l=l!==void 0?l:1e3,function(F){const j=Date.now(),K=g[E];P||(P=j),d[b]=F,g[b]=j;let Y=E,q=0;for(;Y!==b;)q+=d[Y++],Y=Y%e;if(b=(b+1)%e,b===E&&(E=(E+1)%e),j-P<l)return;const re=K&&j-K;return re?Math.round(q*1e3/re):void 0}}function mT(e,l){let d=0;const g=eO(50,250);return b=>{const E=b.loaded,P=b.lengthComputable?b.total:void 0,i=E-d,F=g(i),j=E<=P;d=E;const K={loaded:E,total:P,progress:P?E/P:void 0,bytes:i,rate:F||void 0,estimated:F&&P&&j?(P-E)/F:void 0};K[l?"download":"upload"]=!0,e(K)}}function gT(e){return new Promise(function(d,g){let b=e.data;const E=gu.from(e.headers).normalize(),P=e.responseType;let i;function F(){e.cancelToken&&e.cancelToken.unsubscribe(i),e.signal&&e.signal.removeEventListener("abort",i)}Ii.isFormData(b)&&Sd.isStandardBrowserEnv&&E.setContentType(!1);let j=new XMLHttpRequest;if(e.auth){const re=e.auth.username||"",me=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";E.set("Authorization","Basic "+btoa(re+":"+me))}const K=FI(e.baseURL,e.url);j.open(e.method.toUpperCase(),BI(K,e.params,e.paramsSerializer),!0),j.timeout=e.timeout;function Y(){if(!j)return;const re=gu.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders()),we={data:!P||P==="text"||P==="json"?j.responseText:j.response,status:j.status,statusText:j.statusText,headers:re,config:e,request:j};jR(function($e){d($e),F()},function($e){g($e),F()},we),j=null}if("onloadend"in j?j.onloadend=Y:j.onreadystatechange=function(){!j||j.readyState!==4||j.status===0&&!(j.responseURL&&j.responseURL.indexOf("file:")===0)||setTimeout(Y)},j.onabort=function(){!j||(g(new no("Request aborted",no.ECONNABORTED,e,j)),j=null)},j.onerror=function(){g(new no("Network Error",no.ERR_NETWORK,e,j)),j=null},j.ontimeout=function(){let me=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const we=e.transitional||RI;e.timeoutErrorMessage&&(me=e.timeoutErrorMessage),g(new no(me,we.clarifyTimeoutError?no.ETIMEDOUT:no.ECONNABORTED,e,j)),j=null},Sd.isStandardBrowserEnv){const re=(e.withCredentials||WR(K))&&e.xsrfCookieName&&GR.read(e.xsrfCookieName);re&&E.set(e.xsrfHeaderName,re)}b===void 0&&E.setContentType(null),"setRequestHeader"in j&&Ii.forEach(E.toJSON(),function(me,we){j.setRequestHeader(we,me)}),Ii.isUndefined(e.withCredentials)||(j.withCredentials=!!e.withCredentials),P&&P!=="json"&&(j.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&j.addEventListener("progress",mT(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&j.upload&&j.upload.addEventListener("progress",mT(e.onUploadProgress)),(e.cancelToken||e.signal)&&(i=re=>{!j||(g(!re||re.type?new k_(null,e,j):re),j.abort(),j=null)},e.cancelToken&&e.cancelToken.subscribe(i),e.signal&&(e.signal.aborted?i():e.signal.addEventListener("abort",i)));const q=XR(K);if(q&&Sd.protocols.indexOf(q)===-1){g(new no("Unsupported protocol "+q+":",no.ERR_BAD_REQUEST,e));return}j.send(b||null)})}const _T={http:gT,xhr:gT},yT={getAdapter:e=>{if(Ii.isString(e)){const l=_T[e];if(!e)throw Error(Ii.hasOwnProp(e)?`Adapter '${e}' is not available in the build`:`Can not resolve adapter '${e}'`);return l}if(!Ii.isFunction(e))throw new TypeError("adapter is not a function");return e},adapters:_T},tO={"Content-Type":"application/x-www-form-urlencoded"};function iO(){let e;return typeof XMLHttpRequest<"u"?e=yT.getAdapter("xhr"):typeof process<"u"&&Ii.kindOf(process)==="process"&&(e=yT.getAdapter("http")),e}function nO(e,l,d){if(Ii.isString(e))try{return(l||JSON.parse)(e),Ii.trim(e)}catch(g){if(g.name!=="SyntaxError")throw g}return(d||JSON.stringify)(e)}const Km={transitional:RI,adapter:iO(),transformRequest:[function(l,d){const g=d.getContentType()||"",b=g.indexOf("application/json")>-1,E=Ii.isObject(l);if(E&&Ii.isHTMLForm(l)&&(l=new FormData(l)),Ii.isFormData(l))return b&&b?JSON.stringify(OI(l)):l;if(Ii.isArrayBuffer(l)||Ii.isBuffer(l)||Ii.isStream(l)||Ii.isFile(l)||Ii.isBlob(l))return l;if(Ii.isArrayBufferView(l))return l.buffer;if(Ii.isURLSearchParams(l))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),l.toString();let i;if(E){if(g.indexOf("application/x-www-form-urlencoded")>-1)return NR(l,this.formSerializer).toString();if((i=Ii.isFileList(l))||g.indexOf("multipart/form-data")>-1){const F=this.env&&this.env.FormData;return Kv(i?{"files[]":l}:l,F&&new F,this.formSerializer)}}return E||b?(d.setContentType("application/json",!1),nO(l)):l}],transformResponse:[function(l){const d=this.transitional||Km.transitional,g=d&&d.forcedJSONParsing,b=this.responseType==="json";if(l&&Ii.isString(l)&&(g&&!this.responseType||b)){const P=!(d&&d.silentJSONParsing)&&b;try{return JSON.parse(l)}catch(i){if(P)throw i.name==="SyntaxError"?no.from(i,no.ERR_BAD_RESPONSE,this,null,this.response):i}}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Sd.classes.FormData,Blob:Sd.classes.Blob},validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ii.forEach(["delete","get","head"],function(l){Km.headers[l]={}});Ii.forEach(["post","put","patch"],function(l){Km.headers[l]=Ii.merge(tO)});function gx(e,l){const d=this||Km,g=l||d,b=gu.from(g.headers);let E=g.data;return Ii.forEach(e,function(i){E=i.call(d,E,b.normalize(),l?l.status:void 0)}),b.normalize(),E}function NI(e){return!!(e&&e.__CANCEL__)}function _x(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new k_}function vT(e){return _x(e),e.headers=gu.from(e.headers),e.data=gx.call(e,e.transformRequest),(e.adapter||Km.adapter)(e).then(function(g){return _x(e),g.data=gx.call(e,e.transformResponse,g),g.headers=gu.from(g.headers),g},function(g){return NI(g)||(_x(e),g&&g.response&&(g.response.data=gx.call(e,e.transformResponse,g.response),g.response.headers=gu.from(g.response.headers))),Promise.reject(g)})}function x_(e,l){l=l||{};const d={};function g(j,K){return Ii.isPlainObject(j)&&Ii.isPlainObject(K)?Ii.merge(j,K):Ii.isPlainObject(K)?Ii.merge({},K):Ii.isArray(K)?K.slice():K}function b(j){if(Ii.isUndefined(l[j])){if(!Ii.isUndefined(e[j]))return g(void 0,e[j])}else return g(e[j],l[j])}function E(j){if(!Ii.isUndefined(l[j]))return g(void 0,l[j])}function P(j){if(Ii.isUndefined(l[j])){if(!Ii.isUndefined(e[j]))return g(void 0,e[j])}else return g(void 0,l[j])}function i(j){if(j in l)return g(e[j],l[j]);if(j in e)return g(void 0,e[j])}const F={url:E,method:E,data:E,baseURL:P,transformRequest:P,transformResponse:P,paramsSerializer:P,timeout:P,timeoutMessage:P,withCredentials:P,adapter:P,responseType:P,xsrfCookieName:P,xsrfHeaderName:P,onUploadProgress:P,onDownloadProgress:P,decompress:P,maxContentLength:P,maxBodyLength:P,beforeRedirect:P,transport:P,httpAgent:P,httpsAgent:P,cancelToken:P,socketPath:P,responseEncoding:P,validateStatus:i};return Ii.forEach(Object.keys(e).concat(Object.keys(l)),function(K){const Y=F[K]||b,q=Y(K);Ii.isUndefined(q)&&Y!==i||(d[K]=q)}),d}const UI="1.1.3",xb={};["object","boolean","number","function","string","symbol"].forEach((e,l)=>{xb[e]=function(g){return typeof g===e||"a"+(l<1?"n ":" ")+e}});const xT={};xb.transitional=function(l,d,g){function b(E,P){return"[Axios v"+UI+"] Transitional option '"+E+"'"+P+(g?". "+g:"")}return(E,P,i)=>{if(l===!1)throw new no(b(P," has been removed"+(d?" in "+d:"")),no.ERR_DEPRECATED);return d&&!xT[P]&&(xT[P]=!0,console.warn(b(P," has been deprecated since v"+d+" and will be removed in the near future"))),l?l(E,P,i):!0}};function rO(e,l,d){if(typeof e!="object")throw new no("options must be an object",no.ERR_BAD_OPTION_VALUE);const g=Object.keys(e);let b=g.length;for(;b-- >0;){const E=g[b],P=l[E];if(P){const i=e[E],F=i===void 0||P(i,E,e);if(F!==!0)throw new no("option "+E+" must be "+F,no.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new no("Unknown option "+E,no.ERR_BAD_OPTION)}}const o1={assertOptions:rO,validators:xb},Tf=o1.validators;class Cp{constructor(l){this.defaults=l,this.interceptors={request:new dT,response:new dT}}request(l,d){typeof l=="string"?(d=d||{},d.url=l):d=l||{},d=x_(this.defaults,d);const{transitional:g,paramsSerializer:b}=d;g!==void 0&&o1.assertOptions(g,{silentJSONParsing:Tf.transitional(Tf.boolean),forcedJSONParsing:Tf.transitional(Tf.boolean),clarifyTimeoutError:Tf.transitional(Tf.boolean)},!1),b!==void 0&&o1.assertOptions(b,{encode:Tf.function,serialize:Tf.function},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();const E=d.headers&&Ii.merge(d.headers.common,d.headers[d.method]);E&&Ii.forEach(["delete","get","head","post","put","patch","common"],function(me){delete d.headers[me]}),d.headers=new gu(d.headers,E);const P=[];let i=!0;this.interceptors.request.forEach(function(me){typeof me.runWhen=="function"&&me.runWhen(d)===!1||(i=i&&me.synchronous,P.unshift(me.fulfilled,me.rejected))});const F=[];this.interceptors.response.forEach(function(me){F.push(me.fulfilled,me.rejected)});let j,K=0,Y;if(!i){const re=[vT.bind(this),void 0];for(re.unshift.apply(re,P),re.push.apply(re,F),Y=re.length,j=Promise.resolve(d);K<Y;)j=j.then(re[K++],re[K++]);return j}Y=P.length;let q=d;for(K=0;K<Y;){const re=P[K++],me=P[K++];try{q=re(q)}catch(we){me.call(this,we);break}}try{j=vT.call(this,q)}catch(re){return Promise.reject(re)}for(K=0,Y=F.length;K<Y;)j=j.then(F[K++],F[K++]);return j}getUri(l){l=x_(this.defaults,l);const d=FI(l.baseURL,l.url);return BI(d,l.params,l.paramsSerializer)}}Ii.forEach(["delete","get","head","options"],function(l){Cp.prototype[l]=function(d,g){return this.request(x_(g||{},{method:l,url:d,data:(g||{}).data}))}});Ii.forEach(["post","put","patch"],function(l){function d(g){return function(E,P,i){return this.request(x_(i||{},{method:l,headers:g?{"Content-Type":"multipart/form-data"}:{},url:E,data:P}))}}Cp.prototype[l]=d(),Cp.prototype[l+"Form"]=d(!0)});class bb{constructor(l){if(typeof l!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(E){d=E});const g=this;this.promise.then(b=>{if(!g._listeners)return;let E=g._listeners.length;for(;E-- >0;)g._listeners[E](b);g._listeners=null}),this.promise.then=b=>{let E;const P=new Promise(i=>{g.subscribe(i),E=i}).then(b);return P.cancel=function(){g.unsubscribe(E)},P},l(function(E,P,i){g.reason||(g.reason=new k_(E,P,i),d(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(l){if(this.reason){l(this.reason);return}this._listeners?this._listeners.push(l):this._listeners=[l]}unsubscribe(l){if(!this._listeners)return;const d=this._listeners.indexOf(l);d!==-1&&this._listeners.splice(d,1)}static source(){let l;return{token:new bb(function(b){l=b}),cancel:l}}}function oO(e){return function(d){return e.apply(null,d)}}function sO(e){return Ii.isObject(e)&&e.isAxiosError===!0}function $I(e){const l=new Cp(e),d=SI(Cp.prototype.request,l);return Ii.extend(d,Cp.prototype,l,{allOwnKeys:!0}),Ii.extend(d,l,null,{allOwnKeys:!0}),d.create=function(b){return $I(x_(e,b))},d}const Ka=$I(Km);Ka.Axios=Cp;Ka.CanceledError=k_;Ka.CancelToken=bb;Ka.isCancel=NI;Ka.VERSION=UI;Ka.toFormData=Kv;Ka.AxiosError=no;Ka.Cancel=Ka.CanceledError;Ka.all=function(l){return Promise.all(l)};Ka.spread=oO;Ka.isAxiosError=sO;Ka.formToJSON=e=>OI(Ii.isHTMLForm(e)?new FormData(e):e);const aO="mainConfig",lO={hosts:{},keys:{maptiler:"S5ckYmY9F8cXqKTHBLHV",mapbox:"pk.eyJ1Ijoid2lqZmkiLCJhIjoiY2xhMm8xaTcxMGJtMTNvb2NkbWhnbWFvcSJ9.roQ_naZk3TufzMGNOOgHIA"}},cO=[["LOCAL","localhost"],["DEV","dev.urbanresearchmaps.org"],["PROD","www.urbanresearchmaps.org"]],uO={container:"main-map",style:"style.json",center:[-74.2731,40.73641],zoom:12.54,hash:"&map",logoPosition:"bottom-right",attributionControl:!0,preserveDrawingBuffer:!0,antialias:!0,baselayers:[]},hO={},dO=[],bT={name:aO,api:lO,environments:cO,mapConfig:uO,tables:hO,defaultLayers:dO},fO="colorConfig",pO=[{stop:.1,color:"rgb(255,247,236)"},{stop:.25,color:"rgb(254,232,200)"},{stop:.33,color:"rgb(253,212,158)"},{stop:.5,color:"rgb(253,187,132)"},{stop:.66,color:"rgb(252,141,89)"},{stop:.75,color:"rgb(239,101,72)"},{stop:.9,color:"rgb(215,48,31)"},{stop:1,color:"rgb(179,0,0)"},{stop:-1,color:"rgb(127,0,0)"}],mO=[{stop:2e3,color:"rgb(255,255,212)"},{stop:2500,color:"rgb(254,227,145)"},{stop:3e3,color:"rgb(254,196,79)"},{stop:4e3,color:"rgb(254,153,41)"},{stop:5e3,color:"rgb(217,95,14)"},{stop:9200,color:"rgb(153,52,4)"}],gO={name:fO,Percent:pO,Index:mO};class _O{constructor(){this.mainConfig=bT,this.colorConfig=gO;const l=bT.environments.filter(d=>d[1]===window.location.hostname);this.env=l.length>0?l[0][1]:"LOCAL"}getDropDownList(){return Ka(`${this.mainConfig.api.hosts.cuny[this.env]}/query/coi_vars_sort?columns=*&limit=0`)}getDataForVar(l){return Ka(`${this.mainConfig.api.hosts.cuny[this.env]}/query/coi_data_filter?columns=stacotr20%2C${l.variable}${l.denomvar?"%2C"+l.denomvar:""}&limit=0`)}getDataForGeoid20(l){return Ka(`${this.mainConfig.api.hosts.cuny[this.env]}/query/coi_data_filter?filter=stacotr20='${l}'&columns=*&limit=0`)}}const yO=FC({components:nL}),Yv=sP(iR).use(yO);Yv.provide("mitt",nR());Yv.provide("dataManager",new _O);window.innerHeight>window.innerWidth&&(console.log("portrait"),document.body.classList.add("portrait"));window.addEventListener("resize",e=>{window.innerHeight>window.innerWidth&&!document.body.classList.contains("portrait")&&document.body.classList.add("portrait"),window.innerHeight<window.innerWidth&&document.body.classList.contains("portrait")&&document.body.classList.remove("portrait")});function vO(e){try{var l=JSON.parse(e);if(l&&typeof l=="object")return l}catch{}return!1}Date.prototype.getWeek=function(){var e=new Date(this.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var l=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-l.getTime())/864e5-3+(l.getDay()+6)%7)/7)};Yv.provide("tryParseJSON",vO);Yv.mount("#app");
